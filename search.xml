<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2D LiDAR Simulator Release Notice</title>
    <url>/2021/08/28/2D-LiDAR-Simulator-Release-Notice/</url>
    <content><![CDATA[<h1 id="d-lidar-simulator-v-1.0">2D LiDAR Simulator V 1.0</h1>
<hr>
<p>2D LiDAR Simulator V 1.0ğŸ‡ is built upon the repositoryğŸ‰ğŸ‰: <a href>GithubğŸ”—: Enigamtisms/Volume2D</a>, which is, recently, updated. This simulator contains:</p>
<ul>
<li><strong><u>map editor</u></strong>ğŸ› (with which you can build your own map),</li>
<li><strong><u>ROS integration</u></strong>ğŸš€:
<ul>
<li>rosbag generation without publishing</li>
<li>rviz visualization for LaserScan, tf, Odometry (perturbed)</li>
<li>Direct message publishing</li>
</ul></li>
<li><strong><u>Easy-to-use</u></strong>ğŸ‘Œ roslaunch <strong><u>parameter setting</u></strong>ğŸ— for simulated LiDAR and other perimeter settings.</li>
<li>Fluent opencv-based k<strong><u>eyboard / mouse control</u></strong>âŒ¨ğŸ–± with <strong><u>high FPS</u></strong>â², visualizing free space and scan.</li>
</ul>
<p>Some demo pictures are shown as follows:</p>
<p><img src="/2021/08/28/2D-LiDAR-Simulator-Release-Notice/1.png"></p>
<p><img src="/2021/08/28/2D-LiDAR-Simulator-Release-Notice/2.png"></p>
<span id="more"></span>
<hr>
<h2 id="dependencies">Dependencies</h2>
<p>The implementations are done in Ubuntu 18.04, under some of the key libraries:</p>
<table>
<thead>
<tr class="header">
<th>Library name</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ROS</td>
<td>Melodic (for Ubuntu 18.04)</td>
</tr>
<tr class="even">
<td>OpenCV</td>
<td>3.x.x or above</td>
</tr>
<tr class="odd">
<td>Eigen</td>
<td>Usually bond with ROS</td>
</tr>
</tbody>
</table>
<p>For compilation, C++ 17 standards are recommended.</p>
<hr>
<h2 id="download-compile">Download &amp; Compile</h2>
<p>In the repository <a href="https://github.com/Enigmatisms/LiDARSim2D">Enigmatisms/LiDAR2DSim</a>, click clone would suffice.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:Enigmatisms/LiDARSim2D.git</span><br><span class="line">cd LiDARSim2D</span><br></pre></td></tr></table></figure>
<p>Usually, for a ROS package we can compile the code via <code>catkin_make</code>. Yet, sometimes we want to compile A debug version, i.e. <code>-DCMAKE_BUILD_TYPE=DEBUG</code> and a release version at the same time for debugging convenience, therefore, <code>catkin_make</code> might not be quick to use. I have written a shell script named <code>make.sh</code> in the root directory, you can thereby run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod 777 ./make.sh</span><br><span class="line">./make.sh &lt;thread num for compilation&gt; &lt;if not empty, DCMAKE_BUILD_TYPE=DEBUG&gt;</span><br></pre></td></tr></table></figure>
<p>This script receives two params (the second one is optional). The former one declares the number of thread for compilation and the latter one is for debug mode specification. <code>make.sh</code> is simply an encapsulation of <code>catkin_make</code>.</p>
<p>Notice that if debug mode is on, cmake files will be output to folder <code>build_debug</code>, <code>devel</code> thereby contains the executable file of the most recent compilation (regardless of compilation mode <code>DCMAKE_BUILD_TYPE</code>)</p>
<hr>
<h2 id="run">Run</h2>
<p>Before run any of the code, make sure to:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$ </span><span class="language-bash">~/LiDAR2DSim: <span class="built_in">source</span> devel/setup.bash</span></span><br></pre></td></tr></table></figure>
<p>Otherwise, ROS package <code>lidar_sim</code> will not be found.</p>
<h3 id="the-editor">1. The Editor</h3>
<p>â€‹ Map editor is for the people who want to create their own maps. Run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">roslaunch lidar_sim editor.launch</span><br></pre></td></tr></table></figure>
<p>â€‹ You can find the param settings in <code>src/lidar_sim/launch/editor.launch</code></p>
<ul>
<li>map_name: specified output file name in folder <code>maps</code> ( <code>maps</code> is in the root directory)</li>
</ul>
<p>â€‹ There are some other things to be noticed:</p>
<ul>
<li>The outer boundaries are given (30-pixel-thin), therefore don't draw anything in the border.</li>
<li>Objects (Obstacles) are <strong>directional</strong> (all the points of each any one of the obstacles should be drawn in a anti-clockwise way)</li>
<li><strong><u>Press left button of the mouse</u></strong> to add a new point.</li>
<li><strong><u>Press <code>E</code></u></strong> if one obstacle is drawn, and it will automatically enclose itself.</li>
<li><strong><u>Press <code>S</code></u></strong> to save the map and quit.</li>
<li><strong><u>Press <code>P</code></u></strong> to pop the points added, if the new points are empty, the enclosed objects will be popped.</li>
<li><strong><u>Press <code>ESC</code></u></strong> to exit without saving the map.</li>
</ul>
<h3 id="particle-filter">2. Particle filter</h3>
<p>This repository is once a repo for <strong><u>Particle filter</u></strong>, I implemented one simple particle filter for localization purposes. Therefore you can play with it.</p>
<p>This particle filter includes a <strong>2D LiDAR simulator</strong>, which is based on the <strong>Volume2D Shader of mine</strong>[<a href="https://github.com/Enigmatisms/Volume">Github Repo: Enigmatisms/Volume]</a>. Using this LiDAR simulator, I implemented an interesting little localization program via <strong>Particle Filter</strong>. The localization experiments are only done in a 2D-2DoF (translation position x and y) problem.</p>
<p>Under the condition of 2000 particles, the FPS of this algorithm is about 16-50 hz, and the convergence is fast and accurate. Run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">roslaunch lidar_sim filter.launch</span><br></pre></td></tr></table></figure>
<p>To find out.</p>
<h3 id="scan-simulator">3. Scan simulator</h3>
<p>The main content of this repo. Run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">roslaunch lidar_sim scan.launch</span><br></pre></td></tr></table></figure>
<p>On initialization, two new windows will pop up:</p>
<ul>
<li>An opencv window for free space, LiDAR scan visualization and scanner controlling.</li>
<li>An rviz window for sensor_msgs / nav_msgs visualization</li>
</ul>
<p>Check the launch file, you can find <strong><u>a lot of</u></strong> params.</p>
<ul>
<li>Controller settings:
<ul>
<li>trans_speed: translation speed (pixel per move, which is 2cm per move)</li>
<li>rot_vel: rotation velocity, in degree, which is only available in keyboard control</li>
<li>init_x, init_y: initial position of the scanner</li>
<li>kp, ki, kd: PID parameters for mouse controller, which allows smooth control.</li>
</ul></li>
<li>LiDAR settings
<ul>
<li>angle_min, angle_max: angle range in rad</li>
<li>angle_incre: angle resolution (increment) in rad</li>
<li>lidar_noise: noise level (gaussian sigma) for the noise in <strong><u>range.</u></strong></li>
<li>lidar_fps: frame rate of LiDAR</li>
</ul></li>
<li>Odometry settings: for nav_msgs::Odometry publishing
<ul>
<li>translation_noise: translation noise level</li>
<li>rotation_noise: rotation noise level (both gaussian)</li>
</ul></li>
<li>other settings:
<ul>
<li>map_name: which map to run</li>
<li>bag_name: the name of output rosbag</li>
<li>skip_selection: if true, the program will not ask you to select the initial position of the scanner, (init_x, init_y) will come into use.</li>
<li>direct_pub: publish the ROS messages in the program</li>
</ul></li>
</ul>
<hr>
<h2 id="demo">Demo</h2>
<video src="scan.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
]]></content>
      <categories>
        <category>project</category>
      </categories>
      <tags>
        <tag>release</tag>
        <tag>English</tag>
      </tags>
  </entry>
  <entry>
    <title>2Dä½“ç§¯å…‰ç»˜åˆ¶ç®—æ³•è®¾è®¡</title>
    <url>/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h1 id="volume2d">Volume2D</h1>
<hr>
<h2 id="preface">Preface</h2>
<p>â€‹ æœ€è¿‘ç©Minecraft1.12æ—¶å‘ç°äº†ä¸€ä¸ªæå…¶æ£’çš„å…‰å½±åŒ…ï¼Œä½“ç§¯å…‰ï¼ˆè™šå‡çš„ä½“ç§¯å…‰ï¼Œä¸æ˜¯ç”¨å…‰çº¿è¿½è¸ªåšçš„ï¼‰åšçš„æå…¶æ¼‚äº®ï¼Œä½¿æˆ‘å¯¹è¿™ä¸ªæ¸¸æˆé‡æ–°äº§ç”Ÿäº†å…´è¶£ã€‚</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/mc.png"></p>
<center>
Figure 1. æˆ‘çš„ä¸–ç•Œå…‰å½±
</center>
<p>â€‹ å®é™…ä¸Šï¼Œä¸ªäººä¹‹å‰å°±å¯¹ä½“ç§¯å…‰æœ‰å¾ˆå¤§çš„å…´è¶£ï¼Œæ‹ç…§çš„æ—¶å€™ä¹Ÿå¾ˆå–œæ¬¢å¯»æ‰¾å­˜åœ¨"Gods' Ray"çš„åœºæ™¯ï¼Œæ²¡æœ‰å°±å°†å…¶å¼ºè¡Œç”¨PSçš„å¾„å‘æ¨¡ç³Šç»˜åˆ¶å‡ºæ¥ã€‚å¯¹äºæ¸¸æˆå†…éƒ¨çš„å…‰å½±ï¼Œæˆ‘ä¹Ÿå¾ˆæƒ³è‡ªå·±å®ç°ä¸€ä¸ªå…‰çº¿æ•ˆæœï¼ˆå¤§ä¸€å†™çš„æ¸¸æˆ<a href="https://github.com/Enigmatisms/Ethians-Alpha-1.1">Ethians alpha 1.1ğŸ”—</a>ä¸­æœ‰é˜´å½±è®¡ç®—çš„ç®—æ³•ï¼ˆFOV shadow castingï¼‰ï¼Œä½†ç»“æœæ˜¯åŸºäºæ …æ ¼çš„ï¼Œè€Œä¸æ˜¯åŸºäºåƒç´ çš„ï¼‰ã€‚ç»¼åˆä»¥ä¸Šçš„æƒ³æ³• + æƒ³ç²¾è¿›ä¸€ä¸‹C++ STLæŠ€æœ¯ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜ã€‚</p>
<span id="more"></span>
<blockquote>
<p>å‡è®¾æœ‰ä¸€ä¸ªç‚¹å…‰æºï¼Œåœ¨ä¸€ä¸ªåªæœ‰çŸ©å½¢éšœç¢ç‰©çš„2Då¹³é¢ç©ºé—´ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆæ¸²æŸ“åœºæ™¯ä¸­çš„é˜´å½±ï¼Ÿ</p>
</blockquote>
<p>â€‹ è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ¸²æŸ“é—®é¢˜ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªæ¸²æŸ“ç®—æ³•å¹¶é‡‡ç”¨C++ + OpenCV 4.5.1è¿›è¡Œå®ç°ã€‚</p>
<hr>
<h2 id="ç®—æ³•è®¾è®¡ä¸å®ç°">ç®—æ³•è®¾è®¡ä¸å®ç°</h2>
<h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h3>
<p>â€‹ é¦–å…ˆå°†æ•´ä¸ªåœ°å›¾è¿›è¡Œæ …æ ¼åŒ–ã€‚æ¯”å¦‚ä¸ªäººçš„å®ç°ä¸­ï¼Œä¸€ä¸ª1200 * 900çš„çª—å£ï¼Œè¢«æ …æ ¼åŒ–ä¸º 40 * 30çš„åœ°å›¾ï¼Œæ¯ä¸ªæ …æ ¼å¤§å°ä¸º30 pixelsã€‚éšœç¢ç‰©æ˜¯åŸºäºæ …æ ¼çš„ï¼ˆå¯¹äºç±»ä¼¼äºEthians Alpha 1.1è¿™æ ·çš„å¹³é¢Roguelike Gameé€‚ç”¨ï¼‰ï¼Œæ …æ ¼è¶Šç²¾ç»†ï¼Œéšœç¢ç‰©ä¹Ÿå¯ä»¥æ›´åŠ ç²¾ç»†ï¼Œé˜´å½±è®¡ç®—å¯¹åº”çš„æ—¶é—´æ¶ˆè€—è¶Šå¤§ã€‚</p>
<hr>
<h3 id="è¾¹ç•Œç¡®å®šä¸åˆ’åˆ†">è¾¹ç•Œç¡®å®šä¸åˆ’åˆ†</h3>
<p>â€‹ å¯¹äºçŸ©å½¢çš„éšœç¢ç‰©ï¼Œä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯ï¼šå¯¹å…¶è¾¹ç•Œè¿›è¡Œç®¡ç†ï¼Œé˜´å½±æŠ•å°„çš„äº§ç”Ÿæ˜¯ç”±äºè¾¹ç•Œå¯¹å…‰çº¿çš„æˆªæ–­ä½œç”¨ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªw * hçš„æ …æ ¼åŒ–åœ°å›¾ï¼Œæ¯ä¸€ä¸ªæ …æ ¼å­˜åœ¨4æ¡è¾¹ç•Œï¼ˆä¸è€ƒè™‘å…±ç”¨è¾¹ç•Œæ—¶ï¼‰ï¼Œç›´æ¥å¯¹æ‰€æœ‰è¾¹ç•Œè¿›è¡Œæ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å°†è‡³å°‘æ˜¯<span class="math inline">\(O(n^2)\)</span>çš„ã€‚æ˜¾ç„¶ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæœ‰äº›è¾¹ç•Œæ˜¯å®Œå…¨ä¸å¿…è¦å­˜åœ¨çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤æ­¥å†…è®¡ç®—çœŸæ­£å¯èƒ½å½±å“æ¸²æŸ“çš„è¾¹ç•Œã€‚å…³äºè¾¹ç•Œæˆ‘ä»¬è¿˜éœ€è¦å…¶ä»–çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>è¾¹ç•Œçš„ä¸¤ä¸ªç«¯ç‚¹ä½ç½®</li>
<li>è¾¹ç•Œæ˜¯å‚ç›´çš„è¿˜æ˜¯æ°´å¹³çš„</li>
<li>è¾¹ç•Œæ˜¯å¦è¢«é®æŒ¡ï¼Œæ˜¯å¦è¢«å¤„ç†è¿‡</li>
<li>è¾¹ç•Œç›¸å¯¹äºå…‰çº¿çš„æ–¹å‘</li>
</ul>
<p>â€‹ åç»­çš„è®¡ç®—éœ€è¦ä¾èµ–äºä¸Šè¿°ä¿¡æ¯ã€‚</p>
<h4 id="è¾¹ç•Œçš„æŒ‰æ …æ ¼ç¡®å®š">è¾¹ç•Œçš„æŒ‰æ …æ ¼ç¡®å®š</h4>
<p>â€‹ åˆšå¼€å§‹æ—¶æˆ‘çš„è®¾è®¡æœ‰äº›é—®é¢˜ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ä½ç½®è¿›è¡Œéå†ï¼ˆæŒ‰ç…§æ°´å¹³ / ç«–ç›´ä¸¤ä¸ªæ–¹å‘ï¼Œå¹¶è¡Œï¼‰ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ±‚å‡ºæ‰€æœ‰çš„è¾¹ç•Œã€‚è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>è®¾ç½®occupancy mapï¼ˆæ …æ ¼å ç”¨2Dæ•°ç»„ï¼‰ï¼Œä¸º0åˆ™è¡¨ç¤ºæ²¡æœ‰éšœç¢ç‰©ï¼Œä¸º1è¡¨ç¤ºæœ‰éšœç¢ç‰©</li>
<li>è¾¹ç•Œæ‰€åœ¨çš„ä½ç½® æ°´å¹³è¾¹çš„ä¸Šæ–¹ä¸€æ ¼ä¸ä¸‹æ–¹ä¸€æ ¼occupancy mapå€¼ä¸ç›¸ç­‰ï¼Œç«–ç›´è¾¹åˆ™æ˜¯å·¦å³å—çš„å€¼ä¸ç›¸ç­‰</li>
<li>å¯ä»¥å¿«é€Ÿç¡®å®šä¸¤ä¸ªæ–¹å‘çš„æ‰€æœ‰è¾¹</li>
</ol>
<p>â€‹ ä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ç¡®å®å¯ä»¥çœç•¥ä¸€äº›éè¾¹ç•Œä½ç½®ï¼Œæ¯”å¦‚ä¸¤ä¸ªç›¸é‚»éšœç¢ç‰©å—ä¹‹é—´çš„è¾¹ç•Œæˆ–è€…ä¸¤ä¸ªç©ºæ°”æ–¹å—ä¹‹é—´çš„è¾¹ç•Œï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æ— ç”¨è¾¹ç•Œæ— æ³•è¢«å‰”é™¤ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/rays.JPG"></p>
<center>
Figure 2. å†—ä½™è¾¹ç•Œç¤ºæ„å›¾
</center>
<p>â€‹ å®é™…ä¸ŠèƒŒå¯¹å…‰æºçš„è¾¹ç•Œå¯¹æŠ•å½±æ¯«æ— å¸®åŠ©ï¼Œè®¡ç®—æ—¶å¯ä»¥å¿½ç•¥ã€‚è¿™æ ·æ—¢å¯ä»¥èŠ‚çœå†…å­˜ï¼Œä¹Ÿå¯ä»¥èŠ‚çœè®¡ç®—æ—¶é—´ã€‚è€Œå¦‚å¼€å§‹çš„è®¾è®¡ï¼ŒæŒ‰ç…§è¾¹ç•Œçš„æ°´å¹³ / ç«–ç›´æ–¹å‘è¿›è¡Œè¾¹ç•Œè®¡ç®—æ— æ³•è·çŸ¥æŸä¸€æ¡è¾¹ç•Œåœ¨æ …æ ¼ä¸Šçš„ä½ç½®ï¼Œä¹Ÿå°±æ— æ³•è·çŸ¥å…¶æ˜¯å¦èƒ½å½±å“æŠ•å½±ç»“æœã€‚</p>
<p>â€‹ æŒ‰ç…§æ …æ ¼è¿›è¡Œç¡®å®šï¼Œä¹Ÿå°±æ˜¯éå†åœ°å›¾ä¸Šæ‰€æœ‰çš„æ …æ ¼ï¼Œè¾¹ç•Œåœ¨æ …æ ¼ä¸Šæ˜¯æœ‰å…¶ç›¸å¯¹ä½ç½®ä¿¡æ¯çš„ï¼Œè€Œæ …æ ¼ç›¸å¯¹å…‰æºä¹Ÿæ˜¯å¯ä»¥è·çŸ¥ä½ç½®ä¿¡æ¯çš„ï¼Œè¿™æ ·å¯ä»¥è®¡ç®—å‡ºè¾¹ç•Œæ˜¯å¦ä¼šå½±å“æŠ•å½±ç»“æœã€‚å…·ä½“çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨å…‰æºæ­£ä¸Šæ–¹çš„æ …æ ¼ï¼Œåªæœ‰é¢æœå…‰æºçš„è¿™ä¸€æ¡è¾¹ç•Œæ˜¯æœ‰æ„ä¹‰çš„</li>
<li>åœ¨å…‰æºä¾§é¢çš„æ …æ ¼ï¼Œæ ¹æ®å…‰æºçš„ç›¸å¯¹ä½ç½®ï¼Œæœ€å¤šé€‰æ‹©ä¸¤æ¡é¢æœå…‰æºçš„è¾¹ç•Œ</li>
<li>é¦–å…ˆè®¡ç®—æ …æ ¼ç›¸å¯¹å…‰æºçš„ä½ç½®ï¼šåˆ†ä¸º8ç§æƒ…å†µï¼š</li>
</ul>
<table>
<thead>
<tr class="header">
<th>enumåç§°</th>
<th>æ„ä¹‰</th>
<th>äºŒè¿›åˆ¶ç¼–ç </th>
<th>16è¿›åˆ¶è¡¨ç¤º</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TL</td>
<td>å·¦ä¸Š</td>
<td>0000</td>
<td>0x00</td>
</tr>
<tr class="even">
<td>DT</td>
<td>æ­£ä¸Š</td>
<td>0001</td>
<td>0x01</td>
</tr>
<tr class="odd">
<td>TR</td>
<td>å³ä¸Š</td>
<td>0010</td>
<td>0x02</td>
</tr>
<tr class="even">
<td>DL</td>
<td>æ­£å·¦</td>
<td>0100</td>
<td>0x04</td>
</tr>
<tr class="odd">
<td>DR</td>
<td>æ­£å³</td>
<td>0110</td>
<td>0x06</td>
</tr>
<tr class="even">
<td>BL</td>
<td>å·¦ä¸‹</td>
<td>1000</td>
<td>0x08</td>
</tr>
<tr class="odd">
<td>DB</td>
<td>æ­£ä¸‹</td>
<td>1001</td>
<td>0x09</td>
</tr>
<tr class="even">
<td>BR</td>
<td>å³ä¸‹</td>
<td>1010</td>
<td>0x0a</td>
</tr>
</tbody>
</table>
<p>â€‹ è®¾ç½®ç¼–ç çš„åŸå› æ˜¯ï¼Œå¯ä»¥æ ¹æ®é€»è¾‘è¿ç®—å¿«é€Ÿæ±‚å‡ºæ …æ ¼æˆ–è€…è¾¹ç•Œæ˜¯å¦å±äºæŸä¸ªæ–¹å‘ï¼ˆä¾‹å¦‚ä¸Šæ–¹ åŒ…æ‹¬å·¦ä¸Š æ­£ä¸Šå’Œå³ä¸Šï¼Œæˆ–è€…æ­£æ–¹å‘ï¼ŒåŒ…æ‹¬å››ä¸ªæ­£å‘ï¼‰ã€‚</p>
<ul>
<li>åªæœ‰æ­£æ–¹å‘çš„æ …æ ¼å­˜åœ¨ä¸€æ¡æœ‰æ•ˆè¾¹ç•Œï¼Œå…¶ä½™æ …æ ¼å‡å­˜åœ¨ä¸¤æ¡æœ‰æ•ˆè¾¹ç•Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ul>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/block.JPG"></p>
<center>
Figure 3. æœ‰æ•ˆè¾¹ç•Œç¤ºæ„å›¾
</center>
<p>â€‹ æ ¹æ®è¾¹ä¸­ç‚¹ä¸å…‰æºçš„ç›¸å¯¹ä½ç½®å¯ä»¥è®¡ç®—å‡ºè¾¹çš„æ–¹å‘ï¼ˆorientï¼‰ï¼Œè¾¹çš„orientå›¾ï¼š</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/orient.png"></p>
<center>
Figure 4. è¾¹æ–¹å‘è®¡ç®—å›¾ï¼Œä¸­éƒ¨ç°è‰²æ–¹å—æ˜¯å…‰æº
</center>
<p>â€‹ è¾¹ç•Œè®¡ç®—æ˜¯åˆ†å—å¹¶è¡Œçš„ã€‚ç”±äºæˆ‘ä½¿ç”¨çš„æœºå™¨ä¸º4æ ¸çš„ï¼Œä½¿ç”¨äº†4ä¸ªçº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯ä¾å›¾åƒä¸­å¿ƒåˆ’åˆ†ä¸ºå››ä¸ªè±¡é™ï¼Œå¹¶è¡Œè®¡ç®—ï¼Œæœ€ååˆå¹¶åˆ°ä¸€ä¸ªvectorå†…ï¼‰</p>
<hr>
<h3 id="è¾¹ç•Œé‡æ–°è®¡ç®—">è¾¹ç•Œé‡æ–°è®¡ç®—</h3>
<p>â€‹ å…‰æœ‰è¾¹ç•Œæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è¾¹ç•Œæ¥è®¡ç®—æ¸²æŸ“é—®é¢˜ï¼Œå‰é¢çš„æ­¥éª¤åªæ˜¯åœ¨å‡å°‘ä¸å¿…è¦çš„è¾¹ç•Œè®¡ç®—ä»¥åŠæ¸²æŸ“æ¡†è®¡ç®—ã€‚å…³äºé˜´å½±åŒºåŸŸçš„ä¸€ä¸ªç®€å•æƒ³æ³•æ˜¯ï¼šæŠ•å½±æ˜¯å­˜åœ¨å…ˆåé¡ºåºçš„ï¼Œè·ç¦»å…‰æºè¿‘çš„è¾¹ç•Œå¿…ç„¶æ˜¯éœ€è¦è¢«é¢„å…ˆå¤„ç†çš„ï¼Œå¹¶ä¸”åœ¨è·ç¦»è¿‘çš„è¾¹ç•ŒæŠ•å½±å®Œæˆä¹‹åï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–è¾¹ç•Œè¢«é®æŒ¡ã€‚è¢«å®Œå…¨é®æŒ¡çš„è¾¹ç•Œæ˜¯ä¸éœ€è¦å‚ä¸åç»­è®¡ç®—çš„ï¼Œè¿™æ˜¯å› ä¸ºæ›´è¿œçš„è¾¹ç•Œè¢«å®Œå…¨é®æŒ¡åï¼Œå…¶æŠ•å½±çš„é˜´å½±éƒ¨åˆ†å¿…ç„¶å°äºé®æŒ¡æ­¤è¾¹çš„è¾¹ç•Œçš„æŠ•å½±é˜´å½±åŒºåŸŸï¼ˆå¾ˆç»•ï¼Ÿï¼‰ã€‚</p>
<p>â€‹ æ—¢ç„¶å­˜åœ¨å…ˆåé¡ºåºï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°æ’åºã€‚ä¸ºäº†é¿å…è¿›è¡Œæ’åºï¼Œå®ç°ä¸­ç›´æ¥ç”¨äº†ä¸€ä¸ªå°é¡¶å †ï¼ˆC++ <code>&lt;queue&gt;</code> å¤´æ–‡ä»¶ä¸­çš„ priority_queueï¼‰ã€‚å¯æƒœçš„æ˜¯ï¼Œpriority_queueçš„ç‰¹æ€§ä¸queueç›¸ä¼¼ï¼Œæ²¡æœ‰è¿­ä»£å™¨ï¼Œæ— æ³•éå†ï¼Œæ‰€ä»¥priority_queueå­˜æ”¾çš„æ˜¯è¾¹ç•Œç±»çš„æŒ‡é’ˆï¼ŒæŒ‡å‘vectorä¸­çš„æŸä¸ªè¾¹ç•Œç±»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">EdgeCompFunctor</span>&#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">const</span> Edge* <span class="type">const</span> e1, <span class="type">const</span> Edge* <span class="type">const</span> e2)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> e1-&gt;<span class="built_in">getDistance</span>() &gt; e2-&gt;<span class="built_in">getDistance</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::priority_queue&lt;Edge*, std::vector&lt;Edge*&gt;, EdgeCompFunctor&gt; edges;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾¹ç•Œåˆ°å…‰æºçš„è·ç¦»åœ¨è®¡ç®—è¾¹ç•Œçš„æ—¶å€™ï¼ŒæŒ‰ç…§ä¸­ç‚¹åˆ°å…‰æºçš„æ¬§å¼è·ç¦»å·²ç»è®¡ç®—è¿‡äº†ã€‚</p>
<p>â€‹ è¾¹ç•Œé‡æ–°è®¡ç®—ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å®Œå…¨è¢«é®æŒ¡çš„è¾¹ç•Œï¼Œè®¾ç½®å…¶å†…éƒ¨çš„valid flagä¸ºfalseï¼Œä¹‹åå‡ºé˜Ÿæ—¶å¦‚æœé‡åˆ°æ ‡ç­¾æ— æ•ˆçš„è¾¹ç•Œç›´æ¥è·³è¿‡ã€‚</li>
<li>éƒ¨åˆ†è¢«é®æŒ¡çš„è¾¹ç•Œï¼Œ<strong><u>éœ€è¦é‡æ–°è®¡ç®—å…¶ç«¯ç‚¹</u></strong>ã€‚è¿™ä¸ªæ‰æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚</li>
</ul>
<p>â€‹ å¦‚ä½•åˆ¤å®šä¸€ä¸ªEdgeåœ¨æŸä¸ªè·ç¦»æ›´è¿‘çš„è¾¹ç•Œäº§ç”Ÿçš„é˜´å½±å†…éƒ¨å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ç›¸å¯¹è§’åº¦è¿›è¡Œåˆ¤å®šï¼šç»å¯¹è§’åº¦åæ ‡ï¼ˆæ¯”å¦‚æåæ ‡ï¼‰æ˜¯ä¸å¥½çš„ï¼Œä¸ç®¡ä½¿ç”¨ä»€ä¹ˆè¡¨å¾ï¼ˆé™¤éå››å…ƒæ•°ï¼‰ï¼Œéƒ½ä¼šå­˜åœ¨å¥‡å¼‚æ€§ï¼Œæ¯”å¦‚æåæ ‡çš„xæ­£å‘å®é™…åˆ†å‰²äº†0Â°ä¸360Â°ï¼Œè¿™ä¼šè®©è§’åº¦å¤§å°åˆ¤å®šå˜å¾—å¤æ‚ã€‚</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/calc2.JPG"></p>
<center>
Figure 5. é®æŒ¡æ€§è®¡ç®—
</center>
<p>â€‹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æˆ‘ä»¬çœ‹å·¦ä¸Šè§’é‚£æ¡è¾¹ç•Œã€‚é¦–å…ˆå¯¹äºæ­£åœ¨æŠ•å½±çš„è¾¹ç•Œï¼ˆProjecting edgeï¼‰ï¼Œå…¶é®æŒ¡èŒƒå›´æœ‰ä¸ªè§’åº¦Î¸ã€‚é‚£ä¹ˆæœ‰å¦‚ä¸‹è§„åˆ™ï¼Œå‡è®¾ä¸€æ¡éœ€è¦åˆ¤æ–­çš„è¾¹ç•Œåˆ°åˆ°ä¸¤æ¡è¾¹ç•Œçš„è§’åº¦ä¸º<span class="math inline">\(\theta_{ij},i,j=1,2\)</span>ã€‚å…¶ä¸­ <span class="math inline">\(\theta{ij}\)</span>è¡¨ç¤ºè¾¹ç•Œç«¯ç‚¹iåˆ°å…‰çº¿jçš„å¤¹è§’ï¼š</p>
<ul>
<li>æŸç«¯ç‚¹ä¸å…‰æºè¿çº¿åˆ°ä¸¤æŸå…‰çº¿çš„è§’åº¦å‡å°äºå…‰çº¿å¤¹è§’Î¸ï¼šè¯´æ˜è¿™ä¸ªç«¯ç‚¹åœ¨ä¸å¯è§†èŒƒå›´å†…</li>
<li>æŸç«¯ç‚¹åˆ°å…‰æºè¿çº¿åˆ°ä¸¤æŸå…‰çº¿çš„è§’åº¦ä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªè§’åº¦å¤§äºÎ¸ï¼Œè¯´æ˜è¿™ä¸ªç«¯ç‚¹åœ¨å¯è§†èŒƒå›´å†…ã€‚</li>
</ul>
<p>â€‹ å¦‚æœæˆ‘ä»¬é€šè¿‡è®¡ç®—æ–¹å‘å‘é‡ï¼Œä½¿ç”¨æ–¹å‘å‘é‡è¿›è¡Œå†…ç§¯çš„è®¡ç®—ï¼Œå†…ç§¯çš„ç»“æœå°±æ˜¯ç«¯ç‚¹å’Œå…‰çº¿å¤¹è§’çš„coså€¼ï¼Œæ˜¾ç„¶ï¼Œcoså€¼è¶Šæ¥è¿‘1ï¼ˆè¶Šå¤§ï¼‰ï¼Œå¯¹åº”ç«¯ç‚¹è¿çº¿ / å…‰çº¿çš„å¤¹è§’è¶Šå°ã€‚ï¼ˆ<strong><u>æ³¨æ„è¿™å†…ç§¯å€¼æ˜¯coså€¼ï¼Œcosåœ¨0-<span class="math inline">\(\pi\)</span>æ˜¯å‡å‡½æ•°ï¼Œå¼€å§‹å¿½ç•¥äº†è¿™ä¸€ç‚¹ï¼Œç›´æ¥â€œè¶Šå°è¶Šå¥½â€å¯¼è‡´äº†çˆ†ç‚¸</u></strong>ï¼‰ã€‚</p>
<p>â€‹ å¾—åˆ°äº†å¤¹è§’ä¹‹åæœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>ä¸¤ä¸ªç«¯ç‚¹å‡åœ¨ä¸å¯è§†èŒƒå›´å†…çš„ç›´æ¥è®¾ç½®valid = falseï¼Œä¹‹åä¸å†å¤„ç†</li>
<li>å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹åœ¨ä¸å¯è§†èŒƒå›´å†…çš„ï¼Œè®¡ç®—æ­¤ç«¯ç‚¹çš„æ›´æ–°å€¼ï¼ˆæ°å¥½åœ¨å…‰çº¿ä¸Šçš„ç‚¹ï¼‰ã€‚</li>
</ul>
<p>â€‹ å…³äºç«¯ç‚¹æ›´æ–°åˆ°ä»€ä¹ˆä½ç½®ï¼šç®€å•çš„æƒ³æ³•æ˜¯ï¼Œç«¯ç‚¹æ›´æ–°åˆ°ç¦»ä»–è¿‘çš„å…‰çº¿ä¸Šï¼ˆå¤¹è§’å°çš„å…‰çº¿ä¸Šï¼‰ã€‚æˆ‘ä¹‹å‰è¿™æ ·åšçš„æ—¶å€™å¼•èµ·äº†é—®é¢˜ï¼šå‡å¦‚å¤¹è§’å°çš„é‚£æ¡å…‰çº¿å¯¹åº”çš„ä½ç½®åœ¨éšœç¢ç‰©å†…éƒ¨æˆ–è€…åœ¨ç©ºæ°”æ–¹å—å†…éƒ¨ï¼ˆæ€»ä¹‹ä¸åœ¨è¾¹ç•Œä¸Šï¼‰ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥éœ€è¦åˆ¤å®šï¼šä¼˜å…ˆæŠ•å½±åˆ°å¤¹è§’å°çš„å…‰çº¿å¯¹åº”çš„æ›´æ–°ä½ç½®ä¸Šï¼Œå¦‚æœoccupancy mapæŒ‡ç¤ºå¯¹åº”ä½ç½®ä¸æ˜¯è¾¹ç•Œï¼Œåˆ™æŠ•å½±åˆ°å¦ä¸€æ¡å…‰çº¿ä½ç½®ã€‚</p>
<p>â€‹ é‚£ä¹ˆæ•´ä¸ªæµç¨‹åº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>å–å †é¡¶ï¼Œå †é¡¶æŒ‡é’ˆæŒ‡å‘çš„è¾¹ç•Œä¸ºå½“å‰æŠ•å½±è¾¹ï¼Œè®¡ç®—å…‰çº¿æ–¹å‘å‘é‡ï¼Œpop</li>
<li>â€œå…«å‰â€æœç´¢ï¼ˆä¸ªäººå«æ³•ï¼Œç°åœ¨æ²¡æœ‰ç”¨å…«å‰æ ‘å®ç°ï¼Œä½†æ˜¯å®é™…åº”è¯¥æ˜¯å¯ä»¥ç”¨ç±»ä¼¼ç»“æ„å®ç°çš„ï¼‰ï¼Œæœç´¢éœ€è¦æ›´æ–°çš„è¾¹ï¼Œè¿›è¡Œæ›´æ–°</li>
<li>æ›´æ–°å°±æ˜¯åˆ¤å®šæ˜¯å¦è¦æ›´æ–°ç«¯ç‚¹æˆ–è€…valid flagå€¼ï¼Œæ­¤å¤„å¯ä»¥å¹¶è¡Œ</li>
<li>æ‰€æœ‰éœ€è¦æ›´æ–°çš„è¾¹æ›´æ–°ä¹‹åï¼Œç¡®å®šæ¸²æŸ“æ¡†</li>
</ul>
<h4 id="å…«å‰æœç´¢">å…«å‰æœç´¢</h4>
<p>â€‹ ç”±äºæ¯æ¡è¾¹éƒ½åŒ…å«æ–¹å‘ä¿¡æ¯ï¼Œè€Œåœ¨æŸæ¡è¾¹æŠ•å½±æ—¶ï¼Œå¹¶éæ•´å¼ åœ°å›¾ä¸Šçš„è¾¹éƒ½æœ‰å¯èƒ½æ›´æ–°ã€‚æ›´æ–°åªå‘ç”Ÿåœ¨ä¸æŠ•å½±è¾¹ç›¸åŒæ–¹å‘ï¼ˆæˆ–æ˜¯ç›¸è¿‘æ–¹å‘ï¼‰çš„è¾¹ä¸­ã€‚è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯æ­£æ–¹å‘ä¸Šçš„è¾¹ï¼Œæ¯”å¦‚æŠ•å½±è¾¹æ˜¯æ­£ä¸Šæ–¹çš„ï¼Œç”±äºæ­£æ–¹å‘éšœç¢ç‰©çš„é˜´å½±è¦†ç›–é¢å¹¿ï¼Œéœ€è¦æœç´¢æ­£ä¸Šæ–¹ï¼Œå·¦ä¸Šæ–¹ï¼Œå³ä¸Šæ–¹çš„æ‰€æœ‰è¾¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£æ–¹å‘çš„æŠ•å½±è¾¹éœ€è¦æœç´¢ä¸€ä¸ªå¤§æ–¹å‘ï¼ˆåŒ…å«3ä¸ªå°çš„æ–¹å‘ï¼‰</li>
<li>å¦‚æœä¸æ˜¯æ­£æ–¹å‘ä¸Šçš„è¾¹ï¼Œåªéœ€è¦æœç´¢è¾¹é›†åˆï¼ˆvectorï¼‰ä¸­ä¸æŠ•å½±è¾¹ç›¸åŒæ–¹å‘çš„è¾¹å³å¯ã€‚</li>
</ul>
<p>â€‹ è¿™ç§æ–¹æ³•è¿˜åªæ˜¯åŸºäºä¸€ç»´vectorçš„å…¨éå†ï¼Œå®é™…å¯ä»¥ä½¿ç”¨unordered_mapï¼Œä»¥æ–¹å‘ç¼–ç ä¸ºkeyï¼Œvalueä¸ºvectorï¼Œåªæœç´¢éƒ¨åˆ†vectorã€‚</p>
<hr>
<h3 id="æ¸²æŸ“æ¡†ç¡®å®š">æ¸²æŸ“æ¡†ç¡®å®š</h3>
<p>â€‹ ä¸ªäººè®¤ä¸ºï¼Œæœ¬æŠ•å½±é—®é¢˜å®é™…ä¸Šæ˜¯ï¼šæ¯ä¸€æ¡è¾¹æŠ•å½±æ—¶äº§ç”Ÿå›¾åƒä¸Šçš„ä¸€éƒ¨åˆ†é˜´å½±éƒ¨åˆ†ï¼Œæ¯æŠ•å½±ä¸€æ¡è¾¹æ—¶å°±å¯ä»¥è®¡ç®—ä¸€ä¸ªæ¸²æŸ“æ¡†ï¼Œåªéœ€è¦å°†æ­¤æ¸²æŸ“æ¡†å†…å¡«å……æ»¡é˜´å½±ï¼ˆçš„é¢œè‰²ï¼‰å³å¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç»™å®šä¸€æ¡è¾¹ç•Œï¼Œéœ€è¦è®¡ç®—æ­¤è¾¹ç•Œäº§ç”Ÿçš„é˜´å½±åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯éœ€è¦è·å¾—å…‰çº¿ï¼ˆæˆ–è€…é˜´å½±è¾¹ç•Œçº¿ï¼‰ä¸åœ°å›¾è¾¹ç•Œçš„äº¤ç‚¹ã€‚å¦‚æœå¾—åˆ°äº¤ç‚¹ï¼Œç»è¿‡æ’åºä¹‹åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨OpenCVæä¾›çš„fillConvexPolyè¿›è¡Œå‡¸å¤šè¾¹å½¢çš„é¢œè‰²å¡«å……ã€‚</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/render.JPG"></p>
<center>
Figure 6. æ¸²æŸ“æ¡†è®¡ç®—ç¤ºæ„å›¾
</center>
<p>â€‹ å¦‚æœéœ€è¦è§£è¾¹ç•Œä¸Šçš„ç‚¹ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹ä¿¡æ¯ï¼šå…‰æºä½ç½®<span class="math inline">\((x_c, y_c)\)</span>ï¼Œå…‰çº¿å‘é‡<span class="math inline">\((v_x,v_y), (u_x,u_y)\)</span>ï¼Œè¾¹ç•Œï¼š<span class="math inline">\(x=0,y=0,x=x_M,y=y_M\)</span>ï¼Œå¹¶è®¾å¯¹åº”è¾¹ç•Œä¸ºï¼š<span class="math inline">\((x_b,y_b)\)</span>é‚£ä¹ˆå¯ä»¥æ ¹æ®ï¼š <span class="math display">\[
(x_c,y_c)+t(v_x,v_y)=(x_b,y_b)
\]</span> â€‹ åœ¨è¾¹ç•Œä¸Š<span class="math inline">\(x_b,y_b\)</span>ä¸­å¿…ç„¶æœ‰ä¸€ä¸ªæ˜¯å·²çŸ¥çš„ï¼Œå¯ä»¥è§£å‡ºtï¼Œå¾—åˆ°æœªçŸ¥çš„è¾¹ç•Œåæ ‡åˆ†é‡ã€‚å®é™…ä¸Šï¼Œä¸€æ¡å°„çº¿ï¼ˆä¸€ä¸ªå‘é‡ï¼‰å¯èƒ½ä¸ä¸¤ä¸ªè¾¹ç•Œï¼ˆç›¸é‚»çš„x / yæ–¹å‘è¾¹ç•Œï¼‰ç›¸äº¤ï¼Œå¾—åˆ°ä¸¤ä¸ªè§£ï¼Œä»ä¸¤ä¸ªè§£ä¸­é€‰æ‹©åˆç†å€¼ï¼ˆä¸¤ä¸ªåˆ†é‡å‡åœ¨è¾¹ç•ŒèŒƒå›´å†…ï¼‰ä½œä¸ºè§£ã€‚</p>
<p>â€‹ æ­¤å¤–ï¼Œå¾—åˆ°äº†è¾¹ç•Œäº¤ç‚¹å¹¶ä¸ä»£è¡¨ç€æ¸²æŸ“æ¡†å®Œå…¨é€‰å–å¥½äº†ï¼Œç”±äºè¾¹ç•Œäº¤ç‚¹å¹¶ä¸ä¸€å®šåœ¨åŒä¸€æ¡åœ°å›¾è¾¹ç•Œä¸Šï¼Œå¯èƒ½éœ€è¦å¢åŠ é¢å¤–çš„åœ°å›¾cornerä¸ºæ¸²æŸ“æ¡†è§’ç‚¹ã€‚æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/cond.JPG"></p>
<center>
Figure 7. æ¸²æŸ“æ¡†å¢åŠ åœ°å›¾è¾¹ç•Œç‚¹çš„ä¸‰ç§æƒ…å†µ
</center>
<p>â€‹ åœ¨å‡ºç°éœ€è¦å¢åŠ ç‚¹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦äººä¸ºè®¾è®¡ä¸€äº›è§„åˆ™ï¼Œè®¨è®ºå¦‚ä½•åˆ¤å®šè¿›å…¥è¿™ä¸‰ç§æƒ…å†µä¸­çš„å“ªä¸€ç§æƒ…å†µï¼š</p>
<ul>
<li>åŠ å…¥ä¸¤ä¸ªç‚¹çš„æƒ…å†µå‡ºç°æ—¶ï¼Œç‰¹å¾çš„è¡¨ç°æ˜¯ï¼šä¸¤ä¸ªè§£çš„æŸä¸ªåˆ†é‡å·®çš„ç»å¯¹å€¼ç­‰äºåœ°å›¾æŸä¸ªæ–¹å‘çš„é•¿åº¦ã€‚</li>
<li>åŠ å…¥ä¸€ä¸ªç‚¹çš„æƒ…å†µå‡ºç°æ—¶ï¼Œç‰¹å¾çš„è¡¨ç°æ˜¯ï¼šä¸¤ä¸ªè§£çš„å¯¹åº”åˆ†é‡ä¸ä¼šç›¸ç­‰ã€‚</li>
</ul>
<p>â€‹ æ¸²æŸ“æ¡†éœ€è¦emplaceåˆ°æŸä¸ªäºŒç»´vectorä¸­ã€‚æ­¤åä½¿ç”¨4ä¸ªçº¿ç¨‹åŒæ—¶ç»˜åˆ¶æ¸²æŸ“æ¡†å³å¯ï¼ˆåœ°å›¾å†…100ä¸ªéšæœºéšœç¢å—æ—¶ï¼Œç»˜åˆ¶æ—¶é—´å¤§æ¦‚æ˜¯1.5msï¼‰ã€‚ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/direct.png"></th>
<th style="text-align: center;"><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/direct2.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">éšæœºåœ°å›¾æ¸²æŸ“æ¡†ç»˜åˆ¶</td>
<td style="text-align: center;">ééšæœºåœ°å›¾æ¸²æŸ“æ¡†ç»˜åˆ¶</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ç¾åŒ–">ç¾åŒ–</h3>
<p>â€‹ ç¾åŒ–ä¸»è¦åšäº†ä¸¤ä¸ªäº‹æƒ…ï¼šå¯è§†èŒƒå›´ç¡®å®š + å…‰å¼ºè¡°å‡ã€‚è¿™ä¸¤ä¸ªäº‹æƒ…å¯ä»¥åˆå¹¶èµ·æ¥å¤„ç†ã€‚å¼€å§‹æˆ‘ä½¿ç”¨çº¿æ€§è¡°å‡ï¼Œè®¾ç½®é˜´å½±çš„è‰²å½©ä¸º(20, 20, 20)ï¼š <span class="math display">\[
max(255-\frac{255-20}{R_{max}}R,20)
\]</span> â€‹ æ­¤å¼è¯´æ˜ï¼Œå…‰å¼ºåº¦çº¿æ€§è¡°å‡åˆ°<span class="math inline">\(R_{max}\)</span>åï¼Œç»´æŒåœ¨æœ€ä½å…‰å¼ºå€¼å¤„ã€‚çº¿æ€§è¡°å‡çš„æ•ˆæœå¹¶ä¸å¥½ï¼Œå¯è§èŒƒå›´å†…è¾ƒäº®ä½ç½®æ¯”è¾ƒå°ã€‚è€Œæ”¹æ¢æˆè¾ƒä¸ºç¬¦åˆç‰©ç†å­¦çš„å…‰å¼ºè¡°å‡å…¬å¼ï¼ˆå¹³æ–¹åæ¯”ï¼‰åï¼Œæ•ˆæœè¾ƒå¥½ï¼š <span class="math display">\[
max(\frac{255}{(aR+1)^2},20),where\;a=\frac{\sqrt\frac{255}{20}-1}{R_{max}}
\]</span> â€‹ ç¾åŒ–åçš„ç»“æœå¦‚ä¸‹ä¸¤å¼ å›¾æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/beauty1.png"></th>
<th style="text-align: center;"><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/beauty2.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">éšæœºåœ°å›¾æ¸²æŸ“æ¡†ç»˜åˆ¶</td>
<td style="text-align: center;">ééšæœºåœ°å›¾æ¸²æŸ“æ¡†ç»˜åˆ¶</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="ç»“æœä¸ä»£ç ">ç»“æœä¸ä»£ç </h2>
<p>â€‹ ä»£ç è§<a href="https://github.com/Enigmatisms/Algorithms-Plus/tree/master/cpp/volume">[GithubğŸ”—Algorithm Plus/cpp/volume]</a>ï¼Œä»£ç ä¾èµ–ï¼šOpenCV 4.5.1ï¼ŒOpenMPï¼ŒC++ 11ï¼ˆæˆ–ä»¥ä¸Šï¼‰ï¼ŒCMakeã€‚</p>
<p>â€‹ åŠ å…¥äº†å¹³æ»‘è¿åŠ¨ï¼šå…‰æºçš„è¿åŠ¨ä¸æ˜¯æŒ‰ç…§æ …æ ¼è¿›è¡Œçš„ï¼Œè€Œæ˜¯æŒ‰ç…§åƒç´ è¿›è¡Œçš„ï¼Œè¿åŠ¨è¿‡ç¨‹æ¯”è¾ƒå¹³æ»‘ï¼Œå¯ä»¥é€šè¿‡é”®ç›˜æ“æ§å…‰æºçš„ç§»åŠ¨ã€‚è¾“å‡ºçš„gifå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/volume.gif"></p>
<p><img src="/2021/02/18/2D%E4%BD%93%E7%A7%AF%E5%85%89%E7%BB%98%E5%88%B6%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/volume2.gif"></p>
<center>
Figure 8. ä½“ç§¯å…‰ä¸å…‰æºè¿åŠ¨
</center>
<hr>
<br>
<center>
Do you like what youâ™‚see ?
</center>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>algos</tag>
      </tags>
  </entry>
  <entry>
    <title>A Duality Problem of Representations</title>
    <url>/2021/11/14/A-Duality-Problem-of-Representations/</url>
    <content><![CDATA[<h1 id="duality">Duality</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>In a slide talking about 3D geometry and deep learning, I found something interesting: one question, of which I can not get rid. This is a duality question about representations:</p>
<center>
<img src="/2021/11/14/A-Duality-Problem-of-Representations/dual.png" style="zoom:60%;">
</center>
<center>
Figure 1. Duality problem formulation
</center>
<p>These problems lingered in my head:</p>
<ul>
<li>Why and how we can regard probability distribution and particle filters as dual counterparts to each other?</li>
<li>Same question for occupancy map and point clouds, as they seem to be, according to the figure above, the representations under different specifications?</li>
</ul>
<p>So I took some time to sink in this problem. This post is therefore the summarization of my thoughts.</p>
<span id="more"></span>
<hr>
<h2 id="ii.-about-two-specifications">II. About two specifications</h2>
<p>â€‹ Eulerian and Lagrangian specifications are just two perspective of perceiving the world. Wikipedia illustrate these two specs with a good example (though it is talking about flow field):</p>
<blockquote>
<p>The <strong><u>Lagrangian</u></strong> specification of the flow field is a way of looking at fluid motion where the observer follows an individual fluid parcel as it moves through space and time. Plotting the position of an individual parcel through time gives the pathline of the parcel. This can be visualized as sitting in a boat and drifting down a river.</p>
</blockquote>
<blockquote>
<p>The <strong><u>Eulerian</u></strong> specification of the flow field is a way of looking at fluid motion that focuses on specific locations in the space through which the fluid flows as time passes. This can be visualized by sitting on the bank of a river and watching the water pass the fixed location.</p>
</blockquote>
<hr>
<h2 id="iii.-thoughts">III. Thoughts</h2>
<p>You will find that this description is kind of similar to the famous "<strong><u>Waveâ€“particle duality</u></strong>" . Somehow, the brilliant physicians device the idea of probability and "uncertainty", representing any given location of the physical world with the probabilities of different kinds of particles being present (since we know that in physics, electrons are actually a "probability cloud" around the nucleus), which resembles to occupancy grid representation. However, another intuitive representation of the world is that: The world composes of myriads of small individual particles. Now this is kind of like the point clouds, yet in the real world, the "point clouds" are much denser and complex.</p>
<p>This would mean that, (by my understanding):</p>
<ul>
<li>Eulerian specification tends to directly model the space (no matter what space this is), for each location within the interested space, we model the attributes (e.g. temporal or probabilistic) of it.</li>
<li>Lagrangian specification uses individual attention, or to say, the nonparametric, sampling-like approach to represent the interested space.</li>
</ul>
<p>Therefore, the duality between probability distribution and particle filters are quite straight forward:</p>
<div class="note info"><p>Probability distribution comes in many forms. There are basically two types: parametric and nonparametric. By "probability distribution" mentioned above, I mean the <strong><u>parametric approach</u></strong>.</p>
</div>
<p>The salient feature of parameterized approaches is: They are commonly defined on a fixed space, in this "fixed space", we can calculate the pdf of this distribution. However, nonparametric approaches are "sample-based", for example: KDE (kernel density estimation) and particle filters. For the former one, given location and parameters, the probabilistic attributes are fixed, yet for the latter one, the given location might just be "void" in terms of samples, therefore the information of the given location is subject to all the particles and every individual matters! The focus is different, one is on the fixed location in the space, and the other is on each individual. This is just the characteristic of <strong><u>parameterized distribution</u></strong> and <strong><u>particle filter method</u></strong>.</p>
<p>Say, if we have all the correct poses and transformations between the frames (point clouds), we now have two choices of map representation: Grid map (or voxel map) vs. point-clouds (and its variants like the representation I've been working on). For each grid (voxel) in the map, the focus given is "Eulerian", since we focus on the specific location. As for point clouds, it (yes I am not going to use plural) can be seen as the "particle filters" of walls and obstacles, which is sample-based and "Lagrangian".</p>
<hr>
<h2 id="iv.-can-we-dig-deeper">IV. Can we dig deeper?</h2>
<p>Now we know that, point cloud (and its variants) representations are the dual counterpart of occupancy map, yes but... what is the point? How this is going to help us? Let's talk about the merge of observations!</p>
<div class="note warning"><p>Formulation: the example of <u><strong>merge</strong></u> is that, if we observe a wall in one frame and in the successive frames we observed the same wall. Since we have the correct transformation, how we going to use the multi-view observation to get a more accurate wall?</p>
</div>
<p>For Eulerian method like occupancy grid, merge process is naturally incremental! Because Eulerian methods explicitly models each location, given the correct point cloud registration result, the update of occupancy grid is easy (using LiDAR model and the idea of "beam hitting the obstacles").</p>
<p>Unfortunately, merge for Lagrangian approaches is difficult to tackle with. The main goal is to build a incremental merge algorithm. Intuitively, merge for nonparametric approaches usually requires "total rebuild". For instance, consider every observed wall a particle filter. Every new observation might add new information to each particle filter, therefore for the final state a particle filter represents, we might need to calculate the updated stated from the scratch with no previous computation reuse (that what I currently believe). To my current belief, the incremental merge can only be implemented at a coarse-grained level.</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="http://3ddl.cs.princeton.edu/2016/slides/su.pdf">Hao Su (Stanford University): 3D Deep Learning on Geometric Forms, pdf</a></p>
<p>[2] <a href="https://en.wikipedia.org/wiki/Lagrangian_and_Eulerian_specification_of_the_flow_field">Wikipedia: Lagrangian and Eulerian specification of the flow field</a></p>
]]></content>
      <categories>
        <category>Philosophy</category>
      </categories>
      <tags>
        <tag>English</tag>
        <tag>Methodology</tag>
      </tags>
  </entry>
  <entry>
    <title>2Dæ¿€å…‰SLAMä¸­çš„SDFè¡¨å¾</title>
    <url>/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/</url>
    <content><![CDATA[<h1 id="sdf-slam">SDF-SLAM</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ åœ¨å®¶é…ç”µè„‘ç¯å¢ƒå·¥ç¨‹æ—¶ï¼ŒçœŸæ²¡æœ‰äº‹å¹²ï¼Œå°±åªèƒ½çœ‹çœ‹è®ºæ–‡äº†ã€‚ä¹‹å‰å¤ªnaiveäº†ï¼Œäº†è§£å¾—å°‘ï¼ŒåªçŸ¥é“2Dåœ°å›¾è¡¨å¾å¸¸ç”¨æ …æ ¼å›¾ä»¥åŠç‚¹äº‘ï¼Œä¸å¸¸ç”¨çš„æ˜¯éšå¼å‡½æ•°ï¼ˆimplicit functionï¼‰ï¼Œå´å¿˜è®°äº†è¿˜æœ‰SDFè¿™ä¸ªä¸­é—´è¡¨å¾ã€‚æŸ¥æ‰¾2D-SLAMæ–‡çŒ®æ—¶ï¼Œè¹¦å‡ºäº†å‡ ç¯‡SDFç›¸å…³çš„æ–‡ç« ï¼Œéƒ½è¿˜ç®—ä¸­è§„ä¸­çŸ©ï¼Œé€šä¿—æ˜“æ‡‚ï¼ˆæ¯”èµ·ä»€ä¹ˆcartographeråˆ†æ”¯å®šç•Œæ¥è¯´ï¼Œç®€ç›´å¤ªå‹å¥½äº†ï¼Œä¸è¿‡è¯´èµ·æ¥ï¼Œè¿™å‡ ç¯‡è®ºæ–‡ä¸­é™¤äº†cartographeré­”æ”¹è®ºæ–‡ä¹‹å¤–ï¼ŒçœŸçš„è°ˆäº†åç«¯å—ï¼Ÿï¼‰ï¼š</p>
<ul>
<li><p>Fossel, Joscha-David, Karl Tuyls, and JÃ¼rgen Sturm. "2D-SDF-SLAM: A signed distance function based SLAM frontend for laser scanners." <em>2015 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)</em>. IEEE, 2015.</p></li>
<li><p>Daun, Kevin, et al. "Large scale 2d laser slam using truncated signed distance functions." <em>2019 IEEE International Symposium on Safety, Security, and Rescue Robotics (SSRR)</em>. IEEE, 2019.</p></li>
<li><p>Fu, Xingyin, et al. "Improved Signed Distance Function for 2D Real-time SLAM and Accurate Localization." <em>arXiv preprint arXiv:2101.08018</em> (2021).</p></li>
</ul>
<p>â€‹ P.S. æœ¬æ–‡å†…å®¹å¹¶ä¸å¤šã€‚è™½ç„¶è¿™æœ‰ä¸‰ç¯‡è®ºæ–‡ï¼Œå…¶ä¸­å€¼å¾—å¤§ç¯‡å¹…è®²çš„ä¸å¯èƒ½å¡åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œä¸å€¼å¾—å¤§ç¯‡å¹…è®²çš„éƒ½åœ¨è¿™äº†ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-iros-2015-2d-sdf-slam">II. IROS 2015: 2D-SDF-SLAM</h2>
<p>â€‹ æœ¬æ–‡è²Œä¼¼å…ˆäºcartographerå‘è¡¨ï¼Œæ˜¯2D SLAMä¸­ä½¿ç”¨SDFä½œä¸ºåœ°å›¾è¡¨å¾çš„å¼€å±±é¼»ç¥–ã€‚æˆ‘ä»¬è¯´ï¼Œ2D SLAMä¸»è¦å°±æ˜¯ä¸¤ç§æ–¹æ³•ï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">Eulerian</a></li><li class="tab"><a href="#span-unique-name-2">Lagragian</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ å¦‚æœä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆï¼Œå‚é˜…æˆ‘ä¹‹å‰çš„ä¸€ç¯‡è‹±æ–‡åšæ–‡<a href="https://enigmatisms.github.io/2021/11/14/A-Duality-Problem-of-Representations/">ã€A Duality Problem of Representationsã€‘</a>ã€‚è¿™é‡Œçš„Eulerianæ–¹æ³•æŒ‡çš„å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªé™æ€çš„ç½‘æ ¼è¡¨å¾ï¼Œæ¯”å¦‚åŸºäºï¼ˆæ¦‚ç‡ï¼‰æ …æ ¼å›¾çš„GMappingï¼ŒHector SLAMï¼ŒGoogle's Cartographerã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯ï¼šå¤©ç„¶é€‚åˆè¿›è¡Œä¿¡æ¯èåˆã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ ä¸Eulerianç±»åˆ«çš„æ–¹æ³•äº’ä¸ºå¯¹å¶ã€‚ä½ æ˜¾å¼å»ºæ¨¡ç©ºé—´éšœç¢ç‰©çš„åˆ†å¸ƒï¼Œæˆ‘å°±ç”¨ä¸€å †åŒæ—¶å«æœ‰è½¨è¿¹ä»¥åŠåœ°å›¾ä¿¡æ¯çš„ç²’å­æ¥ä»£è¡¨æ•´ä¸ªç©ºé—´ã€‚å…¸å‹çš„æ–¹æ³•å°±æ˜¯ç²’å­æ»¤æ³¢ã€‚å¾ˆæœ‰è¶£çš„æ˜¯ï¼Œè¦è¯´ç”¨åˆ°PFæ–¹æ³•çš„SLAMï¼ŒGMappingä¹Ÿç®—æ˜¯ä¸€ä¸ªï¼Œæ‰€ä»¥GMappingå®é™…ä¸Šæ˜¯ï¼šç²’å­è¡¨å¾å«æœ‰Eulerianæ–¹æ³•çš„Lagrangianæ–¹æ³•ã€‚åŸºäºç‚¹äº‘çš„æ–¹æ³•ï¼Œå…¶å®å¯ä»¥çœ‹ä½œæ˜¯è¿™æ ·çš„æ–¹æ³•ï¼Œå› ä¸ºå…¶å¯¹åœ°å›¾çš„è¡¨å¾æ˜¯åŠ¨æ€çš„ç²’å­ã€‚</p></div></div></div>
<p>SDFç›¸æ¯”äºä»¥ä¸Šæ–¹æ³•ï¼Œæœ‰è¿™æ ·ä¸€äº›ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç›¸å¯¹äºgrid mapï¼Œå…¶éœ€è¦çš„å†…å­˜ç›¸å¯¹å°ä¸€äº›ã€‚SDFï¼Œç‰¹åˆ«æ˜¯æˆªæ–­SDFï¼Œåªéœ€è¦è¡¨å¾éšœç¢ç‰©é™„è¿‘å³å¯ï¼Œè€Œgrid mapå¾ˆå¤šæ—¶å€™éƒ½æ˜¯å…¨ç©ºé—´çš„ã€‚</li>
<li>ç›¸å¯¹äºgrid mapï¼ŒSDFæœ€ååˆ°åœ°å›¾éœ€è¦å¤šä¸€æ­¥ --- marching squareï¼ˆcubesï¼‰ç®—æ³•ã€‚è™½ç„¶å¤šäº†è¿™ä¸€æ­¥ï¼ŒSDFä»¥æ­¤æ±‚å¾—çš„åœ°å›¾ä¹Ÿæ˜¯sub-gridï¼ˆpixelï¼‰çš„ã€‚</li>
<li>ç›¸å¯¹äºç‚¹äº‘è¡¨å¾ï¼ŒSDFç”±äºä»æŸç§æ„ä¹‰ä¸Šç±»ä¼¼äºgrid mapï¼Œå…¶èåˆæ›´åŠ å‹å¥½ã€‚</li>
</ul>
<p>â€‹ æœ¬æ–‡å‘¢ï¼Œä¸»è¦è´¡çŒ®å¯ä»¥è¿™ä¹ˆè¯´ï¼š</p>
<ul>
<li>æå‡ºäº†æ›´å¥½çš„SDFæ›´æ–°æ–¹æ³•ï¼ˆè¿™ç§æ›´æ–°æ–¹æ³•ä¸æˆ‘ç†ŸçŸ¥çš„æ–¹æ³•å¤§ç›¸å¾„åº­ï¼Œä¸ªäººè®¤ä¸ºæ­¤æ–¹æ³•åº”è¯¥éå¸¸å¿«é€Ÿï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå¤§é—®é¢˜ï¼‰</li>
<li>æŠŠSDFå¼•åˆ°... 2D SLAMä¸­æ¥ï¼Ÿå½“æ—¶æ¥è¯´ç¡®å®å¯ä»¥ç®—æ˜¯radicalçš„åˆ›æ–°å§ï¼Œä½†ä»ç°åœ¨çš„è§’åº¦çœ‹æ¥ä¹Ÿä¸è¿‡å¦‚æ­¤ï¼Ÿï¼ˆåš¯ï¼Œåƒåœ¾hqyå¤§æ”¾å¥è¯ï¼‰</li>
</ul>
<p>â€‹ æœ¬æ–‡çš„å¼Šç—…ï¼ˆä¸ªäººè®¤ä¸ºçš„ï¼‰ï¼š</p>
<div class="note danger"><p>å®éªŒä¹Ÿå¤ªç®€å•äº†ã€‚</p>
<ul>
<li><p>é¦–å…ˆä½ ä»¿çœŸå°±ä»¿çœŸï¼ŒæŠŠä»¿çœŸçš„åœ°å›¾å…¬å¼€ä¸€ä¸‹ï¼Œåˆ«åªå…¬å¼€ä¸€ä¸ªå•Š æˆ‘ä»¬å°±ç”¨è¿™ä¸ªå¼€æºçš„Simple Two Dimensional Robot Simulatorã€‚æˆ‘çŸ¥é“ROSå·²ç»é›†æˆäº†è¿™ç©æ„ï¼Œä½†æ˜¯è¿™ç©æ„æ€ä¹ˆçœ‹éƒ½è§‰å¾—æœ‰ç‚¹ç®€é™‹ï¼Œä¸‡ä¸€ä½ è·‘ä¸ªå·¨ç®€å•çš„åœ°å›¾è¯´ï¼Œå•Šæˆ‘è¿™å¾ˆå¥½å•Šï¼Œè¿™æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p></li>
<li><p>çœŸå®çš„æ•°æ®é›†ä¹Ÿæ˜¯è‡ªå·±é‡‡é›†çš„ï¼Œè€Œä¸”ç¯å¢ƒå¾ˆç®€å•ã€‚æ²¡æœ‰å…¬å¼€æ•°æ®é›†...</p></li>
<li><p>æˆ‘è¯´ï¼Œè‡³å°‘ä¹Ÿå»radishä¸Šå¹²ä¸€å¹²GMappingå•Šï¼Œæ€ä¹ˆåªå¯¹æ¯”Hector SLAM</p></li>
</ul>
</div>
<p>â€‹ å…³äºè¿™ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œæˆ‘å¹¶ä¸æƒ³å¤šè¯´ï¼Œå…¶SDFæ›´æ–°ä¹‹æœ¯ï¼Œæˆ‘åœ¨ç¬¬ä¸‰èŠ‚ç»“åˆSSRRçš„è®ºæ–‡ä¸€èµ·è¯´ã€‚è€Œå…¶é…å‡†æ–¹å¼ï¼Œåªæ˜¯ä¸€ä¸ªå¸¦Huber Lossçš„é«˜æ–¯ç‰›é¡¿æ³•ã€‚ç­‰ç­‰ï¼Œå®ƒå¥½åƒä¹Ÿæ²¡æœ‰Huberæ ¸...ã€‚emmmï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘ä¹Ÿä¸æƒ³æ·±ç©¶è¿™ä¸ªé…å‡†åé¢çš„æ•°å­¦åŸç†ï¼Œæ˜¯å› ä¸ºä¸ªäººè®¤ä¸ºï¼š</p>
<div class="note primary"><p>â€‹ æœ¬è´¨ä¸Šï¼ŒSDFæ–¹æ³•çš„ä¼˜åŒ–æ–¹æ³•ä¸GMappingçš„æå¤§åéªŒæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚GMappingä¸­è®¡ç®—è¿™ä¸ªæå¤§åéªŒç”¨äº†ä¸€ä¸ªâ€œä¼¼ç„¶åŸŸâ€ï¼Œè¿™ä¸ªä¼¼ç„¶åŸŸæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿä½ å¯ä»¥ç®€å•è®¤ä¸ºåœ¨æ¯ä¸€ä¸ªæ¿€å…‰ç‚¹å¤„éƒ½æœ‰ä¸€ä¸ª2Dé«˜æ–¯æ ¸ï¼Œå åœ¨ä¸€èµ·ï¼ˆæœ‰ç‚¹åƒGMMï¼‰ã€‚è¿™ç©æ„å°±å’ŒSDFéå¸¸åƒäº†ï¼Œåªä¸è¿‡SDFæ˜¯çº¯çº¯çš„è·ç¦»ï¼Œä¼¼ç„¶åŸŸåƒæ˜¯ä¸ªSDFçš„è¿‘ä¼¼ã€‚é‚£ä¹ˆæ—¢ç„¶æ–¹æ³•ä¸Šéƒ½æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œå…¶å®ä¹Ÿå°±æ²¡æœ‰å¿…è¦å†ç†è§£ä¸€éè¿™ä¸ªç®—æ³•è¿‡ç¨‹ã€‚å†µä¸”æˆ‘ä¹‹å‰è¿˜è‡ªå·±è®¾è®¡è¿‡åŸºäºSDFçš„é…å‡†ï¼Œåªä¸è¿‡å½“æ—¶ä¸çŸ¥é“æˆ‘è®¾è®¡çš„ä¸œè¥¿æœ‰ä¸ªæœ¯è¯­å«SDFç½¢äº†ã€‚</p>
</div>
<hr>
<h2 id="iii.-åä¸¤ç¯‡å†…å®¹">III. åä¸¤ç¯‡å†…å®¹</h2>
<h3 id="ssrr-2019">3.1 SSRR 2019</h3>
<p>â€‹ æœ¬æ–‡æ˜¯cartographerçš„é­”æ”¹ï¼Œä½œè€…è‡ªå·±è¯´è‡ªå·±æ˜¯åŸºäºcartographerï¼Œå°†cartographeråªåŸºäºgrid mapæ‹“å±•ä¸ºäº†å¯ä»¥åŸºäºTSDFã€‚æœ¬æ–‡æˆ‘æƒ³è¯´çš„ä¸å¤šï¼Œç”±äºä½œè€…å…¶å®ä¹Ÿæ²¡æœ‰ä»‹ç»å¤ªå¤šæ–°çš„ideasï¼Œä¸»è¦ç¯‡å¹…éƒ½æ˜¯å…³äºï¼š</p>
<ul>
<li>åŸºäºTSDFè¡¨å¾çš„è¡¨å¾æ›´æ–°ï¼šå¦‚ä½•å¿«é€Ÿè€Œæœ‰æ­£ç¡®åœ°è®¡ç®—TSDFï¼ˆlocal SLAMï¼Œä¹Ÿå°±æ˜¯å‰ç«¯çš„å†…å®¹ï¼‰</li>
<li>åŸºäºåˆ†æ”¯å®šç•Œæ³•çš„åç«¯ï¼ˆå¸¦æœ‰å›ç¯çº¦æŸçš„å›¾ä¼˜åŒ–ï¼‰</li>
</ul>
<p>â€‹ è¯´èµ·æ¥ï¼ŒTSDFçš„æ›´æ–°æ–¹æ³•ç¡®å®å’Œæˆ‘ç†è§£å¾—éå¸¸ä¸åŒã€‚ä¸ªäººåœ¨2021å¹´6æœˆä»½ç®€å•ç ”ç©¶äº†ä¸€ä¸‹æ™®é€šSDFçš„è®¡ç®—ï¼Œå½“æ—¶å†™äº†ä¸€ä¸ªå…·æœ‰æ™®é€‚æ€§çš„SDFè®¡ç®—ä»£ç ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä»»æ„ç»™æˆ‘ä¸€æ®µæŠ˜çº¿ï¼Œæˆ‘éƒ½èƒ½æ±‚å‡ºå…¶SDFï¼‰ï¼Œå…³äºæˆ‘åŸæ¥å¯¹SDFçš„æƒ³æ³•ï¼Œå‚è§<a href>ã€è¿œå¤SDFæ–‡æ¡£ã€‘</a>ã€‚åæ­£å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<center>
<img src="/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/sdf.png" style="zoom: 80%;">
</center>
<center>
Figure 1. SDFæ ·å¼. å…¶ä¸­ï¼Œè¶Šæ¥è¿‘æŠ˜çº¿é¢œè‰²é¥±å’Œåº¦è¶Šæµ…ï¼Œä¸åŒçš„é¢œè‰²ä»£è¡¨äº†æ­£è´Ÿå·çš„ä¸åŒ
</center>
<p>â€‹ è¿™æ ·çš„SDFï¼Œè®¡ç®—å½“ç„¶æ˜¯ï¼šå¯¹äºç©ºé—´æ¯ä¸€ç‚¹è€Œè¨€ï¼Œè®¡ç®—å…¶åˆ°æŠ˜çº¿æ®µä¸Šè·ç¦»çš„æœ€å°å€¼ï¼ˆå¹¶ä¸”åˆ¤å®šè¿™ä¸ªç‚¹åœ¨æŠ˜çº¿æ®µçš„å“ªä¸€è¾¹ï¼‰ã€‚ä¸è€ƒè™‘è¾¹çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„æƒ³æ³•è®¡ç®—é‡ä¹Ÿè¿˜æ˜¯æŒºå¤§çš„ï¼Œ2Dæ …æ ¼ä¸Šï¼Œæ¯ä¸ªç‚¹éœ€è¦åšã€åˆ°ä¸åŒçº¿æ®µçš„æŠ•å½±ã€‘ï¼Œå†è¿›è¡Œä¸€ä¸ªæœ€å°å€¼çš„reduceã€‚æ‰€ä»¥ä¸ªäººä»ä¸€å¼€å§‹å°±è§‰å¾—ï¼Œè¿™ç§è®¡ç®—æ–¹æ³•è‚¯å®šæ¯”è¾ƒæ¶ˆè€—è®¡ç®—èµ„æºï¼Œä¸è¿‡è¿™æ ·çš„æ–¹æ³•çœ‹èµ·æ¥æ˜¯å¯ä»¥å¹¶è¡ŒåŠ é€Ÿçš„ï¼ˆè¿™é‡Œæˆ‘æƒ³åˆ°äº†CUDAï¼‰ã€‚</p>
<p>â€‹ ä½†è®ºæ–‡ä¸­æå‡ºäº†ä¸¤ç§æˆªç„¶ä¸åŒçš„æ–¹æ³•ï¼š</p>
<center>
<img src="/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/methods.png" style="zoom:80%;">
</center>
<center>
<span id="fig2"> Figure 2. SDFæ›´æ–°æ–¹æ³•[2] </span>
</center>
<p>â€‹ è¿™ä¸¤ç§æ–¹æ³•éƒ½é¿å¼€äº†ï¼šä¸€ä¸ªç‚¹çš„SDFå€¼éœ€è¦ä¸æŠ˜çº¿æ®µä¸Šæ‰€æœ‰çš„çº¿æ®µå‘ç”Ÿç›¸å…³è®¡ç®—çš„é—®é¢˜ã€‚è™½ç„¶ï¼Œæ‰€æœ‰çº¿æ®µéƒ½å‚ä¸è®¡ç®—æ˜¯æœ€æ­£ç¡®çš„æ–¹æ³•ï¼ˆé‡Œé¢æ²¡æœ‰ä»»ä½•çš„è¿‘ä¼¼ï¼‰ã€‚ä½†è€ƒè™‘åˆ°ï¼Œæ¿€å…‰æ•°æ®è¿›å…¥æ˜¯ä»¥ç‚¹ä¸ºå•ä½çš„ï¼Œå¦‚æœè½¬æ¢ä¸ºçº¿æ®µï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œè½¬æ¢ä¸ºçº¿æ®µå°±å­˜åœ¨ä¸å°çš„è®¡ç®—å¼€é”€ä»¥åŠå¤æ‚åº¦ä¸Šç›¸åŒçš„å†…å­˜å¼€é”€ã€‚ä¸ç®¡æ˜¯å¦è¿›è¡ŒæŠ½ç¨€ï¼ˆDouglas-Peukerç®—æ³•ï¼‰æˆ–è€…è¿‘ä¼¼ï¼ˆæ‹Ÿåˆï¼‰ï¼Œéƒ½ä¼šè‡³å°‘æ˜¯<span class="math inline">\(O(n)\)</span>çš„è®¡ç®—é‡ã€‚å¹¶ä¸”ï¼Œçº¿æ®µè¿˜ä¸èƒ½ç›´æ¥ç”¨æ–œæˆªå¼è¡¨ç¤ºï¼ˆå­˜åœ¨å¥‡å¼‚æ€§ï¼‰ã€‚</li>
<li>æ­¤å¤–ï¼Œè½¬æ¢ä¸ºçº¿æ®µè¿‡åï¼Œå¦‚æœæ²¡æœ‰åšä¸‹é‡‡æ ·æ“ä½œï¼Œçº¿æ®µæ•°ç›®å°†éå¸¸å¤šï¼ˆè™½ç„¶ç‚¹äº‘å·²ç»æ˜¯ä¸€ä¸ªsparseè¡¨å¾äº†ï¼‰ï¼Œé€šå¸¸æ¥è¯´éƒ½ä¼šåœ¨100æ®µä»¥ä¸Šã€‚å‡å¦‚è®¾gridçºµæ¨ªä¸ºnï¼Œçº¿æ®µæ¡æ•°ä¸º<span class="math inline">\(N\)</span>ï¼Œè®¡ç®—èµ„æºæ¶ˆè€—çš„å¤æ‚åº¦å°†ä¼šæ˜¯<span class="math inline">\(O(n^2N)\)</span></li>
</ul>
<p>â€‹ ä½œè€…æå‡ºçš„ç¬¬ä¸€ç§æ–¹æ³•ï¼Œç§°ä¸ºprojective rayæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å…¶å®è¿˜æ˜¯è¿‘ä¼¼äºgrid mapçš„æ€æƒ³ã€‚æˆ‘ç”¨æ¿€å…‰å™¨å…‰æŸæ¨¡å‹æ¥updateæ¯ä¸€ä¸ªå‡»ä¸­ç‚¹é™„è¿‘çš„SDFå€¼ï¼Œç®€å•è€ƒè™‘ï¼Œæˆ‘å°±è®¤ä¸ºåœ¨æ¯ä¸€ä¸ªå‡»ä¸­ç‚¹æ‰€åœ¨æ¿€å…‰çº¿ä¸Šï¼Œæˆ‘å¯ä»¥æŠŠæ¿€å…‰çº¿ä¸Šç‚¹ç›¸å¯¹äºå‡»ä¸­ç‚¹çš„è·ç¦»ç›´æ¥å½“ä½œSDFå€¼ã€‚ç”±äºåœ¨è¿™é‡Œï¼Œæ›´æ–°çš„æ¯ä¸€ä¸ªç‚¹éƒ½åœ¨æ¿€å…‰çº¿ä¸Šï¼Œæ‰€ä»¥å¦‚æœ<span class="math inline">\(\text{range} + \Delta d\)</span>æ˜¯æŸä¸ªgridçš„æ·±åº¦ï¼Œé‚£ä¹ˆ<span class="math inline">\(\Delta d\)</span>å°±æ˜¯SDFå€¼ï¼Œè®¡ç®—å°±éå¸¸ç®€å•äº†ã€‚ä½†è¿™ç§æ–¹æ³•çš„é—®é¢˜ä¹Ÿå¾ˆå¤§ï¼š</p>
<div class="note warning"><ul>
<li>æ±‚å‡ºçš„ä¸æ˜¯çœŸæ­£çš„SDFè·ç¦»ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸æ˜¯â€œåˆ°æœ€è¿‘è¡¨é¢çš„è·ç¦»â€ï¼Œåªæœ‰åœ¨æ¿€å…‰æŸå‚ç›´å…¥å°„è¡¨é¢å¹¶ä¸”é™„è¿‘æ²¡æœ‰å…¶ä»–è¡¨é¢æ—¶ï¼Œè¿™ç§æ–¹æ³•è®¡ç®—çš„SDFæ‰æ˜¯æ­£ç¡®çš„</li>
<li>åœ¨å…¥å°„è§’åº¦å¤§ï¼Œæˆ–è€…gridåˆ†è¾¨ç‡å¾ˆä½æ—¶ï¼ŒSDFè´¨é‡éå¸¸å·®ã€‚åœ¨IROS 2015 SDFæ–‡ä¸­è¯´åˆ°ï¼š</li>
</ul>
<blockquote>
<p>Cells which are both positive and negative are in conflflict as they are updated with both positive and negative distances, which do not tend to cancel each other.</p>
</blockquote>
<p>â€‹ å€Ÿç”¨IROS 2015ä¸­çš„å›¾ï¼Œè¡¨ç¤ºä¸€ä¸‹å¤§æ¦‚å°±æ˜¯ä¸‹å›¾è¿™æ ·ã€‚ä¸ªäººè®¤ä¸ºï¼Œè¿™ç§æƒ³æ³•ç®€ç›´å°±æ˜¯åœ¨ç”¨ã€æ–¹æ³•çš„å‰é€”ã€‘æ¢é€Ÿåº¦ã€‚</p>
<center>
<img src="/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/proj.png" style="zoom:60%;">
</center>
<center>
<span id="fig3"> Figure 3. SDFæ›´æ–°æ–¹æ³•ï¼š Projective rayçš„å¼Šç«¯[1] </span>
</center>
</div>
<p>â€‹ è€Œä½œè€…æå‡ºçš„ç¬¬äºŒç§æ–¹æ³•ï¼Œçœ‹èµ·æ¥æ›´åŠ æ­£ç¡®ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆæˆ‘éœ€è¦evaluateæ¯ä¸€ä¸ªæ¿€å…‰å‡»ä¸­ç‚¹çš„local normalï¼ˆå±€éƒ¨æ³•å‘ï¼‰ï¼Œè¿™ä¸€æ­¥ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¥½åšï¼Œæˆ‘åœ¨è‡ªç ”ç®—æ³•é‡Œæœ‰è¿™ä¸ªæ“ä½œï¼Œéœ€è¦è¿›è¡Œåˆçº§åˆ†å‰²ï¼Œä»¥å…æ·±åº¦ä¸è¿ç»­ä½ç½®å¯¼è‡´æ³•å‘é‡evaluateæœ‰è¯¯</li>
<li>æ ¹æ®å±€éƒ¨æ³•å‘ï¼Œæ²¿ç€å±€éƒ¨æ³•å‘çš„æ–¹å‘å‘å†…å¤–æ‰©å±•SDFï¼Œå¦‚<a href="#fig2">å›¾äºŒï¼ˆbï¼‰</a>ä»¥åŠä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ul>
<center>
<img src="/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/norm.png" style="zoom:80%;">
</center>
<center>
<span id="fig4"> Figure 4. SDFæ›´æ–°æ–¹æ³•ï¼šæ³•å‘æ³•[3] </span>
</center>
<p>â€‹ ä½†ä¸ªäººè§‰å¾—è¿™ç§æ–¹æ³•è¿˜æ˜¯ä¸ç”šä¼˜é›…ï¼Œåœ¨ç‚¹ç‰¹åˆ«ç¨€ç–çš„åœºæ™¯ä¸‹ï¼Œè¿™æ ·è®¡ç®—åº”è¯¥æ˜¯ä¼šå¯¼è‡´<strong><u>SDFç¨€ç–</u></strong>çš„ã€‚æ¯•ç«Ÿä½ åªupdateæ³•çº¿æ–¹å‘å‘¨å›´çš„éƒ¨åˆ†ç‚¹ï¼Œå¦‚æœç‚¹è¿‡äºç¨€ç–ï¼ˆ1. è§’åº¦åˆ†è¾¨ç‡è¿‡å°æˆ–2. å…¥å°„è§’åº¦å¤ªå¤§ï¼‰ï¼Œé‚£åœ¨å‚ç›´æ³•å‘çš„æ–¹å‘ä¸Šæ— æ³•å¾—åˆ°è¶³å¤Ÿçš„coverageï¼Œå°±ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>â€‹ è¿™é‡Œï¼Œåˆ†æ”¯å®šç•Œæ³•æˆ‘ä¸å¤šè¯´ï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰æ·±å…¥ç†è§£åˆ°å…¶æ–¹æ³•çš„ç²¾é«“ã€‚åœ¨è¿™é‡Œä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿ç­¹å­¦è™½ç„¶å­¦ä¹ äº†åˆ†æ”¯å®šç•Œæ³•ï¼Œä½†æ˜¯å¤ªæµäºè¡¨é¢ï¼Œå¯èƒ½å½“æ—¶ä¼šåšé¢˜ï¼ˆæ„æ€æ˜¯ç°åœ¨é¢˜éƒ½åšä¸å‡ºæ¥äº†ï¼‰ï¼Œä½†å¹¶æ²¡æœ‰ä½“ä¼šåˆ°è¿™ä¸ªæ€æƒ³çš„ç¾å¦™æ€§ï¼Œå…³äºåŸºäºBBæ–¹æ³•çš„åç«¯ä¼˜åŒ–ï¼Œä¸ªäººå¯èƒ½ä¼šç”¨ä¸“é—¨çš„ä¸€ç¯‡åšå®¢æ¥è®¨è®ºï¼ˆæœ‰å…³åˆ†æ”¯å®šç•Œæ³•æœ¬èº«ä»¥åŠå…¶åœ¨SLAMä¸­çš„åº”ç”¨ï¼‰ã€‚</p>
<h3 id="arxiv-preprint-2021">3.2 arXiv Preprint 2021</h3>
<p>â€‹ è¿™ç¯‡æ–‡ç« ï¼Œå¯èƒ½ä¹‹æ‰€ä»¥æ˜¯preprintï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰å¤ªå¤šå¯ä»¥æŠ•çš„ç‚¹å§ï¼Œé™¤äº†SDFæ›´æ–°ä¹‹å¤–ï¼Œæˆ‘åªç®€å•æä¸€äº›æœ¬æ–‡æå‡ºçš„å¥½çš„æ€æƒ³ï¼š</p>
<h4 id="free-space-update">3.2.1 Free Space Update</h4>
<p>â€‹ æ˜¯ ç©ºåŸŸçš„æ€æƒ³å—ï¼Ÿæœ‰ç‚¹è¿™ä¸ªå‘³é“ï¼Œä½†æ˜¯å¹¶ä¸å®Œå…¨ã€‚ä½œè€…å·²ç»æƒ³åˆ°äº†ï¼Œå¯ä»¥åˆ©ç”¨ä¸ç©ºåŸŸçš„å†²çªæ€§ï¼Œæ¥å‰”é™¤åŠ¨æ€éšœç¢ç‰©ï¼Œåªéœ€è¦åœ¨åœ°å›¾ä¸­å»ºç«‹ç©ºåŸŸæ¦‚å¿µï¼Œå¦‚æœä¸€ä¸ªhitè§‚æµ‹å‡ºç°åœ¨ç©ºåŸŸä¸­ï¼ˆåœ¨å¤šæ•°å¸§ä¸‹æ˜¾ç¤ºä¸ºun-occupiedï¼Œæœ¬å¸§å‘ç°å­˜åœ¨éšœç¢ç‰©ï¼‰ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡ä¼šæ˜¯åŠ¨æ€éšœç¢ç‰©ã€‚è¿™ä¸ªæ€æƒ³åœ¨æˆ‘ä»¬ç®—æ³•é‡Œä¹Ÿæœ‰ï¼Œå¹¶ä¸”å®ƒçš„free spaceè®¡ç®—æ–¹æ³•å°±å’Œæˆ‘ä»¬å¾ˆåƒï¼š</p>
<center>
<img src="/2022/02/21/2D%E6%BF%80%E5%85%89SLAM%E4%B8%AD%E7%9A%84SDF%E8%A1%A8%E5%BE%81/free.png" style="zoom:90%;">
</center>
<center>
<span id="fig5"> Figure 5. ç©ºåŸŸçš„è®¡ç®—æ–¹æ³•ï¼ˆç°è‰²çš„éƒ¨åˆ†æ˜¯ä¸€æŸæ¿€å…‰çº¿äº§ç”Ÿçš„ç©ºåŸŸï¼‰[3] </span>
</center>
<h4 id="expansion">3.2.2 Expansion</h4>
<p>â€‹ ä½œè€…ä¹Ÿæ„è¯†åˆ°çº¯æ³•å‘SDFæ›´æ–°çš„é—®é¢˜ï¼ˆç¨€ç–æ€§ï¼‰ï¼Œæ‰€ä»¥ä½œè€…ç”¨äº†ä¸€ä¸ªâ€œè¿­ä»£å–ç‚¹â€çš„æ–¹æ³•ã€‚é¦–å…ˆï¼ŒDeming regressionè‡³å°‘éœ€è¦ä¸‰ä¸ªç‚¹æ‰èƒ½ç”Ÿæˆä¸€æ¡ç›´çº¿ï¼Œåœ¨å…¥å°„è§’åº¦è¿‡å¤§æˆ–è€…è·ç¦»è¿‡è¿œçš„åœ°æ–¹ï¼Œä¸€ä¸ªgridå†…éƒ¨å¯èƒ½æ‰¾ä¸åˆ°é‚£ä¹ˆå¤šç‚¹ï¼Œä½œè€…æ ¹æ®hitç‚¹çš„é‚»åŸŸå…³ç³»é€æ­¥expandæœç´¢åŸŸã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<ul>
<li>åœ¨æŸä¸€ä¸ªæ¿€å…‰ç‚¹çš„8-é‚»åŸŸå†…ï¼ˆæ‰©å±•ä¸€æ¬¡ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªç‚¹ï¼Œæ˜¾ç„¶ä¸¤ä¸ªç‚¹æ²¡åŠæ³•å½¢æˆregressionï¼Œéœ€è¦ç»§ç»­æ‰©å±•</li>
<li>åœ¨8-é‚»åŸŸç‚¹å¯¹åº”çš„8-é‚»åŸŸå†…ï¼ˆæ‰©å±•ä¸¤æ¬¡ï¼‰ï¼Œæ‰¾åˆ°äº†ç¬¬ä¸‰ä¸ªç‚¹ï¼Œé‚£ä¹ˆç”¨è¿™ä¸‰ä¸ªç‚¹regressä¸€æ¡çº¿å¹¶è¿›è¡Œæ³•å‘æ›´æ–°</li>
<li><strong><u>å‚ç›´æ³•å‘</u></strong>ä¸Šçš„æ›´æ–°åŠå¾„ï¼Œ<strong><u>æ ¹æ®æ‰©å±•çš„æ¬¡æ•°</u></strong>ç¡®å®šï¼Œè¶Šç¨€ç–çš„ä½ç½®ï¼Œæ‰©å±•æ¬¡æ•°è¶Šå¤šï¼Œæ›´æ–°åŠå¾„å°±è¶Šå¤§ã€‚</li>
<li>è¿™æ ·ä¸€ç§æ–¹æ³•ï¼Œåº”è¯¥è‡³å°‘å¯ä»¥æ¶ˆé™¤å¤§éƒ¨åˆ†ç¨€ç–æ€§é—®é¢˜å¸¦æ¥çš„å½±å“ã€‚</li>
</ul>
<h4 id="ç±»ä¼¼view-selection">3.2.3 ç±»ä¼¼view selection</h4>
<p>â€‹ ä½œè€…åœ¨ <strong><em>Improve Priority Strategy</em></strong> ä¸€æ®µä¸­å†™åˆ°ï¼š</p>
<blockquote>
<p>The cells closer to the cell that gives rise to the update are put on a higher priority.</p>
</blockquote>
<p>â€‹ SDFçš„æ ‡å‡†å®šä¹‰å°±åº”è¯¥æ˜¯ï¼šç¦»è°è¿‘å°±ç”¨åˆ°è°çš„è·ç¦»æ¥æ›´æ–°ã€‚è€Œä¸ç®¡æ˜¯projective rayè¿˜æ˜¯å±€éƒ¨æ³•å‘æ³•ï¼Œéƒ½ä¸æ˜¯æŒ‰ç…§â€œè°æœ€è¿‘å°±ç”¨è°æ›´æ–°â€çš„åŸåˆ™è®¡ç®—SDFçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼•å…¥å–èˆæ ‡å‡†ï¼šä¸åŒç‚¹è®¡ç®—çš„ç»“æœä¸åŒæ—¶ï¼Œæˆ‘å–è°ã€‚ä½œè€…è¿™é‡Œå¹¶æ²¡æœ‰ä¸€åˆ€åˆ‡ï¼Œè€Œæ˜¯ç”¨åŠ æƒçš„æ–¹å¼èåˆã€‚</p>
<h4 id="outlier-removal">3.2.4 Outlier removal</h4>
<p>â€‹ emmmï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œå‰”é™¤æ·±åº¦ä¸è¿ç»­ç‚¹ã€‚è¿™ï¼Œå”å”æˆ‘å•Šï¼Œå¯æ—©å°±å†™è¿‡äº†ã€‚</p>
<h4 id="å­åœ°å›¾èåˆ">3.2.5 å­åœ°å›¾èåˆ</h4>
<p>â€‹ è¿™æ²¡æœ‰ä»€ä¹ˆæŒ‡çš„è¯´çš„ï¼Œå¯¹äºè¿™ç§æ˜¾å¼æˆ–è€…éšå¼ç”¨äº†gridçš„æ–¹æ³•ï¼Œèåˆå°±æ˜¯æ¯”è¾ƒç®€å•ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://www.researchgate.net/profile/Joscha-David-Fossel/publication/308298063_2D-SDF-SLAM_A_signed_distance_function_based_SLAM_frontend_for_laser_scanners/links/58e66d1fa6fdcc6800b47916/2D-SDF-SLAM-A-signed-distance-function-based-SLAM-frontend-for-laser-scanners.pdf">Fossel, Joscha-David, Karl Tuyls, and JÃ¼rgen Sturm. "2D-SDF-SLAM: A signed distance function based SLAM frontend for laser scanners." <em>2015 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)</em>. IEEE, 2015.</a></p>
<p>[2] <a href="https://www.researchgate.net/profile/Oskar-Von-Stryk/publication/336088692_Large_Scale_2D_Laser_SLAM_using_Truncated_Signed_Distance_Functions/links/5e8ca2da92851c2f52884e06/Large-Scale-2D-Laser-SLAM-using-Truncated-Signed-Distance-Functions.pdf">Daun, Kevin, et al. "Large scale 2d laser slam using truncated signed distance functions." <em>2019 IEEE International Symposium on Safety, Security, and Rescue Robotics (SSRR)</em>. IEEE, 2019.</a></p>
<p>[3] <a href="https://arxiv.org/pdf/2101.08018.pdf">Fu, Xingyin, et al. "Improved Signed Distance Function for 2D Real-time SLAM and Accurate Localization." <em>arXiv preprint arXiv:2101.08018</em> (2021).</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>SLAM</tag>
        <tag>è¡¨å¾</tag>
      </tags>
  </entry>
  <entry>
    <title>3D Reconstruction with Posed Mono-cam Images</title>
    <url>/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/</url>
    <content><![CDATA[<h1 id="re3d">Re3D</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ ç”µè„‘è¿˜æ²¡åˆ°ï¼Œæˆ‘[#]ã€‚ä¸å¾—ä¸è¯´äº¬ä¸œæœ‰äº›åº—æ˜¯çœŸçš„è„‘ç˜«ï¼Œä¹°RTXå‘AMDï¼ŒAMD yesä¹Ÿåˆ«è¿™æ ·å•Šã€‚æ²¡åŠæ³•å·¥ä½œçš„æƒ…å†µä¸‹åªèƒ½çœ‹è®ºæ–‡ï¼Œç»§ç»­3Dé‡å»ºã€‚3Dé‡å»ºæœ‰äº›éƒ¨åˆ†ä¸æˆ‘å½“å‰å·¥ä½œæœ‰é‡åˆä¹‹å¤„ï¼Œæˆ‘ä¹Ÿæƒ³ä»ä¸­è·å¾—ä¸€äº›å¯å‘ã€‚æœ¬æ–‡æ˜¯ä¸¤ç¯‡å°è®ºæ–‡ä»¥åŠä¸€æœ¬ä¹¦ï¼ˆè¿™æœ¬ä¹¦çš„å…¶ä¸­ä¸€å·ï¼‰çš„ä¸€ä¸ªå°ç†è§£ï¼š</p>
<ul>
<li><a href="https://arxiv.org/pdf/2003.10432.pdf?ref=https://githubhelp.com">Murez, Zak, et al. "Atlas: End-to-end 3d scene reconstruction from posed images." <em>European Conference on Computer Vision</em>. Springer, Cham, 2020.</a></li>
<li><a href="https://proceedings.neurips.cc/paper/2021/file/0a87257e5308197df43230edf4ad1dae-Paper.pdf">Bozic, Aljaz, et al. "Transformerfusion: Monocular rgb scene reconstruction using transformers." <em>Advances in Neural Information Processing Systems</em> 34 (2021)</a></li>
<li>ä¹¦ï¼ˆä¸å¾—ä¸è¯´è¿™æœ¬... æœŸåˆŠï¼Ÿå†™å¾—çœŸä¸é”™ï¼ŒCVæ–¹å‘çš„åŸºç¡€ä»¥åŠå‰ç»ï¼Œä¸è¿‡æ˜¯å½“æ—¶çš„å‰ç»äº†ï¼Œå¯èƒ½ä¹Ÿæ¯”è¾ƒè€ï¼‰: <a href="https://www.nowpublishers.com/CGV">Foundations and TrendsÂ® in Computer Graphics and Vision</a></li>
</ul>
<p>â€‹ é™„æ³¨ï¼šä¸è®©æˆ‘å·¥ä½œæˆ‘å°±æ‰“åŸç¥ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-åŸºæœ¬æ¦‚å¿µ">II. åŸºæœ¬æ¦‚å¿µ</h2>
<p>â€‹ ä»¥ä¸‹å†…å®¹å¾ˆå¤šéƒ½æ¥è‡ªäº[1]ï¼Œä¸ªäººè§‰å¾—æ­¤æ–‡å†™å¾—å¾ˆä¸é”™ï¼Œé€»è¾‘æ¸…æ™°ï¼Œæ˜“è¯»æ€§å¼ºã€‚</p>
<h3 id="dé‡å»ºæ¦‚è¿°">2.1 3Dé‡å»ºæ¦‚è¿°</h3>
<h4 id="dé‡å»ºçš„åŸºæœ¬æ–¹æ³•">2.1.1 3Dé‡å»ºçš„åŸºæœ¬æ–¹æ³•</h4>
<p>â€‹ ç¬”è€…è®¤ä¸ºï¼Œ3Dé‡å»ºè¡Œä¸šå‘å±•çš„ç†æƒ³é“è·¯åº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>å•ç›®RGB-å·²çŸ¥å›¾åƒä½å§¿çš„3Dé‡å»º</li>
<li>åŒç›®RGB å›¾åƒä½å§¿å¯ä»¥æœªçŸ¥</li>
</ul>
<p>â€‹ å®é™…ä¸Šï¼Œå¯ä»¥å°†ç¬¬äºŒç§æƒ…å†µè§†ä½œç¬¬ä¸€ç§æƒ…å†µçš„ç‰¹ä¾‹ã€‚ç¬¬äºŒç§æƒ…å†µåªä¸è¿‡æ˜¯å°†ä¸€åŠçš„å›¾åƒç”¨äºåŒç›®æ·±åº¦è®¡ç®—äº†ã€‚åœ¨[1]ä¸­ï¼Œä½œè€…è®¤ä¸ºï¼š</p>
<blockquote>
<p>The 3D reconstruction of shapes from <strong><u>multiple</u></strong>, <strong><u>uncalibrated</u></strong> images is one of the most promising 3D acquisition techniques.</p>
</blockquote>
<p>â€‹ ä½†â€œuncalibrated mono-camâ€åº”è¯¥è¯´æ˜¯æœ€å›°éš¾çš„ä¸€ç§ï¼Œå½“ç„¶å¦‚æœåšå‡ºæ¥äº†ï¼Œæ„ä¹‰ä¹Ÿæ˜¯æœ€å¤§çš„ä¸€ç§ï¼ˆç”¨æœ€å°‘çš„å…ˆéªŒçŸ¥è¯†ä»¥åŠè¾…åŠ©å·¥å…·è·å¾—äº†æƒ³è¦çš„ä¿¡æ¯ï¼Œè¿™å°±æ˜¯ä¼˜é›…çš„ã€ä½æˆæœ¬çš„å¥½æ–¹æ³•ï¼‰ã€‚</p>
<p>â€‹ å…³äºè§†è§‰3Dé‡å»ºï¼Œ[1]ä¸­æåˆ°äº†ä¸¤ç§ä¸»è¦çš„æ–¹å‘ï¼š</p>
<pre class="mermaid">
graph TB
A(3D Shape Extraction)
B(Passive)
C(Active)
D(Single vantage point)
E(Single vantage point)
F(Multiple vantage points)
G(Multiple vantage points)
A--&gt;B
A--&gt;C
B--&gt;D
B--&gt;F
C--&gt;E
C--&gt;G
H(Shape from texture&lt;br&gt;Shape from occlusion&lt;br&gt;Shape from defocus&lt;br&gt;Shape from contour&lt;br&gt;Time to contact)
I(Passive stereo&lt;br&gt;SfM&lt;br&gt;Shape from sillhouttes)
J(Time of Flight&lt;br&gt;Shape from texture)
K(Structed light&lt;br&gt;Active stereo&lt;br&gt;Photometric stereo)
D--&gt;H
F--&gt;I
E--&gt;J
G--&gt;K
</pre>
<center>
Figure 1. 3Dé‡å»ºæ–¹æ³•åˆ†ç±»
</center>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">Active</a></li><li class="tab"><a href="#span-unique-name-2">Passive</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ å¯ä»¥è®¤ä¸ºï¼Œactiveæ–¹æ³•æ˜¯ä¸€ç§é€šè¿‡ä¸€äº›å¤„ç†ä½¿å¾—åç»­çš„å¤æ‚è®¡ç®—ï¼ˆæ¯”å¦‚correspondence searchï¼‰å˜ç®€å•çš„æ–¹æ³•ã€‚æ¯”å¦‚ä½¿ç”¨å…‰æ–‘è¿›è¡Œâ€œåˆ¶å¯¼â€ï¼šä¸€ä¸ªé•¿æ³¢å…‰æºå‘å°„ä¸å¯è§å…‰ï¼Œå¦ä¸€ä¸ªæ¥æ”¶å™¨ï¼ˆç›¸å½“äºç›¸æœºï¼‰æ¥æ”¶å…‰ã€‚å‡è®¾æˆ‘ä»¬è®¤ä¸ºå‘å°„çš„æ˜¯å¯è§å…‰ï¼Œæ¥æ”¶å™¨ä¹Ÿæ˜¯ä¸€å°ç›¸æœºï¼Œé‚£ä¹ˆç›¸å½“äºæ˜¯ï¼šç›¸æœºæ‹æ‘„åˆ°ä¸€ä¸ªäº®æ–‘ï¼Œè€Œå‘å°„å™¨å¯ä»¥è®¤ä¸ºæ˜¯ç›¸æœºçš„åå‘æ¨¡å‹ï¼Œåˆ™â€œå‘å°„å™¨-æ¥æ”¶å™¨â€å¯è¢«è§†ä½œæ˜¯ä¸¤å°ç›¸æœºç»„æˆçš„åŒç›®ç³»ç»Ÿï¼Œè€Œäº®æ–‘çš„å­˜åœ¨å·²ç»å¸®æˆ‘ä»¬æ ‡æ³¨å¥½äº†correspondenceã€‚</p>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/active.png" style="zoom:50%;">
</center>
<center>
Figure 2. Active æ–¹æ³•å›¾ç¤º[1]
</center>
<p>â€‹ å½“ç„¶ï¼Œå•ç‚¹æ²¡ä»€ä¹ˆåµç”¨ã€‚æˆ‘ä»¬å¸Œæœ›å¯ä»¥è·å¾—æ•´ä¸ªé¢çš„correspondenceså…³ç³»ï¼Œæ˜¯å¦ä»ç„¶å¯ä»¥ä½¿ç”¨activeå…‰æ–‘æ³•ï¼Ÿå½“ç„¶ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬åœ¨ä½¿ç”¨å•ç‚¹å…‰æ–‘æ—¶ï¼ŒåŸºäºçš„æƒ³æ³•æ˜¯â€œ<strong><u>å”¯ä¸€æ€§</u></strong> ä»¥åŠ <strong><u>å®¹æ˜“æŸ¥æ‰¾æ€§</u></strong>ï¼Œç›´æ¥ä½¿ç”¨å•ç‚¹æ³•ä¸­å…‰æ–‘çš„2Då¤åˆ¶æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼ˆemmmï¼Œäº‹å®ä¸Šä¹Ÿå¯ä»¥ï¼ŒåŸºäºçº¢å¤–å…‰æ–‘é˜µåˆ—çš„æ·±åº¦ç›¸æœºä¹Ÿæœ‰çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•é™¤äº†ä¿è¯äº†æçº¿ä¸Šçš„å…¨å±€æœ€ä¼˜æ€§ï¼Œå¹¶æ²¡æœ‰å®é™…è§£å†³correspondence searchå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼‰ã€‚</p>
<p>â€‹ [1]ä¸­ä½œè€…ä»‹ç»äº†ä¸€äº›å¯¹å…‰æ–‘è¿›è¡Œâ€œpositional embedâ€çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘å°±ä½¿ç”¨ <strong>Attention is all you need</strong> ä¸­çš„sinusoidal positional encodingsæ€æƒ³ï¼Œç”¨å¤šç»„ä¸åŒé¢‘ç‡æˆ–è€…ç›¸ä½çš„æ­£å¼¦æ³¢æ¥å”¯ä¸€åœ°è¡¨å¾ä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬è¿›è¡ŒæŸ¥æ‰¾ã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ æœ¬æ–¹æ³•ä¸ä½¿ç”¨å…¶ä»–è¾…åŠ©æ‰‹æ®µï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ç›´æ¥é ç®—æ³•ç®—å‡ºç»“æœæ¥çš„ã€‚æ¯”å¦‚è¯´ï¼špassive triangulationã€‚é€šè¿‡é¢„å…ˆè®¡ç®—çš„correspondencesï¼Œè§£å‡ºåœ¨æŸä¸€ä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ã€‚ä½†ä½œè€…è‡ªå·±ä¹Ÿè¯´ï¼š</p>
<blockquote>
<p>Correspondence search actually is the <strong><u>hardest</u></strong> part of stereo, and one would typically have to solve it for many points.</p>
</blockquote>
<p>â€‹ è¿™æˆ‘ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œåªèƒ½è¯´ï¼ˆ1ï¼‰ç¡®å®ã€‚ï¼ˆ2ï¼‰è€ƒè™‘ä¸€ä¸‹CVPR 2021æœ€æ–°å·¥ä½œï¼ˆå¥½å§å·²ç»ä¸æ˜¯æœ€æ–°äº†ï¼‰ PointDSCï¼Ÿï¼ˆå¥½å§*2ï¼Œä½œè€…è¿™ç¯‡æ–‡ç« æ˜¯2010å¹´çš„ï¼‰ã€‚</p>
<p>â€‹ è™½ç„¶å¦‚æ­¤ï¼Œpassiveæ–¹æ³•æ›´åŠ ä¼˜é›…ï¼Œä¸ä¾èµ–å‘å°„å™¨ä»¶ï¼Œåªè¿›è¡Œæ¥æ”¶ç¬¦åˆå¤§å¤šæ•°ç”Ÿç‰©çš„ç‰¹æ€§ï¼Œå¹¶ä¸”è¿™æ ·çš„æ–¹æ³•é€‚ç”¨æ€§æ›´å¹¿ï¼Œactiveæ–¹æ³•å¯¹åº”çš„ä»€ä¹ˆç»“æ„å…‰ã€ToFä¸€åˆ°å®¤å¤–åœºæ™¯å¯èƒ½å°±ç›´æ¥å¯„äº†ã€‚</p></div></div></div>
<h4 id="dé‡å»ºé¢ä¸´çš„æŒ‘æˆ˜">2.1.2 3Dé‡å»ºé¢ä¸´çš„æŒ‘æˆ˜</h4>
<ul>
<li>å¤æ‚ç‰©ä½“å½¢çŠ¶ï¼šè‡ªé®æŒ¡ (self-occlusion)ï¼Œè§†è§’ä¸å…¨ï¼Œè¡¨é¢ç»†èŠ‚ä¸°å¯Œç­‰ç­‰</li>
<li>ä¸€äº›å¥‡æ€ªçš„çº¹ç†ï¼šåå°„ã€é€å°„ï¼Œä¸‡èŠ±ç­’å¼ï¼ˆæ¯”å¦‚é’»çŸ³ï¼‰ï¼ŒåŠé€æ˜ç‰©ä½“</li>
<li>Scalabilityï¼šæ—¢è¦èƒ½å¤Ÿé‡å»ºå°ç‰©ä½“ï¼Œä¹Ÿè¦èƒ½å¤Ÿé‡å»ºå¤§ç‰©ä½“ã€‚ï¼ˆä»å®¶å…·åˆ°åŸå¸‚ï¼‰</li>
<li>æ•°æ®é‡å¤§ã€å¤„ç†ç»´åº¦é«˜ï¼ˆ3Dè¡¨å¾æ¯”2Dé«˜ï¼‰ï¼šè‡ªã€å¼±ã€æ— ç›‘ç£</li>
<li>ç²¾åº¦ï¼šè¿™ä¸ªä¸ç”¨è®²ï¼Œé«˜ç²¾åº¦é²æ£’å®æ—¶ä¸ä»…ä»…æ˜¯2D SLAMçš„è¿½æ±‚</li>
<li>Semantic 3Dä¸Opportunistic scanningï¼Œè¯´çš„æ˜¯ä¸¤ä¸ªå¯¹å¶ï¼š
<ul>
<li>å‰è€…æŒ‡é‡å»ºçš„<strong><u>ç®—æ³•è¿‡ç¨‹åŸºäºå†…å®¹</u></strong>ï¼Œå‡è®¾æˆ‘çŸ¥é“æˆ‘éœ€è¦é‡å»ºçš„æ˜¯ä¸€è¾†è½¦ï¼Œé‚£ä¹ˆçŸ¥é“â€œè½¦â€çš„å…ˆéªŒä¿¡æ¯æˆ–è®¸å¯¹æˆ‘è¿›è¡Œé‡å»ºæœ‰å¾ˆå¤§å¸®åŠ©ã€‚é‚£ä¹ˆé‡å»ºè¿‡ç¨‹å°±éœ€è¦å¯¹å¾…é‡å»ºçš„åœºæ™¯æœ‰ä¸€å®šç†è§£ï¼Œè‡³å°‘æ˜¯è¯­ä¹‰çº§åˆ«çš„ã€‚è¿™å…¶ä¸­åŒ…å«äº†ä¸€å®šçš„ High level task å¸®åŠ© low level taskçš„æ„æ€ã€‚</li>
<li>åè€…æŒ‡é‡å»ºçš„<strong><u>æ•°æ®è·å–è¿‡ç¨‹åŸºäºå†…å®¹</u></strong>ï¼Œå‡è®¾æˆ‘çŸ¥é“å½“å‰åœºæ™¯å¤§é‡å­˜åœ¨æ— çº¹ç†åŒºåŸŸï¼ˆå¯¹passiveæ–¹æ³•ä¸å‹å¥½ï¼‰ï¼Œæˆ‘æ˜¯å¦å¯ä»¥è‡ªé€‚åº”æ›´æ¢åˆ°activeæ–¹æ³•ï¼ˆæ¯”å¦‚ç»“æ„å…‰ï¼‰ï¼Ÿ</li>
</ul></li>
</ul>
<h3 id="ç›¸æœºæ¨¡å‹å›é¡¾">2.2 ç›¸æœºæ¨¡å‹å›é¡¾</h3>
<p>â€‹ ä¹‹å‰å…¶å®æ²¡æœ‰ä»”ç»†æ¨è¿‡è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œç°åœ¨æƒå½“è¡¥ä¸ªç¥¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ˜ç¡®ä¸€ä¸‹ç¬¦å·ï¼š</p>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(R\)</span></th>
<th><span class="math inline">\(C\)</span></th>
<th><span class="math inline">\(K\)</span></th>
<th><span class="math inline">\(p\)</span></th>
<th><span class="math inline">\(z\)</span></th>
<th><span class="math inline">\(P\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>å¤–å‚ï¼šæ—‹è½¬</td>
<td>ä¸–ç•Œåæ ‡ç³»ä¸‹ç›¸æœºå…‰å¿ƒ</td>
<td>å†…å‚çŸ©é˜µ</td>
<td>å›¾åƒä½ç½®</td>
<td>æ·±åº¦</td>
<td>ä¸–ç•Œåæ ‡ç³»ä½ç½®</td>
</tr>
</tbody>
</table>
<p>â€‹ åˆ™è‹¥å·²çŸ¥ç›¸æœºåœ¨ä¸–ç•Œç³»ä¸‹çš„æ—‹è½¬ä¸å¹³ç§»ï¼ˆ<span class="math inline">\(R,C\)</span>ï¼‰ï¼Œå†…å‚çŸ©é˜µå·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œæœ‰å¦‚ä¸‹å…³ç³»ï¼š <span class="math display">\[
\begin{equation}
zp=KR^T(P-C)
\end{equation}
\]</span> â€‹ å®é™…ä¸Š<span class="math inline">\(R^T(P-C)\)</span>åªä¸è¿‡åšäº†ä¸€ä¸ªä¸–ç•Œç³»-&gt;ç›¸æœºç³»çš„åæ ‡å˜æ¢ã€‚æ­¤å…¬å¼åº”å½“éå¸¸ç†Ÿæ‚‰ã€‚</p>
<p>â€‹ æˆ‘ä»¬è€ƒè™‘å•ç›®å·²çŸ¥ç›¸æœºä½å§¿ä¸å‚æ•°æ—¶çš„æƒ…å†µï¼Œå¹¶ä¸”æˆ‘ä»¬å‡è®¾å·²ç»è·å¾—äº†ä¸¤å¼ å›¾ç‰‡ä¸­çš„correspondencesï¼ˆæˆ‘ä¸€å¥è¯ï¼Œå°±æå®Œäº†SLAMå’Œcorrespondence searchï¼‰ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œå¯¹äºä¸–ç•Œåæ ‡ç³»ä¸‹åŒä¸€ç‚¹ï¼š <span class="math display">\[
\begin{align}
&amp;z_1p_1=K_1R_1^T(P-C_1)\label{first}\\
&amp;z_2p_2=K_2R_2^T(P-C_2)\label{second}
\end{align}
\]</span> â€‹ åˆ™å¯ä»¥é€šè¿‡å…¬å¼<span class="math inline">\(\eqref{first}\)</span>åæ±‚Pï¼š <span class="math display">\[
\begin{equation}
z_1R_1K_1^{-1}p_1+C_1=P
\end{equation}
\]</span> â€‹ å¸¦å…¥åˆ°å…¬å¼<span class="math inline">\(\eqref{second}\)</span>ä¸­ï¼š <span class="math display">\[
\begin{align}
&amp;z_2p_2=K_2R_2^T(z_1R_1K_1^{-1}p_1+C_1-C_2)\rightarrow\\
&amp;z_2p_2=z_1K_2R_2^TR_1K_1^{-1}p_1+K_2R^T_2(C_1-C_2)\label{homo1}
\end{align}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(K_2R_2^TR_1K_1^{-1}:=A\)</span>è¢«ç§°ä¸ºâ€œInfinite Homographyâ€ï¼Œå…¶ç‰©ç†æ„ä¹‰æœ‰ä¸¤ç§è§£é‡Šï¼š</p>
<ul>
<li>å›¾åƒiä¸­ä¸€åƒç´ <span class="math inline">\(p_i\)</span>ä½ç½®ç¡®å®šçš„å…‰çº¿ï¼Œå…¶ç­ç‚¹ï¼ˆvanishing pointï¼‰åœ¨å›¾åƒjä¸‹çš„æŠ•å½±çŸ©é˜µï¼š<span class="math inline">\(p_j=Ap_i\)</span></li>
<li>å¯ä»¥è®¤ä¸º<span class="math inline">\(A\)</span>çŸ©é˜µå°±æ˜¯å…‰çº¿æ–¹å‘åœ¨ä¸¤ä¸ªç›¸æœºä¹‹é—´çš„å˜æ¢çŸ©é˜µ</li>
</ul>
<p>â€‹ æˆ‘ä»¬æš‚ä¸”æ‹¿å…¬å¼<span class="math inline">\(\eqref{homo1}\)</span>æ¥ç©ä¸€ç©ï¼Œçœ‹çœ‹å®ƒèƒ½æ¨å‡ºä¸€äº›ä»€ä¹ˆæœ‰è¶£çš„ç†è®ºã€‚æˆ‘ä»¬å¯ä»¥ä»ç†è®ºä¸Šè¯æ˜ï¼š</p>
<blockquote>
<p>åŒç›®åŒ¹é…ä¸­ï¼Œç»è¿‡rectificationçš„ä¸¤å¼ å›¾åƒï¼Œcorrespondence searchåªéœ€è¦åœ¨æ°´å¹³æ–¹å‘ä¸Šè¿›è¡Œã€‚</p>
</blockquote>
<p>â€‹ çœ‹èµ·æ¥... å¥½æ— èŠçš„ç†è®ºã€‚ä¸è¿‡æˆ‘ä»ç„¶è¦æ¥è¯•ä¸€ä¸‹ï¼šé¦–å…ˆå‡è®¾åŒç›®çš„ç›¸æœºå†…å‚ä¸€è‡´ï¼Œä¹Ÿå³<span class="math inline">\(K_1=K_2\)</span>ï¼Œå¹¶ä¸”è‹¥æ˜¯ç»è¿‡æ ¡å‡†ï¼ˆå¤–å‚ä¹Ÿç»è¿‡æ ‡å®šï¼‰çš„åŒç›®ç›¸æœºï¼Œåº”æœ‰ï¼š<span class="math inline">\(R_1=R_2\)</span> ä»¥åŠ <span class="math inline">\(C_1\)</span>ä¸<span class="math inline">\(C_2\)</span>åœ¨ç›¸æœºzè½´åæ ‡ä¸Šä¸€è‡´ï¼ˆå…¶ä¸€çš„å…‰å¿ƒåœ¨å¦ä¸€ç›¸æœºçš„xyå¹³é¢ä¸Šï¼‰ï¼Œé‚£ä¹ˆç”±å…¬å¼<span class="math inline">\(\eqref{homo1}\)</span>ï¼Œå¯ä»¥æ¨å‡ºï¼š <span class="math display">\[
\begin{equation}
z_2p_2=z_1(I)p_1+K_2R_2^T(C_1-C_2)
\end{equation}
\]</span> â€‹ ç”±äºç›¸æœºzè½´åæ ‡ä»¥åŠæ–¹å‘å‡ä¸€è‡´ï¼Œæ•…å¯¹äºåŒä¸€ä¸ªç‚¹ï¼Œ<span class="math inline">\(z_1=z_2\)</span>ï¼Œè€Œ<span class="math inline">\(K_2R_2^T(C_1-C_2)\)</span>åªæœ‰xè½´æ–¹å‘ä¸ä¸º0ï¼Œæ•…å¯ä»¥çŸ¥é“ï¼š <span class="math display">\[
\begin{equation}
p_2=p_1+\alpha v_x,\text{ in which }v_x \text{ only has x component}
\end{equation}
\]</span> â€‹ è¿™ä¹Ÿå°±è¯´æ˜äº†æ ‡å®šåçš„åŒç›®åªéœ€æ°´å¹³è¿›è¡Œcorrespondence searchã€‚</p>
<h3 id="å¯¹æçº¦æŸä¸åŸºç¡€çŸ©é˜µ">2.3 å¯¹æçº¦æŸä¸åŸºç¡€çŸ©é˜µ</h3>
<p>â€‹ 2.2ä¸­å®é™…ä¸Šæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªé‡è¦çš„çŸ©é˜µ<span class="math inline">\(A\)</span>ï¼Œç”¨äºè¿›è¡Œç­ç‚¹çš„æ˜ å°„ã€‚å½“ç„¶ï¼Œè¿™éƒ¨åˆ†åªæ˜¯é‡è¦å…¬å¼<span class="math inline">\(\eqref{homo1}\)</span>çš„ä¸€éƒ¨åˆ†ï¼Œè§‚å¯Ÿå…¬å¼<span class="math inline">\(\eqref{homo1}\)</span>çš„ç¬¬äºŒéƒ¨åˆ†<span class="math inline">\(K_2R_2^T(C_1-C_2)\)</span>ï¼Œä¸éš¾å‘ç°ï¼Œè¿™éƒ¨åˆ†æ˜¯å°†ä¸–ç•Œåæ ‡ç‚¹<span class="math inline">\(P\)</span>ç”¨<span class="math inline">\(C_1\)</span>å¸¦å…¥åˆ°å…¬å¼<span class="math inline">\(\eqref{second}\)</span>ä¸­ï¼Œä¹Ÿå³<span class="math inline">\(C_1\)</span>åœ¨ç›¸æœº2ä¸‹çš„æŠ•å½±ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæŠ•å½±ç‚¹<span class="math inline">\(K_2R_2^T(C_1-C_2)\)</span>ç§°ä¸ºæç‚¹ï¼ˆepipoleï¼‰</p>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/epi.png" style="zoom:70%;">
</center>
<center>
Figure 3. ç›¸æœºå…³ç³»ä¸å¯¹æçº¦æŸ[1]
</center>
<p>â€‹ å¦‚å›¾ï¼Œ<span class="math inline">\(e_2\)</span>å°±æ˜¯<span class="math inline">\(C_1\)</span>å¯¹åº”ç›¸æœºçš„æç‚¹ã€‚è€Œå¦ä¸€ä¸ªç‚¹<span class="math inline">\(Am_1\)</span>ï¼ˆç­ç‚¹çš„æ˜ å°„ï¼‰ã€‚è€Œç”±äºå…¬å¼<span class="math inline">\(\eqref{homo1}\)</span>å¯¹åº”äº†ä¸€ä¸ªçº¿æ€§æ˜ å°„ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªç‚¹å·²çŸ¥ï¼š</p>
<div class="note "><h5 id="ä¸€ä¸ªç»“è®º">ä¸€ä¸ªç»“è®º</h5>
<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒæŠ•å½±åœ¨ç›¸æœº1ä¸‹ï¼Œå¹¶ä¸”åƒç´ ä½ç½®ä¸ºå›¾ä¸Š<span class="math inline">\(m_1\)</span>ä½ç½®çš„æ‰€æœ‰3Dä½ç½®ç‚¹ï¼Œå°†ä¼šæŠ•å½±åœ¨ç›¸æœº2ç”±<span class="math inline">\(e_2\)</span>ä»¥åŠ<span class="math inline">\(Am_1\)</span>ç¡®å®šçš„ç›´çº¿ä¸Šã€‚</p>
</div>
<p>æˆ‘ä»¬å°†è¿™æ¡çº¿ç§°ä¸º<span class="math inline">\(m_1\)</span>åœ¨ç›¸æœº2ä¸‹çš„æçº¿ï¼ˆepipolar lineï¼‰ã€‚</p>
<p>â€‹ æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹2.2ä¸­çš„åŒç›®é—®é¢˜ï¼Œç”±äºæœªæ ‡å®šçš„ç›¸æœºï¼ˆæ­£å¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰æ˜¯åŒç›®ç›¸æœºçš„ä¸€èˆ¬åŒ–ï¼š</p>
<blockquote>
<p>Suppose we have two images, taken at the same time and from different viewpoints. Such setting is referred to as <strong><u>stereo</u></strong>.</p>
</blockquote>
<p>â€‹ åœ¨ä¸€èˆ¬çš„ä¸¤ç›¸æœº (stereo) æƒ…å½¢ä¸‹ï¼Œè¿›è¡Œcorrespondence searchåº”è¯¥æ˜¯åœ¨æçº¿ä¸Šè¿›è¡Œï¼Œè€Œæ ‡å®šåçš„ç®€åŒ–åŒç›®æ¨¡å‹ï¼Œå…¶æçº¿å°±æ˜¯ç‰¹æ®Šçš„æ°´å¹³çº¿ã€‚ç”±äºï¼š</p>
<ul>
<li>æç‚¹ï¼ˆå¦‚<span class="math inline">\(e_2\)</span>ï¼‰æ ¹æ®å®šä¹‰ï¼Œç”±äºå…¶åœ¨<span class="math inline">\(C_2\)</span>æ‰€åœ¨çš„Xè½´ä¸Šï¼ŒæŠ•å½±ä¸å­˜åœ¨ï¼Œå¯ä»¥è®¤ä¸ºåœ¨æ— ç©·è¿œå¤„</li>
<li>å¯¹äºç›¸æœº1çš„ä»»æ„ä¸€ä¸ªä½ç½®ï¼Œå…¶æŠ•å½±ç­ç‚¹æŠ•å½±åº”è¯¥æ˜¯å­˜åœ¨çš„ï¼Œä½†ä¸ä¸€ä¸ªXè½´ä¸Šæ— ç©·è¿œç‚¹å½¢æˆè¿çº¿ï¼Œå¯ä»¥ï¼ˆintuitivelyï¼‰è®¤ä¸ºå½¢æˆçš„æçº¿æ˜¯æ°´å¹³çš„ã€‚</li>
</ul>
<p>â€‹ è¿™ä¹Ÿåè¿‡æ¥è¯´æ˜äº†åŒç›®é—®é¢˜æ°´å¹³æœç´¢çš„æ­£ç¡®æ€§ã€‚</p>
<p>â€‹ è®¨è®ºå®ŒåŒç›®é—®é¢˜ä¹‹åï¼Œå†æ¥ç»†è‡´åœ°çœ‹ä¸€ä¸‹â€œ<strong><u>ä¸€ä¸ªç»“è®º</u></strong>â€ä¸­è¯´çš„æŠ•å½±ç‚¹å¿…é¡»åœ¨ç›´çº¿ä¸Šè¿™ä¸€ç»“è®ºã€‚æ­¤æ—¶æˆ‘ä»¬çŸ¥é“<span class="math inline">\(e_2\)</span>ï¼Œ<span class="math inline">\(m_2\)</span>ï¼Œ<span class="math inline">\(Am_1\)</span>åœ¨åŒä¸€ç›´çº¿ä¸Šã€‚è¿™èƒ½å¯¼å‡ºä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Ÿæ˜¾ç„¶ï¼Œä¸‰è€…çº¿æ€§ç›¸å…³ï¼Œåˆ—å‘é‡ç»„æˆçš„<span class="math inline">\(3\times 3\)</span>çŸ©é˜µç¼ºç§©ã€‚ <span class="math display">\[
|\begin{pmatrix}
e_2 &amp; Am_1 &amp; m_2
\end{pmatrix}|=0, \text{ where |Â·| means determinant}
\]</span> â€‹ æ³¨æ„ä¸Šè¿°çŸ©é˜µ<span class="math inline">\((e_2 \quad Am_1\quad m_2)\)</span>æ¯ä¸€åˆ—çš„ç¬¬ä¸‰åˆ†é‡éƒ½æ˜¯1ï¼Œå¹¶ä¸åªæ˜¯ç®€å•çš„ä¸€ä¸ªäºŒç»´çŸ©é˜µã€‚æ˜¾ç„¶ï¼Œ<span class="math inline">\(e_2\)</span>ä¸<span class="math inline">\(Am_1\)</span>ç¡®å®šçš„å¹³é¢æ³•çº¿å‚ç›´äº<span class="math inline">\(m_2\)</span>ï¼š</p>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/draw.jpg" style="zoom:45%;">
</center>
<center>
Figure 4. å¤–ç§¯ä¸å‚ç›´å…³ç³»
</center>
<p>â€‹ ç”¨goodnoteéšä¾¿æ¶‚äº†ä¸¤ç¬”ï¼Œå…¶ä¸­è“è‰²ï¼Œçº¢è‰²ä»¥åŠé»‘è‰²çº¿æ‰æ˜¯çœŸæ­£çš„å‘é‡ã€‚ç”±äºå¤–ç§¯å¯ä»¥å†™ä¸ºåå¯¹ç§°çŸ©é˜µå½¢å¼ï¼Œä¹Ÿå³ï¼š <span class="math display">\[
\begin{equation}
a\times b=[(a_1\quad a_2\quad a_3)^T]\times b=[a]_\times b=\begin{pmatrix}
0 &amp; -a_3 &amp; a_2 \\
a_3 &amp; 0 &amp; -a_1 \\
-a_2 &amp; a_1 &amp; 0
\end{pmatrix}b
\end{equation}
\]</span> â€‹ åˆ™å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
|\begin{pmatrix}
e_2 &amp; Am_1 &amp; m_2
\end{pmatrix}|=0\iff m_2^T([e_2]_\times Am_1)=0\rightarrow m_2^T([e_2]_\times A)m_1=0
\end{equation}
\]</span> â€‹ æˆ‘ä»¬æŠŠçŸ©é˜µ<span class="math inline">\([e_2]_{\times}A\)</span>ç§°ä¸ºï¼šåŸºç¡€çŸ©é˜µï¼ˆfundamental matrixï¼‰(<span class="math inline">\(F\)</span>)ï¼Œå…¶é™å®šäº†ç”±å¯¹æçº¦æŸçš„ä¸¤ä¸ªå›¾åƒç‚¹ä¹‹é—´çš„å…³ç³»ã€‚</p>
<hr>
<h2 id="iii.-eccv-2020-atlas">III. ECCV 2020: Atlas</h2>
<p>â€‹ æœ€ç»ˆé‡å»ºåŸºäºTSDF (truncated-SDF)ã€‚ç½‘ç»œä¸»è¦ç»“æ„ï¼š</p>
<p><img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/atlas.png"></p>
<center>
Figure 5. å¤§åŠ›ç¥çš„ç½‘ç»œç»“æ„
</center>
<p>â€‹ ç»è¿‡æµç¨‹ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>2Dç‰¹å¾æå–ï¼Œæå–æ¯å¼ å›¾åƒç‚¹çš„ç‰¹å¾ã€‚</li>
<li>ç‰¹å¾åæŠ•å½±ï¼Œä¹Ÿå°±æ˜¯ç”±2Då˜ä¸º3Dã€‚è¿™ä¸ªåæŠ•å½±è¿‡ç¨‹åŸºäºï¼š
<ul>
<li>ç©ºé—´voxelizeï¼Œä½œè€…ç§°ä¹‹ä¸ºfeature volume</li>
<li>ç›¸æœºæ¨¡å‹ï¼Œå°†ä¸€ä¸ªç‚¹çš„ç‰¹å¾æŠ•è‡³ä¸å…¶å…³è”å…‰çº¿ç©¿è¿‡çš„æ‰€æœ‰voxelï¼ˆå¦‚æœæˆ‘æ²¡ç†è§£é”™çš„è¯ï¼‰</li>
</ul></li>
<li>å¢é‡èåˆï¼šä¸€å¼ ä¸€å¼ å›¾åƒå åœ¨ä¸€èµ·ï¼Œå½¢æˆçš„feature volume <strong><u>å˜æ¢åˆ°ç»Ÿä¸€ä¸–ç•Œåæ ‡ç³»ä¸‹</u></strong> å¢é‡å åŠ ã€‚</li>
<li>å½¢æˆä¸€ä¸ªdenseçš„feature volumeï¼Œè¿™ç‚¹æˆ‘ç®€å•è¯´ä¸€ä¸‹ï¼š</li>
</ul>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/sketch.png" style="zoom:40%;">
</center>
<center>
Figure 6. ç›¸æœºåœ¨volumeä¸­åæŠ•å½±ç¤ºæ„å›¾1ï¼ˆsketchup 2015ï¼‰
</center>
<p>â€‹ ç”±äºæ¯å¼ å›¾åƒéƒ½ä¼šå½¢æˆä¸€ä¸ªvolumeï¼Œæ¯”å¦‚è“è‰²çš„ä¸ºç›¸æœºäºä½ç½®1å…¨å±€volumeä¸­å¾—åˆ°çš„åæŠ•å½±ï¼Œçº¢è‰²ä¸ºç›¸æœºåœ¨ä½ç½®2ä¸‹äºå…¨å±€volumeä¸­å¾—åˆ°çš„åæŠ•å½±ï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œæˆ‘å°†ä¸¤è€…åˆ†å¼€ï¼ˆå®é™…ä¸Šå…¨å±€åªå­˜åœ¨ä¸€ä¸ªç°è‰²çš„volomeï¼‰ï¼Œä¸¤è€…å åŠ ï¼š</p>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/sk2.png" style="zoom:50%;">
</center>
<center>
Figure 7. ç›¸æœºåœ¨volumeä¸­åæŠ•å½±ç¤ºæ„å›¾2ï¼ˆsketchup 2015ï¼‰
</center>
<p>â€‹ å…¶ä¸­æœ‰äº›éƒ¨åˆ†ä¼šæœ‰å åŠ ï¼Œå¹¶ä¸”å¦‚æœï¼šæŸä¸€éƒ¨åˆ†åœ¨ä½å§¿1ä¸‹è§‚æµ‹åˆ°ï¼ˆåœ¨è“è‰²frustumå†…ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿåœ¨ä½å§¿2ä¸‹è§‚æµ‹åˆ°ï¼ˆçº¢è‰²frustumå†…ï¼‰ï¼Œç”±åŠ æƒrunning averageï¼Œç‰¹å¾ä¼šè¢«ä¿ç•™ï¼Œå¦‚æœæŸäº›ç‰¹å¾åªåœ¨è¾†frustumçš„å¯¹ç§°å·®é›†å†…ï¼ˆåªæœ‰ä¸€ä¸ªä½å§¿æœ‰è§‚æµ‹ï¼‰ï¼Œé‚£ä¹ˆåŠ æƒå¹³å‡å°†ä¼šå¼±åŒ–è¿™äº›ç‰¹å¾çš„å­˜åœ¨æ€§ï¼ˆæ¯•ç«Ÿå¦‚æœåœ¨å¾ˆå¤šå¸§çš„æƒ…å†µä¸‹ï¼ŒæŸä¸ªä½ç½®éƒ½åªè¢«ä¸€ä¸ªä½å§¿è§‚æµ‹åˆ°ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡è¿™ä¸ªä½ç½®è¢«é®æŒ¡äº†æˆ–è€…æ˜¯ä¸€äº›ä¸é‡è¦çš„è§’è½ï¼‰ã€‚æ ¹æ®åŠ æƒå¹³å‡ï¼ˆåŸæ–‡å…¬å¼(3)(4)ï¼‰ï¼Œè§‚æµ‹ç‚¹è¶Šå°‘ï¼Œç‰¹å¾è¶Šä¸æ˜¾è‘—ï¼ˆå¹…å€¼è¶Šæ¥è¿‘0ï¼‰ã€‚</p>
<ul>
<li>ä¸‹ä¸€æ­¥æ˜¯3D encoder-decoderæ¨¡å‹ï¼Œä½¿ç”¨äº†<span class="math inline">\(3\times3\times3\)</span>å·ç§¯ä»¥åŠ<span class="math inline">\(1\times1\times 1\)</span>å·ç§¯ï¼ˆç”¨äºç‰¹å¾ç»´åº¦çš„å˜æ¢ï¼‰ï¼Œå…³äº3Då·ç§¯çš„ä¸€ç‚¹ç‚¹åˆ†æï¼Œè§æ­¤PDFï¼š[TODO]
<ul>
<li>å½¢çŠ¶è¿˜æ˜¯ç±»ä¼¼bottleneck</li>
</ul></li>
<li>ä½œè€…åœ¨æ­¤å¤„ç”¨äº†ä»¥ä¸‹ä¸€äº›æ‰‹æ®µæ¥ä¿è¯è®­ç»ƒçš„æ•ˆæœï¼Œå› ä¸ºè¿™ä¸€éƒ¨åˆ†ç›´æ¥å›å½’TSDFï¼ˆäº‹å…³ç»“æœè´¨é‡ï¼‰ï¼š
<ul>
<li>encoder-decoderæ¨¡å‹ç”±äºæœ‰bottleneckå½¢çŠ¶ï¼Œä¸Šé‡‡æ ·è¿‡ç¨‹ä¸­æ¯å±‚éƒ½ä¼šè¾“å‡ºTSDFï¼Œåœ¨ä¸åŒç²¾ç»†åº¦ä¸‹ä¸ground truthè¿›è¡Œå¯¹æ¯”ç›‘ç£</li>
<li>TSDFä¸­çš„â€œFocal lossâ€ï¼Œç”±äº3Dé‡å»ºä¸­å­˜åœ¨å¤§é‡empty spaceï¼Œå¯¹è®­ç»ƒå…¶å®æ²¡æœ‰å¸®åŠ©ï¼ŒTSDFè·ç¦»å¤§äº0.99è€…è¢«å¼ºåˆ¶è®¾ä¸º1ï¼Œå¹¶ä¸”é˜»æ–­åå‘çš„æ¢¯åº¦æµåŠ¨ï¼Œè¿™æ ·è¿™äº›voxelå¯¹ç»“æœå°†ä¸äº§ç”Ÿå½±å“</li>
<li>æƒ©ç½šå¢™ä¸­å¢™ç­‰ç°è±¡ï¼Œç”±äºé‡åŠ›å­˜åœ¨ï¼Œ3Dé‡å»ºç®€å•åœºæ™¯æ—¶ï¼Œç«–ç›´æ–¹å‘æ˜¯å¯ä»¥æ•´ä½“æ¥çœ‹çš„ï¼Œæ¯”å¦‚å¯¹äºä¸€åº§ç®€å•çš„å±±ï¼ˆæ²¡æœ‰ç©ºæ´ï¼Œæ²¡æœ‰å¤§äºç­‰äº90åº¦çš„å³­å£ï¼‰ï¼Œä¸€æ•´ä¸ªvoxel volumeä¸­ï¼Œå¯¹äºå¹³é¢ä¸Šä»»æ„ç«–åˆ—voxelï¼Œä¸€å®šæ˜¯ä¸‹éƒ¨å­˜åœ¨voxelsï¼ˆå±±ï¼‰ï¼Œä¸Šéƒ¨ä¸å­˜åœ¨ï¼ˆç©ºæ°”ï¼‰ã€‚å¹¶ä¸”ç”±äºTSDFé‡å»ºæ˜¯ç”¨marching cubeså¯»æ‰¾ç­‰åŠ¿é¢ï¼Œé‡å»ºçš„voxelsåªå­˜åœ¨äºè¡¨é¢ï¼Œå†…éƒ¨åº”è¯¥ä¹Ÿä¸ä¼šæœ‰ã€‚æ•…åœ¨è¿™ç§ç®€å•æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œæ¯ä¸€åˆ—å°±ä»…åº”è¯¥å­˜åœ¨ä¸€ä¸ªç‚¹ï¼ˆè¡¨ç¤ºç®€å•å±±è¡¨é¢ï¼‰ã€‚</li>
<li>ä¸Šé¢çš„æ„æ€å°±æ˜¯è¯´ï¼šå¦‚æœåœ¨è¿™åº§å‡æƒ³çš„ç®€å•å±±<strong><u>å†…éƒ¨</u></strong>è¿›è¡Œé‡‡æ ·ï¼Œç”±äºå†…éƒ¨æ˜¯ä¸å­˜åœ¨è¡¨é¢é‡å»ºçš„voxelçš„ï¼ˆç©ºçš„ï¼‰ï¼Œæˆ‘ä»¬çš„é‡å»ºä¸åº”è¯¥åœ¨å¯¹åº”ä½ç½®å¢åŠ ä¸€ä¸ª å¢™ä¸­ç‚¹ã€‚</li>
</ul></li>
</ul>
<blockquote>
<p>However, to prevent the network from hallucinating artifacts behind walls, outside the room, we also mark all the voxels where their entire vertical column is equal to 1 and penalize in these areas too. The intuition for this is that if the entire vertical column was not observed it was probably not within the room.</p>
</blockquote>
<p>â€‹ ä¸è¿‡ç¬”è€…è®¤ä¸ºï¼Œå…³äºâ€œartifacts behind wallsâ€è¿™ä¸€éƒ¨åˆ†ï¼Œä¸ªäººçš„è§£é‡Šè¿˜æœ‰ä¸€å®šé—®é¢˜ï¼ˆæ„Ÿè§‰æœ‰ç‚¹å¼ºè¡Œè§£é‡Šï¼‰ï¼Œè€Œç½‘ç»œä¸Šä¹Ÿæ— æ³•æ‰¾åˆ°å¯¹åº”çš„èµ„æ–™ï¼Œå¦‚æœ‰äººåˆšå¥½è¯»åˆ°æ­¤å¤„å¹¶ä¸”æœ‰è‡ªå·±çš„ç†è§£ï¼Œè¿˜æœ›ä¸åèµæ•™ã€‚</p>
<p>â€‹ æ‰€ä»¥å…¶ä¸­é‡è¦çš„éƒ¨åˆ†æ˜¯ï¼Ÿä¸ªäººè®¤ä¸ºæ˜¯è¿™ä¹ˆä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>2Dç‰¹å¾åæŠ•å½±åŠåŠ æƒå¹³å‡èåˆï¼šè¿™ä¸€æ­¥çœŸæ­£ç”Ÿæˆäº†å¯ç”¨çš„feature volume</li>
<li>3Dç‰¹å¾encoder-decoderï¼šå¯¹äºfeature volumeçš„é‡æ˜ å°„ï¼Œå¹¶ç”Ÿæˆå¤šå°ºåº¦ä¿¡æ¯</li>
</ul>
<p>â€‹ å…¶ä¸­feature volumeç”Ÿæˆæœ‰ç‚¹æ„æ€ï¼Œä½†ä¸ªäººè®¤ä¸ºå¯èƒ½è¿™ç§æ­£å‘çš„ï¼ˆ2D-&gt;3Dï¼‰èµ„æºæ¶ˆè€—æ›´å¤§ï¼Œæ¯•ç«Ÿæ¯å¼ å›¾åƒéƒ½å¯¹åº”äº†ä¸€ä¸ªfeature volumeï¼ˆè™½ç„¶æ˜¯å¢é‡çš„å åŠ ï¼‰ã€‚</p>
<hr>
<h2 id="iv.-nips-2021-transformerfusion">IV. NIPS 2021: TransformerFusion</h2>
<p>â€‹ åœ¨ä¸Šä¸€å°èŠ‚æœ«ï¼Œæˆ‘æåˆ°ï¼š<strong><u>æ­£å‘çš„</u></strong>æ–¹æ³•ï¼Œå…¶å®æˆ‘ä¸ªäººå¹¶æ²¡æœ‰çœ‹å¤šå°‘ç¯‡å¤šè§†è§’3Dé‡å»ºçš„æ–‡ç« ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å¦æœ‰å¯¹åº”æ–¹æ³•çš„åˆ†ç±»ã€‚æ­¤æ–‡çš„ç‰¹ç‚¹å°±æ˜¯ï¼šä½¿ç”¨äº†åå‘çš„æ–¹æ³•ï¼ˆ3D-&gt;2Dï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨äº†transformerï¼ˆä½†ä¸ªäººæ„Ÿè§‰è¿™é‡Œç”¨transformerå¯èƒ½æœ‰äº›ç¼ºç‚¹ï¼Œä¹‹åå†è¯´ï¼‰ã€‚</p>
<p><img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/trans.png"></p>
<center>
Figure 8. TransformerFusionä¸»è¦ç»“æ„
</center>
<p>â€‹ åŸºäºDLçš„æ–¹æ³•å¼€å§‹æ€»æ˜¯ç¦»ä¸å¼€ç‰¹å¾å­¦ä¹ ï¼Œè‡³äºæ€ä¹ˆä½¿ç”¨ï¼Œè¿™æ˜¯ä¸åŒçš„ç½‘ç»œæ¶æ„éœ€è¦è€ƒè™‘çš„äº‹æƒ…ã€‚</p>
<p>â€‹ æ­¤æ–‡å¹¶æ²¡æœ‰ä½¿ç”¨å±‚çº§ï¼Œåªæ˜¯åˆ†æˆäº†coarseä»¥åŠfineä¸¤éƒ¨åˆ†ï¼Œå±‚ä¸å±‚ä¹‹é—´åœ¨å¤„ç†çš„è¾ƒåéƒ¨åˆ†æ‰å­˜åœ¨è”ç³»ã€‚å…¶ä¸­è¦è¯´çš„æ˜¯transformerçš„ <strong><u>åå‘æ³•</u></strong>ã€‚å…³äºæœ¬æ–‡ä½¿ç”¨çš„tricksï¼Œä¸ªäººä¸æƒ³å†å¤šè¯´ï¼Œä»€ä¹ˆfree-space filteringï¼ˆç”¨ç±»ä¼¼äºç¬¬ä¸‰èŠ‚è¯´çš„â€œFocal lossâ€ï¼‰ä»¥åŠrefinement networkï¼Œæ„Ÿè§‰å¤§å¤šæ•°å·¥ä½œéƒ½ä¼šæœ‰ã€‚æœ¬èŠ‚åªæƒ³ç€é‡è®¨è®ºæ­¤æ–‡æ–¹æ³•ä¸ECCV 2020æ–¹æ³•çš„åŒºåˆ«ï¼Œä»¥åŠå…¶transformerçš„ä½¿ç”¨ä¼˜åŠ£ä¹‹å¤„ã€‚</p>
<p>â€‹ ä¸æ­£å‘æ³•ç›¸å¯¹ï¼Œåå‘æ³•å¯¹äºæ¯å¼ å›¾åƒä¸Šçš„ç‰¹å¾å¹¶ä¸ç›´æ¥åæŠ•å½±åˆ°å…¨å±€çš„feature volumeå†è¿›è¡Œæ±‚å’Œï¼ˆå¹³å‡ï¼‰ï¼Œåå‘æ³•å¤„ç†çš„è§†ç‚¹æ˜¯æ¯ä¸€ä¸ª3D voxelã€‚åœ¨ä¸€ä¸ªå…¨å±€volumeä¸­ï¼Œå¯¹äºä¸€ä¸ªç‰¹å®šçš„voxel <span class="math inline">\(v\)</span>ï¼Œæˆ‘åœ¨ä¸åŒçš„å›¾åƒä¸­æŸ¥æ‰¾ï¼š</p>
<ul>
<li>æ­¤voxelåœ¨ç»è¿‡æŠ•å½±åï¼Œæ˜¯å¦è½åœ¨å›¾åƒä¸­ï¼Ÿå¦‚æœä¸å†å°±è·³è¿‡ï¼Œå¦‚æœåœ¨ï¼Œå°†ä¼šé€‰å–æœ¬å›¾åƒæŠ•å½±ç‚¹é™„è¿‘çš„ç‰¹å¾ï¼ˆæ ¹æ®çº¿æ€§æ’å€¼ï¼‰</li>
</ul>
<p>â€‹ æ­£å‘æ³•ä¸­æ˜¯2D-&gt;3Dä¿¡æ¯æµï¼Œä½¿ç”¨åæŠ•å½±æ­£å‘è®¡ç®—ã€‚è€Œåå‘æ³•æ˜¯3D-&gt;2Dçš„ <strong><u>æŸ¥æ‰¾</u></strong> æ–¹å¼ã€‚ä»ä¸ªäººçš„æ„Ÿå—ä¸Šè€Œè¨€ï¼Œç¬”è€…è®¤ä¸ºåå‘æ³•æ›´åŠ ä¼˜é›…ã€‚</p>
<p>â€‹ å¦ä¸€æ–¹é¢ï¼Œtransformerå…·ä½“åšäº†ä»€ä¹ˆï¼Ÿå¯¹äºä»»æ„ä¸€ä¸ªé‡å»ºvoxelï¼Œä¸åŒå›¾åƒæ‹æ‘„å¾—åˆ°çš„ä¿¡æ¯å¯¹æ­¤voxelçš„è´¡çŒ®è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚æˆ‘è¦é‡å»ºä½ çš„é¼»å­ï¼Œé‚£ä¹ˆè·ç¦»è¿‘å¹¶ä¸”è§’åº¦åˆé€‚çš„å›¾åƒå­¦ä¹ çš„ç‰¹å¾å¤§æ¦‚ç‡æ¯”è·ç¦»è¿œæˆ–è§’åº¦ä¸åˆé€‚å›¾åƒäº§ç”Ÿçš„ç‰¹å¾æ›´åŠ æœ‰ä»·å€¼ã€‚<strong><u>ä¸åŒå›¾åƒå¯¹æŸä¸€ç‚¹ç‰¹å¾çš„è´¡çŒ®åº¦</u></strong> å°†ç”±transformeræ¥è¯„å®šã€‚</p>
<p>â€‹ transformerä¸ä»…ä»…è¾“å‡ºã€ç»è¿‡attentionæœºåˆ¶è¯„å®šè´¡çŒ®åº¦ã€‘èåˆçš„å¤šå¼ å›¾åƒç‰¹å¾ï¼Œè¿˜è¾“å‡ºsoftmaxæ—¶çš„æ¦‚ç‡ï¼ˆä¹Ÿå°±æ˜¯æ¯å¼ å›¾åƒçš„è´¡çŒ®weightï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†è¿›è¡Œ <strong><u>è§†è§’é€‰æ‹©ï¼ˆview selectionï¼‰</u></strong>ã€‚çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘æ„Ÿè§‰åˆ°ä¸€é˜µè«åçš„äº²åˆ‡ï¼Œè¿™ä¸å°±æ˜¯2D SLAMé‡Œçš„ç‚¹äº‘èåˆå—ï¼Ÿæ‰€ä»¥è¿™ä¹Ÿæˆäº†æˆ‘è®¤ä¸ºæœ¬æ–‡å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„ã€‚</p>
<h5 id="transformer-pros-cons">Transformer Pros &amp; Cons</h5>
<div class="tabs" id="span-unique"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-1">Pros</a></li><li class="tab"><a href="#span-unique-2">Cons</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-1"><p>â€‹ Transformerç¡®å®åº”è¯¥ç”¨ï¼Œã€è´¡çŒ®ä¸åŒã€‘è¿™ç‚¹ä»ç›´è§‰ä¸Šå°±å¾ˆæ­£ç¡®ï¼Œä¸å…¶ä½¿ç”¨åˆ«çš„æ–¹æ³•è¿›è¡Œå­¦ä¹ ï¼Œä¸å¦‚ç›´æ¥åŠ attentionï¼Œæ­¤å¤„ä¹Ÿéå¸¸é€‚åˆattentionæ“ä½œã€‚ECCV 2020ä¸€æ–‡ä¸­ï¼Œå¯¹äºä¸åŒè§†è§’ä¸‹çš„ç‰¹å¾ï¼Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ†æ€§ï¼Œå¯ä»¥è¯´æ˜¯ä¸€è§†åŒä»ï¼Œå¦‚æœè¦è¯´3D CNNè¿›è¡Œäº†ä¸€äº›å–èˆï¼Œæœªå…æœ‰äº›ç‰µå¼ºã€‚ECCV 2020ä¸­ï¼Œå¦‚ä½•åŒºåˆ†significanceï¼Œæˆäº†éå¸¸é­”æ³•çš„ä¸€éƒ¨åˆ†ã€‚</p></div><div class="tab-pane" id="span-unique-2"><p>â€‹ Transformeræ˜¯<span class="math inline">\(O(n^2)\)</span>çš„ï¼Œå¹¶ä¸”å¦‚æœè¦æ·±ç©¶ï¼Œæ­¤å¤„åº”è¯¥ç”¨Set Transformerè¿™æ ·ç½®æ¢ä¸å˜çš„ç½‘ç»œï¼ˆå¹¶ä¸”äººå®¶Set Transformerè‡³å°‘è¿˜ç”¨induced pointæ–¹æ³•é™ä½äº†å¤æ‚åº¦ï¼‰ã€‚è€Œè‹¥è¦é™åˆ¶å¤æ‚åº¦ï¼Œå°±å¯ä»¥ç”¨ <u><strong>é˜Ÿåˆ—</strong></u> çš„æ–¹å¼ï¼Œæˆ‘åªéœ€è¦ä¿å­˜ä¸è¶…è¿‡<span class="math inline">\(N\)</span>å¼ å›¾ç‰‡ï¼Œç®—æ³•å°±ä¸ä¼šè¶Šè·‘è¶Šæ…¢äº†ã€‚ä½†è¿™å…¶å®ä¹Ÿä¸å¤ªçˆ½ï¼Œå¯¹äºæ¯ä¸€ä¸ªvoxelï¼Œæˆ‘éœ€è¦ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªå°é¡¶å †ã€‚ç”±äºæœ¬ç½‘ç»œè¾“å‡ºæ¯å¼ å›¾åƒçš„weightï¼Œæ ¹æ®weighté€‰æ‹©ï¼Œè¶…å‡ºå †å¤§å°å°±dropå †é¡¶weightæœ€å°çš„å›¾åƒç‰¹å¾ã€‚è¿™æ ·çš„è¯ï¼Œçƒ¦äººçš„å°±æ˜¯ç®¡ç†çš„å¤æ‚åº¦äº†ï¼Œç›¸æ¯”ä¹‹ä¸‹attentionå¤æ‚åº¦å¯èƒ½è¿˜å°äº›ï¼Ÿå¦‚æœè€ƒè™‘ä¸€æ•´ä¸ªfeature volumeï¼Œé‚£ä¹ˆå¤æ‚åº¦å°±æ˜¯<span class="math inline">\(O(n^3N(C+1))\)</span>ï¼Œå…¶ä¸­næ˜¯volumeå¤§å°ï¼Œ<span class="math inline">\(N\)</span>æ˜¯å †å¤§å°ï¼Œ<span class="math inline">\(C\)</span>æ˜¯ç‰¹å¾ç»´åº¦ï¼Œ+1è¡¨ç¤ºéœ€è¦ä¿å­˜weightã€‚</p></div></div></div>
<p>â€‹ ç»¼ä¸Šï¼Œtransformerçš„attentionï¼Œä¸ªäººè§‰å¾—æ˜¯ä¸€ä¸ªå¯ä¿ç•™çš„ç‚¹ï¼Œä½†æ˜¯transformerå¸¦æ¥çš„overheadä¸ªäººæ„Ÿè§‰åˆæ˜¯ä¸€ä¸ªä¸å¯å¿½è§†çš„é—®é¢˜ã€‚è‡³äºæ€ä¹ˆè§£å†³ï¼Œä¸ªäººç²—ç•¥ä¸€æƒ³åªæƒ³åˆ° å¯¹äºfeature volumeè¿›è¡Œpruningï¼ˆä½¿å¾—feature volumeä¸è¦æ˜¯denseçš„ï¼‰ï¼Œæ¯•ç«Ÿ<strong><u>3Dè¡¨é¢é‡å»º</u></strong>ï¼Œ<strong><u>è¡¨é¢è¡¨é¢</u></strong>ï¼Œé‡å»ºçš„æ˜¯3Dç©ºé—´ä¸­çš„2Dæµå½¢ï¼Œå­˜å‚¨å¤æ‚åº¦åœ¨ç†æƒ³æƒ…å†µä¸‹åº”è¯¥æ˜¯<span class="math inline">\(O(n^2)\)</span>çš„ï¼Œé‚£ä¹ˆå¤šç©ºåŒºåŸŸæ‰”ä¸€æ‰”ï¼Œéƒ½ç•™ä¸‹æ¥çš„è¯ï¼Œç®€ç›´å°±æ˜¯åœŸåŒªï¼ŒåœŸåŒªéƒ½ä¸å¦‚ã€‚</p>
<center>
<img src="/2022/02/06/3D-Reconstruction-with-Posed-Mono-cam-Images/disgust.jpeg" style="zoom:80%;">
</center>
<center>
Figure 9. åæ­£é’±è‚¯å®šæ˜¯æŒ£ä¸ç€å•¦
</center>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://www.nowpublishers.com/article/Details/CGV-007">Foundations and TrendsÂ® in Computer Graphics and Vision - Vol 4 - Issue 4: 3D Reconstruction from Multiple Images Part 1: Principles</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>3Dé‡å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>CNN - Capsule Neural Networks</title>
    <url>/2021/02/20/CNN-Capsule-Neural-Networks/</url>
    <content><![CDATA[<h1 id="capsule">Capsule</h1>
<hr>
<h2 id="preface">Preface</h2>
<p>â€‹ Geoffrey Hinton (ä»–çš„å›¢é˜Ÿ ? æŒ‚åè®ºæ–‡ ? ) åœ¨2017å¹´æå‡ºäº†ä¸€ç§æœ‰åˆ«ä¸ä¼ ç»Ÿæ·±åº¦ç½‘ç»œç»“æ„çš„ç½‘ç»œã€‚ç›¸å¯¹äºConvolutionå±‚çº¯å‚æ•°å·ç§¯æ ¸è¡¨ç¤ºï¼ŒCapsuleç½‘ç»œçš„åŸºæœ¬ç»“æ„æ˜¯èƒ¶å›Šï¼Œæ¯ä¸ªèƒ¶å›Šéƒ½æœ‰è¡¨å¾ä¸€å®šçš„ç©ºé—´ç»“æ„çš„èƒ½åŠ›ã€‚ä¸å…¶è¯´æ˜¯èƒ¶å›Šç½‘ç»œï¼Œä¸ªäººå¯¹è¿™ç§ç½‘ç»œç»“æ„çš„ç†è§£æ˜¯ï¼šå‘é‡ç¥ç»ç½‘ç»œã€‚æœ¬æ–‡æ˜¯å¯¹è®ºæ–‡ <strong><em>Dynamic Routing Between Capsules</em></strong> <a href="https://arxiv.org/pdf/1710.09829.pdf">ã€arxivé“¾æ¥ğŸ”—ã€‘</a> çš„æ€»ç»“ï¼Œä¹ŸåŒ…å«äº†å¤ç°è®ºæ–‡ä¸­é‡åˆ°è¿‡çš„é—®é¢˜çš„åˆ†æã€‚</p>
<span id="more"></span>
<hr>
<h2 id="é—®é¢˜ç†è§£">é—®é¢˜ç†è§£</h2>
<p>â€‹ Capsuleç½‘ç»œä¸æ™®é€šç½‘ç»œçš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿæ™®é€šå·ç§¯ç½‘ç»œï¼ˆConvolutionï¼‰æœ€çªå‡ºçš„ç‰¹ç‚¹å°±æ˜¯ï¼Œè‡ªåŠ¨ç‰¹å¾çš„æå–ã€‚ä½†æ˜¯ç”±äºå·ç§¯æ“ä½œçš„ç©ºé—´å¯¹ç§°æ€§ï¼Œå¹¶ä¸”åœ¨å¤šå±‚å·ç§¯åï¼Œç‰¹å¾çš„ç©ºé—´ä½ç½®ä¿¡æ¯å‘ç”ŸæŸå¤±ï¼Œå¯¹äºéœ€è¦æ˜ç¡®ä½ç½®ä¿¡æ¯çš„ç‰¹å¾æ— æ³•å¾ˆå¥½åœ°æå–ã€‚æ¯”å¦‚è¯´ï¼šç»™å®šä¸€å¼ äººè„¸ç…§ç‰‡ï¼Œå¦‚æœäººè„¸ç…§ç‰‡è¢«PSäº†ï¼Œäº”å®˜çš„ç©ºé—´ä½ç½®ååˆ†å¥‡æ€ªï¼š</p>
<p><img src="/2021/02/20/CNN-Capsule-Neural-Networks/lena.png"></p>
<center>
Figure 1. æƒŠæ‚šçš„Lenaç…§ç‰‡
</center>
<p>â€‹ å¯¹äºç¬¬äºŒå¼ å›¾åƒï¼Œç½‘ç»œæœ‰å¯èƒ½å°†å…¶åˆ†ç±»ä¸ºâ€œäººâ€ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æ˜¯æ€ªç‰©ã€‚è€Œç¬¬ä¸‰ç« å›¾åƒï¼Œåªä¸è¿‡ç»è¿‡äº†ä¸€ä¸ªæ—‹è½¬ï¼Œæœ€åçš„åˆ†ç±»ç»“æœä¹Ÿå¯èƒ½å¹¶ä¸æ˜¯â€œäººâ€ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨å·ç§¯çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä»ç„¶ä¿ç•™ç›¸å¯¹ä½ç½®ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³è®©æ•´ä¸ªç½‘ç»œå˜æˆR-CNNä¸€æ ·çš„å¤æ‚object detectionç»“æ„ã€‚</p>
<p>â€‹ Capsuleç»“æ„å°±æ˜¯ä¸ºäº†è§£å†³ç©ºé—´ä½ç½®ä¿¡æ¯é—®é¢˜æå‡ºçš„ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šCapsuleç»“æ„å¯ä»¥å°†å›¾åƒä¸­çš„ä¸€ä¸ªç‰©ä½“åˆ†è§£ï¼Œåˆ†è§£æˆä¸åŒçš„å­ç»“æ„ï¼Œè€Œå­ç»“æ„åˆå¯ä»¥ç”±æ›´åŠ ä½çº§çš„å­ç‰¹å¾é€šè¿‡ç©ºé—´å˜æ¢ç»„åˆå¾—åˆ°ã€‚</p>
<p><img src="/2021/02/20/CNN-Capsule-Neural-Networks/comp.JPG"></p>
<center>
Figure 2. ç‰¹å¾ç»„åˆ
</center>
<p>â€‹ ä¹ä¸€çœ‹ï¼Œå’Œå·ç§¯ç½‘ç»œè²Œä¼¼å¾ˆç±»ä¼¼ï¼Œå·ç§¯ä¹Ÿæ˜¯ä½çº§ç‰¹å¾èåˆåˆ°é«˜çº§ç‰¹å¾å›¾ä¸­ã€‚ä½†Capsule ç‰¹å¾ç»„åˆä¾é çš„å¹¶ä¸æ˜¯activationå‡½æ•°è¿›è¡Œç‰¹å¾èåˆï¼Œå…¶ä¾é çš„æ˜¯â€œåŠ¨æ€è·¯ç”±â€æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨capsule">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Capsule</h2>
<h3 id="capsuleè§£å†³çš„é—®é¢˜">Capsuleè§£å†³çš„é—®é¢˜</h3>
<p>â€‹ ä½œè€…åœ¨æ–‡ç« ä¸­æåˆ°ï¼šåŸºäºHMM-GMMçš„è¯­éŸ³è¯†åˆ«æ–¹æ³•åœ¨ç¥ç»ç½‘ç»œæ™®é€‚ä¹‹å‰ä¸€ç›´æ˜¯SOTAæ–¹æ³•ï¼Œä½†æ˜¯å…¶è‡´å‘½ç¼ºé™·æ˜¯éœ€è¦çš„å†…å­˜ç©ºé—´å¤ªå¤§ï¼ˆå†…å­˜å¼€é”€æ˜¯å¹³æ–¹çº§åˆ«çš„å¤æ‚åº¦ï¼‰ã€‚RNNç½‘ç»œå¯¹äºå†…å­˜çš„å¼€é”€åˆ™æ˜¯çº¿æ€§å¢é•¿çº§åˆ«çš„ï¼Œç»“æœä¼šå¥½å¾ˆå¤šã€‚</p>
<p>â€‹ CNNç›¸å¯¹äºå…¨è¿æ¥å±‚ä¹Ÿå­˜åœ¨è¿™æ ·çš„å†…å­˜å¼€é”€ä¼˜åŠ¿ï¼šä¸åŒä½ç½®çš„å‚æ•°æ˜¯å…±äº«çš„ã€‚ä½†æ˜¯åœ¨å¤„ç†å­˜åœ¨æœ‰ç‰¹å¾çš„ç©ºé—´å˜æ¢ï¼ˆå¹³ç§»æ—‹è½¬ï¼‰æ—¶ï¼ŒCNNéœ€è¦æœ‰å‚æ•°çš„å¹³ç§»å‰¯æœ¬ï¼Œæ‰èƒ½å®ç°å¯¹ä¸åŒä½ç½®çš„åŒä¸€ç‰¹å¾è¿›è¡Œè¯†åˆ«ã€‚è¿™è®©æˆ‘æƒ³èµ·äº†KCFçš„å¹³ç§»æ ·æœ¬ç”Ÿæˆã€‚KCFåœ¨è®­ç»ƒæ—¶ï¼Œä¼šå°†é€‰ä¸­ç›®æ ‡çš„éƒ¨åˆ†è¿›è¡Œå¤§é‡å¹³ç§»ï¼Œä»¥è·å¾—è¶³å¤Ÿçš„å¤šçš„è®­ç»ƒæ ·æœ¬ã€‚ä¹Ÿå°±æ˜¯ç”¨å†…å­˜æ¢å–è®­ç»ƒç»“æœäº†ï¼Œä¹Ÿè®¸è¿™åœ¨è®­ç»ƒæ ·æœ¬æå…¶å¤šæ—¶ä¸åˆ©äºè®­ç»ƒï¼Œå¹¶ä¸”éšç€é—®é¢˜è§„æ¨¡çš„å˜å¤§ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿå¹¶ä¸å¥½ã€‚å¹¶ä¸”CNNè¿™ç§é‡‡ç”¨å‚æ•°å¹³ç§»å‰¯æœ¬è¯†åˆ«ä¸åŒä½ç½®çš„ç‰¹å¾çš„æ–¹å¼ï¼Œéå¸¸ä¸ç¬¦åˆç”Ÿç‰©è§†è§‰åŸç†ã€‚ä½œè€…åœ¨æ–‡ä¸­å¼€å§‹å°±æåˆ°ï¼š</p>
<blockquote>
<p>Human vision ignores irrelevant details by using a carefully determined sequence of fifixation points to ensure that only a tiny fraction of the optic array is ever processed at the highest resolution.</p>
</blockquote>
<p>â€‹ å¤„ç†è§†è§‰ç‰¹å¾çš„æ—¶å€™ï¼Œåº”è¯¥ä½¿ç”¨ä¸€å®šçš„Attentionæœºåˆ¶ï¼Œä½¿ç”¨éå¤åˆ¶çš„å‚æ•°ï¼Œè·å¾—å›¾ä¸Šçš„ç‰¹å¾ï¼Œå¹¶ä½¿ç”¨ç®€å•çš„ä½ç½®è¡¨ç¤ºï¼Œåº”è¯¥æ˜¯<strong><u>è·å–ç‰¹å¾çš„ç§»åŠ¨ä½ç½®</u></strong>è€Œé<strong><u>ç§»åŠ¨ï¼ˆå¼ï¼‰è·å–ç‰¹å¾çš„ä½ç½®</u></strong>ã€‚è¿™ç§å¤åˆ¶æ–¹æ³•ï¼Œå¿…ç„¶å¯¼è‡´å‚æ•°å ç”¨å†…å­˜çš„å¢åŠ ã€‚CNNèƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†å¹³ç§»ç‰¹å¾ï¼ˆå› ä¸ºå·ç§¯çš„æ»‘åŠ¨çª—å£ç‰¹æ€§ï¼‰ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–çš„Affine Transformationï¼ˆä»¿å°„å˜æ¢ï¼‰ï¼Œå¤„ç†èƒ½åŠ›è¾ƒå·®ã€‚Capsuleæœ¬èº«å°±æ˜¯å¸¦æœ‰ç©ºé—´ä½å§¿è¡¨å¾çš„ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æŒ‡æ•°æ€§çš„å‚æ•°å†…å­˜æ¶ˆè€—ã€‚</p>
<h3 id="capsuleçš„å¤„ç†åŸç†">Capsuleçš„å¤„ç†åŸç†</h3>
<p>â€‹ åœ¨Prefaceç§è¯´åˆ°ï¼ŒCapsuleç½‘ç»œå®é™…ä¸Šæ˜¯å‘é‡ç¥ç»ç½‘ç»œã€‚ä¸ä¸€èˆ¬çš„æ ‡é‡ç½‘ç»œä¸åŒï¼ŒCapsuleç½‘ç»œæ¯ä¸ªè¾“å‡ºéƒ½æ˜¯å‘é‡ï¼Œå¹¶ä¸”å‘é‡å­˜åœ¨å…¶ç‰¹å®šçš„æ„ä¹‰ï¼š</p>
<ul>
<li>å‘é‡çš„æ–¹å‘ä»£è¡¨äº†å…¶å±æ€§ã€‚å¯ä»¥å°†å±æ€§ç©ºé—´æ¯ä¸ªå•ç‹¬çš„ç»´åº¦ç†è§£ä¸ºä¸€ä¸ªåæ ‡è½´ï¼Œåœ¨æŸä¸ªæ–¹å‘çš„åˆ†é‡å¤§å°ä»£è¡¨äº†æ­¤å±æ€§çš„å¼ºåº¦ï¼ˆæ¯”å¦‚åå°„ç‡ / intensity / æ–œåº¦ç­‰ç­‰ï¼‰ã€‚ä¹Ÿå³æ­¤å‘é‡ä»£è¡¨äº†å…¶åœ¨å‚æ•°ç©ºé—´ä¸­çš„ä½ç½®ã€‚</li>
<li>å‘é‡çš„æ¨¡é•¿ä»£è¡¨äº†æ¦‚ç‡ã€‚åæ˜ çš„æ˜¯æ²¿ç€æŸä¸€æ–¹å‘çš„ç‰¹å¾å‘é‡å­˜åœ¨çš„æ¦‚ç‡ã€‚ä¸€ä¸ªCapsuleå±‚ä¸Šçš„æ‰€æœ‰èƒ¶å›Šå¯èƒ½å¯¹æŸä¸ªç‰¹å¾äº§ç”Ÿä¸åŒçš„æ„è§ï¼Œç»„åˆç‰¹å¾æ—¶å¸Œæœ›èƒ½è®©æ„è§ä¸€è‡´çš„æ¦‚ç‡æœ€å¤§ï¼ˆRouting by agreementï¼‰ã€‚</li>
</ul>
<p>â€‹ æ¯ä¸ªCapsuleè¡¨ç¤ºçš„å‘é‡éƒ½æ˜¯ä¸€ä¸ªä¸ªçš„â€œinstantiated parameterâ€ï¼Œè¡¨å¾äº†ä¸€ä¸ªä¸ªå°ç»„ä»¶ï¼ˆä¹Ÿè®¸è¿™æ ·çš„å°ç»„ä»¶æ²¡æœ‰CNNæŠ½å–å‡ºæ¥çš„ç‰¹å¾é‚£ä¹ˆæŠ½è±¡ï¼‰ã€‚ç”±äºç‰¹å¾æ˜¯ä¸æ–­èåˆçš„ï¼Œåº•å±‚ç‰¹å¾æŠ½å–å°†ä¼šæŠ½å–å‡ºæå…¶å¤šçš„å°å‹ç‰¹å¾ã€‚æ¯ä¸€å±‚Capsuleç½‘ç»œéƒ½æ˜¯å¯¹ä¸Šä¸€å±‚capsuleçš„èåˆï¼Œç¬¬kå±‚çš„capsuleè¾“å‡ºéœ€è¦ç»è¿‡ä¸€ä¸ªæŠ•ç¥¨æœºåˆ¶ï¼Œæ‰èƒ½è¢«èåˆåˆ°1ç¬¬k+1å±‚çš„ç½‘ç»œä¸­å»ã€‚å½“ç¬¬k+1å±‚ç½‘ç»œå­˜åœ¨è¾“å‡ºåï¼Œä»ç¬¬kå±‚ç½‘ç»œé€‰å–å‡ºä¸ç¬¬k+1å±‚æŸä¸ªcapsuleè¾“å‡ºæœ€ç±»ä¼¼çš„ä¸€ä¸ªä½å±‚capsuleï¼Œå¢å¤§å…¶å¯¹åº”æƒé‡ã€‚</p>
<hr>
<h2 id="ç½‘ç»œç»“æ„ä¸è®¡ç®—ç»†èŠ‚">ç½‘ç»œç»“æ„ä¸è®¡ç®—ç»†èŠ‚</h2>
<h3 id="å‘é‡å¤„ç†---è·¯ç”±åŸç†">å‘é‡å¤„ç† - è·¯ç”±åŸç†</h3>
<p>â€‹ æ¿€æ´»å‡½æ•°å¹¶æ²¡æœ‰è¢«å¤§é‡ä½¿ç”¨åœ¨Capsuleç½‘ç»œä¸­ï¼Œç”±äºå‘é‡ç½‘ç»œå¹¶ä¸æ–¹ä¾¿ä½¿ç”¨activationï¼Œè€Œä¸”ä¸€èˆ¬æ¿€æ´»å‡½æ•°å¹¶ä¸èƒ½æ»¡è¶³ä¸Šä¸€èŠ‚æåˆ°çš„ï¼šæ¨¡é•¿çš„æ¦‚ç‡è¡¨å¾ç‰¹æ€§ã€‚åœ¨æ­¤å¤„ï¼Œä½œè€…è®¾è®¡äº†ä¸€ä¸ªè¿™æ ·çš„å½’ä¸€åŒ–å‡½æ•°ï¼Œè¢«ç§°ä½œ â€œ<strong><em>squash</em></strong>â€ï¼š <span class="math display">\[
\begin{equation}\label{equ:squash}
\mathbf{v}_{j} = \frac{\Vert \mathbf{s}_j\Vert^2}{1 +\Vert \mathbf{s}_j\Vert^2}\frac{\mathbf{s}_j}{\Vert \mathbf{s}_j\Vert}
\end{equation}
\]</span> â€‹ ä½¿ç”¨æ­¤å½’ä¸€åŒ–æ–¹æ³•ï¼Œä¸ä»…å¯ä»¥è¿›è¡Œé•¿åº¦å½’ä¸€ï¼Œå®é™…å¯¹æ¨¡é•¿å¾ˆçŸ­çš„å‘é‡å­˜åœ¨æ›´å¤§çš„éçº¿æ€§æƒ©ç½šã€‚å‡è®¾ç¬¬kå±‚ç½‘ç»œå­˜åœ¨nä¸ªcapsule filterï¼Œç¬¬k+1å±‚å­˜åœ¨mä¸ªcapsule filterã€‚é‚£ä¹ˆ<span class="math inline">\(\mathbb{u_{i}}\)</span>å°±æ˜¯ç¬¬kå±‚ä¸­ç¬¬iä¸ªfilterçš„è¾“å‡ºå‘é‡ï¼Œä»ç¬¬kå±‚ç¬¬iä¸ªç»“æ„åˆ°ç¬¬k+1å±‚ç¬¬jä¸ªç»“æ„çš„è¾“å‡ºå¯ä»¥ä½¿ç”¨weight matrixæ˜ å°„ï¼š <span class="math display">\[
\mathbf{\hat{u}}_{j|i}=\mathbf{W}_{ij}\mathbf{u}_i
\]</span> â€‹ <span class="math inline">\(\mathbf{W}_{ij}\)</span>ç”¨äºç»´æ•°å˜æ¢ï¼Œå¹¶ä¸”éœ€è¦ç»¼åˆä¸åŒçš„è¾“å…¥å¾—åˆ°ä¸‹ä¸€å±‚æŸä¸ªcapsuleçš„è¾“å…¥ã€‚æ¯”å¦‚æœ¬æ–‡ä¸­ï¼Œ<span class="math inline">\(\mathbf{W}_{ij}\)</span>å°±æ˜¯8 * 16çš„çŸ©é˜µã€‚<span class="math inline">\(\mathbf{\hat{u}}_{j|i}\)</span>ç›¸å½“äºè®¡ç®—å‡ºçš„å…ˆéªŒï¼ˆä¸Šå±‚ié€åˆ°æœ¬å±‚jçš„ä¸€ä¸ªç‰¹å¾å‘é‡ï¼‰ã€‚é‚£ä¹ˆï¼š <span class="math display">\[
\begin{equation}\label{equ:possi}
\mathbf{s}_{j}=\sum_{i=1}^{n}c_{ij}\mathbf{\hat{u}}_{j|i}
\end{equation}
\]</span> â€‹ å°±æ˜¯ç»¼åˆæ‰€æœ‰ä¸Šä¸€å±‚çš„è¾“å‡ºï¼Œå¾—åˆ°æœ¬å±‚ç¬¬jä¸ªcapsuleçš„è¾“å…¥ï¼Œä½¿ç”¨<span class="math inline">\(\eqref{equ:squash}\)</span>è¿›è¡Œéçº¿æ€§å½’ä¸€åŒ–å¾—åˆ°<span class="math inline">\(\mathbf{v}_{j}\)</span>ã€‚<span class="math inline">\(c_{ij}\)</span>æ˜¯æ¦‚ç‡åŠ æƒå› å­ï¼Œæ˜¯ç”±<span class="math inline">\(b_{ij}\)</span>ï¼ˆä¸€ä¸ªlogitå€¼ï¼‰ç»è¿‡softmaxå¾—åˆ°çš„æ¦‚ç‡ã€‚</p>
<h3 id="åŠ¨æ€è·¯ç”±è¿‡ç¨‹">åŠ¨æ€è·¯ç”±è¿‡ç¨‹</h3>
<h4 id="å†…ç§¯---æŠ•ç¥¨agreement">å†…ç§¯ - æŠ•ç¥¨ï¼ˆAgreementï¼‰</h4>
<p>â€‹ åŠ¨æ€è·¯ç”±éƒ¨åˆ†åŒ…å«äº†æ¿€æ´»å‡½æ•°çš„ä½œç”¨ï¼Œå¹¶ä¸”åœ¨æ­¤å¤„å–ä»£äº†normalizationçš„ä½œç”¨ã€‚åŠ¨æ€è·¯ç”±ä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—<span class="math inline">\(\mathbf{v}_{j}\)</span>ï¼Œé€šè¿‡è¿­ä»£çš„æ–¹å¼æ±‚å‡ºæ¦‚ç‡åŠ æƒå› å­ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°å­¦æ€§çš„æŠ•ç¥¨è¿‡ç¨‹ã€‚å¼€å§‹ç”Ÿæˆçš„<span class="math inline">\(b_{ij}\)</span>éƒ½æ˜¯0ï¼Œsoftmaxåï¼Œæ‰€æœ‰çš„è¾“å‡ºè·¯å¾„æ¦‚ç‡éƒ½æ˜¯ç›¸åŒçš„ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰ã€‚æ¯ä¸€ä¸ªèƒ¶å›Šçš„è¾“å‡ºéƒ½ç›¸å½“äºæ˜¯ä¸€ä¸ªå¸¦æ¦‚ç‡ï¼ˆæ¨¡é•¿ï¼‰çš„ç‰¹å¾å‘é‡predictionã€‚æ‰€æœ‰çš„ï¼ˆweight matrixæ˜ å°„çš„ï¼‰çš„ç»„åˆï¼ˆæ¦‚ç‡åŠ æƒï¼‰å°±æ˜¯æŸä¸ªé«˜å±‚capsuleçš„è¾“å…¥ï¼Œé«˜å±‚è¾“å‡ºä¸€ä¸ªå½’ä¸€åŒ–åçš„å‘é‡ã€‚è¿™ä¸ªå‘é‡åªéœ€è¦ä¸ä½å±‚çš„è¾“å‡ºå‘é‡è¿›è¡Œå†…ç§¯å³å¯ï¼Œå†…ç§¯ç»“æœå¤§ï¼Œè¡¨ç¤ºä½å±‚çš„è¾“å‡ºä¸é«˜å±‚çš„è¾“å‡ºè¾ƒä¸ºç¬¦åˆï¼ˆä¸¤ä¸ªè¾“å‡ºå‘é‡çš„æ–¹å‘è¾ƒä¸ºä¸€è‡´ï¼‰ï¼Œå°†ä¼šå“åº”å¢å¼ºå¯¹åº”çš„è·¯ç”±è·¯å¾„ã€‚</p>
<p><img src="/2021/02/20/CNN-Capsule-Neural-Networks/vote.JPG"></p>
<center>
Figure 3. åŸºäºå†…ç§¯çš„æŠ•ç¥¨
</center>
<p>â€‹ æ ¹æ®å‡ æ¬¡è¿­ä»£å°±å¯ä»¥ç¡®å®šä½å±‚/é«˜å±‚çš„è¾“å‡ºä¸€è‡´æ€§å…³ç³»ã€‚</p>
<h4 id="ç®—æ³•æµç¨‹ç†è§£">ç®—æ³•æµç¨‹ç†è§£</h4>
<p>â€‹ æ•´ä¸ªåŠ¨æ€è·¯ç”±ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2021/02/20/CNN-Capsule-Neural-Networks/routing.JPG"></p>
<center>
Figure 4. åŠ¨æ€è·¯ç”±ç®—æ³•æµç¨‹
</center>
<p><strong>ç¿»è¯‘ä¸ç†è§£ï¼š</strong></p>
<ul>
<li>åˆå§‹åŒ–logitå€¼ ä¸º0ï¼Œä½¿å¾—åˆå§‹çš„routingè·¯å¾„æ¦‚ç‡åˆ†å¸ƒä¸ºå‡åŒ€åˆ†å¸ƒã€‚é»˜è®¤å·²ç»è·å¾—äº†ç»è¿‡weight matrixå˜æ¢çš„å…ˆéªŒè¾“å‡ºå‘é‡ã€‚</li>
<li>å¼€å§‹è¿­ä»£ï¼ˆè¿­ä»£æ¬¡æ•°ä¸ºrï¼Œè®ºæ–‡ä¸­r = 3ï¼‰
<ul>
<li>softmax å°†logitå˜æ¢ä¸ºï¼š<span class="math inline">\(c_{i}\)</span>ï¼Œè½¬æ¢æˆç¬¦åˆæ¦‚ç‡å®šä¹‰çš„å€¼ã€‚</li>
<li>è®¡ç®—æœ¬å±‚çš„åŠ æƒè¾“å…¥ï¼šä¹Ÿå°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{equ:possi}\)</span>ã€‚è®¡ç®—æ‰€æœ‰ä½å±‚predictionå¯¹åº”çš„é«˜å±‚predictionã€‚</li>
<li>squashæ“ä½œï¼Œéçº¿æ€§å½’ä¸€åŒ–ã€‚ç”±äºå†…ç§¯éœ€è¦è½¬æ¢æˆæ¦‚ç‡ï¼Œéœ€è¦squashè®©æ¨¡é•¿å°äº1ã€‚</li>
<li>æ ¹æ®ä¸¤å±‚çš„è¾“å‡ºè®¡ç®—å†…ç§¯ï¼Œå¾—åˆ°logitsæ›´æ–°å€¼ã€‚</li>
</ul></li>
</ul>
<p>â€‹ æ³¨æ„ï¼Œåªæœ‰ä¸¤ä¸ªè¿ç»­çš„capsuleå±‚æ‰ä¼šå­˜åœ¨åŠ¨æ€è·¯ç”±ã€‚ç”±äºåŠ¨æ€è·¯ç”±æ˜¯å¯¹ä½å±‚ / é«˜å±‚capsuleè¿æ¥ç‰¹æ€§çš„å»ºæ¨¡ï¼Œä½å±‚predictionä¸é«˜å±‚predictionç›¸ç¬¦æ—¶ï¼Œä½å±‚capsuleæ›´æœ‰å¯èƒ½ä¸ç›¸åº”é«˜å±‚capsuleç›¸è¿ã€‚</p>
<h3 id="lossè®¾è®¡">lossè®¾è®¡</h3>
<p>â€‹ Capsuleç½‘ç»œåœ¨è®¾è®¡æ—¶ï¼Œè®¾è®¡è€…ä¸ºäº†è®©å…¶æ‹¥æœ‰åŒæ—¶åŒºåˆ†å›¾ä¸Šå¤šä¸ªæ•°å­—çš„èƒ½åŠ›ï¼Œæ•°å­—labelä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º10çš„å‘é‡è¡¨ç¤ºï¼ˆç±»ä¼¼one-hotï¼‰ï¼Œpredictionä¸­ï¼Œæ¯ä¸ªä½ç½®å­˜åˆ†ç±»ä¸ºå¯¹åº”å€¼çš„æ¦‚ç‡ã€‚ä½¿ç”¨çš„æ˜¯margin lossï¼ˆSVMå¤šåˆ†ç±»é—®é¢˜ä½¿ç”¨çš„å°±æ˜¯margin lossï¼‰ï¼Œç”±äºé¼“åŠ±å›¾åƒå¤šåˆ†ç±»è¾“å‡ºï¼Œmargin loss é¼“åŠ±è¾“å‡ºåœ¨0.9ï¼ˆæ­£ç±»ï¼‰ä»¥åŠ0.1ï¼ˆè´Ÿç±»ï¼‰é™„è¿‘ï¼Œåˆ†ç±»ä½¿ç”¨çš„margin loss objectiveä¸ºï¼š <span class="math display">\[
\begin{equation}\label{equ:margin}
L_k=T_k\;max(0, m^{+} - \Vert\mathbf{v}_k\Vert)^2+\lambda(1-T_k)min(0, m^{-} - \Vert\mathbf{v}_k\Vert)^2
\end{equation}
\]</span> â€‹ æä¾›labelæ—¶ï¼Œå¦‚æœå›¾åƒä¸­çš„æ•°å­—æ˜¯å¯¹åº”class kï¼Œé‚£ä¹ˆ<span class="math inline">\(T_k = 1\)</span>ï¼Œå¦åˆ™ä¸º0ã€‚å¯ä»¥çœ‹å‡ºï¼Œ<span class="math inline">\(T_k\)</span>ä¸åŒæƒ…å†µä¸‹ï¼š</p>
<ul>
<li><span class="math inline">\(T_k\)</span>ä¸º1æ—¶ï¼Œ<span class="math inline">\(L_k=T_k\;max(0, m^{+} - \Vert\mathbf{v}_k\Vert)^2\)</span>ï¼Œéœ€è¦è®©è¾“å‡ºçš„æ¦‚ç‡å¤§æ¦‚ä¸º0.9ï¼ˆ<span class="math inline">\(m^+\)</span>=0.9ï¼‰</li>
<li>åä¹‹ï¼Œ<span class="math inline">\(L_k=\lambda(1-T_k)min(0, m^{-} - \Vert\mathbf{v}_k\Vert)^2\)</span>ï¼Œè´Ÿç±»å¹¶ä¸è¦æ±‚æ¦‚ç‡å®Œå…¨ä¸º0ã€‚ä¸ºäº†å¤šæ•°å­—åˆ¤å®šã€‚(<span class="math inline">\(m^{-}\)</span>=0.1)ï¼ŒÎ»=0.5ï¼ˆå½±å“å‰Šå¼±ï¼‰</li>
</ul>
<p>â€‹ ç”±äºè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åˆ†ç±»é—®é¢˜ï¼Œè¾“å‡ºä¼šç”¨ä¸€ä¸ªå‘é‡è¡¨å¾ï¼ˆé•¿åº¦ä¸º16ï¼‰ã€‚é‚£ä¹ˆä½œè€…å¸Œæœ›ï¼Œé€šè¿‡16ç»´çš„ç‰¹å¾å‘é‡å¯ä»¥é‡å»ºå‡ºåŸæ¥çš„æ•°å­—ã€‚ä½œè€…ä½¿ç”¨äº†å…¨è¿æ¥ç½‘ç»œä½œä¸ºdecoderï¼š</p>
<p><img src="/2021/02/20/CNN-Capsule-Neural-Networks/fc.JPG"></p>
<center>
Figure 5. æ–‡ä¸­ä½¿ç”¨çš„å…¨è¿æ¥decoder
</center>
<p>â€‹ è¾“å…¥å±‚æ˜¯160ç»´çš„ï¼Œä½†æˆ‘å¯¹è¿™ä¸ªçš„ç†è§£æ˜¯ï¼šdigitCapså­˜åœ¨maskï¼Œéé¢„æµ‹å€¼çš„æ•°å­—å°†ä¼šè¢«ä¹˜ä»¥0ã€‚é‚£ä¹ˆ160ç»´çš„è¾“å…¥æ„ä¹‰åœ¨å“ªï¼Ÿä¸ºä»€ä¹ˆä¸ä½¿ç”¨16ç»´ä½œä¸ºè¾“å…¥å‘¢ï¼Ÿ</p>
<p>â€‹ ä¸è®¨è®ºè¿™ä¸ªè®¾è®¡é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œreconstructionä¼šå¼•å…¥lossï¼ˆéœ€è¦è®©ï¼‰ï¼Œç›¸å½“äºcapsuleNNæå–äº†å›¾åƒçš„ä¸»è¦ç‰¹å¾ï¼ˆPCAç±»ä¼¼ï¼Œåªç”¨å‡ ä¸ªä¸»è¦ç‰¹å¾å€¼æ¢å¤å›¾åƒï¼‰ï¼Œä½†ç»“æœä¸åŸå›¾åº”è¯¥å°½é‡æ¥è¿‘ã€‚ï¼ˆè¿™åœ¨CycleGANä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œï¼Œä¸è¿‡å¯¹åº”çš„æ˜¯Cycle Consistency Lossï¼‰ã€‚Full objective: <span class="math display">\[
L_{full}=\sum L_k+0.0005 \times L_{reconstruct}
\]</span> â€‹ ä¸ºäº†ä¸è®©reconstruction lossé€ æˆçš„ä¼˜åŒ–å½±å“è¿‡å¤§ï¼Œéœ€è¦å°†å…¶scaleåˆ°ä¸€ä¸ªè¾ƒå°çš„å€¼ä¸Šã€‚</p>
<hr>
<h2 id="å¤ç°-é—®é¢˜">å¤ç° &amp; é—®é¢˜</h2>
<p>â€‹ å®ç°CapsNeté‡åˆ°äº†æ¯”è¾ƒå¤§çš„å›°éš¾ï¼Œå‘ç°è‡ªå·±ä¹‹å‰å®ç°çš„é‚£äº›ç½‘ç»œéƒ½æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦ç”¨åˆ°å¤ªå¤šçš„Pytorch tensorç‰¹æ€§æˆ–æ˜¯torchçš„APIã€‚äºæ˜¯åœ¨æœ¬æ¬¡å¤ç°è®ºæ–‡æ—¶ï¼Œå‘ç°åœ¨minibatchæƒ…å½¢ï¼ˆé«˜ç»´çŸ©é˜µè®¡ç®—ï¼‰ä¸‹ï¼Œè‡ªå·±æ˜ç™½é€»è¾‘ï¼Œä½†æ˜¯ä¸çŸ¥å¦‚ä½•ä½¿ç”¨Pytorchå®ŒæˆçŸ©é˜µè®¡ç®—ã€‚æ˜¾ç„¶ï¼Œå°†sampleä¸€ä¸ªä¸ªè®¡ç®— / ä¸€ç»´ä¸€ç»´è®¡ç®—æ˜¯å¯ä»¥å®Œæˆç®—æ³•çš„é€»è¾‘çš„ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li>slice / indexæ“ä½œ / åˆ†ç»´åº¦è®¡ç®—ï¼ˆå°å—çŸ©é˜µè¿ç®—ï¼‰å®¹æ˜“å¯¼è‡´ä½ä¸‹çš„æ•ˆç‡ä»¥åŠå†…å­˜çš„æ¶ˆè€—</li>
<li>ä»£ç å˜å¾—è‡ƒè‚¿ï¼Œä¸ç¬¦åˆå¤šç»´çŸ©é˜µçš„APIè®¾è®¡åˆè¡·</li>
</ul>
<p>â€‹ å¤ç°å°è¯•äº†å®ç°ç½‘ç»œç»“æ„ï¼Œä½†æ˜¯æ¯”è¾ƒå¤±è´¥ï¼ˆæˆ‘å¤ªèœäº†ï¼‰ã€‚æœ€åæˆ‘å­¦ä¹ äº†ä¸€ä¸‹åˆ«äººçš„å®ç°ï¼Œå¯¹ä»£ç è¿›è¡Œäº†ç»†è‡´çš„æ³¨é‡Šï¼š<a href="https://github.com/gram-ai/capsule-networks">[Github RepositoryğŸ”—:gram-ai/ capsule-networks]</a></p>
<h3 id="å®ç°ä¸Šçš„ä¸€äº›ç‚¹">å®ç°ä¸Šçš„ä¸€äº›ç‚¹</h3>
<p>â€‹ åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸»è¦æ˜¯Capsule Layerçš„å®ç°æ¯”è¾ƒå›°éš¾ï¼š</p>
<ul>
<li>nn.ModuleListä¿å­˜èƒ¶å›Šå±‚çš„ç»“æ„ï¼Œæ¯”å¦‚ä¿å­˜8ä¸ªç›¸åŒçš„Conv2d Filterã€‚å¯¹åŒä¸€è¾“å…¥å¤„ç†8æ¬¡ï¼Œå†ä½¿ç”¨catæ–¹æ³•è¿æ¥ï¼Œäº§ç”Ÿå‘é‡è¾“å‡ºã€‚</li>
<li>nn.Parameter ç”¨äº weight matrixçš„å®ç°ã€‚ä½†æˆ‘å¯¹è¿™ä¸ªç¯èŠ‚äº§ç”Ÿäº†<a href="#thinking">ä¸€äº›çœ‹æ³•</a>ã€‚
<ul>
<li>ä»¥ä¸Šè¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥è‡ªåŠ¨å°†å‚æ•°åŠ å…¥ç»§æ‰¿äº†nn.Moduleçš„ç±»çš„<code>.parameter()</code>ä¸­</li>
</ul></li>
<li>é«˜ç»´çŸ©é˜µè¿ç®— ä¸çŸ¥å¦‚ä½•è¿›è¡Œï¼ˆå¼€å§‹ç»ƒè¿ç®—è§„åˆ™éƒ½ä¸çŸ¥é“ï¼‰
<ul>
<li>è¾“å…¥å·ç§¯å±‚çš„è¾“å‡ºç»“æœä¸ºï¼š(n, 256, 20, 20)ï¼Œnä¸ºbatch size</li>
<li>PrimaryCapsæ¯ä¸ªèƒ¶å›Šè¾“å‡ºçš„ç»“æœåº”è¯¥æ˜¯ï¼š(n, 32, 6, 6, 1)ã€‚æ¯ä¸ªè¾“å‡ºéœ€è¦è¿›è¡Œravelï¼ˆä¸åŒçš„é€šé“ï¼Œæ¯ä¸ªé€šé“å†…çš„6 * 6è¾“å‡ºï¼‰ï¼Œå¾—åˆ°(n, 1152, 1) catä¹‹åå¾—åˆ°(n, 1152, 8)</li>
<li>PrimaryCaps ç»è¿‡weight matrixä¹‹åï¼Œè¾“å‡ºçš„prioråº”è¯¥æ˜¯ï¼ˆshapeï¼‰:(10, n, 1152, 1, 16):
<ul>
<li><code>x[None, :, :, None, :] @ self.route_weights[:, None, :, :, :]</code></li>
<li>xç”±(n, 1152, 8) å˜ä¸º(<strong><u>10</u></strong>, n, 1152, <strong><u>1</u></strong>, 8)ï¼Œweights(10, 1152, 8, 16)å˜ä¸ºï¼š(10, <strong><u>n</u></strong>, 1152, 1, 16)</li>
</ul></li>
</ul></li>
<li>å‰©ä¸‹çš„ä¸»è¦é—®é¢˜å°±æ˜¯ï¼š
<ul>
<li>ä¸€äº›åŸºæœ¬APIçš„ä½¿ç”¨ä¸å¤Ÿç†Ÿç»ƒï¼Œä¸çŸ¥é“å¦‚ä½•è¿›è¡Œsum / transpose / maxç­‰ç­‰ã€‚</li>
<li>çŸ©é˜µç»´åº¦åº”è¯¥å¦‚ä½•è¿›è¡Œå˜æ¢ï¼Œæ‰èƒ½è®©ä¸€ä¸ªbatchä¸è¢«index / sliceæ“ä½œåˆ†å‰²å¤„ç†ã€‚ä½•æ—¶åŠ å…¥ä¸€ä¸ªç»´åº¦ï¼Œä½•æ—¶squeezeï¼Ÿåº”è¯¥æ˜¯ç»éªŒä¸è¶³ï¼ŒAPIä½¿ç”¨ä¸ç†Ÿç»ƒçš„é—®é¢˜ã€‚</li>
</ul></li>
</ul>
<hr>
<h2 id="ä¸ªäººçœ‹æ³•">ä¸ªäººçœ‹æ³•</h2>
<p><span id="thinking"></span></p>
<p>â€‹ å…³äºCapsuleNetï¼Œä¸ªäººæœ‰ä»¥ä¸‹çœ‹æ³•ï¼š</p>
<ul>
<li>MNISTæ•°æ®é›†æœªå…å¤ªç®€å•äº†ï¼Œè¿™æ ·çš„å®éªŒï¼ˆè™½ç„¶ä½œè€…è¯´ï¼Œå…³äºCapsuleç½‘ç»œåªè¿›è¡Œæµ…å±‚çš„åˆ†æï¼‰ï¼š</li>
</ul>
<blockquote>
<p>The aim of this paper is not to explore this whole space but simply to show that one fairly straightforward implementation works well and that dynamic routing helps.</p>
</blockquote>
<ul>
<li>æˆ‘æ„Ÿè§‰å¥½åƒCapsuleæ²¡æœ‰å¤ªè¿‡è·³è„±å‡ºConvolutionä»¥åŠBPç»“æ„ï¼Œç®—æ˜¯ä¸€ç§ç½‘ç»œç»“æ„ / æ€æƒ³æ–¹æ³•ä¸Šçš„å¤§ï¼ˆgreatï¼‰åˆ›æ–°ï¼Œä½†æ˜¯ä¸èƒ½ç®—ä½œï¼ˆradicalï¼‰çš„åˆ›æ–°</li>
<li>CNN baselineæ˜¯å¦å¤ªèœäº†ä¸€ç‚¹ï¼Ÿå¤ªæµ…äº†å§æ‰ä¸‰å±‚ï¼Ÿï¼ˆå¯èƒ½æ˜¯MNISTæ•°æ®é›†ä¸éœ€è¦å¤ªèŠ±çš„ç»“æ„ï¼‰</li>
</ul>
<p></p>
<hr>
<h2 id="appendix-a---pytorch">Appendix A - Pytorch</h2>
<p>â€‹ è®°å½•ä¸€ä¸‹å®ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›åŸºç¡€ä½†æ˜¯æ²¡æœ‰é‡è§†çš„ç‚¹ã€‚å¸Œæœ›ä¸è¦åšè°ƒåº“ä¾ ã€‚</p>
<h3 id="torchçŸ©é˜µå¤„ç†">torchçŸ©é˜µå¤„ç†</h3>
<h4 id="torchçŸ©é˜µä¹˜æ³•çš„è§„åˆ™">torchçŸ©é˜µä¹˜æ³•çš„è§„åˆ™</h4>
<ul>
<li>å¦‚æœåªæœ‰2Dï¼ˆsizeé•¿åº¦ä¸º2ï¼‰ï¼Œéœ€è¦ç¬¦åˆçŸ©é˜µä¹˜æ³•çš„å°ºå¯¸å¯¹åº”è¦æ±‚ï¼ˆ(m,n) (n, k) -&gt; (m, k)ï¼‰</li>
<li>é«˜ç»´çŸ©é˜µï¼Œé™¤äº†æœ€åä¸¤ä¸ªç»´åº¦ä¹‹å¤–ï¼ŒçŸ©é˜µä¹˜æ³•éœ€è¦æ»¡è¶³ï¼šå…¶ä»–ç»´åº¦å®Œå…¨å¯¹åº” æ¡ä»¶ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = torch.ones((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = torch.ones(<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = torch.ones((<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>)) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = a @ b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.shape</span><br><span class="line">torch.Size([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>])</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå³ï¼Œé«˜ç»´ä¸ºçŸ©é˜µä¹˜æ³•ä¸å˜ï¼Œæœ€åä¸¤ç»´æ»¡è¶³çŸ©é˜µä¹˜æ³•æ¡ä»¶ã€‚åœ¨PytorchçŸ©é˜µè¿ç®—çš„æ—¶å€™ï¼Œå¯èƒ½å‡ºç°çŸ©é˜µç»´åº¦ä¸å¯¹åº”çš„æƒ…å†µï¼Œå¯èƒ½éœ€è¦é€šè¿‡æ·»åŠ ç»´åº¦çš„æ–¹å¼æ¥è¿›è¡Œç»´åº¦å¯¹åº”ã€‚æ¯”å¦‚æœ¬è®ºæ–‡ä¸­ï¼Œä¸¤å±‚capsuleå±‚ä¸­ï¼Œweight matrixçš„ä¹˜æ³•æ“ä½œï¼š</p>
<p>â€‹ åœ¨æœ¬å®ç°ä¸­ï¼Œè®­ç»ƒé›†batch <span class="math inline">\(x\)</span>å·ç§¯ / PrimaryCapsè¾“å‡ºä¸º(n, 32 * 36, 8) ï¼ˆè¿›è¡Œäº†ä¸€ä¸ªravelæ“ä½œï¼‰ï¼Œ<span class="math inline">\(W\)</span> weight matrixæ˜¯ 8 * 16ï¼ˆå³ä¹˜ï¼‰çš„ã€‚é‚£ä¹ˆ<span class="math inline">\(xW\)</span>å¯¼è‡´ç»´åº¦ä¸å¯¹åº”ï¼ˆè¾“å‡ºéœ€è¦åˆ°(n, 10, 16)ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦å¢åŠ ç»´åº¦ã€‚å¦‚æœå°†<span class="math inline">\(x\)</span> å˜ä¸º(<strong><u>10</u></strong>, n, 32 * 36, <strong><u>1</u></strong>, 8)ï¼Œ<span class="math inline">\(W\)</span>å˜ä¸º(10, <strong><u>n</u></strong>, 32 * 36, 8, 16) (ä¸‹åˆ’çº¿åŠ ç²—çš„æ˜¯å¢åŠ çš„å¯¹åº”ç»´åº¦)ï¼Œå°±å¯ä»¥è®©è¾“å‡ºä¸º(10, n, 32 * 36, 1, 16)ã€‚è¿™æ°å¥½ç¬¦åˆè®ºæ–‡ä¸­<span class="math inline">\(\hat u_{i|j}=W_{ij}u_{ij}\)</span>çš„å®šä¹‰ã€‚åœ¨Pytorchä¸­ï¼Œç»´åº¦å¢åŠ ä½¿ç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result = x[<span class="literal">None</span>, :, :, <span class="literal">None</span>, :] @ W[:, <span class="literal">None</span>, :, :, :]</span><br></pre></td></tr></table></figure>
<p>â€‹ Noneç”¨äºå¢åŠ ç»´åº¦ã€‚</p>
<h4 id="torch.sum">torch.sum</h4>
<p>â€‹ sumå…¶å®æ˜¯å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„ï¼š</p>
<ul>
<li><code>dim</code> æŒ‡å®šå¯¹çŸ©é˜µç¬¬dimç»´è¿›è¡Œsumæ“ä½œ</li>
<li><code>keepdim=False</code> keepdimå°†ä¼šä½¿çŸ©é˜µå°½å¯èƒ½ä½¿ç”¨åŸæ¥çš„ç»´åº¦è¿›è¡Œè¡¨ç¤ºã€‚å¾ˆæ˜¾ç„¶ï¼Œsumæ“ä½œä¼šé™ç»´ï¼ˆæ¯”å¦‚ä¸€ä¸ªäºŒç»´æ•°ç»„æ±‚sumä¹‹åï¼Œå°±æˆäº†ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼‰</li>
</ul>
<p>â€‹ å®ä¾‹ï¼šå¯¹äº<code>torch.FloatTensor(range(16)).view((1, 1, 4, 4))</code>çš„å››ä¸ªç»´æ±‚sumï¼Œè¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Only <span class="built_in">sum</span>:  tensor(<span class="number">120.</span>)</span><br><span class="line">Sum dim = <span class="number">0</span>: tensor([[[ <span class="number">0.</span>,  <span class="number">1.</span>,  <span class="number">2.</span>,  <span class="number">3.</span>],</span><br><span class="line">         [ <span class="number">4.</span>,  <span class="number">5.</span>,  <span class="number">6.</span>,  <span class="number">7.</span>],</span><br><span class="line">         [ <span class="number">8.</span>,  <span class="number">9.</span>, <span class="number">10.</span>, <span class="number">11.</span>],</span><br><span class="line">         [<span class="number">12.</span>, <span class="number">13.</span>, <span class="number">14.</span>, <span class="number">15.</span>]]])</span><br><span class="line">Sum dim = <span class="number">1</span>: tensor([[[ <span class="number">0.</span>,  <span class="number">1.</span>,  <span class="number">2.</span>,  <span class="number">3.</span>],</span><br><span class="line">         [ <span class="number">4.</span>,  <span class="number">5.</span>,  <span class="number">6.</span>,  <span class="number">7.</span>],</span><br><span class="line">         [ <span class="number">8.</span>,  <span class="number">9.</span>, <span class="number">10.</span>, <span class="number">11.</span>],</span><br><span class="line">         [<span class="number">12.</span>, <span class="number">13.</span>, <span class="number">14.</span>, <span class="number">15.</span>]]])</span><br><span class="line">Sum dim = <span class="number">2</span>: tensor([[[<span class="number">24.</span>, <span class="number">28.</span>, <span class="number">32.</span>, <span class="number">36.</span>]]])</span><br><span class="line">Sum dim = <span class="number">3</span>: tensor([[[ <span class="number">6.</span>, <span class="number">22.</span>, <span class="number">38.</span>, <span class="number">54.</span>]]])</span><br></pre></td></tr></table></figure>
<p>â€‹ å…³äºsumï¼Œä½¿ç”¨æ—¶éœ€è¦ææ¸…æ¥šå…¶ä½œç”¨ç»´åº¦ã€‚å¾—åˆ°ä½œç”¨ç»´åº¦ä¹‹åå¯ä»¥è¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œå¦‚ï¼š</p>
<ul>
<li>å¹³æ–¹åsumï¼Œæ±‚æœ€åä¸€ç»´çš„å’Œå¾—åˆ°æ¨¡çš„å¹³æ–¹</li>
<li>å¯¹åº”å…ƒç´ ç›¸ä¹˜åsumï¼Œæ±‚å¯¹åº”ç»´åº¦çš„å’Œå¾—åˆ°ç‚¹ç§¯ç»“æœ</li>
</ul>
<h4 id="torch.transpose">torch.transpose</h4>
<p>â€‹ å‚æ•°å¾ˆå¥½ç†è§£ï¼šç›´æ¥transposeé’ˆå¯¹ä¸€èˆ¬çš„äºŒç»´çŸ©é˜µï¼Œåªéœ€è¦<code>a.transpose()</code>å³å¯ã€‚ä½†æ˜¯é«˜ç»´çŸ©é˜µï¼Œtransposeæä¾›äº†ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼š</p>
<ul>
<li><code>dim0</code> and <code>dim1</code> è¡¨ç¤ºï¼Œè¿™ä¸¤ä¸ªdimè¿›è¡Œäº’æ¢ï¼ˆå®é™…ä¸Šå¯ä»¥ä¸ç†è§£ä¸ºtransposeï¼Œç†è§£ä¸ºswapï¼‰</li>
</ul>
<h4 id="torch.cat">torch.cat</h4>
<p>â€‹ ç®€å•çš„concatenateå‡½æ•°ã€‚å­˜åœ¨ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>éœ€è¦concatçš„çŸ©é˜µï¼Œä¸å¯å˜æ—¶ä½¿ç”¨tupleï¼Œå¯å˜å¯ä»¥ä½¿ç”¨listã€‚</li>
<li>dimï¼ˆè¿›è¡Œconcatçš„ç»´åº¦ï¼‰ï¼Œè¦ä¹ˆdimæ˜¯æŒ‡å®šçš„ç»´åº¦ï¼Œ-1æ˜¾ç„¶è¡¨ç¤ºçš„æ˜¯æœ€åä¸€ç»´ã€‚æ¯”å¦‚äºŒç»´çŸ©é˜µæ—¶ï¼Œdim = 0è¡¨ç¤ºæŒ‰è¡Œæ–¹å‘è¿›è¡Œcatï¼Œä¸º1æ—¶æŒ‰åˆ—æ–¹å‘è¿›è¡Œcatã€‚</li>
</ul>
<h4 id="torch.norm">torch.norm</h4>
<p>â€‹ æ±‚èŒƒæ•°ã€‚å¯¹äºå‘é‡è€Œè¨€ï¼Œè®¾<code>a</code>ä¸ºä¸€ä¸ªtensorã€‚é‚£ä¹ˆ<code>a.norm()</code>ç›´æ¥è°ƒç”¨è¾“å‡º2-èŒƒæ•°ã€‚å¯ä»¥å¸¦å‚æ•°ï¼š</p>
<ul>
<li>p = orderï¼Œå…¶å®å°±æ˜¯p-èŒƒæ•°ã€‚1å°±æ˜¯ç»å¯¹å€¼ï¼Œ2å°±æ˜¯æ¬§å‡ é‡Œå¾—ã€‚</li>
<li>dimï¼ˆå¯ä»¥æ˜¯intæˆ–è€…tupleï¼‰ã€‚torchçš„ç»´åº¦æ“ä½œç¡®å®å®¹æ˜“è®©äººå›°æƒ‘ã€‚ä¸ªäººçš„ç†è§£æ˜¯ï¼šä¼ å…¥çš„dimç”¨äºç»„ç»‡å…ƒç´ ï¼Œå¯¹éœ€è¦ç»„ç»‡çš„ç»´åº¦è¿›è¡ŒèŒƒæ•°è®¡ç®—ã€‚æ¯”å¦‚ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = torch.arange(<span class="number">16</span>).view(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">tensor([[[[ <span class="number">0.</span>,  <span class="number">1.</span>],</span><br><span class="line">          [ <span class="number">2.</span>,  <span class="number">3.</span>]],</span><br><span class="line">         [[ <span class="number">4.</span>,  <span class="number">5.</span>],</span><br><span class="line">          [ <span class="number">6.</span>,  <span class="number">7.</span>]]],</span><br><span class="line">        [[[ <span class="number">8.</span>,  <span class="number">9.</span>],</span><br><span class="line">          [<span class="number">10.</span>, <span class="number">11.</span>]],</span><br><span class="line">         [[<span class="number">12.</span>, <span class="number">13.</span>],</span><br><span class="line">          [<span class="number">14.</span>, <span class="number">15.</span>]]]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.norm(p = <span class="number">1</span>, dim = (<span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">tensor([[ <span class="number">6.</span>, <span class="number">22.</span>],</span><br><span class="line">        [<span class="number">38.</span>, <span class="number">54.</span>]])</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯ä»¥çœ‹å‡ºï¼Œtorchå°†tensor açš„2 / 3ç»´åº¦è¿›è¡Œåˆå¹¶ï¼Œç›¸å½“äº[[a, b], [c, d]]ï¼Œå…¶ä¸­aä¸ºå…ƒç´ [[0, 1], [2, 3]]ã€‚æ±‚1-èŒƒæ•°å³æ±‚ç»å¯¹å€¼ä¹‹å’Œã€‚éœ€è¦ç»„ç»‡ï¼ˆæ•´åˆæˆä¸€ä¸ªå…ƒç´ ï¼‰çš„ç»´åº¦ä¸º(2, 3)ã€‚äºŒç»´çš„ä¾‹å­ä¼šæ›´åŠ å®¹æ˜“æ˜ç™½ã€‚</p>
<ul>
<li>keepdim å’Œsumä¸€æ ·ï¼Œnormæ“ä½œä¹Ÿæ˜¯é™ç»´çš„ã€‚</li>
</ul>
<h4 id="torch.max-min">torch.max / min</h4>
<p>â€‹ max/minæ˜¯å­˜åœ¨å‚æ•°çš„ï¼š<code>dim</code>ä»¥åŠ<code>keepdim</code>ã€‚dimå‚æ•°ä¼šæŒ‡å®šï¼šmax/minæ“ä½œè¿›è¡Œçš„ç»´åº¦ã€‚æ¯”å¦‚ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼š <span class="math display">\[
A=
\begin{pmatrix}
1 &amp; 2 &amp; 3 \\
4 &amp; 5 &amp; 6 \\
7 &amp; 8 &amp; 9
\end{pmatrix}
\]</span> â€‹ å¦‚æœæŒ‡å®šA.max(dim = 0)ï¼ŒæŒ‡å®šåœ¨0ç»´åº¦ï¼ˆè¡Œï¼‰æ–¹å‘ä¸Šæ±‚æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€åˆ—ï¼ˆæ²¿ç€è¡Œå˜åŒ–æ–¹å‘ï¼‰æ±‚æœ€å¤§ã€‚è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">torch.return_types.<span class="built_in">max</span>(values=tensor([<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]), indices=tensor([<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]))</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯ä»¥ä½¿ç”¨è§£åŒ…çš„æ–¹å¼ï¼Œå·¦å€¼ä½¿ç”¨é€—å·åˆ†å‰²ã€‚é»˜è®¤æƒ…å†µä¸‹ä¼šæ±‚å…¨å±€æœ€å¤§å€¼ã€‚</p>
<h4 id="torch.argmax-argmin">torch.argmax / argmin</h4>
<p>â€‹ å…¶å®maxå·²ç»å¯ä»¥è¾“å‡ºæœ€å¤§å€¼æœ€å°å€¼å¯¹åº”çš„ä½ç½®äº†ã€‚argç³»åˆ—å¯èƒ½ç¨å¾®å¿«ä¸€äº›ï¼Œå› ä¸ºä¸ç”¨è¿”å›å€¼ã€‚dim / keepdimç”¨æ³•ä¸max/minæ˜¯ä¸€è‡´çš„ã€‚</p>
<h4 id="torch.index_select">torch.index_select</h4>
<p>â€‹ ç›¸å½“äºåˆ‡ç‰‡çš„é›†æˆã€‚helpä¸­è¯´å¾—å¾ˆæ¸…æ¥šï¼Œindex_selectå°±æ˜¯ç”¨äºå–å‡ºçŸ©é˜µä¸­æŸäº›å…ƒç´  / è¡Œåˆ— / ç»´åº¦çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = torch.randn(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line">tensor([[ <span class="number">0.1427</span>,  <span class="number">0.0231</span>, -<span class="number">0.5414</span>, -<span class="number">1.0009</span>],</span><br><span class="line">        [-<span class="number">0.4664</span>,  <span class="number">0.2647</span>, -<span class="number">0.1228</span>, -<span class="number">1.1068</span>],</span><br><span class="line">        [-<span class="number">1.1734</span>, -<span class="number">0.6571</span>,  <span class="number">0.7230</span>, -<span class="number">0.6004</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>indices = torch.tensor([<span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.index_select(x, <span class="number">0</span>, indices)</span><br><span class="line">tensor([[ <span class="number">0.1427</span>,  <span class="number">0.0231</span>, -<span class="number">0.5414</span>, -<span class="number">1.0009</span>],</span><br><span class="line">        [-<span class="number">1.1734</span>, -<span class="number">0.6571</span>,  <span class="number">0.7230</span>, -<span class="number">0.6004</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.index_select(x, <span class="number">1</span>, indices)</span><br><span class="line">tensor([[ <span class="number">0.1427</span>, -<span class="number">0.5414</span>],</span><br><span class="line">        [-<span class="number">0.4664</span>, -<span class="number">0.1228</span>],</span><br><span class="line">        [-<span class="number">1.1734</span>,  <span class="number">0.7230</span>]])</span><br></pre></td></tr></table></figure>
<p>â€‹ dim ç”¨äºè§†è§’é€‰æ‹©ã€‚dim = 0æ—¶ï¼Œè¯´æ˜å½“å‰indexæ˜¯åŸºäºè¡Œçš„ï¼Œä¸€æ¬¡å–å‡ºnè¡Œã€‚dim = 1åˆ™ç›¸å¯¹äºåˆ—è¿›è¡Œè®¨è®ºã€‚</p>
<h4 id="torch.squeeze-unsqueeze">torch.squeeze / unsqueeze</h4>
<ul>
<li><code>squeeze</code> å»é™¤æ‰€æœ‰ç»´åº¦ä¸º1çš„å¤šäºç»´åº¦ã€‚dimç”¨äºæŒ‡å®šå“ªäº›ç»´åº¦å¯ä»¥è¢«æ“ä½œã€‚
<ul>
<li>squeezeè¿”å›ä¸€ä¸ªä¸åŸçŸ©é˜µå…±äº«å†…å­˜çš„çŸ©é˜µï¼ˆç›¸å½“äºä¸€ä¸ªrefï¼‰</li>
<li>squeezeå¯èƒ½ä¼šåœ¨batchè®­ç»ƒä¸­ï¼Œå°†batch_size = 1é€ æˆçš„ç¬¬å››ç»´å°†ä¸ºä¸‰ç»´ã€‚</li>
</ul></li>
<li><code>unsqueeze</code> å°±æ˜¯å¢åŠ ä¸€ä¸ªç»´åº¦ï¼ˆä¸º1ï¼‰ã€‚å‚æ•°ä¸squeezeä¸€è‡´ã€‚</li>
</ul>
<h4 id="çš„ä½œç”¨">â€œ-1â€çš„ä½œç”¨</h4>
<p>â€‹ ä¸çŸ©é˜µä¹˜æ³•ä¸­ä½¿ç”¨Noneåšç´¢å¼•ç±»ä¼¼ï¼Œ-1åœ¨torchä¸­ä¹Ÿæœ‰å¾ˆå¤šä½œç”¨ã€‚æ¯”å¦‚æœ€å¸¸ç”¨çš„ï¼š</p>
<ul>
<li>a.view(1, -1)ä¸a.view(-1, 1)ã€‚æ­¤å¤„-1è¡¨ç¤ºï¼Œç”±ç³»ç»Ÿè‡ªä¸»ç¡®å®šæ­¤å¤„çš„å€¼ï¼Œ-1ç§°ä¸ºæ¨æµ‹ã€‚ä½†æ˜¯åªæœ‰ä¸€ç»´å¯ä»¥è¢«æ¨æµ‹ï¼Œé«˜äº1ç»´æ²¡åŠæ³•ç¡®å®šæ€§æ¨æµ‹ã€‚ä½†-1è¿˜æ˜¯æœ‰ä¸€äº›å¥‡æ€ªçš„ä½¿ç”¨ï¼š</li>
<li>sum(dim = -1) æ­¤å¤„æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™ä¸-1ä½œä¸ºç´¢å¼•ä¸€è‡´ã€‚-1ä¸ºæœ€åä¸€ä¸ªï¼Œåˆ™é€‰æ‹©æœ€åä¸€ç»´è¿›è¡Œsumæ“ä½œã€‚é€šå¸¸ä¸ºåˆ—æ“ä½œã€‚</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>CNN Style Transferè®ºæ–‡å¤ç°</title>
    <url>/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="neuralstyle"># NeuralStyle</h2>
<p>My own implementation of CVPR 2016 paper: Image Style Transfer Using Convolutional Neural Networks. This work is, I think, simple but elegant (I mean the paper, not my implementation) with good interpretability.</p>
<ul>
<li>CVPR 2016 OpenAccess Link is here: <a href="https://openaccess.thecvf.com/content_cvpr_2016/html/Gatys_Image_Style_Transfer_CVPR_2016_paper.html">CVPR 2016 open access</a></li>
<li>Personal understanding of this paper [Chinese]: <a href="https://enigmatisms.github.io/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/">Blog of Enigmatisms/CNN Style Transferè®ºæ–‡å¤ç°</a></li>
</ul>
<div class="note success"><p>2021.11.15 complement: I have no intention to analyze and explain this paper, because I think it's simple, and I have a deep impression of this, therefore there is no point recording anything on the blog. Original Github Repo: <a href="https://github.com/Enigmatisms/NeuralStyle">GithubğŸ”—: Enigmatisms/NeuralStyle</a>. This post is exactly the README.md of the repo.</p>
</div>
<span id="more"></span>
<hr>
<h3 id="to-run-the-code">To run the code</h3>
<p>Make sure to have Pytorch / Tensorboard on your device, CUDA is available too yet I failed to use it (GPU memory not enough, yet API is good to go). I am currently using Pytorch 1.7.0 + CU101.</p>
<p>On Init, it might require you to download pretrained VGG-19 network, which requires network connection.</p>
<hr>
<h3 id="tree---working-directory">Tree - Working Directory</h3>
<ul>
<li>folder <code>content</code>: Where I keep content images.</li>
<li>folder <code>imgs</code>: To which the output goes.</li>
<li>folder <code>style</code>:
<ul>
<li><code>lossTerm.py</code>: Style loss and Content loss are implemented here.</li>
<li><code>precompute.py</code>: VGG-19 utilization, style and content extractors.</li>
<li><strong><code>transfer.py</code></strong>: executable script.</li>
</ul></li>
</ul>
<hr>
<h3 id="a-little-help">A Little Help</h3>
<p>Always run <code>transfer.py</code> in folder <code>style/</code>, using <code>python ./transfer.py -h</code>ï¼Œ you'll get:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">usage: transfer.py [-h] [--alpha ALPHA] [--epoches EPOCHES]</span><br><span class="line">                   [--max_iter MAX_ITER] [--save_time SAVE_TIME] [-d] [-g]</span><br><span class="line">                   [-c]</span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  --alpha ALPHA         Ratio of content loss in the total loss</span><br><span class="line">  --epoches EPOCHES     Training lasts for . epoches (for LBFGS)</span><br><span class="line">  --max_iter MAX_ITER   LBFGS max iteration number</span><br><span class="line">  --save_time SAVE_TIME</span><br><span class="line">                        Save image every &lt;save_time&gt; epoches</span><br><span class="line">  -d, --del_dir         Delete dir ./logs and start new tensorboard records</span><br><span class="line">  -g, --gray            Using grayscale image as initialization for generated</span><br><span class="line">                        image</span><br><span class="line">  -c, --cuda            Use CUDA to speed up training</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="requirements">Requirements</h3>
<ul>
<li>Run:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m pip install -r requirements.py</span><br></pre></td></tr></table></figure>
<p>To find out.</p>
<hr>
<h3 id="training-process">Training Process</h3>
<ul>
<li>Something strange happened. Loss exploded twice (but recovered.). Tensorboard graphs:</li>
</ul>
<p><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/training.JPG"></p>
<p>Therefore, parameter images change like this (Initialized with grayscale image).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_star_71.jpg"></th>
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_star_221.jpg"></th>
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_star_481.jpg"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_chaos_11.jpg"></td>
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_chaos_181.jpg"></td>
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_chaos_241.jpg"></td>
</tr>
<tr class="even">
<td style="text-align: center;">First few epochs</td>
<td style="text-align: center;">Exploded, for 2th row image</td>
<td style="text-align: center;">Recovered</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="results">Results</h3>
<ul>
<li>CPU training is tooooooo slow. Took me <strong><u>2+ hours</u></strong> for 800 iterations. (i5-8250U 8th Gen @ 1.60Hz)</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/star.jpg" style="zoom:80%;"></th>
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/content.jpg"></th>
<th style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_star_801.jpg"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/chaos.jpg" style="zoom:80%;"></td>
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/content.jpg"></td>
<td style="text-align: center;"><img src="/2021/04/21/CNN-Style-Transfer%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/G_chaos_801.jpg"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Style</td>
<td style="text-align: center;">Content</td>
<td style="text-align: center;">Output(800 Iterations)</td>
</tr>
</tbody>
</table>
<ul>
<li>I've also done the style transfer of Van Gogh's self portrait for my dad, which is not appropriate to display, but worked.</li>
</ul>
<hr>
<h3 id="possible-todos">Possible TODOs</h3>
<ul class="task-list">
<li><input type="checkbox" disabled>
Try adding InstanceNorm into VGG-19 ? Useful ? Meaningful ?</li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>English</tag>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDAè¸©å‘å®å½•ã€1ã€‘</title>
    <url>/2021/09/23/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%901%E3%80%91/</url>
    <content><![CDATA[<h1 id="cuda-i">CUDA I</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ åœ¨å¤ç°<a href="https://arxiv.org/abs/2104.07516"><strong>A Decomposition Model for Stereo Matching</strong></a>è¿™ç¯‡è®ºæ–‡çš„æ—¶å€™ï¼Œå‘ç°å…¶Sparse matchingå¹¶ä¸æ˜¯ç›´æ¥çš„pytorchå®ç°ã€‚æœ¬æ¥æˆ‘æƒ³ç›´æ¥pytorchäº†äº‹çš„ï¼Œä½†ä»”ç»†ä¸€æ€è€ƒåè§‰å¾—è™½ç„¶åå‘ä¼ æ’­å®ç°ä¸ç”¨è€ƒè™‘äº†ï¼Œä½†æ˜¯æ•´ä½“å˜å¾—å¾ˆæ…¢ã€‚é˜…è¯»å®˜æ–¹æºç å‘ç°æ—¶çœ‹åˆ°ä¸€äº›æˆ‘ä¸å¤ªæ‡‚çš„ä¸œè¥¿ï¼Œåæ¥æˆ‘æ‰çŸ¥é“è¿™äº›æ˜¯CUDAè‡ªå®šä¹‰pytorchç®—å­ï¼Œæ˜¯pytorchçš„CUDA extensionã€‚å‡ºäºä»¥ä¸‹ç›®çš„ï¼š</p>
<ul>
<li>å¤ä¹ CUDAï¼ˆç‰¹åˆ«æ˜¯åœ¨å­¦ä¹ å®ŒGPUå­˜å‚¨ç»“æ„ä¸è®¡ç®—ä¹‹åï¼Œæ€¥éœ€å®è·µï¼‰</li>
<li>å­¦ä¹ setuptoolsçš„ä½¿ç”¨ä»¥åŠtorchçš„CUDA extensionå†™æ³•</li>
</ul>
<p>â€‹ æˆ‘ç»™è‡ªå·±å®šäº†ä¸€ä¸ªå°å‹çš„CUDAä»»åŠ¡ï¼Œä¸SDFä»¥åŠmarching cubesç®—æ³•ååˆ†ç›¸å…³ã€‚é¡¹ç›®è§<a href="https://github.com/Enigmatisms/CuTorch">[ğŸ”—Enigmatisms/CuTorch]</a></p>
<span id="more"></span>
<hr>
<h2 id="ii.-ä»»åŠ¡è®¾å®š">II. ä»»åŠ¡è®¾å®š</h2>
<p>â€‹ åœ¨ä¸€ä¸ª800x600çš„ç”»å¸ƒå†…ï¼Œéšæœºç”Ÿæˆä¸€äº›â€œæ³¡æ³¡â€ï¼Œè¿™äº›æ³¡æ³¡åœ¨è¿åŠ¨è¿‡ç¨‹ä¸­åº”è¯¥å¯ä»¥è‡ªç”±åœ°èåˆã€‚æ³¡æ³¡çš„èåˆä¸æ˜¯ç®€å•åœ°å åŠ ï¼Œå åŠ åº”å½“æ˜¯å¹³æ»‘çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2021/09/23/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%901%E3%80%91/bubbles.PNG" style="zoom: 67%;"></p>
<center>
Figure 1. æ³¡æ³¡èåˆé—®é¢˜
</center>
<p>â€‹ æ¯ä¸ªæ³¡æ³¡å¯¹åº”ç€2Då¹³é¢ä¸ŠåŠå¾„ä¸ºrï¼Œä¸­å¿ƒä¸º(x, y)çš„ä¸€ä¸ªåœ†ã€‚é‚£ä¹ˆéœ€è¦è®¡ç®—ï¼š</p>
<ul>
<li>æ¯ä¸ªæ³¡æ³¡å¯¹åº”åœ†çš„SDFï¼Œå¹¶ä¸”å°†å…¶å åŠ åœ¨ä¸€èµ·</li>
<li>è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œè·¨è¶Šæ­¤é˜ˆå€¼çš„éƒ¨åˆ†å°†å½¢æˆè¾¹ç»“æ„ï¼ˆä¹Ÿå°±æ˜¯ç­‰é«˜çº¿ï¼‰</li>
</ul>
<p>â€‹ æ•´ä¸ªå°é¡¹ç›®çš„å®Œæ•´çŸ¥è¯†åœ¨è¿™é‡Œï¼š<a href="http://jamie-wong.com/2014/08/19/metaballs-and-marching-squares/">ã€Jamie Wong: Metaballs and Marching Squaresã€‘</a>ã€‚å†™å¾—éå¸¸ä¸é”™ï¼Œ6æœˆä»½åšSDFçš„ç‚¹äº‘èåˆæ—¶ï¼Œæ›¾ç»å‚è€ƒè¿‡å…¶marching cubesçš„å®ç°æ–¹æ³•ã€‚æœ¬æ–‡ä¸å…·ä½“çš„ç®—æ³•å®ç°æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œå› ä¸ºç®—æ³•æœ¬èº«éå¸¸ç®€å•ã€‚</p>
<hr>
<h3 id="åŸºç¡€çŸ¥è¯†">2.1 åŸºç¡€çŸ¥è¯†</h3>
<h4 id="dims">2.1.1 Dims</h4>
<p>â€‹ grid ä¸ blockæ˜¯CUDAçš„åˆ†çº§ç®¡ç†çš„ä¸¤ä¸ªå±‚æ¬¡ï¼Œgridç›¸å½“äºæ˜¯blockçš„é›†åˆï¼Œè€Œblockç›¸å½“äºæ˜¯threadçš„é›†åˆï¼ˆæˆ–è€…warpçš„é›†åˆï¼‰ã€‚ä½†æˆ‘åœ¨å†™CUDAçš„æ—¶å€™å¥½åƒå¹¶æ²¡æœ‰çœ‹åˆ°warpçš„ç›´æ¥ä½¿ç”¨ã€‚æ³¨æ„gridä¸blockä¸¤è€…çš„ç»´åº¦ gridDimä»¥åŠblockDim åƒä¸‡åˆ«ææ··äº†ã€‚å¯¹äºä¸€ä¸ªkernel:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">kernel_function &lt;&lt;&lt;A, B&gt;&gt;&gt; ();</span><br></pre></td></tr></table></figure>
<p>â€‹ AæŒ‡å®šçš„æ˜¯gridçš„å½¢çŠ¶ï¼Œå¯ä»¥æ˜¯dim3ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆæŒ‡å®šblockï¼‰ï¼ŒAæ˜¯æ•°å­—çš„æƒ…å½¢å¾ˆå¸¸ç”¨ï¼ŒäºŒç»´å›¾åƒå¤„ç†ä¸€èˆ¬å¯ä»¥è¿™ä¹ˆåšï¼šAï¼ŒBåˆ†åˆ«ä»£è¡¨å›¾åƒçš„æŸä¸€ä¸ªç»´åº¦ã€‚</p>
<p>â€‹ BæŒ‡å®šçš„æ˜¯blockå½¢çŠ¶ï¼Œæ•°æ®ç±»å‹åŒç†ã€‚é‚£ä¹ˆgridDimåˆ™åæ˜ äº†Açš„è¾“å…¥ï¼ŒblockDimåæ˜ Bçš„è¾“å…¥ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">dim3 <span class="title">grid</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line"><span class="function">dim3 <span class="title">block</span><span class="params">(<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>)</span></span>;</span><br><span class="line">kernel_func &lt;&lt;&lt;grid, block&gt;&gt;&gt; ();</span><br></pre></td></tr></table></figure>
<p>â€‹ åœ¨kernelå†…éƒ¨ï¼Œä¼šæœ‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">(gridDim.x, gridDim.y, gridDim.z)=(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">(blockDim.x, blockDim.y, blockDim.z)=(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>);</span><br></pre></td></tr></table></figure>
<p>â€‹ ç›¸åº”åœ°ï¼ŒblockIdx.x <span class="math inline">\(\in\)</span> [0, gridDim.x ), threadIdx.x <span class="math inline">\(\in\)</span> [0, blockDim.x)ã€‚æ¯ä¸€ä¸ªå®é™…çš„idï¼Œå…¶èŒƒå›´æ˜¯å±‚çº§å¼çš„ã€‚block idä¸gridæœ‰å…³ï¼Œthread idä¸blockæœ‰å…³ã€‚å¹¶ä¸”ä¹Ÿè¦æ³¨æ„ä»¥ä¸‹çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>Goal: Have enough transactions in flight to saturate the memory bus.</p>
<p>Latency can be hidden by having more transactions in flight. [1]</p>
</blockquote>
<p><img src="/2021/09/23/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%901%E3%80%91/block.png"></p>
<center>
Figure 2. occupancyæ³¨æ„äº‹é¡¹ï¼ˆæ¥æº<a href="#refs">[1]</a>)
</center>
<h3 id="dynamic-parallelismè¸©å‘">2.2 Dynamic Parallelismè¸©å‘</h3>
<p>â€‹ Dynamic parallelismï¼Œæˆ‘æ›´æ„¿æ„ç›´è§‚åœ°ç§°ä¹‹ä¸ºï¼šnested kernelsï¼ˆåµŒå¥—çš„æ ¸å‡½æ•°ï¼‰ã€‚ä»¥æˆ‘è‡ªå·±çš„ä»£ç ä¸ºä¾‹ï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹åµŒå¥—æ ¸å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">fineGrainedTask</span><span class="params">(<span class="type">const</span> <span class="type">float</span>* <span class="type">const</span> bubbles, <span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> y, <span class="type">float</span>* shared_tmp)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> id = threadIdx.x, base = <span class="number">3</span> * id;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> cx = bubbles[base], cy = bubbles[base + <span class="number">1</span>], radius = bubbles[base + <span class="number">2</span>];</span><br><span class="line">    shared_tmp[id] = <span class="built_in">signedDistance</span>(x, y, cx, cy, radius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">calculateSDF</span><span class="params">(<span class="type">const</span> <span class="type">float</span>* <span class="type">const</span> bubbles, <span class="type">const</span> <span class="type">int</span> num, <span class="type">float</span>* output)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> y = threadIdx.x, x = blockIdx.x, id = y * gridDim.x + x;</span><br><span class="line">    <span class="type">float</span> distance = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">// fineGrainedTask &lt;&lt;&lt; 1, num &gt;&gt;&gt; (bubbles, x, y, tmp);</span></span><br><span class="line">    <span class="comment">// cudaDeviceSynchronize();</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> base = <span class="number">3</span> * i;</span><br><span class="line">        <span class="type">const</span> <span class="type">float</span> cx = bubbles[base], cy = bubbles[base + <span class="number">1</span>], radius = bubbles[base + <span class="number">2</span>];</span><br><span class="line">        distance += <span class="built_in">signedDistance</span>(x, y, cx, cy, radius);</span><br><span class="line">    &#125;</span><br><span class="line">    output[id] = distance - <span class="number">1.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ç¬¬äºŒä¸ªå‡½æ•° <code>__global__ void calculateSDF</code> æ˜¯ä¸»æ ¸å‡½æ•°ã€‚å…¶ç›®çš„æ˜¯æ±‚äºŒç»´çŸ©é˜µä¸­æ¯ä¸€ä¸ªç‚¹(i, j)çš„SDFå€¼ã€‚è€Œæ˜¾ç„¶ï¼Œæ¯æ¬¡è¾“å…¥çš„æ³¡æ³¡æ•°é‡(num)å¯ä»¥å¾ˆå¤§ï¼Œé‚£ä¹ˆå†…éƒ¨æ±‚signed distanceçš„forå¾ªç¯ï¼Œåº”è¯¥æ˜¯å¯ä»¥å¹¶è¡ŒåŒ–çš„ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°<code>__global__ void fineGrainedTask</code> å°±æ˜¯ä¸ºäº†åšè¿™æ ·çš„å¹¶è¡Œï¼Œåœ¨ç¬¬åè¡Œä¹Ÿè¢«è°ƒç”¨äº†ï¼ˆnumè·¯å¹¶è¡Œï¼Œä½¿ç”¨__shared__ä¿å­˜ä¸´æ—¶çš„ç»“æœï¼‰ã€‚</p>
<p>â€‹ CUDAåœ¨ architecture 35ä»¥åŠä¹‹åå°±æ”¯æŒè¿™ç§nestedçš„dynamic parallelismç»“æ„ï¼Œå…è®¸æ ¸å‡½æ•°å†…éƒ¨è°ƒç”¨æ ¸å‡½æ•°ï¼Œå› ä¸ºç¡®å®ä¹Ÿæ˜¯ä¼šæœ‰å±‚æ¬¡å¹¶è¡Œçš„éœ€æ±‚çš„ã€‚</p>
<div class="note danger"><center>
<h3>
ä½†æ˜¯CUDA dynamic parallelism + Pythonå´æœ‰ä¸€å¤§å †å‘
</h3>
</center>
</div>
<p>â€‹ å‡å¦‚åªæ˜¯ä½¿ç”¨CUDA + CPPè¿›è¡ŒåµŒå¥—æ ¸å‡½æ•°çš„ç¼–å†™ï¼Œè™½ç„¶æœ‰ç‚¹å°å‘ï¼Œä½†æ˜¯å¾ˆå¿«å°±èƒ½è¿‡ç¼–è¯‘ï¼š</p>
<p>â€‹ Dynamic parallelisméœ€è¦separate compilationï¼ŒCMakeé‡Œé¢æœ‰å¾ˆç®€å•çš„è®¾ç½®ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set_property</span>(CUDA_SEPARABLE_COMPILATION <span class="keyword">ON</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ ä½†éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ul>
<li>separate compilationéœ€è¦æŒ‡å®šarchï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-gencode=arch=compute_35,code=sm_35</span><br></pre></td></tr></table></figure>
<ul>
<li>nvccç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæŒ‡å®šï¼š<code>-lcudadevrt -lcudart</code>ï¼Œåœ¨/usrçš„æŸä¸ªæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªåŠ¨æ€åº“(libcudart.so)ä»¥åŠä¸€ä¸ªé™æ€åº“ï¼ˆæˆ‘çš„è®¾å¤‡ä¸Šæ˜¯é™æ€åº“ï¼šcudadevrt.aï¼‰ã€‚ä¸æ–¹ä¾¿è®¾ç½®è¿™ä¸¤ä¸ªç¼–è¯‘flagçš„æ—¶å€™ï¼Œåœ¨target_link_librariesä¸­å¯ä»¥æ‰‹åŠ¨é“¾æ¥ã€‚</li>
</ul>
<p>â€‹ ä½†æ˜¯Python setuptoolsç¼–è¯‘å¹¶æ²¡æœ‰é‚£ä¹ˆå‹å¥½ã€‚é¦–å…ˆæˆ‘ä¹ŸçŸ¥é“æˆ‘éœ€è¦è¿›è¡Œseparate compilationï¼Œæ‰€ä»¥æˆ‘éœ€è¦æŒ‡å®šï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;march&#x27;</span>,</span><br><span class="line">    ext_modules=[</span><br><span class="line">        CUDAExtension(<span class="string">&#x27;march&#x27;</span>, [</span><br><span class="line">                <span class="string">&#x27;src/marchingCubes.cu&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;src/sdf_kernel.cu&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">            include_dirs=[include_dirs],</span><br><span class="line">            extra_compile_args=&#123;<span class="string">&#x27;cxx&#x27;</span>: [<span class="string">&#x27;-g&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">                <span class="string">&#x27;nvcc&#x27;</span>: [<span class="string">&#x27;-O3&#x27;</span>, <span class="string">&#x27;-use_fast_math&#x27;</span>,</span><br><span class="line">                 <span class="comment">################# Here #############</span></span><br><span class="line">				<span class="string">&#x27;-rdc=true&#x27;</span>, <span class="string">&#x27;-gencode=arch=compute_35,code=sm_35&#x27;</span></span><br><span class="line">            ]&#125;,</span><br><span class="line">        )</span><br><span class="line">    ],</span><br><span class="line">    cmdclass=&#123;</span><br><span class="line">        <span class="string">&#x27;build_ext&#x27;</span>: BuildExtension</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>-rdc=true</code>è²Œä¼¼å’Œ<code>-dc</code>ä½œç”¨å·®ä¸å¤šã€‚è¿˜éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸€ä¸‹æ¶æ„ä»£æ•°ï¼Œé»˜è®¤å¥½åƒæ˜¯ä¸€ä¸ªå¾ˆå°çš„ä»£ã€‚å¥½ï¼Œä¸è¦å¿˜äº†å¢åŠ <code>-lcudadevrt</code>ä»¥åŠ<code>-lcudart</code>ä»¥â€œä¿è¯â€å¯ä»¥é“¾æ¥åˆ°CUDAçš„ä¸€äº›åº“ã€‚</p>
<p>â€‹ çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œç¼–å®ƒã€‚ç¼–è¯‘é€šè¿‡ï¼Œå¾ˆå¥½ï¼Œè·‘å®ƒã€‚é¦–å…ˆimport torchï¼ˆç”±äºæœ¬é¡¹ç›®C++å†…éƒ¨ä½¿ç”¨äº†libtorchï¼Œé‡Œé¢çš„libc10.soéœ€è¦torchå¯¼å…¥ï¼Œä¸å…ˆimportçš„è¯ä¼šæŠ¥é”™ï¼‰ã€‚å†import marchï¼ˆæˆ‘çš„åº“åç§°ï¼‰ï¼Œè¿™ä¸€æ­¥ç›´æ¥æ­»æ‰ï¼š</p>
<blockquote>
<p>ä»€ä¹ˆä»€ä¹ˆundefined symbolï¼Œä¸CUDAåº“ç›¸å…³ã€‚</p>
</blockquote>
<p>â€‹ å¤§æ¦‚æ„æ€å°±æ˜¯ï¼š<code>cudadevrt.a</code>ä½ æ ¹æœ¬æ²¡æœ‰é“¾æ¥ä¸Šï¼Œé‡Œé¢è¿˜æœ‰ä¸€äº›å‡½æ•°å®šä¹‰å‘¢ã€‚å¥½å®¶ä¼™ï¼Œpythonçš„æ‰€æœ‰åº“éƒ½æ˜¯åŠ¨æ€åŠ è½½çš„ï¼Œä½ ä¸€ä¸ªé™æ€åº“ä½ å«æˆ‘æ€ä¹ˆåŠ è½½ï¼ˆç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼š(1) é‡æ–°ç¼–è¯‘é™æ€åº“ä¸ºåŠ¨æ€åº“ (2) ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ä¸ºä¸€ä¸ªextensionï¼Œå…·ä½“åŸç†æˆ‘ä¹Ÿä¸æ‡‚ï¼‰ï¼Ÿæˆ‘è¿˜æŒ‡æœ›ä½ ç›´æ¥ç»™æˆ‘ç¼–è¯‘åˆ°marchè¿™ä¸ªåº“é‡Œé¢å‘¢ã€‚</p>
<p>â€‹ å°è¯•äº†å¾ˆå¤šæ–¹æ³•ï¼Œæ— è®ºæ˜¯åœ¨C++ ç¼–è¯‘flagsé‡Œé¢é“¾æ¥ï¼Œè¿˜æ˜¯nvcc flagsï¼Œè¿˜æ˜¯stackoverflowä¸Šè¯´çš„æ‰€è°“ï¼šsetupå‡½æ•°çš„extra_compile_objectså‚æ•°ï¼Œæ²¡æœ‰ä¸€ä¸ªæœ‰æ•ˆæœçš„ã€‚</p>
<p>â€‹ æˆ‘ä¹Ÿå°è¯•è¿‡æ‰‹åŠ¨åˆ†åˆ«ç¼–è¯‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nvcc -O3 -use_fast_math -gencode=arch=compute_70,code=sm_70 -dc -I/opt/libtorch/include/ -I/opt/libtorch/include/torch/csrc/api/include/ -I//usr/include/python3.6m src/sdf_kernel.cu src/marchingCubes.cu -Xcompiler -fPIC </span><br><span class="line">nvcc -O3 -use_fast_math -gencode=arch=compute_70,code=sm_70 -dlink -L/usr/local/cuda-10.1/targets/x86_64-linux/lib/ -lcudadevrt -lcudart sdf_kernel.o marchingCubes.o -shared -o libdlink.so</span><br></pre></td></tr></table></figure>
<p>â€‹ æƒ³æŠŠä¸¤ä¸ªcudaæ–‡ä»¶ç¼–è¯‘è·ŸåŸæœ‰çš„é™æ€åŠ¨æ€åº“ä¸€èµ·ç¼–è¯‘æˆä¸€ä¸ªåŠ¨æ€åº“ï¼Œä½†æ˜¯ä¸­é€”æŠ¥äº†æœ‰å…³fPICçš„é”™è¯¯ï¼Œè¯´æ˜¯è¿™æ ·ç¼–è¯‘æ˜¯ä¸è¢«å…è®¸çš„ï¼Œåæ­£ä¸æ˜¯é‚£ç§å¾ˆç®€å•çš„é”™è¯¯ã€‚ã€‚ã€‚æäº†åŠå¤©ï¼Œæ— æœã€‚å„ç§é—®é¢˜éƒ½å‡ºäº†ï¼Œæœ€åæˆ‘ç”šè‡³éƒ½æ€€ç–‘æ˜¯ç¼–è¯‘å™¨çš„bugï¼ˆè‡ªä¿¡ï¼ï¼‰ã€‚æœ€åè²Œä¼¼åœ¨CUDA forumçš„æŸä¸ªåœ°æ–¹çœ‹è§æœ‰äººè¯´ï¼ŒPythonç°åœ¨å¯¹è¿™ä¸ªçš„æ”¯æŒè¿˜ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œå°±å¼ƒå‘äº†ã€‚</p>
<p>â€‹ æœ€åä¸€ä¸ªå°å‘å°±æ˜¯ï¼štmdä¸è¦éšä¾¿ç”¨å¾ˆé«˜çš„ä»£æ•°ï¼ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘åœ¨setupå‡½æ•°nvccå‚æ•°è®¾ç½®æ—¶ï¼Œå®šä»£æ•°ä¸ºï¼š<code>-gencode=arch=compute_70,code=sm_70</code>ã€‚ç»“æœè·‘ç»“æœçš„æ—¶å€™ï¼Œè¾“å‡ºå›¾åƒä¸€ç‰‡æ¼†é»‘ã€‚æœ€åæŸ¥å‡ºæ¥ç»“æœæ˜¯ï¼š<strong><u>æ ¸å‡½æ•°æ ¹æœ¬æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè·³è¿‡äº†</u></strong>ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºå‡ºäº†å†…å­˜é—®é¢˜ï¼ˆè€ åƒï¼ˆæ¬¡ï¼‰è¶Šï¼ˆç•Œï¼‰äº†ï¼‰ï¼ˆPSï¼šCUDA runtimeå‡ºé”™å¯èƒ½å¯¼è‡´æ ¸å‡½æ•°ä¸æ‰§è¡Œï¼‰ï¼Œå†™äº†ä¸ªCUDAé”™è¯¯æ£€æŸ¥ï¼Œå‘ç°å®Œå…¨æ²¡æœ‰é”™è¯¯ã€‚æœ€åçµå…‰ä¸€é—ªï¼Œæˆ‘æŠŠä»£æ•°æ”¹æˆäº†35ï¼Œå¥½äº†ã€‚ã€‚ã€‚</p>
<p>â€‹ æ„Ÿè§‰è¢«å‘æ­»äº†ã€‚åŸæœ¬é¢„è®¡ä¸€ä¸ªä¸‹åˆè§£å†³ï¼Œç»“æœå› ä¸ºgrid/blockææ··ï¼Œç»“æœé”™è¯¯ï¼Œå¤šè°ƒäº†3å°æ—¶ï¼Œåˆå› ä¸ºdynamic parallelismï¼Œå¤šè°ƒäº†6å°æ—¶ã€‚</p>
<p>â€‹ èœï¼Œæˆ–è®¸å°±æ˜¯è¿™æ ·çš„å§ï¼Ÿ</p>
<p>â€‹ å®Œæ•´çš„é¡¹ç›®ä»¥åŠç»“æœè§<a href="https://github.com/Enigmatisms/CuTorch">[ğŸ”—Enigmatisms/CuTorch]</a></p>
<hr>
<h2 id="reference">Reference</h2>
<p><span id="refs"></span></p>
<p>[1] <a href="https://on-demand.gputechconf.com/gtc-express/2011/presentations/cuda_webinars_WarpsAndOccupancy.pdf">CUDA Warps and Occupancy</a></p>
<p></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>GPU</tag>
        <tag>CUDA</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDAè¸©å‘å®å½•ã€2ã€‘</title>
    <url>/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/</url>
    <content><![CDATA[<h1 id="cuda-ii">CUDA II</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ CUDAååˆ†æœ‰è¶£ã€‚å› ä¸ºæˆ‘åŸºæœ¬å°±æ˜¯åšç®—æ³•å’Œè½¯ä»¶çš„ï¼Œæ‰€ä»¥å¯¹äºè®¡ç®—æœºä½“ç³»ç»“æ„ï¼Œç¡¬ä»¶è®¾è®¡ç­‰ç­‰äº†è§£å¾—ä¸å¤šã€‚å°½ç®¡ä¸ªäººè¿™æ–¹é¢çŸ¥è¯†æœ‰é™ï¼Œæˆ‘ä»ç„¶è§‰å¾—è¿™æ–¹é¢çŸ¥è¯†ååˆ†å¿…è¦ã€‚Profilerèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨æ•°æ®é©±åŠ¨çš„å½¢å¼ä¸‹ä¼˜åŒ–ä»£ç ï¼Œä½†å¹¶ä¸ä¼šæœ‰åŠ©äºæˆ‘ä¸€å¼€å§‹å°±å†™å‡ºé«˜è´¨é‡ã€ç¬¦åˆç›¸åº”è®¾å¤‡ç‰¹æ€§çš„ä»£ç ã€‚è€Œæ·±å…¥äº†è§£CUDAå¯¹ç†è§£è®¡ç®—æœºå†…éƒ¨ä¸€äº›åº•å±‚çš„å®ç°éå¸¸æœ‰å¸®åŠ©ï¼Œæ¯”å¦‚è¯´ï¼šå†…å­˜è®¿é—®ï¼Œå­˜å‚¨ç»“æ„ï¼Œæµæ°´çº¿è®¾è®¡ï¼Œå¸¦å®½åˆ©ç”¨... ç­‰ç­‰ã€‚</p>
<p>â€‹ ä¸ºäº†è¿›ä¸€æ­¥ç²¾è¿›CUDAæŠ€æœ¯ï¼Œæˆ‘åˆè®¾è®¡äº†ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼šç²’å­æ»¤æ³¢åŠ é€Ÿã€‚æœ¬æ¥æ˜¯æƒ³ç»™ä¹‹å‰çš„<a href="https://enigmatisms.github.io/2021/08/07/Particle-Filter-Simulation/">ã€Particle Filter Simulationã€‘</a>è¿™ç¯‡åšæ–‡ä¸­ä½¿ç”¨çš„Volume2Dç®—æ³•è¿›è¡ŒåŠ é€Ÿï¼Œä½†åšç€åšç€å°±å‘ç°è¯¥ç®—æ³•ä¸é€‚åˆåŠ é€Ÿï¼Œé‚æ¨å€’é‡æ¥ï¼Œé‡æ„çš„è¿‡ç¨‹ä¸­å­¦ä¹ äº†å¾ˆå¤šæ–°çš„çŸ¥è¯†ã€‚æ•´ä¸ªé¡¹ç›®ä½œä¸º <strong><u>æ¿€å…‰é›·è¾¾ä»¿çœŸå™¨LiDARSim2D</u></strong>çš„ä¸€ä¸ªè¡¥å……æ¨¡å—ï¼Œç°åœ¨æ›´æ–°åœ¨äº†<a href="https://github.com/Enigmatisms/LiDARSim2D">[ä»¿çœŸå™¨repoï¼šLiDARSim2D]</a>ä¸‹ã€‚</p>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/pic1.png"></p>
<center>
Figure 1. ç²’å­å¹¿åœº
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-pf-gpuç®¡çº¿">II. PF-GPUç®¡çº¿</h2>
<h3 id="ä¹‹å‰çš„ç®—æ³•">2.1 ä¹‹å‰çš„ç®—æ³•</h3>
<p>â€‹ ä¹‹å‰çš„ç²’å­æ»¤æ³¢åŸºäºVolume2Dç®—æ³•ï¼Œä¸»è¦é—®é¢˜æœ‰ä¸¤ä¸ªï¼š</p>
<div class="tabs" id="algos"><ul class="nav-tabs"><li class="tab active"><a href="#algos-1">é€Ÿåº¦æ…¢</a></li><li class="tab"><a href="#algos-2">äºŒç»´å®šä½</a></li></ul><div class="tab-content"><div class="tab-pane active" id="algos-1"><p>ä¸æ˜¯è¯´Volume2Dç®—æ³•æ…¢ï¼ŒVolume2Dç®—æ³•è™½ç„¶æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯å•æ¬¡ä¹Ÿèƒ½åªèŠ±0.2mså°±ç®—å‡ºç»“æœæ¥ã€‚è€Œé—®é¢˜æ˜¯ï¼Œç²’å­æ»¤æ³¢éœ€è¦è®¡ç®—æˆåƒä¸Šä¸‡æ¬¡ï¼Œ0.2msåœ¨2000ç²’å­çš„æƒ…å†µä¸‹ï¼Œç»è¿‡8çº¿ç¨‹åŠ é€Ÿï¼Œä¹Ÿå°±å¤§æ¦‚6fpsçš„æ ·å­ï¼Œè¿œè¿œè¾¾ä¸åˆ°å®æ—¶æ€§è¦æ±‚ã€‚</p></div><div class="tab-pane" id="algos-2"><p>å‰ä¸€ç‰ˆç®—æ³•ï¼Œåªå¯¹2Dï¼ˆx,yï¼‰è¿›è¡Œäº†å®šä½ï¼Œè¿™å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ—‹è½¬è¿™ä¸ªç»´åº¦ï¼Œè™½ç„¶ç›¸å¯¹å¹³ç§»æ¥è¯´åªæœ‰ä¸€ç»´ï¼Œä½†æ˜¯å…¶å¯¹ç»“æœçš„å½±å“ä¸€èˆ¬æ¥è¯´éƒ½æ›´å¤§ã€‚ï¼ˆæ—‹è½¬å¯¼è‡´è§†è§’å˜åŒ–ï¼Œè§†è§’å˜åŒ–å¯¼è‡´è§‚æµ‹å¯ä»¥å‘ç”Ÿå·¨å¤§æ”¹å˜ï¼‰ã€‚æ­¤å¤–ï¼Œä¸åšè§’åº¦ç»´åº¦çš„æ»¤æ³¢ä½¿å¾—è¿™ä¸ªç²’å­æ»¤æ³¢ç›´æ¥å¤±å»äº†å½“2Då»ºå›¾ä¸­çš„ä¸€ä¸ªé™„åŠ ç®—æ³•æ¨¡å—çš„å¯èƒ½ã€‚</li>
<li>ä¸ºäº†ä¿è¯é‡‡æ ·å……åˆ†ï¼Œä¸‰ä¸ªç»´åº¦æ¯”ä¸¤ä¸ªç»´åº¦éœ€è¦æ›´å¤šçš„é‡‡æ ·ç‚¹ï¼ˆæ¯”å¦‚ä¹‹å‰å¦‚æœæ˜¯1600=40*40ï¼Œé‚£ä¹ˆç›´è§‰ä¸Šæ¥è¯´ï¼Œä¸‰ç»´åº”è¯¥éœ€è¦40*40*40=64000ï¼‰ï¼Œè¿™å°±å¼•å›åˆ°ç¬¬ä¸€ä¸ªâ€œè®¡ç®—æ…¢â€çš„é—®é¢˜ä¸Šäº†ï¼ˆ20000ç‚¹ï¼Œ0.6fpsï¼‰ã€‚</li>
</ul></div></div></div>
<p>â€‹ ä¸¤ä¸ªé—®é¢˜éƒ½æ˜¯æ— æ³•æ¥å—çš„ï¼ï¼ï¼ï¼ä¸è¿‡ï¼<strong><u>è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„å…³é”®ï¼Œæ˜¯è§£å†³é€Ÿåº¦é—®é¢˜</u></strong>ã€‚é€Ÿåº¦ä¸Šå»äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ¥å—æ›´å¤šç‚¹çš„é‡‡æ ·ï¼Œä¹Ÿå°±èƒ½è§£å†³ç»´åº¦é—®é¢˜ã€‚äºæ˜¯æˆ‘å¼€å§‹æ€è€ƒå¦‚ä½•åŠ é€ŸVolume2Dè®¡ç®—ï¼ŒVolume2Dè§<a href="https://enigmatisms.github.io/2021/08/02/Volume2D-Shader-Pro/">[æˆ‘çš„åšæ–‡]</a>ã€‚å…¶ä¸­æœ€æœ‰å¹¶è¡ŒåŠ é€Ÿå¸Œæœ›çš„åœ°æ–¹åœ¨è¿™ï¼š</p>
<details class="note warning"><summary><p>é•¿ä»£ç æ®µ</p>
</summary>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ParticleFilter::edgeIntersect</span><span class="params">(<span class="type">const</span> Edge&amp; eg, <span class="type">const</span> Eigen::Vector2d&amp; obs, std::vector&lt;<span class="type">double</span>&gt;&amp; range)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> angle_start = eg.<span class="built_in">front</span>().<span class="built_in">z</span>(), angle_end = eg.<span class="built_in">back</span>().<span class="built_in">z</span>();</span><br><span class="line">    <span class="type">int</span> id_start = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>((angle_start + M_PI) / angle_incre)), </span><br><span class="line">        id_end = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">floor</span>((angle_end + M_PI) / angle_incre));</span><br><span class="line">    <span class="keyword">if</span> (id_start == id_end + <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (id_start &gt; id_end) &#123;            <span class="comment">// å¥‡å¼‚è§’åº¦</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = id_start; i &lt; ray_num; i++) &#123;</span><br><span class="line">            <span class="type">double</span> angle = angle_incre * <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(i) - M_PI;</span><br><span class="line">            <span class="function">Eigen::Vector3d <span class="title">vec</span><span class="params">(cos(angle), sin(angle), angle)</span></span>;</span><br><span class="line">            Eigen::Vector2d intersect = eg.<span class="built_in">getRayIntersect</span>(vec, obs);</span><br><span class="line">            range[i] = intersect.<span class="built_in">norm</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= id_end; i++) &#123;</span><br><span class="line">            <span class="type">double</span> angle = angle_incre * <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(i) - M_PI;</span><br><span class="line">            <span class="function">Eigen::Vector3d <span class="title">vec</span><span class="params">(cos(angle), sin(angle), angle)</span></span>;</span><br><span class="line">            Eigen::Vector2d intersect = eg.<span class="built_in">getRayIntersect</span>(vec, obs);</span><br><span class="line">            range[i] = intersect.<span class="built_in">norm</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = id_start; i &lt;= id_end; i++) &#123;</span><br><span class="line">            <span class="type">double</span> angle = angle_incre * <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(i) - M_PI;</span><br><span class="line">            <span class="function">Eigen::Vector3d <span class="title">vec</span><span class="params">(cos(angle), sin(angle), angle)</span></span>;</span><br><span class="line">            Eigen::Vector2d intersect = eg.<span class="built_in">getRayIntersect</span>(vec, obs);</span><br><span class="line">            range[i] = intersect.<span class="built_in">norm</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>
<p>â€‹ ä½†æ˜¯å®é™…ç¼ºå¾ˆéš¾åšï¼Œä¸€æ˜¯å› ä¸ºæ­¤å¤„æ±‚äº¤ç‚¹æ˜¯é’ˆå¯¹ä¸€æ®µæŠ˜çº¿ï¼Œéœ€è¦å…ˆæ—‹è½¬æ•°ç»„äºŒåˆ†æŸ¥æ‰¾ã€‚æ­¤å¤–ï¼ŒEdgeè¿™ä¸ªæ•°æ®ç»“æ„ä¹Ÿä¸æ–¹ä¾¿ä½¿ç”¨ï¼ˆå˜é•¿Eigen::Vector2dçš„dequeï¼‰ï¼Œè¿˜é€¼å¾—æˆ‘äº†è§£äº†ä¸€ä¸‹thrustçš„libcu++ vectorã€‚é‚æ”¾å¼ƒåŠ é€Ÿã€‚</p>
<h3 id="æ¸²æŸ“ç®¡çº¿">2.2 æ¸²æŸ“ç®¡çº¿</h3>
<p>â€‹ çªç„¶æœ‰ä¸€å¤©ä¸Šåˆï¼Œæˆ‘è§‰å¾—è‡ªå·±ä¹‹å‰å¾ˆè ¢ï¼šä¹‹å‰çš„ç²’å­æ»¤æ³¢æ˜¯å†™ç€ç©çš„ï¼Œè¦ä¸ç„¶æ±‚range imageçš„æ–¹æ³•ä¹Ÿä¸ä¼šæ˜¯è¿™æ ·ï¼ˆå½“æ—¶å› ä¸ºå—Volume2Dçš„å¯å‘ï¼Œæƒ³è¦å¤ç”¨ä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼‰ã€‚äº‹å®è¯æ˜ï¼Œè¿™ä¸ªç®—æ³•ä¸é€‚åˆæ±‚æ·±åº¦å›¾ã€‚æƒ³åˆ°è¿™ä¸ªï¼Œæˆ‘ç›´æ¥å¼€å§‹æ€è€ƒç”¨æ¿€å…‰é›·è¾¾æ¨¡å‹</p>
<blockquote>
<p>æˆ‘ç§°ä¹‹ä¸ºï¼šæ­£å‘æ³•ï¼Œä¹Ÿå³æ±‚æ¿€å…‰é›·è¾¾å‘å°„å…‰çº¿ç”Ÿæˆæ·±åº¦å›¾çš„æ¨¡å‹ã€‚</p>
</blockquote>
<p>â€‹ æ·±åº¦å›¾è·å–ï¼Œåœ¨æˆ‘çœ‹æ¥å°±æ˜¯ä¸€æ¡GPUæ¸²æŸ“ç®¡çº¿ï¼ˆæ¸²æŸ“ç»å¸¸åšè¿™ä¸ªäº‹æƒ…å•Šï¼‰ï¼Œè€Œä¸”æˆ‘è§‰å¾—æœ¬é—®é¢˜ç”¨GPUå®ç°å®åœ¨å¤ªé€‚åˆäº†ï¼ŒåŸå› æœ‰äºŒï¼š</p>
<ul>
<li>æ¯ä¸ªç²’å­æ ¹æ®æ­¤æ—¶çš„ä½å§¿æ±‚æ·±åº¦å›¾ï¼Œè¿›è€Œæ±‚é‡é‡‡æ ·æƒé‡ï¼Œæ˜¯å®Œå…¨ç›¸äº’ç‹¬ç«‹çš„ã€‚</li>
<li>æ¯ä¸ªç²’å­å†…éƒ¨ï¼Œæ¸²æŸ“æ·±åº¦å›¾ä½¿ç”¨Z bufferæ–¹æ³•ï¼Œåº”è¯¥æ˜¯æœ‰å¾ˆä¸é”™çš„å¹¶è¡Œåº¦çš„ã€‚</li>
</ul>
<p>â€‹ äºæ˜¯æˆ‘ç›´æ¥è®¾è®¡äº†ä¸€ä¸ªZ bufferæ–¹æ³•ï¼š</p>
<center>
<img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/zbuf.png" style="zoom:50%;">
</center>
<center>
Figure 2. Z buffer æ–¹æ³•è¯´æ˜
</center>
<p>â€‹ Z buffer å¾ˆå¥½ç†è§£ï¼Œå®ƒä¸Volume2Dçš„å¼‚åŒæ˜¯ï¼š</p>
<div class="tabs" id="princ"><ul class="nav-tabs"><li class="tab active"><a href="#princ-1">ä½“ç§¯å…‰ç®—æ³•</a></li><li class="tab"><a href="#princ-2">Z Buffer</a></li></ul><div class="tab-content"><div class="tab-pane active" id="princ-1"><p>è®¡ç®—å“ªäº›åœ°å›¾è¾¹ç•Œèƒ½è¢«å®é™…è§‚æµ‹åˆ°ï¼ˆè®¡ç®—é®æŒ¡å…³ç³»ï¼Œæ±‚å‡ºæ²¡è¢«é®æŒ¡çš„æ‰€æœ‰è¾¹ï¼‰ï¼Œä½¿ç”¨æœªè¢«é®æŒ¡çš„è¾¹è®¡ç®—æ¿€å…‰äº¤ç‚¹ä»¥åŠå¯¹åº”æ·±åº¦ã€‚</p></div><div class="tab-pane" id="princ-2"><p>ä¸ç®¡é®æŒ¡å…³ç³»ï¼Œæ¿€å…‰ä¸æ‰€æœ‰å¯èƒ½è¾¹ç›¸äº¤ï¼Œå–ç¦»è‡ªå·±æœ€è¿‘çš„é‚£ä¸ªå€¼ï¼ˆæœ€å°å€¼ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒZ bufferç›´æ¥è®¡ç®—æ‰€æœ‰å¯èƒ½çš„ç›¸äº¤ï¼Œæ±‚æœ€å°å€¼ã€‚</p></div></div></div>
<hr>
<h2 id="iii.-ç®—æ³•è®¾è®¡">III. ç®—æ³•è®¾è®¡</h2>
<h3 id="ç¬¬ä¸€ä»£">3.1 ç¬¬ä¸€ä»£</h3>
<blockquote>
<p>æ•°æ®å…³è”è¶Šä¸ç´§å¯†çš„ï¼Œå¹¶è¡Œçš„ç²’åº¦åº”è¯¥è¶Šç²—ã€‚--- æˆ‘çš„ç†è§£</p>
</blockquote>
<p>â€‹ è¿™ä¹ˆè¯´çš„åŸå› æ˜¯ï¼šæ•°æ®å…³è”ç´§å¯†çš„ï¼Œå¯èƒ½å¯ä»¥ä½¿ç”¨å…±äº«å†…å­˜ã€‚æ¯”å¦‚æœ¬é—®é¢˜ä¸­ï¼Œä¸åŒç²’å­ä¹‹é—´ï¼Œç»è¿‡èƒŒé¢å‰”é™¤(back culling)ä¹‹åçš„è¾¹éƒ½ä¸ä¸€è‡´ï¼Œå¹¶ä¸”è§‚æµ‹ç‚¹ä¹Ÿä¸ä¸€è‡´ï¼Œä¸é€‚åˆæ”¾åœ¨åŒä¸€ä¸ªblockå†…éƒ¨ï¼Œæ•…ä¸€ä¸ªç²’å­åº”è¯¥æ˜¯ä¸€ä¸ªblockã€‚è€Œblockå†…éƒ¨ç»†ç²’åº¦çš„å¹¶è¡Œï¼Œåº”è¯¥é’ˆå¯¹ã€ä¸€ä¸ªç¡®å®šç²’å­ä¸‹ï¼ˆè§‚æµ‹ç‚¹ç¡®å®šï¼‰ã€‘çš„æ‰€æœ‰åœ°å›¾è¾¹ï¼ˆåœ°å›¾ä¸¤ä¸ªç›¸è¿è§’ç‚¹ç¡®å®šçš„çº¿æ®µï¼‰ï¼ˆè§ä¸‹å›¾è¯´æ˜ï¼šï¼‰</p>
<center>
<img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/para.png" style="zoom:50%;">
</center>
<center>
Figure 3. å¹¶è¡Œè¯´æ˜
</center>
<p>â€‹ ä¸åŒçš„è§‚æµ‹ç‚¹ä½äºä¸åŒblockï¼ŒåŒä¸€è§‚æµ‹ç‚¹ä¸‹çš„ä¸åŒçº¿æ®µï¼ˆæ¯”å¦‚observing point 1ä¸‹çš„åœ°å›¾çº¿æ®µï¼‰ï¼Œçº¿æ®µä¹‹é—´æ˜¯threadå¹¶è¡Œçš„ï¼ˆä¸åŒé¢œè‰²çº¿æ®µäº§ç”Ÿçš„æ·±åº¦ä¿¡æ¯æ˜¯å¹¶è¡Œè®¡ç®—çš„ï¼‰ã€‚ä½¿ç”¨çº¿æ®µè€Œä¸æ˜¯Edgeä½œä¸ºå¤„ç†å•å…ƒä»¥åŠè¿™æ ·è®¾ç½®å¹¶è¡Œå¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>çº¿æ®µæ˜¯å®šé•¿çš„æ•°æ®ï¼ˆ4ä¸ªfloatå°±å¯ä»¥è¡¨ç¤ºï¼‰</li>
<li>ä¸åŒblockå¯ä»¥åœ¨å¸¸é‡å†…å­˜ä¸­å…±ç”¨åŒä¸€ä¸ªåœ°å›¾ï¼ˆåˆå§‹çº¿æ®µï¼‰</li>
<li>åŒä¸€ä¸ªblockå†…å¤„ç†ä¸åŒçº¿æ®µçš„threadï¼Œå¯ä»¥å°†back cullingçš„ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªå…±äº«çš„flagæ•°ç»„ä¸Šï¼Œå¹¶ä¸”è®¡ç®—çš„æ·±åº¦å€¼ä¹Ÿå¯ä»¥ä½¿ç”¨å…±äº«å†…å­˜ä¿å­˜ï¼ŒåŠ é€Ÿå†…å­˜è¯»å†™ã€‚</li>
</ul>
<p>â€‹ äºæ˜¯åˆä»£ç®—æ³•çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>è§‚æµ‹ç‚¹æ•°ä¸ºgirdDim.xï¼ˆä¹Ÿå³blockæ•°ï¼‰ï¼ˆ10000+ï¼‰ï¼Œçº¿æ®µæ•°é‡ä¸ºblockDim.xï¼ˆä¹Ÿå³çº¿ç¨‹æ•°ï¼‰ï¼ˆé€šå¸¸å°äº400ï¼‰.</li>
</ul>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/flow.png"></p>
<center>
Figure 4. ç®—æ³•æµç¨‹
</center>
<p>â€‹ ç”±äºç¬¬ä¸€ä»£ç®—æ³•å‡ ä¹å°±æ˜¯æ•´ä¸ªç®—æ³•çš„æ€æƒ³ä¸»ä½“ï¼ˆä¹‹åçš„éƒ½æ˜¯ä¼˜åŒ–è¿­ä»£ï¼Œæ²¡æœ‰å¤§æ”¹ï¼‰ï¼Œé‡ç‚¹è¯´ä¸€ä¸‹ã€‚</p>
<h4 id="èƒŒé¢å‰”é™¤">3.1.1 èƒŒé¢å‰”é™¤</h4>
<p>â€‹ èƒŒé¢å‰”é™¤éœ€è¦flagsï¼šè¾“å…¥çš„æ˜¯åŸå§‹åœ°å›¾ï¼ŒåŸå§‹åœ°å›¾ä¸­æœ‰äº›çº¿æ®µæ˜¯ä¸éœ€è¦çš„ï¼ˆèƒŒé¢ï¼‰ï¼Œåœ¨èƒŒé¢å‰”é™¤å‡½æ•°ä¸­æ¯ä¸ªçº¿ç¨‹è®¡ç®—è‡ªå·±å¯¹åº”çš„çº¿æ®µæ˜¯å¦æ˜¯æ­£é¢ï¼Œä¿å­˜åœ¨flagä¸­ã€‚ä»¥ä¸‹ä»£ç å—æ˜¯åŠ¨æ€å†…å­˜åˆ†é…ï¼Œå¹³å‡æ¯ä¸ªblockä½¿ç”¨1-2KBçš„å…±äº«å†…å­˜ï¼ˆå¾ˆèŠ‚çº¦ï¼‰ã€‚ç”±äºCUDAåŠ¨æ€å…±äº«å†…å­˜ <strong><u>åªæœ‰è¿™ä¸€ç§æ–¹æ³•åˆ†é…</u></strong>ï¼Œæ‰€ä»¥è·¨ç±»å‹æˆ–è€…å¤šæ•°ç»„æ˜¯ä¸å¯èƒ½ç›´æ¥å†™çš„ï¼Œéœ€è¦å¼ºè½¬æŒ‡é’ˆï¼ˆæˆ‘å“¥å»ºè®®æˆ‘ä½¿ç”¨reinterpret_castæ¥å®ŒæˆæŒ‡é’ˆè½¬æ¢ï¼Œä½†æ˜¯æˆ‘å‘ç°è¿™æ ·ä¹Ÿæ²¡é—®é¢˜ï¼‰ã€‚æ³¨æ„ç”±äºåˆ†é…çš„æ˜¯intæ•°ç»„ï¼Œæ•…åœ¨kernel launchæ—¶ï¼ŒæŒ‡å®šçš„æ•°ç»„å­—èŠ‚æ•°éœ€è¦ä¸º4çš„æ•´æ•°å€ï¼ˆboolåªå 1å­—èŠ‚ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦paddingï¼‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> __shared__ <span class="type">int</span> range[];          <span class="comment">//...ä¸€ä¸ªæ•°æ®ç±»å‹åˆ†ä¸ºäº†ä¸¤ä¸ªä¸åŒæ„ä¹‰ä»¥åŠç±»å‹çš„å—</span></span><br><span class="line"><span class="type">bool</span>* flags = (<span class="type">bool</span>*)(&amp;range[range_num]);</span><br></pre></td></tr></table></figure>
<h4 id="å•çº¿æ®µz-buffer">3.1.2 å•çº¿æ®µZ buffer*</h4>
<p>â€‹ å‡è®¾æœ¬threadçš„idå¯¹åº”çš„çº¿æ®µéœ€è¦è¢«å¤„ç†ï¼ˆäº‹å®ä¸Šå¦‚æœä¸éœ€è¦è¢«å¤„ç†ï¼Œä¼šç›´æ¥returnï¼Œè¿™ç¡®å®ä¼šå¼•èµ·warp divergenceï¼Œä½†æ˜¯overheadå¯ä»¥å¿½ç•¥ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¡ç®—è¿™ä¸ªçº¿æ®µäº§ç”Ÿçš„å±€éƒ¨æ·±åº¦å›¾ã€‚</p>
<p>â€‹ å…¶ä¸­çš„éš¾ç‚¹åœ¨äºæ§åˆ¶é€»è¾‘ï¼š<strong><u>-PI~PI</u></strong>æ˜¯atan2çš„è§’åº¦è¾“å‡ºèŒƒå›´ï¼Œè§’åº¦å¥‡å¼‚æ€§ï¼ˆç”±äºæ˜¯é€†æ—¶é’ˆï¼Œä¸€èˆ¬æƒ…å†µä¸‹èµ·å§‹ç‚¹è§’åº¦å°äºç»ˆæ­¢ç‚¹ï¼Œä½†æ˜¯è·¨<span class="math inline">\(\pm\pi\)</span>ç•Œé™ï¼ˆxè´ŸåŠè½´ï¼‰æ—¶ä¼šå‡ºç°å¥‡å¼‚ï¼‰ä¼šå½±å“æ•°ç»„ä¸‹æ ‡ / è§’åº¦idç­‰ç­‰çš„è®¡ç®—ï¼Œè¿™é‡Œä¸å¤šè®²ï¼Œæœ‰å…´è¶£ç›´æ¥çœ‹ä»£ç å§ã€‚</p>
<p>â€‹ æ­¤å¤–é‡è¦çš„ä¸€ç‚¹å°±æ˜¯ï¼šZ bufferä¿å­˜çš„å§‹ç»ˆæ˜¯æŸä¸ªè§’åº¦ä¸Šæ·±åº¦çš„æœ€å°å€¼ï¼Œä½†æ˜¯å¦‚ä½•è®¡ç®—æœ€å°ï¼Ÿéœ€è¦æˆ‘ä»¬æŠŠæ‰€æœ‰çº¿æ®µæ·±åº¦ç®—å‡ºæ¥ç„¶åæ±‚æœ€å°ï¼Ÿ<strong><u>æ˜¾ç„¶ä¸æ˜¯ï¼Œè¿™æ ·å¤ªæ…¢äº†ï¼Œè€Œä¸”éœ€è¦çº¿ç¨‹é—´æ•°æ®äº¤æµï¼ˆå…±äº«å†…å­˜ï¼‰</u></strong>ã€‚æˆ‘ä»¬è€ƒè™‘å¢é‡å¼çš„æ–¹æ³•ï¼š</p>
<div class="note primary"><p>â€‹ è®¡ç®—å€¼æ¯æ¬¡å’Œæ·±åº¦å€¼æ•°ç»„rangeï¼ˆå…±äº«å†…å­˜ï¼‰å¯¹åº”idè¿›è¡Œæ¯”è¾ƒï¼Œä¿ç•™æ›´å°çš„å€¼ã€‚ä½†æ˜¯è¿™ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼š<strong><u>çº¿ç¨‹è®¿é—®å†²çª</u></strong>ã€‚</p>
</div>
<div class="note success"><p>â€‹ ä½¿ç”¨åŸå­æ“ä½œï¼åŸå­åœ°è¿›è¡Œæ¯”è¾ƒå¹¶ä¸”æ›¿æ¢ä¸ºæ›´å°å€¼å°±è¡Œã€‚ä½†æ˜¯å¾ˆå¯æƒœï¼š<strong><u>CUDAä¸æ”¯æŒfloatåŸå­æ¯”è¾ƒ</u></strong>ã€‚</p>
</div>
<p>â€‹ é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿstackoverflowä¸Šæœ‰äººç»™äº†æ–¹æ³•ï¼š</p>
<div class="note info"><p>â€‹ æŠŠFloatç›´æ¥æŒ‰ä½è§£é‡Šä¸ºintï¼Œå¯¹æ­¤intè¿›è¡Œä¸€äº›è®¡ç®—ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªå¯ä»¥ä¿åºçš„ï¼ˆorderedï¼‰intï¼Œå¯¹intè¿›è¡ŒåŸå­æ¯”è¾ƒå¯ä»¥ä½¿ç”¨atomicMinã€‚</p>
</div>
<p>â€‹ å…³äºOrdered intè½¬æ¢ï¼Œè§è¿™ç¯‡åˆ«äººå†™çš„åšå®¢<a href="http://stereopsis.com/radix.html">[Float radix sort]</a>, ä»¥åŠstackoverflowä¸Šçš„<a href="https://stackoverflow.com/questions/17399119/how-do-i-use-atomicmax-on-floating-point-values-in-cuda">[ä¸€ä¸ªå›ç­”]</a>ï¼ˆæœ€é«˜èµçš„æ˜¯é”™çš„ï¼ŒInformate.itå†™çš„æ˜¯å¯¹çš„ï¼‰ã€‚åŸå­æ“ä½œååˆ†é¦™ï¼Œè€Œä¸”æ„Ÿè§‰å¾ˆä¼˜é›…ã€‚</p>
<h4 id="ç›¸ä¼¼åº¦æƒé‡">3.1.3 ç›¸ä¼¼åº¦æƒé‡</h4>
<p>â€‹ æ‰€æœ‰çº¿ç¨‹è®¡ç®—ç»“æŸä¹‹åï¼ˆç›¸å½“äºæœ¬ç²’å­å¯¹åº”è§‚æµ‹ç‚¹çš„æ·±åº¦å›¾ç®—å®Œäº†ï¼‰ï¼Œä¸€ä¸ªblockå†…è®¡ç®—å‚è€ƒæ·±åº¦å›¾ä¸æœ¬è§‚æµ‹ç‚¹æ·±åº¦å›¾çš„L1è¯¯å·®<span class="math inline">\(L_e\)</span>ï¼Œ<span class="math inline">\(1/(L_e+1)\)</span>æ˜¯æœ¬è§‚æµ‹ç‚¹çš„æƒé‡ã€‚</p>
<h3 id="ä¹‹åçš„ä¼˜åŒ–">3.2 ä¹‹åçš„ä¼˜åŒ–</h3>
<p>â€‹ ç¬¬ä¸€ä»£ç®—æ³•å­˜åœ¨ä¸€äº›é€Ÿåº¦ç¼ºé™·ï¼š</p>
<ul>
<li>ä½¿ç”¨doubleï¼Œè¿›è¡Œè®¡ç®—ï¼šCUDAå¯¹doubleå¹¶ä¸æ˜¯ç‰¹åˆ«å‹å¥½ï¼Œä¸€äº›doubleå‡½æ•°æ¯”å¦‚atan2å°±æ›´ä¸ç”¨è¯´äº†ã€‚intä¹Ÿæ˜¯æ»¥ç”¨äº†ï¼Œæœ‰äº›æ•°å­—ä½¿ç”¨shortå³å¯ï¼Œå®Œå…¨ä¸å¿…ç”¨intã€‚</li>
<li>Z bufferä¸­çš„çº¿æ®µæ±‚äº¤ç‚¹å‡½æ•°<code>__device__ __forceinline__ float getRange(...)</code>å†…éƒ¨è¿‡å¤šEigenæˆ–è€…è‡ªå®šä¹‰æ•°æ®ç»“æ„çš„é‡å¤ç´¢å¼•æ“ä½œï¼Œå¹¶ä¸”æœ‰äº›è®¡ç®—æ²¡æœ‰å¤ç”¨ã€‚è¿™ä¸ªå‡½æ•°æ˜¯æ•´ä¸ªå•çº¿æ®µZ bufferçš„ç“¶é¢ˆã€‚</li>
<li>ä½¿ç”¨Eigenï¼Œåº“è™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢äº†</li>
<li><strong><u>ï¼ˆé‡è¦ï¼‰ï¼š</u></strong>å¹¶è¡Œåº¦ä½ï¼Œæ²¡æœ‰ä½¿ç”¨æµæ°´çº¿(stream)ï¼Œå•kernelï¼ŒGPUå ç”¨å·¨å¤§ã€‚</li>
</ul>
<p>â€‹ ç¬¬ä¸€ä¸ªé—®é¢˜ä¼˜åŒ–ä¹‹åï¼Œä½¿å¾—æˆ‘çš„ç®—æ³•ä»ä¸CPUå·®ä¸å¤šçš„é€Ÿåº¦å‡åˆ°çš„CPUçš„äº”å€ï¼ˆç›¸æ¯”äº8çº¿ç¨‹ï¼‰ï¼Œç¬¬äºŒä¸‰ä¸ªé—®é¢˜ä¿®æ­£ä½¿å¾—æˆ‘çš„é€Ÿåº¦ä¸Šå‡ä¸ºCPUé€Ÿåº¦çš„16å€ï¼ˆç›¸æ¯”äº8çº¿ç¨‹ï¼‰ï¼Œè€Œprofileä»¥åŠæµæ°´çº¿ä¼˜åŒ–ä½¿å¾—æˆ‘çš„ç®—æ³•å…ˆåè¾¾åˆ°äº†32xï¼Œ45xåŠ é€Ÿï¼æ‰€ä»¥æˆ‘é‡ç‚¹è¯´ä¸€ä¸‹stream concurrencyã€‚</p>
<h3 id="stream-concurrency">3.3 Stream Concurrency</h3>
<p>â€‹ streamï¼Œç¿»è¯‘æ˜¯â€œæµâ€ï¼Œæˆ‘å°†å…¶ç†è§£æˆä¸ºæµæ°´çº¿ã€‚å®é™…ä¸Šæ˜¯GPUçš„ä¸€ä¸ªæ“ä½œâ€œé˜Ÿåˆ—â€ï¼š</p>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/nvvp.png"></p>
<center>
Figure 5. streamç¤ºæ„å›¾[1]
</center>
<p>streamæœ‰è¿™æ ·çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªkernelæˆ–è€…æ˜¯cudaæ“ä½œï¼ˆæ¯”å¦‚Memcpyï¼‰åœ¨åŒä¸€ä¸ªstreamä¸‹è¢«launchï¼Œé‚£ä¹ˆæ˜¯æŒ‰ç…§issue-orderï¼ˆå‘å°„çš„é¡ºåºï¼‰æ‰§è¡Œï¼ˆä¸ä¹‹ç›¸å¯¹çš„æ˜¯ä¹±åºå‘å°„ï¼‰ã€‚</li>
<li>å¦‚æœåˆ†é…åˆ°ä¸åŒçš„streamä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¹±åºæ‰§è¡Œï¼Œå¹¶ä¸”æ ¹æ®GPUèµ„æºåˆ©ç”¨æƒ…å†µï¼Œå¯èƒ½æœ‰overlapã€‚</li>
</ul>
<p>â€‹ é‚£ä¹ˆæ˜¾ç„¶ï¼Œoverlapå¤šå¤§ï¼Œè¯´æ˜GPUè¶Šä¸å®¹æ˜“ç©ºé—²ï¼Œå¾ˆå¯èƒ½å¯ä»¥æœ‰å‡ ä¸ªkernelå‡½æ•°çš„å¹¶è¡Œæ‰§è¡Œï¼Œç›¸å½“äºæµæ°´çº¿æ“ä½œï¼Œä¸Šä¸€ä¸ªkernelè¿˜æ²¡æ‰§è¡Œå®Œï¼Œä¸‹ä¸€ä¸ªkernelå·²ç»å¼€å§‹äº†ã€‚å¦‚æœä¸æŒ‡å®šstreamï¼Œä½¿ç”¨default streamï¼Œé‚£ä¹ˆprofileå¾—åˆ°çš„å›¾ä¼šæ˜¯ä¸€ä¸ªå®Œå…¨é˜¶æ¢¯çŠ¶çš„ï¼Œé˜¶æ¢¯ä¹‹é—´ä¸€èˆ¬æ²¡æœ‰å¹¶è¡Œï¼ˆissue-orderé™åˆ¶ï¼‰ï¼Œä¸€å¼€å§‹æˆ‘å°±æ˜¯å•streamæ‰§è¡Œçš„ï¼Œ<strong><u>å¹¶ä¸”æ˜¯ä¸€ä¸ªè¶…å¤§çš„kernelï¼ˆéœ€è¦å¤„ç†ä¸Šä¸‡ä¸ªblockï¼‰</u></strong>ã€‚</p>
<p>â€‹ å½“æˆ‘æ„è¯†åˆ°è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘å°†kernelæ‹†åˆ†äº†ï¼Œåå¤è°ƒç”¨particle filterè¿™ä¸ªæ ¸å‡½æ•°ï¼Œä¸è¿‡æ¯æ¬¡åªå¤„ç†ä¸åˆ°100ä¸ªblockã€‚å¼€å§‹æ—¶è·‘çš„æ•ˆæœå¹¶ä¸å¥½ï¼Œ<strong><u>ç›´åˆ°æˆ‘ä½¿ç”¨äº†CUDA Profiler</u></strong>ï¼Œå°†è¿è¡ŒçŠ¶æ€ç»˜åˆ¶å‡ºæ¥ä¹‹åå‘ç°ï¼Œè¯¶ï¼Ÿå®Œå…¨é˜¶æ¢¯çŠ¶çš„kernelè°ƒç”¨ï¼Œå¹¶ä¸”profilerä¹Ÿå‘Šè¯‰æˆ‘ï¼šâ€œ<strong><u>kernel overlap too small: 0%</u></strong>â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œblockå‡ ä¹æ˜¯é¡ºåºè®¡ç®—çš„ï¼Œè¿™æ ·çš„æ•ˆç‡å¤ªä½ï¼</p>
<p>â€‹ æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™[1][2][3]ï¼Œæœ€åç¡®å®šä½¿ç”¨streamï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">cudaStream_t streams[<span class="number">8</span>];</span><br><span class="line">streams[<span class="number">0</span>] = cudaStreamDefault;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    <span class="built_in">cudaStreamCreateWithFlags</span>(&amp;streams[i],cudaStreamNonBlocking);</span><br><span class="line"><span class="comment">// cudaProfilerStart();</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; cascade_num; i++) &#123;</span><br><span class="line">    particleFilter &lt;&lt;&lt; <span class="number">16</span>, seg_num, shared_to_allocate, streams[i % <span class="number">8</span>]&gt;&gt;&gt; (...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CUDA_CHECK_RETURN</span>(<span class="built_in">cudaDeviceSynchronize</span>());</span><br><span class="line"><span class="comment">// cudaProfilerStop();</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    <span class="built_in">cudaStreamDestroy</span>(streams[i]);</span><br></pre></td></tr></table></figure>
<p>â€‹ åˆ›å»ºäº†ä¸åŒçš„streamï¼ˆcudaStreamNonBlockingï¼‰ï¼Œå¾ªç¯åœ°æŠŠä¸åŒçš„kernelï¼ˆå¤„ç†particlesçš„ä¸åŒoffsetä½ç½®ï¼‰å‘å°„åˆ°ä¸åŒçš„streamä¸Šï¼Œå®ç°æ›´åŠ ç´§å‡‘çš„å¹¶è¡Œã€‚cudaStreamDefault åœ¨CUDA7ä¹‹åä¸ä¼šæœ‰ä¹‹å‰çš„éšå¼åŒæ­¥é—®é¢˜ï¼ˆé»˜è®¤streamä¼šå¯¼è‡´æ“ä½œä¸²è¡ŒåŒ–ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>â€‹ å½“ç„¶ï¼Œæµæ°´çº¿æœ€åçš„çº§æ•°ï¼Œblockçš„å¤§å°éƒ½æ˜¯profileè¯•ç€è°ƒæ•´è¿‡æ¥çš„ã€‚32xåŠ é€Ÿçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨çš„gridæœ‰ç‚¹è¿‡å°ï¼ˆ4ä¸ªç²’å­ï¼Œ8ä¸ªstreamsï¼‰ï¼š</p>
<ul>
<li>4ä¸ªç²’å­çš„kernelä¼šè¿…é€Ÿæ‰§è¡Œå®Œï¼Œä½†æ˜¯kernelæ—¶é—´å¹¶æ²¡æœ‰é•¿åˆ°å¯ä»¥å……åˆ†åˆ©ç”¨æµæ°´çº¿è°ƒåº¦ç©ºä½™æ—¶é—´ã€‚</li>
<li>æœ€åä½¿ç”¨16ä¸ªç²’å­çš„kernelï¼Œé€Ÿåº¦æåˆ°äº†45xï¼ˆprofileä¹‹åçªç„¶æƒ³åˆ°çš„ï¼‰</li>
</ul>
<h3 id="ä¸€äº›å…¶ä»–çš„åŠ é€Ÿå°è¯•">3.4 ä¸€äº›å…¶ä»–çš„åŠ é€Ÿå°è¯•</h3>
<p>â€‹ ä»¥ä¸‹æ˜¯è¯æ˜åœ¨æœ¬é—®é¢˜ä¸­æ— æ•ˆçš„åŠ é€Ÿå°è¯•ï¼š</p>
<ul>
<li>åŠ¨æ€å¹¶è¡Œï¼ˆdynamic parallelismï¼Œè¿™ä¹Ÿæ˜¯åœ¨ä¸Šä¸€ç¯‡CUDAåšå®¢ä¸­æŠ˜ç£¨æˆ‘çš„ä¸œè¥¿ï¼‰ã€‚<strong><u>è¿™ä¸ªå®Œå…¨æ²¡ç”¨ï¼</u></strong>åå€’æ˜¯å¢å¤§äº†æ¯ä¸ªkernelçš„çº¿ç¨‹èµ„æºæ¶ˆè€—ï¼ˆä¸€ä¸ªblockå°±åªæœ‰æœ€å¤š1024çº¿ç¨‹ï¼‰ï¼Œå¯¼è‡´ç®—æ³•å˜å¾—æ›´æ…¢ã€‚å¾ˆæ˜¾ç„¶å˜›ï¼Œä¸€ä¸ªblockå¤§æ¦‚200-300ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹è¿˜å¾—å†launchä¸€ä¸ªå­kernelï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œæ˜¾ç„¶èµ„æºä¼šä¸å¤Ÿã€‚</li>
<li>å†…å­˜ååæµæ°´æ“ä½œï¼šCUDAå¸Œæœ›æˆ‘åšè¿™ä¸ªäº‹æƒ…ï¼šå†…å­˜çš„ç§»åŠ¨æ˜¯å°å—å°å—çš„ï¼Œä¸è¦ä¸€èµ·å®Œæˆï¼Œå¦åˆ™æ²¡æœ‰å¤ªå¤§çš„æµæ°´çº¿åŠ é€Ÿæ•ˆæœã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼šå³ä½¿æ˜¯ä¸ªå‡ ç™¾MBçš„global memoryå¤åˆ¶ï¼Œä¹Ÿéå¸¸è¿…é€Ÿåœ°å®Œæˆäº†ï¼ˆè²Œä¼¼æ²¡åˆ°1msï¼‰</li>
</ul>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/cuda.png"></p>
<center>
Figure 6. CUDA streamåŒ–çš„ä¼˜åŠ¿
</center>
<ul>
<li>æ›´åŠ æ¿€è¿›çš„ä½å®½ä¼˜åŒ–ï¼ˆèƒ½æ¢shortå°±shortäº†ï¼‰ï¼Œå‰©ä½™çš„ä¸€äº›ä¼˜åŒ–ç”¨å¤„ä¸å¤§ã€‚</li>
<li>ç­‰ç­‰ç­‰ç­‰ï¼šå°è¯•äº†å¾ˆå¤šæ–¹æ³•ï¼Œä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</li>
</ul>
<h3 id="é‡‡æ ·ç‚¹ä¸è¶³">3.5 é‡‡æ ·ç‚¹ä¸è¶³</h3>
<p>â€‹ æ—‹è½¬å¯¹ç®—æ³•ç»“æœçš„å½±å“èƒ½åŠ›æ¯”å¹³ç§»å¤§ã€‚è¯•æƒ³ä¸€ä¸‹è‡ªå·±å¹³ç§»ä¸€äº›ä¹‹åçœ‹åˆ°çš„ä¸–ç•Œä¸æ—‹è½¬ä¸€ç‚¹çœ‹åˆ°çš„ä¸–ç•Œçš„å·®å¼‚å°±çŸ¥é“äº†ã€‚å¼€å§‹æ—¶ï¼Œè§’åº¦çš„é‡‡æ ·æ˜æ˜¾æ˜¯æ¬ ç¼ºçš„ï¼š</p>
<ul>
<li>ä¸‰ä¸ªè½´ä¸Šéƒ½ä½¿ç”¨å‡åŒ€åˆ†å¸ƒéšæœºæ•°ã€‚å› ä¸ºå¼€å§‹æ—¶æˆ‘å¸Œæœ›ä¿è¯ä¸‰ä¸ªç»´åº¦ä¸‹çš„é‡‡æ ·åº”è¯¥ä¸€è‡´ï¼Œä½†è¿™ç§åšæ³•å¹¶ä¸å¥½ï¼Œå› ä¸ºæˆ‘ <strong><u>å¹¶ä¸èƒ½ä¿è¯</u></strong>ï¼Œåœ¨æ¯ä¸€ä¸ªå¹³ç§»ä½ç½®ï¼Œæ—‹è½¬çš„é‡‡æ ·éƒ½è¶³å¤Ÿäº†ã€‚</li>
</ul>
<p>â€‹ ä¹‹åæˆ‘ä½¿ç”¨äº†å¦‚ä¸‹çš„ç­–ç•¥ï¼š12800ä¸ªç‚¹ï¼Œå…ˆåœ¨å¹³ç§»ä¸Šå‡åŒ€é‡‡æ ·1280ä¸ªç‚¹ï¼Œæ¯ä¸ªå¹³ç§»ä½ç½®ï¼š360åº¦ç­‰é—´éš”é‡‡æ ·ï¼ˆ10ä¸ªç‚¹ï¼Œ36åº¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆä¸€ä¸ªå¹³ç§»ä½ç½®å¯¹åº”äº†10ä¸ªç‚¹ï¼Œå†å¯¹è¿™10ä¸ªç‚¹åŠ å°‘é‡ä½ç½®å™ªå£°ã€‚è¿™ç§ç­–ç•¥ï¼Œ<strong><u>å¯ä»¥ä¿è¯æ¯ä¸ªå¹³ç§»ä½ç½®çš„è§’åº¦é‡‡æ ·éƒ½æ˜¯å……åˆ†çš„</u></strong>ï¼Œå°±ä¸ä¼šå› ä¸ºè§’åº¦é‡‡æ ·è¿‡äºéšæœºå¯¼è‡´è§†è§’ç¼ºå¤±ã€‚</p>
<h3 id="ä¸€äº›å‘">3.6 ä¸€äº›å‘</h3>
<ul>
<li>Eigen/CUDAä¸å…¼å®¹çš„å‘ï¼šåœ¨åŒå­¦çš„RTX 2070è®¾å¤‡ä¸Šæµ‹è¯•æ—¶ï¼Œä»–çš„é©±åŠ¨æ˜¯CUDA 10.2ï¼ŒEigen 3.3.4ï¼Œæˆ‘çš„é©±åŠ¨CUDA 10.1ï¼ŒEigenç›¸åŒï¼Œæˆ‘å¯ä»¥ç¼–è¯‘ï¼Œä»–æŠ¥é”™ï¼šæ‰¾ä¸åˆ°<code>Eigen æ‰¾ä¸åˆ°&lt;math_functions.hpp&gt;</code>ï¼šæŠŠEigenå‡çº§åˆ°3.4.0 ï¼ˆç›´æ¥ä¸ŠGitlabçˆ¬ä¸‹å®ƒçš„æºç è¿›è¡Œincludeï¼‰ï¼Œæ­£ç¡®é€‰æ‹©archä»£æ•°ï¼ˆRTX 2070è‡³å°‘åº”è¯¥é€‰arch=sm_70? æˆ‘çš„MX150æ˜¯sm_61ï¼‰å°±å¯ä»¥é€šè¿‡ç¼–è¯‘ã€‚</li>
<li>std::atomicåº“ä¸CUDAä¸å…¼å®¹ï¼šæˆ‘æƒ³æŠŠä¹‹å‰å†™çš„é”®ç›˜æ“ä½œç”¨åœ¨CUDAå¯è§†åŒ–ä¸­ï¼Œä½†æ˜¯ç¼–è¯‘ä¸è¿‡ï¼ŒCUDAä¸­çš„std::atomicéƒ¨åˆ†ç±»å‹çš„copy constructoræ˜¯deleted functionsï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ã€‚æœ€åæ²¡æœ‰è§£å†³ï¼Œæ”¾å¼ƒäº†ï¼Œç›´æ¥ä½¿ç”¨OpenCVã€‚</li>
<li>nvccè¦åŠ ä¸€äº›flagsæ‰èƒ½é¿å…Eigençš„ä¸€äº›å‚»é€¼warningï¼š<code>--expt-relaxed-constexpr -Xcudafe --diag_suppress=esa_on_defaulted_function_ignored</code>ï¼ŒCMakeæ·»åŠ è¿™ä¸ªï¼š<code>add_compile_options(-Wno-deprecated-declarations)</code></li>
<li>__constant__ memoryè®¿é—®çš„é—®é¢˜ï¼šå®šä¹‰__constant__ å˜é‡ï¼Œæ˜¯ä¸èƒ½ç”¨externçš„ï¼Œå¹¶ä¸”constantå†…å­˜æ˜¯å·²ç»å­˜åœ¨çš„ï¼Œåªéœ€è¦å£°æ˜ç”¨å¤šå°‘(ä¸èƒ½malloc)ï¼Œåªè¦èƒ½çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å®šä¹‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å¯¹èƒ½çœ‹åˆ°å®ƒçš„å‡½æ•°éƒ½æ˜¯å…¨å±€çš„ã€‚<strong><u>åœ¨ä¸åŒæ–‡ä»¶ä¸­ä½¿ç”¨åŒä¸€ä¸ªconstant memoryå˜é‡ï¼Œéœ€è¦ï¼š</u></strong>æ‰“å¼€CUDAçš„separate compilationé€‰é¡¹ï¼ˆç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªrelocatableçš„ä»£ç ï¼‰ï¼Œseparate compilationåœ¨ä¹‹å‰çš„åŠ¨æ€å¹¶è¡Œä¸­è¯´è¿‡ã€‚</li>
<li>ä¸€äº›ç»“æ„ä½“å®šä¹‰çš„å‡½æ•°å¦‚æœéœ€è¦åœ¨GPUä¸Šç”¨ï¼Œè¦å£°æ˜ä¸º__host__ __device__ ï¼ˆåŒé‡å±æ€§ï¼‰ï¼Œè¿™æ ·çš„è¯ï¼ŒCPU / GPUä¸Šä¼šå„æœ‰ä¸€ä»½å®ç°ã€‚</li>
<li>å¸¦cudaå¼€å¤´çš„cuda runtime APIä¸€èˆ¬éƒ½æ˜¯host onlyï¼Œä¸è¦ä½¿ç”¨åœ¨kernelä¸­ã€‚</li>
<li>ä½¿ç”¨nvvpè¿›è¡Œå¯è§†åŒ–profilingï¼Œéœ€è¦å®‰è£…java8ï¼Œé…ç½®jre-1.8ï¼ˆé’ˆå¯¹Ubuntu18.04ï¼‰ï¼Œç¯å¢ƒé”™äº†æ˜¯æ‰“ä¸å¼€profileå·¥å…·çš„ã€‚å¹¶ä¸”profileçš„æ—¶å€™éœ€è¦æœ‰rootæƒé™ã€‚</li>
<li>ç²’å­çš„è¿åŠ¨ï¼šæ¯ä¸ªç²’å­åº”è¯¥æœè‡ªå·±çš„æ–¹å‘å‰è¿›åé€€å·¦ç§»å³ç§»ï¼Œè€Œä¸æ˜¯ä¸æ§åˆ¶ç‚¹ä¿æŒä¸€æ ·çš„æ–¹å‘ã€‚æ–¹å‘ä¸€è‡´çš„è¿åŠ¨ç»“æœæ˜¯æœ‰é—®é¢˜çš„ã€‚</li>
</ul>
<hr>
<h2 id="iv.-å®éªŒç»“æœ">IV. å®éªŒç»“æœ</h2>
<h3 id="ç²’å­æ»¤æ³¢æ•ˆæœä¸€è§ˆ">4.1 ç²’å­æ»¤æ³¢æ•ˆæœä¸€è§ˆ</h3>
<p>â€‹ 6fpsæ…¢é€Ÿæ’­æ”¾æ•ˆæœï¼š</p>
<video src="cv_output1.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 1. æ…¢é€Ÿæ’­æ”¾æ•ˆæœ
</center>
<video src="cv_output2.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 2. å¸¸é€Ÿæ’­æ”¾æ•ˆæœï¼ˆç‰¹æ„æ‰¾äº†ä¸€ä¸ªè¾ƒé•¿æ—¶é—´æ²¡æœ‰æ”¶æ•›çš„æƒ…å†µï¼‰
</center>
<h3 id="profileç»“æœ">4.2 Profileç»“æœ</h3>
<p>â€‹ å°blockçš„kernelæ–¹ä¾¿è¿›è¡Œkernelä¹‹é—´çš„å¹¶å‘ï¼Œè€Œå¤§blockçš„kernelå°±å¯ä»¥æ˜æ˜¾çœ‹å‡ºæ‰§è¡Œåé¡ºåºåŒ–äº†ã€‚</p>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/Screenshot%20from%202021-10-16%2014-24-07.png"></p>
<center>
Figure 7. 8 streams å°block kernel
</center>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/Screenshot%20from%202021-10-16%2014-26-17.png"></p>
<center>
Figure 8. 8 streams å¤§block kernel
</center>
<p>â€‹ æç«¯æƒ…å†µæ˜¯å•streamå¤§blockï¼Œç”±äºèµ„æºå ç”¨è¿‡å¤šï¼Œkernelä¹‹é—´å®Œå…¨æ˜¯ä¸²è¡Œæ‰§è¡Œäº†ã€‚</p>
<p><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/Screenshot%20from%202021-10-16%2014-28-26.png"></p>
<center>
Figure 9. å• stream å¤§block kernel
</center>
<h3 id="é€Ÿåº¦è¯´æ˜">4.3 é€Ÿåº¦è¯´æ˜</h3>
<p>â€‹ å·²ç»æµ‹è¯•çš„é€Ÿåº¦ï¼ˆ12800ç²’å­ï¼Œ$$115åº¦æ¿€å…‰ï¼Œè§’åˆ†è¾¨ç‡0.5åº¦ï¼Œå…±330ä¸ªæ¿€å…‰ç‚¹çš„æƒ…å†µï¼‰ï¼š</p>
<ul>
<li>GeForce MX150: çº¦ä¸º42fps</li>
<li>GeForce RTX 2070: çº¦ä¸º116.5fps</li>
</ul>
<h3 id="å››å¼ å›¾">4.4 å››å¼ å›¾</h3>
<p>â€‹ çº¢è‰²ç²’å­ä¸ºé‡‡æ ·ï¼Œçº¢è‰²ç²’å­å†…éƒ¨æœ‰é»„è‰²ç®­å¤´ï¼ˆå¾ˆå°ï¼‰ï¼ŒæŒ‡ç¤ºäº†ç²’å­çš„æ–¹å‘ã€‚è“ç»¿è‰²ç‚¹æ˜¯æ‰€æœ‰ç²’å­æŒ‰ç…§æƒé‡åŠ æƒå¹³å‡çš„ç»“æœï¼ˆå¸¦æƒé‡å¿ƒï¼‰ï¼Œé»„è‰²ç‚¹æ˜¯çœŸå€¼ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/pic0.png"></th>
<th style="text-align: center;"><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/pic1.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">å¼€å§‹é˜¶æ®µï¼šç²’å­ç°‡åœ¨å¹³ç§»å‡åŒ€åˆ†å¸ƒï¼ˆç•¥å¸¦å™ªå£°ï¼‰</td>
<td style="text-align: center;">ç§»åŠ¨ä¸€æ®µè·ç¦»ï¼Œæ¯ä¸ªç²’å­éƒ½æ›´æ–°äº†è‡ªå·±çš„ä½ç½®</td>
</tr>
<tr class="even">
<td style="text-align: center;"><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/pic2.png"></td>
<td style="text-align: center;"><img src="/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/pic3.png"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">æ”¶æ•›ä¸­ï¼šç²’å­å‡å€¼å·²ç»æ”¶æ•›åˆ°çœŸå€¼é™„è¿‘</td>
<td style="text-align: center;">æ”¶æ•›ï¼Œæœ‰åå·®ï¼Œè¿™æ˜¯åˆå€¼ä¼°è®¡å¯ä»¥å®¹å¿çš„</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://developer.download.nvidia.com/CUDA/training/StreamsAndConcurrencyWebinar.pdf">Steve Rennich - CUDA C/C++ Streams and Concurrency</a></p>
<p>[2] <a href="https://www.olcf.ornl.gov/wp-content/uploads/2020/07/07_Concurrency.pdf">Nvidia Bob Crovella CUDA Concurrency</a></p>
<p>[3] <a href="https://on-demand.gputechconf.com/gtc/2014/presentations/S4158-cuda-streams-best-practices-common-pitfalls.pdf">Justin Luitjens - CUDA streams best practices common pitfalls</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>GPU</tag>
        <tag>CUDA</tag>
      </tags>
  </entry>
  <entry>
    <title>Cartographerç¼–è¯‘é—®é¢˜æ•´ç†</title>
    <url>/2022/04/11/Cartographer%E7%BC%96%E8%AF%91%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<h1 id="cartographer">Cartographer</h1>
<hr>
<p>â€‹ æ¯•è®¾å·¥ä½œè®¾è®¡åˆ°ä¸cartographerè¿›è¡Œå®šé‡å®éªŒæ¯”è¾ƒã€‚æœ¬äººåœ¨<a href="https://github.com/Enigmatisms/cartographer_tester">Enigmatisms/cartographer_tester</a>ä¸­æ•´ç†äº†cartographerä»¥åŠrosé©±åŠ¨ä»£ç ï¼Œæ·»åŠ äº†è‡ªåŠ¨åŒ–è½¨è¿¹è¯»å–ç­‰åŠŸèƒ½ï¼Œä¸¤å‘¨å‰åœ¨Ubuntu 18.04ä¸Šå·²ç»å®Œæˆäº†æµ‹è¯•ï¼Œä½†åœ¨Ubuntu 20.04ä¸Šä¸€ç›´ç¼–è¯‘ä¸é€šè¿‡ï¼Œè°ƒäº†ä¸€ä¸‹åˆæ‰è°ƒå‡ºæ¥ã€‚æœ¬æ–‡è®°å½•äº†cartographeråœ¨ä¸åŒç‰ˆæœ¬çš„Ubuntuä¸Šï¼ˆå°¤å…¶æ˜¯20.04ï¼‰çš„ä¸€äº›å…¸å‹ç¼–è¯‘é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚ç¬”è€…ç°å·²ç»é€šè¿‡æ–‡ä¸­æ‰€è¯´çš„è§£å†³æ–¹æ¡ˆå®Œæˆäº†cartographerçš„ç¼–è¯‘ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="lua-not-found">Lua Not Found</h2>
<p>â€‹ ä»Githubä¸Šä¸‹è½½Luaï¼Œæœ¬åœ°ç¼–è¯‘å®‰è£…å¹¶ä¸”<code>sudo make install</code> æ˜¯å¯ä»¥ä½¿å¾—è¿™ä¸ªé”™è¯¯æ¶ˆå¤±ã€‚ä½†æ˜¯ï¼Œæˆ‘åœ¨Ubuntu 18.04ç”¨æ­¤æ–¹æ³•å®‰è£…Lua 5.3ä¹‹åï¼Œç¼–è¯‘å¯¼è‡´ABSLåº“é—®é¢˜ï¼ˆä¸Luaæœ‰å…³çš„ï¼‰ã€‚é‚<code>sudo make uninstall</code>å¸è½½ï¼Œä½¿ç”¨</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install lua5.2</span><br></pre></td></tr></table></figure>
<p>â€‹ é€šè¿‡aptå®‰è£…ã€‚ä½†æ˜¯è¿™æ ·å®‰è£…çš„<code>lua5.2</code>ï¼Œç¼–è¯‘æ—¶ä»ç„¶è¯´æ‰¾ä¸åˆ°ï¼ˆå³ä½¿é‡å¯ï¼Œä»ç„¶ä¹Ÿæ‰¾ä¸åˆ°ï¼‰ã€‚ä¸è¿‡ï¼Œå…¶å®æˆ‘è·³è¿‡äº†å®˜ç½‘çš„<code>rosdep</code>æ­¥éª¤ï¼Œå…ˆèµ°å®Œ<code>rosdep</code>æ­¥éª¤å†ç¼–è¯‘å°±èƒ½æ‰¾åˆ°<code>lua 5.2</code>äº†ã€‚å…³äºå¦‚ä½•è§£å†³<code>rosdep update</code>é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œè§ <a href="https://blog.csdn.net/qq_45831587/article/details/120705199#comments_20681710">[è¿™ç¯‡åšå®¢ï¼Œäº²æµ‹æœ‰æ•ˆ]</a>. è¿™ç¯‡åšå®¢è™½ç„¶é’ˆå¯¹20.04ï¼Œå¯¹äº18.04ï¼Œåªéœ€è¦ä¿®æ”¹python3ä¸ºpython2.7å³å¯ã€‚</p>
<hr>
<h2 id="undefined-reference-to-absl">Undefined Reference to ABSL</h2>
<p>â€‹ <code>absl</code>åº“å¯èƒ½äº§ç”Ÿé—®é¢˜:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[241/387] Linking CXX executable cartographer_pbstream</span><br><span class="line">FAILED: cartographer_pbstream </span><br><span class="line">: &amp;&amp; /usr/bin/c++  -O3 -DNDEBUG  -rdynamic CMakeFiles/cartographer_pbstream.dir/cartographer/io/pbstream_main.cc.o  -o cartographer_pbstream  libcartographer.a  /usr/local/lib/libceres.a  -lglog  -lspqr  -ltbb  -lcholmod  -lccolamd  -lcamd  -lcolamd  -lamd  -llapack  -lf77blas  -latlas  -lsuitesparseconfig  -lrt  -lcxsparse  -llapack  -lf77blas  -latlas  -lsuitesparseconfig  -lrt  -lcxsparse  -llua5.2  -lm  /usr/lib/x86_64-linux-gnu/libboost_iostreams.so.1.71.0  -lglog  /usr/lib/x86_64-linux-gnu/libgflags.so.2.2.2  -lcairo  /usr/local/lib/libprotobuf.a  /usr/local/lib/libabsl_leak_check.a  /usr/local/lib/libabsl_cord.a  /usr/local/lib/libabsl_cordz_info.a  /usr/local/lib/libabsl_cord_internal.a  /usr/local/lib/libabsl_cordz_functions.a  /usr/local/lib/libabsl_cordz_handle.a  /usr/local/lib/libabsl_hash.a  /usr/local/lib/libabsl_city.a  /usr/local/lib/libabsl_bad_variant_access.a  /usr/local/lib/libabsl_low_level_hash.a  /usr/local/lib/libabsl_raw_hash_set.a  /usr/local/lib/libabsl_bad_optional_access.a  /usr/local/lib/libabsl_hashtablez_sampler.a  /usr/local/lib/libabsl_exponential_biased.a  /usr/local/lib/libabsl_str_format_internal.a  /usr/local/lib/libabsl_synchronization.a  /usr/local/lib/libabsl_stacktrace.a  /usr/local/lib/libabsl_graphcycles_internal.a  /usr/local/lib/libabsl_symbolize.a  /usr/local/lib/libabsl_malloc_internal.a  /usr/local/lib/libabsl_debugging_internal.a  /usr/local/lib/libabsl_demangle_internal.a  /usr/local/lib/libabsl_time.a  /usr/local/lib/libabsl_strings.a  /usr/local/lib/libabsl_strings_internal.a  /usr/local/lib/libabsl_base.a  -lpthread  /usr/local/lib/libabsl_spinlock_wait.a  -lrt  /usr/local/lib/libabsl_throw_delegate.a  /usr/local/lib/libabsl_raw_logging_internal.a  /usr/local/lib/libabsl_log_severity.a  /usr/local/lib/libabsl_int128.a  /usr/local/lib/libabsl_civil_time.a  /usr/local/lib/libabsl_time_zone.a  -lpthread &amp;&amp; :</span><br><span class="line">/usr/bin/ld: libcartographer.a(histogram.cc.o): in function `cartographer::common::Histogram::ToString[abi:cxx11](int) const&#x27;:</span><br><span class="line">histogram.cc:(.text+0x43c): undefined reference to `absl::strings_internal::CatPieces[abi:cxx11](std::initializer_list&lt;std::basic_string_view&lt;char, std::char_traits&lt;char&gt; &gt; &gt;)&#x27;</span><br><span class="line">/usr/bin/ld: histogram.cc:(.text+0x95a): undefined reference to `absl::strings_internal::AppendPieces(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;*, std::initializer_list&lt;std::basic_string_view&lt;char, std::char_traits&lt;char&gt; &gt; &gt;)&#x27;</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">[256/387] Building CXX object CMakeFiles/cartographer.mapping.internal.3d.scan_matching.fast_correlative...er_3d_test.dir/cartographer/mapping/internal/3d/scan_matching/fast_correlative_scan_matcher_3d_test.cc.o</span><br><span class="line">ninja: build stopped: subcommand failed.</span><br><span class="line">&lt;== Failed to process package &#x27;cartographer&#x27;: </span><br><span class="line">  Command &#x27;[&#x27;ninja&#x27;, &#x27;-j16&#x27;, &#x27;-l16&#x27;]&#x27; returned non-zero exit status 1.</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤é—®é¢˜å¯èƒ½ç”±<strong><u>ä¸¤éƒ¨åˆ†åŸå› </u></strong>å¯¼è‡´ï¼š</p>
<ul>
<li><p>Ubuntu 20.04ä¸Šï¼Œcartographerï¼Œcartographer_rosç­‰æ¨¡å—ä»¥åŠ<code>abseil-cpp</code>æ¨¡å—å‡éœ€è¦ä½¿ç”¨c++17æ ‡å‡†ç¼–è¯‘ï¼ˆæ¥æºäºè¿™ä¸ªGithub issueï¼š<a href="https://github.com/google/or-tools/issues/2196">8.0 fails: undefined reference to absl::lts_2020_09_23::Status::Status #2196</a>ï¼‰ï¼ŒåŸå§‹çš„<code>install_abseil.sh</code>æ˜¯è¿™æ ·çš„ï¼š</p>
<p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -G Ninja \</span><br><span class="line">  -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">  -DCMAKE_POSITION_INDEPENDENT_CODE=ON \</span><br><span class="line">  -DCMAKE_INSTALL_PREFIX=/usr/local/stow/absl \</span><br><span class="line">  ..</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä¿®æ”¹ä¸ºï¼š</p>
<p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -G Ninja \</span><br><span class="line">  -std=c++17 \</span><br><span class="line">  -DABSL_CXX_STANDARD=17 \</span><br><span class="line">  -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">  -DCMAKE_POSITION_INDEPENDENT_CODE=ON \</span><br><span class="line">  -DCMAKE_INSTALL_PREFIX=/usr/local/stow/absl \</span><br><span class="line">  -DABSL_PROPAGATE_CXX_STD=ON \</span><br><span class="line">  ..</span><br></pre></td></tr></table></figure></p>
<p>â€‹ å¢åŠ <code>-std=c++17</code>ï¼Œ<code>-DABSL_CXX_STANDARD=17</code>ï¼Œ<code>-DABSL_PROPAGATE_CXX_STD=ON</code> ï¼Œå‰ä¸¤ä¸ªé€‰é¡¹ä¸ºäº†ä½¿å¾—ç¼–è¯‘ä½¿ç”¨c++17æ ‡å‡†ï¼Œæœ€åä¸€ä¸ªé€‰é¡¹é˜²æ­¢ç¼–è¯‘warningã€‚è€Œå…¶ä»–cartographerç›¸å…³æ¨¡å—ï¼Œåªéœ€è¦åœ¨æ¯ä¸ªæ¨¡å—ä¸‹çš„<code>CMakeLists.txt</code>ä¸­çš„<code>project(xxx)</code>åæ·»åŠ </p>
<p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++17&quot;</span>)</span><br></pre></td></tr></table></figure></p></li>
<li><p>GoogleæŸ¥æ‰¾é—®é¢˜æ—¶ï¼Œåœ¨<code>abseil-cpp</code>åº“çš„issueé‡Œæ‰¾åˆ°äº†è¿™ä¹ˆä¸€ä¸ªissue: <a href="https://github.com/abseil/abseil-cpp/issues/640">undefined reference errors (absl::strings_internal::CatPieces and absl::ByChar::Find)</a>ã€‚å…¶ä¸­æœ‰ä¸ªäººæåˆ°ï¼š</p></li>
</ul>
<blockquote>
<p>Confirmed on my end: if I add back what was removed from <code>AbseilConfigureCopts.make</code> in commit <a href="https://github.com/abseil/abseil-cpp/commit/c6954897f7ece5011f0126db9117361dc1a6ff36"><code>c695489</code></a> then it works.</p>
</blockquote>
<p>â€‹ äºæ˜¯æˆ‘ä¿®æ”¹<code>install_abseil.sh</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout c6954897f7ece5011f0126db9117361dc1a6ff36	# ä¿®æ”¹åˆ°è¿™ä¸ªcommit</span><br></pre></td></tr></table></figure>
<p>â€‹ ç¼–è¯‘<code>abseil-cpp</code>ï¼Œå®Œæˆååˆ é™¤cartographerä¹‹å‰çš„<code>build_isolated</code>ä»¥åŠ<code>devel_isolated</code>å¹¶é‡æ–°ç¼–è¯‘cartographerã€‚åˆ™ä¸å†å‡ºç°<code>absl</code>åº“é—®é¢˜ã€‚</p>
<hr>
<h2 id="pythoninterp-ç‰ˆæœ¬é—®é¢˜">PythonInterp ç‰ˆæœ¬é—®é¢˜</h2>
<p>â€‹ Ubuntu 20.04é¦–æ¬¡æ‘’å¼ƒ python 2.7ï¼ŒåŒ…æ‹¬ROSï¼ˆrospyï¼‰åœ¨å†…å…¨é¢è½¬å‘python3ï¼Œä½†æ˜¯å¯èƒ½è¿˜æ˜¯å­˜åœ¨ä¸€äº›ä½™å­½ï¼Ÿç»§ç»­ç¼–è¯‘åæˆ‘é‡åˆ°äº†å¦‚ä¸‹é—®é¢˜ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CMake Error at /usr/share/cmake-3.16/Modules/FindPackageHandleStandardArgs.cmake:146 (message):</span><br><span class="line">  Could NOT find PythonInterp: Found unsuitable version &quot;2.7.18&quot;, but</span><br><span class="line">  required is at least &quot;3&quot; (found /usr/bin/python)</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  /usr/share/cmake-3.16/Modules/FindPackageHandleStandardArgs.cmake:391 (_FPHSA_FAILURE_MESSAGE)</span><br><span class="line">  /usr/share/cmake-3.16/Modules/FindPythonInterp.cmake:169 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)</span><br><span class="line">  /opt/ros/noetic/share/catkin/cmake/python.cmake:4 (find_package)</span><br><span class="line">  /opt/ros/noetic/share/catkin/cmake/all.cmake:164 (include)</span><br><span class="line">  /opt/ros/noetic/share/catkin/cmake/catkinConfig.cmake:20 (include)</span><br><span class="line">  CMakeLists.txt:55 (find_package)</span><br></pre></td></tr></table></figure>
<p>â€‹ emmmï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹trace stackä¸­çš„æ‰€æœ‰cmakeæ–‡ä»¶ï¼Œæ²¡æœ‰ä»€ä¹ˆå‘ç°ï¼Œåªæ˜¯cmakeæ— æ³•æ‰¾åˆ°python3ï¼Œå¹¶ä¸”åœ¨<code>which python</code>æ—¶æ˜¾ç¤ºçš„æ˜¯2.7.18çš„ python2ã€‚çœ‹æ¥æ˜¯é»˜è®¤pythonæœ‰é—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1</span><br><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.8 2</span><br></pre></td></tr></table></figure>
<p>â€‹ å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œè‡ªæ­¤æ‰€æœ‰é—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ï¼Œcartographeré¡ºåˆ©å®‰è£…ã€‚</p>
<hr>
<h2 id="å…¶ä»–è®°å½•">å…¶ä»–è®°å½•</h2>
<ul>
<li>æˆåŠŸæ— bugé€‚é…äº†cartographerçš„cere-solverç‰ˆæœ¬æ˜¯2.0.0ï¼Œåœ¨Ubuntu 18.04ä»¥åŠ20.04ä¸Šé€šç”¨ã€‚</li>
<li>cartographerçš„ <code>CMakeLists.txt</code>å¾ˆå¤æ‚ï¼Œä½†æ˜¯è¯»ä¸€è¯»è¿˜æ˜¯èƒ½å­¦åˆ°ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š<code>cmake_parse_arguments</code></li>
</ul>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>SLAM</tag>
        <tag>ç¯å¢ƒå·¥ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Contrastive Learning Intros</title>
    <url>/2021/08/29/Contrastive-Learning-Intros/</url>
    <content><![CDATA[<h1 id="cl">CL</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ æ ¹æ®ä¸ªäººç²—æµ…çš„äº†è§£ï¼Œæœ‰ç›‘ç£çš„ç®€å•å›¾åƒåˆ†ç±»åœ¨é«˜ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼Œæ¯”å¦‚æˆ‘è§‰å¾—Inceptionå°±å¾ˆå¥‡æ€ªï¼Œå¼ºè¡Œå˜å®½ï¼Œæ›´ä¸è¦è¯´å®ƒçš„æ”¹è¿›äº†ã€‚æ–°çš„ç½‘ç»œç»“æ„æ„Ÿè§‰å°±æ˜¯ï¼Œæ²¡ä»€ä¹ˆç†è®ºé“ç†ï¼Œå…¨æ˜¯ empirical xxxxçš„ï¼Œè®©äººçœ‹å¾—ä¸€å¤´é›¾æ°´ï¼Œåšè¿™æ ·çš„æµ…å±‚æ¬¡ç†è§£æˆ–è€…æ˜¯å¤ç°ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§æ„æ€ï¼Œåªèƒ½è®©PytorchæŠ€æœ¯æ›´åŠ ç†Ÿç»ƒç½¢äº†ï¼Œæ²¡æœ‰åˆ«çš„ä½œç”¨ã€‚ä¸ºäº†å¯»æ‰¾æ–°çš„æœ‰è¶£ç†è®ºï¼Œæˆ‘å…¥é—¨äº†ä¸€ä¸‹æ— ç›‘ç£å­¦ä¹ ï¼ˆå…¥é—¨æ°´å‡†ï¼‰ï¼Œè¿™ä¸ªé¢†åŸŸé‡Œé¢æœ‰äº›å¾ˆæœ‰è¶£çš„ç†è®ºä»¥åŠæ€æƒ³å€¼å¾—å€Ÿé‰´ã€‚æœ¬æ–‡åœ¨å›é¡¾äº†ä¸€ä¸‹ä¸€äº›æ¦‚ç‡è®ºç†è®ºä¹‹åï¼Œå†…å®¹ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>Contrastive Predictive Coding (CPC) è®ºæ–‡çš„ç†è§£</li>
<li>ä½•æºæ˜å¤§ç¥ï¼ˆåŒæ ·å§“ä½•ä¸ºä½•æˆ‘è¿™ä¹ˆèœï¼‰Momentum Contrast (MoCo) è®ºæ–‡çš„ç†è§£</li>
<li>MoCoå®ç°ä»¥åŠä¸åŸºäºResNetæ€æƒ³çš„baselineæ¨¡å‹æ¯”è¾ƒï¼ˆå®ç°è§ï¼š<a href="https://github.com/Enigmatisms/MoCo">ğŸ”—Enigmatisms/MoCo</a>ï¼‰</li>
</ul>
<span id="more"></span>
<hr>
<h2 id="ii.-ä¸¤ä¸ªæ›¾ç»çš„sota">II. ä¸¤ä¸ªæ›¾ç»çš„SOTA</h2>
<h3 id="nce">2.1 NCEï¼Ÿ</h3>
<p>â€‹ åœ¨ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»äº†CLçš„å·¥ä½œåŸç†ï¼šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œencodeï¼Œåœ¨æŸä¸€ä¸ªé«˜ç»´metric spaceä¸‹å¯¹ä¸¤ä¸ªè¾“å…¥encodeåçš„ç‰¹å¾å‘é‡è¿›è¡Œç›¸ä¼¼åº¦æ¯”è¾ƒã€‚ç»™å®šæ­£è´Ÿæ ·æœ¬ï¼ˆæ­£è´Ÿæ ·æœ¬çš„è·å¾—æ˜¯æ— ç›‘ç£çš„ï¼‰åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è®­ç»ƒé›†æ¥ä¼˜åŒ–æˆ‘ä»¬çš„encoderï¼Œä½¿å¾—ç»è¿‡encodeä¹‹åï¼ŒåŸç©ºé—´ä¸‹å°±ç›¸ä¼¼çš„æ ·æœ¬èƒ½åœ¨å˜æ¢åä¹Ÿååˆ†ç›¸ä¼¼ï¼ˆè¡¨ç°åœ¨å†…ç§¯ä¸Šï¼‰ã€‚é‚£ä¹ˆè¿™å°±è¦æ±‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªlossæ¥ä¼˜åŒ–encoderï¼Œè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯InfoNCEã€‚</p>
<div class="note warning"><p><strong><u>æ³¨æ„ï¼ŒNCEä¸æ˜¯ negative cross entropyï¼ï¼ˆè¿™æ˜¯å¼€å§‹æ—¶æœ¬äººè®¤ä¸ºçš„ä¸œè¥¿ï¼‰</u></strong>ã€‚ä½†æ˜¯æ—¢ç„¶é‚£ä¹ˆæœ‰ç¼˜ï¼Œè¿˜æ˜¯å¤ä¹ ä¸€ä¸‹NCEç›¸å…³çš„çŸ¥è¯†ã€‚</p>
</div>
<p>â€‹ é¦–å…ˆç®€å•åœ°å›å¿†ä¸€ä¸‹äº¤å‰ç†µä¸KLæ•£åº¦ï¼ˆé•¿æ—¶é—´ä¸ç”¨å°±å®¹æ˜“å¿˜ï¼‰ï¼Œé¦–å…ˆæ˜¯ä¿¡æ¯ç†µï¼ˆä¸æœ€å°ç¼–ç æœ‰å…³ï¼‰ <span class="math display">\[
\begin{equation}\label{ent}
H(x)=-\sum p(x)\log\left(p(x)\right)
\end{equation}
\]</span> â€‹ è€ŒKLæ•£åº¦çš„å®šä¹‰æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{kl}
D_{KL}(P||Q)=\sum P(x)\log\frac{P(x)}{Q(x)}
\end{equation}
\]</span> â€‹ åœ¨ä¹‹å‰çš„ä¸€äº›åšæ–‡ä¸­æˆ‘ä»¬åˆ†æè¿‡ï¼ŒKLæ•£åº¦æ˜¯ç”¨æ¥è¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒçš„è¿‘ä¼¼ç¨‹åº¦çš„ã€‚</p>
<div class="note info"><p>â€‹ åŸå§‹çš„ä¿¡æ¯è®ºé—®é¢˜æ˜¯ï¼šå¯¹äºä¸¤ä¸ªä¸åŒæ¦‚ç‡åˆ†å¸ƒçš„å­—æ¯è¡¨P, Qï¼Œå¦‚æœå·²ç»åœ¨Qä¸Šè®¡ç®—å‡ºäº†æœ€ä¼˜ç¼–ç ï¼Œé‚£ä¹ˆåªè¦å­—æ¯è¡¨Pçš„åˆ†å¸ƒè¶Šæ¥è¿‘Qï¼Œé‚£ä¹ˆç¼–ç æ•´ä¸ªå­—æ¯è¡¨Pæ‰€éœ€çš„å¹³å‡ä¿¡æ¯å°±è¶Šæ¥è¿‘Qçš„ç†è®ºæœ€å°å€¼ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªé—®é¢˜çš„æ¨å¹¿å°±æ˜¯è¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒçš„è¿‘ä¼¼æ€§ã€‚</p>
</div>
<p>â€‹ è€Œäº¤å‰ç†µå¯ä»¥ç”¨KLæ•£åº¦æ¥å®šä¹‰ï¼ˆWikiä¸Šè¯´çš„ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{ce}
\text{CE}(x)=H(p)+D_{KL}(p||q)=-\sum P(x)\log{Q(x)}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆè¯·é—®æ­¤å¼çš„æ„ä¹‰åº”è¯¥å¦‚ä½•è§£è¯»ï¼Ÿç”±äº<span class="math inline">\(P(x),Q(x)\)</span>éƒ½æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼Œè¶Šæ¥è¿‘1åˆ™<span class="math inline">\(-\log f(x)\)</span>è¶Šå°ï¼Œé‚£ä¹ˆä»¥ä¸‹ä¸¤ç§æç«¯æƒ…å†µå¯ä»¥å®šæ€§è§£é‡Šè¿™ä¸ªlossçš„æ­£ç¡®æ€§ï¼š</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/1.PNG"></p>
<p>â€‹ å¦‚æœå¦‚ä¸Šå·¦å›¾ï¼Œä¸¤ä¸ªåˆ†å¸ƒç›¸å·®è¾ƒå¤§ï¼Œé‚£ä¹ˆä¼šæœ‰è¿™æ ·çš„æƒ…å†µï¼š<span class="math inline">\(-\log Q(x)\)</span>è¾ƒå¤§æ—¶ï¼ˆä¹Ÿå°±æ˜¯<span class="math inline">\(Q(x)\)</span>è¾ƒå°ï¼‰ï¼Œ<span class="math inline">\(P(x)\)</span>æ°å¥½è¾ƒå¤§ï¼Œç›¸å½“äºå¯¹å¤§å€¼ï¼ŒåŠ å¤§æƒé‡ã€‚é‚£ä¹ˆæœ€åçš„losså¾ˆå¤§ã€‚å¦‚æœåˆ†å¸ƒè¾ƒä¸ºç›¸ä¼¼ï¼Œé‚£ä¹ˆåˆ™ç›¸åï¼Œå¯¹å¤§å€¼åŠ å°æƒï¼Œå¯¹å°å€¼åŠ å¤§æƒï¼Œè¿™æ ·å¾—åˆ°çš„losså¾ˆå°ï¼Œä¹Ÿå°±ç›´è§‚ä¸Šè¯´æ˜äº†Cross Entropyçš„ä½œç”¨æ–¹å¼ã€‚è€ŒäºŒåˆ†ç±»ä¸­ï¼Œäº¤å‰ç†µçš„å†™æ³•å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{cel}
\text{CEL}(x)=-(y\log(p)+(1-y)\log(1-p))
\end{equation}
\]</span> â€‹ ä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·çš„å‘¢ï¼Ÿæ˜¾ç„¶ï¼ŒäºŒåˆ†ç±»æƒ…å†µä¸‹ï¼Œåªæœ‰é”™åˆ†æ‰ä¼šæœ‰lossã€‚æ ¹æ®äº¤å‰ç†µè¡¨è¾¾å¼<span class="math inline">\(\eqref{ce}\)</span>ï¼Œå‡å®š<span class="math inline">\(P(x)\)</span>æ˜¯çœŸå®åˆ†å¸ƒï¼Œ<span class="math inline">\(Q(x)\)</span>æ˜¯ä¼°è®¡åˆ†å¸ƒã€‚</p>
<p>â€‹ è®²å®Œäº†CEï¼Œè¦æ¥è®²è®²çœŸæ­£çš„NCEä¸InfoNCEæ˜¯ä»€ä¹ˆäº†ï¼Œåœ¨è¿™é‡Œæˆ‘åªç®€è¦è¯´è¯´ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯æŸ¥å‡ºæ¥çš„ï¼ˆç²¾åŠ›æœ‰é™ï¼Œä¸èƒ½è¿‡åˆ†åœ°é€’å½’å­¦ä¹ ï¼‰ï¼ŒçŸ¥ä¹ä¸Šæœ‰ç¯‡æ–‡ç« è®²å¾—è¿˜è¡Œ[1]ã€‚åœ¨è¿™ä¸ªæ–‡ç« ä¸­ï¼Œä½œè€…å¼€å§‹å°±ä»NLPåˆ‡å…¥ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåˆ‡å…¥ç‚¹è¿˜ä¸é”™ï¼Œå› ä¸ºNLPä¸­å¾ˆå¤šé—®é¢˜éƒ½æ˜¯å’Œåºåˆ—æœ‰å…³çš„ï¼Œäºæ˜¯å­˜åœ¨è¿™ç§ï¼šcontextï¼Œé€šè¿‡contextæ¥è¿›è¡Œæ¨æ–­çš„è¯­è¨€æ¨¡å‹ä¹‹ç±»çš„ä¸œè¥¿ã€‚é‚£ä¹ˆInfoNCEçš„ä½œç”¨åŸç†æ˜¯ä»€ä¹ˆï¼Ÿé¦–å…ˆç»™å‡ºå…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{infonce}
L_q=-\log\frac{\exp(q\cdot k_{+}/\tau)}{\sum_{i=0}^K\exp{(q\cdot k_i/\tau})}
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(k_+\)</span>æ˜¯ä¸query <span class="math inline">\(q\)</span> èƒ½å¤Ÿmatchçš„æ­£sample keyã€‚å…¶ä½™çš„éƒ½æ˜¯è´Ÿsample keyã€‚å¯ä»¥å‘ç°è¿™ç§ Q K V è®¾è®¡è¿˜æ˜¯éå¸¸æ™®éçš„ï¼Œå¯¹æ¯ä¸€ä¸ªéœ€è¦ä½¿ç”¨çš„valueï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„keyï¼Œä»¥åº”å¯¹ä¸åŒqueryï¼Œè™½ç„¶åœ¨CLé—®é¢˜ä¸­æ²¡æœ‰æ˜¾å¼çš„valueï¼Œå› ä¸ºvalueå°±æ˜¯keyã€‚</p>
<p>â€‹ é‚£ä¹ˆä¸Šå¼å°±æ˜¯ä¸€ä¸ªè´Ÿå¯¹æ•°è¡¨è¾¾ï¼Œå› ä¸ºæ¦‚ç‡è¶Šå° lossè¶Šå¤§ã€‚åœ¨MoCoä¸­ï¼Œä¸ªäººçš„ç†è§£æ˜¯ï¼šç”±äºMoCoçš„queueä»¥åŠmomentum updateè®¾è®¡ï¼Œä½¿å¾—key dictionaryç›¸å¯¹ä¸å˜ï¼Œæä¾›çš„keyç›¸å¯¹ç¨³å®šï¼Œåœ¨å‡è®¾keyæ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¥½çš„encoderå‚æ•°<span class="math inline">\(f_q\)</span>ä½¿å¾—äº§ç”Ÿçš„<span class="math inline">\(q\)</span>èƒ½å¤Ÿä¸å…¶ä¸­ä¸€ä¸ªkeyå®ŒæˆåŒ¹é…ã€‚ä¸è¿‡è¿™ä¸ª<span class="math inline">\(k_{+}\)</span>çš„é€‰å–å€’æ˜¯æ²¡æœ‰è¯´è¿‡ã€‚</p>
<h3 id="infonce-in-cpc">2.2 InfoNCE in CPC</h3>
<p>â€‹ CPC[3]è®ºæ–‡ä¸­æ˜ç¡®å®šä¹‰äº†InfoNCEï¼ˆåº”è¯¥æ˜¯é¦–æ¬¡å‡ºç°ï¼‰ã€‚è¿™ç¯‡æ–‡ç« çš„ç†è®ºéƒ¨åˆ†æ›´åŠ æ¸…æ¥šï¼Œå¹¶ä¸”ç”¨åˆ°äº†ä¸€äº›æ¦‚ç‡è®ºçŸ¥è¯†ï¼Œæˆ‘é‡ç‚¹ç†è§£å’Œæ¨å¯¼ä¸€ä¸‹ã€‚é¦–å…ˆéœ€è¦ææ¸…æ¥šçš„æ˜¯ï¼šä»€ä¹ˆæ˜¯contextï¼Œå…³äºcontextï¼ŒCPCè®ºæ–‡ä¸­è¯´äº†å®ƒå…·ä½“çš„äº§ç”Ÿï¼š</p>
<blockquote>
<p>Next, an autoregressive model gar summarizes all zâ‰¤t in the latent space and produces a context latent representation ct = gar(zâ‰¤t).</p>
</blockquote>
<p>â€‹ é‚£ä¹ˆå¯ä»¥è®¤ä¸ºï¼Œcontextå®é™…ä¸Šå°±æ˜¯å¯¹ä¸€ä¸ªåºåˆ—ä¿¡æ¯ï¼ˆæˆ–è€…æœ‰é¡ºåºå…³è”æ€§çš„ä¿¡æ¯ï¼‰ï¼Œå‰è¿°ä¿¡æ¯çš„ä¸€ä¸ªæç‚¼ï¼Œç›¸å½“äºæä¾›äº†ä¸€ä¸ªèƒŒæ™¯ã€‚CPCåæ–‡ä¸­æåˆ°çš„ä½¿ç”¨ä¸Šä¸‹æ–‡æŒ‡å¯¼çš„predictionï¼Œå¯ä»¥ä½è¯è¿™æ ·çš„ç†è§£ï¼šcontextä¿¡æ¯å°±æ˜¯ç”Ÿæˆå¯¹åº”predictionçš„èƒŒæ™¯ä¿¡æ¯ï¼Œåªæœ‰ç»™å®šèƒŒæ™¯ï¼Œpredictæ‰ä¸ä¼šæ¼«æ— ç›®çš„åœ°ä¹±çŒœã€‚äºæ˜¯æ‰ä¼šæœ‰ä¸¤ç§ä¸åŒçš„æ¦‚ç‡ï¼š</p>
<ul>
<li>æ¡ä»¶æ¦‚ç‡<span class="math inline">\(P(x_{t+k}|c_t)\)</span>ï¼Œ<span class="math inline">\(c_t\)</span>å¯ä»¥è®¤ä¸ºæ˜¯æˆªæ­¢åˆ°tæ—¶åˆ»çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œ<span class="math inline">\(x_{t+k}\)</span>æ˜¯ä¸€ä¸ªæ­£æ ·æœ¬ï¼ˆä¸ºä»€ä¹ˆï¼Ÿç­‰ä¼šå„¿è¯´ï¼‰ï¼ˆpredictionï¼‰ï¼Œæˆ–è€…å°±å¦‚è®ºæ–‡è‡ªå·±è¯´çš„ï¼šç†è§£æˆä¸€ä¸ªç”Ÿæˆå¼æ¨¡å‹ï¼Œæ ¹æ®latent vector <span class="math inline">\(c_t\)</span>æ¥ç”Ÿæˆpredictionçš„ä¸€ä¸ªåˆ†å¸ƒæ¨¡å‹</li>
<li>ç›´æ¥æ¦‚ç‡<span class="math inline">\(P(x_{t+k})\)</span>åˆ™æ˜¯è¢«é¢„æµ‹é‡çš„åˆ†å¸ƒï¼Œæ˜¯æˆ‘ä»¬æƒ³çŸ¥é“çš„é‚£ä¸ªåˆ†å¸ƒå—ï¼Ÿå¹¶ä¸æ˜¯è¿™æ ·ç†è§£çš„ï¼Œè®ºæ–‡ä¸­è‡ªå·±è¯´åˆ°äº†ï¼š</li>
</ul>
<blockquote>
<p>N-1 negative samples from the â€™proposalâ€™ distribution <span class="math inline">\(p(x_{t+k})\)</span></p>
</blockquote>
<p>â€‹ è¿™ä¸ª<span class="math inline">\(P(x_{t+k})\)</span>å°±æ˜¯æˆ‘ä»¬éšæœºé‡‡æ ·çš„ <u><strong>å™ªå£°å»ºè®®åˆ†å¸ƒ</strong></u>ã€‚</p>
<p>â€‹ å½“æ—¶è§‰å¾—ï¼Œè¯¶æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†ã€‚å½“æˆ‘çœ‹åˆ°è®ºæ–‡ä¸­å†™åˆ°importance samplingä»¥åŠ"proposal distribution"çš„æ—¶å€™æˆ‘æ„Ÿè§‰ï¼Œåäº†ï¼Œå¼€å§‹æœ‰ç‚¹åƒç²’å­æ»¤æ³¢äº†ã€‚é‚£ä¹ˆå¯ä»¥ç»“åˆèµ·æ¥ç†è§£ï¼Œåªéœ€è¦ç®€å•å›é¡¾ä¸€ä¸‹é‡è¦æ€§é‡‡æ ·å³å¯ã€‚</p>
<div class="note success"><p>å›é¡¾ä¸€ä¸‹é‡è¦æ€§é‡‡æ ·ï¼Œä¹Ÿå°±æ˜¯â€œå»ºè®®åˆ†å¸ƒ (proposal) â€å¦‚ä½•è½¬å‘â€œç›®æ ‡åˆ†å¸ƒâ€</p>
</div>
<p>â€‹ å‡è®¾æˆ‘ä»¬éœ€è¦è®¡ç®—å…³äº<span class="math inline">\(f(x)\)</span>çš„æŸä¸ªç§¯åˆ†ï¼ˆæ¯”å¦‚æœŸæœ›ï¼‰ï¼Œä½†æ˜¯è¦ä¹ˆ<span class="math inline">\(f(x)\)</span> æ˜¯é«˜ç»´å¤æ‚åˆ†å¸ƒï¼Œè¦ä¹ˆ<span class="math inline">\(f(x)\)</span>éš¾ä»¥ç§¯åˆ†ï¼Œæ€»ä¹‹å°±æ˜¯ä¸æ–¹ä¾¿ä»æ­¤åˆ†å¸ƒä¸­ç›´æ¥é‡‡æ ·ï¼Œè€ŒåŒæ—¶æˆ‘ä»¬åˆæœ‰å¦ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒ<span class="math inline">\(g(x)\)</span>ï¼Œé‚£ä¹ˆæœ‰ï¼š <span class="math display">\[
\begin{equation}\label{imp}
\int f(x)dx=\int\frac{f(x)}{g(x)}g(x)dx
\end{equation}
\]</span> â€‹ ç›¸å½“äºæ˜¯ï¼šæˆ‘ä»¬åœ¨æ±‚<span class="math inline">\(g(x)\)</span>çš„æŸä¸ªç§¯åˆ†ï¼Œå¯¹åº”çš„éšæœºå˜é‡å‡½æ•°æ˜¯<span class="math inline">\(f(x)/g(x)\)</span>ï¼Œåœ¨ç²’å­æ»¤æ³¢ä¸­æ˜¯æœ‰ç›¸åº”åº”ç”¨çš„ã€‚é‚£ä¹ˆ<span class="math inline">\(f(x)/g(x)\)</span>çœ‹èµ·æ¥è¿˜æ˜¯å’Œ<span class="math inline">\(f(x)\)</span>æœ‰å…³ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¾ˆéš¾æ±‚å‘¢ï¼Ÿåœ¨ç²’å­æ»¤æ³¢é‡Œé¢æˆ‘ä»¬å·²ç»è¯´æ˜äº†ï¼Œè¿™ä¸ªå€¼å¹¶ä¸éš¾æ±‚ï¼Œ<span class="math inline">\(f(x)/g(x)\)</span>ç›¸å½“äºå¯¹å»ºè®®åˆ†å¸ƒ<span class="math inline">\(g(x)\)</span>çš„ä¸€ä¸ªåŠ æƒå› å­ï¼Œè¿™ä¸ªåŠ æƒå› å­ç”±<u><strong>å»ºè®®åˆ†å¸ƒå’Œç›®æ ‡åˆ†å¸ƒçš„ä¸€è‡´æ€§</strong></u>å†³å®šï¼Œåœ¨localizationé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç²’å­åœ¨å¯¹åº”ä½ç½®æ¨¡æ‹Ÿçš„scanä¸å®é™…scançš„ç›¸ä¼¼åº¦ä¼°è®¡å‡ºäº†è¿™ä¸ªå€¼ï¼Œç²’å­æ»¤æ³¢å¦™å°±å¦™åœ¨è¿™é‡Œã€‚æˆ‘ä¸éœ€è¦çŸ¥é“ä»»ä½•ä¸<span class="math inline">\(f(x)\)</span>æœ‰å…³çš„è®¡ç®—å…¬å¼ï¼Œæˆ‘ä¹Ÿå¯ä»¥å·§å¦™åœ°è®¾è®¡åŠ æƒå› å­æ±‚å‡ºä¸<span class="math inline">\(f(x)\)</span>ç›¸å…³çš„å€¼ã€‚</p>
<p>â€‹ è€Œåœ¨CPCè®ºæ–‡ä¸­ï¼Œä½œè€…å¸Œæœ›çš„åº”è¯¥æ˜¯æœ€å¤§åŒ–<span class="math inline">\(x_{t+k}\)</span>ä¸ä¸Šä¸‹æ–‡<span class="math inline">\(c_t\)</span>çš„äº’ä¿¡æ¯ï¼š <span class="math display">\[
\begin{equation}\label{info}
I(x,c)=\sum_{x,c}p(x,c)\log\frac{p(x|c)}{p(x)}
\end{equation}
\]</span> â€‹ ä½œè€…æ˜¾å¼åœ°å»å»ºæ¨¡<span class="math inline">\(p(x|c)/p(x)\)</span>ï¼Œå¹¶ä¸”ä½œè€…ä½¿ç”¨çš„è¿™ä¸ªæ¯”å€¼ä¸ä¸€å®šéœ€è¦æœ‰å½’ä¸€åŒ–å±æ€§ï¼Œåªéœ€è¦å»ºæ¨¡ä¸€ä¸ªå‡½æ•°<span class="math inline">\(f(x)\)</span>ä¸<span class="math inline">\(p(x|c)/p(x)\)</span>æˆæ­£æ¯”å³å¯ã€‚å…³äºå…¬å¼<span class="math inline">\(\eqref{info}\)</span>ï¼Œä½œè€…è‡ªå·±æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>By using a density ratio <span class="math inline">\(f(x_{t+k},c)\)</span> and inferring $ {z_{t+k}}$ with an encoder, we relieve the model from modeling the <strong><u>high dimensional distribution</u></strong> <span class="math inline">\(x_{t+k}\)</span>. Although we cannot evaluate p(x) or p(x|c) directly, we can use samples from these distributions, allowing us to use techniques such as Noise-Contrastive Estimation and <u><strong>Importance Sampling</strong></u> that are based on comparing the target value with randomly sampled negative values.</p>
</blockquote>
<p>â€‹ ç¡®å®ï¼Œä½œè€…æ²¡æœ‰ç”¨ç”Ÿæˆå¼æ¨¡å‹å»ç›´æ¥å»ºæ¨¡æ¦‚ç‡åˆ†å¸ƒï¼Œè€Œæ˜¯ä½¿ç”¨ç±»ä¼¼é‡è¦æ€§é‡‡æ ·çš„æ–¹å¼å»ä¿è¯äº’ä¿¡æ¯å¯ä»¥å¾—åˆ°å°½å¯èƒ½å¤§çš„å€¼ã€‚</p>
<h3 id="cpcmocoçš„åŸºæœ¬æ€æƒ³">2.3 CPC/MoCoçš„åŸºæœ¬æ€æƒ³</h3>
<p>â€‹ æ˜¯å•Šï¼Œç†è®ºå¾ˆå¦™ï¼Œæ˜¯å•Šã€‚ã€‚ã€‚ä½†æ˜¯ï¼Ÿä»–ä»¬ç”¨è¿™äº›ç†è®ºåœ¨å¹²ä»€ä¹ˆæ¥ç€ï¼Ÿæ¨äº†é‚£ä¹ˆä¹…å…¬å¼ï¼Œæˆ‘ä»¬ä»¿ä½›å¿˜è®°äº†ä»–ä»¬çš„ç›®æ ‡ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚æ³¨æ„CPCä¸­ä½¿ç”¨äº†NCEï¼ˆ<strong><u>Noise Contrastive</u></strong> Estimationï¼‰ï¼Œå¹¶ä¸”ä¹Ÿè¦è®°ä½ï¼Œè¿™ç§<strong><u>æ— ç›‘ç£çš„</u></strong>å¯¹æ¯”å­¦ä¹ æ–¹æ³•æ ¸å¿ƒå°±åœ¨äºã€å¯¹æ¯”ã€‘ã€‚é‚£ä¹ˆå’Œè°å¯¹æ¯”ï¼Ÿ<strong><u>å™ªå£°åˆ†å¸ƒ</u></strong>çš„æ•°æ®å¯¹æ¯”ï¼Œæ‰€ä»¥ä¼šæœ‰NCEã€‚</p>
<ul>
<li><span class="math inline">\(P(x_{t+k}|c_t)\)</span>æ˜¯æ ¹æ®ä¸Šä¸‹æ–‡è¿›è¡Œçš„é‡‡æ ·ï¼Œé‡‡æ ·å¾—åˆ°çš„ç»“æœå°±æ˜¯æ­£æ ·æœ¬</li>
<li><span class="math inline">\(P(x_{t+k})\)</span>æ˜¯è´Ÿæ ·æœ¬çš„æ¥æºåˆ†å¸ƒ</li>
</ul>
<p>â€‹ æœ€å¤§åŒ–æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬ä¹‹é—´çš„äº’ä¿¡æ¯ï¼ˆè¡¡é‡ä¸¤ä¸ªéšæœºå˜é‡çš„ç‹¬ç«‹æ€§ï¼Œæˆ–è€…è¯´è§‚å¯Ÿå…¶ä¸­ä¸€ä¸ªå˜é‡å¯ä»¥å¾—åˆ°å¦ä¸€ä¸ªå˜é‡çš„ä¿¡æ¯ï¼‰ã€‚è¿™é‡Œæ˜¯åœ¨æœ€å¤§åŒ–<span class="math inline">\(x_{t+k}\)</span>ä¸<span class="math inline">\(c_t\)</span>è¿™ä¸¤ä¸ªéšæœºå˜é‡çš„äº’ä¿¡æ¯ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯<span class="math inline">\(c_t\)</span>å°±èƒ½å¾ˆå¥½åœ°å¯¹<span class="math inline">\(x_{t+k}\)</span>è¿›è¡Œé¢„æµ‹ã€‚ä½†æ˜¯åœ¨å¯¹æ¯”å­¦ä¹ é‡Œé¢ï¼Œé¢„æµ‹å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚ä¸ªäººè®¤ä¸ºï¼Œå¯¹æ¯”å­¦ä¹ çš„ç›®çš„åº”è¯¥æ˜¯ï¼š</p>
<div class="note primary"><p>â€‹ ä¸ºäº†æ›´å¥½åœ°åŒºåˆ†æ­£è´Ÿæ ·æœ¬ï¼Œéœ€è¦ä¸€ä¸ªç‰¹å¾å‘é‡æå–å™¨ï¼Œå°†æ‰€æœ‰è¾“å…¥æ˜ å°„ä¸ºæŸä¸ªmetric spaceä¸­çš„ä¸€äº›å‘é‡ã€‚å°†è¿™äº›å‘é‡ç”¨åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šï¼Œæ¯”å¦‚ç”¨ä¸€ä¸ªç®€å•çš„MLPæ¥å—CLè¾“å‡ºçš„å‘é‡çš„è¾“å‡ºè¿›è¡Œåˆ†ç±»ã€‚ï¼ˆæˆ‘åœ¨å†™è¿™ä¸ªçš„æ—¶å€™ï¼Œæˆ‘è¿˜å®Œå…¨æ²¡æœ‰å®ç°è¿‡ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä¸¤ç¯‡è®ºæ–‡çš„å®éªŒéƒ¨åˆ†ï¼‰ã€‚</p>
</div>
<p>â€‹ ä¸ºäº†å®ç°ä»¥ä¸Šç›®çš„ï¼Œä¸¤ç¯‡è®ºæ–‡ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ³•ã€‚</p>
<h4 id="cpcæ€»ä½“æ€æƒ³">2.3.1 CPCæ€»ä½“æ€æƒ³</h4>
<p>â€‹ CPCæœ€åå¸Œæœ›ç”Ÿæˆencoderæˆ–è€…autoregressive modelï¼Œæ¥æ¥æ”¶ä¸€ä¸ªæ•°æ®æˆ–è€…æ˜¯ä¸€ä¸ªæ•°æ®åºåˆ—ï¼Œç”Ÿæˆé«˜ç»´è¡¨å¾ã€‚CPCå¯¹äºInfoNCEçš„ä¼˜åŒ–ï¼Œå®é™…ä¸Šæ˜¯åœ¨ä¼˜åŒ–ä¸€ä¸ªäº¤å‰ç†µå‡½æ•°ï¼ˆäºŒåˆ†ç±»ï¼‰ï¼Œç”±äºäºŒåˆ†ç±»çš„äº¤å‰ç†µå‡½æ•°å¯ä»¥è¢«å†™ä¸ºï¼š</p>
<p><span class="math display">\[
\begin{equation}\label{infonce2}
p(d=i|X,c_t)=\frac{p(x_i|c_t)\prod_{l\neq i}p(x_l)}{\sum_{j=1}^N p(x_j|c_t)\prod_{l\neq j}p(x_l)}
\end{equation}
\]</span> â€‹ <span class="math inline">\(p(x_i|c_t)\prod_{l\neq i}p(x_l)\)</span>è¡¨ç¤ºäº†å½“<span class="math inline">\(x_i\)</span>æ˜¯ä»æ­£æ ·æœ¬çš„ä¸Šä¸‹æ–‡æ¡ä»¶åˆ†å¸ƒä¸­é‡‡æ ·å¾—åˆ°ï¼Œè€Œå…¶ä»–çš„<span class="math inline">\(x_j\)</span>éƒ½æ˜¯å™ªå£°é‡‡æ ·æ—¶çš„æ¦‚ç‡ã€‚ä¸Šå¼çš„æ‰€æœ‰è¿ä¹˜ä¸­å‡ç¼ºå°‘æœ¬<span class="math inline">\(p(x_i)\)</span>ï¼Œäºæ˜¯å¯ä»¥å¾ˆå®¹æ˜“å†™æˆ<span class="math inline">\({p(x|c)}/{p(x)}\)</span>çš„å½¢å¼ã€‚å†™æˆè¿™ä¸ªå½¢å¼å°±å¯ä»¥ä½¿ç”¨CPCä¸­å¯¹è¿™ä¸ªæ¯”å€¼çš„å»ºæ¨¡äº†ã€‚æ€»ä¹‹ä¹Ÿæ˜¯æ„å»ºencoderï¼Œencoderæœ€ç»ˆè¾“å‡º<span class="math inline">\(f(x_{t+k},c_t)\)</span>è€Œä¸­é—´äº§ç”Ÿçš„å˜é‡<span class="math inline">\(z_t\)</span>ï¼ˆéšå˜é‡ï¼‰å¯ä»¥æ‹¿å»ç”¨ã€‚</p>
<h4 id="mocoæ€»ä½“æ€æƒ³">2.3.2 MoCoæ€»ä½“æ€æƒ³</h4>
<p>â€‹ å¯¹äºCPCè€Œè¨€ï¼Œå…¶encoderæ¯ä¸ªminibatchéƒ½ä¼šæ›´æ–°ï¼Œå˜åŒ–å¾ˆå¿«ï¼Œå¯èƒ½å°±æ˜¯å±äºMoCoè®ºæ–‡ä¸­ä¸‰ç§åˆ†ç±»çš„ç¬¬ä¸€ç§ã€‚</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/2.PNG" style="zoom: 50%;"></p>
<center>
Figure 2. MoCoè®ºæ–‡ä¸­å¯¹CLç»“æ„çš„ä¸‰ç§åˆ†ç±»
</center>
<p>â€‹ ä¸ºäº†é¿å…end2endé€ æˆçš„ä¸ç¨³å®šæ€§ï¼ˆæ²¡æœ‰ä¸€è‡´æ€§ï¼‰ï¼ŒMoCoçš„key encoderç›¸å½“äºæ˜¯åœ¨query encoderä¸Šåšäº†ä¸€ä¸ªæŒ‡æ•°å¹³å‡ï¼ˆä½é€šæ»¤æ³¢ï¼‰ï¼Œä½¿å¾—key encoderçš„å‚æ•°å˜åŒ–å¾ˆå¹³æ»‘ã€‚ä½¿å¾—æ›´æ–°å…·æœ‰ä¸€è‡´æ€§ã€‚MoCoå…¶ä»–æ–¹é¢çš„åŸºæœ¬æ€æƒ³ä¸CPCä¹Ÿç±»ä¼¼ï¼š</p>
<ul>
<li>å¯¹ä¸€ä¸ªbatchä¸­çš„æ¯ä¸€å¼ å›¾ç‰‡ï¼Œè‡ªèº«çš„å¢å¼ºä¸ºæ­£æ ·æœ¬ï¼Œå…¶ä»–å›¾ç‰‡çš„å¢å¼ºä¸ºè´Ÿæ ·æœ¬</li>
<li>ä¼˜åŒ–InfoNCEå®šä¹‰çš„å‡½æ•°ï¼šä½¿å¾—æ­£æ ·æœ¬æœ€èƒ½è¢«æ­£ç¡®åŒºåˆ†å‡ºæ¥</li>
<li>ä½¿ç”¨query encoderçš„å‚æ•°ç¼“æ…¢æ›´æ–°key encoderï¼Œå¹¶ä¸”key encoderä¸å‚ä¸åå‘ä¼ æ’­</li>
</ul>
<hr>
<h2 id="iii.-å®ç°---moco">III. å®ç° - MoCo</h2>
<p>â€‹ Momentum contrast çš„å®ç°éå¸¸ç®€å•ï¼Œè®ºæ–‡ä¸­ä¹Ÿæä¾›äº†pseudo codeï¼Œæ‰€ä»¥åœ¨å®ç°è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰é‡åˆ°ä»€ä¹ˆååˆ†å›°éš¾çš„é—®é¢˜ã€‚æˆ‘å€’æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é‡ä¸Šäº†ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªEncoderï¼ˆè½»é‡çº§çš„å…·æœ‰ä¸€äº›Residual Blocksçš„ç½‘ç»œï¼‰ï¼Œç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/3.PNG"></p>
<center>
Figure 3. Encoderç½‘ç»œ
</center>
<p>â€‹ å› ä¸ºæˆ‘æ–™åˆ°æˆ‘å¯èƒ½è·‘ä¸åŠ¨è®ºæ–‡é‡Œè¯´çš„ResNet50ä»¥åŠImageNetçš„å·¨å¤§æ•°æ®é›†ï¼Œæ‰€ä»¥æˆ‘é’ˆå¯¹CIFAR10è®¾è®¡äº†ä¸€ä¸ªæ— ç›‘ç£pretext taskã€‚æœ¬æ¥å°±æ˜¯æ‰“ç®—ç”¨è¿™ä¸ªç½‘ç»œç»“æ„å½“encoderæ¥è·‘MoCoï¼Œä½†æ˜¯å‘ç°ï¼Œè¿™ä¸ªç½‘ç»œä¼šä½¿å¾—lossä¸€ç›´å¡åœ¨ä¸€ä¸ªå€¼ä¸Šä¸åŠ¨ï¼ˆæå…¶é•¿çš„æ—¶é—´ï¼Œé•¿åˆ°æˆ‘æ²¡æœ‰è€å¿ƒç­‰å¾…ï¼‰å¹¶ä¸”æ³¢åŠ¨å¾ˆå°ã€‚æˆ‘æ€€ç–‘è¿™ä¸èƒ½æˆåŠŸåœ°è®­ç»ƒï¼Œæ‰€ä»¥ç”¨è¿™ä¸ªç½‘ç»œç›´æ¥åšäº†ä¸€ä¸ªBaselineè®­ç»ƒäº†ä¸€ä¸‹ï¼Œemmmï¼Œç»“æœå¾ˆä¸é”™ï¼šå¤§çº¦96%çš„æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œè™½ç„¶æˆ‘ä¸çŸ¥é“è¿™æ˜¯æ€ä¹ˆç®—å‡ºè¶…è¿‡1æ¥çš„ã€‚ä¸è¿‡è®­ç»ƒé›†çš„å‡†ç¡®ç‡æœ‰æ—¶ç”šè‡³å¯ä»¥è¾¾åˆ°1.00ï¼Œè¯´æ˜è¿™ä¸ªç½‘ç»œè¿˜æ˜¯æœ‰èƒ½åŠ›åšå¥½åˆ†ç±»çš„ã€‚</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/4.PNG"></p>
<center>
Figure 4. ç®€å•ResNetç»“æ„çš„Baseline
</center>
<p>â€‹ æˆ‘æœ€åå› ä¸ºå—ä¸äº†åƒåœ¾MX150æ˜¾å¡ï¼Œè·‘å»ç§Ÿäº†ä¸€ä¸ªäº‘ç”µè„‘ã€‚å¾ˆçˆ½å•Šï¼Œæ¨è<a href="http://gpu.ai-galaxy.cn/console">ã€æ™ºæ˜Ÿäº‘ã€‘</a>âœ¨ã€‚ç§Ÿäº†ä¸€ä¸ªè¿™ç©æ„ï¼š</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/5.PNG"></p>
<p>â€‹ 3.5å…ƒ1hï¼Œä¸çŸ¥é“ç®—ä¸ç®—ä¾¿å®œã€‚æˆ‘çŸ¥é“è¿™ä¸ªè®¾å¤‡è‚¯å®šèƒ½è·‘æ›´å¼ºçš„ç½‘ç»œï¼Œäºæ˜¯ç”¨torchvisionå†…ç½®çš„ResNet18ï¼ˆæ²¡æœ‰é¢„è®­ç»ƒï¼‰+ä¸€ä¸ªä»1000åˆ°128çš„ReLU FCå±‚ï¼Œè®­ç»ƒäº†200ä¸ªepochsï¼Œbatch sizeä¸º100ã€‚ç¡®å®è¿˜æŒºå¿«çš„ï¼Œ1ç§’å¤šä¸€ä¸ªbatchï¼Œè¦æˆ‘çš„æ¸£æœºè·‘å¯èƒ½å¾—10sä¸€ä¸ªbatchã€‚è®­ç»ƒçš„Lossç»“æœå¦‚ä¸‹ã€‚è¿™ä¸ªlosså°±æ¯”è¾ƒç¬¦åˆé¢„æœŸäº†ã€‚</p>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/6.PNG"></p>
<center>
Figure 5. ResNet18 MoCo Encoder lossè®­ç»ƒæˆæœ
</center>
<p>â€‹ éšåï¼Œä½¿ç”¨è¿™ä¸ªè®­ç»ƒå¥½çš„Encoderï¼Œå›ºå®šå‚æ•°è¿›è¡Œä¸‹æ¸¸ä»»åŠ¡ï¼šæœ‰ç›‘ç£çš„MLPåˆ†ç±»è®­ç»ƒã€‚MLPç»“æ„æ˜¯128-&gt;64-&gt;64-&gt;32-&gt;10ã€‚ç»“æœæŒº æ‹‰çš„ğŸ’¢ï¼Œå®Œå…¨æ¯”ä¸ä¸ŠBaselineï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä¸ªäººè§‰å¾—å¯èƒ½æœ‰å‡ ä¸ªtricksæ²¡ç”¨ï¼š</p>
<ul>
<li>lossæ˜¯å•å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆå‡ºçš„qå°±å½“qç”¨ï¼Œkå°±å½“kç”¨ï¼Œåªå­˜kä¸å­˜qï¼Œè™½ç„¶qï¼Œkæ˜¯ä¸åŒçš„ä¸¤æ¬¡transformï¼Œä½†æ˜¯æ²¡æœ‰åšåå‘çš„loss</li>
<li>Shuffle BNï¼Œæ•´ä¸ªresnetå†…éƒ¨éƒ½ä½¿ç”¨äº†BNï¼Œä½œè€…è¯´ç›´æ¥ä½¿ç”¨BNæ˜¯ä¸å¥½çš„</li>
<li>åæ­£æœ€åçš„ç»“æœä¹Ÿå°±æ˜¯50%çš„æ ·å­ï¼Œå¤ªæ‹‰äº†ã€‚</li>
</ul>
<p><img src="/2021/08/29/Contrastive-Learning-Intros/7.PNG"></p>
<center>
Figure 5. MLP æœ‰ç›‘ç£evaluation 45 epochs batch_size 50
</center>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://zhuanlan.zhihu.com/p/334772391">Noise Contrastive Estimation å‰ä¸–ä»Šç”Ÿâ€”â€”ä» NCE åˆ° InfoNCE</a></p>
<p>[2] <a href="https://openaccess.thecvf.com/content_CVPR_2020/html/He_Momentum_Contrast_for_Unsupervised_Visual_Representation_Learning_CVPR_2020_paper.html">He K, Fan H, Wu Y, et al. Momentum contrast for unsupervised visual representation learning[C]//Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. 2020: 9729-9738.</a></p>
<p>[3] <a href="https://arxiv.org/pdf/1807.03748.pdf?fbclid=IwAR2G_jEkb54YSIvN0uY7JbW9kfhogUq9KhKrmHuXPi34KYOE8L5LD1RGPTo">Oord A, Li Y, Vinyals O. Representation learning with contrastive predictive coding[J]. arXiv preprint arXiv:1807.03748, 2018.</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>æ— ç›‘ç£</tag>
      </tags>
  </entry>
  <entry>
    <title>Correspondence Problem Papers</title>
    <url>/2021/10/15/Correspondence-Problem-Papers/</url>
    <content><![CDATA[<h1 id="correspondence-problem">Correspondence Problem</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<blockquote>
<p>The <strong>correspondence problem</strong> refers to the problem of ascertaining which parts of one image correspond to which parts of another image, where differences are due to movement of the camera, the elapse of time, and/or movement of objects in the photos. ---Wikipedia</p>
</blockquote>
<p>â€‹ æœ€è¿‘ä¸€ç›´åœ¨åšä¸åŒ¹é…ç›¸å…³çš„é—®é¢˜ï¼šç‚¹äº‘é…å‡†ã€‚ç‚¹äº‘é…å‡†å°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„åŒ¹é…é—®é¢˜ï¼Œåœ¨åŸºäºç‰¹å¾çš„æ–¹æ³•ä¸‹ï¼Œæ‰¾åˆ°ä¸¤å¸§ç‚¹äº‘å¯¹åº”ä½ç½®çš„ç‰¹å¾ï¼Œå»ºç«‹åŒ¹é…å…³ç³»ï¼Œå¯ä»¥æ ¹æ®è®¡ç®—å¥½çš„åŒ¹é…ç®—å‡ºä½å§¿å˜æ¢ï¼Œè€Œç”±äºå¼•å…¥ç‰¹å¾ä»¥åŠç‰¹å¾åŒ¹é…ï¼Œé€šå¸¸æƒ…å†µä¸‹å¯ä»¥ä½¿å¾—é…å‡†ç®—æ³•å…·æœ‰å…¨å±€æ€§ã€‚</p>
<p>â€‹ æˆ‘åœ¨æœ€è¿‘çš„ä¸€æ¬¡ç»„ä¼šä¸Šåšäº†è®ºæ–‡åˆ†äº«ï¼Œè®²äº†ä¸¤ç¯‡å…·æœ‰å¾ˆå¼ºå…³è”æ€§çš„è®ºæ–‡ï¼ˆè¿™ä¸¤ç¯‡è®ºæ–‡éƒ½å¾ˆå¥½æ‡‚ï¼ŒICCV 2005çš„å°¤å…¶ç®€å•ï¼Œçœ‹å®Œå°±èƒ½å†™å‡ºä»£ç æ¥ï¼‰ï¼š</p>
<ul>
<li><a href="https://www.cs.cmu.edu/~efros/courses/LBMV07/Papers/leordeanu-iccv-05.pdf">ICCV 2005: A Spectral Technique for Correspondence Problems Using Pairwise Constraints</a></li>
<li><a href="https://arxiv.org/abs/2103.05465">CVPR 2021: PointDSC: Robust Point Cloud Registration using Deep Spatial Consistency</a></li>
</ul>
<p>â€‹ æˆ‘å°†æœ¬äººè®ºæ–‡åˆ†äº«æ—¶åšçš„PPTè´´åœ¨æœ¬æ–‡å†…ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-ppts">II. PPTs</h2>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(1).png"></p>
<center>
Figure 1. å…¸å‹åŒ¹é…å¯¹é—®é¢˜ï¼šç‚¹äº‘é…å‡†
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(2).png"></p>
<center>
Figure 2. å˜æ¢ä¸€è‡´æ€§åœ¨åˆšä½“å˜æ¢ä¸­çš„åº”ç”¨ï¼šæ—‹è½¬å¹³ç§»è·ç¦»ä¸å˜æ€§
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(3).png"></p>
<center>
Figure 3. æ€æƒ³ï¼šæ„å»ºå›¾é—®é¢˜ï¼Œä½¿ç”¨è°±æ–¹æ³•
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(8).png"></p>
<center>
Figure 4. æœ¬äººå¯¹è®ºæ–‡Içš„æ–¹æ³•æ€»ç»“
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(5).png"></p>
<center>
Figure 5. è®ºæ–‡Iå­˜åœ¨çš„é—®é¢˜ï¼ˆæ¯•ç«Ÿæ˜¯å¾ˆè€çš„å·¥ä½œäº†ï¼‰
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(6).png"></p>
<center>
Figure 6. æ–¹æ³•æ€»ç»“ï¼šç¬¬ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«å˜æ¢ä¸€è‡´æ€§çš„å…¨å±€ç¥ç»ç½‘ç»œæ¨¡å—ä»¥åŠç§å­ç‚¹é€‰å–çš„ç‰¹å¾ç­›é€‰
</center>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15%20(7).png"></p>
<center>
Figure 7. æ–¹æ³•æ€»ç»“ï¼šç¬¬äºŒéƒ¨åˆ†ï¼ŒKNNå­é›†æ‰©å¢ï¼ŒNSMæ¦‚ç‡è®¡ç®—ï¼ŒåŠ æƒæœ€å°äºŒä¹˜ï¼Œpropose and verify
</center>
<hr>
<h2 id="ä»Šæ—¥å¿«ä¹">ä»Šæ—¥å¿«ä¹</h2>
<p>â€‹ å‡»è´¥äº†å·¨äººï¼ˆå¿«ä¹ï¼‰ï¼Œä½†æ˜¯ä¹‹åè¢«å›½ç‹ä¹‹æ‰‹å¹²æ­»äº†ï¼ˆä¸å¿«ä¹ï¼‰ï¼š</p>
<p><img src="/2021/10/15/Correspondence-Problem-Papers/2021-10-15.png"></p>
<center>
Figure 8. æˆ‘çš„ç‹å•Š... çœŸä»–å¦ˆæ˜¯ä¸ªä¸å¯æ•‘è¯çš„æ··è›‹
</center>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>CycleGAN Paper Summary</title>
    <url>/2021/02/10/CycleGAN-Paper-Summary/</url>
    <content><![CDATA[<h1 id="cyclegan">CycleGAN</h1>
<hr>
<h2 id="preface">Preface</h2>
<p>â€‹ GANå¸¸ç”¨ä½œé£æ ¼è¿ç§»æˆ–è€…æ˜¯object transfigurationï¼Œä½†æ˜¯æ™®é€šçš„GANå®é™…ä¸Šå¹¶ä¸èƒ½å¾ˆå¥½åœ°èƒœä»»è¿™äº›ä»»åŠ¡ã€‚åŸå§‹çš„GANæ˜¯ä»ä¸€ä¸ªéšå«å‘é‡zï¼ˆå¸¸æœä»ä¸€ä¸ªç®€å•çš„å¤šç»´åˆ†å¸ƒï¼‰æ˜ å°„åˆ°ä¸€ä¸ªå…·æœ‰ä¸°å¯Œä¿¡æ¯çš„æ›´é«˜ç»´ç©ºé—´çš„è¿‡ç¨‹ï¼Œè€Œè¿™ç§æ˜ å°„å¾€å¾€â€œarbitraryâ€ï¼Œå®ƒå¯ä»¥ä¹±å°„ï¼ˆéšæœºæ€§çš„ç”Ÿæˆï¼‰ã€‚æ¯”å¦‚åœ¨object transfigurationä¸­ï¼ŒA-&gt;Bé›†åˆæ˜ å°„è¿‡ç¨‹å¯ä»¥é€šè¿‡æ­¤ç½‘ç»œå®ç°ï¼Œä½†Bé›†åˆè¿›å…¥ç½‘ç»œåï¼Œç”Ÿæˆå‡ºæ¥çš„ï¼ˆä¾‹åº”æ˜¯åŸå§‹çš„Bï¼‰å´ä¸åŸå§‹Bç›¸å·®å¾ˆè¿œã€‚å½“ç„¶ï¼Œåœ¨object transfigurationä¸­ï¼Œæ›´åŠ æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºpix2pixè®ºæ–‡æå‡ºçš„æˆå¯¹å›¾åƒè½¬æ¢è€Œè¨€ï¼Œæˆå¯¹å›¾åƒä¸€èˆ¬å¾ˆéš¾è·å¾—ã€‚å¦‚æœåªæœ‰ä¸¤ä¸ªé›†åˆA / Bï¼ŒA / Bå†…çš„å¯¹è±¡ä¸ºä¸åŒå±æ€§çš„ï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰é¢„å…ˆäº§ç”ŸåŒ¹é…å…³ç³»çš„æƒ…å†µå¦‚ä½•å°†A / Bé›†åˆå†…çš„ç‰©ä½“äº’ç›¸æ˜ å°„å‘¢ï¼Ÿ</p>
<span id="more"></span>
<p>â€‹ åœ¨è®ºæ–‡ <em>Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks</em> ï¼ˆarXivé“¾æ¥ï¼š<a href="https://arxiv.org/abs/1703.10593">ã€arXiv Previewã€‘ğŸ”—</a>ï¼‰ä¸­ï¼Œä½œè€…æå‡ºäº†ï¼šCycle Consistancyçš„æ€æƒ³ï¼ˆå¥½äº†ï¼Œxxxä¸€è‡´æ€§ï¼Œå¬å¤šäº†ï¼‰ï¼ˆå¾ªç¯ä¸€è‡´æ€§ï¼‰ï¼Œåœ¨è¯¯å·®å‡½æ•°ä¸­æ·»åŠ äº†ä¸¤é¡¹ï¼š</p>
<ul>
<li>å¾ªç¯ä¸€è‡´è¯¯å·®ï¼ˆCCLï¼‰ï¼Œç”¨äºæ§åˆ¶ä¸€è‡´æ€§ï¼ˆæ˜¾ç„¶ï¼‰</li>
<li>æœ¬å¾ä¸€è‡´æ€§ï¼Œæ„Ÿè§‰ä½œè€…æ²¡æœ‰æã€‚ä½†æ˜¯æˆ‘è§‰å¾—å¯ä»¥é€šè¿‡CCLæ¨å¯¼å‡ºæ¥ã€‚</li>
</ul>
<h3 id="å¤ç°çš„ç»“æœ">å¤ç°çš„ç»“æœ</h3>
<p>â€‹ ç”±äºå—åˆ°è®¾å¤‡çš„é™åˆ¶ï¼ˆGeForce MX150ï¼Œä¸‰å¹´çš„i5å°ç±³Airè½»è–„æœ¬çš„æ¸£æ˜¾å¡ï¼‰ç½‘ç»œåªè®­ç»ƒäº†25ä¸ªè¿­ä»£ï¼ˆåŸæ–‡ä½¿ç”¨äº†50ä¸ªå­¦ä¹ ç‡æ’å®šè¿­ä»£ï¼Œæ­¤å50ä¸ªè¿­ä»£å­¦ä¹ ç‡çº¿æ€§é€’å‡è‡³0ï¼‰ï¼Œä¹Ÿæ²¡æœ‰ä¿®æ”¹å­¦ä¹ ç‡è®¾ç½®ã€‚ä¸€å¼ å›¾ç‰‡å¤§æ¦‚éœ€è¦è®¡ç®—1sï¼Œ995å¼ å›¾ç‰‡éœ€è¦15min+æ‰èƒ½å®Œæˆä¸€è½®è¿­ä»£ã€‚ç»“æœå¦‚å›¾ï¼š</p>
<p><img src="/2021/02/10/CycleGAN-Paper-Summary/result.JPG"></p>
<center>
Figure 1. è®­ç»ƒç»“æœ
</center>
<p>â€‹ ä¸¤è¡Œä¸ºä¸€ç»„ï¼Œä¸€å…±å…­è¡Œã€‚å‰ä¸¤è¡Œæ˜¯æ©™å­-&gt;è‹¹æœï¼Œä¸­é—´ä¸¤è¡Œæ˜¯è‹¹æœ-&gt;æ©™å­ï¼Œåä¸¤è¡Œæ˜¯åˆå§‹æƒ…å†µï¼ˆæ¬ è®­ç»ƒæ—¶çš„ç»“æœï¼‰ã€‚</p>
<hr>
<h2 id="è®ºæ–‡çš„ç»†èŠ‚">è®ºæ–‡çš„ç»†èŠ‚</h2>
<h3 id="cclçš„å®šä¹‰">CCLçš„å®šä¹‰</h3>
<p>â€‹ åœ¨ã€3. Formulationã€‘ä¸­ï¼Œä½œè€…æåˆ°ï¼šå¾ªç¯ä¸€è‡´æ€§å°±æ˜¯ï¼šå‡è®¾é›†åˆ<span class="math inline">\(X\)</span>ä¸<span class="math inline">\(Y\)</span>åˆ†åˆ«åŒ…å«ä¸¤ç§ç±»å‹ç‰©ä½“ï¼Œ<span class="math inline">\(G\)</span>ä¸<span class="math inline">\(F\)</span>åˆ†åˆ«æ˜¯ä¸¤ä¸ªç”Ÿæˆå™¨ï¼Œå…¶ä¸­<span class="math inline">\(G\)</span>ç”¨äºåˆ©ç”¨é›†åˆ<span class="math inline">\(X\)</span>å¯¹è±¡ç”Ÿæˆé›†åˆ<span class="math inline">\(Y\)</span>çš„å¯¹è±¡ï¼Œ<span class="math inline">\(F\)</span>åˆ™æ­£å¥½ç›¸åã€‚ä¹Ÿå°±æ˜¯ï¼š <span class="math display">\[
G: X\rightarrow Y,G(x)\rightarrow Y,\text{for each }x\in X \\
F: Y\rightarrow X,F(y)\rightarrow X,\text{for each }y\in Y
\]</span> â€‹ é‚£ä¹ˆå¯¹äºè¿™æ ·çš„æ˜ å°„ï¼Œåº”è¯¥æœ‰ï¼š<span class="math inline">\(F(G(x))\approx x\)</span>ï¼ˆä¹Ÿå°±æ˜¯ç»è¿‡ä¸¤ä¸ªç”Ÿæˆç½‘ç»œåï¼Œ<span class="math inline">\(X\rightarrow Y\rightarrow X\)</span>ï¼‰ï¼Œæ•°æ®åº”è¯¥å’Œåˆå§‹è¾“å…¥ä¿æŒä¸€è‡´ã€‚åœ¨object transfigurationæˆ–æ˜¯style transferä¸­ï¼Œæˆ‘è§‰å¾—è¿™ç§æƒ³æ³•ååˆ†è‡ªç„¶ï¼Œå¹¶ä¸”å¾ˆå¦™ã€‚ç”±äºåœ¨è¿™ä¸¤ä¸ªé—®é¢˜ä¸­ï¼Œå›¾åƒæœ¬èº«çš„å½¢çŠ¶ç‰¹å¾å¹¶ä¸ä¼šå‘ç”Ÿå·¨å¤§çš„å˜åŒ–ï¼Œå˜åŒ–çš„åªæ˜¯é¢œè‰² / çº¹ç†å±æ€§ï¼Œåœ¨object transfigurationä¸­ï¼Œä»ç‰©ä½“Aå˜æˆç‰©ä½“Bä»¥åŠå…¶åè¿‡ç¨‹æ˜¯å¯¹ç§°çš„ï¼Œé£æ ¼è¿ç§»ä¸­ï¼Œé£æ ¼çš„åŠ å…¥å’Œæ¶ˆé™¤ä¹Ÿæ˜¯å¯¹ç§°çš„ï¼ˆå¯ä»¥å°†åŸå›¾çœ‹æˆå¦ä¸€ç§é£æ ¼ï¼‰ï¼Œé‚£ä¹ˆç”±åå‡½æ•°çš„æ€§è´¨ï¼Œåº”è¯¥å­˜åœ¨ä¸Šå¼çš„ç»“æœã€‚äºæ˜¯ï¼Œä½œè€…å®šä¹‰äº†ä¸€ä¸ªCycle Consistancy Lossï¼š <span class="math display">\[
L_{cyc}(G,F,x,y)=\Vert G(F(y))-y\Vert_1+\Vert F(G(x))-x\Vert_1
\]</span> â€‹ ä¹Ÿå°±æ˜¯ç”¨ï¼ˆç†è®ºä¸Šçš„identityå˜æ¢ï¼‰å˜æ¢å‰åçš„å›¾åƒçš„1-èŒƒæ•°è¿›è¡Œæ¯”è¾ƒã€‚æ˜¾ç„¶æ˜¯è¶Šå°è¶Šå¥½ï¼Œå¸Œæœ›è¿™ç§identityæ˜ å°„å‰ååŸºæœ¬ä¸å˜ã€‚</p>
<p>â€‹ ä½†å…¶å®æ•´ç¯‡è®ºæ–‡ä¼ è¾¾çš„æ„æ€å°±é‚£ä¹ˆç®€å•ï¼Œ18é¡µçš„è®ºæ–‡ï¼Œæ”¾äº†ä¸€åŠé¡µæ•°çš„å›¾ï¼Œä½†æ˜¯åšçš„äº‹æƒ…å´ç‰›å¤§äº†ï¼ˆè™½ç„¶å·²ç»æ˜¯4å¹´å‰çš„è®ºæ–‡äº†ï¼‰ã€‚ä¸å¾—ä¸åæ§½ä¸€ä¸‹ï¼ŒåŸè®ºæ–‡ä¸­æåˆ°çš„ä¿¡æ¯ä¸å¤ªå¤šï¼ˆå¯èƒ½æ˜¯å› ä¸ºè¿™äº›åŸºæœ¬çš„é—®é¢˜ä½œè€…è®¤ä¸ºå¤§å®¶éƒ½åº”è¯¥æ˜ç™½æ‰€ä»¥ä¸è¯´äº†ï¼Ÿï¼‰ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« éå¸¸å¥½æ‡‚ï¼Œå¤ç°èµ·æ¥ä¹Ÿç›¸å¯¹ç®€å•ï¼ˆä½†æ˜¯æˆ‘å¤ªèœäº†ï¼Œé‡åˆ°äº†ä¸€äº›å‘ï¼‰ã€‚</p>
<hr>
<h3 id="cclå¯ä»¥æ¨å‡ºä»€ä¹ˆ">CCLå¯ä»¥æ¨å‡ºä»€ä¹ˆ</h3>
<p>â€‹ ä¸ªäººè®¤ä¸ºï¼Œæ—¢ç„¶å­˜åœ¨CCLï¼ˆ<span class="math inline">\(X\rightarrow Y\rightarrow X\)</span>å¾ªç¯æ˜ å°„ä¸å˜ï¼‰ï¼Œé‚£ä¹ˆä»¥ä¸‹æƒ³æ³•ä¹Ÿæ˜¯è‡ªç„¶åº”è¯¥æˆç«‹çš„ï¼šè®¾<span class="math inline">\(x\in X, y \in Y\)</span>ï¼Œé‚£ä¹ˆåº”è¯¥å­˜åœ¨ï¼š <span class="math display">\[
\begin{equation}
G:X\rightarrow Y, G(y)\approx y\\
F:Y\rightarrow X, F(x)\approx x
\end{equation}
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äºGçš„è¾“å‡ºç©ºé—´ä¸º<span class="math inline">\(Y\)</span>ï¼ˆæœŸæœ›ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå·²ç»åœ¨yç©ºé—´é‡Œçš„æ•°æ®è€Œè¨€ï¼Œç”Ÿæˆç½‘ç»œä¸åº”è¯¥æ”¹å˜å…¶ç‰¹å¾ã€‚æ‰€ä»¥å¯ä»¥å®šä¹‰æœ¬å¾ä¸€è‡´æ€§lossï¼š <span class="math display">\[
\begin{equation}\label{equ:ind}
L_{ind}=\mathbb E_{p\_data(y)} \Vert G(y)-y\Vert_1 + \mathbb E_{p\_data(y)} \Vert F(x)-x\Vert_1
\end{equation}
\]</span> â€‹ å¯ä»¥è®¤ä¸ºè¿™æ˜¯å¾ªç¯çš„ä¸€åŠæƒ…å†µå§ï¼Œä½†æ˜¯ç¡®å®æ˜¯åº”è¯¥åŠ å…¥åˆ°lossé¡¹ä¸­çš„ï¼Œæ—¢ç„¶å­˜åœ¨å¾ªç¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæœ¬å¾ä¸€è‡´æ€§ç†è®ºä¸Šæ¥è¯´ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚</p>
<p>â€‹ äºæ˜¯ï¼Œfull objectiveåº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}
L_{full}(X,Y,G,F)=L_{adv}(X,Y,G,F)+L_{cyc}(X,Y,G,F)+L_{ind}(X,Y,G,F)
\end{equation}
\]</span></p>
<hr>
<h3 id="ç½‘ç»œç»“æ„">ç½‘ç»œç»“æ„</h3>
<h4 id="ç”Ÿæˆå™¨">ç”Ÿæˆå™¨</h4>
<p><span id="generator"></span></p>
<p>â€‹ è®ºæ–‡ä¸­çš„ç”Ÿæˆå™¨é‡‡ç”¨äº†ResNetç»“æ„ï¼Œé¦–å…ˆå›¾ç‰‡éƒ½æ˜¯256 * 256 * 3çš„å›¾ç‰‡ï¼Œä»¥6ä¸ªResidual Blockç»“æ„è¿›è¡Œè¯´æ˜ï¼š</p>
<ul>
<li>è¾“å…¥å±‚ï¼šè¾“å…¥3 è¾“å‡º64ï¼Œ<span class="math inline">\(7\times 7\)</span> å¤§å°çš„å·ç§¯ç½‘ç»œï¼Œä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°ï¼ŒInstanceNorm
<ul>
<li>Reflection Padding</li>
</ul></li>
<li>è¾“å…¥64 è¾“å‡º128ï¼Œ<span class="math inline">\(3\times 3\)</span> å·ç§¯ç½‘ç»œï¼Œ<strong><u>æ­¥é•¿2</u></strong>ï¼Œå…¶ä½™åŒä¸Š
<ul>
<li>Reflection Padding</li>
</ul></li>
<li>è¾“å…¥128 è¾“å‡º256ï¼Œ<span class="math inline">\(3\times 3\)</span> å·ç§¯ç½‘ç»œï¼Œ<strong><u>æ­¥é•¿2</u></strong>ï¼Œå…¶ä½™åŒä¸Š</li>
<li>Residual Block 1ï¼Œ256-&gt;256ï¼Œ<span class="math inline">\(3\times 3\)</span> å·ç§¯ç½‘ç»œï¼Œ<strong><u>æ­¥é•¿2</u></strong>ï¼Œå…¶ä½™åŒä¸Šï¼Œä¸ªäººä½¿ç”¨äº†ZeroPadding</li>
<li>Residual Block 2ï¼ŒResidual Block 3ï¼ŒResidual Block 4ï¼ŒResidual Block 5ï¼ŒResidual Block 6</li>
<li>éæ•´æ•°æ­¥é•¿çš„å·ç§¯ï¼ˆConvTransposeï¼Œåå·æ“ä½œï¼‰ï¼Œ <span class="math inline">\(3\times 3\)</span> ï¼Œæ­¥é•¿1/2ï¼Œ256-&gt;128</li>
<li>éæ•´æ•°æ­¥é•¿çš„å·ç§¯ï¼Œ <span class="math inline">\(3\times 3\)</span> ï¼Œæ­¥é•¿1/2ï¼Œ128-&gt;64</li>
<li>è¾“å‡ºå±‚ï¼Œï¼ˆ64-&gt;3ï¼‰å…¶ä½™åŒè¾“å…¥å±‚ï¼ŒTanhæ¿€æ´»</li>
</ul>
<p></p>
<h4 id="åˆ¤åˆ«å™¨">åˆ¤åˆ«å™¨</h4>
<p><span id="clf"></span></p>
<p>â€‹ åˆ¤åˆ«å™¨ä½¿ç”¨PatchGANç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åªè¾“å‡ºä¸€ä¸ªå€¼ï¼ˆæ¯”å¦‚è¿‡å·ç§¯åå†è¿‡å…¨è¿æ¥è¾“å‡º1ï¼‰ã€‚è¾“å‡ºçš„æ˜¯ä¸€ä¸ªsuper imageï¼Œsuper imageæ˜¯ä¸€å¼ sizeæ›´å°çš„å•é€šé“å›¾ï¼Œæ¯ä¸ªåƒç´ è¡¨ç¤ºçš„æ˜¯ï¼š<strong><u>åˆ¤åˆ«å™¨è¾“å‡ºçš„ç»“æœï¼Œå›¾åƒä¸Šæ¯å°å—ä¸ºrealçš„æ¦‚ç‡ï¼ˆé‡æ–°ç»„ç»‡çš„ç‰¹å¾å›¾ï¼‰</u></strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¾“å‡ºå±‚åªéœ€è¦å·ç§¯ï¼Œè¾“å‡ºå·ç§¯ç»“æœã€‚</p>
<ul>
<li><span class="math inline">\(4\times 4\)</span> Convolutionï¼Œ64-&gt;128ï¼Œå¾ˆå¥‡æ€ªå§ã€‚å¶æ•°å¤§å°çš„kernelï¼Œæ‰€ä»¥anchoråœ¨å“ªï¼Ÿ LeakyReLU(0.2)
<ul>
<li>InstanceNorm</li>
</ul></li>
<li><span class="math inline">\(4\times 4\)</span> Convolutionï¼Œ128-&gt;256 LeakyReLU(0.2)</li>
<li><span class="math inline">\(4\times 4\)</span> Convolutionï¼Œ256-&gt;512 LeakyReLU(0.2)</li>
<li><span class="math inline">\(4\times 4\)</span> Convolutionï¼Œ512-&gt;1ï¼Œç›´æ¥è¾“å‡º</li>
</ul>
<p>é¢ï¼Œä¸è®²æ­¦å¾·ã€‚ä¸ºä»€ä¹ˆç½‘ç»œç»“æ„ç»†èŠ‚æ”¾åœ¨Appendixï¼Ÿæå¾—æˆ‘ä»¥ä¸ºæˆ‘è¯»å®Œäº†ï¼Œæœ€åä¸€ä¹±ç¿»å‘ç°äº†æ›´é‡è¦çš„ä¸œè¥¿ã€‚</p>
<p></p>
<hr>
<h3 id="åŸå§‹ganæ¨¡å¼å´©å¡Œ">åŸå§‹GANæ¨¡å¼å´©å¡Œ?</h3>
<h4 id="æ¨¡å¼å´©å¡Œçš„å®šä¹‰">æ¨¡å¼å´©å¡Œçš„å®šä¹‰</h4>
<p>â€‹ æ¨¡å¼å´©å¡Œä¹Ÿå°±æ˜¯å¤šä¸ªè¾“å…¥æ˜ å°„åˆ°åŒä¸€ä¸ªè¾“å‡ºä¸Šçš„æƒ…å†µã€‚è¿™é€šå¸¸å‡ºç°åœ¨è¾“å‡ºæ¨¡å¼å…·æœ‰å¤šå³°åˆ†å¸ƒçš„æƒ…å†µã€‚é€šå¸¸æˆ‘ä»¬å¸Œæœ›ï¼Œåœ¨ç›®æ ‡åˆ†å¸ƒï¼ˆä¸å¯çŸ¥ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡é‡‡æ ·å­¦ä¹ è¿‘ä¼¼ï¼‰å¤šå³°çš„æƒ…å†µä¸‹ï¼Œæ‹Ÿåˆçš„è¿‘ä¼¼åˆ†å¸ƒä¹Ÿåº”è¯¥æ˜¯å¤šå³°çš„ã€‚ä½†å¦‚æœå‡ºç°äº†ç”Ÿæˆå™¨è¿‡å¼ºçš„æƒ…å†µï¼Œç›´æ¥å¯¼è‡´ç”Ÿæˆå™¨æ¯æ¬¡éƒ½æ‹Ÿåˆåˆ°å…¶ä¸­ä¸€ä¸ªå³°ä¸Šï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´æ¨¡å¼å´©å¡Œã€‚</p>
<p><img src="/2021/02/10/CycleGAN-Paper-Summary/adver.JPG"></p>
<center>
Figure 2. å›¾ç‰‡æ¥è‡ªGoodfellowè‘—åè®ºæ–‡ GAN[1]
</center>
<p>â€‹ ä¸Šå›¾è¯´æ˜çš„æ˜¯ï¼Œå¤šå³°åˆ†å¸ƒæ—¶ï¼Œæ¯ä¸€æ¬¡è®­ç»ƒç”Ÿæˆå™¨åçš„ç”Ÿæˆåˆ†å¸ƒã€‚è®­ç»ƒé€ æˆäº†æ¨¡å¼å´©å¡Œï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºçš„ä½ä¸°å¯Œæ€§ï¼Œè¿™å°±å¤±å»äº†GANæœ¬èº«çš„æ„ä¹‰ã€‚</p>
<p>â€‹ Goodfellowåœ¨è®ºæ–‡ä¸­æåˆ°ä¸¤ç§å¯èƒ½äº§ç”Ÿæ¨¡å¼å´©å¡Œçš„åŸå› ï¼š</p>
<h5 id="jsklæ•£åº¦çš„ä½¿ç”¨å¯¼è‡´æ¨¡å¼å´©å¡Œ">JS/KLæ•£åº¦çš„ä½¿ç”¨å¯¼è‡´æ¨¡å¼å´©å¡Œ</h5>
<p>â€‹ JSæ•£åº¦ï¼š <span class="math display">\[
\begin{equation}\label{equ:js}
2D_{JS}(P_R|P_G)=\int_xP_R(x)log(\frac{P_R(x)}{\frac{P_R(x) + P_G(x)}{2}})dx + \int_xP_G(x) log(\frac{P_G(x)}{\frac{P_R(x) + P_G(x)}{2}})dx
\end{equation}
\]</span> â€‹ KLæ•£åº¦ï¼š <span class="math display">\[
\begin{equation}
D_{KL}(P|Q)=\int_xP(x)log(\frac{P(x)}{Q(x)})dx
\end{equation}
\]</span> â€‹ KLæ•£åº¦èƒ½é€ æˆæ›´åŠ ææ€–çš„æ¨¡å¼å´©å¡Œã€‚ç”±äºKLæ•£åº¦çš„éå¯¹ç§°æ€§ï¼Œæ¯æ¬¡æ±‚å¯¼éƒ½ä¼šå¾€ç‰¹å®šæ–¹å‘é€¼è¿‘ã€‚æ±‚å¯¼æ—¶å¾€ç‰¹å®šæ–¹å‘è¶‹è¿‘çš„é—®é¢˜å¯¼è‡´äº†æ¨¡å¼å´©å¡Œï¼Ÿä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸKLæ•£åº¦çš„ä¸å¯¹ç§°æ€§å†³å®šäº†å…¶å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘è¿›è¡Œè§‚å¯Ÿï¼Œä¸¤ä¸ªæ–¹å‘ä¸Šçš„KLæ•£åº¦ä¸æ˜¯ç›¸åŒçš„ï¼ŒGoodfellowç§°<span class="math inline">\(D_{KL}(p_{data}\Vert p_{model})\)</span>ï¼ˆä»¥dataåˆ†å¸ƒä¸ºä¸»å¯¼çš„KLæ•£åº¦ï¼‰ä¸ºæ­£KLæ•£åº¦ï¼Œ<span class="math inline">\(D_{KL}(p_{model}\Vert p_{data})\)</span>ä¸ºé€†KLæ•£åº¦ã€‚æ­£KLæ•£åº¦å’Œé€†KLæ•£åº¦åœ¨ä¼˜åŒ–ä¸Šçš„è¡¨ç°æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚å¯ä»¥ä»ç›´è§‚ä¸Šç†è§£ï¼Œå‰è€…æ˜¯ç»™å®šæ•°æ®åˆ†å¸ƒï¼ˆçš„è®¡ç®— / ä¼°è®¡ï¼‰æ—¶ï¼Œæ¨¡å‹åˆ†å¸ƒäºæ•°æ®åˆ†å¸ƒçš„å·®åˆ«ï¼Œé‚£ä¹ˆæ­¤æ—¶æ¨¡å‹åˆ†å¸ƒ <strong><u>å°†ä¼šæ˜¯è¢«åŠ¨çš„</u></strong>ï¼Œåªè¦èƒ½è¾¾åˆ°æœ€å°æ‹Ÿåˆçš„æƒ…å†µï¼Œæ¨¡å‹åˆ†å¸ƒæ€ä¹ˆæ ·éƒ½å¯ä»¥ã€‚</p>
<p><img src="/2021/02/10/CycleGAN-Paper-Summary/collapse.JPG"></p>
<center>
Figure 3. æ¨¡å¼å´©å¡Œé—®é¢˜ä¸­çš„ä¸¤ç§KLæ•£åº¦[1]
</center>
<p>â€‹ å¦‚ä¸Šå›¾å·¦å›¾ï¼Œç”±äºåŸå§‹ï¼ˆæ•°æ®ï¼‰åˆ†å¸ƒå·²çŸ¥ï¼Œæ¨¡å‹åˆ†å¸ƒä¸ºäº†äº§ç”Ÿæœ€å°æ•£åº¦ï¼Œå½¢çŠ¶å¯ä»¥å¾ˆå¥‡æ€ªã€‚è€Œåœ¨é€†KLæ•£åº¦ä¸­ï¼Œå·²ç»çŸ¥é“çš„æ˜¯æ¨¡å‹åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå·²ç»å‡ºç°åœ¨æ¨¡å‹ä¸­çš„æ¨¡å¼<strong><u>æ¦‚ç‡åˆ†å¸ƒå¤§</u></strong>ï¼Œå°šæœªå‡ºç°çš„æ¨¡å¼æ¦‚ç‡åˆ†å¸ƒå°ã€‚è¿™æ ·ä¸€åŠ æƒï¼Œå°±ä¼šè®©å·²ç»ç”Ÿæˆçš„æ¨¡å¼è¢«å¼ºåŒ–ï¼Œé€ æˆå•å³°æ€§ï¼ˆå¦‚ä¸Šå›¾å³ï¼‰ã€‚</p>
<p>â€‹ è¿™ä¸¤ç§KLæ•£åº¦å€¾å‘æ€§ä¸åŒï¼š</p>
<ul>
<li>æ­£KLæ•£åº¦å€¾å‘äºæ»¡è¶³æ•°æ®åˆ†å¸ƒï¼Œä¸è€ƒè™‘æ¨¡å‹å·²ç»æœ‰çš„åˆ†å¸ƒï¼Œæ‰€ä»¥å¾ˆå¯èƒ½ç”Ÿæˆä¸€äº›å¥‡æ€ªçš„æ¨¡å¼ï¼ˆæ¯”å¦‚ä¸Šå›¾ä¸­æ¦‚ç‡åˆ†å¸ƒå¤§çš„éƒ¨åˆ†åœ¨ä¸¤å³°ä¸­é—´ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼‰ï¼Œä½†æ˜¯ç†è®ºä¸Šå…¶å¤šæ ·æ€§æ›´ä½³</li>
<li>é€†KLæ•£åº¦å€¾å‘äºç”Ÿæˆå·²ç»å­˜åœ¨çš„æ¨¡å¼ï¼Œä¸ä¹ æƒ¯äºè·³å‡ºåœˆå­ã€‚æ˜¾ç„¶è¿™æ ·åšä¼šäº§ç”Ÿæ›´å¤šæˆ‘ä»¬ç†Ÿæ‚‰çš„æ¨¡å¼ï¼Œæ›´å°‘å¥‡æ€ªçš„æ–°æ¨¡å¼ï¼Œä½†æ˜¯å®¹æ˜“å¼•èµ·æ¨¡å¼å´©å¡Œã€‚</li>
</ul>
<p>â€‹ å…³äºè¿™ç‚¹ï¼ŒGoodfellowè¿™æ ·è¯´åˆ°ï¼š</p>
<blockquote>
<p>We can think of <span class="math inline">\(D_{KL}(p_{data}\Vert p_{model})\)</span> as preferring to place high probability everywhere that the</p>
<p>data occurs, and <span class="math inline">\(D_{KL}(p_{model}\Vert p_{data})\)</span> as preferrring to place low probability wherever the data does not occur.</p>
</blockquote>
<h5 id="minmaxé¡ºåºé—®é¢˜">min/maxé¡ºåºé—®é¢˜</h5>
<p>â€‹ Goodfellowåœ¨GANè®ºæ–‡ä¸­ä¹Ÿæåˆ°ï¼ŒGANçš„åŸç†ï¼ˆmin maxï¼‰å¯èƒ½ä¼šå¼•èµ·æ¨¡å¼å´©å¡Œã€‚é€šå¸¸æˆ‘ä»¬è¯´ï¼ŒGANæ˜¯ï¼šminmaxç»“æ„çš„ï¼Œä¹Ÿå°±æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{equ:minmax}
G^*=\mathop{argmin}_{G} \mathop{max}_{D}L(G,D)
\end{equation}
\]</span> â€‹ å…¶æ„ä¹‰ä¹Ÿå°±æ˜¯ï¼ˆåœ¨å‰æŸç¯‡æ–‡ç« ä¸­æåˆ°è¿‡ï¼‰ï¼šåœ¨åˆ¤åˆ«å™¨æœ€ä¼˜çš„æƒ…å†µä¸‹è¿›è¡Œç”Ÿæˆå™¨çš„æœ€ä¼˜åŒ–ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€ä¸ªååˆ†å¼ºçš„åˆ¤åˆ«å™¨å­˜åœ¨çš„æƒ…å†µä¸‹ä»ç„¶èƒ½å°½å¯èƒ½ä¼˜åŒ–ç”Ÿæˆå™¨ï¼Œç›´åˆ°ç”Ÿæˆå™¨éª—è¿‡åˆ¤åˆ«å™¨ã€‚è€ŒGoodfellowè¯´åˆ°ï¼š</p>
<blockquote>
<p>We use it in the hope that it will behave like min max but it often behaves like max min.</p>
</blockquote>
<p>â€‹ max minä¹Ÿå°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{equ:minmax}\)</span>å¯¹äºmin / maxçš„å–åç»“æœã€‚ä¸ªäººè®¤ä¸ºå¯ä»¥è¿™æ ·ç†è§£ï¼šmax minç»“æ„ä¹Ÿå°±æ˜¯ï¼šè®­ç»ƒç”Ÿæˆå™¨åœ¨å†…å¾ªç¯ï¼Œè®­ç»ƒåˆ¤åˆ«å™¨åœ¨å¤–å¾ªç¯ã€‚ç›´è§‚ä¸Šçœ‹ä¹Ÿå°±æ˜¯æ¯ä¸€æ¬¡è®­ç»ƒåˆ¤åˆ«å™¨ï¼Œå¯èƒ½ä¼šè®­ç»ƒå¤šæ¬¡ç”Ÿæˆå™¨ã€‚è¿™æ ·æ˜¯ä¸å¥½çš„ã€‚åˆ¤åˆ«å™¨è®­ç»ƒä¸€æ¬¡ä¹‹åï¼Œç”Ÿæˆå™¨ä¼šæœ‰è¿‡æ‹Ÿåˆåˆ°<strong><u>åˆ¤åˆ«å™¨è®¤ä¸ºæœ€åƒreal dataçš„ä¸€ç§ï¼ˆæˆ–å°‘æ•°å‡ ç§ï¼‰æ¨¡å¼ä¸Š</u></strong>çš„è¶‹åŠ¿ï¼ˆç”±äºç”Ÿæˆå™¨è¦è®­ç»ƒå¤šæ¬¡ï¼‰ã€‚è¿™å°±å¯¼è‡´äº†æ¨¡å¼å´©å¡Œã€‚å…³äºè¿™ä¸ªç†è§£ï¼ŒåŸæ–‡æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<blockquote>
<p>The generator is thus asked to map every <strong>z</strong> value to the single <strong>x</strong> coordinate that the discriminator believes is most likely to be real rather than fake.</p>
</blockquote>
<p>â€‹ æœ‰äº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´GANçš„è¡Œä¸ºæ›´åƒmax minè€Œémin maxã€‚ä¸ªäººè®¤ä¸ºï¼šè®­ç»ƒä¸€æ¬¡åˆ¤åˆ«å™¨åè®­ç»ƒå¤šæ¬¡åˆ†ç±»å™¨å¯èƒ½é€ æˆæ­¤æƒ…å†µï¼ˆæˆ‘ä¹‹å‰ä¹Ÿè¿™ä¹ˆå†™è¿‡ï¼Œæ•ˆæœæ˜¯å¥½çš„ï¼Œæ¯•ç«Ÿç”Ÿæˆå‡ºæ¥çš„å›¾ç‰‡æœ€åƒçœŸçš„ï¼Œä½†æ˜¯å¤šæ ·æ€§å˜å·®äº†ï¼‰ã€‚</p>
<hr>
<h2 id="å¤ç°çš„ç»†èŠ‚">å¤ç°çš„ç»†èŠ‚</h2>
<h3 id="åå·ç§¯è¿‡ç¨‹">åå·ç§¯è¿‡ç¨‹</h3>
<p>â€‹ åœ¨CycleGAN<a href="#generator">[ç½‘ç»œç»“æ„ç»†èŠ‚]</a>ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†è¿™æ ·çš„ä¸€ä¸ªç»“æ„ï¼šéæ•´æ•°æ­¥é•¿çš„å·ç§¯ï¼ˆConvTransposeï¼Œåå·æ“ä½œï¼‰ï¼Œ <span class="math inline">\(3\times 3\)</span> ï¼Œæ­¥é•¿1/2ï¼Œ256-&gt;128ã€‚åå·ç§¯ä¹‹å‰è¯•ç€ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯ç”±äºï¼ˆå½“æ—¶æˆ‘ä»¥ä¸ºï¼‰1/2æ­¥é•¿æ—¶å…¶è¾“å‡ºåªèƒ½ä¸ºå¥‡æ•°ï¼Œå°±æ²¡æœ‰æ·±å…¥äº†è§£äº†ã€‚ç»“æœæ­¤å¤„ç¢°ä¸Šäº†ï¼Œä¸ºäº†å°½å¯èƒ½æŒ‰ç…§è®ºæ–‡å¤ç°ï¼Œé‡æ–°äº†è§£äº†ä¸€ä¸‹è¿™ä¸ªç©æ„ã€‚</p>
<p>â€‹ ConvTransposeå°±æ˜¯å·ç§¯çš„é€†è¿‡ç¨‹ï¼Œåœ¨æœ‰æ­¥é•¿çš„æƒ…å†µä¸‹æ›´ä¸ºæ˜æ˜¾ã€‚å¸¸ç”¨äºä¸Šé‡‡æ ·æ”¾å¤§ã€‚ä½†å®é™…ä¸Šï¼Œå³ä½¿æ­¥é•¿ä¸º1ï¼Œâ€œæ”¾å¤§â€ä¹Ÿæ˜¯åšä¸åˆ°çš„ã€‚ç”±äºConvTransposeå®é™…ä¸Šä¹Ÿæ˜¯ç”¨å·ç§¯æ ¸ç”Ÿæˆè¾“å‡ºï¼Œå·ç§¯æ ¸å¿…ç„¶å¯¼è‡´è¾“å‡ºå°äºè¾“å…¥ï¼Œæ‰€ä»¥éœ€è¦åŠ å…¥paddingã€‚paddingè®©æˆ‘æ„Ÿè§‰åå·ç§¯åœ¨æ”¾å¤§è¿‡ç¨‹ä¸­éœ€è¦åŠ å…¥å¤ªå¤šæ— æ•ˆçš„ä¿¡æ¯ï¼ˆå³ä½¿reflection paddingä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰ï¼Œæ¯•ç«Ÿæ˜¯ä¸Šé‡‡æ ·è¿‡ç¨‹ï¼ˆä¿¡æ¯ å°‘-&gt;å¤šï¼‰ã€‚è¿™ç§â€œæ— æ•ˆä¿¡æ¯çš„åŠ å…¥â€åœ¨æ­¥é•¿ä¸ä¸º1çš„1æ—¶å€™æ›´èƒ½ä½“ç°å‡ºæ¥ï¼ˆå¦‚ä¸‹å›¾ç‰‡åˆ—è¡¨ï¼‰</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/02/10/CycleGAN-Paper-Summary/pad.gif"></th>
<th><img src="/2021/02/10/CycleGAN-Paper-Summary/nopad2.gif"></th>
<th><img src="/2021/02/10/CycleGAN-Paper-Summary/nopad3.gif"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">paddingæ”¾å¤§</td>
<td>strideæ”¾å¤§ï¼ˆå¥‡æ•°ï¼‰</td>
<td>strideæ”¾å¤§ï¼ˆå¶æ•°ï¼‰</td>
</tr>
</tbody>
</table>
<p>â€‹ åˆ†æ•°æ­¥é•¿çš„å·ç§¯å°±æ˜¯éœ€è¦ä¸Šé‡‡æ ·çš„å·ç§¯ã€‚æ•´æ•°æ­¥é•¿å°†ä¼šä½¿å·ç§¯æ ¸è·³è¿‡ä¸€äº›ä½ç‚¹ï¼Œè€Œåˆ†æ•°ï¼ˆå°äº1ï¼‰åˆ™æ˜¯éœ€è¦åœ¨ä½ç‚¹ä¹‹é—´è¿›è¡Œpaddingçš„ã€‚é1æ­¥é•¿ / æœ‰paddingçš„å·ç§¯è®¡ç®—å°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<p>â€‹ å€¼å¾—æ³¨æ„çš„æ˜¯åˆ†æ•°æ­¥é•¿çš„å·ç§¯ï¼Œå½“æ­¥é•¿ä¸ä¸º1æ—¶ï¼ˆæ¯”å¦‚stride = 2ï¼‰ï¼Œä¸¤ä¸ªåŸå§‹ä½ç‚¹ä¹‹é—´ä¼šå¡«å……ä¸€ä¸ªä½ç‚¹ã€‚è¿™æ ·å¯¼è‡´äº†ï¼šå½“stride = 2æ—¶ï¼Œä¸ç®¡åŸæ¥çš„è¾“å…¥sizeä¸ºå¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œè¾“å‡ºä¸€å®šæ˜¯å¥‡æ•°sizeçš„ï¼ˆ<strong><u>æ­¤å¤„è¯´çš„æ˜¯kernel sizeä¸ºå¥‡æ•°ï¼Œä¸ªäººæ„Ÿè§‰å¶æ•°çš„kernel sizeä¸å¤Ÿè‡ªç„¶ï¼Œéœ€è¦è®¨è®ºanchor</u></strong>ï¼‰ï¼ˆå¶æ•°kernel sizeå¯ä»¥è®©è¾“å‡ºä¸ºå¶æ•°ï¼Œæ¯”å¦‚ConvTranspose2d(n, n, 4, 2, 1) å°±æ˜¯æ”¾å¤§sizeä¸ºåŸæ¥çš„ä¸¤å€ï¼‰ã€‚æˆ‘å®ç°çš„ç¬¬ä¸€ç‰ˆCycleGANä½¿ç”¨çš„æ˜¯ConvTransposeï¼Œé™„å¸¦äº†ä¸€ä¸ªoutput_padding (ç”±äºå½“æ—¶ä½¿ç”¨å¥‡æ•°æ ¸)ï¼Œæ­£å¦‚å›¾ä¸‰æ‰€ç¤ºï¼Œæ„Ÿè§‰å…¶ç»“æœååˆ†ä¸è‡ªç„¶ï¼Œä½†æ•ˆç‡ä¸Šå¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ã€‚å¯¹äºå¶æ•°kernelï¼Œå…¶anchoré»˜è®¤åœ¨æœ€å·¦ä¸Šæ–¹ã€‚</p>
<p>â€‹ ç„¶è€Œåœ¨ç¬¬äºŒç‰ˆCycleGANä¸­æˆ‘å°±æŠŠåå·ç§¯æ¢æˆäº†å·ç§¯+ä¸Šé‡‡æ ·äº†ï¼Œç½‘ç»œçœ‹èµ·æ¥æ›´æ­£å¸¸ä¸€äº›ã€‚</p>
<hr>
<h3 id="patchgan">PatchGAN</h3>
<p>â€‹ è¿™é‡ŒæŒ‡çš„æ˜¯åˆ†ç±»å™¨è®¾è®¡ï¼ŒCycleGANä½œè€…åœ¨å…¶è®ºæ–‡ä¸­é‡‡ç”¨äº†CycleGANçš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯åˆ†ç±»å™¨ä¸è¾“å‡ºäºŒåˆ†ç±»æ¦‚ç‡å€¼ï¼Œè€Œæ˜¯ç›´æ¥è¾“å‡ºä¸€ä¸ªchannel-1çš„å·ç§¯ç»“æœã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª256*256çš„å›¾åƒå¯ä»¥è¢«ä¸€ä¸ª70*70çš„ç‰¹å¾å›¾ç»™è¡¨è¾¾ï¼Œè¿™70*70ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨ç€å›¾ä¸Šçš„æŸä¸ªåŒºåŸŸçš„çœŸå®æ€§ã€‚è‡ªç„¶æˆ‘ä»¬å¸Œæœ›ï¼Œåœ¨åˆ¤å®šä¸ºçœŸå®æ—¶è¿™ä¸ªè¾“å‡ºæ¥è¿‘ones(70, 70)ï¼Œåä¹‹æ¥è¿‘zeros(70, 70)ã€‚è®ºæ–‡ä¸­ä½¿ç”¨äº†70*70ï¼Œæˆ‘çš„å®ç°ä¸­å¹¶æ²¡æœ‰è¿™ä¹ˆåšã€‚æˆ‘å†™çš„åˆ¤åˆ«å™¨ç»“æ„ï¼š</p>
<ul>
<li>(256, 256, 3) -&gt; (128, 128, 8) kernel size = 4ï¼Œstride = 2ï¼Œpadding = 1ï¼Œno norm</li>
<li>(128, 128, 8) -&gt; (64, 64, 16) kernel size = 4ï¼Œstride = 2ï¼Œpadding = 1ï¼Œinstance norm</li>
<li>(64, 64, 16) -&gt; (32, 32, 32) kernel size = 4ï¼Œstride = 2ï¼Œpadding = 1ï¼Œinstance norm</li>
<li>(32, 32, 32) -&gt; (16, 16, 1) kernel size = 4ï¼Œstride = 2ï¼Œpadding = 1ï¼Œno activation, no norm.</li>
</ul>
<p>â€‹ å½“ç„¶ï¼Œå¦‚æœè¦è¯´çš„è¯ï¼Œä¸ªäººè¿˜æœ‰å‡ ä¸ªæ²¡æœ‰å¤ç°çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>ResNet residual blockæˆ‘åªç”¨äº†ä¸¤ä¸ªã€‚åœ¨è®ºæ–‡ä¸­ï¼Œ128*128ä½¿ç”¨äº†6ä¸ªresBlockï¼Œ256*256åˆ™ä½¿ç”¨äº†9ä¸ªã€‚</li>
<li>æ²¡æœ‰é¿å…model oscillationçš„trickï¼ˆä½¿ç”¨å†å²ç”Ÿæˆçš„å›¾ç‰‡è€Œéå½“å‰æœ€æ–°ç”Ÿæˆçš„å›¾ç‰‡è¿›è¡Œè®­ç»ƒï¼‰</li>
<li>å¯èƒ½æœ¬å¾Lossæ˜¯æˆ‘åŠ è¿›å»çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨åŸæ–‡ä¸­å¹¶æ²¡æœ‰è¯»å‡ºè¿™æ ·çš„æ„æ€æ¥ã€‚ï¼ˆ<strong><u>å¼ éº»å­ï¼šè¿™tmæ˜¯å¤ç°ï¼Ÿ</u></strong>ï¼‰</li>
</ul>
<hr>
<h3 id="normalizationè°ˆ">Normalizationè°ˆ</h3>
<p>â€‹ é¦–å…ˆçœ‹ä¸€å¼ å›¾ï¼ˆæ¥è‡ªè¥¿äº¤è¢æ³½å‰‘è€å¸ˆçš„CVPRè¯¾PPTï¼Œè€ŒPPTä¸Šçš„å›¾åˆæ˜¯æ¥è‡ª<a href="https://arxiv.org/abs/1803.08494">ã€Wu and He, â€œGroup Normalizationâ€, ECCV 2018ğŸ”—ã€‘</a></p>
<p><img src="/2021/02/10/CycleGAN-Paper-Summary/norm.JPG"></p>
<center>
Figure 4. 4ç§normalization
</center>
<p>â€‹ ä¸Šå›¾æè¿°äº†å¸¸ç”¨çš„ï¼ˆç¬¬å››ç§æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ä¹Ÿä¸çŸ¥é“æ˜¯å•¥ï¼‰4ç§normï¼ˆæˆ‘ç›®å‰è§è¿‡ç”¨çš„åªæœ‰BNä¸INï¼‰ã€‚Normalizationçš„ä½œç”¨å°±æ˜¯ç¥ç»ç½‘ç»œçš„â€œç™½åŒ–æ“ä½œâ€ï¼Œå°†NNçš„è¾“å‡ºå›ºå®šäºNorm(0, 1)ï¼Œå¯ä»¥ç¨³å®šè®­ç»ƒã€‚</p>
<h4 id="bn">BN</h4>
<p>â€‹ BatchNormçœ‹åå­—å°±åº”è¯¥èƒ½çŸ¥é“ï¼Œè¿™ç§Normalizationä¸batchæœ‰å…³ã€‚çœ‹ç¬¬ä¸€å¼ å›¾ï¼Œå½“Batch sizeä¸ºNæ—¶ï¼Œå°†ä¼šå¯¹æŸä¸ªchannelåšbatchå†…çš„normæ“ä½œï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªbatché‡Œçš„æ‰€æœ‰è®­ç»ƒç”¨ä¾‹ + ä¸€ä¸ªchannelçš„ç‰¹å¾ï¼‰ã€‚æ˜¾ç„¶è¿™ä¸ªæ“ä½œåœ¨batch sizeä¸º1æ—¶æ„ä¹‰ä¸å¤§ï¼ˆé€€åŒ–æˆäº†instance normï¼Ÿï¼‰ã€‚ç±»ä¼¼äºå¤šå¼ å›¾ç‰‡è®­ç»ƒçš„ï¼ˆåˆ¤åˆ«æ¨¡å‹ï¼‰å¸¸ç”¨è¿™ä¸ªã€‚</p>
<h4 id="in">IN</h4>
<p>â€‹ æ˜¾ç„¶instance normä¸batchæ²¡æœ‰å…³ç³»ï¼Œå®ƒæ˜¯å¯¹å•å¼ å›¾ç‰‡æ„ä¹‰ä¸Šçš„normã€‚å›¾ç‰‡æ¯ä¸ªé€šé“è¿›è¡Œnormalizationã€‚é€šé“æ•°å¯¹åº”äº†filteræ•°ï¼Œfilterå¯¹åº”äº†ç”Ÿæˆçš„ç‰¹å¾ã€‚å®é™…ä¸Šinstance normå°±æ˜¯å¯¹ä¸åŒçš„ç‰¹å¾è¿›è¡Œnormalizationã€‚instance normç”±äºé’ˆå¯¹å•å¼ å›¾ç‰‡çš„ä¸åŒé€šé“ï¼Œå¸¸ç”¨äºç”Ÿæˆå¼æŠ€æœ¯æ¯”å¦‚style transferã€‚</p>
<h4 id="layernorm-groupnorm">LayerNorm &amp; GroupNorm</h4>
<p>â€‹ Laynorm æ˜¯ä¸€å¼ å›¾çš„æ‰€æœ‰é€šé“åšnormalizationã€‚ç½‘ä¸Šè¯´æ˜¯å¯¹RNNæ˜æ˜¾çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘æ²¡æœ‰æ·±å…¥äº†è§£è¿‡ã€‚è€ŒGroupNormç›¸å½“äºæ˜¯å¤šä¸ªé€šé“çš„Instance Normï¼Œé€‰å–çš„é€šé“æ•°æ˜¯å¯å˜çš„ã€‚</p>
<hr>
<h3 id="resnetç›¸å…³">ResNetç›¸å…³</h3>
<p>â€‹ ResNetä¸“æ³¨äºå­¦ä¹ è¾“å…¥è¾“å‡ºæ®‹å·®çš„è¡¨ç¤ºï¼Œè€Œä¸æ˜¯å­¦ä¹ ç®€å•çš„è¾“å…¥è¾“å‡ºå…³ç³»ã€‚ä¸ºä»€ä¹ˆè¯´å­¦ä¹ æ®‹å·®ï¼Ÿæ™®é€šçš„CNNç½‘ç»œè¾“å…¥è¾“å‡ºç»“æ„æ˜¯è¿™æ ·çš„ï¼š <span class="math display">\[
x\mathop{\rightarrow}^F F(x)\rightarrow y
\]</span> â€‹ å­¦ä¹ çš„æ˜¯xä¸yä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œè€Œåœ¨res netç§ï¼Œå¢åŠ äº†ä¸€ä¸ªidentity mappingçš„åˆå¹¶ï¼š <span class="math display">\[
x\mathop{\rightarrow}^F F(x)\rightarrow x&#39;,y=x+x&#39;
\]</span> â€‹ é‚£ä¹ˆï¼ŒçœŸæ­£çš„è¾“å‡ºæ˜¯yï¼Œä½†æ˜¯å­˜åœ¨å‚æ•°çš„éƒ¨åˆ†è¾“å…¥è¾“å‡ºåªæœ‰x'ï¼Œä¹Ÿå°±æ˜¯è¯´å­¦ä¹ çš„å®é™…ä¸Šåªæ˜¯y-xï¼ˆè¾“å‡º - è¾“å…¥ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå­¦ä¹ çš„æ˜¯æ®‹å·®ï¼Œæ®‹å·®è¡¨ç¤ºå°†å¯ä»¥ä½¿æ·±å±‚ç½‘ç»œæ”¶æ•›é€Ÿåº¦åŠ å¿«ï¼Œå¹¶ä¸”ç½‘ç»œè¿‡æ·±æ—¶æ¨¡å‹å‡†ç¡®ç‡å¹¶ä¸ä¼šæœ‰å¤ªå¤§çš„æŸå¤±ã€‚å®é™…ä¸ŠResNetçš„ residual blockç»“æ„ä¹Ÿå°±æ˜¯ä¸€ä¸ªidentical mappingå’Œå·ç§¯çš„å¹¶è”ï¼Œä¸ªäººåœ¨åˆšå¼€å§‹ä»€ä¹ˆéƒ½ä¸æ‡‚çš„æ—¶å€™ï¼Œæ›¾ç»å°†ä¸¤ä¸ªä¸åŒkernel sizeçš„å·ç§¯å±‚å¹¶è”åœ¨ä¸€èµ·ï¼Œè§‰å¾—è¿™ä¼šæé«˜ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼ˆè™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåªæ˜¯ä¸€ç§æ„Ÿè§‰ï¼‰ã€‚æ‰€ä»¥CycleGANä¸ºä»€ä¹ˆè¦ä½¿ç”¨ResNetç»“æ„ï¼Ÿ</p>
<p>â€‹ ä¸ªäººçš„ç†è§£æ˜¯ï¼šç½‘ç»œå±‚æ•°åŠ æ·±æ—¶ï¼ŒåŸå§‹å›¾çš„ä¿¡æ¯ä¼šåœ¨ç»è¿‡å·ç§¯å‘ç”ŸæŸå¤±ï¼Œå±‚æ•°è¶Šæ·±ï¼Œç§¯ç´¯çš„æŸå¤±è¶Šå¤§ã€‚åŠ å…¥ç›´æ¥çš„ä¿¡æ¯é€šé“ï¼ˆshortcutï¼‰å¯ä»¥å‡å°‘è¿™æ ·çš„ä¿¡æ¯æŸå¤±ã€‚ï¼ˆå¯èƒ½ä¸ªäººåŸæ¥ä½¿ç”¨ä¸åŒçš„kernel sizeæ ¸å¹¶è”æ—¶è§‰å¾—ï¼Œè¿™æ ·å¯ä»¥åœ¨åŒä¸€å±‚èšåˆä¸åŒå¤§å°çš„ç‰¹å¾ï¼‰ã€‚CSDNä¸Šæœ‰ä¸€ç¯‡æ–‡ç« è¯´çš„å¾ˆå¥½ï¼ˆæ€»ç»“èµ·æ¥å°±æ˜¯å¦‚ä¸‹è§‚ç‚¹ï¼‰[2]:</p>
<ul>
<li><p>å­™å‰‘ï¼ˆï¼Ÿæ˜¯æˆ‘ä»¬å­¦æ ¡çš„å­™å‰‘è€å¸ˆå—ï¼‰è®¤ä¸ºResNetå¯ä»¥é¿å…æ¢¯åº¦å¼¥æ•£é—®é¢˜ï¼ˆè¿‡æ·±çš„ç½‘ç»œä¼˜åŒ–æ—¶æ¢¯åº¦ä¸æ˜æ˜¾ï¼‰</p></li>
<li><p>ç‰¹å¾å†—ä½™å¯ä»¥è¢«å‰Šå¼±ï¼šå‡å°‘ä¿¡æ¯æŸå¤±é—®é¢˜ï¼ˆå’Œæˆ‘çš„æƒ³æ³•æœ‰ç‚¹ç±»ä¼¼ï¼‰</p></li>
<li><p>ensemble ç‰¹å¾èåˆï¼šå®é™…çš„ç½‘ç»œå±‚æ•°ç”±äºshortcutçš„åŠ å…¥å˜å¾—å¹¶ä¸å¤ªæ·±</p></li>
<li><p>å±‚æ¬¡æ€§ï¼šshortcutä¿ç•™äº†ç®€å•çš„ç‰¹å¾ï¼Œä¸å¤æ‚çš„ç‰¹å¾ï¼ˆå‚æ•°å·ç§¯éƒ¨åˆ†ï¼‰èåˆ</p></li>
<li><p>å‡¸å‡½æ•°æ€§ï¼šå±‚æ•°è¶Šæ·±ï¼Œå‡½æ•°éå‡¸æ€§è¶Šä¸¥é‡ï¼Œæ‰¾ä¸åˆ°å…¨å±€æœ€ä¼˜ï¼ŒResNetç»“æ„å¯ä»¥ä¼˜åŒ–å‡½æ•°éå‡¸æ€§</p></li>
</ul>
<hr>
<h3 id="ä¸€äº›ç»†èŠ‚é—®é¢˜">ä¸€äº›ç»†èŠ‚é—®é¢˜</h3>
<ul>
<li>å…³äºæ¿€æ´»å‡½æ•°ï¼šSigmoidé€šå¸¸ç”¨äºæ¦‚ç‡æ˜ å°„ï¼ŒTanhé€šå¸¸ç”¨äºå›¾åƒè¾“å‡ºå±‚ï¼Œè€ŒReLUå’ŒLeakyReLUé€šå¸¸ä½œä¸ºä¸­é—´å±‚çš„è¾“å‡ºå‡½æ•°ã€‚æ³¨æ„ä¸è¦ä¹±åŠ ã€‚</li>
<li>ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™è¾“å…¥å±‚ä¼šå€¾å‘äºä¸è¿›è¡Œnormalizationï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œè¾“å…¥çš„æ•°æ®ä¼šè¿›è¡Œé¢„å¤„ç†ï¼Œé€šå¸¸éƒ½åœ¨DataLoaderçš„transformä¸­ã€‚æ¯”å¦‚è¯´ä½¿ç”¨normalizeï¼Œä»¥åŠshuffleï¼Œå°±å·²ç»å¯ä»¥ä¿è¯æ•°æ®çš„æ ‡å‡†é«˜æ–¯åˆ†å¸ƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€å±‚æ˜¯ä¸éœ€è¦è¿›è¡Œnormalizeçš„ã€‚</li>
<li>Conv2Dä¸æä¾›paddingçš„æ¨¡å¼å˜æ¢ï¼ˆsameå’Œcircularé€‰é¡¹ä¸ç®—ï¼‰ï¼Œéœ€è¦åœ¨nnæ¨¡å—ä¸‹ä½¿ç”¨ReflectionPad / ZeroPad ç­‰ç­‰Paddingæ–¹å¼ã€‚</li>
</ul>
<hr>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>
<p>[1] Jun-Yan Zhu, Taesung Park, Phillip Isola, Alexei A. Efros Unpaired Image-to-Image Translation using Cycle-Consistent Adversarial Networks.</p>
<p>[2] Ian J. Goodfellow, Jean Pouget-Abadieâˆ— , Mehdi Mirza, Bing Xu, David Warde-Farley, Generative Adversarial Nets</p>
<p>[3] ã€ŠResNetä¸ªäººç†è§£ã€‹https://blog.csdn.net/nini_coded/article/details/79582902</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>Depth Completionè®ºæ–‡ä¸‰ç¯‡</title>
    <url>/2022/01/23/Depth-Completion%E8%AE%BA%E6%96%87%E4%B8%89%E7%AF%87/</url>
    <content><![CDATA[<h1 id="depth-completion">Depth Completion</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ æ·±åº¦è¡¥å…¨ä¸­å­˜åœ¨å¤šæ¨¡æ€æ•°æ®èåˆçš„é—®é¢˜ï¼šå•ç›®RGBå›¾åƒç›´æ¥è¿›è¡Œæ·±åº¦ä¼°è®¡æ¯”è¾ƒå›°éš¾ï¼ˆç›´æ¥æ·±åº¦ä¼°è®¡ï¼Œä¸ªäººæ„Ÿè§‰åªèƒ½å‡­å€Ÿå¸¸è¯†å’Œå…ˆéªŒçŸ¥è¯†ï¼‰ï¼Œè€Œå¦‚æœåŒæ—¶å­˜åœ¨ç¨€ç–æ¿€å…‰ç‚¹äº‘ï¼ˆæ•£æ­¥åœ¨ç¨ å¯†çš„å›¾åƒä¸Šï¼‰ï¼Œå¯ä»¥é€šè¿‡â€œä¼ æ’­çš„æ€æƒ³â€å°†ä¸€äº›ä½ç½®çš„æ·±åº¦ä¼ æ’­å‡ºå»ã€‚åœ¨è¿”ä¹¡çš„é«˜é“ä¸Šæ²¡äº‹å¹²ï¼ˆäº‹å®ä¸Šç”±äºæ²³å—å¤§é›ªä»¥åŠæ¹–åŒ—å¤§é›¨ï¼Œé«˜é“å˜æˆäº†ä½é“ï¼Œæ—¶é—´+2hï¼‰ï¼Œçœ‹äº†äº”ç¯‡è®ºæ–‡ï¼Œæœ¬æ–‡ç®€è¦åˆ†æäº†å…¶ä¸­ä¸‰ç¯‡å…³äº guidedæ·±åº¦è¡¥å…¨çš„æ–‡ç« ï¼š</p>
<ul>
<li>ICCV 2019: <a href="https://openaccess.thecvf.com/content_ICCV_2019/papers/Xu_Depth_Completion_From_Sparse_LiDAR_Data_With_Depth-Normal_Constraints_ICCV_2019_paper.pdf">Xu, Yan, et al. "Depth completion from sparse lidar data with depth-normal constraints." <em>Proceedings of the IEEE/CVF International Conference on Computer Vision</em>. 2019.</a></li>
<li>ICRA 2020 (å¯èƒ½å†™å¾—ä¸è¡Œ æ‰6å¼•): <a href="https://arxiv.org/abs/2103.00783">Hu, Mu, et al. "Towards Precise and Efficient Image Guided Depth Completion." <em>arXiv e-prints</em> (2021): arXiv-2103.</a></li>
<li>AAAI 2020: <a href="https://ojs.aaai.org/index.php/AAAI/article/view/6635">Cheng, Xinjing, et al. "Cspn++: Learning context and resource aware convolutional spatial propagation networks for depth completion." <em>Proceedings of the AAAI Conference on Artificial Intelligence</em>. Vol. 34. No. 07. 2020.</a></li>
</ul>
<p>â€‹ æœ¬æ–‡å¯èƒ½å†™å¾—<strong><u>å¾ˆçƒ‚</u></strong>ï¼Œç¬”è€…åœ¨çœ‹è¿™ä¸‰ç¯‡è®ºæ–‡ä»¥åŠå†™åšå®¢æ—¶ï¼Œç”±äºè¿”ä¹¡å®‰æ’å¤ªç´§ï¼Œåªç¡äº†3.25å°æ—¶ã€‚</p>
<span id="more"></span>
<h3 id="éœ€è¦è§£å†³çš„é—®é¢˜">1.1 éœ€è¦è§£å†³çš„é—®é¢˜</h3>
<p>â€‹ è¿™é‡Œæˆ‘å°±ç›´æ¥æ‘˜æŠ„CSPN++ä¸­å¯¹äºæ·±åº¦è¡¥å…¨é¢„æœŸæ•ˆæœçš„é˜è¿°ï¼š</p>
<blockquote>
<p>CSPN claims three important properties should be considered for the depth completion task, 1) <strong><u>depth preservation</u></strong>, where the depth value at sparse points should be maintained, 2) <strong><u>structure alignment</u></strong>, where the detailed structures, such as edges and object boundaries in estimated depth map, should be aligned with the given image, and 3) <strong><u>transition smoothness</u></strong>, where the depth transition between sparse points and their neighborhoods should be smooth. [1]</p>
</blockquote>
<p>â€‹ ä½†å®é™…ä¸Šï¼Œé˜…è¯»ICCV 2019æ–‡ç« ä¹‹åï¼Œä¸ªäººè§‰å¾—å¯èƒ½è¿˜å·®äº†è¿™ä¸¤ç‚¹ï¼š</p>
<ul>
<li>ç¬¦åˆ3Dçº¦æŸï¼Œ2Dæ·±åº¦å›¾èƒ½æ»¡è¶³ä¸€äº›3Då‡è®¾</li>
<li>æ­£ç¡®çš„å¹³æ»‘å‡è®¾ï¼šedge preservingçš„å¹³æ»‘å‡è®¾ï¼ˆç±»ä¼¼åŒè¾¹æ»¤æ³¢çš„æ€æƒ³ï¼‰</li>
</ul>
<hr>
<h2 id="ii.-sparse-lidar-guidance-iccv-2019">II. Sparse LiDAR Guidance (ICCV-2019)</h2>
<p><img src="/2022/01/23/Depth-Completion%E8%AE%BA%E6%96%87%E4%B8%89%E7%AF%87/iccv2019.png"></p>
<center>
Figure 1. ç½‘ç»œå¤„ç†æ¶æ„
</center>
<p>â€‹ ä¸ªäººè®¤ä¸ºæœ¬å·¥ä½œè™½ç„¶æ¯”ICRA-2020è¿™ç¯‡æ—©äº†ä¸€å¹´ï¼Œä½†æ˜¯è´¨é‡æ›´é«˜ã€‚æœ¬è®ºæ–‡çœ‹é—®é¢˜çš„è§’åº¦éå¸¸ç‹¬ç‰¹ï¼š</p>
<div class="note primary"><ul>
<li>ä¸€èˆ¬è®ºæ–‡ï¼šç›´æ¥åœ¨2Dç©ºé—´ï¼Œç¡¬å‡¿lossï¼Œæˆ–è€…åƒICRA-2020çš„PENetï¼ŒåŒ…å«ä¸€äº›ä¸æ˜æ‰€ä»¥çš„3Dä¿¡æ¯</li>
<li>æœ¬è®ºæ–‡ï¼šç›´æ¥åœ¨3Dç©ºé—´ä¸‹å»ºæ¨¡ æ·±åº¦ä¸æ³•å‘é‡çš„å…³ç³»ï¼Œæ”¾å¼ƒpiece-wise depth constantå‡è®¾ï¼Œè½¬å‘piece-wise plainå‡è®¾ï¼ˆè§‚æµ‹ç”±ä¸€å—å—å¹³é¢æ„æˆï¼‰</li>
</ul>
</div>
<p>â€‹ ä¸ªäººè®¤ä¸ºï¼Œpiece-wise depth constantæ˜¯ä¸ä¼˜é›…çš„ï¼Œé¦–å…ˆï¼Œè¿™ä¸ªå‡è®¾çš„ç›´æ¥ç»“æœå°±æ˜¯ï¼šè¾¹ç¼˜çš„æ¨¡ç³Šä¸å¹³æ»‘ï¼ˆç›¸å½“äºåŠ äº†ä¸€ä¸ªå¹³å‡æ ¸ï¼‰ï¼Œåœ¨2D CVé‚»åŸŸï¼Œæˆåƒç»“æœå¯ä»¥æ˜¯piece-wise constantçš„ï¼Œå…‰å­¦æˆåƒç»“æœä¸ä»…ä¸æ·±åº¦æœ‰å…³ï¼Œä¸åå°„ç‡ã€æè´¨ã€ä»‹è´¨ç­‰ç­‰å‡æœ‰å…³ç³»ï¼Œååˆ†å¤æ‚ã€‚ä½†å¯¹äºæ·±åº¦è€Œè¨€ï¼Œæ­¤å‡è®¾å¤ªè¿‡ç®€å•ç²—æš´ï¼Œè€Œä½œè€…æåˆ°çš„ â€œplain-origin distance piece wise constantâ€åˆ™æ˜¯åŸºäºï¼šå¤§é‡äººå·¥åœºæ™¯éƒ½æ˜¯ç”±ç¢ç‰‡åŒ–çš„å¹³é¢æ„æˆ è¿™ä¸€ç‰¹ç‚¹ï¼Œæ¯”è¾ƒç¬¦åˆå®é™…ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è§‚æµ‹ä¸¤å µå¢™ï¼Œä¸¤å µå¢™éƒ½ä¸æ˜¯å®Œå…¨å‚ç›´äºæˆ‘ä»¬è§†çº¿çš„ã€‚ä½¿ç”¨Piece-wise constantå‡è®¾å°†ä¼šä½¿å¾—æ·±åº¦è¿‡æ¸¡æ›´åŠ å¹³æ»‘ï¼Œå¯¹äºå¤šå¹³é¢æ·±åº¦ä¸è¿ç»­æƒ…å†µè€Œè¨€ï¼Œè¯¯å·®è¾ƒå¤§ï¼ˆä¼šå¹³å‡ä¸€äº›ä¸è¯¥å¹³å‡çš„ä½ç½®ï¼‰ï¼Œè€Œâ€œplain-origin distance piece-wise constantâ€åˆ™å¯ä»¥å‡†ç¡®æè¿°ä¸¤å µå¢™ï¼ˆç”šè‡³æ˜¯æ›´å¤šçš„å¹³é¢ï¼‰ã€‚</p>
<p>â€‹ æœ¬è®ºæ–‡çš„ä¸€èˆ¬å¤„ç†æ­¥éª¤ï¼š</p>
<div class="note "><h4 id="ç‰¹å¾æå–ç½‘ç»œprediction-stage">ç‰¹å¾æå–ç½‘ç»œï¼ˆprediction stageï¼‰</h4>
<div class="note danger no-icon">
<p>
â€‹ UNet-ResNet34 backbone æå–ç‰¹å¾ï¼Œç”Ÿæˆï¼š<strong><u>coarseæ·±åº¦å›¾</u></strong>ï¼Œ<strong><u>Guidance Feature</u></strong>ï¼ˆç›¸å½“äºcontextä¿¡æ¯ï¼‰ï¼Œ<strong><u>æ³•å‘é‡ä¼°è®¡</u></strong>ï¼Œ<strong><u>ç½®ä¿¡åº¦</u></strong>ã€‚
</p>
</div>
<div class="note warning no-icon">
<p>
â€‹ æ ¹æ®ç²—æ·±åº¦ + æ³•å‘é‡ï¼Œå˜æ¢åˆ°æ¯ä¸ªç‚¹æ‰€åœ¨å¹³é¢åˆ°åŸç‚¹ï¼ˆä¹Ÿå³ç›¸æœºä¸­å¿ƒï¼‰çš„è·ç¦»
</p>
</div>
</div>
<div class="note "><h4 id="recurrent-refinement-stage">Recurrent Refinement Stage</h4>
<p>â€‹ ä½¿ç”¨Diffusion modelï¼ˆç±»ä¼¼ç½®ä¿¡ä¼ æ’­ï¼Œä½†å¹¶æœªç›´æ¥ä½¿ç”¨MRFæˆ–è€…CRFç›¸å…³å…¬å¼ï¼‰ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§è§„åˆ™çš„å›¾å·ç§¯ï¼Ÿè¿­ä»£å¤šæ¬¡ï¼Œdiffusionæ ¹æ®ä¸¤ä¸ªåƒç´ ä½ç½®å¯¹åº”çš„guidance featureç›¸ä¼¼åº¦åˆ¤å®šdiffusion coefficientã€‚æœ€åçš„ç»“æœä»plain-origin distanceå˜æ¢ä¸ºåŸå§‹çš„æ·±åº¦ã€‚</p>
<p>â€‹ å½“ç„¶ï¼Œå¦‚æœæ¶‰åŠåˆ°å­˜åœ¨sparse LiDARæ·±åº¦ç‚¹çš„åƒç´ ä½ç½®ï¼Œç‰¹å¾æå–ç½‘ç»œè¾“å‡ºçš„ confidence å°†ä¼šæŠŠåŸæ·±åº¦ä»¥åŠé¢„æµ‹æ·±åº¦åŠ æƒæ±‚å’Œã€‚</p>
</div>
<p>â€‹ è¿™é‡Œåªç®€å•æ¨ä¸€æ¨Plain-origin distanceï¼šå·²çŸ¥ç‚¹åˆ°å¹³é¢çš„è·ç¦»å…¬å¼æ˜¯ <span class="math display">\[
\begin{equation}\label{dist}
N(\pmb{X})\cdot \pmb{X} -P=0
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(N(\pmb{X})\)</span>æ˜¯ä¸‰ç»´ç‚¹<span class="math inline">\(X\)</span>æ‰€åœ¨è¡¨é¢çš„åˆ‡å¹³é¢ï¼ˆtangent spaceï¼‰çš„æ³•å‘é‡ï¼Œé€šå¸¸æ¥è¯´ï¼Œç»™å®šè¶³å¤Ÿå¤šçš„ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨PCAæˆ–è€…æ±‚è§£åæ–¹å·®çŸ©é˜µæœ€å°ç‰¹å¾å€¼å¯¹åº”ç‰¹å¾å‘é‡ï¼ˆå®é™…ä¸Šè¿˜æ˜¯ç±»ä¼¼PCAï¼‰çš„æ–¹æ³•æ±‚è§£ã€‚<span class="math inline">\(\pmb{X}\)</span>æ˜¯å¹³é¢ä¸Šä¸€ç‚¹åˆ°ç›¸æœºä¸­å¿ƒçš„ç›¸æœºåæ ‡ç³»3D vectorã€‚å…¬å¼<span class="math inline">\(\eqref{dist}\)</span>è¡¨è¾¾çš„æ„ä¹‰å¾ˆæ¸…æ™°ï¼Œ<span class="math inline">\(N(\pmb{X})\cdot\pmb{X}\)</span>æ˜¯ <span class="math inline">\(\pmb{X}\)</span> åœ¨å¹³é¢æ³•å‘é‡ä¸Šçš„æŠ•å½±è·ç¦»ï¼Œä¹Ÿå°±æ˜¯åŸç‚¹åˆ°å¹³é¢çš„è·ç¦»ã€‚</p>
<p>â€‹ è€Œæœ‰æ·±åº¦å€¼ + ç›¸æœºå†…å‚ + åƒç´ ä½ç½®ï¼Œå¯ä»¥æ ¹æ®<span class="math inline">\(zK\pmb{x}=\pmb{X}\)</span>æ±‚çš„<span class="math inline">\(\pmb{X}\)</span>ã€‚é‚£ä¹ˆæ­£é€†å˜æ¢ï¼š <span class="math display">\[
\begin{align}
&amp;P(\pmb{x})=D(\pmb{x})N(\pmb{x})K\pmb{x}\\
&amp;D(\pmb{x})=\frac{P(\pmb{x})}{N(\pmb{x})K\pmb{x}}
\end{align}
\]</span> â€‹ æ€»çš„æ¥è¯´ï¼Œè¿™ç¯‡æ–‡ç« å¾ˆå¥½ç†è§£ï¼Œå†™å¾—å¾ˆæ¸…æ™°ã€‚</p>
<hr>
<h2 id="iii.-penet-icra-2020">III. PENet (ICRA-2020)</h2>
<p>â€‹ PENetä¸ªäººæ„Ÿè§‰åˆ›æ–°ç‚¹å¾ˆæœ‰é™ï¼Œè¿™ä¸ªç½‘ç»œç»™äººä¸€ç§ååˆ†é­”æ³•çš„æ„Ÿè§‰ï¼Œæ¯”å¦‚Color-dominantå’ŒDepth-dominantæ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†çš„ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°ä¸åŒæ¨¡æ€æ•°æ®çš„dominantã€‚</p>
<img src="/2022/01/23/Depth-Completion%E8%AE%BA%E6%96%87%E4%B8%89%E7%AF%87/icra2020.png">
<center>
Figure 2. çœ‹åˆ°ç½‘ç»œç»“æ„åæˆ‘å°±è§‰å¾— åäº† åº”è¯¥å¾ˆé­”æ³•
</center>
<h3 id="dilated-accelerated-cspn">3.1 Dilated &amp; Accelerated CSPN++</h3>
<p>â€‹ ä½œè€…å”¯ä¸€èŠ±äº†å¤§ç¯‡å¹…ä»‹ç»çš„ï¼Œæœ‰å®è´¨å†…å®¹çš„éƒ¨åˆ†å°±æ˜¯è¿™ä¸€éƒ¨åˆ†ã€‚å…¶ä¸­æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼ˆå¯èƒ½æ˜¯æˆ‘ä¸æ‡‚Spatial Propagation Networkï¼‰ï¼Œå…¶ä¸­çš„å…¬å¼ï¼ˆ3ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{map}
D_{i}^{t+1}=W_{ii}D_i^0+\Sigma_{j\in N(i)}W_{ji}D_j^t
\end{equation}
\]</span> â€‹ å¯¹äºè¿™ç§è¿­ä»£å¼çš„ç»“æ„ï¼Œä¸ªäººæ„Ÿè§‰æœ‰ç‚¹ç±»ä¼¼RNNï¼ˆRAFTé‡Œå°±æœ‰RNNçš„æŸä¸ªç»å…¸ç»“æ„ï¼šGRUï¼‰ã€‚ä½†è¿™å’Œå·ç§¯çš„åŒºåˆ«åœ¨å“ªï¼Ÿçœ‹èµ·æ¥å¾ˆåƒå·ç§¯ï¼šå¯¹äºå›¾åƒæŸä¸ªä½ç½®çš„è¾“å‡ºç¬¬t+1å±‚å·ç§¯çš„è¾“å‡ºï¼Œæ˜¯ä¸Šä¸€å±‚æ­¤ä½ç½®å‘¨å›´é‚»åŸŸå†…æ‰€æœ‰è¾“å…¥çº¿æ€§ç»„åˆçš„éçº¿æ€§æ˜ å°„ï¼ˆè€ƒè™‘æ¿€æ´»å‡½æ•°ï¼‰ã€‚å…³äºè¿™ä¸ªtranslated propagationï¼Œç…§æˆ‘ä¸ªäººç†è§£ï¼Œå…¶æ„æ€å¤§è‡´æ˜¯è¿™æ ·ï¼šä»ä»¥è®ºæ–‡ä¸­<span class="math inline">\(3\times3\)</span>é‚»åŸŸä¸ºä¾‹ï¼š</p>
<p>â€‹ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€ä¸ªã€ç‰¹å¾å›¾ã€‘è¿›è¡Œè®¡ç®—çš„<span class="math inline">\(3\times3\)</span>çŸ©é˜µå®é™…ä¸Šåº”è¯¥æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œæ­¤å¼ é‡å¯ä»¥æ˜¯<span class="math inline">\(3\times3\times C\)</span>å¤§å°çš„ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæœ‰9ä¸ªç‰¹å¾å‘é‡ï¼Œè¢«ç»„ç»‡æˆäº†äºŒç»´gridç»“æ„ã€‚é‚£ä¹ˆå¦‚æœéœ€è¦è¾“å‡ºæ˜¯ä¸€ä¸ªå‘é‡ï¼Œé‚£é’ˆå¯¹æ¯ä¸€ä¸ªå‘é‡çš„æ˜ å°„å°±åº”è¯¥æ˜¯å¤§å°ä¸º<span class="math inline">\(C\times C\)</span>çš„çŸ©é˜µã€‚æ•…å…¬å¼<span class="math inline">\(\eqref{map}\)</span>ä¸­å®šä¹‰çš„<span class="math inline">\(W\)</span>å®é™…ä¸Šåº”è¯¥æ˜¯<u><strong>å¾ˆå¤šçŸ©é˜µ</strong></u>ã€‚</p>
<p>â€‹ è¿™é‡Œä¸å·ç§¯ä¸åŒçš„æ˜¯ï¼šå·ç§¯å±‚çš„æ¯ä¸€ä¸ªkerneléƒ½ä¼šè€ƒè™‘æ„Ÿå—é‡å†…çš„æ¯ä¸€ä¸ªè¾“å…¥ï¼ˆé™¤éè¿™ä¸ªå·ç§¯å­¦ä¹ å¾—å¾ˆå¥‡æ€ªï¼Œå°±åªæœ‰ä¸€ä¸ªç‚¹å€¼é0ï¼‰ã€‚æ¯”å¦‚æ­¤å¤„çš„<span class="math inline">\(3\times3\times C\)</span>çš„è¾“å…¥ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª<code>Conv2d(C, N, k = 3)</code>è¿›è¡Œè®¡ç®—ï¼ˆè¾“å‡ºä¸€ä¸ªå¤§å°ä¸º<span class="math inline">\(1\times1\times N\)</span>çš„å‘é‡ï¼‰ï¼Œè¾“å‡ºçš„ç¬¬kä¸ªé€šé“ï¼ˆæ­¤å¤„ä¹Ÿå³<span class="math inline">\(\text{output}_{[0,0,k]}\)</span>ï¼‰æ˜¯ï¼š <span class="math display">\[
\begin{equation}
N_k=\sum_{t=0}^C\left\{\sum_{i=0}^2\sum_{j=0}^2A_t(i, j)C_t(i,j)\right\}+\text{bias},\text{ where }A\text{ is input and }C\text{ is kernel}
\end{equation}
\]</span> â€‹ å·ç§¯å®é™…ä¸Šæ˜¯å°†å›¾åƒä»¥é€šé“åˆ’åˆ†çš„ï¼Œå¤„ç†ä¿¡æ¯çš„è§†è§’æ˜¯ é€šé“ã€‚è€Œæ­¤å¤„çš„Spatial Propagationï¼Œæ˜¯ä»¥æ¯ä¸ªåƒç´ çš„ç‰¹å¾å‘é‡ä¸ºè§†è§’ï¼š <span class="math display">\[
\begin{equation}
V_o=\sum_{i=0}^2\sum_{j=0}^2W_{ij}A(i,j),\text{ where }W_{ij}\in\R^{C\times C}
\end{equation}
\]</span> â€‹ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™å°±æ˜¯ä¸€ä¸ª<strong><u>å‘é‡çš„çº¿æ€§ç»„åˆ</u></strong>è¿‡ç¨‹ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œé€šä¿—åœ°æ¥è¯´ï¼š</p>
<ul>
<li>å·ç§¯æ˜¯ä»¥é€šé“ä¸ºè§†è§’çš„ï¼Œå·ç§¯æ ¸éƒ½æ˜¯æ¯ä¸ªé€šé“è¿›è¡Œè®¡ç®—çš„</li>
<li>Spatial propagationï¼ˆè‡³å°‘åœ¨è¿™ç¯‡è®ºæ–‡é‡Œï¼‰æ˜¯ç‰¹å¾å‘é‡ï¼ˆæŸä¸€ç‚¹çš„æ‰€æœ‰é€šé“å€¼ï¼‰ä¸ºè§†è§’çš„ï¼Œå¯ä»¥è§†ä½œå‘é‡çš„çº¿æ€§ç»„åˆã€‚</li>
</ul>
<p>â€‹ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šåªæ˜¯ä¸ªäººè®¤ä¸ºçš„ã€å·ç§¯ã€‘ä¸ã€SPã€‘çš„åŒºåˆ«ï¼Œè®ºæ–‡ä¸­å®é™…ä»¥ã€æ·±åº¦å›¾ã€‘ï¼ˆå•é€šé“ï¼Œè€Œä¸æ˜¯ä¸Šæ–‡æ‰€è¯´çš„ç‰¹å¾å›¾ï¼‰è¿›è¡Œè®¡ç®—ï¼Œæ•…æ¯ä¸ª<span class="math inline">\(W_{ij}\)</span>å®é™…æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ã€‚ç”±äºç¬¬t+1æ¬¡è¿­ä»£çš„è¾“å‡ºï¼ˆx, yï¼‰æ˜¯ç¬¬tæ¬¡è¿­ä»£è¾“å…¥ï¼ˆx, yï¼‰é‚»åŸŸå€¼çš„ç»„åˆã€‚è€Œç”±äºä¸åŒåƒç´ <span class="math inline">\((x_1, y_1)\)</span>ç›¸å¯¹äºå…¶é‚»åŸŸæŸä¸ªç‚¹ï¼ˆæ¯”å¦‚ç›¸å¯¹è·ç¦»(-1, -1)çš„åƒç´ ï¼‰ä¸<span class="math inline">\((x_2, y_2)\)</span>ç›¸å¯¹äºç›¸åŒçš„ç›¸å¯¹ä½ç½®ç‚¹ï¼Œaffinityå€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œ<strong><u>æƒé‡å¹¶ä¸æ˜¯å…±äº«</u></strong>çš„ï¼Œæ•…ç®€å•å·ç§¯æ˜¯æ— æ³•è®¡ç®—çš„ã€‚</p>
<p><img src="/2022/01/23/Depth-Completion%E8%AE%BA%E6%96%87%E4%B8%89%E7%AF%87/onehot.png"></p>
<center>
Figure 3. One-hot convolution --- affinity map shifting
</center>
<p>â€‹ äº‹å®ä¸Šï¼ŒæŒ‰ç…§SPçš„æ€æƒ³ï¼Œæ¯ä¸ªåƒç´ ç›¸å¯¹äºé‚»åŸŸå†…æŸä¸ªç›¸å¯¹ä½ç½®ç‚¹å°†å¾—åˆ°ä¸€affinityå€¼ï¼Œé‚£ä¹ˆå¯¹äºæŸä¸€ä¸ªç›¸å¯¹ä½ç½®ç‚¹ï¼Œå°†å¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º<span class="math inline">\((H, W)\)</span>çš„å•é€šé“affinity mapï¼Œå°±æ¯”å¦‚ï¼šï¼Œå›¾åƒä¸­æ‰€æœ‰åƒç´ ç›¸å¯¹äº<span class="math inline">\(3\times 3\)</span>é‚»åŸŸå†…(-1, -1)ä½ç½®å°†å½¢æˆä¸€ä¸ªå•é€šé“affinity mapï¼Œé‚£ä¹ˆ<span class="math inline">\(3\times 3\)</span>é‚»åŸŸå°†å½¢æˆ9ä¸ªç›¸å¯¹äºä¸åŒä½ç½®çš„å•é€šé“affinity mapã€‚è€Œä¸”è¿™äº›affinity mapå°±åƒæ˜¯relative positional embeddingsä¸€æ ·ï¼Œéœ€è¦ä¸æ­£ç¡®ç›¸å¯¹ä½ç½®çš„å€¼è¿ç®—ï¼Œä¸¾ä¾‹è¯´æ˜ï¼š</p>
<ul>
<li>è€ƒè™‘å›¾åƒä¸Šï¼ˆ1, 1ï¼‰ç‚¹å¯¹åº”çš„åƒç´ ï¼Œå¹¶è€ƒè™‘ä¸€ä¸ª<span class="math inline">\(3\times 3\)</span>é‚»åŸŸ</li>
<li>(1, 1)ç‚¹å¯¹åº”åƒç´ åœ¨è¿­ä»£ç”Ÿæˆè¾“å‡ºæ—¶é¦–å…ˆåº”å°†è‡ªèº«å€¼ä¸ã€ç›¸å¯¹ä½ç½®(0, 0)çš„affinity mapé€šé“ã€‘ä¸Šçš„ã€(1, 1)ä½ç½®å€¼ï¼ˆä»£è¡¨äº†(1, 1)ç‚¹ç›¸å¯¹äºä¸è‡ªèº«ç›¸å¯¹è·ç¦»ä¸º(0, 0)ç‚¹çš„affinityï¼‰ã€‘è¿›è¡Œç›¸ä¹˜ï¼Œä½œä¸ºbaseå€¼</li>
<li>å(1, 1)ç‚¹è®¡ç®—å…¶é¢†åŸŸç‚¹ä¿¡æ¯ï¼š
<ul>
<li>(0, 0)ç‚¹ç›¸å¯¹äºã€ï¼ˆ-1, -1ï¼‰affinity mapé€šé“ä¸Šçš„(1, 1)ä½ç½®ã€‘å€¼ç›¸ä¹˜ï¼Œå åŠ åˆ°baseå€¼ä¸Š</li>
<li>(0, 1)ç‚¹ç›¸å¯¹äºã€ï¼ˆ-1, 0ï¼‰affinity mapé€šé“ä¸Šçš„(1, 1)ä½ç½®ã€‘å€¼ç›¸ä¹˜ï¼Œå åŠ åˆ°baseå€¼ä¸Š..., etc.</li>
</ul></li>
<li>ä»Figure 2ä¸­ä¹Ÿçœ‹å‡ºç›¸åº”çš„æ„æ€ï¼š<span class="math inline">\(A^x\)</span>æ˜¯ä¸åŒæ–¹å‘ï¼ˆxä¸ºæ–¹å‘ï¼Œä¹Ÿå³ç›¸å¯¹ä½ç½®ï¼‰å¯¹åº”çš„affinity mapï¼Œåœ¨ç»è¿‡one-hot convolutionä¹‹åï¼Œç»„æˆä¸€ä¸ªä¹˜æ³•kernelã€‚</li>
</ul>
<p>â€‹ æ˜¾ç„¶æˆ‘ä»¬æ˜¯ä¸å¸Œæœ›ä½¿ç”¨forå¾ªç¯çš„ï¼ˆå¯¹äºCUDAåŠ é€Ÿä¸å‹å¥½ï¼‰ã€‚ä½œè€…çš„æ–¹æ³•å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨one-hot convolutionå®ç°äº†tensorçš„rollæ“ä½œï¼Œå¹¶ä¸”æ­¤rollä¸æ˜¯å¾ªç¯çš„ï¼ˆè®¾0ï¼‰ï¼Œå› ä¸ºæœ‰äº›åƒç´ å°±æ˜¯æ²¡æœ‰æŸä¸ªç‰¹å®šä½ç½®çš„å€¼ï¼ˆæ¯”å¦‚å³ä¸‹è§’ç‚¹æ²¡æœ‰(1, 1)ç›¸å¯¹ä½ç½®ç‚¹ï¼‰ã€‚ç›´æ¥rollå¯èƒ½éœ€è¦å€ŸåŠ©é¢å¤–çš„maskingæ“ä½œï¼Œæ•…ä½œè€…å°±ä½¿ç”¨å›ºå®šçš„one-hotå·ç§¯æ ¸ï¼Œå·ç§¯affinity mapçš„æ¯ä¸€ä¸ªé€šé“ï¼ˆæ¯ä¸ªé€šé“çš„one-hot å·ç§¯æ ¸ä¸ä¸€æ ·ï¼Œå› ä¸ºæ‰€è¡¨ç¤ºçš„ç›¸å¯¹ä½ç½®ä¸ä¸€æ ·ï¼‰ï¼Œå·ç§¯çš„ç»“æœå¯ä»¥ç›´æ¥ç”¨äºã€ä¹˜æ³• + å åŠ ã€‘æ“ä½œã€‚</p>
<h2 id="iv.-cspn-aaai-2020">IV. CSPN++ (AAAI-2020)</h2>
<p><img src="/2022/01/23/Depth-Completion%E8%AE%BA%E6%96%87%E4%B8%89%E7%AF%87/aaai2020.png"></p>
<center>
Figure 4. çœ‹æˆäº†CSDN...
</center>
<p>â€‹ æœ¬è®ºæ–‡å¯ä»¥ç§°ä¸ºæ˜¯ï¼šç»ˆæè‡ªé€‚åº” å·¥ä½œã€‚CSPN++åœ¨ä¸¤æ–¹é¢è¿›è¡Œäº†è‡ªé€‚åº”è€ƒè™‘ï¼š</p>
<ul>
<li>Context-awareï¼šå¯¹äºå›¾åƒå†…å®¹æœ¬èº«çš„å¤„ç†è¿›è¡Œè‡ªé€‚åº”ï¼Œç”¨ä»¥æå‡ç²¾åº¦</li>
<li>Resouce-awareï¼šå¯¹äºè®¡ç®—èµ„æºçš„è‡ªé€‚åº”ï¼Œæ¯”å¦‚è‡ªé€‚åº”é€‰æ‹© <strong><u>å·ç§¯æ ¸å¤§å°ï¼ˆæˆ–propagationåŸŸå¤§å°ï¼‰</u></strong> ä»¥åŠ <strong><u>è¿­ä»£æ¬¡æ•°ï¼ˆper-pixelï¼‰</u></strong></li>
</ul>
<p>â€‹ ä¸¤æ–¹é¢çš„awarenesså­˜åœ¨æƒè¡¡å…³ç³»ï¼šè®¡ç®—èµ„æºå¯Œè¶³æ—¶åœ¨è®¡ç®—ç²¾åº¦ä»¥åŠç»“æœè´¨é‡ä¸Šå¿…ç„¶æ›´å¥½ï¼Œåä¹‹äº¦ç„¶ã€‚å…¶ä¸­ï¼Œä¸ªäººè§‰å¾—Context-awareæ²¡æœ‰ç‰¹åˆ«å¤šå¯ä»¥è¯´çš„ï¼Œä½œè€…ä¹Ÿå°±æ˜¯ä»ä¸¤ä¸ªä¸åŒçš„è§’åº¦è¿›è¡Œä¿¡æ¯ç»¼åˆï¼š</p>
<ul>
<li>æ¯ä¸€ä¸ªåƒç´ ä½¿ç”¨ä¸åŒå¤§å°çš„kernelå¾—åˆ°çš„ç»“æœç»¼åˆ</li>
<li>æ¯ä¸€ä¸ªåƒç´ è¿­ä»£ä¸åŒé˜¶æ®µæ—¶çš„ä¿¡æ¯ç»¼åˆ</li>
</ul>
<p>â€‹ CSPN blockè¿­ä»£å…¬å¼æœ¬èº«æ˜¯ï¼š <span class="math display">\[
\begin{equation}
H^+_x(t+1)=\kappa(x) H_x(0) + \sum_{y\in N(x)}\kappa(y)H_y(t),\text{ where }N(x) \text{ is the neighbor of }x
\end{equation}
\]</span> â€‹ å…¶ä¸­çš„neighborè¡¨ç¤ºå»å¿ƒé‚»åŸŸï¼Œä»¥ä¸Šæ“ä½œè®°ä¸º<span class="math inline">\(H_{CSPN}(x,t)\)</span></p>
<p>â€‹ ç»¼åˆ è¿­ä»£å¹³å‡ ä»¥åŠ æ ¸å¹³å‡ï¼Œæ›´æ–°å…¬å¼åº”è¯¥æ˜¯ï¼ˆæˆ‘ä»¬ä»¤<span class="math inline">\(H_x(t )\)</span>ä¸ºè¿­ä»£ç¬¬tæ¬¡æ—¶ï¼Œåƒç´ ä½ç½®xçš„æ·±åº¦å€¼hidden stateï¼‰ï¼š <span class="math display">\[
\begin{align}
&amp; H^+_x(t+1)=\lambda_x(k, t+1)H_{CSPN}(x,t)+H^+_x(t)\\
&amp; H^+_x(t)=\sum_{i=0}^k\alpha_x(k)H^+_x(t,i), \text{ where }H_x^+(t, i) \text{ also indicates kernel size}
\end{align}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\lambda_x(k, t)\)</span>ï¼ˆè¿­ä»£ç»¼åˆç³»æ•°ï¼‰ä»¥åŠ<span class="math inline">\(\alpha_x(k)\)</span> ï¼ˆkernelç»¼åˆç³»æ•°ï¼‰éƒ½æ˜¯ç½‘ç»œçš„è¾“å‡ºï¼Œæ³¨æ„è¿™äº›ç³»æ•°å‡å¸¦æœ‰ä¸‹æ ‡ï¼Œè¯´æ˜æ˜¯ä¸åƒç´ æœ‰å…³çš„ per-pixel prediction coefficientã€‚</p>
<p>â€‹ æœ¬è®ºæ–‡æœ‰æ„æ€çš„ç‚¹åœ¨äºï¼Œè®ºæ–‡é€šè¿‡Context-aware propagationè¿‡ç¨‹å®šä¹‰çš„å…¬å¼ï¼Œå¯¼å‡ºäº†computational costçš„ç®€å•è¡¨è¾¾å¼ï¼Œcomputational coståœ¨æ­¤å¤„çš„ä½œç”¨ç›¸å½“äºæƒ©ç½šé¡¹ã€‚ç”±äºContext awareçš„è¿‡ç¨‹æ˜¯ï¼šmulti-branch predictionï¼Œæœ€åæ ¹æ®é¢„æµ‹çš„<span class="math inline">\(\alpha\)</span> ä»¥åŠ <span class="math inline">\(\lambda\)</span>ç³»æ•°æ•´åˆå¤šbranchçš„é¢„æµ‹ç»“æœã€‚æ­¤å¤„ï¼Œ<span class="math inline">\(\alpha\)</span>ä»¥åŠ<span class="math inline">\(\lambda\)</span>æ˜¯å…ˆäºCSPN blockå®é™…è¿­ä»£è¿‡ç¨‹ç»™å‡ºçš„ï¼ˆç”±ä¸€ä¸ªä¿®æ”¹çš„ResNet-34ç½‘ç»œç»™å‡ºï¼‰ã€‚åœ¨Resource-awareè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œä½œè€…å°† â€œweighted averageâ€å˜ä¸ºäº†â€œmax poolâ€ï¼šæ ¹æ®é¢„æµ‹ç³»æ•°ï¼Œæ¯ä¸ªåƒç´ ä½ç½®é€‰æ‹©â€œæœ€å¤§â€branchè¿›è¡Œè®¡ç®—ï¼š <span class="math display">\[
\begin{equation}
k_x^*=\mathop{\arg\max \alpha_x(k)}_k,t^*_x=\mathop{\arg \max\lambda(k_x^*,t)}_t
\end{equation}
\]</span> â€‹ è¿™æ ·å¯ä»¥çœå»å¤šè·¯è®¡ç®—çš„è®¡ç®—å¼€é”€ï¼Œä½†æ˜¾ç„¶è¿™æ ·ç‰ºç‰²äº†ç»“æœè´¨é‡ã€‚</p>
<p>â€‹ å¦ä¸€æ–¹é¢ï¼Œä½œè€…åœ¨è®ºæ–‡ä¸­å¯¹computational costè¿›è¡Œäº†å»ºæ¨¡ï¼š <span class="math display">\[
\begin{align}
&amp; E(c_x|\{\alpha_x, \lambda_x\})=\frac  1{hw}\sum_x E(c_x|\alpha_x, \lambda_x)\label{normx}\\
&amp;E(c_x|\alpha_x, \lambda_{x})=\frac 1 {Nk_{\max}}\sum_{k}\sum_t\alpha_x(k)\lambda_x(k,t)k^2t\label{norma}
\end{align}
\]</span> â€‹ <span class="math inline">\(\eqref{normx}\)</span>ç›¸å½“äºæ˜¯æ‰€æœ‰åƒç´ ä½ç½®æ±‚å¹³å‡ï¼ˆæœŸæœ›ï¼‰ï¼Œ<span class="math inline">\(\eqref{norma}\)</span>åˆ™æ˜¯æŸä¸€ä¸ªç¡®å®šçš„åƒç´ ä½ç½®è¿›è¡Œçš„æœŸæœ›è®¡ç®—ï¼šå› ä¸ºä¸€ä¸ªåƒç´ ä½ç½®è¿›è¡Œä¼ æ’­çš„å¤æ‚åº¦æ˜¾ç„¶æ˜¯<span class="math inline">\(O(k_{\max}^2N)\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(k_{\max}\)</span>æ˜¯æœ€å¤§æ ¸å¤§å°ï¼Œ<span class="math inline">\(N\)</span>æ˜¯è¿­ä»£æ¬¡æ•°ï¼Œè€Œå¦‚æœå°†<span class="math inline">\(\alpha\)</span>ä»¥åŠ<span class="math inline">\(\lambda\)</span>åˆ†åˆ«çœ‹ä½œæ ¸å–å¤§å° <span class="math inline">\(k\)</span> ä»¥åŠ è¿­ä»£æ¬¡æ•°ä¸º <span class="math inline">\(t\)</span> æ—¶çš„æ¦‚ç‡ï¼ˆä¸ªäººè®¤ä¸ºè¿™æ˜¯å¯ä»¥çš„ï¼Œåœ¨â€œmax poolâ€ä¸‹é€‰å–çš„å°±æ˜¯æœ€å¤§â€œæ¦‚ç‡â€branchè¿›è¡Œè®¡ç®—ï¼‰ï¼Œcostçš„æœŸæœ›ä¾¿å¯ä»¥ä»¥ä¸Šè¿°ä¸¤ä¸ªå…¬å¼è¿›è¡Œè®¡ç®—ã€‚</p>
<p>â€‹ äº‹å®ä¸Šä½œè€…ä¹Ÿå°†æ­¤æƒ©ç½šé¡¹å‘æœ‰çº¦æŸä¼˜åŒ–ä¸­æ‹“å±•äº†ï¼Œä½†æœ€åçš„å½¢å¼è¿˜æ˜¯æƒ©ç½šé¡¹ï¼ˆå› ä¸ºè¿™ä¸ªä¼˜åŒ–é—®é¢˜non-convexï¼Œæ‹‰æ ¼æœ—æ—¥å¯¹å¶æ²¡å•¥å¤§ç”¨å¤„ï¼‰ã€‚æƒ©ç½šé¡¹çš„åå¤„å°±æ˜¯ï¼Œçº¦æŸæ˜¯è½¯çº¦æŸï¼Œè¶…å‡ºçº¦æŸèŒƒå›´æ˜¯å¯èƒ½çš„ã€‚</p>
<p>â€‹ ä¸è¿‡ç»¼ä¸Šæ‰€è¿°ï¼Œä¸ªäººè§‰å¾—CSPN++è¿™ç¯‡è®ºæ–‡ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼ˆå°¤å…¶æ˜¯Resource-awareéƒ¨åˆ†ï¼‰ï¼Œæœ‰ä¸€å®šå¯å‘æ€§ï¼Œç›¸æ¯”ICRA 2020çš„PENetï¼Œä¸ªäººè§‰å¾—è¿™ç¯‡æ–‡ç« å†™çš„æ›´ä¸é‚£ä¹ˆé­”æ³•ã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>æ·±åº¦è¡¥å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Distance Metrics on Point Clouds</title>
    <url>/2021/11/14/Distance-Metrics-on-Point-Clouds/</url>
    <content><![CDATA[<h1 id="distance-metrics">Distance Metrics</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ è¿‘æœŸçš„ç ”ç©¶æœ‰æ¢ç©¶ä¸€ä¸ªå¥½çš„å°ºåº¦çš„éœ€æ±‚ï¼šåˆ¤æ–­é…å‡†æ˜¯å¦å®Œæˆã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è„‘å­é‡Œæƒ³çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ï¼šåˆ¤å®šä¸¤ä¸ªç‚¹äº‘åœ¨æŸä¸ªå°ºåº¦ä¸Šæ˜¯å¦ç›¸è¿‘ã€‚å¸¦ç€è¿™ä¸ªç›®çš„ï¼Œæˆ‘ç»“åˆä¹‹å‰çœ‹è¿‡çš„æ–‡çŒ®ï¼Œåœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆä¸­è¡¥å……äº†ä¸€äº›æ–°çš„å†…å®¹ã€‚æœ¬æ–‡ä¸»è¦åŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªå†…å®¹ï¼š</p>
<ul>
<li>ä¸‰ç§ä¼ ç»Ÿç‚¹äº‘å°ºåº¦çš„ç®€ä»‹ï¼ˆHausdorffï¼ŒChamferï¼ŒEarth Mover'sï¼‰</li>
<li>ä¸€ç§åŸºäºæ·±åº¦å­¦ä¹ çš„è·ç¦»å°ºåº¦ï¼ˆECCV 2020ï¼‰<a href="https://link.springer.com/content/pdf/10.1007/978-3-030-58621-8_32.pdf">DPDist: Comparing Point Clouds Using Deep Point Cloud Distance</a></li>
</ul>
<blockquote>
<p>ä½ç»´çš„æœ€é‚»è¿‘ç‚¹å¹¶ä¸æ„å‘³ç€ç»“æœèƒ½å¾ˆå¥½åœ°é€‚ç”¨äºä»»åŠ¡ï¼Œé«˜ç»´çš„æœ€é‚»è¿‘æ‰æ˜¯æœ€ç»ˆçš„è¿½æ±‚ã€‚å°±åƒä½ å’Œä½ å¼‚åœ°çš„ï¼ˆç”·ï¼‰å¥³æœ‹å‹ï¼Œä½ ä»¬åœ°ç†ä¸Šä¸æ˜¯æœ€é‚»è¿‘ï¼Œä½†æ˜¯åœ¨æŸä¸ªé«˜ç»´ç©ºé—´ä¸­ï¼Œç¡®å®æ˜¯æœ€é‚»è¿‘çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å˜æ¢å°ºåº¦ä¸ç»´åº¦çœ‹é—®é¢˜ã€‚--- å“²â™‚å­¦å®¶ åƒè¶Š Â· è®© Â· å¾· Â· å buff Â· ä½•</p>
</blockquote>
<span id="more"></span>
<hr>
<h2 id="ii.-ç‚¹äº‘è·ç¦»å°ºåº¦">II. ç‚¹äº‘è·ç¦»å°ºåº¦</h2>
<h3 id="å¼•">2.1 å¼•</h3>
<p>â€‹ åœ¨æŸäº›ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°ä¸¤ä¸ªç‚¹äº‘ä¹‹é—´çš„ä¸€ç§æ¥è¿‘ç¨‹åº¦çš„æè¿°ã€‚æ¯”å¦‚åœ¨é…å‡†ä»»åŠ¡ä¸­ï¼Œä¸¤ä¸ªç‚¹äº‘ä¸­ç›¸ä¼¼çš„ç‚¹æˆ–ç‰¹å¾è¶Šæ¥è¿‘ï¼Œé‚£ä¹ˆæ„å‘³ç€é…å‡†ç»“æœè¶Šå¥½ã€‚ä½†ç”±äºç‚¹äº‘è¡¨å¾ä¸åŒäºGridã€ä½“ç´ æˆ–è€…æ·±åº¦å›¾ç­‰è¡¨å¾æ–¹å¼ï¼Œç‚¹äº‘æ˜¯æ— ç»“æ„ï¼Œæ— é¡ºåºçš„ã€‚ä¸€äº›ç®€å•çš„æ¯”è¾ƒæ–¹å¼ä¸å†é€‚ç”¨ï¼Œæ¯”å¦‚è¯´ï¼šæˆ‘æœ‰ä¸¤ä¸ªä½“ç´ åŒ–çš„ç‚¹äº‘ï¼Œè¿™ä¸¤ä¸ªç‚¹äº‘çš„æ¥è¿‘æˆ‘å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä½“ç´ ç›¸å‡ï¼ˆä½“ç´ å†…éƒ¨å«æœ‰å ç”¨æ¦‚ç‡ï¼‰ï¼Œæœ€åå¯¹è¿™ä¸ªç»“æœå¼ é‡æ±‚èŒƒæ•°å³å¯ã€‚è¿™å°±æ˜¯è®ºæ–‡ä¸­è¯´çš„ï¼š</p>
<blockquote>
<p>They are not a function on a grid, point clouds cannot be compared using a common metric (such as Euclidean metric)</p>
</blockquote>
<p>â€‹ ä¸€èˆ¬æ¥è¯´ç‚¹äº‘çš„è·ç¦»å°ºåº¦æœ‰ä¸‰ä¸ªéå¸¸è‘—åçš„è·ç¦»ï¼šHausdorffè·ç¦»ï¼ŒChamferè·ç¦»ï¼ŒEarth Mover'sè·ç¦»ï¼ˆEMDï¼Œæˆ–è€…å«Wassersteinè·ç¦»ï¼Œåˆæˆ–è€…å«Kantorovich-Rubinsteinè·ç¦»ï¼‰ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/haus.png"></th>
<th style="text-align: center;"><img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/cd.png"></th>
<th style="text-align: center;"><img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/haus.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Hausdorff</td>
<td style="text-align: center;">Chamfer</td>
<td style="text-align: center;">Earth Mover's</td>
</tr>
</tbody>
</table>
<center>
Figure 1. ä¸‰ç§å¸¸ç”¨çš„Distance metricså›¾ç¤º[1]
</center>
<h3 id="hausdorff">2.2 Hausdorff</h3>
<p>â€‹ Hausdorffè·ç¦»æ˜¯ä¸€ç§ï¼šworst-caseçš„è·ç¦»æè¿°ï¼Œå®ƒæè¿°äº†ä¸¤ä¸ªç‚¹äº‘ä¹‹é—´çš„ä¸€ä¸ªè·ç¦»ä¸Šç•Œã€‚é€šä¿—åœ°è¯´ï¼ŒHausdorffè·ç¦»ï¼ˆå•è¾¹ï¼‰æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‚¹é›†Aï¼ŒBï¼š</p>
<ul>
<li>Aä¸­ä»»æ„ä¸€ä¸ªç‚¹pï¼Œéƒ½èƒ½åœ¨Bä¸­æ‰¾åˆ°å…¶æœ€é‚»è¿‘ç‚¹qã€‚é‚£ä¹ˆAä¸­æ¯ä¸ªç‚¹æœ‰ä¸€ä¸ªæœ€å°è·ç¦»ï¼š<span class="math inline">\(d_i=\mathop{\min}_{q_j}\Vert p_i-q_j\Vert\)</span></li>
<li>å–Aä¸­æ¯ä¸ªç‚¹æœ€å°è·ç¦»çš„æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯æœ€é‚»è¿‘è·ç¦»çš„æœ€å¤§å€¼ï¼‰</li>
</ul>
<p>â€‹ å®Œæ•´çš„Hausdorffåº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>æœ€ååè¿‡æ¥ï¼ŒBä¸­ä¹Ÿæœ‰åŒæ ·çš„ä¸€ä¸ªæœ€é‚»è¿‘è·ç¦»çš„æœ€å¤§å€¼ã€‚æ±‚A-&gt;B,B-&gt;Aè¿™ä¸¤ä¸ªè·ç¦»ä¸­çš„å¤§è€…ã€‚æ­£å¼å®šä¹‰åº”è¯¥æ˜¯ï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}\label{haus}
d_{haus}=\max \left\{ D(A,B),D(B,A)\right\},\text{ where }D(X,Y)=\mathop{\max}_{p_i} \mathop{\min}_{q_j}\Vert p_i - q_j\Vert,p_i\in X,q_j\in Y
\end{equation}
\]</span></p>
<p>â€‹ è¿™ä¸ªå…¬å¼çš„é—®é¢˜è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ­¤è·ç¦»å¾ˆå®¹æ˜“å—åˆ°å¤–ç‚¹ï¼ˆoutliersï¼‰çš„å½±å“ã€‚åœ¨æ–‡çŒ®ä¸­å·²ç»æåˆ°äº†æ­¤è·ç¦»çš„ä¿®æ”¹ç‰ˆï¼Œç®€å•æ¥è¯´å°±æ˜¯æˆªæ–­Hausdorffè·ç¦»ï¼Œè¶…è¿‡ä¸€å®šé˜ˆå€¼çš„<span class="math inline">\(\mathop{\min}_{q_j}\Vert p_i - q_j\Vert\)</span>ä¸ä¼šè¢«è®°å½•ã€‚ä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œè¿™ä¸ªè·ç¦»éƒ½æ˜¯ä¸€ä¸ªæœ€åè·ç¦»çš„è¡¡é‡ã€‚</p>
<h3 id="chamfer">2.3 Chamfer</h3>
<p>â€‹ Chamferè·ç¦»æ˜¯ä¸€ç§å¹³å‡æ„ä¹‰ä¸Šçš„è·ç¦»ï¼Œå…¶æ„ä¹‰å¾ˆå¥½ç†è§£ï¼šå¹³å‡çš„æœ€è¿‘ç‚¹è·ç¦»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{chamfer}
d_{chamfer}=\text{normalize}(\sum_{q_j\in B}\mathop{\min}_{p_i}\Vert p_i-q_j\Vert + \sum_{p_i\in A}\mathop{\min}_{q_j}\Vert p_i-q_j\Vert)
\end{equation}
\]</span> â€‹ è¿™ä¸ªè·ç¦»å€’æ˜¯æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¹³å‡æ„ä¹‰ä¸Šçš„è·ç¦»ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯å¯¹åŸºäºç‰¹å¾çš„æ–¹æ³•å¹¶ä¸å‹å¥½ï¼ˆé«˜ç»´æœ€é‚»è¿‘ç‚¹è®¡ç®—å¾ˆæ¶å¿ƒï¼‰ã€‚å¾ˆå¸¸ç”¨ï¼Œå› ä¸ºChamfer distanceç›¸å¯¹äºEMDå­˜åœ¨ä¸€ä¸ªä¼˜ç‚¹ï¼šå®ƒå¹¶ä¸è¦æ±‚å»ºç«‹åŒå°„ï¼Œä¹Ÿå°±ä¸è¦æ±‚ä¸¤ä¸ªç‚¹é›†çš„å¤§å°ä¸€è‡´ï¼Œå¯ä»¥æœ‰ä¸€å¯¹å¤šè”ç³»ã€‚åœ¨éª·é«…èåˆè€…è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘åˆ†æäº†ä¸€ä¸‹ä½œè€…æå‡ºçš„Composite Chamfer Lossï¼Œä½œè€…é€šè¿‡ä¿®æ”¹åå‘è·ç¦»ï¼Œå»ºç«‹äº†ä¸€ä¸ªéå¯¹ç§°çš„ï¼Œé’ˆå¯¹ä¸åŒç¨ å¯†ç¨‹åº¦ç‚¹äº‘çš„Chamfer lossã€‚</p>
<h3 id="earth-movers">2.4 Earth Movers'</h3>
<p>â€‹ è¿™æ˜¯æœ€ç†æƒ³çš„è·ç¦»å°ºåº¦ï¼Œå…¶åŸºæœ¬å®šä¹‰ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{emd}
d_{EMD}(A, B)=\mathop{\min}_{\phi: A\rightarrow B}\sum_{p_i\in A}\Vert p_i - \phi(p_i)\Vert
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\phi\)</span>æ˜¯ç‚¹é›†Aåˆ°Bçš„ä¸€ä¸ªåŒå°„ã€‚ç”±äºæ˜¯åŒå°„ï¼Œä¸Šå¼æ˜¯ä¸€ä¸ªåŒå‘å¯¹ç§°çš„è·ç¦»ã€‚åœ¨2.3ä¸­å·²ç»è¯´äº†ï¼ŒåŒå°„å°±è¦æ±‚é›†åˆå¤§å°ä¸€è‡´ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™å¹¶ä¸å®¹æ˜“æ»¡è¶³ï¼Œç‰¹åˆ«æ˜¯åœ¨SLAMèƒŒæ™¯ä¸‹ï¼Œéƒ¨åˆ†è§‚æµ‹ï¼ˆè§3.3ï¼‰å¯¼è‡´ä¸€èˆ¬ç”¨ä¸äº†è¿™ä¸ªè·ç¦»ã€‚ä½†åœ¨ä¸€èˆ¬æ„ä¹‰ä¸‹ï¼Œè¿™ä¸ªè·ç¦»æ˜¯æœ€ä¼˜çš„ï¼š</p>
<p><img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/emd-cd.png"></p>
<center>
Figure 2. EMDä¸CDçš„æ¯”è¾ƒï¼Œè¿™å¼ å›¾çš„ç»“æœæ˜¯å¾ˆæ˜¾ç„¶çš„[1]
</center>
<p>â€‹ æ¥ä¸‹æ¥åˆ°äº†ç§‘æ™®æ€è€ƒæ—¶é—´ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªè·ç¦»å«åšEarth Mover'sï¼ˆæˆ‘ç§°ä¹‹ä¸ºï¼Œæ¬ç –è€…è·ç¦»ï¼‰ï¼Ÿ ç»´åŸºç™¾ç§‘ä¸Šè¿™ä¹ˆè¯´</p>
<blockquote>
<p>In statistics, the earth mover's distance (EMD) is a measure of the distance between two probability distributions over a region D. Informally, if the distributions are interpreted as two different ways of piling up a certain amount of earth (dirt) over the region D, the EMD is the minimum cost of turning one pile into the other; where the cost is assumed to be the amount of dirt moved times the distance by which it is moved.[2]</p>
</blockquote>
<p>â€‹ å—¯ï¼Œintuitivelyï¼Œç¡®å®æ˜¯è¿™æ ·çš„ã€‚æ‰€ä»¥ç§°è¿™ä¸ªè·ç¦»ä¸ºæ¬ç –è€…è·ç¦»ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<hr>
<h2 id="iii.-dpdist">III. DPDist</h2>
<h3 id="åŸºæœ¬æ€æƒ³">3.1 åŸºæœ¬æ€æƒ³</h3>
<p>â€‹ Deep Point Cloud Distanceï¼Œåˆ™æ˜¯ä¸€ç§æ–°çš„è·ç¦»å°ºåº¦ï¼Œç›¸å½“äºæ˜¯ä¸€ç§åŸºäºæ·±åº¦å­¦ä¹ è¾“å‡ºçš„è¯¯å·®å‡½æ•°å®šä¹‰ï¼ˆæœ¬èº«DPDistä¹Ÿå°±å¯ä»¥å½“åšè¯¯å·®å‡½æ•°ï¼‰ã€‚å…¶æœ€ä¸»è¦çš„æ€æƒ³å°±æ˜¯ï¼š</p>
<div class="note primary"><p>æˆ‘ä»¬ä¸åº”è¯¥ç›´æ¥å»æ¯”è¾ƒä¸¤ä¸ªç‚¹äº‘ï¼Œè¿™æ˜¯éå¸¸ä¸ä¼˜é›…çš„ã€‚ç‚¹äº‘çš„æ¯”è¾ƒï¼Œç‚¹äº‘ä¹‹é—´çš„è·ç¦»ï¼Œè¯´ç™½äº†åº”å½“æ˜¯ï¼šå…¶ä¸­ä¸€ä¸ªç‚¹äº‘çš„æ¯ä¸€ä¸ªç‚¹ï¼Œåˆ°å¦ä¸€ä¸ªç”Ÿæˆç‚¹äº‘<strong><u>åŸæœ¬çš„çœŸå®ä¸–ç•Œéšœç¢ç‰©è¡¨é¢</u></strong>çš„è·ç¦»ã€‚ä¸åº”å½“æ˜¯ç›´æ¥çš„ï¼šç‚¹-ç‚¹è·ç¦»ï¼Œåº”å½“æ˜¯ï¼šç‚¹-é¢è·ç¦»ã€‚</p>
</div>
<p>â€‹ è¿™ä¸ªæƒ³æ³•ç¡®å®æ˜¯è‡ªç„¶çš„ï¼Œç‚¹äº‘è¡¨å¾å…·æœ‰ç¨€ç–æ€§ï¼Œé™¤éä¸¤ä¸ªç‚¹äº‘åœ¨ç‰©ç†ä¸–ç•Œçš„é‡‡æ ·ç‚¹å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ç‚¹-ç‚¹è·ç¦»å†å¦‚ä½•å¥½éƒ½åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼ç½¢äº†ã€‚</p>
<center>
<img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/dpdist.png">
</center>
<center>
Figure 3. è®ºæ–‡ä¸­æœ‰å…³DPDistä¸CDï¼ˆChamfer distanceï¼‰çš„æ¯”è¾ƒ
</center>
<p>â€‹ ä½†æ–°çš„é—®é¢˜åŒæ—¶ä¼šå‡ºç°ï¼šçœŸå®ä¸–ç•Œçš„è¡¨é¢ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è·å¾—çš„ï¼Œåªèƒ½ä»ç‚¹äº‘ä¸­ä¼°è®¡å‡ºæ¥ã€‚è¡¨é¢ä¼°è®¡å¯ä»¥æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å±€éƒ¨çš„ã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œå…¨å±€çš„éå¸¸éš¾åšï¼šæˆ‘ä»¬è¦ä»ä¸€ä¸ª2Dç‚¹äº‘ä¸­ï¼Œä¼°è®¡ä¸€æ•´ä¸ªè¿ç»­å‡½æ•°ç”¨æ¥è¡¨å¾ç‚¹äº‘çš„é‡‡æ ·è¡¨é¢ï¼Œè¿™å¯èƒ½è¿˜ç¨å¾®å®¹æ˜“ä¸€äº›ï¼Œä½†æ˜¯3Dï¼Œemmmï¼Œæ–‡ä¸­è¯´æŸä¸ªç½‘ç»œæƒ³åšè¿™ä¸ªäº‹ï¼Œç”¨äº†äº¿ç‚¹ç‚¹å‚æ•°ï¼Œä¹Ÿæ²¡åšå¥½ã€‚</p>
<p>â€‹ å±€éƒ¨è¡¨é¢ä¼°è®¡é¦–å…ˆç®€å•ï¼Œå‚æ•°é‡å¯ä»¥å°ï¼Œå¹¶ä¸”ï¼Œå±€éƒ¨è¿‘ä¼¼åº¦èƒ½æ›´é«˜ï¼ˆå°±æ¯”å¦‚ï¼Œå±€éƒ¨çº¿æ€§åŒ–ï¼Œå±€éƒ¨èŒƒå›´è¶Šå°ï¼Œè¿‘ä¼¼åº¦å¯ä»¥è¶Šé«˜ï¼‰ã€‚é‚£è¿™å°±äº§ç”Ÿäº†ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æˆ‘æ€ä¹ˆèƒ½ç¡®å®šï¼Œç‚¹äº‘Aä¸Šçš„ç»™å®šç‚¹pï¼Œåº”è¯¥ä½¿ç”¨ç‚¹äº‘Bçš„å“ªä¸€å—è®¡ç®—å±€éƒ¨è¡¨é¢æ¥ä¼°è®¡è·ç¦»ï¼Ÿ</li>
<li>å±€éƒ¨è¡¨é¢å¦‚ä½•ä¼°è®¡ï¼Œè®¡ç®—å¦‚ä½•è¿›è¡Œï¼Ÿ</li>
</ul>
<h3 id="ä½œè€…çš„é­”æ³•è§£å†³ä¹‹è·¯">3.2 ä½œè€…çš„é­”æ³•è§£å†³ä¹‹è·¯</h3>
<p>â€‹ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç‚¹äº‘çš„å…¨å±€ç‰¹å¾ã€‚è¯´æ˜¯å…¨å±€ï¼Œä¸å¦‚è¯´æ˜¯å¾ˆå¤šå±€éƒ¨ç‰¹å¾çš„ç»„åˆï¼Œåˆ†å—å„¿çš„å±€éƒ¨ç‰¹å¾ï¼Œåˆæˆä¸€ä¸ªå…¨å±€ç‰¹å¾ã€‚ä½œè€…ä½¿ç”¨3DmFVï¼ˆæ²¡ç»†çœ‹è¿‡è¿™ç¯‡è®ºæ–‡ï¼‰ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯ï¼š</p>
<p>â€‹ é¦–å…ˆå°†ç©ºé—´åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„Gridï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªç²—ç²’åº¦çš„åˆ’åˆ†ï¼‰ï¼Œå‡è®¾ç©ºé—´ä¸­å­˜åœ¨<span class="math inline">\(K\times K\times K\)</span>ä¸ªgridã€‚ç”±äºåŸç‚¹äº‘å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªNæˆåˆ†çš„æ··åˆé«˜æ–¯æ¨¡å‹ï¼ˆGMMï¼‰ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå¤šé«˜æ–¯åˆ†å¸ƒåŠ æƒçš„åˆ†å¸ƒï¼‰ï¼Œ åœ¨ä¸åŒçš„Gridä¸­ï¼Œéƒ½å¯ä»¥æ±‚åˆ°ä¸€ä¸ªFisher Vectorï¼ˆä¹Ÿå°±æ˜¯ç»¼åˆäº†Gridå±€éƒ¨ä¿¡æ¯çš„ä¸€ä¸ªGMMæ¢¯åº¦ï¼‰ã€‚ç”±äºGridåˆ’åˆ†æ˜¯å›ºå®šçš„ï¼Œå›ºå®šå°±æ„å‘³ç€è®­ç»ƒæ–¹ä¾¿ã€‚</p>
<div class="note danger no-icon"><p><span class="math inline">\(K\times K\times K\)</span>æ¯ä¸ªæ ¼æå–GMMçš„ç‰¹å¾ï¼Œå¾—åˆ°ä¸€ä¸ªå››ç»´å¼ é‡ï¼š<span class="math inline">\(K\times K\times K\times F\)</span>ã€‚è¿™æ˜¯æ•´ä¸ªç‚¹äº‘çš„å…¨å±€ç‰¹å¾ï¼Œå®ƒæ˜¯ä¸€ç§å›ºå®šçš„ï¼Œæœ‰ç»“æ„çš„ç‰¹å¾ã€‚å‡è®¾è¿™ä¸ªç‰¹å¾æ˜¯ç‚¹äº‘Açš„ï¼Œæˆ‘ä»¬å°†ä¹‹è®°ä¸ºï¼š<span class="math inline">\(L^{S_A}\)</span></p>
</div>
<div class="note warning no-icon"><p>å¯¹äºæ¯ä¸ªç‚¹äº‘Bä¸­çš„queryç‚¹ï¼ˆè¦æ±‚ç‚¹-é¢è·ç¦»çš„ç‚¹ï¼‰ï¼Œæ€»æ˜¯åœ¨Aä¸­å¯»æ‰¾é‡Œqueryç‚¹(<span class="math inline">\(b_i\)</span>)æœ€è¿‘çš„gridï¼Œåœ¨æœ€è¿‘Gridå‘¨å›´æ‰©æ•£næ­¥ï¼Œå½¢æˆä¸€ä¸ª<span class="math inline">\(k\times k \times k\)</span>å¤§å°çš„å­gridï¼Œkå½“ç„¶æ˜¯å¥‡æ•°ï¼Œå› ä¸ºæœ€è¿‘ç‚¹æ˜¯ä¸­å¿ƒï¼Œå‘å¤–æ‰©æ•£næ­¥åˆ™<span class="math inline">\(k=2n+1\)</span>ã€‚</p>
</div>
<div class="note info no-icon"><p>è¿™<span class="math inline">\(k\times k \times k\times F\)</span>å¤§å°çš„å¼ é‡ï¼ˆsubgridçš„ç‰¹å¾ï¼‰å°†è¢«concatåˆ°<span class="math inline">\(b_i\)</span>çš„ç‚¹äº‘åæ ‡ä¸Šï¼ˆå¥½é­”æ³•å•Šï¼Œåˆå¼€å§‹concatäº†ï¼‰ã€‚æœ€åè¿‡ä¸€ä¸ªä¸‰å±‚å…¨è¿æ¥å±‚ï¼Œå¾—åˆ°è·ç¦»ã€‚</p>
</div>
<div class="note success no-icon"><p>ç”±äºå­˜åœ¨å¯¹ç§°æ€§ï¼ŒA-&gt;Bä»¥åŠB-&gt;Açš„DPDistéƒ½éœ€è¦è®¡ç®—ï¼Œæœ€åæŒ‰ç…§ç‚¹æ•°å¹³å‡ï¼Œå¾—åˆ°æœ€ç»ˆçš„è·ç¦»ã€‚</p>
</div>
<p><img src="/2021/11/14/Distance-Metrics-on-Point-Clouds/struct.png"></p>
<center>
Figure 4. DPDistçš„ç½‘ç»œç»“æ„
</center>
<h3 id="ä¸ªäººè§‰å¾—å­˜åœ¨çš„é—®é¢˜">3.3 ä¸ªäººè§‰å¾—å­˜åœ¨çš„é—®é¢˜</h3>
<p>ï¼ˆ1ï¼‰éƒ¨åˆ†è§‚æµ‹ã€‚æ•´ä¸ªç½‘ç»œè¿˜æ˜¯é™å®šäº†ï¼šæ¯ä¸ªç‚¹éƒ½èƒ½æœ‰ä¸ªå±äºè‡ªå·±çš„è¡¨é¢ã€‚è¿™åœ¨ä¸€äº›objectç‚¹äº‘æ•°æ®é›†ä¸Šæ˜¯æˆç«‹çš„ï¼Œä½†æ˜¯åœ¨SLAMç³»ç»Ÿä¸­å¾ˆéš¾æˆç«‹ã€‚ç”±äºä½¿ç”¨æœ€è¿‘gridï¼Œé‚£äº›ä¸¤ä¸ªè§‚æµ‹ç‚¹è§‚æµ‹çš„å¯¹ç§°å·®é›†ä¸­çš„ç‚¹ï¼Œä¼šè¢«é”™è¯¯åœ°assignåˆ°ä¸€ä¸ªä¸å±äºè‡ªå·±çš„è¡¨é¢ä¸Šï¼Œè¿™åœ¨è®¡ç®—ä¸­ä¼šå¯¼è‡´é—®é¢˜ï¼ˆä¸å‡†ï¼‰ã€‚æ‰€ä»¥è®©æˆ‘æ„Ÿåˆ°è¿·æƒ‘çš„æ˜¯ï¼Œä½œè€…å°†DPDistç”¨åœ¨äº†PCRNetä¸­ï¼ˆPCRNetæ˜¯ä¸€ä¸ªã€‚ã€‚ã€‚emmmå¾ˆé­”æ³•çš„ç½‘ç»œï¼‰ï¼Œä½œä¸ºç‚¹äº‘é…å‡†çš„è·ç¦»å°ºåº¦ï¼Œæ›¿æ¢äº†åŸæ¥çš„EMDã€‚çœ‹äº†å®ƒçš„å®éªŒå°±çŸ¥é“ï¼šäººå®¶æè¿™æä¸€å¼ æ¤…å­çš„é…å‡†ï¼š</p>
<blockquote>
<p>Using the â€Chairâ€ category and following [20], we randomly generate 5070 different transformations for training and other 5070 transformations for testing.</p>
</blockquote>
<p>â€‹ è¿™ç§ç‰©ä½“çº§æ•°æ®é›†å½“ç„¶ä¸ä¼šé‡åˆ°éƒ¨åˆ†è§‚æµ‹é—®é¢˜ã€‚äº‹å®ä¸Šï¼Œéƒ¨åˆ†è§‚æµ‹é—®é¢˜ä¹Ÿé™åˆ¶äº†EMDï¼ˆæ¯•ç«ŸEMDå¸Œæœ›èƒ½å»ºç«‹ä¸€ä¸ªç‚¹é›†ä¹‹é—´çš„åŒå°„ï¼‰ï¼Œéƒ¨åˆ†è§‚æµ‹å¯¼è‡´åŒå°„æ— æ³•å»ºç«‹ã€‚å¹¶ä¸”åœ¨SLAMé—®é¢˜ä¸‹ï¼Œå¯¹åŒä¸€ä¸ªç‰©ä½“è¿›è¡Œä¸åŒåˆ†è¾¨ç‡ä¸‹çš„è§‚æµ‹ï¼Œä¹Ÿç›´æ¥é™åˆ¶äº†EMDçš„ä½¿ç”¨ã€‚</p>
<p>ï¼ˆ2ï¼‰3DmFVï¼Ÿè™½ç„¶ï¼Œè®ºæ–‡ä¸­è¯´3DmFVç‰¹å¾æè¿°æ¯”PointNetæè¿°æ›´å¥½ï¼Œä½†æ˜¯3DmFVå´å¼•å…¥äº†â€œä½“ç´ åŒ–â€è¿™ç§ä¸œè¥¿ï¼ˆè™½ç„¶å¯ä»¥æ˜¯ä¸€ä¸ªå¾ˆç²—ç²’åº¦çš„ï¼‰ã€‚ä½†è¿™æ˜¯å¦ä¼šå¸¦æ¥accuracy-memory tradeoffï¼Ÿé«˜æ–¯è¡¨å¾ä¸æ··åˆé«˜æ–¯æ¨¡å‹çš„æè¿°èƒ½åŠ›ä»¥åŠæ˜¯å¦æœ‰æ­£ç¡®çš„ç‰©ç†å«ä¹‰ä¹Ÿæ˜¯æ²¡æœ‰è¯´æ¸…æ¥šçš„ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="http://3ddl.cs.princeton.edu/2016/slides/su.pdf">Hao Su (Stanford University): 3D Deep Learning on Geometric Forms, pdf</a></p>
<p>[2] <a href="https://en.wikipedia.org/wiki/Earth_mover%27s_distance">Wikipedia: Earth Mover's Distance</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>PointCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Dynamic Routing Between Capsules å¤ç°</title>
    <url>/2021/07/18/Dynamic-Routing-Between-Capsules-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="capsules-network">Capsules Network</h1>
<hr>
<p>â€‹ ä¸Šä¸€æ¬¡çœ‹è¿™ç¯‡è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1710.09829"><em>Dynamic Routing Between Capsules</em></a> çš„æ—¶å€™ï¼ŒPytorchæŠ€æœ¯è¿˜å¾ˆèœï¼Œä¸æ˜¯ç‰¹åˆ«ç†Ÿç»ƒï¼Œè¢«çŸ©é˜µè®¡ç®—çš„ç»´æ•°é—®é¢˜æå‚»äº†ï¼Œå†™å¾—å¾ˆç—›è‹¦ï¼Œlossæ²¡å†™å®Œå°±æ”¾å¼ƒäº†ã€‚è¿™æ¬¡åœ¨é‡æ–°è¯»å®Œè®ºæ–‡ä¹‹åï¼Œé‡æ–°è¯•ç€å¤ç°äº†ä¸€æ³¢ï¼Œæœ€åå·®ç‚¹è´¥åœ¨ä¸€ä¸ªsoftmaxçš„æ‰§è¡Œç»´åº¦ä¸Šï¼ˆå¯ä»¥è¯´å¾ˆå¥‡å¼‚äº†ï¼‰ã€‚ç¬¬ä¸€ç‰ˆcaps netç½‘ç»œç»“æ„éå¸¸ç®€å•ï¼Œå¯¹åº”çš„evaluation / experimentsä¹Ÿå¾ˆç®€å•ã€‚å®ç°è§<a href="https://github.com/Enigmatisms/CapsNet">[GithubğŸ”—Enigmatisms/CapsNet]</a></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/07/18/Dynamic-Routing-Between-Capsules-%E5%A4%8D%E7%8E%B0/G_1101.jpg" alt="G_1101" style="zoom:150%;"></th>
<th style="text-align: center;"><img src="/2021/07/18/Dynamic-Routing-Between-Capsules-%E5%A4%8D%E7%8E%B0/G_1151.jpg" alt="G_1151" style="zoom:150%;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">æ ¹æ®digital capsuleé‡å»ºï¼ˆMNIST 7 epochsï¼‰</td>
<td style="text-align: center;">æ ¹æ®digital capsuleé‡å»ºï¼ˆMNIST 7 epochsï¼‰</td>
</tr>
</tbody>
</table>
<span id="more"></span>
<hr>
<p>â€‹ ç­‰å¾…å¡«å‘</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>Enigma&#39;s First Blog</title>
    <url>/2021/01/29/Enigma&#39;s-First-Blog/</url>
    <content><![CDATA[<p>â€‹ This post is for testing all the configurations and settings are good to go.</p>
<p>â€‹ I decided to start my own blog, for keeping track of the knowledge and skills I have learned. This blog site may well be known to others one day, and there is nothing to lose for me if otherwise. (Self pleasuring, I like to see things organized.)</p>
<ul>
<li><p>A lot of markdown notes of mine are poor-organized for the lack of a good platform in which those notes can be published.</p></li>
<li><p>A blogging website might motivate me to interpret the essence of knowledge learned in my own language, moving from 'self teaching' to teaching others (Deeper understanding is established on the ability to teach others).</p></li>
<li><p>"Open source in Knowledge" is another reason, for there were many times at which I can read blogs of others when I need help. Thereby, publishing what you know might, in turn, help others.</p></li>
<li><p>Unfortunately, I found my words messy, ambiguous and sometimes unorganized, making practices demanded increasingly.</p></li>
<li><p>3-2 term in XJTU, I have a computer network related course incoming. I think I can learn something from maintaining my own blog pages.</p></li>
</ul>
<p>â€‹ This blog might be written in both English and Chinese, which depends on the depth of contents. The page is also deployed to <code>enigmatisms.github.io</code>.</p>
<center>
<i>Amat Victoria Curam.</i>
</center>
]]></content>
      <categories>
        <category>life</category>
      </categories>
      <tags>
        <tag>English</tag>
        <tag>personal</tag>
        <tag>life</tag>
      </tags>
  </entry>
  <entry>
    <title>GANåŸç†ä¸å®ç°</title>
    <url>/2021/02/02/GAN%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="gan-ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ">GAN ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ</h1>
<hr>
<h2 id="ç¼–ç å™¨åŸç†">ç¼–ç å™¨åŸç†</h2>
<h3 id="è‡ªåŠ¨ç¼–ç å™¨">è‡ªåŠ¨ç¼–ç å™¨</h3>
<p>â€‹ è‡ªåŠ¨ç¼–ç å™¨ï¼Œç®€å•åœ°è¯´å°±æ˜¯ä»¥ä¸‹ç»“æ„ï¼š</p>
<p><img src="/2021/02/02/GAN%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/GAN_1.JPG"></p>
<p>â€‹ ä»åŸå§‹è¾“å…¥ï¼Œå¯¹å…¶è¿›è¡Œç¼–ç ï¼ˆç¼–ç è¿‡ç¨‹å¯ä»¥ä½¿ç”¨æ„ŸçŸ¥æœºï¼ˆå‰é¦ˆï¼Œæ— BPæ“ä½œï¼‰æˆ–è€…ç¥ç»ç½‘ç»œï¼ˆç°åœ¨çš„æ¶æ„ä¸€èˆ¬æ˜¯BPå¼çš„ä¼˜åŒ–ï¼‰ï¼‰ï¼Œç”Ÿæˆ <strong><u>å‹ç¼©åçš„ç¼–ç æ•°æ®</u></strong>ã€‚å†æƒ³åŠæ³•ä»ç¼–ç ä¸­ï¼ˆå¿…ç„¶å­˜åœ¨ä¿¡æ¯æŸå¤±ï¼‰æ¢å¤åŸæ¥çš„å›¾ç‰‡ã€‚ä½†æ˜¯ä¸€èˆ¬è€Œè¨€ï¼Œè‡ªåŠ¨ç¼–ç å™¨ï¼ˆAEï¼‰éƒ½æ˜¯ç¡®å®šè¾“å…¥è¾“å‡ºçš„ï¼Œæ¯ä¸€ç§ç¼–ç ä¼šç”±è®­ç»ƒå¾—åˆ°å”¯ä¸€çš„è¾“å‡ºã€‚</p>
<p>â€‹ æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆæ›´å¤šçš„æ•°æ®æˆ–è€…è¾¾åˆ°äººå·¥æ™ºèƒ½åˆ›ä½œ / æƒ³è±¡çš„ç›®çš„ï¼Œéœ€è¦éšæœºçš„è¾“å‡ºã€‚æˆ‘ä»¬å¸Œæœ›å¯ä»¥åŠ å…¥ç¼–ç çš„æ‰°åŠ¨ï¼ˆPerturbanceï¼‰æˆ–è€…äººå·¥çš„å¹²é¢„ï¼ˆInterventionï¼‰ï¼Œè®©ç¼–ç æ›´åŠ å¤šæ ·åŒ– / éšæœºåŒ–ï¼Œè€Œä¸”Decoderå¯ä»¥å¯¹è¿™ç§åŠ å…¥çš„å™ªå£°é²æ£’ã€‚è¿™å°±å¾—åˆ°äº†VAEï¼ˆVariational Auto Encoderï¼‰å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ã€‚</p>
<h3 id="å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨">å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨</h3>
<p>â€‹ ä¸€ä¸ªæƒ³æ³•ï¼šé¦–å…ˆä¸€ä¸ªéšæœºçš„ç¼–ç å™¨åœ¨æ•°å­¦ä¸Šçš„è¡¨ç°åº”è¯¥æ˜¯ç»™å®šä¸€ä¸ªå‘é‡ï¼ˆæ¯”å¦‚ç¼–ç ï¼‰Zï¼Œä»Zä¸­æ¢å¤Xï¼ˆè®­ç»ƒé›†çš„åˆ†å¸ƒï¼‰ã€‚é‚£ä¹ˆå°±æ˜¯ä»<span class="math inline">\(P_Z(x)\)</span>åˆ°<span class="math inline">\(P_X(x)\)</span>çš„æ˜ å°„ï¼ˆç¼–ç åˆ†å¸ƒç©ºé—´åˆ°æ ·æœ¬ç©ºé—´çš„æ˜ å°„ï¼‰ï¼Œå¾—åˆ°æ–°çš„åˆ†å¸ƒ<span class="math inline">\(P_{\hat X}(x)\)</span>ã€‚é‚£ä¹ˆæ ¹æ®è´å¶æ–¯çš„æƒ³æ³•ï¼Œå¯ä»¥è¡¨ç¤ºåˆ†å¸ƒ<span class="math inline">\(P_X(x)\)</span>ä¸ºï¼š <span class="math display">\[
\begin{equation}
P_X(x)=\sum_kP(X|Z_k)P(Z_k)\label{YY}
\end{equation}
\]</span> â€‹ æ„æ€æ˜¯ï¼šä¸åŒç¼–ç çš„åˆ†å¸ƒ ä¸ ç»™å®šç¼–ç ä¸‹ï¼Œè¾“å‡ºæ•°æ®ä¸ºå¯¹åº”ç±»å‹X ä¸¤è€…çš„æ¡ä»¶æ¦‚ç‡ç»“åˆã€‚é‚£ä¹ˆæ•°æ®ç”Ÿæˆå’Œåˆ†å¸ƒä¹‹é—´çš„å…³ç³»åˆæ˜¯ä»€ä¹ˆå‘¢?ç›´è§‚åœ°ç†è§£ä¸€ä¸‹ï¼š</p>
<p>â€‹ ä¸–ç•Œä¸Šæœ‰å‡ ä¹æ— æ•°ç§çŒ«ï¼ŒçŒ«äº§ç”Ÿçš„åä»£ä¹Ÿä¸æ˜¯å’Œå…¶çˆ¶æ¯ä¸€è‡´çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæƒ³ä»æ•°æ®å±‚é¢ã€ç”ŸæˆçŒ«ã€‘ï¼Œåº”è¯¥é¦–å…ˆçŸ¥é“ <strong>ä¸åŒè¡¨ç°å‹çš„çŒ«çš„ã€æ€»ä½“åˆ†å¸ƒã€‘</strong>ï¼Œå¦‚æœçŸ¥é“è¿™ä¸ªåˆ†å¸ƒï¼Œæ˜¾ç„¶åªéœ€è¦ä»è¿™ä¸ªåˆ†å¸ƒä¸­éšæœºé‡‡æ ·å°±å¯ä»¥å¾—åˆ°ä»»æ„æ–°æ€§çŠ¶çš„çŒ«ã€‚ä½†æ˜¯è¿™ä¸ªåˆ†å¸ƒåŸºæœ¬æ˜¯ä¸å¯çŸ¥çš„ï¼Œå³ä½¿å­˜åœ¨æµ·é‡æ•°æ®æˆ‘ä»¬ä¹Ÿæ²¡åŠæ³•å¾—åˆ°è¿™ä¸ªåˆ†å¸ƒçš„è¡¨è¾¾å¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›é€šè¿‡åˆ«çš„æ–¹å¼æ¥è¿‘ä¼¼è¡¨è¾¾è¿™ä¸ªåˆ†å¸ƒï¼Œæ¯”å¦‚ä½¿ç”¨å¼(1)ã€‚</p>
<p>â€‹ å‡è®¾Zä¸æ˜¯ç¼–ç è€Œæ˜¯ä¸åŒçš„å½¢çŠ¶ï¼Œé‚£ä¹ˆå¯ä»¥å»ºç«‹ä¸€ä¸ªæ€§çŠ¶ä»¥åŠå«æœ‰å¯¹åº”ç»„åˆè¡¨ç°å‹çš„çŒ«çš„æ¦‚ç‡æ˜ å°„ï¼Œé€šè¿‡è´å¶æ–¯å…¨æ¦‚ç‡å…¬å¼è·å¾—ã€‚è€ŒæŠŠZæ¢ä¸ºç¼–ç ï¼ˆ<strong>æ›´åŠ æŠ½è±¡çš„å½¢çŠ¶è¡¨ç¤º</strong>ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç¼–ç å­˜åœ¨åˆ†å¸ƒï¼ˆæ­£å¦‚ä¸åŒæ€§çŠ¶å¦‚é»‘ç™½å­˜åœ¨ä¸€å®šåˆ†å¸ƒï¼‰ï¼Œè€Œç»™å®šç¼–ç ï¼ˆç»™å®šå½¢çŠ¶ï¼‰æ—¶ä¹Ÿå­˜åœ¨å…¶ä»–çš„åˆ†å¸ƒï¼ˆZ=å…¬çŒ«ï¼Œå…¬çŒ«ä¸­çš„ç™½çŒ« / èŠ±çŒ«åˆ†å¸ƒç­‰ç­‰ï¼‰ã€‚</p>
<p>â€‹ VAEä¸­ï¼Œ<span class="math inline">\(P(Z)\)</span>è¢«å»ºæ¨¡æˆäº†æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼ˆå…¶ä»–åˆ†å¸ƒä¹Ÿå¯ï¼‰ï¼ŒåŸå› æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ul>
<li>æ ‡å‡†æ­£æ€åˆ†å¸ƒå¸¸è§ï¼Œå¹¶ä¸”æ–¹ä¾¿è¿›è¡Œç†µè®¡ç®—ï¼ˆ<strong><u>æˆ–è€…è¯´ï¼ŒKLæ•£åº¦è®¡ç®—æ—¶ä¸ä¼šå‡ºç°é—®é¢˜ï¼ˆæ¯”å¦‚å‡åŒ€åˆ†å¸ƒä¼šå­˜åœ¨æ¦‚ç‡å¯†åº¦ä¸º0å¯¼è‡´å¥‡å¼‚æ€§çš„ç°è±¡ï¼‰</u></strong>ï¼‰</li>
<li>å¤©ç„¶çš„expæ€§è´¨ï¼Œå¹¶ä¸”è¡¨ç¤ºå®¹æ˜“ï¼Œåªéœ€è¦å¯¹<span class="math inline">\(\mu,\sigma\)</span>è¿›è¡Œå»ºæ¨¡è¡¨ç¤ºå³å¯ã€‚</li>
</ul>
<hr>
<h2 id="ganåŸç†">GANåŸç†</h2>
<ul>
<li>GANéœ€è¦æ„å»ºä¸€ä¸ªç”Ÿæˆå™¨å’Œä¸€ä¸ªåˆ¤åˆ«å™¨ï¼Œç”Ÿæˆå™¨éœ€è¦ç”Ÿæˆèƒ½å¤Ÿä»¥å‡ä¹±çœŸçš„æ•°æ®ã€‚ç”Ÿæˆå‡ºçš„æ•°æ®éœ€è¦è¾“å…¥åˆ°åˆ¤åˆ«å™¨ä¸­ï¼Œç”±åˆ¤åˆ«å™¨è¿›è¡Œåˆ¤å®šï¼šæ­¤æ•°æ®æ˜¯çœŸçš„ï¼ˆéç”Ÿæˆçš„ï¼‰è¿˜æ˜¯å‡çš„ï¼ˆç”Ÿæˆçš„ï¼‰ã€‚<strong><u>å›ºå®šåˆ¤åˆ«å™¨çš„å‚æ•°ï¼Œè®­ç»ƒç”Ÿæˆå™¨å‚æ•°ï¼Œ</u></strong>ä½¿å¾—ç”Ÿæˆå™¨ç”Ÿæˆçš„ç»“æœè¾“å…¥åˆ°åˆ¤åˆ«å™¨ä¸­ï¼ŒäºŒåˆ†ç±»ï¼ˆçœŸå‡åˆ¤å®šï¼‰å¾—åˆ°ç»“æœå°½å¯èƒ½æ¥è¿‘1.</li>
<li>åˆ¤åˆ«å™¨çš„è®­ç»ƒï¼šæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„åˆ¤åˆ«ç½‘ç»œå°½å¯èƒ½å¼ºå¤§ï¼Œèƒ½å¤ŸåŒºåˆ†çœŸå‡æ•°æ®ï¼Œè¿™æ ·å†è¿›è¡Œç”Ÿæˆå™¨è®­ç»ƒæ—¶ï¼Œç”Ÿæˆå™¨è®­ç»ƒä¼šæœ‰æ›´åŠ ä¸¥æ ¼çš„ç›‘ç£ã€‚åˆ¤åˆ«å™¨è®­ç»ƒæ—¶ï¼Œå›ºå®šç”Ÿæˆå™¨ç½‘ç»œå‚æ•°ï¼Œç”Ÿæˆå™¨ç”Ÿæˆçš„æ•°æ®éœ€è¦ä½¿labelå°½å¯èƒ½ä¸ºfalseã€‚</li>
</ul>
<p><img src="/2021/02/02/GAN%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/GAN_2.JPG"></p>
<ul>
<li>å¹¶ä¸”ï¼Œåˆ†ç±»å™¨ä¸ä»…èƒ½æ­£ç¡®å¤„ç†ç”Ÿæˆå™¨ç”Ÿæˆçš„æ•°æ®ï¼ˆæ­£ç¡®åœ°labelæˆfalseç±»ï¼‰ï¼ˆTrue Positiveï¼‰ï¼Œè¿˜éœ€è¦æœ‰å¤„ç†True Negativeçš„èƒ½åŠ›ï¼Œå¯¹äºçœŸå®çš„æ•°æ®ï¼Œéœ€è¦æ­£ç¡®åˆ†ç±»ä¸ºçœŸã€‚</li>
</ul>
<hr>
<h2 id="gançš„æ•°å­¦åŸç†">GANçš„æ•°å­¦åŸç†</h2>
<h3 id="klæ•£åº¦">KLæ•£åº¦</h3>
<p>â€‹ éœ€è¦å›å¿†ä¸€ä¸‹KLæ•£åº¦çš„å®šä¹‰ï¼ŒKLæ•£åº¦æè¿°çš„æ˜¯ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒçš„ç›¸ä¼¼ç¨‹åº¦ï¼Œåˆç§°ä¸ºç›¸å¯¹ç†µã€‚æ—¢ç„¶æ˜¯â€œç†µâ€ï¼Œé‚£ä¹ˆç›¸å¯¹ç†µå°±ä¸ç»å¯¹ç†µï¼ˆä¿¡æ¯ç†µï¼‰å­˜åœ¨å…³ç³»ã€‚ä¿¡æ¯ç†µæ˜¯ä¿¡æ¯ä¸ç¡®å®šç¨‹åº¦çš„åº¦é‡ã€‚è€Œä¿¡æ¯é‡çš„åº¦é‡æ˜¯ï¼š <span class="math display">\[
I(x_i)=-log(p(x_i))
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼šäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡è¶Šå°ï¼Œè‹¥å‘ç”Ÿï¼Œæºå¸¦çš„ä¿¡æ¯é‡æ˜¯è¶Šå¤§çš„ã€‚å¯¹äºä¸€ä¸ªå…·æœ‰ä¸€å®šä¸ç¡®å®šåº¦çš„ä¿¡æ¯æºï¼Œä¸€ä¸ªäº‹ä»¶<span class="math inline">\(x_i\)</span>å‘ç”Ÿçš„æ¦‚ç‡è‹¥æ˜¯<span class="math inline">\(P(x_i)\)</span>ï¼Œé‚£ä¹ˆä¿¡æ¯ç†µä¸ºï¼š <span class="math display">\[
H(x_i)=-p(x_i)log(p(x_i))
\]</span> â€‹ å¦‚æœä¿¡æ¯æºå‘é€çš„â€œäº‹ä»¶â€å­˜åœ¨nä¸ªä¸åŒçš„å–å€¼ï¼Œæ¯ä¸ªäº‹ä»¶çš„æ¦‚ç‡ä¸º<span class="math inline">\(p(x_i)\)</span>ï¼Œé‚£ä¹ˆï¼Œä¿¡æ¯æºç†µä¸ºï¼š <span class="math display">\[
H(U)=-\sum_{i=1}^np(x_i)log(p(x_i))
\]</span> â€‹ å¯ä»¥çœ‹å‡ºï¼Œä¿¡æ¯ç†µæ˜¯ç³»ç»Ÿä¿¡æ¯é‡æ ¹æ®æ¦‚ç‡åˆ†å¸ƒçš„åŠ æƒï¼Œæ˜¯ä¸€ä¸ªç³»ç»Ÿçš„å¹³å‡ï¼ˆæœŸæœ›ï¼‰ä¿¡æ¯é‡ã€‚</p>
<h3 id="klæ•£åº¦çš„ç”±æ¥">KLæ•£åº¦çš„ç”±æ¥</h3>
<p>â€‹ å¯¹äºä¸€ä¸ªå­—ç¬¦é›†ï¼ˆæ¯”å¦‚26å­—æ¯ï¼Œéœ€è¦è¿›è¡Œä¸ç­‰é•¿ç¼–ç ï¼‰ï¼Œå‡è®¾æ¯ä¸ªå­—ç¬¦Xå‡ºç°çš„æ¦‚ç‡æ˜¯<span class="math inline">\(P(x)\)</span>ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼Œä¸€ä¸ªå­—ç¬¦éœ€è¦ç¼–ç çš„å­—èŠ‚æ•°ï¼ˆæˆ–è€…ä½æ•°ï¼‰ä¼šå¯¹ç­‰äºä¿¡æ¯é‡<span class="math inline">\(I(x)\)</span>ï¼Œé‚£ä¹ˆä¸€ä¸ªå­—ç¬¦é›†ç¼–ç çš„å¹³å‡å­—èŠ‚æ•°ç­‰äºä¿¡æ¯ç†µ<span class="math inline">\(H(U)\)</span>ã€‚å‡è®¾ï¼Œè¿™ä¸ªå­—ç¬¦é›†çš„çœŸå®æ¦‚ç‡åˆ†å¸ƒä¸º<span class="math inline">\(P(x_i)\)</span>ï¼Œé‚£ä¹ˆå…¶å¹³å‡ç¼–ç æ•°ä¸º <span class="math display">\[
H(X)=\sum_{i=1}^n p(x_i)log(\frac{1}{p(x_i)})
\]</span> â€‹ ç”±äºï¼Œ<span class="math inline">\(P(x_i)\)</span>æ˜¯å­—ç¬¦é›†Xçš„çœŸå®æ¦‚ç‡åˆ†å¸ƒï¼Œå¯¹äºXæ˜¯æœ€ä¼˜çš„ï¼ˆå¯¹åº”çš„ç¼–ç æ–¹å¼æ˜¯æœ€ä¼˜çš„ï¼‰ã€‚å¦‚æœéœ€è¦ä»¥è¿™ç§ç¼–ç æ–¹å¼å¯¹å­—ç¬¦é›†Yï¼ˆå¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒä¸º<span class="math inline">\(Q(x_i)\)</span>ï¼‰è¿›è¡Œç¼–ç ï¼Œç¼–ç å¹³å‡å­—èŠ‚æ•°å¿…ç„¶æ˜¯æ›´å¤šçš„ï¼ˆå› ä¸ºä¸æ˜¯æœ€ä¼˜çš„ï¼‰ï¼Œé‚£ä¹ˆè¿™ç§ç¼–ç ä¸‹å­˜åœ¨çš„å·®å¼‚æ˜¯ï¼š <span class="math display">\[
D_{KL}(P||Q)=\sum P(x)log(\frac{1}{Q(x)}) - \sum P(x)log(\frac{1}{P(x)})=\sum P(x)\frac{P(x)}{Q(x)}
\]</span> â€‹ ç†è§£äº†ç¼–ç çš„ç‰©ç†æ„ä¹‰å°±çŸ¥é“ï¼Œä¸ºä»€ä¹ˆæ˜¯<span class="math inline">\(\frac {P(x)}{Q(x)}\)</span>äº†ï¼Œå› ä¸º<span class="math inline">\(Q(x)\)</span>å¹¶éæœ€ä¼˜åˆ†å¸ƒï¼Œéœ€è¦çš„ç¼–ç é‡æ›´å¤§ã€‚è€Œæˆ‘ä»¬ä¸å–œæ¬¢è´Ÿæ•°ï¼Œä¸ºäº†è®©KLæ•£åº¦ä¸ºæ­£ï¼Œæ•…è¿™æ ·å®šä¹‰ã€‚</p>
<p>â€‹ ç©¿æ’ä¸€ç‚¹ä¼˜åŒ–åŸç†çš„çŸ¥è¯†ï¼šä¸ºä»€ä¹ˆä½¿ç”¨äº¤å‰ç†µä½œä¸ºå¾ˆå¤šç½‘ç»œçš„æŸå¤±å‡½æ•°ï¼Ÿ</p>
<h3 id="äº¤å‰ç†µä¸klæ•£åº¦çš„å…³ç³»">äº¤å‰ç†µä¸KLæ•£åº¦çš„å…³ç³»</h3>
<p>â€‹ äº¤å‰ç†µçš„å®šä¹‰ï¼š <span class="math display">\[
H_c(x)=-\sum_{i=1}^np(x_i)log(q(x_i))=\sum P(x)log(\frac{1}{Q(x)})
\]</span> â€‹ ä¸KLæ•£åº¦çš„å…¬å¼è¿›è¡Œå¯¹æ¯”ï¼Œå¯ä»¥å‘ç°ï¼š <span class="math display">\[
D_{KL}(P||Q)=H_c(x)-\sum P(x)log(P(x))
\]</span> â€‹ å…¶ä¸­ï¼š<span class="math inline">\(\sum P(x)log(P(x))\)</span>è¡¨å¾çš„æ˜¯åŸå§‹åˆ†å¸ƒã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ˆæ¯”å¦‚å…¸å‹çš„åˆ†ç±»å™¨è®­ç»ƒï¼‰ï¼Œ<span class="math inline">\(P(x)\)</span>ä¸€èˆ¬æ˜¯ç»™å®šçš„ï¼šæ¯”å¦‚æˆ‘ä»¬ç»™å®šæ•°æ®çš„åŸå§‹labelå°±æ˜¯ç»™å®šäº†ä¸€ä¸ªåŸå§‹åˆ†å¸ƒï¼Œæˆ‘ä»¬å¸Œæœ›ç½‘ç»œå­¦ä¹ åˆ°çš„åˆ†å¸ƒå‚æ•°èƒ½å¤Ÿå°½å¯èƒ½ä¸åŸå§‹åˆ†å¸ƒæ¥è¿‘ã€‚è€Œç”±äº<span class="math inline">\(\sum P(x)log(P(x))\)</span>æ˜¯å¸¸æ•°ï¼ˆç»™å®šçš„åŸå§‹åˆ†å¸ƒæ˜¯å¸¸çš„ï¼‰ï¼Œä¼˜åŒ–äº¤å‰ç†µå°±ç›¸å½“äºä¼˜åŒ–è®­ç»ƒé›†ä¸è¾“å‡ºçš„KLæ•£åº¦ã€‚</p>
<h3 id="ganåœ¨ä¼˜åŒ–ä»€ä¹ˆ">GANåœ¨ä¼˜åŒ–ä»€ä¹ˆ</h3>
<p>â€‹ GANçš„è®­ç»ƒè¿‡ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯æ„é€ ä¸€ä¸ªè¿‘ä¼¼çš„åŸå§‹åˆ†å¸ƒã€‚ç”±äºæˆ‘ä»¬åªæœ‰åŸå§‹åˆ†å¸ƒçš„é‡‡æ ·ï¼ˆæ¯”å¦‚MNISTæ‰‹å†™æ•°æ®é›†ï¼Œæ˜¯æ‰‹å†™æ•°å­—çš„é‡‡æ ·ï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°é‡‡æ ·å¤–çš„æ•°æ®ï¼Œé‚£å°±éœ€è¦åŸå§‹åˆ†å¸ƒã€‚é‚£ä¹ˆæ„å»ºåŸå§‹åˆ†å¸ƒï¼Œå¯ä»¥çœ‹ä½œæ˜¯ï¼šæ„å»ºä¸€ä¸ªå¸¦æœ‰å‚æ•°é›†åˆ<span class="math inline">\(\{\theta\}\)</span>çš„åˆ†å¸ƒ<span class="math inline">\(P_G\)</span>ï¼Œä½¿å¾—ï¼Œä»<span class="math inline">\(P_G\)</span>ä¸­é‡‡æ ·å¾—åˆ°çš„åŸå§‹åˆ†å¸ƒçš„é‡‡æ ·ï¼ˆç»™å®šçš„æ•°æ®é›†ï¼‰çš„æ¦‚ç‡å°½å¯èƒ½å¤§ï¼ˆä¸ªäººç†è§£ï¼‰ã€‚</p>
<p>â€‹ ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬è®¤ä¸ºï¼šåœ¨æå¤§ä¼¼ç„¶çš„æ€æƒ³ä¸‹ï¼Œå‚æ•°åº”è¯¥å°½å¯èƒ½åæ˜ é‡‡æ ·çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯ç»™å®šçœŸå®åˆ†å¸ƒ<span class="math inline">\(P_R\)</span>çš„æŠ½æ ·é›†åˆ<span class="math inline">\(d = \{x_1, x_2, ... x_n\}\)</span>ï¼Œåº”è¯¥ä½¿ä¸‹å¼æœ€å¤§ï¼ˆæå¤§ä¼¼ç„¶ï¼‰ã€‚ <span class="math display">\[
\begin{align}
&amp;L(\theta)=\prod_{i=1}^n P_G(x_i|\theta) \\
&amp;\theta^*=\mathop{argmax}_{\theta}\prod_{i=1}^n P_G(x_i|\theta)
\end{align}
\]</span> â€‹ æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹å…¬å¼(10)è¿›è¡Œä¸€äº›æ•°å­¦ä¸Šçš„å˜æ¢ï¼š</p>
<ol type="1">
<li>logåŒ–ï¼šç”±äºlogæ˜¯ä¸¥æ ¼å¢çš„ï¼ŒåŠ logå°†ä¸å½±å“ç»“æœ</li>
</ol>
<p><span class="math display">\[
\theta^*=\mathop{argmax}_{\theta}\;log(\prod_{i=1}^n P_G(x_i|\theta))=\mathop{argmax}_{\theta}\;\sum_{i=1}^nlog(P_G(x_i|\theta))
\]</span></p>
<ol start="2" type="1">
<li>ä¸çœŸå®åˆ†å¸ƒè¿›è¡Œå…³è”ï¼šåœ¨ç”Ÿæˆå™¨å¯¹åº”çš„ç”Ÿæˆåˆ†å¸ƒè¿‘ä¼¼äºåŸå§‹åˆ†å¸ƒçš„æƒ…å†µä¸‹ï¼Œç”Ÿæˆåˆ†å¸ƒä¸‹è®¨è®ºæœ€ä¼˜å‚æ•°<span class="math inline">\(\theta^*\)</span>å¯¹åº”çš„ä¼¼ç„¶ï¼Œå°±ç­‰ä»·äºè®¨è®ºåŸå§‹åˆ†å¸ƒé‡‡æ ·å¾—åˆ°ç»“æœæ¦‚ç‡ã€‚</li>
</ol>
<p><span class="math display">\[
\theta^* \approx \mathop{argmax}_{\theta}\;S_x\{P_R|log(P_G(x|\theta))\}
\]</span></p>
<p>â€‹ ä¸Šå¼çš„æ„ä¹‰æ˜¯ï¼š<span class="math inline">\(\sum_{i=1}^nlog(P_G(x_i|\theta))\)</span>-&gt;ä¸­çš„<span class="math inline">\(x_i\)</span>ç›¸å½“äºä»çœŸå®åˆ†å¸ƒ<span class="math inline">\(P_R\)</span>ä¸­æŠ½æ ·å¾—åˆ°ï¼Œéšå«äº†æŠ½æ ·æ¦‚ç‡ï¼ˆå¾—åˆ°<span class="math inline">\(x_i\)</span>çš„æ¦‚ç‡è¢«éšå«äº†ï¼‰ï¼Œå¦‚æœæŠ½æ ·æ¬¡æ•°æ¥è¿‘æ— ç©·å¤§ï¼Œç›¸å½“äºå¯¹å…¨ç©ºé—´è¿›è¡ŒæŠ½æ ·ï¼Œå¯ä»¥è¿ç»­åŒ–ä¸ºï¼š <span class="math display">\[
\theta^*=\mathop{argmax}_{\theta}\;\int_x P_R(x)log(P_G(x|\theta))dx
\]</span></p>
<ol start="3" type="1">
<li>è½¬åŒ–ä¸ºKLæ•£åº¦ï¼šå®é™…ä¸Š(13)å·²ç»æœ‰KLæ•£åº¦çš„å½±å­äº†ï¼ŒKLæ•£åº¦çš„è¿ç»­å½¢å¼ä¸ºï¼š</li>
</ol>
<p><span class="math display">\[
D_{KL}(P||Q)=\int_x P(x)log(\frac{P(x)}{Q(x)})dx
\]</span></p>
<p>â€‹ åˆ™ï¼Œç”±äºåœ¨argmaxè¿‡ç¨‹ä¸­å¼•å…¥ä¸<span class="math inline">\(\theta\)</span>æ— å…³çš„å¸¸æ•°å› å­ï¼Œä¸å½±å“ç»“æœï¼Œé‚£ä¹ˆ(13)å¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\theta^*=\mathop{argmax}_{\theta}\;\int_x P_R(x)log(P_G(x|\theta))dx-\int_x P_R(x)log(P_R(x))dx
\]</span> â€‹ ä¸(14)å¯¹æ¯”ï¼Œå‘ç°ï¼Œåç«¯éœ€è¦ä¼˜åŒ–çš„å¼å­å°±æ˜¯å¯¹åº”çš„KLæ•£åº¦ï¼š <span class="math display">\[
\int_x P_R(x)log(P_G(x|\theta))dx-\int_x P_R(x)log(P_R(x))=\int_x P_R(x)log(\frac{P_G(x)}{P_R(x)})dx=D_{KL}(P_R||P_G)
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼šå¾—åˆ°æœ€ä¼˜ç”Ÿæˆåˆ†å¸ƒçš„å‚æ•°<span class="math inline">\(\theta\)</span>çš„è¿‡ç¨‹å°±æ˜¯åœ¨ä¼˜åŒ–åŸå§‹åˆ†å¸ƒï¼ˆæœªçŸ¥ï¼Œä½†æ˜¯é‡‡æ ·å·²çŸ¥ï¼‰ä¸æœ€ä¼˜ç”Ÿæˆåˆ†å¸ƒçš„KLæ•£åº¦ã€‚</p>
<h3 id="ç”Ÿæˆåˆ†å¸ƒçš„è®¡ç®—">ç”Ÿæˆåˆ†å¸ƒçš„è®¡ç®—</h3>
<p>â€‹ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆGANè¦åœ¨é«˜æ–¯ä¸­é‡‡æ ·ï¼ŸåŸæ¥çš„latent vector(z)åˆæ˜¯å¦‚ä½•ä¸€æ­¥æ­¥å˜åˆ°ç”Ÿæˆæ•°æ®çš„ï¼Ÿæˆ‘ä»¬å·²ç»é€šè¿‡è¿‘ä¼¼è¯æ˜äº†ï¼ˆå…¶ä¸­ä¸€ä¸ªå·§å¦™çš„æ€æƒ³å°±æ˜¯ï¼šé‡‡æ ·å¾—åˆ°çš„æ ·æœ¬éšå«äº†å…¶æ¦‚ç‡åˆ†å¸ƒï¼‰ä¼˜åŒ–GANç”Ÿæˆå™¨ä¸ä¼˜åŒ–ç”Ÿæˆåˆ†å¸ƒ/åŸå§‹åˆ†å¸ƒKLæ•£åº¦çš„ç­‰ä»·æ€§ã€‚</p>
<p>â€‹ åœ¨å…¬å¼(16)ä¸­ï¼Œå­˜åœ¨<span class="math inline">\(P_G(x|\theta)\)</span>ï¼Œè¿™æ˜¯ä¹‹å‰ä»æœªå‡ºç°è¿‡çš„ã€‚æˆ‘ä»¬é€šè¿‡latent vector zï¼ˆä»å¤šç»´é«˜æ–¯ä¸­é‡‡æ ·çš„éšæœºå‘é‡ï¼‰æ„é€ äº†ä¸€ä¸ªä»å¤šç»´é«˜æ–¯åˆ†å¸ƒç»éçº¿æ€§æ˜ å°„å¾—åˆ°çš„ç”Ÿæˆåˆ†å¸ƒã€‚é‚£ä¹ˆ<span class="math inline">\(P_G(x|\theta)\)</span>è‡ªç„¶ä¸é«˜æ–¯åˆ†å¸ƒæœ‰å…³ã€‚é‚£ä¹ˆ<span class="math inline">\(P_G(x|\theta)\)</span>å¯ä»¥è¢«è¡¨ç¤ºä¸ºï¼š</p>
<p><span class="math display">\[
P_G(x|\theta)=\int_zP_{prior}(z)I_G(z)dz \\
I_G(z)=
\left\{
    \begin{array}{**lr**}
        1,\;if\;G(z)=x,\\
        0,\;if\;G(z)\neq x
    \end{array}
\right.
\]</span></p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´æ­¤å¤„ä½¿ç”¨äº†ä¸€ä¸ªç±»ä¼¼è¾¹ç¼˜åˆ†å¸ƒçš„æ±‚å–çš„æ–¹æ³•ï¼Œå°†æ‰€æœ‰å¯ä»¥ç”Ÿæˆxçš„zæ‰¾åˆ°ï¼Œæ±‚å–å…¶æ¦‚ç‡ã€‚å…¶ä¸­<span class="math inline">\(P_{prior}\)</span>æ˜¯å…ˆéªŒåˆ†å¸ƒï¼Œåœ¨æ­¤å¤„æ˜¯å¤šç»´é«˜æ–¯ã€‚ä»¥ä¸Šåªæ˜¯ç†è®ºæ¨å¯¼ï¼Œå®é™…ä¸Šï¼ŒæŒ‡ç¤ºå‡½æ•°<span class="math inline">\(I_G(z)\)</span>æ˜¯ä¸å¯çŸ¥çš„ï¼Œé‚£ä¹ˆä½¿ç”¨å…¬å¼(17)æ˜¯æ— æ³•è®¡ç®—<span class="math inline">\(P_G(x|\theta)\)</span>çš„ã€‚æ­¤æ—¶æˆ‘ä»¬å¼•å…¥äº†åˆ¤åˆ«å™¨ Discriminatorï¼Œç”¨ä»¥å–ä»£MLEçš„æŒ‡ç¤ºå‡½æ•°å¤„ç†ã€‚</p>
<h3 id="åˆ¤åˆ«å™¨ä¸jsæ•£åº¦çš„å¯¼å‡º">åˆ¤åˆ«å™¨ä¸JSæ•£åº¦çš„å¯¼å‡º</h3>
<p>â€‹ æ¯æ¬¡ç”Ÿæˆå™¨Gè®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ï¼Œåœ¨ç»™å®šçš„åˆ¤åˆ«å™¨Dè¾ƒä¼˜æ—¶ï¼Œç”Ÿæˆå™¨Gä»ç„¶èƒ½éª—è¿‡Dã€‚é¦–å…ˆï¼Œæ ¹æ®ç®€å•çš„BCELossï¼Œæˆ‘ä»¬å®šä¹‰éœ€è¦ä¼˜åŒ–çš„scoreï¼ˆæœ€å¤§åŒ–ï¼‰ï¼š <span class="math display">\[
S(G, D)=S_{x\{P_R\}}\;log(D(x))+S_{x\{P_G\}}\;log(1-D(X))
\]</span> â€‹ ä¸Šå¼ä¹Ÿå°±æ˜¯Dè®­ç»ƒæ—¶ï¼Œå¸Œæœ›èƒ½æœ€ä¼˜åœ°åŒºåˆ†åŸå§‹æ•°æ®ä¸ç”Ÿæˆæ•°æ®æ‰€å®šä¹‰çš„Scoreã€‚é‚£ä¹ˆé‡‡æ ·<span class="math inline">\(S_{x\{dist\}}\)</span>å¯ä»¥å±•å¼€ä¸ºå®šç§¯åˆ†ï¼š <span class="math display">\[
S(G,D)=\int_xP_R(x)log(D(x))dx+\int_x P_G(x) log(1-D(x))dx
\]</span> â€‹ åˆ¤åˆ«å™¨è®­ç»ƒæ—¶ï¼ŒGçš„å‚æ•°ä¸å˜ï¼ŒåŸå§‹åˆ†å¸ƒå‚æ•°ä¹Ÿä¸å˜ï¼Œé‚£ä¹ˆå…¬å¼(19)ä¸­çš„å¯å˜é‡å°±æ˜¯Dçš„å‚æ•°ã€‚æˆ‘ä»¬éœ€è¦æ±‚åˆ°ä¸€ä¸ªæœ€ä¼˜çš„Dï¼ˆ<span class="math inline">\(D^*\)</span>ï¼‰ä»¥æœ€ç»ˆæ±‚å¾—Gï¼šä¹Ÿå³æœ€ä¼˜åˆ¤åˆ«å™¨ä¸‹å¯¹åº”çš„æœ€ä¼˜ç”Ÿæˆå™¨ã€‚ <span class="math display">\[
G^*=\mathop{argmin}_{G}\;\mathop{argmax}_{D}\;S(G,D)
\]</span> â€‹ å¯ä»¥å°†(19)å¼åˆå¹¶ç§¯åˆ†å†…å¼å­ï¼Œå¹¶ä¸”è¿›è¡Œæ±‚å¯¼ï¼ˆå¯¹Dï¼‰ï¼š <span class="math display">\[
\begin{align}
    &amp;S_n(D)=P_R(x)log(D(x))+P_G(x) log(1-D(x))\\
    let:\;&amp;\frac{\partial S_n}{\partial D}=\frac{P_R(x)}{D}-\frac{P_G(x)}{1-D}=0
\end{align}
\]</span></p>
<p>â€‹ å¯ä»¥å¾—åˆ°æœ€ä¼˜åˆ¤åˆ«å™¨çš„å‚æ•°Dä¸ºï¼š <span class="math display">\[
D(x)=\frac{P_R(x)}{P_R(x) + P_G(x)}
\]</span></p>
<p>â€‹ é‚£ä¹ˆå…¬å¼(19)çš„D(X)è¡¨è¾¾å¼å·²ç»çŸ¥é“äº†ï¼Œå¸¦å…¥å¾—åˆ°ï¼š <span class="math display">\[
S(G,D)=\int_x
\left\{
    P_R(x)log(\frac{P_R(x)}{P_R(x) + P_G(x)}) + P_G(x) log(\frac{P_G(x)}{P_R(x) + P_G(x)})
\right\}
dx
\]</span></p>
<p>â€‹ å•ç‹¬è®¨è®º(24)ç§¯åˆ†å†…éƒ¨çš„å¼å­ï¼Œå¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å¤„ç†åï¼š <span class="math display">\[
\begin{equation}
\int_x P_R(x) log(\frac{P_R(x)}{\frac{P_R(x) + P_G(x)}{2}})dx + \int_x P_G(x) log(\frac{P_G(x)}{\frac{P_R(x) + P_G(x)}{2}})dx-2log2\\
=D_{KL}(P_R|{\frac{P_R(x) + P_G(x)}{2}})+D_{KL}(P_G|{\frac{P_R(x) + P_G(x)}{2}})-2log2\\
=2D_{JS}(P_R|P_G)-2log2
\end{equation}
\]</span> â€‹ æˆ‘ä»¬å°†å¼(25)åŒ–ç®€ç»“æœçš„éƒ¨åˆ†è¿›è¡Œå®šä¹‰ï¼š <span class="math display">\[
D_{JS}(P|Q)\overset{\Delta}{=}{\frac12}D_{KL}(P|M)+{\frac12}D_{KL}(Q|M),\\
where\;\;M=\frac{P+Q}2
\]</span> â€‹ å¯ä»¥çœ‹å‡ºï¼ŒJSæ•£åº¦ç›¸æ¯”äºKLæ•£åº¦è€Œè¨€ï¼Œå…¶æ˜¯å¯¹ç§°çš„ã€‚æˆ‘ä»¬ä¼˜åŒ–çš„æ˜¯å…³äº {ç”Ÿæˆåˆ†å¸ƒ}{åŸå§‹åˆ†å¸ƒ}çš„JSæ•£åº¦ï¼Œå…¶ä¸­å€ŸåŠ©äº†åˆ¤åˆ«å™¨ï¼Œåˆ¤åˆ«å™¨å°†å¤æ‚çš„MLEæŒ‡ç¤ºå‡½æ•°ï¼ˆå½¢å¼ä¸è´Ÿè´£ï¼Œä½†æ˜¯éš¾ç®—ï¼‰è½¬åŒ–ä¸ºäº†æ˜“äºè®¡ç®—çš„JSæ•£åº¦ï¼Œä»¥ä¼˜åŒ–ä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚ã€‚</p>
<hr>
<h2 id="åŸå§‹ganä¸ºä»€ä¹ˆéš¾ä»¥è®­ç»ƒ">åŸå§‹GANä¸ºä»€ä¹ˆéš¾ä»¥è®­ç»ƒ</h2>
<p>â€‹ åŸå§‹GANå®é™…åœ¨ä¼˜åŒ–(25)å¼å¯¹åº”çš„JSæ•£åº¦ã€‚<span class="math inline">\(P_G\)</span>ä¸<span class="math inline">\(P_R\)</span>å¯ä»¥äº’ç›¸æ¥è¿‘ï¼ˆ<span class="math inline">\(P_G\)</span>é€šè¿‡æ¢¯åº¦æ¥è°ƒæ•´ï¼‰ã€‚è€Œå¦‚æœï¼Œè¿™ä¸¤ä¸ªåˆ†å¸ƒæœ¬èº«å°±å‡ ä¹ä¸é‡åˆï¼ˆä»€ä¹ˆå«ä¸é‡åˆï¼Ÿï¼‰ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<p>â€‹ ä¸é‡åˆçš„å®šä¹‰å¾ˆç®€å•ï¼Œæ¦‚ç‡å¯†åº¦ä¸ä¸º0çš„ä½ç½®é”™å¼€äº†ï¼ˆæˆ–æ¦‚ç‡å¯†åº¦è¾ƒå¤§çš„ä½ç½®é”™å¼€äº†ï¼‰ã€‚é‚£ä¹ˆå‡è®¾<span class="math inline">\(P_G\)</span>ä¸<span class="math inline">\(P_R\)</span>çš„å…³ç³»æ˜¯ä»»æ„çš„ï¼Œé‚£ä¹ˆä¼šæœ‰å¦‚ä¸‹å››ç§å…³ç³»ï¼š</p>
<ul>
<li><span class="math inline">\(P_G(x)\approx 0,P_R(x)&gt;&gt;0\)</span></li>
<li><span class="math inline">\(P_G(x)&gt;&gt; 0,P_R(x)\approx 0\)</span></li>
<li><span class="math inline">\(P_G(x)&gt;&gt; 0,P_R(x)&gt;&gt;0\)</span></li>
<li><span class="math inline">\(P_G(x)\approx 0,P_R(x)\approx 0\)</span></li>
</ul>
<p>â€‹ åœ¨å‰ä¸¤ç§æƒ…å†µæˆç«‹æ—¶ï¼Œä¸é‡åˆï¼ˆä¸€ä¸ªåˆ†å¸ƒæœ‰å€¼çš„åœ°æ–¹ï¼Œå¦ä¸€ä¸ªåˆ†å¸ƒåŸºæœ¬ä¸Šæ²¡æœ‰å€¼ï¼‰ã€‚é‚£ä¹ˆåœ¨ä¸é‡åˆæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹å…¬å¼(25): <span class="math display">\[
2D_{JS}(P_R|P_G)=\int_xP_R(x)log(\frac{P_R(x)}{\frac{P_R(x) + P_G(x)}{2}})dx + \int_xP_G(x) log(\frac{P_G(x)}{\frac{P_R(x) + P_G(x)}{2}})dx
\]</span> â€‹ å½“<span class="math inline">\(P_G\)</span>ä¸ä¸º0çš„ä½ç½®ï¼Œ<span class="math inline">\(P_R\)</span>æ¥è¿‘0ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼Œ(27)çš„è®¡ç®—ç»“æœä¸ºlog2ï¼Œå¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œè®¡ç®—ç»“æœä¹Ÿæ˜¯log2ï¼ˆæˆ–ä¸xæœ‰å…³ï¼Œä½†æ˜¯xçš„å½±å“æå…¶å°ï¼‰ã€‚å¯ä»¥çŸ¥é“ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ä¼˜åŒ–çš„<span class="math inline">\(D_{JS}\)</span>å·²ç»ä¸å…·å¤‡æŒ‡å¯¼æ„ä¹‰äº†ï¼Œæ¢¯åº¦å·²ç»æ¶ˆå¤±äº†ã€‚ç”Ÿæˆå™¨æ— æ³•å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<p><span class="math inline">\(P_R\)</span>ä¸<span class="math inline">\(P_G\)</span>ä¸é‡å æˆ–é‡å éƒ¨åˆ†å¯å¿½ç•¥çš„å¯èƒ½æ€§æœ‰å¤šå¤§ï¼Ÿä¸ä¸¥è°¨çš„ç­”æ¡ˆæ˜¯ï¼šéå¸¸å¤§ã€‚æ¯”è¾ƒä¸¥è°¨çš„ç­”æ¡ˆæ˜¯ï¼šå½“<span class="math inline">\(P_R\)</span>ä¸<span class="math inline">\(P_G\)</span>çš„æ”¯æ’‘é›†ï¼ˆsupportï¼‰æ˜¯é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼ˆmanifoldï¼‰æ—¶ï¼Œ<span class="math inline">\(P_R\)</span>ä¸<span class="math inline">\(P_G\)</span>é‡å éƒ¨åˆ†æµ‹åº¦ï¼ˆmeasureï¼‰ä¸º0çš„æ¦‚ç‡ä¸º1ã€‚</p>
</blockquote>
<ul>
<li>å…¶ä¸­ï¼Œæ”¯æ’‘é›†å°±æ˜¯ï¼ˆ1ï¼‰å‡½æ•°çš„éé›¶éƒ¨åˆ†é›†åˆï¼ˆ2ï¼‰æ¦‚ç‡åˆ†å¸ƒçš„é0éƒ¨åˆ†é›†åˆã€‚</li>
<li>æµå½¢ï¼šå°±æ˜¯é«˜ç»´ç©ºé—´ä¸­çš„ï¼Œæ‹¥æœ‰å®è´¨æ›´ä½è‡ªç”±åº¦çš„å½¢ä½“ã€‚</li>
</ul>
<p>â€‹ é‚£ä¹ˆå¯çŸ¥ï¼š<span class="math inline">\(P_G\)</span>çš„æ”¯æ’‘é›†æ°å¥½å°±æ˜¯é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„latent vectoræ¯”åŸå›¾ç‰‡flattenä¹‹åçš„å¤§å°å°å¾—å¤šï¼šæ¯”å¦‚196 dimsçš„zï¼Œå…¨è¿æ¥è‡³56 * 56 * 2 å†å·ç§¯åˆ°56 * 56ï¼Œ<span class="math inline">\(P_G\)</span>å°±æ˜¯ä½ç»´ç©ºé—´çš„æµå½¢ã€‚</p>
<hr>
<h2 id="ä»‹ç»wassersteinè·ç¦»çš„ä¸€äº›æ•°å­¦å‡†å¤‡">ä»‹ç»Wassersteinè·ç¦»çš„ä¸€äº›æ•°å­¦å‡†å¤‡</h2>
<h3 id="lipschitz-æ¡ä»¶">Lipschitz æ¡ä»¶</h3>
<p>â€‹ è¿™ä¸ªæ˜¯é«˜ç­‰æ•°å­¦ä¸­æ²¡æœ‰è¦æ±‚æŒæ¡çš„éƒ¨åˆ†ï¼Œä½†æ˜¯åœ¨æ­¤å¤„åˆæåˆ°äº†ã€‚</p>
<p>â€‹ è‹¥xä¸ºæœ‰ç•Œç©ºé—´<span class="math inline">\(\mathbb R^n\)</span>ä¸­çš„ä¸€ä¸ªå‘é‡ï¼Œå®šä¹‰åœ¨<span class="math inline">\(\mathbb R\)</span>ä¸Šçš„å‡½æ•°<span class="math inline">\(f(x)\)</span>æœ‰ç•Œçš„<strong><u>å……åˆ†</u></strong>æ¡ä»¶æ˜¯ï¼š<span class="math inline">\(f(x)\)</span>æ»¡è¶³Lipschitzè¿ç»­æ€§æ¡ä»¶ï¼š <span class="math display">\[
f:D \subset \mathbb R^n\rightarrow \mathbb R,\;\exists K,\;|f(a)-f(b)|\leq K|a-b|,\; a,b \in D
\]</span> â€‹ å‡½æ•°å€¼çš„è·ç¦»ä¸å‡½æ•°å˜é‡çš„è·ç¦»å­˜åœ¨ä¸€ä¸ªä¸Šç•Œå…³ç³»ã€‚æ‰€ä»¥<span class="math inline">\(f\)</span>åˆç§°ä¸ºæ”¶ç¼©æ˜ å°„ï¼ŒKï¼ˆè‹¥&lt;1ï¼‰ç§°ä¸ºLipschitzå¸¸æ•°ã€‚è€ŒLipschitzè¿ç»­æ€§å¦‚æœå­˜åœ¨ï¼Œè®­ç»ƒæ—¶å°†å°†ä¸ä¼šå‡ºç°æ¢¯åº¦çˆ†ç‚¸çš„æƒ…å†µï¼Œç”±äºLipschitzè¿ç»­æ€§å¯ä»¥é™åˆ¶æ¢¯åº¦ï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ã€‚è€ŒWGANä½¿ç”¨çš„æ˜¯å‰ªè£çš„æ–¹æ³•ï¼Œæƒå€¼å‰ªè£å¯ä»¥ä¿è¯1-Lipschitzè¿ç»­æ€§ï¼Œä½†æ˜¯æ•ˆæœä¸å¤ªå¥½ã€‚æƒå€¼å‰ªè£å¯èƒ½å¯¼è‡´æƒå€¼çš„é›†ä¸­åŒ–ã€‚</p>
<hr>
<h2 id="ganå®ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜">GANå®ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜</h2>
<ul>
<li>åˆ†ç±»å™¨è¿‡å¼ºå¯¼è‡´gan_v2åœ¨æ— æ³•åˆ¤æ–­ç»ˆæ­¢çš„æƒ…å†µä¸‹ï¼Œåˆ†ç±»å™¨ä¸€ç›´è¿›è¡Œè®­ç»ƒï¼Œå¯¼è‡´åˆ†ç±»å™¨çš„losså‡åˆ°0.0001å·¦å³ï¼Œè€Œç”Ÿæˆå™¨çš„lossä¸Šæ¶¨åˆ°10å·¦å³ã€‚è¿™æ ·å¯¼è‡´äº†ç”Ÿæˆå™¨ç”Ÿæˆçš„å›¾ç‰‡å®Œå…¨ä¸ºé»‘è‰²å›¾ã€‚</li>
<li>ä¹‹å‰WGANçš„è®­ç»ƒæ•ˆæœå¹¶ä¸å¥½ï¼Œæ²¡æœ‰ç›´æ¥GANçš„è®­ç»ƒæ•ˆæœå¥½ã€‚
<ul>
<li>åŸå› æ˜¯ï¼šä½¿ç”¨çš„ç½‘ç»œç»“æ„æ ¹æœ¬ä¸éœ€è¦é‚£ä¹ˆå¤æ‚ã€‚ä¹‹å‰ä½¿ç”¨äº†å¥‡æ€ªçš„ï¼šå·ç§¯ + upsampleç»“æ„ã€‚æœ€åä¸€å±‚è¾“å‡ºè¿˜ä½¿ç”¨äº†å¹¶è”ä¸¤ä¸ªå¤§å°å·ç§¯æ ¸è¾“å‡ºç»“æœçš„æ–¹æ³•ï¼Œå¯¼è‡´è®­ç»ƒæ…¢ã€‚</li>
</ul></li>
<li>å°†ç½‘ç»œå…¨éƒ¨æ›¿æ¢æˆå…¨è¿æ¥å±‚ï¼Œè®­ç»ƒ600ä¸ªBatchä¹‹åå°±å·²ç»å¯ä»¥çœ‹å‡ºæ•°å­—çš„å½¢çŠ¶äº†ï¼Œä½†è®­ç»ƒbatchå¢åŠ å¹¶æ²¡æœ‰æ˜¾è‘—å¯¼è‡´å¤–å›´çš„é«˜æ–¯å™ªå£°å‡å°‘ï¼Œä¸ªäººè®¤ä¸ºè¿™æ˜¯ç”±äºå…¨è¿æ¥å±‚ç‰¹æ€§å†³å®šçš„ã€‚</li>
<li>äºæ˜¯æˆ‘å°è¯•å°†å…¨è¿æ¥å±‚çš„è¾“å‡ºå±‚æ›¿æ¢ä¸º3 * 3çš„å·ç§¯ç½‘ç»œã€‚å·ç§¯è¾“å‡ºä¼šå¯¼è‡´æ¨¡ç³Šï¼Œ3 * 3å·ç§¯ç½‘ç»œæ¨¡ç³Šå‡é€€ååˆ†æ…¢ã€‚åœ¨å‚è€ƒäº†GAN training tricksä¹‹åï¼Œå°†3 * 3 kernelæ›¿æ¢ä¸º 5 * 5 kernelï¼Œæœ€åå¾—åˆ°äº†å¹³æ»‘ç»“æœï¼Œå¤–å›´å™ªå£°å¯ä»¥å®Œå…¨æ¶ˆé™¤ï¼Œç½‘ç»œè¾“å‡ºå…·æœ‰å¹³æ»‘åº¦ã€‚</li>
<li>WGAN çš„ <strong>clipping parameter</strong>å¯¹è¾“å‡ºçš„å½±å“ä¹Ÿæ¯”è¾ƒå¤§ï¼Œå½“clipping parameteræ¯”è¾ƒå¤§çš„æ—¶å€™è¾“å‡ºç›´æ¥å˜æˆäº†å¥‡æ€ªçš„æµ®é›•ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>GPU Architecture Intros</title>
    <url>/2021/09/03/GPU-Architecture-Intros/</url>
    <content><![CDATA[<h1 id="gpu">GPU</h1>
<hr>
<p>â€‹ æ‡‚GPUåŠ é€Ÿå¿…é¡»è¦æ‡‚GPUè®¾è®¡ï¼ŒGPUå’ŒCPUå¤ªä¸ä¸€æ ·äº†ã€‚ä¹‹å‰å†™CUDAçš„æ—¶å€™æ„Ÿè§‰éƒ½æ˜¯çå†™ã€‚åœ¨å¼€å­¦èŠ±ä¸ªæ—¶é—´è¡¥äº†è¡¥ï¼ŒèŠ±ä¸€å¤©æ—¶é—´ï¼ˆæ²¡æœ‰å®è·µçš„é‚£ç§ï¼‰çœ‹å®Œäº†åŠ å·ç†å·¥çš„CS179ä»¥åŠä¸€äº›é™„å±èµ„æ–™ï¼š</p>
<center>
<img src="/2021/09/03/GPU-Architecture-Intros/amd.gif" style="zoom:120%;">
</center>
<center>
Figure 1. ä»€ä¹ˆï¼ŸCUDAæ˜¯Nvidiaçš„ï¼Ÿ
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-preliminaries">II. Preliminaries</h2>
<h3 id="åè¯è§£é‡Š">2.1 åè¯è§£é‡Š</h3>
<h4 id="vertex-ä¸-vertex-shader">Vertex ä¸ Vertex Shader</h4>
<p>â€‹ é¡¶ç‚¹è¡¨ç¤ºäº†ä»€ä¹ˆï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œwikipediaä¸€çœ‹å°±æ‡‚ï¼š</p>
<blockquote>
<p>A vertex (plural vertices) in computer graphics is a data structure that describes certain attributes, like the position of a point in 2D or 3D space, or multiple points on a surface.</p>
</blockquote>
<p>â€‹ ä½†æ˜¯ï¼Œvertexä»ä½•è€Œæ¥ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå…¶å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸ªè²Œä¼¼æ²¡æœ‰é‚£ç§ä¸€æœå°±èƒ½æ˜ç™½çš„è§£é‡Šã€‚å¯¹äºä»¥ä¸Šçš„è¿™å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼š</p>
<div class="note info"><p>â€‹ é¡¶ç‚¹å¯ä»¥å°±æ˜¯æ¨¡å‹æ•°æ®æœ¬èº«ï¼Œæ¯”å¦‚æ¨¡å‹å°±ç»™å®šäº†ä¸€ä¸ªéœ€è¦è¿›è¡Œæ¸²æŸ“çš„meshã€‚æˆ–è€…ï¼Œç»™å®šçš„æ˜¯ä¸€ä¸ªæ›´åŠ ç²¾ç»†çš„æ¨¡å‹ï¼Œæ ¹æ®æŸç§é‡‡æ ·+ç”Ÿæˆç®—æ³•ï¼Œå¾—åˆ°çš„vertexã€‚æ³¨æ„vertexåœ¨æ„ä¹‰ä¸Šå°±æœ‰åˆ«äºpointï¼Œpointæ˜¯æ— ç©ºé—´å…³è”å…³ç³»çš„ï¼Œè€Œvertexæ˜¯å­˜åœ¨é‚»æ¥ç»“æ„çš„ã€‚</p>
</div>
<p>â€‹ è€ŒèŠ‚ç‚¹ç€è‰²å™¨çš„èŒè´£åˆ™æ˜¯ï¼šæŠŠåŸæœ¬æ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ï¼Œè½¬æ¢ï¼ˆtransformï¼‰åˆ°å±å¹•ç©ºé—´åæ ‡ä¸‹ã€‚æ ¹æ®ä¸ªäººçš„ç†è§£ï¼Œæˆ‘è§‰å¾—ç›¸æœºæ¨¡å‹å°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é¡¶ç‚¹ç€è‰²å™¨ï¼Œæ ¹æ®å¤–å‚å†…å‚å°†ä¸–ç•Œç³»ä¸‹çš„ç‚¹è½¬æ¢åˆ°äºŒç»´å±å¹•ä¸Šã€‚</p>
<h4 id="primitives-åŸºæœ¬å›¾å½¢">Primitives åŸºæœ¬å›¾å½¢</h4>
<p>â€‹ GPUæ¸²æŸ“ç®¡çº¿ç”¨äºæ¸²æŸ“çš„æœ€åŸºæœ¬å›¾å½¢ï¼Œæ¯”å¦‚æ ¹æ®é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºï¼Œç”Ÿæˆå¾ˆå¤šå°çš„ä¸‰è§’å½¢è¿›è¡Œåç»­å¤„ç†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›primitiveéƒ½æ˜¯ä¸å¯å†åˆ†çš„ï¼ˆatomicï¼‰ï¼Œè¿™äº›åŸºæœ¬å›¾å½¢ä¹‹åä¼šè¢«é€åˆ°ã€‚ã€‚ã€‚æ¯”å¦‚ï¼Œå…‰æ …åŒ–å™¨ï¼ˆrasterizerï¼‰ä¸­è¿›è¡Œä¸€ç§é‡‡æ ·é‡åŒ–æ“ä½œï¼ˆå› ä¸ºå±å¹•çš„è¡¨ç¤ºèƒ½åŠ›å—åˆ°äº†åˆ†è¾¨ç‡çš„é™åˆ¶ï¼‰ã€‚</p>
<h4 id="fragment-rasterizer">Fragment &amp; Rasterizer</h4>
<p>â€‹ Fragmentå¯ä»¥è®¤ä¸ºæ˜¯æ¯ä¸ªåŸºæœ¬å›¾å½¢é‡åŒ–åçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯ä¸€å †æ²¡æœ‰ç€è‰²çš„åƒç´ é›†åˆã€‚æˆ‘ä»¬çš„é‡‡æ ·é‡åŒ–ç²¾ç»†ç¨‹åº¦å°±å†³å®šäº†å›¾åƒçš„è´¨é‡ï¼Œæ¯”å¦‚è¯´ï¼šå½“æˆ‘ä»¬éœ€è¦æŠ—é”¯é½¿çš„æ—¶å€™ï¼Œå¯ä»¥æé«˜rasterizerçš„é‡‡æ ·ç²¾ç»†åº¦ï¼Œå¹¶è¾…åŠ©ç¾½åŒ–ã€‚å…‰æ …åŒ–åˆ™æ˜¯æˆ‘ä»¬è¿™æ®µæ—¶é—´æ¥è§¦è¿‡çš„å†…å®¹ï¼Œå…‰æ …åŒ–å°±æ˜¯ä¸€ç§é‡‡æ ·è¿‡ç¨‹ï¼Œå¯¹äºä¸åŒç²¾åº¦çš„æ•°æ®ï¼Œå°†å…¶é‡‡æ ·åˆ°åˆé€‚çš„åˆ†è¾¨ç‡ä¸‹ã€‚</p>
<center>
<img src="/2021/09/03/GPU-Architecture-Intros/raster.gif" style="zoom:67%;">
</center>
<center>
Figure 2. Top-left triangle rasterization rule[1]
</center>
<p>â€‹ åœ¨å…‰æ …åŒ–è¿‡ç¨‹ä¸­ï¼Œç»å¸¸é‡åˆ°çš„é—®é¢˜å°±æ˜¯ï¼šé”¯é½¿ã€‚è§£å†³é”¯é½¿é—®é¢˜å°±éœ€è¦ä¸€äº›äºšåƒç´ ç²¾åº¦çš„æ“ä½œã€‚</p>
<p>â€‹ è€Œç‰‡æ®µç€è‰²å™¨çš„ä½œç”¨åˆ™æ˜¯ï¼šå¯¹å·²ç»ç”Ÿæˆçš„rasterå›¾åƒï¼Œè¿›è¡Œæ¸²æŸ“ã€‚æ¯”å¦‚å…‰ç…§ï¼Œæ ¹æ®å…‰ç…§æ¨¡å‹æ¸²æŸ“åƒç´ çš„é¢œè‰²ï¼Œæˆ–è€…æ ¹æ®alphaé€šé“ä¿¡æ¯è¿›è¡Œç»˜åˆ¶ã€‚</p>
<h3 id="pipeline-åŠ é€Ÿæ–¹å¼">2.2 Pipeline &amp; åŠ é€Ÿæ–¹å¼</h3>
<p><img src="/2021/09/03/GPU-Architecture-Intros/pipeline.PNG"></p>
<center>
Figure 3. GPUç®€åŒ–ç®¡çº¿ç¤ºæ„å›¾
</center>
<p>â€‹ ä»CPUå¦‚ä½•åˆ°GPUï¼Ÿå¯èƒ½æ˜¯éœ€è¦æ‘’å¼ƒä¸€äº›CPUçš„è®¾è®¡æ€æƒ³çš„ï¼Œæ¯•ç«ŸCPU/GPUçš„åŠŸèƒ½éå¸¸ä¸åŒï¼Œè‡ªç„¶å°±åº”è¯¥å¯¹åº”ä¸åŒçš„ç»“æ„ï¼Œä¸åŒçš„ç»“æ„å°±ä¼šå¼•å‡ºä¸åŒçš„ç‰¹æ€§ã€‚</p>
<p>â€‹ CPUé€šå¸¸æœ‰å¾ˆå¤šé’ˆå¯¹ä¸€æ¡æŒ‡ä»¤æµç¨‹ä¼˜åŒ–çš„æ–¹å¼ï¼š</p>
<ul>
<li>å¤šçº§cacheï¼ˆprefetchingï¼‰ï¼ŒåµŒå…¥å¼è¯¾è®²è¿‡</li>
<li>åˆ†æ”¯é¢„æµ‹ï¼ˆbranchï¼‰ï¼ŒåµŒå…¥å¼ä¹Ÿè®²è¿‡</li>
<li>ä¹±åºæ‰§è¡Œï¼ˆè¿™ä¸ªåµŒå…¥å¼è¯¾ç¨‹ä¸­æ²¡æœ‰æ˜¾å¼æåˆ°ï¼Œä½†æ˜¯å®é™…ä¸Šå­˜åœ¨äºåˆ†æ”¯å¤„ç†ä¸­ï¼Œæ¯”å¦‚å°†ä¸€äº›æŒ‡ä»¤ç§»åŠ¨ä½ç½®ä»¥å¡«å……åˆ†æ”¯ï¼‰</li>
</ul>
<p>â€‹ ä½†æ˜¯è¿™äº›åœ¨GPUä¸­æ˜¾å¾—ä¸é‚£ä¹ˆé‡è¦ã€‚GPUçš„å¹¶è¡Œä»»åŠ¡é€šå¸¸éƒ½æ˜¯ï¼šå¯¹å¤§é‡æ•°æ®åšç±»ä¼¼çš„æ“ä½œï¼Œæ¯”å¦‚Fragmentæ¸²æŸ“ï¼Œæ·±åº¦å­¦ä¹ ã€‚CPUä¸­ALUèµ„æºæ˜¯æœ‰é™çš„ï¼Œæ¯æ¬¡å°±åªèƒ½å¤„ç†å‡ ä¸ªè¾“å…¥æ•°æ®ï¼Œæ˜¾ç„¶æ²¡æœ‰åŠæ³•å¾ˆå¥½åœ°å¹¶è¡Œï¼Œé‚£ä¹ˆè¿™ç§éœ€æ±‚å¾ˆå¯èƒ½è¦æ±‚æˆ‘ä»¬éœ€è¦å¤šä¸ªæ•°æ®å¤„ç†å•å…ƒï¼ˆæ¯”å¦‚ALUï¼‰ã€‚å¦‚æœæ¯ä¸ªå¤„ç†å•å…ƒï¼ˆæ¯”å¦‚ALUï¼‰éƒ½é…ç½®å¤šçº§cacheï¼Œåˆ†æ”¯é¢„æµ‹ç­‰ç­‰CPUæ ‡é…ï¼Œé‚£ä¹ˆè°æ¥æ§åˆ¶èŠ¯ç‰‡çš„é¢ç§¯ï¼Ÿè°æ¥æ§åˆ¶ä¸åŒå•å…ƒçš„åˆ†æ”¯é¢„æµ‹ï¼Ÿæ¶‰åŠåˆ°CPUçš„ä¸€äº›è€—æ—¶æ“ä½œæ€ä¹ˆåŠï¼ˆæ¯”å¦‚ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcache coherenceç­‰ç­‰ï¼‰çœ‹çœ‹ï¼š</p>
<blockquote>
<p>In computer architecture, a branch predictor is a digital circuit that tries to guess which way a branch (e.g., an ifâ€“thenâ€“else structure) will go before this is known definitively. --Wikipedia</p>
</blockquote>
<p>â€‹ ç›´æ¥å¤åˆ¶CPU coresè‚¯å®šä¼šè®©GPUå˜å¾—ç¬¨é‡ã€‚æ‰€ä»¥è¿™äº›ç‰¹æ€§å¯ä»¥éƒ½ç æ‰ã€‚</p>
<p>â€‹ é’ˆå¯¹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¦æ±‚ï¼Œæ˜¾ç„¶æœ€å¥½çš„å¤„ç†æ–¹å¼æ˜¯ï¼šå¼•å…¥SIMDï¼ˆsingle instruction multiple dataï¼‰çš„æ€æƒ³ã€‚æ¯•ç«ŸGPUæœ€å¸¸åšçš„äº‹æƒ…å°±æ˜¯è¿™ä¸ªï¼Œè¾“å…¥ä¸åŒï¼Œæ“ä½œç›¸åŒã€‚é‚£ä¹ˆè¿™å°±æ¶‰åŠåˆ°ï¼š</p>
<ul>
<li>å¤šä¸ªå¤„ç†å•å…ƒfetch/decode/executeåŒä¸€æ¡æŒ‡ä»¤</li>
<li>å¤šè·¯æ•°æ®åŒæ—¶è¾“å…¥ï¼šå–æ•°æ®ä¸å†åƒCPUå¤„ç†ä¸€æ ·ï¼Œæ¯”å¦‚è¿›è¡Œåƒç´ å¤„ç†æ—¶ï¼Œä¸€ä¸ªä¸ªä½ç½®è®¿é—®ï¼Œè€Œæ˜¯ä¸€ç»„ç»„ä½ç½®è®¿é—®ã€‚æœ‰Nä¸ªå¤„ç†å•å…ƒå°±ä¸€æ¬¡åŒæ—¶è®¿é—®Nä¸ªä½ç½®ï¼Œå–æ•°æ®ï¼Œå¯ä»¥èŠ‚çœå¤§é‡fetch dataçš„æ—¶é—´ã€‚</li>
</ul>
<p>â€‹ é‚£ä¹ˆå¯ä»¥è®¤ä¸ºï¼ŒCPUæ˜¯ä¸€ç§<strong><u>æ ‡é‡</u></strong> (literally) å¤„ç†å™¨ï¼ˆè¿™é‡Œè¯´çš„æ ‡é‡å’Œ scalar processorä¸ä¸€æ ·ï¼‰ï¼ŒGPUæ˜¯ä¸€ç§å‘é‡å¤„ç†å™¨ï¼ˆä¸€æ¬¡å¤„ç†ä¸€ä¸ªå‘é‡ï¼Œå› ä¸ºæœ‰å¤šä¸ªå¤„ç†å•å…ƒï¼‰ã€‚å°†è¿™äº›å¤„ç†å•å…ƒå½’ä¸ºä¸€ç»„ï¼ŒGPUå¯ä»¥æœ‰å¤šä¸ªè¿™æ ·çš„ç»„ã€‚ç»„é—´å¯ä»¥éµå¾ªæµæ°´çº¿è®¾è®¡ï¼ˆé¿å…é•¿æ—¶é—´é˜»æ»å¸¦æ¥çš„ååé‡ä¸‹é™ï¼‰ã€‚</p>
<p>â€‹ å½“GPUæœ‰å¤šä¸ªè¿™æ ·çš„SIMDæ ¸å¯ä»¥å¹¶è¡Œæ—¶ï¼Œå¯èƒ½å¯ä»¥æ¼”åŒ–ä¸ºMIMDã€‚å®é™…ä¸Šæœ‰äº›æ¶æ„ï¼ˆæ¯”å¦‚Nå¡ä¸­ï¼‰ï¼Œä½¿ç”¨çš„æ˜¯SIMTï¼ˆmultiple threadsï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥å­˜åœ¨ä¸åŒçº¿ç¨‹ä¸åŒåˆ†æ”¯æˆ–è€…æ˜¯éè¿ç»­è®¿é—®çš„æƒ…å†µã€‚</p>
<h3 id="æ›´å¤šå…³é”®è¯">2.4 æ›´å¤šå…³é”®è¯</h3>
<p>â€‹ å‚è€ƒåŠ å·ç†å·¥CS179 <a href="http://courses.cms.caltech.edu/cs179/2021_lectures/cs179_2021_lec02.pdf">lecture 2</a> [2]ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<hr>
<h2 id="iii.-gpuå­˜å‚¨ç»“æ„">III. GPUå­˜å‚¨ç»“æ„</h2>
<p>â€‹ GPUï¼ˆCUDAä¸ºä¾‹ï¼‰çš„å­˜å‚¨ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<center>
<img src="/2021/09/03/GPU-Architecture-Intros/structure.PNG" style="zoom:67%;">
</center>
<center>
Figure 4. GPUå­˜å‚¨ç»“æ„
</center>
<p>â€‹ å¦‚æœè¦è¯´è¿™å‡ ä¸ªä¸åŒçš„å­˜å‚¨ç©ºé—´çš„ç‰¹ç‚¹ï¼Œç½‘ä¸Šåº”è¯¥æœ‰å¾ˆå¤šä»‹ç»äº†ã€‚æ— éå°±æ˜¯ï¼š</p>
<ul>
<li>constant/textureæ˜¯å¯ä»¥ç”±hostä¿®æ”¹çš„ä¸å¯å˜å†…å­˜ï¼Œè¢«cacheæ‰äº†</li>
<li>global memoryæ˜¯host deviceå¯ä»¥å…±åŒä¿®æ”¹çš„ï¼Œæœ€æ…¢çš„å†…å­˜ï¼Œshared memoryåº”è¯¥å¤šç”¨ï¼Œå› ä¸ºé€šå¸¸å¾ˆå¿«ï¼Œshared memoryæ˜¯åŒä¸€ä¸ªblockçš„</li>
</ul>
<p>â€‹ ä¹‹å‰å¤ªå¹´è½»ï¼Œå†™CUDAç¨‹åºçš„æ—¶å€™ä¹Ÿæ²¡æœ‰ç‰¹åˆ«å»å­¦è¿‡CUDAçš„å†…å­˜ç®¡ç†ï¼Œç–¯ç‹‚ä½¿ç”¨å…¨å±€å†…å­˜ï¼Œåº”è¯¥æ˜¯ä¼šå¾ˆæ…¢çš„å§ï¼Ÿglobal memoryå€’æ˜¯æ²¡æœ‰å¤ªå¤šå¯ä»¥è¯´çš„ï¼Œæ¥ä¸‹æ¥ä¸»è¦è®²ä¸€ä¸‹shared memoryå§ã€‚</p>
<h3 id="shared-memory">3.1 Shared memory</h3>
<p>â€‹ shared memoryæ˜¯ä¸€ç§å­˜å–å¾ˆå¿«çš„å†…å­˜ï¼Œç¡¬ä»¶å®ç°ä¸L1 cacheæ˜¯ä¸€æ ·çš„ï¼ˆé‚£ä¹ˆå¯ä»¥ä½“ä¼šä¸€ä¸‹å…¶é€Ÿåº¦çº§åˆ«ï¼‰ã€‚æœ‰äº›åœ°æ–¹è¯´ï¼Œshared memoryå­˜å–åªéœ€è¦1ä¸ªå‘¨æœŸï¼Œæœ‰äº›ææ–™ï¼ˆæ¯”å¦‚åŠ å·ç†å·¥çš„PPTï¼‰è¯´æ˜¯5nsï¼ˆè¿™ä¹Ÿå¾ˆå¿«ï¼Œæ¯•ç«Ÿæˆ‘è®°å¾—GPUçš„æ—¶é’Ÿä¸€èˆ¬ä¼šæ¯”CPUæ…¢ä¸€äº›ï¼Ÿemmmï¼Œè¯´GPUæ˜¯ä½é¢‘é«˜ååç‡ï¼‰ã€‚</p>
<p>â€‹ ä½†æ˜¯shared memoryæœ‰ä¸¤ä¸ªé™åˆ¶ï¼š</p>
<ul>
<li>shared memoryç‰©ç†å®ç°ä¸L1 cacheç›¸åŒï¼Œè¿™æ„å‘³ç€shared memoryä¸å¯èƒ½å¤ªå¤§ï¼ˆSRAMå¾ˆè´µï¼‰ï¼Œå¯¹äºä¸€ä¸ªblockä¸­çš„warpsæ¥è¯´ï¼Œæ‰€æœ‰warpsä½¿ç”¨çš„å…±äº«å†…å­˜ä¸èƒ½è¶…è¿‡æ¯ä¸ªblockæ‰€å…·æœ‰çš„å†…å­˜ã€‚è¿™å°±éœ€è¦ä¸€å®šçš„ç²¾å·§è®¾è®¡ï¼šå……åˆ†åˆ©ç”¨shared memoryä½¿å¾—å°½å¯èƒ½å¤šçš„warpså·¥ä½œã€‚</li>
<li><strong><u>Bank conflictï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚</u></strong>Bank conflictå¾ˆåƒåœ¨åµŒå…¥å¼è¯¾ç¨‹ä¸­å­¦åˆ°çš„cacheå†²çªé—®é¢˜ï¼Œcacheé¢‘ç¹å†²çªä¼šå¼•èµ·cacheå†…å®¹çš„é¢‘ç¹æ“¦å†™ï¼Œç”±äºcache coherenceï¼Œå¯¼è‡´å¤šä¸ªå­˜å‚¨å™¨éœ€è¦è¢«ä¿®æ”¹ï¼Œè¿™å¾ˆä¸å¥½ã€‚è€ŒBank conflictäº§ç”Ÿåˆ™æ˜¯å¼•èµ·è¯»å†™æ“ä½œçš„å¹¶è¡ŒåŒ–ã€‚</li>
</ul>
<p>â€‹ Bank conflictçš„å®šä¹‰ï¼š</p>
<blockquote>
<p>A <strong>bank conflict</strong> occurs when 2 threads in a warp access different elements in the same bank. Shared memory is setup as 32 <strong>banks</strong></p>
</blockquote>
<p>â€‹ æ ¹æ®stackoverflowä¸Šä¸€ä¸ªä½¬å¤–â€œå¯è§†åŒ–â€çš„bankï¼ˆæˆ–è€…shared memoryåˆ†å—ï¼‰ï¼ŒåŠ å…¥æˆ‘ä»¬å‡è®¾ç®¡ç†å†…å­˜çš„å•å…ƒæ˜¯4å­—èŠ‚ï¼Œé‚£ä¹ˆï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">0-3</th>
<th style="text-align: center;">4-7</th>
<th style="text-align: center;">...</th>
<th style="text-align: center;">120-123</th>
<th style="text-align: center;">124-127</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">data</td>
<td style="text-align: center;">data</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">data</td>
<td style="text-align: center;">data</td>
</tr>
<tr class="even">
<td style="text-align: center;">data</td>
<td style="text-align: center;">data</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">data</td>
<td style="text-align: center;">data</td>
</tr>
<tr class="odd">
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
</tr>
</tbody>
</table>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œå¾ªç¯ç´¢å¼•â€çš„å­˜å‚¨ç©ºé—´ã€‚è¿ç»­çš„å­—èŠ‚æµä¼šç›´æ¥åœ¨ä¸åŒbankä¹‹é—´åˆ‡æ¢ï¼Œåˆ°æœ«å°¾bankå°±ä¼šå¾ªç¯åˆ‡å›åˆ°ç¬¬ä¸€ä¸ªbankä¸Šã€‚é‚£ä¹ˆï¼Œå½“32ä¸ªçº¿ç¨‹ï¼ˆä¸€ä¸ªwarpï¼‰æ‰€éœ€çš„å†…å­˜æ˜¯çº¿æ€§è¿ç»­çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¸ä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªbankçš„æƒ…å†µã€‚</p>
<p>â€‹ å‡è®¾æˆ‘ä»¬çš„bankè®¾ç½®å°±æ˜¯æŒ‰ç…§å¦‚ä¸Šæ–¹å¼è¿›è¡Œçš„ï¼Œå¹¶ä¸”å‡è®¾çº¿ç¨‹æ•°é‡ä¸º32ã€‚é‚£ä¹ˆå½“æ¯ä¸ªçº¿ç¨‹è®¿é—®çš„æ­¥é•¿ä¸º1æ˜¯ï¼Œæ²¡æœ‰bank conflictã€‚</p>
<p>â€‹ å½“æ­¥é•¿ä¸º2æ—¶ï¼Œæ˜¾ç„¶ï¼Œåªæœ‰ä¸€åŠçš„bankè¢«è®¿é—®ï¼Œ16ä¸ªçº¿ç¨‹ä¹‹åå°±ä¼šå¾ªç¯å›åˆ°ç¬¬ä¸€ä¸ªbankã€‚é‚£ä¹ˆæ­¤æ—¶ä¼šå¼•å‘ä¸¤è·¯å†²çªçš„bank conflictã€‚</p>
<p>â€‹ åŒç†ï¼Œæ­¥é•¿ä¸º4æ—¶ï¼Œä¼šå¼•å‘4è·¯å†²çª...</p>
<p>â€‹ å½“æ­¥é•¿ä¸º32æ—¶ã€‚æœ‰ä¸¤ç§è¯´æ³•ï¼š</p>
<ul>
<li>shared memory ä¹Ÿå­˜åœ¨broadcastæœºåˆ¶ï¼Œå¤šè·¯è®¿é—®æˆ‘ç›´æ¥å¹¿æ’­ã€‚</li>
<li>32è·¯å†²çªï¼Œè¿™ç§æƒ…å†µå®Œå…¨ä¸²è¡Œï¼Œéœ€è¦è¿›è¡Œ+1æ­¥é•¿çš„paddingã€‚</li>
</ul>
<p>â€‹ å½“å‰çš„GPUå¯¹äºbank conflictåŸºæœ¬ä¸Šéƒ½æ›´å‹å¥½ï¼Œé‡åˆ°å¤šè·¯åŒæ—¶è®¿é—®æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å¤šæ’­(multicast)æˆ–è€…å¹¿æ’­ç­–ç•¥ã€‚è¿™æ˜¯global memoryæ‰€æ²¡æœ‰çš„ã€‚</p>
<h3 id="reduction-example-sum">3.2 Reduction Example: Sum</h3>
<p>â€‹ CS179çš„lecture 7è®²äº†ä¸¤ä¸ªå¾ˆæœ‰æ„æ€çš„ä¾‹å­ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯ï¼šå¹¶è¡Œæ—¶æˆ‘å¦‚ä½•å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡Œæ±‚å’Œï¼Ÿ</p>
<p>â€‹ æ˜¾ç„¶ï¼Œè¦åˆ©ç”¨å¹¶è¡Œè®¡ç®—çš„èµ„æºï¼Œä¸¤ä¸¤æ±‚å’Œçš„è¿‡ç¨‹ä¸èƒ½é¡ºåºè¿›è¡Œï¼ˆå¦åˆ™å°±æ˜¯ä¸²è¡Œï¼‰ã€‚æ˜¾ç„¶ï¼Œæ±‚å’Œè¿‡ç¨‹å¯ä»¥åˆ†å±‚è¿›è¡Œï¼Œæ¯”å¦‚æ•°ç»„é•¿åº¦ä¸º32ï¼Œç¬¬ä¸€å±‚æˆ‘å°±å¹¶è¡Œæ‰§è¡Œ16ä¸ªä¸¤ä¸¤ç›¸åŠ ï¼Œä¿å­˜ï¼ŒåŒæ­¥ã€‚ç¬¬äºŒå±‚å°±æ‰§è¡Œ8ä¸ª...</p>
<p>â€‹ è¿™ä¾‹å­çœ‹èµ·æ¥å¾ˆç®€å•å˜›ã€‚éƒ½èƒ½æƒ³å‡ºæ¥æ€ä¹ˆåšå‘¢ï¼Œä½†å®é™…ä¸Šè¿™é‡Œå…¨æ˜¯å‘ã€‚</p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/bin1.PNG"></p>
<center>
Figure 5. ç›´æ¥äºŒåˆ†æ ‘çŠ¶åˆ†è§£å¹¶è¡Œ[3]
</center>
<p>â€‹ çœ‹èµ·æ¥ä¸é”™ã€‚ä½†æ˜¯ä¼šé‡ä¸Šä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œwarp divergenceã€‚æ˜¾ç„¶ï¼Œä¸Šå›¾ä¸­æˆ‘ä»¬å®é™…ä½¿ç”¨äº†16ä¸ªçº¿ç¨‹ï¼ˆå¥‡æ•°idçº¿ç¨‹ä»€ä¹ˆéƒ½æ²¡åšï¼Œä½†æ˜¯ç”±äºå¤„åœ¨åŒä¸€ä¸ªwarpä¸­ï¼Œè¿˜æ˜¯è¦æ‰§è¡ŒNOPï¼‰ã€‚è¿™éå¸¸ä¸å¥½ï¼Œæ„å‘³ç€æˆ‘ä»¬æ¯æ¬¡ç›¸åŠ æ“ä½œä¹‹åï¼Œè¿˜æœ‰ä¸€æ®µæ—¶é—´çš„NOPã€‚ï¼ˆå¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨æ•°é‡ä¸º16çš„warpï¼‰</p>
<p>â€‹ æ—¢ç„¶è¿™æ ·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ï¼š</p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/bin2.PNG"></p>
<center>
Figure 6. è¿ç»­çº¿ç¨‹å¹¶è¡Œ[3]
</center>
<p>â€‹ è™½ç„¶æˆ‘è§‰å¾—è¿™é‡Œæœ‰ç‚¹å¥‡æ€ªï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªå¤§å°ä¸º8çš„warpï¼Œä¹‹ååˆç”¨äº†å¤§å°ä¸º4çš„warp... å¹¶ä¸”bankçš„ç»„ç»‡å’Œæˆ‘æ¯æ¬¡ä½¿ç”¨çš„warpå¤§å°æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>â€‹ è¿™æ ·ç¡®å®å¯ä»¥é¿å…warp divergenceï¼Œä½†æ˜¯åˆä¼šå¼•èµ·æ–°çš„é—®é¢˜ï¼šbank conflictã€‚ç”±äºç¬¬ä¸€æ¬¡æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå¤§å°ä¸º8çš„blockï¼ˆå±å®ç†è§£ä¸äº†è¿™ä¸ªç»„ç»‡ï¼Œæ‰€ä»¥æˆ‘æŸ¥äº†ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Œåˆ—åœ¨äº†3.2æœ«å°¾ï¼‰ï¼Œé‚£ä¹ˆbankæ ¹æ®çº¿ç¨‹æ•°ç»„ç»‡ï¼š8ä¸ªbankï¼Œå•Šå“¦ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ­¥é•¿ä¸º2çš„2è·¯å†²çªã€‚å› ä¸ºæ­¤æ—¶ï¼Œbankä»10è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œåˆ°3ï¼Œ5ï¼ˆ5 exactlyï¼‰ä½ç½®ç»“æŸã€‚åé¢æ˜¯å¾ªç¯å›åˆ°ç¬¬ä¸€ä¸ªbankå­˜å‚¨ã€‚</p>
<p>â€‹ ç¬¬äºŒä¸ªå¾ªç¯ä¸­ï¼Œ4çº¿ç¨‹çš„blockæ˜¯4 banksï¼Œé‚£ä¹ˆç›´æ¥å¯¼è‡´äº†4è·¯å†²çª... ä¾æ­¤ç±»æ¨ã€‚</p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/bin3.PNG"></p>
<center>
Figure 7. åºåˆ—å¯»å€å¹¶è¡Œ[3]
</center>
<p>â€‹ è¿™æ ·å°±å®Œå…¨å¥½äº†ã€‚</p>
<p>â€‹ è€Œå…³äºï¼šâ€œWhat happens when threads per block is less than 32â€é—®é¢˜ï¼Œæˆ‘ä¸€ç›´è§‰å¾—è¿™é‡Œæ˜¯å­˜åœ¨warp divergenceçš„ã€‚æ¥è‡ªè¿™ä¸ªå›ç­” <a href="https://stackoverflow.com/questions/40112959/what-will-happen-if-the-number-of-threads-in-a-warp-are-less-than-32">stackoverflow/What will happen if the number of threads in a warp are less than 32?</a></p>
<blockquote>
<p>Regarding warps, it's important to remember that warp and their size is a property of the hardware. Warps are a grouping of hardware threads that execute the same instruction (these days) every cycle. In other words, the size width indicates the SIMD-style execution width, something that the programmer can not change. In CUDA you launch blocks of threads which, when mapped to the hardware, get <strong><u>executed in warp-sized bunches</u></strong>. If you start blocks with thread count that is not divisible by the warp size, the hardware will simply execute the last warp with some of the threads "<strong><u>masked out</u></strong>"</p>
</blockquote>
<p>â€‹ CUDAå®˜æ–¹çš„è®ºå›ä¸Šï¼ŒæŠ€æœ¯å¤§ä½¬è²Œä¼¼æ²¡æœ‰çœ‹æ‡‚æé—®è€…çš„é—®é¢˜ï¼Œæé—®è€…æƒ³é—®ï¼ˆå°±è·Ÿæˆ‘çš„é—®é¢˜ä¸€è‡´ï¼‰ï¼š</p>
<blockquote>
<p>I know that you can specify a block size that is less than 32, but I expect that will make part of the <strong><u>warp idle</u></strong>, and reduce resource utilization.</p>
</blockquote>
<p>â€‹ é‚£ã€‚ã€‚ã€‚è¿™äº›ä¸å°±æ˜¯warp divergenceå—ï¼Ÿé™¤éï¼ŒGPUåšäº†ä¸€äº›å®é™…çš„ä¼˜åŒ–ï¼Œå¯¹äºä¸€ä¸ªwarpä¸­æ²¡æœ‰ç”¨åˆ°çš„çº¿ç¨‹ç›´æ¥maskæ‰ï¼Œé‚£ä¹ˆç¬¬ä¸€ç§å®ç°åˆæœ‰ä½•ä¸å¯å‘¢ï¼Ÿæ„Ÿè§‰è¦ä¹ˆå°±æ˜¯è‡ªå·±æ²¡ç†è§£é€ï¼Œå†è¦ä¹ˆå°±æ˜¯è‡ªå·±æ²¡ç†è§£é€ï¼Œæœ€åè¦ä¹ˆå°±æ˜¯ è¿™ä¸ªä¾‹å­å°±æ˜¯æœ‰é—®é¢˜ï¼Œåªèƒ½å¼ºè¡Œè§£é‡Šã€‚</p>
<h3 id="parallelism-example-quick-sort">3.3 Parallelism Example: Quick sort</h3>
<p>â€‹ è¿™æ˜¯å¦ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¾‹å­ï¼šå¦‚ä½•åœ¨GPUä¸Šå¹¶è¡Œå¿«æ’ï¼Ÿ</p>
<p>â€‹ é¦–å…ˆï¼Œè€å¸ˆä»¬æŠŠè¿™ä¸ªé—®é¢˜æ‹†è§£æˆäº†ä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ï¼šæ ¹æ®æ¡ä»¶ï¼Œé€‰æ‹©å‡ºç¬¦åˆè¦æ±‚çš„æ•°ç»„å…ƒç´ å½¢æˆæ–°çš„æ•°ç»„ã€‚æ¯”å¦‚ï¼š[4, 5, 2, 5, 8, 9, 1, 0, 3, 7] é€‰å‡ºå¤§äº4çš„éƒ¨åˆ†ï¼š[5, 5, 8, 9, 7]ã€‚</p>
<p>â€‹ GPUèƒ½å¹¶è¡Œåšè¿™ä¸ªäº‹æƒ…å—ï¼Ÿå›ç­”æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸æ˜¯ä¸€æ­¥å¹¶è¡Œçš„ï¼Œå› ä¸ºè¿™ç§å¾€æ•°ç»„ä¸­ <strong><u>ä¿åº</u></strong> æ·»åŠ æ˜¯ä¸å¥½åšçš„ã€‚è¿™æ ·ä¸€ä¸ªä»»åŠ¡è¢«æ‹†è§£ä¸ºä¸‰ä¸ªä¸²è¡Œéƒ¨åˆ†ï¼š</p>
<ul>
<li>True / False æ ‡ç­¾ï¼šåˆ›å»ºä¸€ä¸ªç­‰å¤§å°çš„flagæ•°ç»„æ¥æŒ‡ç¤ºæ¯ä¸ªå…ƒç´ æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œæ»¡è¶³ä¸º1ï¼Œä¸æ»¡è¶³ä¸º0ï¼Œè¿™ä¸ªå¯ä»¥å…¨å¹¶è¡Œã€‚æ¯”å¦‚ä¾‹å­ä¸­[0, 1, 0, 1, 1, 1, 0, 0, 0, 1]</li>
<li>prefix sumï¼Œè®²flagæ•°ç»„prefix sumæ±‚å’Œï¼š[0, 1, 1, 2, 3, 4, 4, 4, 4, 5]ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œï¼ˆåˆ†çº§ï¼‰çš„ï¼ˆæ•°ç»„è®°ä½œprefixï¼‰</li>
<li>æœ€åï¼šå¹¶è¡Œè®¿é—®flagæ•°ç»„ä»¥åŠprefix sumæ•°ç»„ï¼Œå¦‚æœflag[i] = 1ï¼Œé‚£ä¹ˆåŸæ•°ç»„[i]ä¿å­˜åœ¨æ–°æ•°ç»„çš„prefix[i]-1ä½ç½®ã€‚ä¹Ÿæ˜¯å¯ä»¥å…¨å¹¶è¡Œçš„</li>
</ul>
<p>â€‹ è¿™ä»¶äº‹åšå®Œä¹‹åå°±æ˜¯æ ‡å‡†çš„å¿«æ’æµç¨‹äº†ã€‚é€‰pivotï¼Œç”šè‡³å¯ä»¥åœ¨GPUé‡Œé€’å½’ã€‚</p>
<h3 id="practical-slides">3.4 Practical slides</h3>
<p>â€‹ å¾ˆæœ‰ç”¨ï¼Œæ€»ç»“çš„ä¹Ÿå¾ˆå¥½ï¼Œæˆ‘æ²¡æœ‰äº§ç”Ÿè‡ªå·±çš„æ–°ç†è§£ï¼Œå°±ç›´æ¥æŠŠè¿™äº›slides[6]æ”¾ä¸Šæ¥å½“ä½œä¿å­˜äº†ã€‚</p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/2021-09-05%20(1).png"></p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/2021-09-05%20(2).png"></p>
<p><img src="/2021/09/03/GPU-Architecture-Intros/2021-09-05.png"></p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://en.wikipedia.org/wiki/Rasterisation">Wikipedia - Rasterization</a></p>
<p>[2] <a href="http://courses.cms.caltech.edu/cs179/2021_lectures/cs179_2021_lec02.pdf">CalTech CS 179 lecture 2</a></p>
<p>[3] <a href="http://courses.cms.caltech.edu/cs179/2021_lectures/cs179_2021_lec07.pdf">CalTech CS 179 lecture 7</a></p>
<p>[4] <a href="http://courses.cms.caltech.edu/cs179/">California Tech CS179</a></p>
<p>[5] <a href="https://www.cs.cmu.edu/afs/cs/academic/class/15462-f11/www/lec_slides/lec19.pdf">CMU/How a GPU works</a></p>
<p>[6] <a href="https://www.techylib.com/en/view/sizzlepicture/introduction_to_nvidia_cuda">Introduction to Nvidia CUDA</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>GPU</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo NexTä¸»é¢˜ æ›´å¼ºçš„è‡ªå®šä¹‰é¡µé¢</title>
    <url>/2022/02/18/Hexo-NexT%E4%B8%BB%E9%A2%98-%E6%9B%B4%E5%BC%BA%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="hexo-nextç¾åŒ–">Hexo NexTç¾åŒ–</h2>
<hr>
<p>â€‹ Hexo NexTä¸»é¢˜åšå®¢é»˜è®¤åªæœ‰ä¸€ä¸ªä¸»é¡µé¢ï¼Œè™½ç„¶å¯ä»¥åœ¨config.ymlä¸­é€‰æ‹©ä»¥å“ªä¸ªæ¿å—ä½œä¸ºä¸»é¡µé¢ï¼Œä½†å‡å¦‚æˆ‘æƒ³æœ‰å¤šä¸ªä¸åŒçš„é¡µé¢éƒ½ä¸ä¸»é¡µä¸€æ ·æœ‰é¡µé¢é¢„è§ˆï¼Œè¿˜æ˜¯éš¾ä»¥ç›´æ¥åšåˆ°çš„ã€‚ç½‘ä¸Šç¡®å®æœ‰ä¸€ç¯‡æ•™ç¨‹ï¼š<a href="https://finisky.github.io/customizecategorybyextension/">ã€Hexoæ·»åŠ è‡ªå®šä¹‰åˆ†ç±»èœå•é¡¹å¹¶å®šåˆ¶é¡µé¢å¸ƒå±€(ç®€æ´ç‰ˆ)ã€‘</a>ï¼Œæˆ‘çš„snippetæ¿å—ç¬¬ä¸€ç‰ˆå°±æ˜¯ç”¨è¿™ä¸ªæ•™ç¨‹æ­å»ºçš„ï¼Œä½†ä¹‹åå‘ç°å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚é‚£ä¹ˆåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<span id="more"></span>
<hr>
<h2 id="snippetæ¿å—ä¸ä¸»æ¿å—å…³ç³»">Snippetæ¿å—ä¸ä¸»æ¿å—å…³ç³»</h2>
<p>â€‹ Snippetæ¿å—ä¸‹çš„æ‰€æœ‰postï¼Œå…¶åˆ†ç±»ï¼ˆcategoryï¼‰éƒ½æ˜¯"snippet"ï¼Œæ ¹æ®ä¸Šæ–‡åšå®¢æåˆ°çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> realestatePosts = locals.<span class="property">posts</span>.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x.<span class="property">categories</span>.<span class="property">data</span>[<span class="number">0</span>].<span class="property">name</span> == filteredCategory;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·å¯ä»¥ç­›é€‰åˆ†ç±»ä¸º"filteredCategory"çš„åšæ–‡ï¼Œåªæ˜¾ç¤ºåœ¨Snippetæ¿å—ã€‚ä½†æ˜¯ä¸»æ¿å—ä¸Šä»ç„¶æ— æ³•é˜»æ­¢åˆ†ç±»ä¸º"filteredCategory"çš„åšå®¢æ˜¾ç¤ºï¼ˆä¸»æ¿å—ä¸Šä¸æ˜¾ç¤ºæœ€åˆç†ï¼‰ï¼Œå¼€å§‹æ—¶æˆ‘å°è¯•ä¿®æ”¹<code>.njk</code>æ–‡ä»¶ï¼Œä½†åˆ†é¡µä¼šå‡ºç°é”™è¯¯ã€‚æˆ‘åœ¨hexo-nextå¼€äº†ä¸ªissueï¼Œç‚¹å‡»ä¸‹è¿°å›¾ç‰‡ä»¥æŸ¥çœ‹ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æŠŠ<code>hexo-generator-index</code>æ›¿æ¢ä¸º<code>hexo-generator-indexed</code>ã€‚</p>
<center>
<div style="background-color: rgb(245, 245, 245); border-radius: 18px; padding: 7px;">
<a href="https://github.com/theme-next/hexo-theme-next/issues/1691"><img alt="Qries" src="/2022/02/18/Hexo-NexT%E4%B8%BB%E9%A2%98-%E6%9B%B4%E5%BC%BA%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2/link.png" style="zoom: 60%"></a>
</div>
</center>
<hr>
<h2 id="å¼ºåŒ–">å¼ºåŒ–</h2>
<p>â€‹ <a href="https://finisky.github.io/customizecategorybyextension/">ã€Hexoæ·»åŠ è‡ªå®šä¹‰åˆ†ç±»èœå•é¡¹å¹¶å®šåˆ¶é¡µé¢å¸ƒå±€(ç®€æ´ç‰ˆ)ã€‘</a>å¼€äº†ä¸€ä¸ªå¾ˆå¥½çš„å¤´ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ç¡®å®å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„æ¿å—ï¼Œå…¶ä¸­åªç•™æœ‰ç‰¹å®šåˆ†ç±»çš„åšæ–‡ï¼Œä½†æ˜¯å¤špostä¸€äº›åšæ–‡ä¼šå‘ç°è‡´å‘½é—®é¢˜ï¼š</p>
<ul>
<li>åšæ–‡æ’åºæ˜¯å€’åºçš„ï¼Œè¶Šè€çš„postæ’åœ¨è¶Šå‰é¢ã€‚é˜¿å“²ï¼Œå†å²æ–‡ä»¶çš„ç°å®æ„ä¹‰ï¼Ÿ</li>
<li>åšæ–‡ç½®é¡¶å¤±æ•ˆäº†ã€‚åœ¨<code>hexo-generator-indexed</code>ä¸­æœ‰ä¸ªè¿™æ ·çš„åŠŸèƒ½ï¼šåªéœ€è¦åœ¨markdownçš„<code>front-matter</code>ä¸­å¡«ä¸Š:<code>sticky: x</code>ï¼ˆxæ˜¯ä¼˜å…ˆçº§ï¼Œæœ€å°0æœ€å¤§100ï¼‰ï¼Œå°±ä¼šæ ¹æ®ä¼˜å…ˆçº§æ¥æ’åºï¼Œå¯ä»¥å®ç°ç½®é¡¶åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨åšå®¢çš„æ–¹æ³•ä¸‹å¤±æ•ˆäº†ã€‚æˆ‘ä»¬çœ‹çœ‹åšå®¢ä¸­æåˆ°çš„æ–¹æ³•ä»£ç ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">&#x27;hexo-pagination&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> filteredCategory = <span class="string">&#x27;snippet&#x27;</span>;</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">generator</span>.<span class="title function_">register</span>(<span class="string">&#x27;custom&#x27;</span>, <span class="keyword">function</span>(<span class="params">locals</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> realestatePosts = locals.<span class="property">posts</span>.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="property">categories</span>.<span class="property">data</span>[<span class="number">0</span>].<span class="property">name</span> == filteredCategory;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">pagination</span>(<span class="string">&#x27;snippets&#x27;</span>, realestatePosts, &#123;</span><br><span class="line">    <span class="attr">perPage</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">layout</span>: [<span class="string">&#x27;index&#x27;</span>],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>â€‹ éå¸¸plainï¼Œå°±æ˜¯è¿‡æ»¤äº†ä¸€ä¸‹æ ‡ç­¾ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æŒ‰ç…§<code>hexo-generator-indexed</code>ä¸­çš„ä»£ç ï¼ˆåœ¨hexoçš„node_moduleä¸‹å¯ä»¥çœ‹åˆ°ï¼‰ï¼Œå€Ÿé‰´å…¶<code>generator.js</code>ä¿®æ”¹äº†è¿™ä¸ªåšå®¢è¿‡æ»¤ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">&#x27;hexo-pagination&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; sort &#125; = <span class="built_in">require</span>(<span class="string">&#x27;timsort&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> filteredCategory = <span class="string">&#x27;snippet&#x27;</span>;</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">generator</span>.<span class="title function_">register</span>(<span class="string">&#x27;custom&#x27;</span>, <span class="keyword">function</span>(<span class="params">locals</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> posts = locals.<span class="property">posts</span>.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="property">categories</span>.<span class="property">data</span>[<span class="number">0</span>].<span class="property">name</span> == filteredCategory;</span><br><span class="line">  &#125;).<span class="title function_">sort</span>(<span class="string">&#x27;-date&#x27;</span>).<span class="title function_">slice</span>(<span class="number">0</span>);				<span class="comment">// å¤åˆ¶ï¼Œè€ŒéåŸåœ°æ“ä½œ</span></span><br><span class="line">  <span class="title function_">sort</span>(posts.<span class="property">data</span>, <span class="function">(<span class="params">a, b</span>) =&gt;</span> (b.<span class="property">sticky</span> || <span class="number">0</span>) - (a.<span class="property">sticky</span> || <span class="number">0</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">pagination</span>(<span class="string">&#x27;snippets&#x27;</span>, posts, &#123;</span><br><span class="line">    <span class="attr">perPage</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">layout</span>: [<span class="string">&#x27;custom&#x27;</span>],</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">__index</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿‡æ»¤ä¹‹åç«‹é©¬è°ƒç”¨timesortï¼Œæ ¹æ®æ—¥æœŸæ’åºï¼Œå†æ ¹æ®postsä¸­åšå®¢çš„<code>sticky</code>å€¼æ’åºï¼Œä¸¤å¤„éƒ½å®šä¹‰äº†åŒ¿åå‡½æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œåšå®¢ç”Ÿæˆçš„å°±æ˜¯æ­£ç¡®çš„æ’ç‰ˆã€‚</p>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Instant Neural Graphics Primitives</title>
    <url>/2022/01/23/Instant-Neural-Graphics-Primitives/</url>
    <content><![CDATA[<h1 id="instant-ngp">Instant NGP</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ ä¿ç ”å‰æ˜¯æƒ³æ3Dé‡å»ºæ¥ç€ï¼Œå¤§æ¦‚æ˜¯æ— ç¼˜å§ï¼ˆxDï¼‰ã€‚æœ€è¿‘è€è¢«å®‰åˆ© ã€5s NeRFè®­ç»ƒã€‘ï¼Œå¬èµ·æ¥å¾ˆå¼ºçš„æ ·å­ï¼Œé€Ÿåº¦æå‡äº†å¥½å‡ ä¸ªæ•°é‡çº§ï¼Œé‚è§‚æ‘©äº†ä¸€ä¸‹ï¼š</p>
<ul>
<li><a href="https://nvlabs.github.io/instant-ngp/assets/mueller2022instant.pdf"><strong>Instant Neural Graphics Primitives with a Multiresolution Hash Encoding</strong> Thomas MÃ¼ller, Alex Evans, Christoph Schied, Alexander Keller arXiv:2201.05989 [cs.CV], Jan 2022</a></li>
</ul>
<p>â€‹ æ–‡ç« å¾ˆæœ‰è¶£ï¼Œå¯¹æˆ‘ç°æœ‰å·¥ä½œæœ‰ä¸€å®šçš„å¯å‘ä»·å€¼ï¼Œå½“ç„¶ç»“æœä¹Ÿå¾ˆniceï¼š</p>
<center>
<img src="/2022/01/23/Instant-Neural-Graphics-Primitives/robot5.gif" style="zoom:125%;">
</center>
<center>
Figure 1. Hoho. Da. Nice.
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-ç®€å•åˆ†æ">II. ç®€å•åˆ†æ</h2>
<h3 id="æœ¬æ–‡åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜">2.1 æœ¬æ–‡åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜</h3>
<p>â€‹ æœ¬é¢†åŸŸæˆ‘äº†è§£å¾ˆå°‘ï¼Œåœ¨æ2D SLAMæ—¶äº†è§£è¿‡ä¸€äº›SLAMå¯¹åœ°å›¾çš„å»ºæ¨¡æ–¹å¼ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªæ–¹å¼å«åšéšå¼å‡½æ•°ï¼ˆimplicit functionsï¼‰ï¼Œæ—¨åœ¨ç”¨ä¸€ä¸ªå‚æ•°åŒ–çš„å‡½æ•°æ¥è¡¨ç¤ºä¸€ä¸ªæ›²é¢ã€‚è€Œå½“ä¸‹ç¥ç»ç½‘ç»œåº”ç”¨ç«çˆ†ï¼Œè¿™ç§å‚æ•°åŒ–çš„è¡¨é¢è¡¨å¾å½“ç„¶å¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ çš„æ–¹å¼æ¥å­¦ä¹ ã€‚æ¯”å¦‚å¦‚ä¸‹ä¸¤ç¯‡è®ºæ–‡æ‰€è¯´çš„ï¼š</p>
<blockquote>
<p>Neural SDFs are typically encoded using large, fixed-size MLPs which are expensive to render.[1]</p>
</blockquote>
<blockquote>
<p>Our algorithm represents a scene using a fully-connected (non-convolutional) deep network, whose input is a single continuous 5D coordinate (spatial location (x, y, z) and viewing direction (Î¸, Ï†)) and whose output is the volume density and view dependent emitted radiance at that spatial location.[2]</p>
</blockquote>
<p>â€‹ æœ€å®¹æ˜“ç†è§£çš„ä¾‹å­åº”è¯¥å°±æ˜¯SDFï¼ˆæœ‰å‘è·ç¦»åœºï¼‰ï¼Œä¹‹å‰ä¹Ÿåšè¿‡æœ‰å‘è·ç¦»åœºè¡¨ç¤ºçš„ç‚¹äº‘èåˆã€‚æœ‰å‘è·ç¦»åœºçš„0é›†ï¼ˆ0-æ°´å¹³é›†ï¼‰ä»£è¡¨äº†çœŸå®æ›²é¢ï¼Œè€Œæœ‰å‘è·ç¦»åœºå°±æ˜¯ç»™å®šä¸€ä¸ªdç»´è¾“å…¥ï¼ˆdç»´ç©ºé—´ä¸­çš„ä¸€ç‚¹ï¼‰ï¼Œè¾“å‡ºæ­£è´Ÿå€¼ï¼ˆåœ¨d-1ç»´æµå½¢çš„â€œå†…éƒ¨â€è¿˜æ˜¯â€œå¤–éƒ¨â€ï¼‰ã€‚é‚£ä¹ˆè¿™ä¸ªd-1ç»´æµå½¢ï¼ˆé«˜ç»´æ›²é¢ï¼‰å¯ä»¥ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è¡¨ç¤ºï¼Œæ¯•ç«Ÿç¥ç»ç½‘ç»œæ˜¯ä¸‡èƒ½çš„å‡½æ•°é€¼è¿‘å™¨ã€‚å¦‚ä¸Šå¼•ç”¨æ‰€è¯´ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªMLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰æ¥â€œæ‹Ÿåˆâ€è¿™ä¸ªSDFã€‚</p>
<p><img src="/2022/01/23/Instant-Neural-Graphics-Primitives/mlp.png"></p>
<center>
Figure 2. SDFçš„ç¥ç»ç½‘ç»œè¡¨å¾[1]
</center>
<p>â€‹ ä½†åœ¨3Dé‡å»ºé¢†åŸŸï¼Œè®­ç»ƒè¿™ä¸ªç¥ç»ç½‘ç»œè¡¨å¾å¯èƒ½éå¸¸å›°éš¾ï¼Œé¦–å…ˆæ˜¯å› ä¸ºæ•°æ®çš„ç»´åº¦æ¯”è¾ƒé«˜ï¼Œæ­¤å¤–æ˜¯è¾“å…¥é‡è¾ƒå¤§ã€‚ä¸¾ä¸ªä¾‹å­ï¼šNeRFï¼ˆNeural Radiance Fieldï¼‰éœ€è¦ä¸€ä¸ªç‰©ä½“çš„å¤šè§’åº¦è¾“å…¥å›¾åƒï¼Œä¸¤å¼ ä¸åŒå›¾è±¡ä¸Šå¯¹åº”çš„ä¸åŒåƒç´ ï¼Œå¯èƒ½å°±æ˜¯ä¸¤æ¡ä¸åŒçš„å…‰çº¿ï¼Œéœ€è¦é€šè¿‡å·²çŸ¥çš„ç›¸æœºä½å§¿ + ç”±å†…å‚ç¡®å®šçš„å…‰çº¿æ–¹å‘æ±‚è§£äº¤ç‚¹ä»¥æ±‚è§£çœŸå®çš„3Dç‚¹ï¼Œè¿™ä¸€æ­¥è®¡ç®—é‡å·²ç»å¾ˆå¤§äº†ï¼ˆä½†æŒ‰ç…§ä¸ªäººçš„ç†è§£ï¼Œè¿™ä¸€æ­¥åº”è¯¥æ˜¯ä¸ç¥ç»ç½‘ç»œæ— å…³çš„ï¼‰ï¼Œä¸‹ä¸€æ­¥åˆéœ€è¦æŠŠçœŸå®çš„3Dç‚¹ä¸ä¸åŒè§’åº¦ä¸‹çš„2Dç‚¹è”ç³»èµ·æ¥ï¼Œè®­ç»ƒã€5Dè¾“å…¥ï¼šç›¸æœºä¸­å¿ƒä½ç½® + æœ¬å›¾åƒæŸä¸€åƒç´ ç‚¹å¯¹åº”çš„å…‰çº¿ä¸¤è½´è§’åº¦ï¼ˆæ²¡æœ‰rollæ‰€ä»¥æ˜¯ä¸¤è½´ï¼‰ã€‘-&gt;ã€5Dè¾“å‡ºï¼šdensityï¼ˆç›¸å½“äºalphaé€šé“ï¼‰+ view-dependent RGBã€‘çš„è¿™æ ·ä¸€ä¸ªç½‘ç»œã€‚å¦‚æœç›´æ¥æŠŠç‚¹å€¼è¾“å…¥ï¼Œå¸Œæœ›åœ¨æŸä¸€ä¸ªå°èŒƒå›´ä¸Šç›´æ¥ç«¯åˆ°ç«¯ï¼Œé‚£å¯èƒ½éœ€è¦å¾ˆæ·±çš„MLPå±‚æ•°æ‰èƒ½å­¦åˆ°è¶³å¤Ÿå¥½çš„ç¥ç»ç½‘ç»œè¿‘ä¼¼è¡¨å¾ï¼Œè¿™æ ·çš„MLPï¼Œä¸€æ˜¯<strong><u>å¤§</u></strong>ï¼ŒäºŒæ˜¯ <strong><u>fixed-size and task dependent</u></strong>ï¼Œæ—¢ä¸å¥½è®­ç»ƒåˆæ²¡æœ‰æ™®é€‚æ€§ã€‚</p>
<p>â€‹ è€Œä½œè€…åœ¨related workä¸­ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼šattentionæœºåˆ¶ä¸­ä¸ºä½ç½®ä¿¡æ¯å¼•å…¥çš„positional embeddingså¯ä»¥ä½¿å¾—ç½‘ç»œå¾ˆå¥½åœ°ä½¿ç”¨ï¼ˆç”šè‡³å­¦å‡ºï¼‰ä½ç½®ä¿¡æ¯ã€‚æŠŠæˆ‘ä»¬çš„ä½ç»´ä¿¡æ¯embedåˆ°æŸä¸ªé«˜ç»´ç©ºé—´ï¼Œä½¿å¾—æˆ‘ä»¬éœ€è¦è®­ç»ƒçš„MLPè¾“å…¥ä¸å†æ˜¯åŸå§‹çš„æˆ–è€…ç®€å•å¤„ç†çš„æ•°æ®ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ªé«˜ç»´ç©ºé—´ä¸­å…·æœ‰è‰¯å¥½æ€§è´¨ï¼ˆæ¯”å¦‚ <strong><u>å¯æ’å€¼ï¼Œné˜¶è¿ç»­ç­‰ç­‰</u></strong>ï¼‰çš„encodingï¼Œå¯¹ç¼©å‡MLPå¤§å°éå¸¸æœ‰å¥½å¤„ã€‚åè§‚attentionæœºåˆ¶ä¸­çš„ä¸€äº›learnable positional embeddingsï¼Œä»–ä»¬çš„å®ç°ä¹Ÿä¸è¿‡å°±æ˜¯ï¼ˆä»¥torchä¸ºä¾‹ï¼‰<code>nn.Parameter</code>ï¼Œå¹¶æ²¡æœ‰è¯´è®©è¾“å…¥è¿‡ä¸€äº›æ–°çš„å±‚ï¼Œä»¥ä¸€ç§ä¸é¢å¤–å»¶é•¿forward passé•¿åº¦çš„æ–¹å¼å¢åŠ äº†å‚æ•°æ•°é‡ã€‚</p>
<p>â€‹ ä¸è¿‡å®é™…ä¸Šï¼Œç”¨å‚æ•°embeddingsè¡¨ç¤ºçš„æƒ…å†µæœ‰äººå·²ç»åšè¿‡äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘æœ‰ä¸€ä¸ªvoxel mapï¼Œå¤§å°ä¸º<span class="math inline">\(L\times W\times H\)</span>ï¼Œvoxel mapä¸­æ¯ä¸€ä¸ªç‚¹æˆ‘éƒ½ä¼šæœ‰ä¸€ä¸ªé«˜ç»´encodingã€‚ä½†ä½œè€…ä¹Ÿè¯´ï¼Œè¿™å­˜åœ¨ä¸‰ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼š</p>
<div class="note danger"><p>Memory footprint. å¦‚æœåªç”¨è¿™æ ·çš„æ–¹å¼è®¾è®¡ï¼Œå†…å­˜å¼€é”€å°†ä¼šæ˜¯<span class="math inline">\(O(n^3)\)</span>ï¼Œè¿™è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œå¾ˆå®¹æ˜“ç‚¸æ˜¾å­˜ã€‚</p>
</div>
<div class="note "><p>Trade-offå¹¶ä¸å€¼å¾—ã€‚å¦‚æœä½¿ç”¨è¿‡é‡çš„embeddingsï¼Œå¾ˆå¯èƒ½å‡ºç°ï¼šæ•´ä¸ªfeature embeddings å‚æ•°å—åªæ›´æ–°ä¸€å°éƒ¨åˆ†å‚æ•°ï¼šæ¯”å¦‚å¦‚æœæ˜¯2Dåœ°å›¾ä¸Šçš„queryï¼Œåœ¨åŒçº¿æ€§æ’å€¼çš„æƒ…å†µä¸‹éœ€è¦å–å‘¨å›´å››ä¸ªfeature vectorsï¼Œæ›´æ–°å››ä¸ªfeature vectorsï¼Œä½†MLPçš„åå‘ä¼ æ’­è¿˜æ˜¯ä¼šæ”¹åŠ¨æ•´ä¸ªMLPçš„æ‰€æœ‰å‚æ•°ï¼ŒèŠ±å¤§åŠ›æ°”å°±ä¼˜åŒ–äº†å°éƒ¨åˆ†encodingsï¼Œå¯èƒ½ä¸å€¼ã€‚</p>
</div>
<div class="note warning"><p>ç¨€ç–åŒ–ä¹Ÿä¸å¥½åšã€‚é¦–å…ˆï¼Œç¨€ç–åŒ–æ˜¯å¿…è¦çš„ã€‚æ‹¿å¦ä¸€ä¸ªé¢†åŸŸï¼ˆSLAMï¼‰ä¸­çš„ä¸€ä¸ªä¾‹å­æ¥è¯´ï¼šå ç”¨æ …æ ¼å›¾ï¼Œå¯¹äºæ²¡æœ‰ç‰©ä½“çš„åœ°æ–¹æˆ‘çœŸçš„æœ‰å¿…è¦å­˜å—ï¼Ÿæ˜¾ç„¶æˆ‘åªéœ€è¦å­˜éšœç¢ç‰©æ …æ ¼å³å¯ã€‚ä½†ç¨€ç–åŒ–å¯èƒ½å¾ˆå›°éš¾ï¼Œæ¯”å¦‚ç”¨hashæ–¹æ³•ï¼Œå¯èƒ½å“ˆå¸Œå†²çªå•Šï¼Œæ€ä¹ˆè§£å†³ï¼Ÿé“¾è¡¨ï¼Ÿå­˜åˆ°åˆ«çš„ä½ç½®çš„å†²çªå¤„ç†ï¼Ÿè¿™éå¸¸ä¸åˆ©äºGPUå¹¶è¡ŒåŠ é€Ÿã€‚</p>
</div>
<h3 id="multiresolution-grid">2.2 Multiresolution Grid</h3>
<p>â€‹ ä¸ªäººæ„Ÿè§‰è§†è§’åˆæˆæˆ–3Dé‡å»ºä¸åŒç›®åŒ¹é…ã€å…‰æµç±»ä¼¼é—®é¢˜è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œè€Œåœ¨åä¸¤è€…ä¸­ï¼Œä¸€ç§å¸¸ç”¨çš„å¤„ç†åŠæ³•å°±æ˜¯ç‰¹å¾é‡‘å­—å¡”ï¼ˆfeature pyramidï¼‰ï¼Œå…¶ä¸€èˆ¬ç›®çš„å¾ˆç®€å•ï¼šåœ¨ç‰¹å¾é‡‘å­—å¡”è¶‹äºé¡¶ç«¯ä½ç½®ï¼ˆå¤šæ¬¡ä¸‹é‡‡æ ·åï¼‰ï¼Œå¯ä»¥è¿›è¡Œç²—åŒ¹é…ï¼Œç²—åŒ¹é…å¯ä»¥ç»™å‘ä¸‹ä¸æ–­æ‰©å¤§çš„ç²¾ç»†ç‰¹å¾å›¾æä¾›åˆå€¼ï¼Œä½¿ä¹‹æ›´å®¹æ˜“æ”¶æ•›åˆ°æ­£ç¡®çš„ä½ç½®ï¼ˆåˆå€¼ä¼°è®¡ï¼‰ã€‚è€Œè§†è§’åˆæˆä¸3Dé‡å»ºä¸­ï¼Œåº”è¯¥æ²¡æœ‰è¿™ç§è¯´æ³•ã€‚ä¸ªäººå€¾å‘äºè¿™æ ·è®¤ä¸ºï¼š</p>
<ul>
<li>è€ƒè™‘ä¸€ä¸ªä¸€èˆ¬ä¸€ç»´ä¿¡å·ï¼Œæ­¤ä¿¡å·å¯ä»¥è¿›è¡Œé¢‘è°±åˆ†è§£ï¼Œå­˜åœ¨ä¸åŒé¢‘ç‡æˆåˆ†</li>
<li>å¦‚æœæˆ‘ä»¬æŠŠä½åˆ†è¾¨ç‡ï¼ˆcoarseéƒ¨åˆ†ï¼‰å½“ä½œä½é¢‘éƒ¨åˆ†ï¼Œæ­¤éƒ¨åˆ†å¯ä»¥å¤§è‡´åˆ»ç”»å±€éƒ¨è¶‹åŠ¿</li>
<li>æŠŠé«˜åˆ†è¾¨ç‡éƒ¨åˆ†ï¼ˆfineï¼‰å½“ä½œé«˜é¢‘éƒ¨åˆ†ï¼Œæ­¤éƒ¨åˆ†å¯ä»¥åˆ»ç”»å±€éƒ¨ç»†èŠ‚</li>
<li>å°±æ¯”å¦‚ä¸€åº§å±±å³°ï¼Œå…¶æ•´ä½“è¶‹åŠ¿ç”±ä½é¢‘å†³å®šï¼Œè€Œå±±å³°ä¸Šçš„å„ç§å´å²–åœ°å½¢ç”±é«˜é¢‘ éƒ¨åˆ†å†³å®š</li>
</ul>
<p>â€‹ ä¹Ÿå³ï¼Œmulti-resolution gridsæ˜¯ä¸ºäº†å…¼é¡¾ä¸åŒæ–¹é¢ï¼ˆä½åˆ†è¾¨ç‡å±€éƒ¨è¶‹åŠ¿ï¼‰ï¼ˆé«˜åˆ†è¾¨ç‡å±€éƒ¨ç»†èŠ‚ï¼‰è€Œè®¾ç½®çš„ç»“æ„ã€‚è€Œä½œè€…åœ¨æ­¤å¤„çš„è®¾è®¡æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2022/01/23/Instant-Neural-Graphics-Primitives/struct.png"></p>
<center>
Figure 3. æ•´ä½“ç»“æ„
</center>
<p>â€‹ ä½œè€…å¹¶æ²¡æœ‰ä½¿ç”¨ç¨ å¯†çš„gridç»“æ„ï¼Œç¨ å¯†çš„ç‰¹å¾gridå¼€é”€å¤ªå¤§äº†ï¼ˆæ‰€ä»¥RAFTæçš„full correlation volumeåˆ°åº•åœ¨å¹²ä»€ä¹ˆï¼‰ï¼Œä½œè€…åœ¨ä¸åŒçš„åˆ†è¾¨ç‡å±‚çº§ä¸Šå°„å‡»äº†åŒå°„æˆ–æ»¡å°„ï¼ˆåº”è¯¥æ˜¯æ»¡å°„å§ï¼‰ï¼Œä¹Ÿå³ <span class="math inline">\(f:R^2\rightarrow R\)</span>ï¼š</p>
<ul>
<li>åœ¨ä½åˆ†è¾¨ç‡å±‚çº§ä¸Šï¼Œç”±äºgridæ•°é‡æœ¬æ¥å°±è¾ƒå°‘ï¼Œé‚£ä¹ˆæ¯ä¸ªgridè¶³å¤Ÿåˆ†é…åˆ°ä¸€ä¸ªç‰¹å¾å‘é‡</li>
<li>åœ¨é«˜åˆ†è¾¨ç‡å±‚çº§ä¸Šï¼Œgridæ•°é‡å¤šï¼Œä¸ºäº†ä¸<span class="math inline">\(O(N^2)\)</span>å¤æ‚åº¦å¢åŠ ç‰¹å¾å‘é‡ï¼Œå°†æ ¹æ®åˆ†è¾¨ç‡çº¿æ€§å¢åŠ ç‰¹å¾å‘é‡æ•°ç›®ï¼Œæ­¤æ—¶å¯èƒ½å¼•å‘ <u><strong>å“ˆå¸Œå†²çª</strong></u>ã€‚</li>
</ul>
<p>â€‹ è€Œæš´åŠ›åˆ’åˆ†gridï¼Œé‡å»ºç²¾åº¦å°†ä¼šæ”¶åˆ°gridåˆ†è¾¨ç‡å½±å“ï¼Œä½œè€…ç›´æ¥ä½¿ç”¨ä¸´è¿‘ç‚¹çº¿æ€§æ’å€¼çš„æ–¹å¼è·å¾—æ›´åŠ â€œç²¾ç»†â€çš„ç‰¹å¾ï¼Œå¯æ’å€¼æ€§åœ¨æœ¬é—®é¢˜ä¸­éå¸¸æœ‰æ„ä¹‰ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªgridï¼ˆå››ä¸ªè§’ç‚¹å¯¹åº”ç›¸åŒçš„ç‰¹å¾å‘é‡indexï¼‰ä¸­ä¸¤ä¸ªä¸åŒç‚¹ç‰¹å¾å‘é‡åœ¨ç½‘ç»œè¾“å‡ºä¸Šå¹¶æ²¡æœ‰å¹³æ»‘æ€§ï¼Œé‚£ä¹ˆå°†ä¼šä½¿å­¦ä¹ åˆ°çš„å‡½æ•°ï¼ˆæ¯”å¦‚SDFæˆ–è€…radiance fieldï¼‰<strong><u>ä¸è¿ç»­</u></strong>ï¼Œ0é˜¶ä¸è¿ç»­ä»£è¡¨ç€è¡¨é¢è¿æ¥ç‰¹æ€§çš„è·³å˜ï¼Œåœ¨ä¸æ·±åº¦è§†è§‰ç›¸å…³çš„é‚»åŸŸä¸­ï¼Œ0é˜¶ä¸è¿ç»­æ˜¯å¯ä»¥å®¹å¿çš„ï¼ˆæ¯•ç«Ÿå­˜åœ¨ä¸åŒä½ç½®çš„ç‰©ä½“ä»¥åŠé®æŒ¡ï¼‰ï¼Œè€Œåœ¨å•ä¸ªç‰©ä½“è¡¨é¢é‡å»ºæˆ–è§†è§’åˆæˆä¸­å°†å¯¼è‡´ç»“æœæœ‰é—®é¢˜ã€‚è‡³äºä¸ºä»€ä¹ˆæ­¤ç»“æ„å…·æœ‰å¯æ’å€¼æ€§ï¼Œæˆ‘å°†åœ¨åæ–‡åˆ†æã€‚</p>
<p>â€‹ æœ€åä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å°†è¢«concatåœ¨ä¸€èµ·ã€‚ç”¨concatçš„ç†ç”±ï¼š</p>
<blockquote>
<p>First, it allows for independent, fully <strong><u>parallel</u> processing</strong> of each resolution. Second, a reduction of the dimensionality of the encoded result <strong>y</strong> from <em>LF</em> to <em>F</em> may be <strong><u>too small</u></strong> to encode useful information. (è¦çŸ¥é“Fæ‰2)</p>
</blockquote>
<h3 id="å“ˆå¸Œå†²çª">2.3 å“ˆå¸Œå†²çª</h3>
<p>â€‹ ä½œè€…è¯´è‡ªå·±å¹¶ä¸æ˜¾å¼å¤„ç†å“ˆå¸Œå†²çªï¼Œå› ä¸ºå“ˆå¸Œå†²çªçš„è§£å†³æ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„é€»è¾‘ï¼ˆå¹¶ä¸”åˆ¤æ–­æ˜¯æ˜¾è‘—å¢äº†ï¼‰ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€ä¸ªwrapä¸­å­˜åœ¨é€»è¾‘åˆ†æ”¯ï¼Œå°†ä¼šå¼•èµ·wrap divergenceï¼Œå¯¹äºif/elseåŒç­‰è®¡ç®—é‡éœ€æ±‚çš„æ“ä½œï¼Œå°†æŸå¤±è‡³å°‘50%çš„è®¡ç®—é€Ÿåº¦ã€‚ä½†ä¸è§£å†³å“ˆå¸Œå†²çªå°†å¯¼è‡´ <strong><u>ä¸¤ä¸ªä¸ç›¸çš„gridï¼ˆç”šè‡³å¯èƒ½ç‰©ç†è·ç¦»å°±å¾ˆè¿œï¼‰</u></strong>æ˜ å°„åˆ°åŒä¸€ä¸ªç‰¹å¾å‘é‡ä¸Šï¼ˆhashå‡ºæ¥çš„indexæ˜¯ä¸€è‡´çš„ï¼‰ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œè¿™å°†å¯¹åå‘ä¼ æ’­è¿‡ç¨‹äº§ç”Ÿå½±å“ï¼ˆä¸€ä¸ªç‰¹å¾å‘é‡åŒæ—¶åœ¨å¤šä¸ªä¸ç›¸å…³çš„ä½ç½®è´¡çŒ®lossï¼‰ã€‚è€Œå®é™…æƒ…å†µä¸­æ²¡æœ‰å½±å“ä¸»è¦æœ‰è¿™ä¹ˆä¸‰ä¸ªåŸå› ï¼š</p>
<div class="note "><p>â€‹ Multi-resolution ç»“æ„ã€‚æˆ‘ä»¬å·²ç»æåˆ°ï¼Œï¼ˆ1ï¼‰ä½åˆ†è¾¨ç‡å†³å®šäº†å±€éƒ¨è¶‹åŠ¿ï¼ˆ2ï¼‰ä½åˆ†è¾¨ç‡è¶³å¤ŸåŒå°„ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½åˆ†è¾¨ç‡å†³å®šçš„å±€éƒ¨è¶‹åŠ¿å°±å¯ä»¥ä¿è¯æ­£ç¡®æ€§ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰å¯èƒ½äº§ç”Ÿå“ˆå¸Œå†²çªçš„åˆ†è¾¨ç‡å±‚çº§åŒæ—¶äº§ç”Ÿå“ˆå¸Œå†²çªæ˜¯â€œstatistically very unlikely to occur simultaneouslyâ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥çœ‹é«˜åˆ†è¾¨ç‡ä¸‹å“ˆå¸Œå†²çªæ—¶å…·ä½“çš„å­¦ä¹ è¿‡ç¨‹ã€‚</p>
</div>
<div class="note "><p>â€‹ ã€è¿™éƒ¨åˆ†æˆ‘æ„Ÿè§‰ä½œè€…æœ‰ç‚¹å¼ºè¡Œè§£é‡Šã€‘ï¼šæ¢¯åº¦åŠ æƒå¹³å‡ã€‚ä½œè€…è®¤ä¸ºï¼Œå³ä½¿ä¸¤ä¸ªä¸å…³è”ç‚¹Aï¼ŒBæ‹¥æœ‰åŒä¸€ä¸ªç‰¹å¾å‘é‡ï¼ŒAï¼ŒBæœ€ç»ˆè´¡çŒ®ç»™lossçš„å¤§å°ä¹Ÿå‡ ä¹ä¸å¯èƒ½ç›¸åŒã€‚æ¯”å¦‚Aæ¥è¿‘ç‰©ä½“è¡¨é¢ï¼ŒBåœ¨empty spaceä¸­ï¼Œé‚£ä¹ˆæœ€ålosså¾ˆå¯èƒ½ä¼šæ›´å€¾å‘äºç»™Aæ›´å¤§çš„æƒé‡ï¼Œé€ æˆï¼šåŒæ ·ä¸€ä¸ªç‰¹å¾å‘é‡äº§ç”Ÿçš„ä¸¤ä»½ä¸åŒæ¢¯åº¦ï¼ŒAçš„æ¢¯åº¦æ–¹å‘å ä¸»å¯¼åœ°ä½ã€‚æœ€åç½‘ç»œä¹Ÿä¼šè‡ªè¡Œå‘ä¸Aç›¸å…³çš„æ–¹å‘ä¼˜åŒ–ã€‚</p>
</div>
<p>â€‹ ä½†è‹¥è€ƒè™‘åˆ°äº§ç”Ÿå¤šæ¬¡å“ˆå¸Œå†²çªçš„æƒ…å†µï¼Œä¸ªäººè§‰å¾—å¾ˆæœ‰å¯èƒ½äº§ç”Ÿå“ˆå¸Œå†²çªçš„è¿™äº›ç‚¹å„è‡ªå¯èƒ½çš„æƒé‡ <strong><u>ä¹Ÿéšæœºæ•£å¸ƒåœ¨ç©ºé—´ä¸­</u></strong>ï¼Œé‚£æœ€ååˆæˆå‡ºæ¥çš„æ¢¯åº¦å®é™…ä¸Šæ˜¯ä¸ªå››ä¸åƒæ¢¯åº¦... è¿˜æ˜¯æœ‰å¯èƒ½äº§ç”Ÿå¥‡æ€ªè¾“å‡ºçš„ï¼Œåªä¸è¿‡â€œstatistically very unlikely to occurâ€ç½¢äº†ã€‚äºå…¶è¯´æ˜¯ï¼šâ€œimplicit hash collision resolutionâ€ï¼Œä¸å¦‚è¯´æ˜¯ï¼šæˆ‘å‘ç°ä¸è§£å†³å“ˆå¸Œå†²çªæœ¬æ¥å°±åŸºæœ¬ä¸å¯èƒ½æœ‰å•¥é—®é¢˜ã€‚æˆ‘ä¸ªäººå¯¹è¿™ç§å¤„ç†æ–¹æ³•çš„çœ‹æ³•æ˜¯ï¼šâ€œmostly elegant, statistically unlikely to be inelegantâ€ã€‚</p>
<h3 id="å¯æ’å€¼æ€§ä¸å¹³æ»‘æ€§">2.4 å¯æ’å€¼æ€§ä¸å¹³æ»‘æ€§</h3>
<p>â€‹ ç¬”è€…å·²ç»åœ¨ä¸Šæ–‡è§£é‡Šè¿‡äº†ï¼Œå¯æ’å€¼æ€§æ˜¯<strong><u>éå¸¸é‡è¦</u></strong>çš„ã€‚ä½†æœ¬è®¾è®¡ä¸ºä»€ä¹ˆä¼šå­˜åœ¨è¿™ç§å¯æ’å€¼æ€§ï¼Ÿæœ‰å¦‚ä¸‹å‡ ä¸ªç–‘é—®ï¼š</p>
<ul>
<li>æ­¤è®¾è®¡æ˜¯å¤©ç„¶å…·æœ‰å¯æ’å€¼æ€§ï¼ˆå°±åƒCNNçš„å¹³ç§»ä¸å˜æ€§ä»¥åŠtransformerçš„ç½®æ¢ä¸å˜æ€§ï¼‰è¿˜æ˜¯éœ€è¦é å…¶ä»–äººä¸ºæ­¥éª¤çš„è®¾è®¡ä½¿å…¶å…·æœ‰å¯æ’å€¼æ€§ï¼Ÿ</li>
<li>å¦‚æœæ˜¯åè€…ï¼Œè¿™ç§å¥‡å¦™åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li>
<li>å¦‚æœä¸ä»…ä»…éœ€è¦è¿ç»­ï¼Œè¿˜éœ€è¦å¯å¯¼çš„å¹³æ»‘è¡¨é¢ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</li>
</ul>
<p>â€‹ ä½œè€…è¯´ï¼š</p>
<blockquote>
<p>Interpolating the queried hash table entries ensures that the encoding enc(x; Î¸), and by the chain rule its composition with the neural network m(enc(x; Î¸); Î¦), are continuous.</p>
</blockquote>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œmulti-resolution hash table æœ¬èº«æ˜¯æ²¡æœ‰å¯æ’å€¼æ€§çš„ï¼Œæ­£æ˜¯å› ä¸ºæˆ‘çš„æ’å€¼æ“ä½œä½¿å¾—ç½‘ç»œå…·æœ‰äº†å¯æ’å€¼æ€§ã€Counter-intuitiveã€‘ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p>
<p>â€‹ å¯¹äºä½åˆ†è¾¨ç‡å±‚çº§æ¥è¯´ï¼Œå¯èƒ½å¾ˆå¤šè¾“å…¥ç‚¹éƒ½è½äºä¸€ä¸ªgridï¼ˆæˆ–è€…voxelï¼‰å†…éƒ¨ï¼Œè¿™æ—¶è¿™äº›ç‚¹å°†ä¼šå…±ç”¨gridï¼ˆæˆ–è€…voxelï¼‰çš„è§’ç‚¹indexï¼Œä¹Ÿå°±æ˜¯æ’å€¼æ‰€ä½¿ç”¨çš„ç‰¹å¾å‘é‡ç´¢å¼•ã€‚ç”±äºå¯ä»¥è®¤ä¸ºï¼Œè¾“å…¥ç‚¹åœ¨ç©ºé—´ä¸Šä¸´è¿‘ï¼Œè¾“å‡ºç»“æœä¹Ÿè¦æ±‚éœ€è¦åœ¨ç©ºé—´ä¸Šä¸´è¿‘ã€‚ä¸¾ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘éœ€è¦æ ¹æ®2Då›¾åƒæ¢å¤3Dæ¨¡å‹ï¼Œé‚£ä¹ˆ2Dè¾“å…¥ç‚¹ä¸´è¿‘å¯¹äºä¸€ä¸ªåŸæœ¬è¿ç»­çš„å½¢ä½“ï¼Œåº”è¯¥å°±æ˜¯è¿ç»­çš„ï¼ˆå¯¹äºåŸæœ¬å°±æ˜¯ä¸è¿ç»­çš„å½¢ä½“åˆ™å¦è¯´ï¼‰ã€‚é‚£ä¹ˆï¼Œç½‘ç»œæ ¹æ®A,B,Cå‡ ä¸ªç‚¹æ’å€¼åçš„ç‰¹å¾çš„ç›¸ä¼¼æ€§ï¼Œç»“åˆè¾“å‡ºç»“æœåœ¨ç›‘ç£ä¸‹çš„ground truthç›¸ä¼¼æ€§ï¼Œå°±èƒ½æ¨å‡ºæ­¤å±€éƒ¨æ˜¯å¦åº”è¯¥å…·æœ‰å¯æ’å€¼æ€§ï¼š</p>
<ul>
<li>ä¸´è¿‘è¾“å…¥å¯¼è‡´ä¸´è¿‘ä»¥åŠç›¸ä¼¼è¾“å‡º --- è¯´æ˜æ˜¯å¯æ’å€¼çš„ï¼Œ<strong><u>æ˜ å°„å‡½æ•°è¿ç»­</u></strong></li>
<li>ä¸´è¿‘è¾“å…¥å¯¼è‡´ç»“æœå·®åˆ«å¤§æˆ–è€…ä¸ç›¸ä¼¼ --- è¯´æ˜å±€éƒ¨ä¸å¯æ’å€¼ï¼ˆå¯èƒ½åˆ†å±ä¸åŒç‰©ä½“æˆ–è€…æ˜¯ä¸€ä¸ªç‰©ä½“çš„å‡ ä¸ªåˆ†ç«‹å­åŸä»¶ï¼‰ï¼Œå…è®¸æ˜ å°„å‡½æ•°ä¸è¿ç»­</li>
</ul>
<p><img src="/2022/01/23/Instant-Neural-Graphics-Primitives/bunny.png"></p>
<center>
Figure 4. å¯æ’å€¼æ€§å›¾ç¤ºï¼ˆå›¾æº Stanford bunnyï¼‰
</center>
<p>â€‹ å­¦ä¹ è¿ç»­æ€§è¿˜æ˜¯è¾ƒä¸ºç®€å•çš„ï¼Œåªéœ€è¦è®¾ç½®ç›¸åº”çš„ç›‘ç£ã€ç›¸ä¼¼/è¿‘è¾“å…¥ã€‘--&gt; ã€ç›¸ä¼¼/è¿‘è¾“å‡ºã€‘ã€‚è€Œå¯¹äºé«˜é˜¶å¹³æ»‘ï¼Œæ¯”å¦‚SDFå°±è¦æ±‚ä¸€é˜¶ï¼ˆå¯¼ï¼‰è¿ç»­ï¼ˆä»£è¡¨ç€å¯å¯¼ï¼‰ä½œè€…è¯´æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">äºŒæ¬¡æˆ–ä¸‰æ¬¡æ’å€¼</a></li><li class="tab"><a href="#span-unique-name-2">æ’å€¼è¿‘ä¼¼å‡½æ•°</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>åŒäºŒæ¬¡ä»¥åŠåŒä¸‰æ¬¡æ’å€¼å¯ä»¥ä½¿å¾—å¯¼æ•°ä¸å†æ˜¯å‘ˆå—çŠ¶çš„ï¼Œè€Œæ˜¯è¿ç»­çš„ã€‚ä½†æ˜¯éœ€è¦çš„lookupæˆæœ¬å˜é«˜äº†ï¼Œå°±æ‹¿åŒä¸‰æ¬¡æ’å€¼æ¥è¯´ï¼ŒåŒä¸‰æ¬¡æ’å€¼éœ€è¦ä¸€æ¬¡é‡‡æ ·16ä¸ªç‚¹çš„ç‰¹å¾å‘é‡ï¼Œè€ŒåŒçº¿æ€§åªéœ€è¦å››ä¸ªç‚¹ï¼Œæ”¾åœ¨3ç»´ç©ºé—´ä¸­å¼€é”€æ›´åŠ éš¾ä»¥æ¥å—ã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p><span class="math display">\[
\begin{align}
&amp;S(x)=x^2(3-2x)\\
&amp;S&#39;(x)=6x(1-x)
\end{align}
\]</span> â€‹ ä½œè€…æ¨èè¿™æ ·çš„æ’å€¼å…¬å¼ï¼Œåœ¨åŒï¼ˆä¸‰ï¼‰çº¿æ€§æƒ…å†µä¸‹åªé‡‡æ ·4ï¼ˆ8ï¼‰ä¸ªç‚¹ï¼Œåˆå¯ä»¥ï¼š</p>
<blockquote>
<p>The derivative of the smoothstep vanishes at 0 and at 1, causing the discontinuity in the derivatives of the encoding to vanish by the chain rule.</p>
</blockquote>
<p>â€‹ æ„æ€æ˜¯ï¼šå¯¼æ•°åœ¨0ï¼Œ1ï¼ˆä¹Ÿå°±æ˜¯æ’å€¼è¾¹ç•Œå¤„ï¼‰ä¸º0ï¼Œæ ¹æ®é“¾å¼æ±‚å¯¼çš„å¯¼æ•°ç›¸ä¹˜ï¼Œä½¿å¾—è¾¹ç•Œç‚¹çš„å¯¼æ•°ä¸º0ã€‚ä¹Ÿå³ä¸ä¼šå› ä¸ºçº¿æ€§æ’å€¼è¿™æ ·åœ¨è¾¹ç•Œå‡ºç°å¯¼æ•°ä¸è¿ç»­çš„æƒ…å†µã€‚æ„Ÿè§‰æœ‰ç‚¹å¦™ã€‚</p></div></div></div>
<hr>
<h2 id="iii.-å…¶ä»–åç»­">III. å…¶ä»–åç»­</h2>
<p>â€‹ ç¬”è€…è¿‘å‡ å¤©å›åˆ°å®¶æ²¡æœ‰å¯ç”¨è®¾å¤‡æ¥è®­ç»ƒï¼Œæƒ³è¯•è¯•demoä½†æ²¡æœ‰åŠæ³•ã€‚ç¬”è€…ä¹‹åå¯èƒ½å†™ä¸€ç¯‡æœ¬æ–‡å®˜æ–¹å®ç°çš„æºç åˆ†æï¼Œæš‚å®šåº”è¯¥æ˜¯ã€ŠCUDAè¸©å‘å®å½•ã€4ã€‘ã€‹çš„å†…å®¹ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://arxiv.org/pdf/2003.08934.pdf">Mildenhall, Ben, et al. "Nerf: Representing scenes as neural radiance fields for view synthesis." <em>European conference on computer vision</em>. Springer, Cham, 2020</a></p>
<p>[2] <a href="https://openaccess.thecvf.com/content/CVPR2021/papers/Takikawa_Neural_Geometric_Level_of_Detail_Real-Time_Rendering_With_Implicit_3D_CVPR_2021_paper.pdf">Takikawa, Towaki, et al. "Neural geometric level of detail: Real-time rendering with implicit 3D shapes." <em>Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>. 2021.</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>3Dé‡å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>LaTexåŸºç¡€è¯­æ³•è®°å½•</title>
    <url>/2021/02/05/LaTex%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h1 id="latexåŸºç¡€è¯­æ³•è®°å½•"><span class="math inline">\(\LaTeX{}\)</span>åŸºç¡€è¯­æ³•è®°å½•</h1>
<hr>
<h2 id="ä¸€äº›å…³é”®è¯">ä¸€äº›å…³é”®è¯</h2>
<p><strong><code>\lipsum</code></strong></p>
<p>â€‹ <code>\lipsum</code>æ˜¯å®åŒ…<code>&#123;lipsum&#125;</code>ä¸­çš„å‘½ä»¤ï¼Œç”¨äºç”Ÿæˆéšæœºçš„æ–‡æœ¬ã€‚ä¸€èˆ¬ç”¨äºæ¨¡æ¿çš„æ¼”ç¤ºã€‚</p>
<p>â€‹ å¯¹äºå®åŒ…è€Œè¨€ï¼Œå¯ä»¥ä½¿ç”¨<code>\usepackage</code>è°ƒç”¨</p>
<p><strong>å€¾æ–œä¸åŠ ç²—</strong></p>
<p>â€‹ <code>\emph&#123;% text %&#125;</code>æ˜¯å°†textå˜ä¸ºæ–œä½“ï¼Œä½†æ˜¯<code>\emph&#123;&#125;</code>é€‚åˆå•è¡Œï¼Œ<code>\em ... \em</code>å›å¯¹ä¸¤ä¸ªæˆå¯¹çš„<code>\em</code>ä¹‹é—´çš„æ‰€æœ‰å­—ä½“ï¼ˆåŒ…æ‹¬æ ‡é¢˜ï¼‰è¿›è¡Œæ–œä½“åŒ–ã€‚</p>
<p>â€‹ <code>\textbf</code>æ˜¯ æ–‡å­—ç²—ä½“ï¼ˆtext bold fontï¼‰<span class="math inline">\(\textbf{Like: Test}\)</span> &lt;-&gt; <span class="math inline">\(\text{Like: test}\)</span>ã€‚</p>
<p>â€‹ <code>\mathbf</code> æ˜¯texä¸­çš„æ•°å­¦ç²—ä½“ï¼Œ<span class="math inline">\(\text{vector }\mathbf{a,b,A}\)</span></p>
<p>â€‹ <code>\pmb</code> æ˜¯ç²—æ–œä½“ï¼š<span class="math inline">\(\pmb{b}=\pmb{Ax}\)</span></p>
<p><strong>å…¶ä»–å¸¸ç”¨æ“ä½œ</strong></p>
<p>ï¼ˆ1ï¼‰å­—ä½“å¤§å°æ›´æ¢ (å®šæ€§) <span class="math display">\[
\begin{align}
&amp;\tiny \text{\tiny font for the things I have written. 1234567890}\\
&amp;\scriptsize  \text{\scriptsize font for the things I have written. 1234567890}\\
&amp;\small \text{\small font for the things I have written. 1234567890}\\
&amp;\normalsize  \text{\normalsize font for the things I have written. 1234567890}\\
&amp;\large \text{\large font for the things I have written. 1234567890}\\
&amp;\Large \text{\Large font for the things I have written. 1234567890}\\
&amp;\LARGE \text{\LARGE font for the things I have written. 1234567890}\\
&amp;\huge \text{\huge font. 1234567890}\\
&amp;\Huge \text{\Huge font. 1234567890}\\
\end{align}
\]</span> â€‹ ä½¿ç”¨ä¸€äº›å¸¸ç”¨çš„å¤§å°æè¿°è¯å³å¯ã€‚</p>
<p>ï¼ˆ2ï¼‰å­—ä½“å¤§å°æ›´æ¢ï¼ˆå®šé‡ï¼‰</p>
<p>â€‹ <code>\fontsize</code>æ˜¯å¯ä»¥è°ƒæ•´å­—ä½“å¤§å°çš„ï¼Œä½†è²Œä¼¼ä¸æ˜¯å¾ˆå¥½ç”¨ã€‚å¯¹äºå…¬å¼<code>\begin&#123;align&#125;</code>ä»¥åŠ<code>\emph</code>ä¸­çš„å­—ä½“å¤§å°å¯ä»¥è¿›è¡Œæ›´æ”¹ï¼Œä½†æ˜¯å¯¹äº<code>\text</code>å†…éƒ¨çš„å­—ä½“ï¼Œæ— æ³•å¾ˆå¥½åœ°ä¿®æ”¹ã€‚</p>
<p>ï¼ˆ3ï¼‰å­—ä½“åˆ‡æ¢ï¼š <span class="math display">\[
\begin{align}
\sf {\text{That is the most wonderful thing I know. \sf} } \\
\tt {\text{That is the most wonderful thing I know. \tt}} \\
\rm {\text{That is the most wonderful thing I know. \rm}}
\end{align}
\]</span> â€‹ <code>\sf</code> ä¸ºsans-serifå­—ä½“é›†åˆï¼Œ<code>\tt</code>ä¸ºtypewriterå­—ä½“ï¼Œ<code>\rm</code>ä¸ºç½—é©¬å­—ä½“é›†ã€‚</p>
<p>ï¼ˆ4ï¼‰çŸ©é˜µçš„ä¹¦å†™</p>
<ul>
<li><code>matrix</code>: æ— æ¡†matrix</li>
<li><code>pmatrix</code>: åœ†æ‹¬å·matrix</li>
<li><code>vmatrix</code>: è¡Œåˆ—å¼matrix</li>
<li><code>bmatrix</code>ä¸<code>Bmatrix</code>: ä¸­æ‹¬å·matrixä¸å¤§æ‹¬å·matrix</li>
</ul>
<p><span class="math display">\[
\begin{pmatrix}\label{mats}
1,0,0\\
0,1,0\\
0,0,1
\end{pmatrix},
\begin{pmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{pmatrix},
\begin{matrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{matrix},
\begin{bmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{bmatrix},
\begin{vmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{vmatrix},
\begin{Bmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{Bmatrix}
\]</span></p>
<p>ï¼ˆ5ï¼‰å…¶ä»–å¸¸ç”¨å‘½ä»¤</p>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 29%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\newpage</code></td>
<td>ç›´æ¥æ¢é¡µï¼ˆç›¸å½“äºhtmlçš„ div alwaysï¼‰</td>
<td>markdownä¸æ”¯æŒ</td>
</tr>
<tr class="even">
<td><code>\item</code></td>
<td>åˆ†ç‚¹ï¼ŒåŠ å°åœ†ç‚¹</td>
<td><code>\begin&#123;itemize&#125; \item ... \item ...  \end&#123;itemize&#125;</code></td>
</tr>
<tr class="odd">
<td><code>\section&#123;name&#125;</code></td>
<td>ä¸€çº§æ ‡é¢˜ï¼ˆ1. ï¼‰</td>
<td><code>\section&#123;Header&#125;</code></td>
</tr>
<tr class="even">
<td><code>\subsection&#123;name&#125;</code></td>
<td>äºŒçº§æ ‡é¢˜ï¼ˆ1.1.ï¼‰</td>
<td><code>\subsection&#123;Header&#125;</code></td>
</tr>
<tr class="odd">
<td><code>\subsubsection&#123;n&#125;</code></td>
<td>ä¸‰çº§æ ‡é¢˜ï¼ˆ1.1.1.ï¼‰</td>
<td><code>\subsubsection&#123;Header&#125;</code></td>
</tr>
<tr class="even">
<td><code>\begin&#123;Lemma&#125;</code></td>
<td>å¼•ç†å¼€å§‹</td>
<td><code>\begin&#123;Lemma&#125; \label&#123;name&#125;... \end&#123;Lemma&#125;</code></td>
</tr>
<tr class="odd">
<td><code>\begin&#123;Theorem&#125;</code></td>
<td>å®šç†å¼€å§‹</td>
<td><code>\begin&#123;Theorem&#125; \label&#123;name&#125;... \end&#123;Theorem&#125;</code></td>
</tr>
<tr class="even">
<td><code>\eqref</code></td>
<td>å…¬å¼å¼•ç”¨ï¼Œç›¸å½“äºè®¾ç½®å†…éƒ¨é“¾æ¥</td>
<td><span class="math inline">\(\eqref{mats}\)</span>ï¼Œ<code>\eqref&#123;mats&#125;</code></td>
</tr>
<tr class="odd">
<td><code>\ref</code></td>
<td>éå…¬å¼å¼•ç”¨</td>
<td><span class="math inline">\(\ref{mats}\)</span>ï¼Œ<code>\ref&#123;mats&#125;</code></td>
</tr>
<tr class="even">
<td><code>\url</code></td>
<td>é“¾æ¥</td>
<td><code>\url&#123;http://www.latexstudio.net/&#125;</code></td>
</tr>
<tr class="odd">
<td><code>\eqno</code></td>
<td>åœ¨éç¼–å·æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¿›è¡Œç¼–å·</td>
<td><code>\eqno&#123;(1)&#125;</code>ï¼Œ<code>\eqno</code>å¯ä»¥æ— è§†åŸæœ‰çš„æ ‡å·ï¼Œå¹¶ä¸”æ”¯æŒå­—ç¬¦ä¸²</td>
</tr>
<tr class="even">
<td><code>\vspace&#123;&#125;</code></td>
<td>æ’å…¥ç«–ç›´æ–¹å‘çš„ç©ºè¡Œ</td>
<td>æ¯”å¦‚<code>\vspace&#123;\parskip&#125;</code>ï¼Œè·³è¿‡çš„è·ç¦»ç›¸å½“äºä¸¤ä¸ªæ®µè½ä¹‹é—´çš„è·ç¦»</td>
</tr>
<tr class="odd">
<td><code>\textcolor[rgb]&#123;r,g,b&#125;</code></td>
<td>ä¿®æ”¹å­—ä½“é¢œè‰²</td>
<td><span class="math inline">\(\textcolor[rgb]{0,0,1}{1,2,3}\)</span>.<code>$\textcolor[rgb]&#123;0,0,1&#125;&#123;1,2,3&#125;$</code></td>
</tr>
</tbody>
</table>
<ul>
<li>å¯¹äºå¼•ç”¨è€Œè¨€ï¼Œæåˆ°å…¬å¼å°±éœ€è¦è¿›è¡Œ<code>\eqref</code>ï¼Œå…¶ä»–çš„å¦‚è§figure xï¼Œä¹Ÿéœ€è¦ç”¨åˆ°<code>\ref</code></li>
</ul>
<hr>
<h2 id="å›¾ç‰‡æ“ä½œ">å›¾ç‰‡æ“ä½œ</h2>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[h]		<span class="comment">% å¦‚æœæ²¡æœ‰[h] LaTexå¯èƒ½ä¼šè‡ªåŠ¨æ’ç‰ˆ</span></span><br><span class="line"><span class="keyword">\centering</span>				<span class="comment">% ä¸€èˆ¬éƒ½æ˜¯éœ€è¦å±…ä¸­çš„</span></span><br><span class="line"><span class="keyword">\includegrahics</span>[width=xxcm]&#123;name<span class="built_in">_</span>of<span class="built_in">_</span>the<span class="built_in">_</span>pic.jpg&#125;</span><br><span class="line"><span class="keyword">\caption</span>&#123;test the fig&#125; <span class="keyword">\label</span>&#123;fig:test1&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æŒ‰ç…§ä»¥ä¸Šè¯­æ³•å¯ä»¥æ’å…¥ä¸€å¼ å›¾ç‰‡ï¼Œå¹¶ä¸”ï¼Œå¯¹äºç¬¬ä¸‰è¡Œçš„include graphicsï¼Œä¼šæŒ‰ç…§å®½åº¦è‡ªåŠ¨æ¨ªå‘ï¼Œç«–å‘ç¼–æ’ã€‚å¦‚æœéœ€è¦å¤šå›¾ï¼Œå¯ä»¥å¤šä¸ª<code>\includegraphics</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å­å›¾ï¼šä¸»è¦æ˜¯minipageçš„ä½¿ç”¨ä¸subfigure</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="comment">% latex ç«–æ’æ“ä½œ</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[h]</span><br><span class="line"><span class="keyword">\centering</span></span><br><span class="line"><span class="keyword">\subfigure</span>[line1]&#123;</span><br><span class="line"><span class="keyword">\begin</span>&#123;minipage&#125;[b]&#123;0.23<span class="keyword">\linewidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">\subfigure</span>[line2]&#123;</span><br><span class="line"><span class="keyword">\begin</span>&#123;minipage&#125;[b]&#123;0.23<span class="keyword">\linewidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">\subfigure</span>[line3]&#123;</span><br><span class="line"><span class="keyword">\begin</span>&#123;minipage&#125;[b]&#123;0.23<span class="keyword">\linewidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">\subfigure</span>[line4]&#123;</span><br><span class="line"><span class="keyword">\begin</span>&#123;minipage&#125;[b]&#123;0.23<span class="keyword">\linewidth</span>&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\linewidth</span>]&#123;4.jpg&#125;<span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">\caption</span>&#123;multiple dogs&#125; <span class="keyword">\label</span>&#123;fig:dogs&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/02/05/LaTex%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AE%B0%E5%BD%95/dogs.JPG"></p>
<h3 id="ç›¸å…³ä»£ç ç†è§£">ç›¸å…³ä»£ç ç†è§£</h3>
<p>â€‹ <code>\subfigure[name]&#123;&#125;</code> èŠ±æ‹¬å·å†…çš„å†…å®¹ä¸æ™®é€šçš„<code>\begin&#123;figure&#125;[xxx]</code>å†…éƒ¨çš„å†…å®¹æå…¶ç›¸ä¼¼ï¼Œç”šè‡³å¯ä»¥ä¸€æ ·ã€‚æ¯”å¦‚è¯´æˆ‘ä¸éœ€è¦å¤šå›¾ï¼ˆä¸Šè¿°ä»£ç æ˜¯4*4 å¤šå›¾æ˜¾ç¤ºçš„æƒ…å†µï¼‰ï¼Œæˆ‘åªéœ€è¦æ¯åˆ—ä¸€å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆminipageå®Œå…¨ä¸éœ€è¦ä½¿ç”¨ï¼ˆ<code>\minipage</code>ç›¸å½“äºå°†é¡µé¢åˆ†å‰²ä¸ºæ›´å°çš„é¡µé¢ï¼‰ã€‚åªéœ€æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¹¦å†™å³å¯ï¼š</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\subfigure</span>[name]&#123;</span><br><span class="line">	<span class="keyword">\includegraphics</span>[width=xxxcm]&#123;name.jpg&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯¹äº<code>\minipage</code>çš„è®¾ç½®ï¼Œ<code>\begin&#123;minipage&#125;[b]&#123;0.23\linewidth&#125;</code>å…¶ä¸­<code>[b]</code>å¯èƒ½ä¸ä½ç½®è®¾ç½®æœ‰å…³ï¼Œåªè¦æ‰€æœ‰minipageçš„è®¾ç½®ä¸€è‡´å°±ä¸ä¼šå‡ºç°å›¾ç‰‡é”™ä½çš„é—®é¢˜ã€‚è€Œ<code>&#123;0.23\linewidth&#125;</code>è¡¨ç¤ºçš„æ˜¯å½“å‰çš„ã€æ­£æ–‡çš„ï¼ŒåŸpageçš„ã€‘linewidthï¼ˆè¡Œçš„å®½åº¦ï¼ˆè·¨åº¦ï¼‰ï¼‰çš„0.23å€ã€‚ä¹Ÿå°±æ˜¯è®¾ç½®è¿™ä¸ªminipageçš„å®½åº¦å¤§å°ã€‚ç”±äº4 * 4ï¼Œæ‰€ä»¥è®¾ç½®çº¦1/4ï¼Œéœ€è¦ç•™ä¸€å®šä½™é‡ã€‚</p>
<p>â€‹ è€Œç”±äºåœ¨<code>\minipage</code>èŠ±æ‹¬å·ä¹‹å†…ï¼Œ<code>\linewidth</code>å°†ä¸å®šä¹‰çš„minipageä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥ç®€å•åœ°å†™ä¸ºï¼šæ’å…¥å›¾ç‰‡çš„å®½åº¦å°±ä¸º<code>\linewidth</code>ï¼Œå æ»¡æ•´ä¸ªminipageè¡Œå®½å³å¯ã€‚</p>
<p>â€‹ å›¾ç‰‡çš„æ’å…¥å¹¶éä»€ä¹ˆå›°éš¾çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å›¾ç‰‡çš„æ’ç‰ˆã€‚æ’ç‰ˆçš„è¯ï¼Œä¼ ç»Ÿçš„<code>\begin&#123;figure&#125;[htbp]</code>ç”¨å¤„ä¸å¤§ï¼Œå¯ä»¥è€ƒè™‘ï¼š</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;float&#125;		<span class="comment">% å›¾ç‰‡æµ®åŠ¨å®åŒ…</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]		<span class="comment">% å›¾ç‰‡å®šä½åœ¨å½“å‰ä½ç½®</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2021/02/05/LaTex%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AE%B0%E5%BD%95/float.JPG"></p>
<hr>
<h2 id="è¡¨æ ¼çš„æ’å…¥">è¡¨æ ¼çš„æ’å…¥</h2>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;  </span><br><span class="line"><span class="keyword">\centering</span></span><br><span class="line"><span class="keyword">\caption</span>&#123;table&#125; <span class="keyword">\vspace</span>&#123;4pt&#125;</span><br><span class="line"><span class="keyword">\begin</span>&#123;tabular*&#125;&#123;12cm&#125;&#123;cccc&#125;</span><br><span class="line"><span class="keyword">\hline</span><span class="keyword">\vspace</span>&#123;1pt&#125;</span><br><span class="line"><span class="keyword">\textbf</span>&#123;Name&#125; <span class="built_in">&amp;</span> <span class="keyword">\textbf</span>&#123;Gender&#125;  <span class="built_in">&amp;</span> <span class="keyword">\textbf</span>&#123;Current Address&#125; <span class="built_in">&amp;</span> <span class="keyword">\textbf</span>&#123;Score&#125;<span class="keyword">\vspace</span>&#123;1pt&#125;<span class="keyword">\\</span>  </span><br><span class="line"><span class="keyword">\hline</span><span class="keyword">\vspace</span>&#123;1pt&#125;</span><br><span class="line">Tobby  <span class="built_in">&amp;</span> Male <span class="built_in">&amp;</span> 4 Avenue, Chicago, Illinois <span class="built_in">&amp;</span> 99<span class="keyword">\vspace</span>&#123;1pt&#125;<span class="keyword">\\</span>  </span><br><span class="line">Laura  <span class="built_in">&amp;</span> Female <span class="built_in">&amp;</span> unknown town, Atlanta, Georgia <span class="built_in">&amp;</span> 98<span class="keyword">\vspace</span>&#123;1pt&#125;<span class="keyword">\\</span>  </span><br><span class="line"><span class="keyword">\hline</span><span class="keyword">\vspace</span>&#123;1pt&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;tabular*&#125;  </span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125; </span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2021/02/05/LaTex%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AE%B0%E5%BD%95/table.JPG"></p>
<h3 id="ç›¸å…³ä»£ç ç†è§£-1">ç›¸å…³ä»£ç ç†è§£</h3>
<p><strong>- ä¸ºä»€ä¹ˆè¦ç”¨<code>&#123;tabular\*&#125;</code>?</strong></p>
<p>â€‹ <code>&#123;tabular\*&#125;</code>æ˜¯å¯ä»¥è¿›è¡Œçº¿è¡¨å®½åº¦è°ƒæ•´çš„ï¼Œæ¯”å¦‚è¡¨æ ¼å¤ªå°äº†ï¼Œå¸Œæœ›å®½åº¦æ–¹å‘èƒ½å æ›´å¤§çš„ç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨è¯­æ³•ï¼š<code>\begin&#123;tabular*&#125;&#123;å®½åº¦&#125;[ä½ç½®]&#123;å¯¹é½æ ·å¼ä¸åˆ—æ•°&#125;</code></p>
<p>â€‹ æ™®é€šçš„<code>&#123;tabular&#125;</code>åªéœ€è¦ï¼š<code>\begin&#123;tabular&#125;[ä½ç½®]&#123;å¯¹é½æ ·å¼ä¸åˆ—æ•°&#125;</code>ã€‚è¿™æ ·çš„è¡¨æ ¼æ˜¯æ ¹æ®å†…å®¹è‡ªé€‚åº”è°ƒæ•´å¤§å°çš„ã€‚</p>
<p>â€‹ å…¶ä¸­<code>&#123;cccc&#125;</code>è¡¨ç¤º4åˆ—ï¼Œæ¯åˆ—éƒ½æ˜¯ä¸¾ä¸­å¯¹é½ã€‚å¦‚æœéœ€è¦å·¦è¾¹å¯¹é½ï¼Œä½¿ç”¨llllã€‚</p>
<p><strong>- çº¿è¡¨æ ·å¼</strong></p>
<p>â€‹ <code>\hline</code>è¡¨ç¤ºæ’å…¥ä¸€æ ¹æ¨ªå‘çº¿ï¼Œ<code>\vline</code>å¯ä»¥åœ¨cellå…ƒç´ å€¼å†…éƒ¨ä½¿ç”¨ï¼Œç›¸å½“äºç«–çº¿ã€‚</p>
<p>â€‹ <code>\vspace</code>ä¸€èˆ¬ç”¨äºè°ƒæ•´é—´è·ï¼Œ<code>&amp;</code> ç”¨äºåˆ†å‰²ã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>typesetting</tag>
      </tags>
  </entry>
  <entry>
    <title>Ref NeRFå¤ç°</title>
    <url>/2022/08/13/Mip-NeRF-Ref-NeRF/</url>
    <content><![CDATA[<h2 id="ref-nerfå¤ç°">Ref NeRFå¤ç°</h2>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ ç§‘ç ”æ¢å¤æ€§è®­ç»ƒã€‚ä¹‹å‰æŠŠCUDAåŠ é€Ÿçš„å…¨å¹¶è¡Œshadow casterå†™å®Œäº†ï¼Œç®—æ˜¯å¤ä¹ äº†CUDAã€Rustä»¥åŠFFIçš„ä½¿ç”¨ã€‚æ·±åº¦å­¦ä¹ æ–¹é¢å°±ä»¥å¤ç°Ref NeRFä¸ºä¸€ä¸ªå°ä»»åŠ¡ã€‚è®ºæ–‡<a href="https://dorverbin.github.io/refnerf/">CVPR 2022 Best Student Honorable Mention: Ref NeRF - Structured View-Dependent Appearance for Neural Radiance Fields</a>å¯¹åå°„ç°è±¡è¿›è¡Œäº†è‰¯å¥½çš„å»ºæ¨¡ã€‚ä¹‹å‰æˆ‘ä¸€ç›´åœ¨ç ”ç©¶æŠ˜å°„ç°è±¡çš„NeRFå»ºæ¨¡ï¼Œå°±æŠ˜å°„å»ºæ¨¡æ€è·¯è€Œè¨€ï¼Œæ­¤æ–‡å¯¹æˆ‘æœ‰å¾ˆå¤§çš„å¯å‘ã€‚å¹¶ä¸”ä¸ªäººè®¤ä¸ºï¼ŒåŸºäºRef NeRFä»¥åŠmip NeRFä½œä¸ºæ¡†æ¶æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼ˆé™¤æ­¤ä¹‹å¤–å°±æ˜¯è¦è€ƒè™‘å¦‚ä½•è®©è®­ç»ƒå˜å¿«äº†ï¼ŒInstant NGPå½“ç„¶æ˜¯ä¸äºŒé€‰æ‹©ï¼‰ã€‚å½“ç„¶ï¼Œç”±äºåœ¨å¤ç°è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†è®¸å¤šé—®é¢˜ï¼Œæœ¬æ–‡åœ¨é˜è¿°å¤ç°æ€è·¯ä»¥åŠè®ºæ–‡ç†è§£çš„åŒæ—¶ï¼Œä¹Ÿä¼šæ¢è®¨è¸©è¿‡çš„å‘ã€‚ç›®å‰ï¼ŒRef NeRFçš„å¤ç°ç»“æœè¿˜æ²¡æœ‰è¾¾åˆ°ä»¤æˆ‘æ»¡æ„çš„ç¨‹åº¦ï¼Œåªæ˜¯å…·å¤‡é›å½¢ï¼Œæ¯•ç«Ÿèåˆä¸¤ç¯‡æ–‡ç« çš„ideaå¯èƒ½å¯¼è‡´å†²çªï¼Œæ·±åº¦å­¦ä¹ è¿™ç§ç„å­¦å°±æ›´æ˜¯è¿™æ ·äº†ï¼Œæ¨¡å‹ç‚¸äº†éƒ½ä¸çŸ¥é“ä»å“ªä¸€ä¸ªå…ˆå¼€å§‹ã€‚å¤ç°è§ <a href="https://github.com/Enigmatisms/NeRF">Enigmatisms/NeRF</a></p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/ezgif-1-8207b1faa2.gif"></p>
<center>
Figure 1. Ref NeRFåŠæˆå“(Shinny Blender - Helmet)ã€‚ä»å·¦è‡³å³ï¼šRGBã€depthä¸â€œå¥‡æ€ªçš„æ³•å‘é‡â€
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-è®ºæ–‡æ¢³ç†">II. è®ºæ–‡æ¢³ç†</h2>
<h3 id="ref-nerfçš„å»ºæ¨¡">2.1 Ref NeRFçš„å»ºæ¨¡</h3>
<p>â€‹ Ref NeRFå»ºæ¨¡äº†è¡¨é¢åå°„ï¼Œæ­¤å·¥ä½œæ¯”ä¹‹å‰æ‰€çœ‹è¿‡çš„ä¸€ç¯‡å¤„ç†åå°„çš„NeRFï¼ˆ<a href="https://arxiv.org/abs/2111.15234">NeRFReN</a>ï¼‰æ›´æœ‰ä»·å€¼ã€‚ä¸ªäººè®¤ä¸ºï¼ŒRef NeRFå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„å…‰çº¿ä¼ æ’­æ¨¡å‹ï¼Œè¾ƒå¥½åœ°è§£å†³äº†åå°„é—®é¢˜ï¼Œåªéœ€è¦åŠ ä¸ŠæŠ˜å°„éƒ¨åˆ†å°±å¯ä»¥ä½¿å¾—NeRFå¤„ç†åŸºæœ¬çš„å…‰çº¿ä¼ æ’­ç°è±¡ã€‚æœ¬æ–‡å¯¹Ref NeRFçš„ä¸»è¦æ€è·¯è¿›è¡Œæ¢³ç†ï¼Œå¹¶ä¸”åŸºäºç¬”è€…å¯¹æœ¬è®ºæ–‡çš„ç†è§£ï¼Œåœ¨ä¹‹å‰å®ç°çš„NeRFï¼ˆmip NeRF 360ï¼‰åŸºç¡€ä¸Šï¼Œå¢åŠ Ref NeRFæ¨¡å—ã€‚</p>
<p>â€‹ Ref NeRFå¤„ç†çš„é¦–è¦é—®é¢˜æ˜¯å…‰çº¿çš„åå°„é—®é¢˜ï¼Œåå°„ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼šé•œé¢åå°„ï¼ˆspecularityï¼‰ä»¥åŠæ¼«åå°„ï¼ˆdiffusionï¼‰ã€‚é‚£ä¹ˆæ ¹æ®Phongåå°„æ¨¡å‹ï¼ˆä»¥åŠä¹‹å‰å­¦è¿‡åŠåŠå­å›¾å½¢å­¦åŸºç¡€ï¼‰ï¼Œè¢«è§‚å¯Ÿåˆ°çš„å…‰çº¿ï¼ˆå¼ºåº¦ï¼‰å°†ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{phong}
I_o=k_aI_a+\sum_{i}k_d\left( l_i\cdot n\right)I_i+\sum_i k_s(r_i\cdot v)^pI_i
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œä¸‹æ ‡ä¸ºaçš„éƒ¨åˆ†ä¸ç¯å¢ƒå…‰ï¼ˆambient lightï¼‰æœ‰å…³ï¼›ä¸‹æ ‡å«æœ‰dåˆ™ä¸æ¼«åå°„æœ‰å…³ï¼Œè€Œä¸‹æ ‡å«æœ‰såˆ™ä¸é•œé¢é«˜å…‰æœ‰å…³ã€‚ä¸ºäº†æ›´å¥½åœ°è§£é‡ŠRef NeRFçš„åå°„æ¨¡å‹å¤„ç†ä»¥åŠå›é¡¾ä¸€ä¸‹Phongæ¨¡å‹è¿™ä¸ªåŸºç¡€æ¨¡å‹ï¼Œè¿™é‡Œå¯¹å…¬å¼<span class="math inline">\(\eqref{phong}\)</span>æ¨¡å‹ç®€å•è§£é‡Šï¼š</p>
<ul>
<li>ç¬¬ä¸€é¡¹ä»£è¡¨ç¯å¢ƒå…‰å¯¹è§‚å¯Ÿç»“æœçš„å½±å“ï¼šç¯å¢ƒå…‰åªå¯¹ç»“æœäº§ç”Ÿå¸¸æ•°offset</li>
<li>ç¬¬äºŒé¡¹ä»£è¡¨äº†æ‰€æœ‰å…‰æºåœ¨ç‰©ä½“ä¸Šäº§ç”Ÿçš„æ¼«åå°„ã€‚æ¼«åå°„ä¸è§‚å¯Ÿæ–¹å‘æ— å…³ï¼Œåªè¦èƒ½è§‚å¯Ÿåˆ°ï¼Œå°±æ˜¯â€œæ’å®šâ€çš„ã€‚å…‰æºi (<span class="math inline">\(l_i\)</span>ä¸ºå…¶å‘å°„çš„æŸä¸€å…‰çº¿çš„æ–¹å‘ï¼‰å‘å°„å…‰è¶Šæ˜¯èƒ½å‚ç›´è¡¨é¢ï¼ˆä¸æ³•å‘å¹³è¡Œï¼‰ï¼Œæ¼«åå°„è¶Šå¼ºã€‚</li>
<li>ç¬¬ä¸‰é¡¹ä»£è¡¨äº†é•œé¢é«˜å…‰ï¼šä¸ä¸€å®šæ˜¯å®Œå…¨çš„é•œé¢åå°„ï¼ˆæ‰€ä»¥ç§°ä¹‹ä¸ºé•œé¢é«˜å…‰ï¼‰ï¼Œå¯ä»¥ç¨æ˜¾æ¨¡ç³Šï¼Œä½†æ˜¯å…¶å¼ºåº¦æ˜¯ä¸è§†è§’æœ‰å…³çš„ã€‚<span class="math inline">\(r_i\)</span>ä»£è¡¨äº†åå°„å…‰çº¿çš„æ–¹å‘ï¼Œ<span class="math inline">\(v\)</span>åˆ™ä»£è¡¨äº†è§‚å¯Ÿæ–¹å‘ã€‚ä¸¤è€…é‡åˆï¼ˆç‚¹ä¹˜ç»“æœæ¥è¿‘1ï¼‰æ—¶ï¼Œåå°„è¾ƒå¼ºã€‚æŒ‡æ•°pç”¨äºåŠ å¼ºè¡°å‡ï¼Œå¯çŸ¥pè¶Šå¤§ï¼Œ<span class="math inline">\((r_i\cdot v)^p\)</span>å˜åŒ–è¶Šå¿«ã€‚ä¹Ÿå³è§†çº¿ä¸åå°„æ–¹å‘é‡åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé•œé¢é«˜å…‰çš„å˜åŒ–è¶Šæ˜æ˜¾ã€‚</li>
</ul>
<p>â€‹ Ref NeRFå¯¹äºåä¸¤ä¸ªéƒ¨åˆ†éƒ½è¿›è¡Œäº†å»ºæ¨¡ï¼š <span class="math display">\[
\begin{equation}\label{ref}
L_{out}(\hat{\omega_{o}})\propto \int L_{in}(\hat{\omega_{i}})p(\hat{\omega_{i}}\cdot\hat{\omega_{r}})d\hat{\omega_{i}}=F(\hat{\omega_{r}})
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\hat{\omega_{o}}\)</span>æ˜¯è§‚å¯Ÿæ–¹å‘ï¼ˆç›¸æœºåˆ°ç‰©ä½“ï¼‰ï¼Œ<span class="math inline">\(\hat{\omega_{i}}\)</span>æ˜¯å…‰çº¿çš„å…¥å°„æ–¹å‘ï¼ˆå…‰æºåˆ°ç‰©ä½“ï¼‰ï¼Œ<span class="math inline">\(\hat{\omega_{r}}\)</span>æ˜¯è§‚å¯Ÿæ–¹å‘åœ¨ç‰©ä½“ä¸Šçš„åå°„ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ç›¸æœºæŒ‰ç…§<span class="math inline">\(\hat{\omega_{o}}\)</span>æ–¹å‘å‘å°„å…‰ååå°„çš„æ–¹å‘ï¼‰ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œ<span class="math inline">\(\hat{\omega_{i}}\cdot\hat{\omega_{r}}\)</span>å°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{phong}\)</span>ä¸­çš„ <span class="math inline">\(r_i\cdot v\)</span>ã€‚åœ¨æ­¤å·¥ä½œä¸­ï¼Œå‡½æ•°pç­‰å‡æ˜¯ç¥ç»ç½‘ç»œï¼ˆå­¦å‡ºæ¥çš„åå°„ï¼Œå¼ºï¼‰ï¼Œå¹¶ä¸”ä½œè€…å¼ºè°ƒï¼Œæ­¤å‡½æ•°å°±æ˜¯åå°„æ–¹å‘ <span class="math inline">\(\hat{\omega_{r}}\)</span>çš„å‡½æ•°ï¼ˆå†…éƒ¨åŒ…å«äº†è§‚å¯Ÿè§†è§’æ–¹å‘ä¿¡æ¯ï¼‰ã€‚åå°„æ–¹å‘çš„æ±‚è§£éå¸¸ç®€å•ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚ä¸è¿‡æˆ‘ä¸ç¦æ€è€ƒï¼Œå¦‚æœæŠŠä½œè€…çš„åå°„æ¨¡å‹ä»Phongæ¨¡å‹æ¢æˆBling Phongæ¨¡å‹ä¼šæ€ä¹ˆæ ·ï¼Ÿåœ¨å¤ç°ä¸­ç¬”è€…è¿›è¡Œäº†å°è¯•ï¼Œç»“æœè§å®éªŒéƒ¨åˆ†ã€‚</p>
<p>â€‹ ä½œè€…èŠ±å¤§åŠ›æ°”æ”¹é€ åŸå§‹NeRFçš„directional MLPï¼Œspatial MLPåˆ™åªæ˜¯è¾“å‡ºäº†ä¸€äº›æ–°çš„è¾…åŠ©ä¿¡æ¯ã€‚directional MLPå¿…é¡»è¦èƒ½å¤Ÿè¾“å‡ºçœŸæ­£çš„view dependenté¢œè‰²ã€‚ä½œè€…è®¤ä¸ºï¼šspatial MLPä¹Ÿéœ€è¦ç›´æ¥é¢„æµ‹é¢œè‰²ï¼Œä½†æ˜¯æ­¤é¢œè‰²åº”è¯¥æ˜¯å—ç¯å¢ƒå…‰ã€æ¼«åå°„ç­‰å½±å“äº§ç”Ÿçš„ï¼ˆç”±å…¬å¼ <span class="math inline">\(\eqref{phong}\)</span>å¯çŸ¥ï¼Œç¯å¢ƒå…‰ä¸æ¼«åå°„å‡ä¸è§†è§’æ— å…³ï¼‰ï¼Œè§†è§’ä¸å˜çš„é¢œè‰²ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œæ­¤éƒ¨åˆ†é¢œè‰²å¹¶éalbedoï¼ˆç”±äºæ¼«åå°„å­˜åœ¨ï¼‰ã€‚è€Œdirectional MLPåº”å½“äº§ç”Ÿé•œé¢é«˜å…‰éƒ¨åˆ†ã€‚ä½œè€…å¯¹directional MLPä½œäº†å¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<h3 id="directional-mlpä¿®æ”¹">2.2 directional MLPä¿®æ”¹</h3>
<p>â€‹ é¦–å…ˆï¼Œä½œè€…åšäº†ä¸€ä¸ªç±»ä¼¼äºmip NeRFä¸­å…‰é”¥å¤„ç†çš„æ“ä½œã€‚mip NeRFä¸­ï¼Œä¸ºäº†è¾¾åˆ°mip mapçš„æ•ˆæœï¼Œä½œè€…å°†ç‚¹é‡‡æ ·å˜ä¸ºäº†å…‰é”¥é‡‡æ ·ï¼Œä»¥è€ƒè™‘æ•´ä¸ªå…‰é”¥ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚Ref NeRFä¸­ï¼Œä½œè€…è®¤ä¸ºâ€œåå°„â€ä¹Ÿä¸èƒ½ä»…ä»…è€ƒè™‘å•ä¸ªåå°„æ–¹å‘ã€‚ç”±äºç‰©ä½“å®é™…æ˜¯å‡¹å‡¸ä¸å¹³çš„ï¼Œå¹¶éå®Œç¾çš„é•œé¢ï¼Œè¡¨é¢æ³•å‘é‡å¹¶éå®Œå…¨ä¸€è‡´ã€‚å¯ä»¥è®¤ä¸ºï¼Œç‰©ä½“è¡¨é¢çš„å‡¹å‡¸èµ·ä¼ï¼ˆå™ªå£°ï¼‰ï¼Œä½¿å¾—åå°„å‘ç”Ÿäº†ä¸€äº›æ”¹å˜ï¼ˆdistortionï¼‰ï¼Œç‰©ä½“è¡¨é¢å™ªå£°çš„æ¦‚ç‡åˆ†å¸ƒï¼Œç»è¿‡åå°„çš„æ•°å­¦æ“ä½œåè¢«æ˜ å°„æˆäº†æ–°çš„åˆ†å¸ƒã€‚å¹¶ä¸”ï¼š</p>
<ul>
<li>æ–°çš„åˆ†å¸ƒåº”è¯¥æ˜¯å„æ–¹å‘å¯¹ç§°çš„ã€‚ç”±äºæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç‰©ä½“è¡¨é¢èƒ½æœ‰ä»€ä¹ˆæ ·çš„å„å‘å¼‚æ€§ç‰¹å¾ã€‚</li>
<li>æ³•å‘é‡åˆ†å¸ƒçš„æœŸæœ›åº”è¯¥æ˜¯ <span class="math inline">\(\hat{\omega_{r}}\)</span>ï¼Œä¹Ÿå³æ ¹æ®æ±‚å¾—çš„è¡¨é¢æ³•å‘é‡ä»¥åŠè§‚å¯Ÿæ–¹å‘æ±‚å‡ºçš„åå°„æ–¹å‘ã€‚å…¶èƒŒåçš„intuitionï¼ˆæ€»è§‰å¾—ï¼Œä¸åº”è¯¥ç¿»è¯‘æˆç›´è§‰ï¼Œæ•…æˆ‘è¿™é‡Œç”¨äº†ä¸€ä¸ªè‹±æ–‡å•è¯ï¼Œä»¥è¡¨ç¤ºï¼šæˆ‘è§‰å¾—è¿™é‡Œç”¨ä¸­æ–‡è¡¨è¾¾ä¸äº†é‚£ç§æ„æ€ï¼‰å¾ˆå¥½ç†è§£ã€‚</li>
<li>æ³•å‘é‡çš„æ–¹å·®åº”è¯¥å—åˆ°ç‰©ä½“è¡¨é¢ç²—ç³™ç¨‹åº¦è¿›è¡Œæ§åˆ¶ã€‚è¡¨é¢è¶Šç²—ç³™ï¼Œæ–¹å·®è¶Šå¤§ï¼ˆæ³•å‘é‡åˆ†å¸ƒè¾ƒå¹¿ã€åˆ†æ•£ï¼‰ã€‚è¿™å¾ˆç¬¦åˆç°å®ã€‚</li>
</ul>
<p>â€‹ ä½œè€…ä½¿ç”¨äº†ä¸€ç§å«åš von Mises-Fisherï¼ˆç®€å†™ä¸ºvMFï¼‰çš„æ¦‚ç‡åˆ†å¸ƒã€‚æ­¤åˆ†å¸ƒçš„pdféå¸¸åƒé«˜æ–¯åˆ†å¸ƒpdfï¼Œä¼°è®¡ä¹Ÿæœ‰å·®ä¸å¤šçš„æ€§è´¨ã€‚ä¸ªäººæ¨æµ‹ä½œè€…é€‰è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œåç»­çš„æ•°å­¦æ¨å¯¼ä»¥åŠè¿‘ä¼¼ï¼Œå°±åƒmip NeRFä¸­ï¼Œå°†å…‰é”¥ç”¨æ··åˆé«˜æ–¯æ¨¡å‹è¿›è¡Œè¿‘ä¼¼ä¸€æ ·ã€‚æœ‰äº†æ­¤åˆ†å¸ƒï¼Œè‡ªç„¶éœ€è¦ä½¿ç”¨ç§¯åˆ†å°†æ‰€æœ‰å¯èƒ½çš„åå°„æ–¹å‘è€ƒè™‘è¿›å»ã€‚å½“ç„¶ä¸æ˜¯ç›´æ¥æ±‚æœŸæœ›ï¼ˆæ±‚å‡ºæ¥å°±æ˜¯ <span class="math inline">\(\hat{\omega_{r}}\)</span>ï¼Œå°±ç›´æ¥trivialäº†ï¼‰ã€‚è€ƒè™‘åˆ°ï¼Œåœ¨å°† <span class="math inline">\(\hat{\omega_{r}}\)</span> è¾“å…¥åˆ°directional MLPä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œpositional encodingã€‚åœ¨mip NeRFä¸­ï¼Œpositional encodingå‚ä¸äº†ç§¯åˆ†ï¼Œåœ¨æ­¤å¤„å®é™…ä¸Šä¹Ÿç±»ä¼¼ï¼šæˆ‘ä»¬éœ€è¦åœ¨é«˜ç»´ç©ºé—´ä¸­æ±‚æ¯ä¸€ç»´åº¦çš„æœŸæœ›ã€‚ä½†ä½œè€…å¹¶æ²¡æœ‰ç”¨sinusoidal positional encodingï¼Œè€Œæ˜¯ä½¿ç”¨çƒè°å‡½æ•°ï¼ˆspherical harmonicsï¼‰å¯¹æ–¹å‘è¿›è¡Œè¡¨ç¤ºã€‚æœ€åå¯¹æ¯ä¸€ç»´çƒè°å‡½æ•°è¿›è¡Œç§¯åˆ†ï¼š <span class="math display">\[
\begin{equation}\label{sphere}
\mathbb{E}_{\hat\omega\sim{\text{vMF}(\hat{\omega_{r}},\kappa)}}[Y^m_{l}(\hat\omega)]\approx \exp(\frac{-l(l+1)}{\kappa})Y^m_{l}(\hat\omega)
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(\kappa\)</span>ä¸ºè¡¨é¢ç²—ç³™åº¦çš„å€’æ•°ï¼ˆæ­¤å€¼è¶Šå¤§ï¼Œè¶Šå…‰æ»‘ï¼‰ï¼Œ<span class="math inline">\(Y^m_{l}(\hat\omega)\)</span>è¡¨ç¤ºçƒè°å‡½æ•°ï¼ˆmï¼Œléƒ½è¡¨ç¤ºäº†å…¶é˜¶ï¼‰ã€‚ä¸éš¾ä»å…¬å¼<span class="math inline">\(\eqref{sphere}\)</span>çœ‹å‡ºï¼Œç§¯åˆ†è¿‘ä¼¼åçš„çƒè°encodingå®é™…ä¸Šå¤šäº†ä¸€ä¸ªç³»æ•°ï¼Œæ­¤ç³»æ•°å—åˆ°çƒè°é˜¶ï¼ˆé¢‘ç‡çš„æŒ‡æ•°ï¼‰ä»¥åŠè¡¨é¢å…‰æ»‘ç¨‹åº¦ï¼ˆ<span class="math inline">\(\kappa\)</span>ï¼‰çš„å½±å“ã€‚æ˜¾ç„¶ï¼Œ<span class="math inline">\(\kappa\)</span>è¶Šå°ï¼Œå¯¹äºé«˜é˜¶ï¼ˆé¢‘ï¼‰çƒè°å½±å“è¶Šå¤§ã€‚è¿™ä¹Ÿå°±åæ˜ äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼š<u><strong>å…‰æ»‘ç¨‹åº¦</strong></u>å‡å°ï¼Œé«˜ä½é¢‘ä¿¡æ¯å‡æœ‰æ‰€è¡°å‡ï¼Œä½†<u><strong>é«˜é¢‘ä¿¡æ¯</strong></u>è¡°å‡æ›´ä¸¥é‡ã€‚é€šè¿‡ <span class="math inline">\(\kappa\)</span>å°±èƒ½ç›´æ¥å½±å“è¾“å‡ºç»“æœä¸­é•œé¢é«˜å…‰çš„å¼ºåº¦ï¼ˆæ¨¡ç³Šæ€§ä»¥åŠä¿ç•™ç»†èŠ‚å¤šå°‘ï¼‰ã€‚</p>
<p>â€‹ å½“ç„¶ä½œè€…ä¸ä»…ä»…ç»™directional MLPæä¾›äº†<span class="math inline">\(\hat{\omega_{r}}\)</span>ï¼Œå¦‚å…¬å¼ <span class="math inline">\(\eqref{phong}\)</span>æ‰€ç¤ºç¬¬äºŒé¡¹çš„<span class="math inline">\(l_i\cdot n\)</span>ä¹Ÿè¢«ä¼ å…¥ç½‘ç»œï¼ˆ<span class="math inline">\(d\cdot n\)</span>ï¼Œdä¸ºè§‚å¯Ÿæ–¹å‘ï¼Œnä¸ºæ³•å‘é‡ï¼‰ï¼Œè¿™å¹¶ä¸æ˜¯è¦å»ºæ¨¡æ¼«åå°„ï¼Œè€Œæ˜¯è€ƒè™‘åˆ°ä¸€äº›ç¨å¾®å¤æ‚ä¸€äº›çš„æ•ˆåº”ï¼Œå¦‚è²æ¶…å°”æ•ˆåº”ï¼ˆå¹¶éå…¨åå°„ï¼Œéƒ¨åˆ†åå°„éƒ¨åˆ†æŠ˜å°„ï¼Œåå°„æ‰€å çš„æ¯”ä¾‹éœ€è¦å¦å¤–è®¡ç®—ï¼‰ç­‰ç­‰ã€‚</p>
<h3 id="æ³•å‘é‡ä¼°è®¡">2.3 æ³•å‘é‡ä¼°è®¡</h3>
<p>â€‹ ä½œè€…ä½¿ç”¨volume densityçš„æ¢¯åº¦å¯ä»¥ä¼°è®¡æ³•å‘é‡ï¼Œä½†ä½œè€…è¯´ï¼š</p>
<blockquote>
<ol type="1">
<li>normal vectors estimated from its volume density gradient as in Equation 3 are often extremely noisy</li>
<li>NeRF tends to "fake" specular highlights by embedding emitters inside the object and partially occluding them with a "foggy" diffuse surface</li>
</ol>
</blockquote>
<p>â€‹ ç¡®å®ï¼Œï¼ˆ1ï¼‰å¾ˆæ˜¾ç„¶ï¼Œå·²ç»æœ‰å¾ˆå¤šè®ºæ–‡åšè¿™æ–¹é¢çš„å·¥ä½œäº†ï¼Œä¸æ˜¯æ·»åŠ æ­£åˆ™åŒ–é¡¹å°±æ˜¯é‡‡ç”¨ä¸€äº›è¡¨é¢é‡å»ºæŠ€æœ¯è·å¾—å¥½çš„è¡¨é¢ã€‚ï¼ˆ2ï¼‰çš„è¯é€šå¸¸ä¹Ÿæ˜¯ç”±â€œé›†ä¸­æ€§â€æ­£åˆ™åŒ–é¡¹è§£å†³çš„ï¼ˆåªä¸è¿‡ä½œè€…çš„æƒ³æ³•ä¸å¤ªä¸€æ ·ï¼‰ã€‚</p>
<ul>
<li><p>é—®é¢˜ï¼ˆ1ï¼‰çš„è§£å†³ï¼ˆ<strong><u>prediction penalty</u></strong>ï¼‰ï¼šé€šè¿‡spatial MLPé¢„æµ‹æŸä¸€ç‚¹çš„æ³•å‘é‡<span class="math inline">\(\hat{n}\)</span>ï¼Œä¸æ¢¯åº¦æ³•å‘é‡<span class="math inline">\(n&#39;\)</span>æ±‚MSEï¼š <span class="math display">\[
  \begin{equation}
  L_{n}=\sum_{i}w_i\Vert \hat{n}_i-n&#39;_i\Vert
  \end{equation}
  \]</span> ç”±äº<span class="math inline">\(\hat{n}\)</span>ç›¸å¯¹æ¯”è¾ƒå…‰æ»‘ï¼Œè€Œ<span class="math inline">\(n&#39;\)</span>æ˜¯å¯¹ä¸å…‰æ»‘çš„densityæ±‚çš„ä¸€é˜¶å¯¼ï¼Œå°±æ›´ä¸å…‰æ»‘äº†ã€‚ç”¨å…‰æ»‘æ•°æ®å¸®åŠ©ä¸å…‰æ»‘çš„æ¢¯åº¦è¿›è¡Œå­¦ä¹ ï¼Œå¯ä»¥èµ·åˆ°å¯¹æ¢¯åº¦çš„å…‰æ»‘ä½œç”¨ã€‚ä½†ä¸ºä»€ä¹ˆ<span class="math inline">\(\hat{n}\)</span>æ¯”è¾ƒå…‰æ»‘ï¼Ÿè¿™æ˜¯ä½œè€…è¯´çš„ï¼Œå…¶å®æˆ‘æ¯”è¾ƒçº³é—·ï¼Œæ¯•ç«Ÿè¿™ç©æ„æ˜¯å­¦å‡ºæ¥çš„ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼šå¯ä»¥è®¤ä¸ºï¼Œæ­¤å¤„éœ€è¦ç½‘ç»œä¹ŸåŒæ—¶å°†<span class="math inline">\(n&#39;\)</span>å­¦å‡ºæ¥ï¼ˆåˆ©ç”¨<span class="math inline">\(n&#39;\)</span>ä½œä¸ºç›‘ç£ï¼‰ã€‚ä½†æ˜¯ç½‘ç»œçš„è¡¨ç¤ºèƒ½åŠ›æœ‰é™ï¼Œç‰¹åˆ«æ˜¯å‚æ•°è¾ƒå°‘æ—¶ï¼Œåªèƒ½è¾¾åˆ°å¯¹<span class="math inline">\(n&#39;\)</span>ä½é¢‘éƒ¨åˆ†çš„å­¦ä¹ ã€‚</p></li>
<li><p>é—®é¢˜ï¼ˆ2ï¼‰çš„è§£å†³ï¼ˆ<strong><u>orientation loss</u></strong>ï¼‰ï¼šä½œè€…è®¾è®¡äº†ä¸€ä¸ªæ­£åˆ™åŒ–é¡¹ï¼šæ­¤æ­£åˆ™åŒ–æƒ©ç½šåå‘æ³•å‘é‡ï¼Œä¹Ÿå³â€œèƒŒé¢â€ã€‚ä½†ä¹Ÿä¸æ˜¯ç›²ç›®å¯¹èƒŒé¢è¿›è¡Œæƒ©ç½šï¼Œæ¯•ç«Ÿvolume samplingè¿‡ç¨‹ä¸­æ˜¯å¯ä»¥åœ¨æœ‰æ•ˆçš„èƒŒé¢è¿›è¡Œé‡‡æ ·çš„ï¼Œæ•…ç”¨ä¸‹å¼ï¼š <span class="math display">\[
  \begin{equation}\label{reg}
  R_o=\sum_i{w_i\max(0,\hat{n}_i\cdot d)}
  \end{equation}
  \]</span> å…¶ä¸­ <span class="math inline">\(w_i\)</span> ä¸ºç‚¹weightå€¼ï¼Œ<span class="math inline">\(d\)</span>ä¸ºå…‰çº¿æ–¹å‘ã€‚æ­¤å¤„ä¹Ÿå³æƒ©ç½š æ³•å‘é‡ä¸å…‰çº¿æ–¹å‘ç›¸åŒéƒ¨åˆ†ã€‚å¹¶ä¸”ä¸weightæœ‰å…³ï¼Œè¿™å°±è¯´æ˜ï¼šè¢«é®æŒ¡çš„æœ‰æ•ˆèƒŒé¢ä¸ä¼šè¢«å½±å“ï¼ˆweightä½ï¼‰ï¼Œè€Œfake surfaceï¼ˆåœ¨åŠé€æ˜surfaceåçš„embedded emitterè¡¨é¢ï¼‰å°†ä¼šè¢«æƒ©ç½šï¼ˆå…¶densityè¡°å‡æ–¹å‘ä¸å…‰çº¿æ–¹å‘ä¸€è‡´ï¼‰</p></li>
</ul>
<p>â€‹ ä½œè€…è‡ªå·±ä¹Ÿè§£é‡Šäº†ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªlossç»“åˆåœ¨ä¸€èµ·å°±workäº†ï¼šç½‘ç»œå¯¹äºæ³•å‘é‡çš„é¢„æµ‹ï¼ˆ<span class="math inline">\(\hat{n}\)</span>ï¼‰ï¼Œä¸densityæ¢¯åº¦å¯¹åº”çš„æ³•å‘é‡<span class="math inline">\(n&#39;\)</span>ä¹‹é—´çš„å…³ç³»å¤§è‡´æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><span class="math inline">\(\hat{n}\)</span> åç¦» <span class="math inline">\(n&#39;\)</span>ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œprediction penaltyè¾ƒå¤§ï¼Œç½‘ç»œåå‘äºä½¿å¾—ä¸¤è€…ç›¸ç­‰ï¼Œåˆ™å¯ä»¥è¾¾åˆ°å¹³æ»‘æ¢¯åº¦çš„ç›®çš„ã€‚</li>
<li><span class="math inline">\(\hat{n}\)</span> å¾ˆæ¥è¿‘ <span class="math inline">\(n&#39;\)</span>ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œç”±äº <span class="math inline">\(\hat{n}\approx n&#39;\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå…¬å¼<span class="math inline">\(\eqref{reg}\)</span>ä½œç”¨åœ¨<span class="math inline">\(n&#39;\)</span>ä¸Šã€‚è¿™ä¹Ÿå°±è¾¾åˆ°äº†æƒ©ç½šçš„ç›®çš„ã€‚</li>
</ul>
<h3 id="æ‰©å±•çŸ¥è¯†">2.4 æ‰©å±•çŸ¥è¯†</h3>
<h4 id="ä¸€äº›ç‰©ç†æ¦‚å¿µ">2.4.1 ä¸€äº›ç‰©ç†æ¦‚å¿µ</h4>
<p>ï¼ˆ1ï¼‰èƒ½é‡ï¼ŒåŠŸç‡ä¸è¾å°„é€šé‡</p>
<p>â€‹ èƒ½é‡çš„å•ä½ä¸€èˆ¬é‡‡ç”¨ï¼ˆJï¼‰ï¼Œè€ŒåŠŸç‡åˆ™æ˜¯å•ä½æ—¶é—´å†…çš„èƒ½é‡ï¼ˆJ/sï¼Œå®šä¹‰ä¸ºWï¼‰ï¼Œæ­¤æ¦‚å¿µä¸é€šé‡ï¼ˆfluxï¼‰æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚ä¸æ¥æ”¶èƒ½é‡çš„é¢ç§¯æ²¡æœ‰å…³ç³»ã€‚</p>
<p>ï¼ˆ2ï¼‰è¾ç…§åº¦ä¸è¾å‡ºåº¦</p>
<p>â€‹ è¾ç…§åº¦ï¼ˆirradianceï¼‰ä¸è¾å°„åº¦ï¼ˆradiosityï¼‰æ˜¯ä¸¤ä¸ªç±»ä¼¼çš„æ¦‚å¿µï¼Œä¸é¢ç§¯æœ‰å…³ã€‚å•ä½é¢ç§¯çš„é€šé‡ï¼ˆæˆ–è€…è¯´ï¼ŒåŠŸç‡ï¼‰ï¼Œå•ä½æ˜¯ï¼š<span class="math inline">\(W/m^2\)</span>ã€‚æ³¨æ„ï¼Œæ­¤é¢ç§¯æ˜¯å…‰ç…§çš„â€œæ­£å¯¹é¢ç§¯â€ï¼Œä¹Ÿå³éœ€è¦è¿›è¡ŒæŠ•å½±å¤„ç†ã€‚å½“è¡¨é¢æ³•å‘é‡ä¸å…‰çº¿å…¥å°„ï¼ˆå‡ºå°„ï¼‰æ–¹å‘å‚ç›´æ—¶ï¼Œè¾ç…§åº¦ä»¥åŠè¾å°„åº¦æœ€å¤§ã€‚å½“ç„¶ï¼Œä»¥ä¸Šè®¨è®ºä»…é™äºé¢å¹³è¡Œå…‰æºã€‚å¯¹äºç‚¹å…‰æºè€Œè¨€ï¼Œå…¶è¾ç…§ï¼ˆå°„ï¼‰åº¦ä¸è·ç¦»çš„å…³ç³»éµå¾ªå¹³æ–¹åæ¯”å®šå¾‹ï¼ˆè·ç¦»è¶Šè¿œï¼Œè¾ç…§ï¼ˆå°„ï¼‰åº¦è¶Šä½ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰ç«‹ä½“è§’ä¸è¾å°„å¼ºåº¦ï¼ˆintensityï¼‰</p>
<p>â€‹ ç«‹ä½“è§’è¡¨è¾¾çš„ç‰©ç†æ„ä¹‰æ˜¯ï¼š1ç«‹ä½“è§’å¯¹åº”åœ¨å•ä½çƒä¸Šæˆªå–çš„å¤§å°ä¸º<span class="math inline">\(r^2\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(r\)</span>ä¸ºçƒçš„åŠå¾„ã€‚ä¹Ÿå³ï¼š <span class="math display">\[
\begin{equation}
\Omega = \frac{A_{sr}}{r^2}{\text{sr}}
\end{equation}
\]</span> â€‹ <span class="math inline">\(\text{sr}\)</span>æ˜¯å•ä½ï¼Œè€Œä¸æ˜¯å˜é‡æˆ–å¸¸é‡ã€‚å…¶ä¸­<span class="math inline">\(A_{sr}\)</span>åˆ™æ˜¯å¯¹åº”å¤§å°çš„çƒé¢åˆ‡ç‰‡é¢ç§¯ã€‚æœ‰äº†ç«‹ä½“è§’ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ç«‹ä½“è§’ + 3Dç‚¹ + 3Dæ–¹å‘æ¥æè¿°ä»»æ„å…‰çº¿ã€‚å…‰çº¿ä»ç»™å®šçš„3Dç‚¹å‡ºå°„ï¼Œæ–¹å‘æ˜¯ç»™å®šçš„3Dæ–¹å‘ï¼Œ<u><strong>å…‰é”¥çš„å½¢çŠ¶</strong></u>ç”±ç«‹ä½“è§’ç¡®å®šã€‚é€šè¿‡å•ä½ç«‹ä½“è§’çš„è¾å°„åŠŸç‡ï¼ˆé€šé‡ï¼‰ç§°ä¸ºè¾å°„å¼ºåº¦ï¼Œå•ä½æ˜¯<span class="math inline">\(W/\text{sr}\)</span>ã€‚è¾å°„å¼ºåº¦æè¿°çš„æ˜¯å…‰æºçš„å±æ€§ï¼Œè€Œéç©ºé—´ä¸­æŸä¸€ç‚¹å—å…‰ç…§çš„ç‰¹æ€§ã€‚æ•…ç»™å®šæŸä¸€å…‰æºï¼Œä¸è€ƒè™‘ç©ºé—´ä¸­çš„å…¶ä»–å› ç´ çš„å½±å“ï¼Œç©ºé—´ä¸­ä»»æ„ä¸€ç‚¹çš„è¾å°„ç…§åº¦éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ï¼ˆ4ï¼‰è¾å°„ç‡ï¼ˆradianceï¼‰</p>
<p>â€‹ æNeRFä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œè¿˜æ²¡æœ‰ææ¸…æ¥šradianceçš„æ„ä¹‰ã€‚æ­¤å‰åªæ˜¯å°†radianceå½“ä½œæ˜¯è§‚å¯Ÿåˆ°çš„ç‰©ä½“çš„é¢œè‰²ï¼Œè€Œç°åœ¨è¿™é‡Œå°†å¯¹è¾å°„ç‡çš„ç‰©ç†å«ä¹‰è¿›è¡Œä»‹ç»ã€‚ä¸Šæ–‡å·²ç»ä»‹ç»äº†è¾å°„å¼ºåº¦çš„æ¦‚å¿µï¼Œå¹¶ä¸”å¯çŸ¥ï¼Œè¾å°„å¼ºåº¦ä¸ç©ºé—´ç‰¹æ€§æ— å…³ï¼Œåªä¸å…‰æºæœ‰å…³ï¼Œè€Œæˆ‘ä»¬åˆå¸Œæœ›è·å¾—æŸä¸€å…‰æºåœ¨ç©ºé—´ä¸­æŸä¸€ä½ç½®å¯äº§ç”Ÿçš„å½±å“ã€‚åˆ™å®šä¹‰è¾å°„ç‡ï¼šå•ä½æ—¶é—´ã€å•ä½é¢ç§¯ã€å•ä½ç«‹ä½“è§’é€šè¿‡çš„å…‰èƒ½ã€‚ä¹Ÿå³å•ä½é¢ç§¯ã€å•ä½ç«‹ä½“è§’çš„åŠŸç‡ã€‚å•ä½æ˜¯ï¼š<span class="math inline">\(W(m^2 \text{sr})^{-1}\)</span>ã€‚å…‰æºè¾ç…§èƒ½åŠ›æ”¹å˜ï¼ˆå¦‚ç¯å…‰çš„äº®æš—ï¼‰ï¼Œåæ˜ äºåŠŸç‡å˜åŒ–ï¼ˆ<span class="math inline">\(W\)</span>ï¼‰ã€‚è€Œå…‰æºçš„â€œèƒ½é‡èšé›†åº¦â€ï¼ˆå¯ä»¥æƒ³è±¡ä¸€ä¸ªå¯ä»¥è°ƒç„¦çš„æ‰‹ç”µç­’ï¼‰åæ˜ åœ¨è¾å°„å¼ºåº¦ä¸Šï¼ˆå½±å“å•ä½ä¸º <span class="math inline">\(\text{sr}\)</span> çš„é¡¹ï¼‰ã€‚ç‰©ä½“è·ç¦»å…‰æºçš„è¿œè¿‘åˆ™åæ˜ åœ¨é¢ç§¯é¡¹ä¸Šï¼ˆå¹³æ–¹åæ¯”ï¼‰ã€‚è¿™ä¹Ÿæ°å¥½ä¸æˆåƒç»“æœç›´æ¥ç›¸å…³ï¼Œæ•…å¯ä»¥å°†radianceç†è§£ä¸ºç©ºé—´ä¸­ä¸€ç‚¹æˆåƒçš„ç»“æœï¼ˆå¦‚RGBå€¼ï¼‰ã€‚</p>
<h4 id="å…‰åœº">2.4.2 å…‰åœº</h4>
<p>â€‹ å››ç»´å…‰åœºæ˜¯å¦åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼ï¼Ÿå››ç»´å…‰åœºè®¤ä¸ºï¼Œåœ¨empty spaceå†…éƒ¨ï¼Œradianceï¼ˆä¹Ÿå°±æ˜¯äº§ç”Ÿçš„RGBå€¼ï¼‰æ˜¯æ’å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæˆ‘ä»æ­¤å…‰çº¿ä¸Šçš„å“ªä¸€ç‚¹å¼€å§‹ç§¯åˆ†ï¼Œæœ€åå¾—åˆ°çš„RGBå€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ­¤RGBå€¼ä¸å…‰çº¿ä¸Šçš„ç§¯åˆ†è·ç¦»ï¼ˆæˆ–æ˜¯æ·±åº¦ï¼‰æ— å…³ã€‚é‚£ä¹ˆè¿™æ ·å¯ä»¥ä»äº”ç»´çš„å…‰åœºå»ºæ¨¡ä¸­ï¼Œå»æ‰ä¸€ä¸ªç»´åº¦ï¼Œå®é™…åˆ™ä¸ºå››ç»´çš„ã€‚ä¸ªäººæ›´æ„¿æ„å°†â€œå››ç»´â€ç†è§£ä¸ºä¸€ä¸ªäº”ç»´ç©ºé—´ä¸­çš„å››ç»´æµå½¢ï¼Œå› ä¸ºæ­¤æ·±åº¦ç»´åº¦å¹¶éäº”ç»´åº¦åŸºä¸­ä¹‹ä¸€ï¼Œä¹Ÿä¸èƒ½ç”¨å…¶çº¿æ€§ç»„åˆæè¿°ã€‚ç†è§£äº†å››ç»´å…‰åœºçš„ç”±æ¥ï¼Œæˆ‘ä»¬å›å¤´æ£€æŸ¥ä¸€ä¸‹å‡è®¾ï¼š<strong><u>ç©ºåŸŸå†…éƒ¨radianceä¸ºå¸¸æ•°</u></strong>ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼šæ— åŠé€æ˜ç‰©ä½“æˆ–è€…ä»‹è´¨ï¼Œè¿™æ˜¯æˆç«‹çš„ã€‚å¼•å…¥åŠé€æ˜ç‰©ä½“ä¸ä»‹è´¨åï¼ˆæ¯”å¦‚æ··æµŠæº¶æ¶²ï¼Œèƒ¶ä½“ï¼Œé›¾ï¼‰ï¼Œä¸ªäººè®¤ä¸ºæ­¤å‡è®¾ä¸æˆç«‹ï¼Œé‚£ä¹ˆè¡¨å››å…‰åœºè¿˜æ˜¯åº”è¯¥ä½¿ç”¨äº”ç»´å‡½æ•°ã€‚</p>
<h3 id="çƒè°å‡½æ•°çš„ä½¿ç”¨">2.5 çƒè°å‡½æ•°çš„ä½¿ç”¨</h3>
<p>â€‹ æ‰“å¼€ç»´åŸºç™¾ç§‘ï¼ŒæŸ¥ä¹‹ã€‚wocï¼Œæˆ‘çœ‹åˆ°äº†ä»€ä¹ˆã€‚æ€»ä¹‹å¾ˆå¤æ‚äº†ï¼Œæœ¬äººæœ¬ç§‘æ‰€å­¦çš„æ•°å­¦çŸ¥è¯†ä¸å¤Ÿç”¨ï¼ˆæˆ–è€…è¯´æ˜¯é—å¿˜äº†ï¼‰ã€‚å…³äºçƒè°å‡½æ•°æœ¬èº«çš„ç†è§£ï¼Œä¸ªäººçš„çœ‹æ³•æ˜¯ï¼šç±»ä¼¼äºå‚…é‡Œå¶å˜æ¢ï¼Œå±•å¼€æˆåŸºå‡½æ•°çš„çº¿æ€§ç»„åˆï¼ˆè¿™äº›åŸºå‡½æ•°ç‹¬ç«‹åˆ†ææ—¶å…¶å®å½¢å¼è¾ƒä¸ºç®€å•ï¼Œä½†ç»„åˆèµ·æ¥å°±èƒ½è¡¨ç¤ºéå¸¸ä¸°å¯Œçš„å†…å®¹ï¼‰ï¼Œå¹¶ä¸”ä¸åƒæ³°å‹’å±•å¼€ï¼ˆæ³°å‹’å±•å¼€çš„ç‰©ç†æ„ä¹‰ä¸ç”šå¥½ç†è§£ï¼‰ï¼Œçƒè°å‡½æ•°æœ‰<strong><u>é¢‘ç‡</u></strong>æ¦‚å¿µï¼Œå¹¶ä¸”ä¸‰ç»´ç©ºé—´ä¸­çš„çƒè°å‡½æ•°ä»ç„¶å¾ˆå¥½ç†è§£ï¼Œéå¸¸å…·æœ‰ç‰©ç†ç›´è§‚æ€§ã€‚å¦‚æœæƒ³è¦çŸ¥é“å¦‚ä½•åˆæ­¥ç†è§£ï¼Œè¿™é‡Œæ¨è<a href="https://zhuanlan.zhihu.com/p/351289217">ã€çŸ¥ä¹ï¼šçƒè°å‡½æ•°ä»‹ç»ï¼ˆSpherical Harmonicsï¼‰ã€‘</a>ï¼Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚ä¸‹é¢åªç»™å‡ºç»“è®ºï¼Œå®çƒè°å‡½æ•°çš„å½¢å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{real_sh}
Y_{lm}(\theta,\phi)=\begin{cases}
(-1)^m\sqrt{2\frac{(2l+1)}{4\pi}\frac{(l-|m|)!}{(l+|m|)!}}P_l^{|m|}(\cos\theta)\sin(|m|\phi), \text{ if }m &lt;0\\
\sqrt{\frac{2l+1}{4\pi}}P_l^m(\cos\theta),\text{ if }m=0\\
(-1)^m\sqrt{2\frac{(2l+1)}{4\pi}\frac{(l-m)!}{(l+m)!}}P_l^{m}(\cos\theta)\cos(m\phi), \text{ if }m &gt;0\\
\end{cases}
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(\phi,\theta\)</span>æ˜¯æ–¹ä½è§’ï¼ˆazimuthal anglesï¼‰ï¼Œ<span class="math inline">\(l,m\)</span>ä¸ºæ­¤çƒè°å‡½æ•°çš„é˜¶ï¼Ÿï¼ˆæ­¤å¤„å®é™…ä¸Šæ¶‰åŠåˆ°ä¸€ä¸ªå¾®åˆ†æ–¹ç¨‹æ±‚è§£é—®é¢˜ï¼Œæ­¤äºŒå˜é‡ä¸è§£çš„ä¸ªæ•°æœ‰å…³ï¼‰ã€‚å¦å¤–ï¼Œæ¯”è¾ƒä»¤äººç–‘æƒ‘çš„æ˜¯ <span class="math inline">\(P^{|m|}_l\)</span>ï¼Œè¿™å®é™…ä¸Šä»£è¡¨çš„æ˜¯ä¼´éšå‹’è®©å¾·å¤šé¡¹å¼ï¼ˆassociated Legendre polynomialsï¼‰ã€‚è¿™é‡Œï¼Œ<a href="https://en.wikipedia.org/wiki/Associated_Legendre_polynomials">Wikipedia</a>ä¼šå‘Šè¯‰ä½ å‹’è®©å¾·å¤šé¡¹å¼çš„å¥‡å¦™æ€§è´¨ï¼Œä½†æ˜¯æˆ‘ä¸å…³å¿ƒï¼ˆè¯´å®åœ¨çš„ï¼Œä¸€å¼€å§‹çœ‹åˆ°è¿™æ ·çš„å…¬å¼æˆ‘è¿˜åœ¨æƒ³åº”è¯¥å¦‚ä½•é«˜æ•ˆå®ç°è¿™ä¹ˆå¤šå¾®åˆ†ï¼‰ã€‚è¿™é‡Œç›´æ¥ç»™å‡ºç»´åŸºä¸Šå†™çš„é—­å¼å…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{legendre}
P^m_l(x)=(-1)^m\cdot2^l\cdot(1-x^2)^{m/2}\sum^l_{k=m}\frac{k!}{(k-m)!}\cdot x^{k-m}\cdot \pmatrix{l\\k} \pmatrix{\frac{l+k-1}{2}\\l}
\end{equation}
\]</span> â€‹ æ­¤å…¬å¼çš„ä»£ç å®ç°å°±ç®€å•å¤šäº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒæœ€åçš„æ±‚å’Œé¡¹ã€‚æ±‚å’Œé¡¹ä¸­æ¶‰åŠåˆ°æ±‚ç»„åˆæ•°ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨lookup tableï¼Œé¢„å…ˆè®¡ç®—ä¸€ä¸ªå¤§å°ä¸º <span class="math inline">\(2^L\cdot 2^L\)</span>çš„çŸ©é˜µï¼ˆLåº”è¯¥ä¸ä¼šå¾ˆå¤§ï¼‰ã€‚é‚£ä¹ˆï¼š <span class="math display">\[
\begin{equation}
\frac{k!}{(k-m)!}\cdot x^{k-m}
\end{equation}
\]</span> â€‹ åº”è¯¥å¦‚ä½•è®¡ç®—ï¼Ÿèƒ½ä¸ç”¨forå¾ªç¯å°±ä¸ç”¨forå¾ªç¯ï¼ˆå¤šç”¨GPUæ“ä½œï¼ï¼ï¼‰ã€‚è§‚å¯Ÿå®¹æ˜“çŸ¥é“ï¼šæ±‚å’Œé¡¹ä¸­çš„é¦–é¡¹æ˜¯<span class="math inline">\(m!x^0\)</span>ï¼Œæ­¤åæ¯ä¸€é¡¹ä¸å‰ä¸€é¡¹çš„å…³ç³»æ˜¯ï¼š <span class="math display">\[
\begin{equation}
T_{k+1}=T_{k}\cdot x\cdot \frac{k+1}{k+1-m}
\end{equation}
\]</span> â€‹ æ•…æˆ‘ä»¬åº”è¯¥æœ‰è¿™æ ·çš„ä¸€ä¸ªå¼ é‡ï¼ˆä¸€è¡Œï¼Œ<span class="math inline">\(l-m\)</span>åˆ—ï¼‰ï¼šç¬¬ä¸€åˆ—æ˜¯ <span class="math inline">\(m!\)</span>ï¼Œæ­¤åæ‰€æœ‰åˆ—æ˜¯ï¼š<span class="math inline">\([\frac{m+1}{1}x,\frac{m+2}{2}x,\frac{m+3}{3}x,...,\frac{l}{l-m}x]\)</span>ã€‚é‚£ä¹ˆå®ç°å°±æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># device æŸä¸ªä¼ å…¥å‡½æ•°çš„å¼ é‡tçš„t.device</span></span><br><span class="line">rare = (torch.arange(m+<span class="number">1</span>,l+<span class="number">1</span>, device = device) / torch.arange(<span class="number">1</span>,l-m+<span class="number">1</span>, device = device)).unsqueeze(<span class="number">0</span>) * x</span><br><span class="line">whole = torch.cat([torch.ones(<span class="number">1</span>, <span class="number">1</span>, device = device) * m_factorial, rare], dim = -<span class="number">1</span>)</span><br><span class="line">whole_prod = torch.cumprod(whole, dim = -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤åï¼Œæ ¹æ®lookupæˆ–è€…åœ¨çº¿æ±‚è§£å…¬å¼<span class="math inline">\(\eqref{legendre}\)</span>ä¸­çš„ç»„åˆæ•°ï¼Œå°±èƒ½æ±‚å¾—æ±‚å’Œå¼ä¸­çš„æ¯ä¸€é¡¹ï¼Œè¿›è€Œä¹Ÿå°±æ±‚å‡ºäº†æ•´ä¸ªå¤šé¡¹å¼ã€‚ä½†è¿™åªæ˜¯é’ˆå¯¹ <span class="math inline">\({m,l}\)</span>æ±‚å‡ºäº†ç»“æœï¼Œè€Œ <span class="math inline">\(m,l\)</span> å¦‚ä½•è¿›è¡Œå¹¶è¡Œè®¡ç®—æˆ‘å°±ä¸æ‡‚äº†ã€‚ä¸è¿‡å…¶å®ä¹Ÿæ²¡å¿…è¦æ‡‚ï¼š</p>
<ul>
<li>NeRFçš„positional encodingï¼Œä¸åŒçš„ç›¸ä½ï¼ˆ<span class="math inline">\(\sin,\cos\)</span>ï¼‰ä»¥åŠä¸åŒçš„é¢‘ç‡æ˜¯ä¸²è¡Œè®¡ç®—æœ€åconcatenateçš„</li>
<li>å¤§å¯ä»¥è‡ªå®šä¹‰CUDAç®—å­ï¼Œå†™ä¸€ä¸ªforwardå†å†™ä¸€ä¸ªbackwardå‡½æ•°ã€‚forwardå¥½å†™è€Œbackwardä¸å¥½å†™ç½¢äº†ï¼ˆè¿™ç©æ„æ˜¾ç„¶æ˜¯æœ‰é—­å¼è§£çš„ï¼Œæ¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼‰ï¼Œæ•…CUDAè‡ªå®šä¹‰ç®—å­ï¼šå…¨å¹¶è¡Œä½†è´¹è„‘å­ï¼ˆå“ˆï¼Œè€Œä¸”è¿˜ä¸ä¸€å®šæœ‰pytorchå¿«ï¼Œä¾‹å¦‚ä¹‹å‰æˆ‘ç”¨thrustçš„sortåº“å¯¹æ¯”pytorchçš„å¼ é‡sortï¼Œå‰è€…å°±æ¯”åè€…æ…¢ï¼‰ï¼Œpytorchå®ç°å¼±å¹¶è¡Œï¼Œä½†ä¸è´¹è„‘å­ã€‚</li>
</ul>
<p>â€‹ çƒè°å‡½æ•°çš„ä½¿ç”¨ä¹Ÿè¯´æ˜äº†ï¼Œæˆ‘ä»¬åœ¨å¤„ç†<strong><u>æ–¹å‘</u></strong>æ—¶ï¼Œéœ€è¦å°†ä¸‰ç»´çš„æ–¹å‘è½¬åŒ–ä¸ºäºŒç»´çš„æ–¹å‘è§’ï¼ˆæ‰èƒ½å–‚ç»™çƒè°å‡½æ•°ï¼Œå½“ç„¶ï¼Œçƒè°å‡½æ•°ç¡®å®æœ‰ç¬›å¡å°”åæ ‡ç³»è¡¨ç¤ºï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„è®¨è®ºèŒƒç•´ï¼‰ã€‚ä¸‹é¢ï¼Œç¬”è€…ç®€å•è®¨è®ºä¸€ä¸‹æ–‡ä¸­çƒè°å‡½æ•°åœ¨vMFåˆ†å¸ƒä¸‹çš„æœŸæœ›æ±‚è§£ï¼ˆè®ºæ–‡é™„å½•éƒ¨åˆ†ï¼‰ã€‚ä½œè€…è¦è¯æ˜ï¼š <span class="math display">\[
\begin{equation}
\mathbb{E}_{\hat \omega\sim \text{vMF}({\hat\omega_r,\kappa})}[Y_l^m(\hat\omega)]=
A_l(\kappa)Y_l^m(\hat\omega_r)
\end{equation}
\]</span> â€‹ æˆ‘ä»¬åªè®¨è®ºä¸Šå¼ä¸­<span class="math inline">\(A_l(\kappa)\)</span>æ€ä¹ˆæ¥çš„ï¼Œè€Œ<strong><u>ä¸å…³å¿ƒ</u></strong>ï¼ˆæ‰€ä»¥åœ¨è¿™ä¸æ¨å¯¼ï¼‰<span class="math inline">\(A_l(\kappa)\)</span>å¦‚ä½•è¿‘ä¼¼ä¸ºé‚£ä¸ªåªä¸<span class="math inline">\(l,\kappa\)</span>æœ‰å…³çš„æŒ‡æ•°å½¢å¼ï¼ˆè¿‘ä¼¼çš„æ¨å¯¼éƒ¨åˆ†ï¼Œä½†å‡¡æœ‰ç‚¹è€å¿ƒã€‚ã€‚ã€‚emmmï¼‰ã€‚é¦–å…ˆï¼Œä½œè€…æŠŠç§¯åˆ†ç©ºé—´è¿›è¡Œäº†çº¿æ€§å˜æ¢ï¼šè¿›è¡Œäº†æ—‹è½¬ã€‚å°† <span class="math inline">\(\hat\omega_r\)</span>æ—‹è½¬è‡³zè½´ï¼Œé‚£ä¹ˆæ ¹æ®vMFåˆ†å¸ƒçš„å½¢å¼ä»¥åŠéšæœºå˜é‡å‡½æ•°çš„æœŸæœ›çš„è®¡ç®—ï¼š <span class="math display">\[
\begin{align}
&amp;P_{\text{vMF}({\hat\omega_r,\kappa})}(\omega)=c(\kappa)\exp(\kappa\hat\omega_r^T\omega)\\
&amp;\mathbb{E}_{\hat \omega\sim \text{vMF}({\hat\omega_r,\kappa})}[Y_l^m(\hat\omega)]=
c(\kappa)\int_S Y_l^m(\omega) \exp(\kappa\hat\omega_r^T\omega)d\omega\label{expect}
\end{align}
\]</span> â€‹ åˆ™å°† <span class="math inline">\(\omega&#39;=R\omega\)</span>ä¸­ï¼Œå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{align}
\mathbb{E}_{\hat \omega\sim \text{vMF}({\hat\omega_r,\kappa})}[Y_l^m(\hat\omega)]&amp;=
c(\kappa)\int_S Y_l^m(R^{-1}\omega&#39;) \exp(\kappa (R^{-1}z)^TR^{-1}\omega&#39;)dR^{-1}\omega&#39; \label{ints}\\
&amp;=c(\kappa)\int_S Y_l^m(R^{-1}\omega&#39;) \exp(\kappa z^T\omega&#39;)dR^{-1}\omega&#39; \label{intm}\\
&amp;=c(\kappa)\int_S Y_l^m(R^{-1}\omega&#39;) \exp(\kappa \cos\theta)d\omega&#39; \label{inte}
\end{align}
\]</span> â€‹ ä»å…¬å¼<span class="math inline">\(\eqref{ints}\)</span>åˆ°<span class="math inline">\(\eqref{intm}\)</span>å¾ˆå¥½ç†è§£ï¼Œæ—‹è½¬å‘é‡çš„çš„æ­£äº¤æ€§å¯ä»¥ç«‹åˆ»æŠµæ¶ˆexpä¸­çš„Rã€‚è€Œå…¬å¼<span class="math inline">\(\eqref{intm}\)</span>åˆ°<span class="math inline">\(\eqref{inte}\)</span>åˆ™ç¨å¾®æœ‰ç‚¹ç»•ï¼š</p>
<ul>
<li><span class="math inline">\(z^T\omega&#39;\)</span>æ°å¥½æ˜¯ <span class="math inline">\(\omega&#39;\)</span> çš„æ–¹ä½è§’ï¼ˆä¸­çš„ä¿¯ä»°è§’<span class="math inline">\(\theta\)</span>ï¼‰</li>
<li><span class="math inline">\(dR^{-1}\omega&#39;\)</span>ä¸­çš„ <span class="math inline">\(R^{-1}\)</span>åŸå…ˆéœ€è¦è¢«æå‡ºæ¥ï¼Œä½†ç”±äºå…¶è¡Œåˆ—å¼ä¸º1ï¼ˆæ—‹è½¬çŸ©é˜µå˜›ï¼‰ï¼Œä¸ä¼šå½±å“æœ€åå‡½æ•°è¾“å‡ºçš„å•ä¸ªå€¼çš„ç»“æœï¼ˆæ³¨æ„ï¼Œå¯¹äºæ¯ä¸€ä¸ª<span class="math inline">\(m, l\)</span>è€Œè¨€ï¼Œå…¬å¼<span class="math inline">\(\eqref{ints}\)</span>çš„è¾“å‡ºéƒ½æ˜¯ä¸€ä¸ªå€¼ï¼‰ï¼Œæ•…å¯ä»¥çœç•¥</li>
</ul>
<p>â€‹ æ­¤åï¼Œæ ¹æ®çƒè°å‡½æ•°çš„æ€§è´¨ï¼ˆæ¯”å¦‚å±•å¼€ä¸ºWigner D Matrixè¡¨ç¤ºä»¥åŠå…¶æ­£äº¤æ€§ï¼‰ï¼Œæˆ‘ä»¬æœ€åå¯ä»¥å°†å…¬å¼<span class="math inline">\(\eqref{ints}\)</span>å·¦è¾¹å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}
\mathbb{E}_{\hat \omega\sim \text{vMF}({\hat\omega_r,\kappa})}[Y_l^m(\hat\omega)]=
c(\kappa)D^{(l)}_{m0}(\hat{\omega}_r)\int_{S^2}Y_{l}^0(\hat{\omega})e^{\kappa\cos\theta} d\hat{\omega}\label{origin}
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼š<span class="math inline">\(D^{(l)}_{m0}(\hat{\omega}_r)\)</span>ä»¥åŠ<span class="math inline">\(Y_{l}^0(\hat{\omega})\)</span>çš„å½¢å¼éƒ½æ˜¯å·²çŸ¥çš„ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°äº†ï¼ˆç¡®å®å¾ˆéº»çƒ¦ï¼‰ã€‚æˆ‘ä»¬åªå°†ä¸Šå¼çš„ç§¯åˆ†éƒ¨åˆ†è¿›è¡Œæ‹†è§£ã€‚ç”±äºç§¯åˆ†å®é™…ä¸Šæ˜¯åœ¨çƒé¢ä¸Šå®Œæˆçš„ï¼Œè¿™é‡Œå®é™…è¿›è¡Œäº†ä¸€æ¬¡äºŒé‡ç§¯åˆ†ï¼ˆçƒé¢ç§¯åˆ†ï¼‰ï¼Œå°†ç¬›å¡å°”åæ ‡ç³»è½¬åŒ–ä¸ºçƒé¢çš„å¤©é¡¶è§’ï¼š<span class="math inline">\((x, y, z)\rightarrow(\theta,\phi )\)</span>ï¼Œè¿™é‡Œç»™å‡ºä¸€å¼ å›¾ï¼š</p>
<center>
<img src="/2022/08/13/Mip-NeRF-Ref-NeRF/zenith.jpg" style="zoom:50%;">
</center>
<center>
Figure 2. Ref NeRFåŠçƒç§¯åˆ†ç¤ºæ„å›¾
</center>
<p>â€‹ å›¾ä¸­çš„é»‘è‰²åœ†åœˆå°±æ˜¯â€œç§¯åˆ†å¯¹è±¡â€ï¼šå¯ä»¥çœ‹åšçƒä½“çš„ä¸ŠåŠçƒè¡¨é¢æ˜¯ç”±æ— æ•°ä¸ªåœ†ç¯ç»„æˆçš„ï¼Œå¯¹åº”äº†è§’åº¦ä¸º<span class="math inline">\(\theta\)</span>ï¼ˆç¡®å®šäº†ä½ç½®ï¼‰ï¼ŒåŠå¾„ä¸º<span class="math inline">\(\sin \theta\)</span>ï¼ˆç¡®å®šäº†å½¢çŠ¶ï¼‰çš„åœ†åœˆï¼ˆå¯çŸ¥<span class="math inline">\(\phi\)</span>çš„ç§¯åˆ†èŒƒå›´æ˜¯<span class="math inline">\(-\pi\rightarrow\pi\)</span>ï¼‰ï¼šæ•…ç§¯åˆ†å¯ä»¥æ‹†æˆï¼ˆé¦–å…ˆçŸ¥é“<span class="math inline">\(Y_l^0(\hat{\omega})=P_l(\cos\theta)\)</span>ï¼‰: <span class="math display">\[
\begin{equation}
\int_{S^2}Y_{l}^0(\hat{\omega})e^{\kappa\cos\theta} d\hat{\omega}=\int_{-\pi}^{\pi}\int_{0}^{\pi}P_l(\cos\theta)e^{\kappa\cos\theta}\sin\theta d\theta d\phi
\end{equation}
\]</span> â€‹ <span class="math inline">\(\theta\)</span>çš„èŒƒå›´æ˜¯<span class="math inline">\([0, \pi]\)</span>ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªéœ€è¦ç§¯åˆ†ä¸ŠåŠçƒã€‚ç”±äºåå°„ä¸å¯èƒ½å‘ç”Ÿåœ¨ä¸‹åŠçƒï¼Œå¯çŸ¥ä¸‹åŠçƒ<span class="math inline">\([-\pi,0]\)</span>çš„æ‰€æœ‰è¾“å‡ºéƒ½æ˜¯0ã€‚è¿™æ ·ï¼Œæ ¹æ®è®ºæ–‡ä¸­æ‰€è¯´çš„æ­¥éª¤ï¼Œè¿›ä¸€æ­¥æ›¿æ¢ç§¯åˆ†å˜é‡ï¼Œå±•å¼€å¹¶ç®€åŒ–å¯ä»¥æ¨å‡ºIDEå…¬å¼ã€‚</p>
<p>â€‹ ä½†æ˜¯ï¼Œé€‰æ‹©å®å‡½æ•°å½¢å¼çš„çƒè°å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚é¦–å…ˆï¼Œå…¬å¼<span class="math inline">\(\eqref{real_sh}\)</span>å·²ç»å±•ç¤ºäº†å®å‡½æ•°å½¢å¼çš„å¤æ‚æ€§ï¼ˆä¸»è¦æ˜¯æœ‰åˆ†æ”¯ï¼‰ï¼›æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°ï¼Œè§’åº¦å½¢å¼çš„SHéœ€è¦æŠŠæ–¹å‘å‘é‡è½¬åŒ–ä¸ºå¤©é¡¶è§’ï¼Œè¿™ç§é¢å¤–çš„æ“ä½œçœ‹ç€å°±å¾ˆä¸ä¼˜é›…ã€‚å»ºè®®ä½¿ç”¨ç¬›å¡å°”åæ ‡ç³»å½¢å¼çš„çƒè°å‡½æ•°ã€‚å‚è§<a href="https://en.wikipedia.org/wiki/Spherical_harmonics#Separated_Cartesian_form">Wikipedia/Shperical Harmonics - Separated Cartesian form</a>ï¼Œå¯åˆºæ¿€äº†ï¼Œè™šå‡½æ•°è¿ç®—ä¸äºŒé¡¹å¼å…¬å¼çš„ç»“åˆå“¦ã€‚ä¸è¿‡åªè¦ä½¿ç”¨è¿™ç§æ–¹æ³•å®ç°ï¼Œåˆ©ç”¨Pytorchå°±å¾ˆç®€å•ï¼š</p>
<ul>
<li>é¦–å…ˆPytorchæ”¯æŒè™šæ•°è¿ç®—ã€‚è¿™é‡Œåæ§½ä¸€ä¸‹ï¼ŒPytorchæ”¯æŒçš„è™šæ•°è¿ç®—åŸºäº<code>torch.complex64</code>ç±»å‹ï¼Œä¸€çœ‹åˆ°<code>64</code>å°±çŸ¥é“æ€ä¹ˆå›äº‹äº†ï¼Œè¿ç®—é‡å¯èƒ½ç­‰åŒäºfloat32è¿ç®—ï¼ˆä¸¤ä¸ªfloat32å­˜åœ¨ä¸€å—ï¼‰ï¼Œåœ¨ä½¿ç”¨auto mixed precisionæ—¶ï¼Œcomplex32å°†å¯èƒ½äº§ç”Ÿä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œå¾ˆå¤šç®—å­éƒ½æ²¡æœ‰å¯¹complex32æœ‰æ”¯æŒã€‚è€Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨APEXåº“çš„O2ç­‰çº§ä¼˜åŒ–ï¼Œæ‰€æœ‰çš„float32éƒ½ä¼šå˜æˆfloat16ï¼Œé‚£ä¹ˆè¿™é‡Œå‚ä¸è¿ç®—çš„å¤æ•°å°±ä¼šäº§ç”Ÿä¸€ç³»åˆ—æœªå®šä¹‰ç®—å­çš„é—®é¢˜ã€‚ï¼ˆä»€ä¹ˆComplexHalfæœªå®šä¹‰è¿™äº›ç®—å­å•Šä¹‹ç±»çš„æŠ¥é”™ï¼‰</li>
<li>SHåœ¨è¿™å°±æ˜¯ç”¨ä½œencodingï¼Œæ‰€ä»¥å…¶å®åªéœ€è¦å°†ç»“æœçš„å®éƒ¨ã€è™šéƒ¨å–å‡ºæ¥ä½œä¸ºencodingçš„æˆåˆ†å°±å¥½äº†ã€‚å¯ä»¥è®¤ä¸ºï¼ŒåŸæ¥çš„positional encodingæ˜¯ç”¨äº†æ­£äº¤ç›¸ä½çš„ä¸¤ç§åŸºåº•è¿›è¡Œè¡¨ç¤ºï¼Œè€ŒSHå…¶å®ä¹Ÿæ˜¯æ­£äº¤çš„ä¸¤ç§åŸºåº•ï¼ˆå®ä¸è™šåœ¨è™šå¹³é¢ä¸Šæ˜¯æ­£äº¤çš„ï¼‰è¿›è¡Œè¡¨ç¤ºã€‚</li>
</ul>
<hr>
<h2 id="iii.-å¤ç°ç»†èŠ‚">III. å¤ç°ç»†èŠ‚</h2>
<h3 id="å€¼å¾—ä¸€æçš„ç‚¹">3.1 å€¼å¾—ä¸€æçš„ç‚¹</h3>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/network.png" style="zoom:50%;"></p>
<center>
Figure 3. Ref-NeRFç½‘ç»œç»“æ„
</center>
<p>â€‹ å…¶å®ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚æ ¹æ®Ref NeRFè®ºæ–‡å›¾ï¼Œå¤ç°çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="note info"><p>â€‹ é¦–å…ˆä¿®æ”¹spatial networkï¼Œåœ¨spatia networkä¹‹åè¿½åŠ ä¸‰ä¸ªheadã€‚ä¸‰ä¸ªheadçš„è¾“å…¥å°±æ˜¯spatial networkçš„è¾“å‡ºï¼š</p>
<ul>
<li><p>opacity &amp; roughness head: ç”±äºÏ„ï¼ˆdensityï¼‰ä¸Ïï¼ˆroughnessï¼‰éƒ½æ˜¯æ²¡æœ‰è¾“å‡ºèŒƒå›´é™åˆ¶çš„ï¼ˆä½†æ˜¯éƒ½éœ€è¦å¤§äº0ï¼Œæ•…Ïä¹‹åä¸Ï„ç±»ä¼¼ï¼Œå•ç‹¬å¤„ç†å³å¯ï¼‰ã€‚æ³¨æ„roughnessä¸opacityéƒ½éœ€è¦ç»è¿‡biasä¹‹åå†é€šè¿‡softplusæ¿€æ´»ï¼ˆè½¯ReLUï¼‰</p></li>
<li><p>color &amp; tint head: <span class="math inline">\(c_d,s\)</span>éƒ½æ˜¯[0, 1] ä¹‹é—´çš„å€¼ï¼Œæ•…è¾“å‡ºç›´æ¥å˜6ç»´ã€‚colorä¸tintéƒ½ä½¿ç”¨sigmoidè¿›è¡Œæ¿€æ´»ï¼Œä¸è¿‡biasä¸åŒã€‚</p></li>
<li><p>normal headï¼šé¢„æµ‹æ³•å‘é‡ï¼Œä¸‰ç»´ï¼Œéœ€è¦è¿›è¡Œnormalizeï¼Œä¸éœ€è¦ä»»ä½•æ¿€æ´»</p></li>
</ul>
</div>
<div class="note success"><p>â€‹ éœ€è¦ç»•ä¸€ä¸‹çš„éƒ¨åˆ†æ˜¯æ³•å‘é‡ã€‚æ³•å‘é‡çš„æ¥æºæœ‰ä¸¤ä¸ªï¼šï¼ˆ1ï¼‰spatial networkè®¡ç®—çš„densityï¼Œå¯ä»¥å¯¹ä½ç½®æ±‚å¯¼ã€‚Pytorchä¸­ï¼Œè¦å®ç°å¯¹ä½ç½®æ±‚å¯¼éœ€è¦ä½¿å¾—è¾“å…¥çš„ä½ç½®å‘é‡å¯å¯¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fine_pos.requires_grad = <span class="literal">True</span>										    <span class="comment"># æ­¤æ­¥å¿…è¦	</span></span><br><span class="line">fine_rgbo, pred_normal = mip_net.forward(fine_pos, fine_dir)</span><br><span class="line">r_num, p_num, _ = fine_rgbo.shape</span><br><span class="line">density_grad, = torch.autograd.grad(fine_rgbo[..., -<span class="number">1</span>], fine_pos, 			  <span class="comment"># fine_pos æ˜¯å¯ä¼˜åŒ–çš„</span></span><br><span class="line">       torch.ones(r_num, p_num, device = fine_rgbo.device), retain_graph = <span class="literal">True</span> <span class="comment"># retain graphä½¿å¾—è®¡ç®—å›¾å¯ä»¥ç»§ç»­backward</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>â€‹ å¦ä¸€ä¸ªæ¥æºå°±æ˜¯spatial networkä¹‹åçš„normal headï¼Œé¢„æµ‹ã€‚é¢„æµ‹çš„ç»“æœåœ¨ç»è¿‡æ­£åˆ™åŒ–ï¼ˆorientation lossï¼‰ä»¥åŠé¢„æµ‹è¯¯å·®ï¼ˆä¸density gradçš„å·®åˆ«ï¼‰backwardä¹‹åï¼Œåº”å½“å¯ä»¥å­¦å‡ºè¾ƒå¥½çš„ç»“æœã€‚</p>
</div>
<p>â€‹ æ­¤å¤–æ³¨æ„ï¼Œdirectional networkå˜æ·±äº†ã€‚å¯ä»¥è®¤ä¸ºdirectional networkæœ‰spatial networkä¸€æ ·çš„ç»“æ„ï¼ˆåŒ…æ‹¬8å±‚256 hidden unitsçš„MLPï¼Œå¹¶ä¸”æœ‰skip connectionï¼‰ã€‚</p>
<h3 id="ä¸€äº›å‘">3.2 ä¸€äº›å‘</h3>
<p>â€‹ ç”±äºç¬”è€…å¤ç°Ref NeRFåŸºäºä¹‹å‰å®ç°çš„<a href="https://github.com/Enigmatisms/NeRF">Enigmatisms/NeRF</a>ï¼Œè¿™ä¸ªrepoä¸­å®ç°çš„NeRFå¹¶éåŸå§‹NeRFï¼Œè€Œæ˜¯mip NeRF 360ï¼ˆéƒ¨åˆ†ï¼‰ï¼Œä¸»è¦åŒ…å«è¿™æ ·çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>æœ¬repoå®ç°äº†mip NeRF 360ä¸­çš„proposal network distillationã€‚ä¹Ÿå³ï¼šcoarse-to-fineçš„stratified samplingå¹¶æ²¡æœ‰ä½¿ç”¨ã€‚stratified samplingéå¸¸æ…¢ï¼ˆç”±äºcoarse networkéœ€è¦forwardæ‰€æœ‰ç‚¹ï¼Œfine networkä¹Ÿè¦forwardï¼‰ï¼Œproposal networkåˆ™æ˜¯ç”¨æµ…MLPï¼ˆ5å±‚ï¼‰ï¼Œforwardç‚¹åç›´æ¥è¾“å‡ºé¢„æµ‹çš„densityï¼Œå†åˆ©ç”¨fine networkè¾“å‡ºçš„densityï¼ˆweightï¼‰è¿›è¡Œç›‘ç£ã€‚è¿™æ ·å°±èƒ½å®Œæˆä»fine networkåˆ°proposal networkçš„è’¸é¦ã€‚æ­¤è’¸é¦çš„å®ç°è¾ƒä¸ºå¤æ‚ï¼ˆweight boundçš„è®¡ç®—ï¼‰ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚æˆ‘ä¹Ÿä¸æƒ³å•å¼€ä¸€ç¯‡åšå®¢è®¨è®ºã€‚</li>
<li>ä½¿ç”¨äº†è‡ªåŠ¨æ··åˆç²¾åº¦ï¼ˆampï¼‰ï¼Œå¯ä»¥é€‰ç”¨apexæˆ–è€…torch.native_scaler</li>
</ul>
<p>â€‹ proposal networkç€å®å‘äº†æˆ‘ä¸€æŠŠã€‚å¤ç°å®Œæˆï¼ˆç¬¬ä¸€ç‰ˆï¼‰ä¹‹åï¼Œè·‘äº†ä¸€ä¸‹shinny blenderçš„ballæ•°æ®é›†ï¼š</p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/false_ball_2.png" style="zoom: 67%;"></p>
<center>
Figure 4. ä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šå™ªç‚¹ï¼Ÿ
</center>
<p>â€‹ å¦‚ä¸Šå›¾ç¬¬ä¸€åˆ—ï¼šå¾ˆå¤šå™ªç‚¹ã€‚è¿™äº›å™ªç‚¹æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¼€å§‹æˆ‘ä¹Ÿä¸æ•¢ä¸‹ç»“è®ºï¼Œæ¯•ç«Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯è‡ªå·±çš„ref nerfå¤ç°æœ‰é—®é¢˜ã€‚äºæ˜¯æˆ‘å°†æ·±åº¦ä»¥åŠnormaléƒ½å¯è§†åŒ–äº†å‡ºæ¥ï¼ˆåä¸¤åˆ—ï¼‰ã€‚å¯è§ï¼Œæ·±åº¦å›¾ä¸­ä¹Ÿå­˜åœ¨å¾ˆå¤šç©ºæ´ï¼Œnormalå°±ä¸è¯´äº†å§ï¼ˆäº‹å®ä¸Šï¼Œnormalå­¦ä¹ ä¸€ç›´æœ‰é—®é¢˜ï¼Œnormalæœ¬èº«å°±æ¯”è¾ƒéš¾å­¦ï¼‰ã€‚ç©ºæ´äº§ç”Ÿçš„å¯èƒ½åŸå› æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>densityå­¦ä¹ æœ‰é—®é¢˜ï¼Œæœ‰äº›ä½ç½®densityéå¸¸ä½</li>
<li>é‡‡æ ·ï¼ˆä¸ç®¡æ˜¯è®­ç»ƒè¿˜æ˜¯æµ‹è¯•æ—¶ï¼‰ä½ç½®ä¸å¯¹ï¼Œé‡‡æ ·åœ¨äº†ä¸€äº›ç©ºçš„ä½ç½®</li>
</ul>
<p>â€‹ äºæ˜¯æˆ‘å¼€äº†ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œåœ¨æ­¤åˆ†æ”¯ä¸Šæˆ‘å°†proposal networkåˆ æ‰äº†ï¼Œä½¿ç”¨åŸå§‹NeRFçš„coarse-to-fineæ¡†æ¶è¿›è¡Œæµ‹è¯•ã€‚å¯¹æ¯”å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå·¦è¾¹ä¸ºåŸå§‹proposal networkå­˜åœ¨æ—¶ï¼Œè®­ç»ƒ60è½®ä¹‹åçš„ç»“æœï¼Œè€Œå³è¾¹åˆ™ä¸ºåŸå§‹NeRFè®­ç»ƒ40è½®ä¹‹åçš„ç»“æœã€‚å¯ä»¥çœ‹å‡ºï¼ŒåŸå§‹NeRFæ¡†æ¶ä¸‹çš„é‡‡æ ·æ˜¯ï¼ˆè‡³å°‘ç›¸å¯¹ä¸Šæ˜¯ï¼‰æ²¡é—®é¢˜çš„ã€‚ä½†ç¬”è€…å¹¶ä¸æƒ³æ”¾å¼ƒproposal networkï¼ˆä¸ªäººè§‰å¾—è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒä¼˜é›…ï¼‰ï¼Œæ•…ç¬”è€…å°†proposal networkè¿›è¡Œäº†å°çš„æ”¹åŠ¨ï¼š</p>
<!-- tab åŸå§‹Proposal Network -->
<p>â€‹ åŸå§‹prop netè¾“å…¥coarse pointsä¹‹åï¼Œè¾“å‡ºdensityï¼Œæ­¤åcoarse pointså°†ä¼šè¢«å¼ƒç”¨ã€‚æ ¹æ®densityè®¡ç®—çš„weightï¼Œå°†æŒ‡å¯¼inverse samplingï¼Œfine networkçš„è¾“å…¥åªä¸ºinverse samplingçš„ç»“æœï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œé›†ä¸­åœ¨weighté«˜çš„åœ°æ–¹ï¼‰ã€‚å‡è®¾ï¼Œprop netè®¡ç®—çš„densityæœ‰ç¼ºé™·ï¼Œä¹Ÿå³weightæœ‰ç¼ºé™·ï¼Œåœ¨å®é™…çš„è¡¨é¢é™„è¿‘weightå¾ˆå°ï¼Œåœ¨ç©ºåŸŸä¸­weightå¤§ï¼Œé‚£ä¹ˆinverse samplingå¯èƒ½æ— æ³•åœ¨æ­¤æ¡å…‰çº¿ä¸Šé‡‡åˆ°æœ‰æ•ˆçš„ç‚¹ã€‚</p>
<!-- endtab -->
<!-- tab ä¿®æ”¹åçš„Proposal Network -->
<p>â€‹ å¾ˆç®€å•ï¼Œå°±æ˜¯å¤ç”¨coarse pointsï¼Œå°†coarse depthsï¼ˆé‡‡æ ·çš„é•¿åº¦ï¼‰ä¸inverse samplingçš„é‡‡æ ·é•¿åº¦ï¼ˆfine depthsï¼‰è¿›è¡Œæ‹¼æ¥ï¼Œæ’åºã€‚ä½†å…¶å®åœ¨å®ç°ä¸­ï¼Œè¦è€ƒè™‘proposal networkçš„weight boundè®¡ç®—ã€‚å•Šï¼Œè¿™ä¸€æ­¥å¾ˆå¤æ‚ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼š</p>
<ul>
<li>proposal networkéœ€è¦é¢„æµ‹æ¯ä¸€ä¸ªé‡‡æ ·ç‚¹ï¼ˆfineé‡‡æ ·ç‚¹ï¼‰çš„weightä¸Šç•Œï¼ˆweight boundï¼‰ã€‚ä¸Šç•Œå¦‚ä½•è®¡ç®—ï¼Ÿä¸¤ä¸ªfineé‡‡æ ·ç‚¹ä¹‹é—´ä¼šå­˜åœ¨ä¸€ä¸ªé‡‡æ ·åŒºé—´ï¼Œæ­¤åŒºé—´å°†ä¼šä¸coarseé‡‡æ ·çš„åŒºé—´é‡åˆï¼Œåˆ™æ­¤fineé‡‡æ ·åŒºé—´çš„weightä¸Šç•Œåº”è¯¥æ˜¯æ‰€æœ‰ä¸ä¹‹æœ‰äº¤é›†çš„coarseåŒºé—´weightä¹‹å’Œã€‚</li>
<li>coarse pointsåˆå¹¶åˆ°fine pointsç›¸å½“äºä¿®æ”¹äº†fineé‡‡æ ·åŒºé—´ã€‚é‚£ä¹ˆå°±éœ€è¦è®¡ç®—æ›´å¤šåŒºé—´äº¤é›†ã€‚è¿™é‡Œæˆ‘ä¸èµ˜è¿°æ–¹æ³•ï¼Œè¯¦è§ï¼š<a href="https://github.com/Enigmatisms/NeRF/blob/635509b005a3272a0cddeac60a7aeac9432dddd1/py/nerf_base.py#L53">NeRF/coarseFineMerge</a>ä»¥åŠ<a href="https://github.com/Enigmatisms/NeRF/blob/635509b005a3272a0cddeac60a7aeac9432dddd1/py/addtional.py#L15">NeRF/getBounds</a></li>
</ul>
<!-- endtab -->
<p>â€‹ è¿™æ ·ä¿®æ”¹ï¼Œä¹Ÿå°±ä½¿å¾—æ¯æ¡å…‰çº¿ä¸Šï¼Œæ—¢æœ‰å‡åŒ€é‡‡æ ·çš„éƒ¨åˆ†ï¼ˆä¿è¯äº†coverageï¼‰ï¼Œåˆä½¿å¾—densityå¤§çš„éƒ¨åˆ†å¯ä»¥æœ‰æ›´å¤šé‡‡æ ·ç‚¹ã€‚å¯èƒ½æœ‰äººè§‰å¾—ï¼Œä¸å°±æ˜¯å¢åŠ äº†ä¸€äº›é‡‡æ ·ç‚¹å—ï¼Ÿè¿™æ ·ä¸ºä»€ä¹ˆèƒ½ä¿è¯proposal networkçš„å­¦ä¹ æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œç½‘ç»œä¸ä»…æœ‰æ›´åŠ å……è¶³çš„è¾“å…¥ï¼Œfine networkæä¾›ç»™proposal networkçš„ç›‘ç£ä¹Ÿæ›´åŠ å……è¶³äº†ï¼ˆè§ã€ä¿®æ”¹åçš„Proposal Networkã€‘éƒ¨åˆ†ï¼Œå…¶ä¸­æˆ‘ä»¬è¯´åˆ°â€œæ›´å¤šçš„åŒºé—´äº¤é›†â€ï¼‰ã€‚</p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/result_001.png" style="zoom:67%;"></p>
<center>
Figure 5. shinny blender helmetæ•°æ®é›†ï¼Œè®­ç»ƒ20è½®
</center>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">æ— proposal net è®­ç»ƒ40è½®ï¼ˆ4kæ¬¡ï¼‰</th>
<th style="text-align: center;">æœ‰proposal net è®­ç»ƒ60è½®ï¼ˆ6kæ¬¡ï¼‰</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/no_prop_002.png"></td>
<td style="text-align: center;"><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/prop_003.png"></td>
</tr>
</tbody>
</table>
<p>â€‹ ä¿®æ”¹åçš„æ–¹æ³•ï¼Œåªè®­ç»ƒ20è½®è¾“å‡ºåçš„ç»“æœå°±è®©æˆ‘è§‰å¾—è‚¯å®šæ˜¯æ”¹å¯¹äº†ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚æ¥ä¸‹æ¥å°†å±•ç¤ºã€æœªå®Œæˆè®­ç»ƒã€‘æ—¶çš„è®­ç»ƒç»“æœã€‚ç”±äºåŸå§‹Ref NeRFä½¿ç”¨<span class="math inline">\(2^{14}\)</span>å¤§å°çš„batchï¼Œéœ€è¦è®­ç»ƒ250kè½®ã€‚æˆ‘è®¾å¤‡èƒ½åŠ›æœ‰é™ï¼Œåªbatchå¤§å°ä¸º<span class="math inline">\(2^9\)</span>ï¼ˆå·®äº†32å€ï¼‰ï¼Œä¹Ÿæ²¡è®­ç»ƒåˆ°250kå°±å…ˆæš‚åœäº†ï¼ˆç¬‘æ­»ï¼Œæˆ‘çš„3060 for laptopï¼Œæœ‰ä¸ªé£æ‰‡åäº†ï¼Œè®­ç»ƒçš„æ—¶å€™èƒ½é£™åˆ°83åº¦ï¼Œæ‰€ä»¥æˆ‘å¾—å¼€ä¸€å°ç”µé£æ‰‡å¯¹ç€æˆ‘ç”µè„‘å¹ï¼‰ã€‚ä¸‹é¢æ˜¯ç®€å•çš„ç»“æœå±•ç¤ºï¼š</p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/curves.png"></p>
<center>
Figure 6. è®­ç»ƒä¸æ˜¯ä¸€æ¬¡å®Œæˆçš„ï¼Œä¿å­˜checkpointçŸ­ç‚¹ç»­è®­ã€‚æ”¶æ•›æ€§å¹¶ä¸å¥½
</center>
<p>â€‹ ä»ä¸Šå›¾çœ‹å‡ºï¼Œè™½ç„¶è®­ç»ƒåº”è¯¥è¿œæ²¡æœ‰ç»“æŸï¼ˆè¿™æ‰ä¸åˆ°7å°æ—¶ï¼‰ï¼ŒPSNRæ›²çº¿çš„ä¸Šå‡èƒ½åŠ›å±å®å ªå¿§ã€‚ç¬”è€…æ„Ÿè§‰PSNRæ— æ³•ä¸Šå‡è‡³è®ºæ–‡ä¸­çš„29ï¼Œä¸ªäººè®¤ä¸ºå¯èƒ½çš„é—®é¢˜ä»ç„¶æ˜¯å‡ºåœ¨proposal networkä¸Šã€‚ç›®å‰æ­£åœ¨å°è¯•ä¸€ç§æ”¹è¿›çš„æ–¹æ³•ã€‚</p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/Screenshot%20from%202022-08-19%2013-31-01.png"></p>
<center>
Figure 7. æœ‰è¶£çš„æ‰‹åŠ¨é€€ç«
</center>
<p>â€‹ æ•ˆæœå¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼šRGBï¼Œæ·±åº¦ä¸æ³•å‘é‡ã€‚emmï¼Œæ³•å‘é‡å¤§æ¦‚æ˜¯å¯è§†åŒ–é”™äº†ã€‚ä¸è¿‡å­¦çš„åº”è¯¥ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œåœ¨æŸäº›è§†è§’èƒ½çœ‹åˆ°å¤´ç›”ä¸Šçš„æ¡çº¹å¯¹åº”çš„æ³•å‘é‡ä¸å…¶ä»–ä½ç½®ä¸ä¸€è‡´ã€‚PSNRä¸º19ï¼Œè¿˜æ˜¯å¤ªæ¨¡ç³Šäº†ä¸€ç‚¹ã€‚</p>
<p><img src="/2022/08/13/Mip-NeRF-Ref-NeRF/ezgif-1-8207b1faa2.gif"></p>
<center>
Figure 8. æ—‹è½¬å¤´ç›”
</center>
<hr>
<h2 id="reference">Reference</h2>
<ul>
<li><p>https://en.wikipedia.org/wiki/Spherical_harmonics</p></li>
<li><p>https://en.wikipedia.org/wiki/Associated_Legendre_polynomials</p></li>
<li><p>æ‰©å±•é˜…è¯»: https://dellaert.github.io/NeRF22/</p></li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>NeRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Mip NeRFæ€æƒ³æ³¨å…¥ä¸æ›´å¤šçš„NeRFæ–¹æ³•</title>
    <url>/2022/05/03/Mip-NeRF%E6%80%9D%E6%83%B3%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%9B%B4%E5%A4%9A%E7%9A%84NeRF%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>â€‹ ï¼ˆæœªå®Œæˆï¼Œè¯·å‹¿ç‚¹å‡»ï¼‰ã€‚æœ€è¿‘è¯»äº†éå¸¸å¤šå…³äºNeRFçš„è®ºæ–‡ï¼Œæ¯•ç«Ÿè¿™ç©æ„ä»ECCV 2020è¢«æå‡ºæ¥ä¹‹åå°±çˆ†ç«äº†ï¼Œå˜ä½“å±‚å‡ºä¸ç©·ï¼ŒåŸºæœ¬ä¸Šæˆ‘èƒ½æƒ³åˆ°çš„å·æ³•ï¼Œéƒ½æœ‰äººå·è¿‡äº†ã€‚ä½å‚çš„æœå®æ€»æ˜¯è¢«æœ‰èƒ½åŠ›åˆæœ‰å‡†å¤‡çš„äººå…ˆæ‘˜èµ°ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯ä¸€äº›éœ€è¦è´¹å¤§åŠ›æ°”æ‰èƒ½æ‘˜åˆ°çš„æœå®ã€‚è®ºæ–‡ä¸ä»…éœ€è¦è¯»ï¼Œå¥½çš„è®ºæ–‡ä¸€å®šè¦å¤ç°ï¼Œæ‰èƒ½æ·±å…¥äº†è§£å…¶ç²¾é«“ï¼Œè¥¿å®‰äº¤å¤§äººå·¥æ™ºèƒ½å­¦é™¢çš„åˆ˜é¾™å†›å‰¯æ•™æˆæ›¾ç»åœ¨ç»„ä¼šä¸Šè¯´åˆ°ï¼šè¯»è®ºæ–‡ä¸å¤ç°ç­‰äºç™½è¯»ï¼å¤§å®¶éƒ½æ·±ä»¥ä¸ºç„¶:&gt;ã€‚è€Œå…¶ä¸­æœ€æœ‰å¤ç°ä»·å€¼ï¼ˆå¹¶ä¸”éš¾åº¦æ²¡é‚£ä¹ˆé«˜çš„ï¼Œä¸åƒInstant NGPï¼Œofficial repoä»£ç éƒ½çœ‹ä¸æ‡‚ï¼‰çš„å½“å±ï¼š</p>
<ul>
<li>ICCV 2021: <a href="https://arxiv.org/abs/2103.13415">Mip-NeRF: A Multiscale Representation for Anti-Aliasing Neural Radiance Fields</a></li>
<li>ECCV 2022: <a href="https://arxiv.org/abs/2111.12077">Mip-NeRF 360: Unbounded Anti-Aliased Neural Radiance Fields</a></li>
</ul>
<p>â€‹ å…¶ä¸­Mip NeRF 360ä¸­çš„proposal networkå·²ç»æˆä¸ºç›®å‰ä¸ªäººæ‰€å®ç°çš„NeRFæ¡†æ¶çš„åŸºç¡€ã€‚æœ¬æ–‡æ˜¯å¤ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ä»¥åŠå¯¹å…¶ä»–æ‰€è¯»çš„NeRFè®ºæ–‡çš„æ€»ç»“ã€‚</p>
<span id="more"></span>
<h2 id="section"></h2>
<p>â€‹ Neural surface reconstructionæ–¹æ³•ï¼Œåˆ©ç”¨å¤šè§†è§’å›¾ç‰‡å¯¹è¡¨é¢è¿›è¡Œå»ºæ¨¡ã€‚ä¸ªäººè®¤ä¸ºï¼Œè¿™æ ·çš„æ–¹æ³•å­˜åœ¨ä»¥ä¸‹ä¼˜ç‚¹ä¸ç¼ºç‚¹ï¼š</p>
<ul>
<li>å·²çŸ¥NeRFå¯¹äºdensityã€æ³•å‘é‡ä»¥åŠè¡¨é¢çš„å»ºæ¨¡éå¸¸åƒåœ¾ï¼ˆdensityäº‘é›¾æ•ˆåº”ï¼Œè¡¨é¢å»ºæ¨¡éå¸¸ç²—ç³™ã€å™ªå£°å¾ˆå¤šï¼Œæ³•å‘é‡éåˆ†å—å¹³æ»‘ï¼‰</li>
<li>è€Œå¯¹äºè¡¨é¢çš„å»ºæ¨¡å¾ˆæœ‰å¯èƒ½ä¼šä½¿å¾—åŠé€æ˜ç‰©ä½“çš„å»ºæ¨¡èƒ½åŠ›ä¸‹é™ï¼ˆç”±äºè¡¨é¢å»ºæ¨¡ä¸€èˆ¬æœŸæœ›è¡¨é¢densityè¾ƒä¸ºé›†ä¸­ï¼‰</li>
</ul>
<p>â€‹ å¯¹äºä¸ªäººè€Œè¨€ï¼Œæœ¬ç¯‡è®ºæ–‡ä»…ä½œä¸ºäº†è§£ï¼ˆçŸ¥é“å¯¹åº”çš„æ–¹æ³•ï¼‰ï¼Œå¹¶ä¸å‡†å¤‡å®é™…ä½¿ç”¨ç±»ä¼¼çš„æ€æƒ³ï¼ˆä¸ªäººæ›´æƒ³å¯¹æ‰€æœ‰æè´¨éƒ½èƒ½è¿›è¡Œå»ºæ¨¡ï¼‰ã€‚</p>
<p>â€‹ NeuSä¸­çš„RGBé¢„æµ‹ä¸NeRFä¸€è‡´ï¼Œä¸»è¦åŒºåˆ«åœ¨äºdensityä»¥åŠweightçš„è®¡ç®—ã€‚NeuSå°±æ˜¯å¸Œæœ›densityå¯ä»¥é›†ä¸­åœ¨è¡¨é¢é™„è¿‘ï¼Œä¸äº§ç”Ÿäº‘é›¾æˆ–è€…å¥‡å¼‚çš„è‡ªé®æŒ¡ï¼Œåˆ©ç”¨densityæ±‚å¾—çš„weightä¹Ÿéœ€è¦å…·æœ‰ä¸€å®šçš„æ€§è´¨ï¼Œä¸»è¦æ˜¯ <strong><u>æ— åæ€§</u></strong>ï¼ˆunbiasedï¼‰ä»¥åŠ <strong><u>é®æŒ¡æ„ŸçŸ¥æ€§</u></strong>ï¼ˆocclusion-awareï¼‰ã€‚å¯¹äºNeRFè€Œè¨€ï¼Œé®æŒ¡æ„ŸçŸ¥æ€§æ˜¯å·²ç»å…·å¤‡çš„æ€§è´¨ï¼Œåœ¨weightçš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œâ€œaccumulated transmittanceâ€ä¸æ–­ç´¯ä¹˜ï¼ˆå°äºç­‰äº1çš„å€¼ï¼‰ï¼Œå½¢æˆçš„weightåœ¨å…‰çº¿å‰æ®µé€šè¿‡ä¸é€æ˜ç‰©ä½“æ—¶å°†æ˜¾è‘—é™ä½ï¼Œè¿™æ ·ä½¿å¾—è¢«é®æŒ¡çš„ç‰©ä½“/è¡¨é¢ä¸ä¼šå½±å“æ¸²æŸ“çš„ç»“æœã€‚è€ŒNeRFçš„weightåˆ™ä¸å­˜åœ¨æ— åæ€§ï¼Œç”±äºæ­£å¸¸æƒ…å†µä¸‹ï¼Œdensityå°†ä¼šåœ¨è¡¨é¢é™„è¿‘å­˜åœ¨å³°å€¼ï¼Œè€Œç”±äºaccumulated transmittanceå°†ä½¿å¾—weightå‘ç”Ÿç§»åŠ¨ï¼ˆé€šå¸¸éƒ½æ˜¯å‘å‰ï¼Œç‰¹åˆ«æ˜¯åœ¨è¡¨é¢é™„è¿‘çš„densityè¾ƒä¸ºåˆ†æ•£æ—¶ï¼‰ï¼Œä½¿ç”¨è¿™æ ·çš„densityæ— æ³•ä¼°è®¡å‡ºå¥½çš„è¡¨é¢ã€‚</p>
<p>â€‹ ä½œè€…çš„è¡¨é¢å»ºæ¨¡ä½¿ç”¨SDFè¿›è¡Œè¡¨å¾ï¼ˆå¤–æ­£å†…è´Ÿï¼‰ï¼Œä½œè€…ä½¿ç”¨åä¸ºS-densityçš„å‡½æ•°ä½œä¸ºè¡¨é¢é™„è¿‘densityçš„åˆ†å¸ƒã€‚æ­¤densityå®é™…ä¸Šæ˜¯sigmoidå‡½æ•°çš„å¯¼æ•°ï¼Œè®¡ç®—è¾ƒä¸ºç®€å•ï¼š <span class="math display">\[
\begin{align}
\phi_s(t)=\frac{se^{-sx}}{(1+e^{-sx})^2},\label{wf}\\
\Phi_s(t)=\frac{1}{1+e^{-sx}}\\
w(t)=\frac{\phi_s(f(p(t)))}{\int_{-\infin}^{+\infin}\phi_s(f(p(u)))du}\label{weight}
\end{align}
\]</span> â€‹ ç”±äºæˆ‘ä»¬å®é™…éœ€è¦è®¾è®¡ä¸€ç§åŒæ—¶å…·å¤‡æ— åæ€§ä»¥åŠé®æŒ¡æ„ŸçŸ¥æ€§çš„weightï¼Œç›´æ¥ä½¿ç”¨å½’ä¸€åŒ–çš„S-densityæ˜¾ç„¶æ˜¯æ²¡æœ‰åŠæ³•æ»¡è¶³è¦æ±‚çš„ï¼ˆå…³äºè¡¨é¢å¯¹ç§°ï¼Œä¸æ»¡è¶³é®æŒ¡æ„ŸçŸ¥æ€§ï¼‰ã€‚ä½œè€…å…ˆä»æ— åæ€§å‡ºå‘ï¼Œå¯»æ‰¾ä¸€ä¸ªä¸é€æ˜åº¦densityï¼ˆopacity densityï¼‰ï¼Œä½¿å¾—æ ¹æ®æ­¤densityé€šè¿‡ä½“ç§¯æ¸²æŸ“è®¡ç®—çš„weightå°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{wf}\)</span>ã€‚å¯èƒ½æ­¤æ—¶æœ‰äººä¼šæœ‰ç–‘é—®ï¼šä¸æ˜¯è¯´ä»¥å…¬å¼<span class="math inline">\(\eqref{wf}\)</span>ç¡®å®šçš„weightä¸å…·æœ‰é®æŒ¡æ„ŸçŸ¥æ€§å—ï¼Ÿä½œè€…åœ¨ä¿è¯æ— åæ€§ä¹‹åå¯¹æ­¤é—®é¢˜è¿›è¡Œäº†è®¨è®ºã€‚é¦–å…ˆï¼Œä½œè€…éµå¾ªNeRFçš„ä½“ç§¯æ¸²æŸ“å…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{derive1}
T(t)\rho(t)=w(t),\text{ where }T(t)=\exp{\left(-\int_0^t\rho(u)du\right)}
\end{equation}
\]</span> â€‹ å…¶ä¸­tæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯SDFå‡½æ•°å€¼ï¼Œåœ¨è®¨è®ºæ— åæ€§æ—¶å…ˆè®¨è®ºæœ€ç®€å•çš„æƒ…å†µï¼š<strong><u>å¹³é¢å•éšœç¢ç‰©</u></strong>ã€‚å•ä¸ªå¹³é¢éšœç¢ç‰©çš„SDFå¾ˆç®€å•ï¼Œå°±æ˜¯<span class="math inline">\(-|\cos\theta|(t-t^*)\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(t,t^*\)</span>éƒ½ä»£è¡¨å…‰çº¿æ–¹å‘çš„æ·±åº¦å€¼ï¼Œ<span class="math inline">\(\theta\)</span>ä¸ºå…¥å°„æ–¹å‘äºå¹³é¢æ³•å‘é‡çš„å¤¹è§’ã€‚åˆ™æ ¹æ®æŒ‡æ•°å‡½æ•°çš„æ€§è´¨ä»¥åŠå¹³é¢çš„SDFå…¬å¼ï¼Œä»£å…¥å…¬å¼<span class="math inline">\(\eqref{weight},\eqref{derive1}\)</span>ï¼Œå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
T(t)\rho(t)=|\cos\theta|\phi_s(f(p(t)))\mathop{\longrightarrow}^{T(t)\rho(t)=-\frac{dT}{dt}(t)}T(t)=\Phi_s(f(p(t)))
\end{equation}
\]</span> â€‹ ä¹Ÿå³å¾—åˆ°accumulated transmittanceçš„å½¢å¼å°±æ˜¯sigmoidå‡½æ•°ã€‚ç”±å…¬å¼<span class="math inline">\(\eqref{derive1}\)</span>å¯ä»¥æ ¹æ®<span class="math inline">\(T(t)\)</span>ï¼Œä¸¤è¾¹æ±‚å¯¹æ•°åæ±‚å¯¼å¯ä»¥å¾—åˆ°<span class="math inline">\(\rho(t)\)</span>çš„è¡¨è¾¾å¼ï¼š <span class="math display">\[
\begin{equation}\label{density}
\rho(t)=\frac{-\frac{d\Phi_s}{dt}(f(p(t)))}{\Phi_s(f(p(t)))}
\end{equation}
\]</span> â€‹ æ ¹æ®æ­¤å…¬å¼ï¼ŒæŒ‰ç…§NeRFæ¸²æŸ“å…¬å¼å¯ä»¥æ±‚å‡ºå¯¹ç§°ã€æ— åçš„weightï¼ˆsigmoidå¯¼æ•°çš„å½¢å¼ï¼‰ã€‚æ­¤åï¼Œä½œè€…è€ƒè™‘å¤šä¸ªå¹³é¢ï¼ˆåŒºåˆ†ç‰©ä½“è¡¨é¢å†…å¤–ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<center>
<img src="/2022/05/03/Mip-NeRF%E6%80%9D%E6%83%B3%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%9B%B4%E5%A4%9A%E7%9A%84NeRF%E6%96%B9%E6%B3%95/2022-08-25 (2).png" style="zoom:60%;">
</center>
<p>â€‹ æ ¹æ®å…¬å¼<span class="math inline">\(\eqref{density}\)</span>çŸ¥ï¼Œç”±äº<span class="math inline">\(d\Phi_s/dt\)</span>çš„å€¼åŸŸä¸ºæ­£<span class="math inline">\(\mathbb{R}\)</span>ï¼Œè€Œï¼š <span class="math display">\[
\begin{equation}
\frac{d\Phi_s(f(p(t)))}{dt}=\frac{d\Phi_s(u)}{du}\frac{du}{dt},\text{ where }u=f(p(t))
\end{equation}
\]</span> â€‹ åªæœ‰å½“<span class="math inline">\(f&#39;(p(t))\)</span>ä¸ºæ­£æ•°æ—¶ï¼Œ<span class="math inline">\(\rho(t)\)</span>æ‰æ˜¯æ­£æ•°ï¼Œå¦åˆ™ä¸ºè´Ÿã€‚è´Ÿæ•°æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ•…æˆ‘ä»¬å°†è´Ÿæ•°éƒ¨åˆ†æˆªæ–­åˆ°0ï¼ˆèƒŒé¢â€œå‰”é™¤â€ï¼Œå…‰çº¿ç©¿è¿‡èƒŒé¢è¡¨é¢æ—¶ï¼ŒSDFæ˜¯å¢åŠ çš„ï¼Œå¯¼æ•°ä¸ºæ­£ï¼‰ã€‚è¿™æ ·ï¼Œè¢«é®æŒ¡çš„éƒ¨åˆ†ï¼ˆèƒŒé¢ï¼‰å°†ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚æ­¤å¤–ï¼Œç”±äºä½¿ç”¨çš„å…¬å¼ä»ç„¶æ˜¯NeRFçš„å…‰çº¿æ¸²æŸ“å…¬å¼ï¼Œ<span class="math inline">\(T(t)\)</span>ä»ç„¶ä»0å¼€å§‹ç§¯åˆ†åˆ°å½“å‰tï¼Œæ•…ç»è¿‡å‡ ä¸ªéšœç¢ç‰©çš„é®æŒ¡åï¼Œé åæ–¹çš„weightä¼šè¶Šæ¥è¶Šå°ï¼Œè¿™ä¹Ÿæ˜¯é®æŒ¡æ„ŸçŸ¥çš„ä¸€ç§ä½“ç°ã€‚æ ¹æ®æ‰€æ¨å¯¼çš„è¿ç»­å…¬å¼ï¼Œå°†å…¶ç¦»æ•£åŒ–ï¼ˆå®é™…ä¸Šå°±æ˜¯æ¯ä¸¤ä¸ªç‚¹ä¹‹é—´è¿›è¡Œé›¶é˜¶ä¿æŒï¼Œç”¨quadratureè¿‘ä¼¼ç§¯åˆ†ï¼‰ã€‚</p>
<p>â€‹ è™½ç„¶ä¸Šè¿°æ¨å¯¼åŸºäºâ€œå¹³é¢ç‰©ä½“â€ï¼Œä½†å®é™…ä¸Šå¯¹äºå…‰æ»‘ç‰©ä½“ï¼ˆä¸€é˜¶å¯¼è¿ç»­ï¼‰ï¼Œæ¯ä¸ªç‚¹éƒ½å¯ä»¥ä¼°è®¡åˆ‡å¹³é¢ï¼ˆä½œä¸ºè¿‘ä¼¼çš„æ³•å¹³é¢ï¼‰ï¼Œä¹Ÿå°±å¯ä»¥åˆ©ç”¨å¹³é¢ç‰©ä½“æ¨å¯¼çš„ç»“æœã€‚åˆ™å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨NeuSçš„åŒæ—¶éœ€è¦å¯¹æ³•å‘é‡è¿›è¡Œä¼°è®¡ï¼ˆå¦‚Ref NeRFä¸­çš„ä¸¤ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨MLPé¢„æµ‹æ³•å‘é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨densityçš„ä¸€é˜¶æ¢¯åº¦ä½œä¸ºæ³•å‘é‡ï¼Œæœ¬è®ºæ–‡ä¸­åˆ™å¯ä»¥ç”¨SDFæ¢¯åº¦ä½œä¸ºæ³•å‘é‡ï¼‰ã€‚</p>
<p>â€‹ ä¸€äº›å…³äºNeuSçš„æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>NeuSä¸­çš„SDFå‡½æ•°æ˜¯MLPï¼ˆMLPè¿‘ä¼¼äº†ç©ºé—´è·ç¦»åœºï¼‰ï¼ŒåŒæ—¶NeuSä¸­ä¹ŸåŒ…å«äº†ä¸€ä¸ªå±‚æ¬¡åŒ–é‡‡æ ·çš„NeRFæ¨¡å‹ï¼ˆç”¨äºlossè®¡ç®—ï¼‰ã€‚lossè®¡ç®—çš„é€»è¾‘æµå¤§æ¦‚æ˜¯è¿™æ ·ï¼šSDF MLPå°†ä¼šè¾“å‡ºç©ºé—´çš„SDFå€¼ï¼Œ</li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>NeRF</tag>
      </tags>
  </entry>
  <entry>
    <title>NeRFè®ºæ–‡å¤ç°</title>
    <url>/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="nerf">NeRF</h1>
<hr>
<p>â€‹ æœ€è¿‘å·¥ç¨‹æµ“åº¦å¤ªé«˜ï¼Œå…³äºã€å¦‚ä½•è®¾è®¡ã€‘ä»¥åŠã€ä¸ºä»€ä¹ˆã€‘çš„æ€è€ƒæ˜¾è‘—å°‘äºã€å¦‚ä½•å®ç°ã€‘ä»¥åŠã€æ€ä¹ˆè§£å†³ã€‘ã€‚ä¸ºäº†å¹³è¡¡ç§‘ç ”ä¸å·¥ç¨‹ï¼Œæˆ‘å¤ç°äº†æœ€è¿‘è¯»çš„ä¸€ç¯‡å¤šè§†è§’é‡å»ºè®ºæ–‡ï¼ˆè§ä¸Šä¸€ç¯‡åšå®¢ <a href="https://enigmatisms.github.io/2022/03/13/Neural-Randiance-Fieldã€1ã€‘/">Neural Randiance Fieldã€1ã€‘</a>ï¼‰ï¼š</p>
<ul>
<li><a href="https://arxiv.org/pdf/2003.08934.pdf?ref=https://githubhelp.com">Mildenhall, Ben, et al. "Nerf: Representing scenes as neural radiance fields for view synthesis." <em>European conference on computer vision</em>. Springer, Cham, 2020.</a></li>
</ul>
<p>â€‹ NeRFè¿™ç¯‡è®ºæ–‡ï¼Œè¯»çš„æ—¶å€™è§‰å¾—ä½œè€…å†™å¾—è¿˜æ˜¯éå¸¸æ¸…æ™°ï¼Œåªè¦ææ¸…æ¥šäº†åŸºæœ¬æ¦‚å¿µï¼Œæµç•…åœ°è¯»ä¸‹æ¥åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†å®ç°è¿‡ç¨‹ä¸­ï¼Œå‘ç°åˆ°å¤„éƒ½æ˜¯å‘ï¼ˆå‘ä¸»è¦æ¥æºäºä¸ªäººæ²¡æœ‰æ¸…æ™°çš„è®¾è®¡æ€è·¯ï¼Œä¸åŒæ¨¡å—é—´çš„è¾“å…¥è¾“å‡ºè¿ç»­æ€§ä¸å¼ºï¼Œå¯¼è‡´æ¥å£ç»å¸¸æ”¹åŠ¨ï¼Œæ­¤å¤–... æœ‰äº›é—®é¢˜ç¡®å®ä¹ŸæŒºå‘çš„ï¼‰ã€‚æœ‰åˆ«äºNeRFçš„å®˜æ–¹tensorflowå®ç°ï¼Œæœ¬è®ºæ–‡å¤ç°ä½¿ç”¨Pytorch + CUDAï¼Œä¸»è¦ä»£ç ä¸­çº¦æœ‰50% CUDAï¼Œ50%pythonã€‚æœ¬è®ºæ–‡ä¸»è¦è®°å½•å¤ç°æ€è·¯ï¼Œä»¥åŠå¤ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸»è¦é—®é¢˜ã€‚å¤ç°è§<a href>Github repo: Enigmatisms/NeRF</a></p>
<center>
<img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/dynamic.gif" style="zoom:60%;">
</center>
<center>
Figure 1. blender synthetic dataset - drums è®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–ï¼ˆä»epoch 1- epoch 400ï¼‰
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-å›°éš¾éƒ¨åˆ†">II. å›°éš¾éƒ¨åˆ†</h2>
<h3 id="cudaåŠ é€Ÿçš„éšæœºé‡‡æ ·">2.1 CUDAåŠ é€Ÿçš„éšæœºé‡‡æ ·</h3>
<p>â€‹ ä¸ªäººè§‰å¾—ï¼ŒNeRFä¸­æœ‰å¾ˆå¤šæ“ä½œéƒ½å¯ä»¥ç”¨CUDAå®ç°ï¼Œæ­£å¥½æˆ‘å¾ˆé•¿æ—¶é—´æ²¡æœ‰å†™è¿‡CUDAç¨‹åºäº†ï¼Œæƒ³å€Ÿæ­¤æœºä¼šå›å¿†ä¸€ä¸‹CUDAç¼–ç¨‹ä»¥åŠè°ƒè¯•ã€‚é¦–å…ˆæˆ‘ä»éšæœºé‡‡æ ·ä¸‹æ‰‹ã€‚NeRFçš„ç›´æ¥éšæœºé‡‡æ ·ä¸»è¦ç”¨åœ¨coarse networkä¸­ï¼Œç”±äºæˆ‘ä»¬çš„ï¼ˆä»¥åŠä½œè€…çš„ï¼‰è®¾å¤‡capacityä¸æ”¯æŒå¯¹100å¼ (800Ã—800)å›¾ç‰‡çš„ç›´æ¥é‡‡æ ·ï¼ˆGPU global memoryæ ¹æœ¬ä¸å¤Ÿï¼‰ï¼Œè€Œæˆ‘ä»¬åŒæ—¶åˆå¸Œæœ›åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¸è¿›åœ°è¦†ç›–è®­ç»ƒé›†çš„æ‰€æœ‰åƒç´ ï¼Œæ•…éœ€è¦éšæœºé‡‡æ ·ã€‚</p>
<p>â€‹ å¤ç°è¿‡ç¨‹ä¸­ï¼Œç®—æ³•é€»è¾‘å¹¶éå›°éš¾çš„éƒ¨åˆ†ã€‚æ¯”è¾ƒç»•çš„åœ°æ–¹åœ¨äºè¾“å…¥è¾“å‡ºçš„è®¾è®¡ã€‚é‡‡æ ·éœ€è¦è¾“å‡ºä»€ä¹ˆï¼Ÿæˆ‘åªéœ€è¦ç‚¹ä»¥åŠå¯¹åº”çš„RGBä¿¡æ¯å°±å¯ä»¥äº†å—ï¼Ÿæ˜¯å¦è¿˜éœ€è¦å…¶ä»–çš„è¾…åŠ©ä¿¡æ¯ï¼ˆè¯¸å¦‚ï¼Œç‚¹å±äºçš„ä½å§¿idç­‰ç­‰ï¼‰ï¼Ÿé‡‡æ ·çš„ä¿®æ”¹ï¼Œè¿­ä»£äº†ä¸‰ä¸ªç‰ˆæœ¬ï¼š</p>
<div class="note "><p>â€‹ åˆä»£ç‰ˆæœ¬çš„è¾“å‡ºshapeæ˜¯ï¼š(é‡‡æ ·å…‰æŸæ•°é‡ï¼Œæ¯æ¡å…‰æŸé‡‡æ ·ç‚¹æ•°é‡ + 1ï¼Œ3)ã€‚è‡³äºä¸ºä»€ä¹ˆè¦+1ï¼Œåœ¨æ¯æ¡å…‰æŸçš„æœ€åä¸€ä¸ªè¾“å‡ºæ•°æ®ï¼Œæ˜¯äº§ç”Ÿæ­¤å…‰æŸçš„å›¾åƒRGBä¿¡æ¯ã€‚è€Œä¹‹å‰çš„è¾“å‡ºæ•°æ®åˆ™æ˜¯æŒ‰ç”±è¿‘åˆ°è¿œçš„é‡‡æ ·ç‚¹ã€‚æœ¬ç‰ˆæœ¬å®ç°å·²ç»è¾“å‡ºä¸€ä¸ªshapeä¸ºï¼ˆé‡‡æ ·å…‰æŸæ•°é‡ï¼Œæ¯æ¡å…‰æŸé‡‡æ ·ç‚¹æ•°é‡ï¼‰çš„<code>lengths</code> tensoräº†ï¼Œç”¨äºæ¸²æŸ“ï¼Œä½¿å¾—æ¸²æŸ“æ—¶ä¸éœ€è¦å†æ ¹æ®é‡‡æ ·ç‚¹3Dåæ ‡åç®—ä¸€éæ¯ä¸ªç‚¹åˆ°ç›¸é‚»ç‚¹çš„è·ç¦»ï¼Œ<code>lengths</code> å¼ é‡å·²ç»è®¡ç®—å¥½äº†ã€‚ä½†æœ¬ç‰ˆæœ¬ç¼ºå°‘é‡è¦çš„ä¿¡æ¯ï¼šå…‰çº¿æ–¹å‘ä¿¡æ¯ï¼Œå…‰çº¿æ–¹å‘ä¿¡æ¯éœ€è¦ç”¨åœ¨é€†å˜æ¢é‡‡æ ·ä»¥åŠcoarse samples &amp; fine samplesçš„åˆå¹¶ä¸­ã€‚è™½ç„¶ä¹Ÿå¯ä»¥é€šè¿‡åæœŸç‚¹å·®å€¼æ¥è®¡ç®—ï¼Œä½†è¿™æ¯•ç«Ÿä¹Ÿä¸æ˜¯ä¸€ç§å¾ˆé«˜æ•ˆçš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæœ¬ç‰ˆæœ¬çš„ä¸€ä¸ª <strong><u>é‡å¤§ç¼ºé™·</u></strong> å°±æ˜¯ï¼Œ<strong><u>åœ¨å†™é‡‡æ ·ä¹‹å‰æˆ‘å®Œå…¨ä¸çŸ¥é“æ•°æ®é›†æ˜¯ä»€ä¹ˆæ ·çš„</u></strong>ã€‚æˆ‘ç›´æ¥å†™äº†ä¸€ä¸ªæ ¹æ®å†…å¤–å‚æ•°é‡‡æ ·çš„ç®—æ³•ï¼Œä½†æ˜¯æ•°æ®é›†ä¸­ <strong><u>ç›¸æœºå†…å‚åªæœ‰focalï¼ˆå¹¶ä¸”ä»¥FoVçš„å½¢å¼ç»™å‡ºï¼‰</u></strong>ï¼Œæ²¡æœ‰å„è½´çš„æ”¾å¤§ç³»æ•°ï¼Œå†…å‚æ˜¯ä¸å®Œæ•´çš„ã€‚æ•…æˆ‘è¢«è¿«åˆå»å­¦äº†ä¸€ä¸‹å¦‚ä½•åªç”¨ç„¦è·è®¡ç®—ç›¸æœºåæ ‡ç³»ä¸‹çš„ç‚¹ï¼Œå¹¶æ”¾å¼ƒäº†æœ¬ç‰ˆæœ¬ä»£ç ã€‚</p>
</div>
<div class="note "><p>â€‹ ç¬¬äºŒä»£ç®—æ³•å®é™…ä¸Šå·²ç»åŠŸèƒ½å®Œå¤‡äº†ï¼Œè¾“å‡ºçš„shapeæ˜¯(é‡‡æ ·å…‰æŸæ•°é‡ï¼Œæ¯æ¡å…‰æŸé‡‡æ ·ç‚¹æ•°é‡ + 1ï¼Œ9)ï¼Œåœ¨æ¯æ¡å…‰çº¿çš„æœ€åä¸€ä¸ª9ç»´ä½ç½®ï¼Œä¿å­˜äº†ï¼ˆå¯¹åº”ç›¸æœºçš„å¹³ç§»ï¼Œå…‰æŸçš„æ–¹å‘ï¼‰ï¼Œ9ç»´ä¸ªç»´åº¦åœ¨å…¶ä»–æ•°æ®ä¸­çš„æ„ä¹‰åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>å‰ä¸‰ç»´åº¦ï¼šé‡‡æ ·ç‚¹(x, y, z)</li>
<li>ä¸­é—´ä¸‰ç»´åº¦ï¼šå…‰æŸæ–¹å‘ï¼ˆæœªå½’ä¸€åŒ–ï¼‰</li>
<li>åä¸‰ç»´åº¦ï¼šRGBå€¼ï¼ˆæ–¹ä¾¿æ¯”è¾ƒï¼‰</li>
</ul>
</div>
<div class="note success"><p>â€‹ ç¬¬äºŒä»£ç‰ˆæœ¬æœ€åçš„ç»“æœå§‹ç»ˆæ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”åˆšå¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘è¿˜æ²¡æœ‰æŒæ¡è¿™ç§ç½‘ç»œdebugçš„ç²¾é«“ã€‚æœ€åä¸€æƒ³ï¼Œæ—¢ç„¶æ˜¯å¤šè§†è§’é‡å»ºï¼Œç»“æœæœ‰è¯¯ï¼Œæˆ‘å¹²è„†å°±ä¸€ç›´è¾“å…¥ä¸€ä¸ªè§†è§’ä¸‹çš„å›¾ç‰‡ï¼Œçœ‹çœ‹è¾“å‡ºæ˜¯ä»€ä¹ˆã€‚ç»“æœå‘ç°å®ƒç»™æˆ‘è¾“å‡ºäº†ä¸€ä¸ªçƒ§æ¯ï¼ˆlegoè®­ç»ƒé›†ç¬¬ä¸€ä¸ªï¼‰ã€‚å¼€å§‹æˆ‘æ€€ç–‘æ˜¯è·å–é‡‡æ ·ç‚¹è¿™ä¸€éƒ¨åˆ†å®ç°æœ‰è¯¯ï¼Œæˆ‘ç”šè‡³æŠŠå®˜æ–¹å®ç°çš„<code>get_rays</code>å‡½æ•°æŠ å‡ºæ¥ï¼Œç›¸åŒè¾“å…¥å¯¹æ¯”è¾“å‡ºä¹‹åå‘ç°å®Œå…¨ä¸€è‡´... ä¸ªäººæœ€åè¿›è¡Œäº†ä¸€äº›ä»£ç çš„ç®€åŒ–ï¼Œä½†æˆ‘å¹¶ä¸è®¤ä¸ºæ˜¯ä»£ç ç®€åŒ–å¯¼è‡´äº†è®­ç»ƒçš„æˆåŠŸï¼Œåå€’æ˜¯positional encodingçš„å®ç°è®©äººæ„Ÿè§‰å¾ˆè¿·ã€‚æ‘˜å–å®˜æ–¹peç”Ÿæˆå‡½æ•°å¯¹æ¯”å®éªŒæ—¶ï¼Œæˆ‘å‘ç°å®˜æ–¹çš„peæ¯”æˆ‘çš„ç»´åº¦å¤§ï¼Œå‰é¢å¤šäº†ä¸‰é¡¹ï¼Œå…¶ä½™é¡¹å‡ç›¸ç­‰ã€‚è¿™æ˜¯å› ä¸ºå®˜æ–¹æŠŠåŸè¾“å…¥ç»™catåˆ°positional encodingä¹‹ä¸­äº†... ä½†ä½ è®ºæ–‡é‡Œæ²¡å†™ä½ è¿™ä¹ˆå¹²äº†å•Šnmdï¼Œä¸€éè¯´æ˜¯ positional encoding å¯ä»¥ä½¿å¾—åŸå§‹è¾“å…¥æ²¡æœ‰ä½é¢‘åç§»ï¼Œä¸€è¾¹catäº†ä½é¢‘ä¿¡å·ä¹Ÿä¸å†™ä¸Šï¼Ÿæ€»ä¹‹ï¼Œåšäº†è¿™ä¸ªæ”¹åŠ¨ä¹‹åï¼Œç½‘ç»œæˆåŠŸäº†ã€‚å½“ç„¶ï¼Œåœ¨æˆåŠŸä¹‹å‰ï¼Œä¸ºäº†é¿å…æ‰€æœ‰å¯èƒ½çš„é”™è¯¯ï¼Œæˆ‘æŠŠæ‰€æœ‰ç”¨CUDAå®ç°äº†ä¸€éçš„å‡½æ•°åŠŸèƒ½åˆç”¨Pythonå®ç°äº†ä¸€éã€‚</p>
</div>
<h3 id="cudaåŠ é€Ÿçš„é€†å˜æ¢é‡‡æ ·">2.2 CUDAåŠ é€Ÿçš„é€†å˜æ¢é‡‡æ ·</h3>
<p>â€‹ å¦‚æœå¯ä»¥å½»åº•æŠ›å¼ƒæ­¤ç»“æ„ï¼ŒNeRFçš„è®­ç»ƒè‡³å°‘å¯ä»¥åŠ é€Ÿ25%ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç»“æ„ï¼Œvanilla NeRFè¿™ä¸ªæš´åŠ›é‡‡æ ·çš„ç½‘ç»œå¾ˆå¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„è´¨é‡æŸå¤±ã€‚æ­¤ç»“æ„çš„ä¸»è¦æ€æƒ³æ˜¯ï¼š</p>
<blockquote>
<p>ç”¨ä¸¤ä¸ªç½‘ç»œï¼Œä¸€ä¸ªç§°ä¹‹ä¸ºç²—ç½‘ç»œï¼Œè®°ä½œ<span class="math inline">\(N_c\)</span>ï¼Œå¦ä¸€ä¸ªç§°ä¹‹ä¸ºç²¾ç½‘ç»œ<span class="math inline">\(N_f\)</span>ï¼Œç²—ç½‘ç»œå¯¹ç²¾ç½‘ç»œæœ‰æŒ‡å¯¼ä½œç”¨ï¼ŒæŒ‡å¯¼ç²¾ç½‘ç»œé‡‡æ ·ã€‚ --- ä¸ºäº†å¥½çœ‹ï¼Œå¼•ç”¨è‡ªæˆ‘è‡ªå·±</p>
</blockquote>
<p>â€‹ æˆ‘ä»¬ä»¥è®ºæ–‡ä¸­çš„å‚æ•°è®¾ç½®æ¥çœ‹ã€‚ç²—ç½‘ç»œå¯¹äºæ¯ä¸€æ¡å…‰çº¿ï¼Œéƒ½ä¼šå…ˆåœ¨near bound ä»¥åŠ far boundä¹‹é—´ï¼Œåˆ’åˆ†64ä¸ªå‡åŒ€é—´éš”çš„æ®µã€‚ä¸ºäº†ä½¿å¾—æœ€ç»ˆçš„ç»“æœä¸å—åˆ°å›ºå®šåˆ†æ®µçš„å½±å“ï¼Œåœ¨æ¯ä¸ªæ®µå†…é‡‡æ ·æ—¶ï¼Œä¸ç›´æ¥ä½¿ç”¨æ®µçš„ä¸­ç‚¹ï¼Œè€Œæ˜¯åœ¨æ®µå†…éšæœºé‡‡æ ·ã€‚è¿™å¾ˆå¯èƒ½ç±»ä¼¼äºä¸€ç§å«åšã€åºåˆ—è¶…åˆ†è¾¨ç‡é‡å»ºã€‘æ–¹æ³•ä¸­æ‰€ç”¨çš„æ€æƒ³ï¼š</p>
<ul>
<li>æ‹æ‘„ä¸€ä¸ªåœºæ™¯ï¼Œä¸€å¼ å›¾ç‰‡çš„ç²¾åº¦æœ‰é™ï¼Œä½†å‡å¦‚æ‹ç…§æ—¶ç›¸æœºåœ¨è½»å¾®æŠ–åŠ¨ï¼ŒæŠ–åŠ¨è¿‡ç¨‹ä¸­æ‹æ‘„åˆ°ä¸€ç³»åˆ—å›¾ç‰‡ï¼Œè¿™äº›å›¾ç‰‡å¯èƒ½åˆšå¥½åœ¨ä¿¡æ¯ä¸Šå…·æœ‰äº’è¡¥èƒ½åŠ›ã€‚<strong><u>è¯¦è§<a href="https://www.zhihu.com/question/25401250">ã€çŸ¥ä¹ï¼Œdiaoå›¾é‡å»ºã€‘</a></u></strong></li>
</ul>
<p>â€‹ ä»è¿™ä¸ªæ€æƒ³çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œéšæœºé‡‡æ ·çš„è¿‡ç¨‹å°±å¯ä»¥æœ‰æ•ˆå°†æ•´æ¡å…‰çº¿è¦†ç›–ï¼Œè¿™æ ·ï¼Œç²¾åº¦å°±ä¸ä¼šå—åˆ°åˆ†æ®µé—´éš”çš„é™åˆ¶ã€‚å¥½ï¼Œå›åˆ°<span class="math inline">\(N_c\)</span>çš„64ä¸ªé‡‡æ ·æ®µï¼Œæ¯ä¸ªæ®µçš„é‡‡æ ·ç‚¹åœ¨è¿‡å®Œ<span class="math inline">\(N_c\)</span>ä¹‹åï¼Œè¿›è¡Œæ¸²æŸ“çš„è¿‡ç¨‹ä¸­éƒ½ä¼šæ ¹æ®é€æ˜åº¦è®¡ç®—æƒé‡ï¼ˆä¸å…‰çº¿å‡»ä¸­æ­¤ç‚¹çš„æ¦‚ç‡æœ‰å…³ï¼‰ã€‚æ­¤æƒé‡å¯ä»¥ä½œä¸º<span class="math inline">\(N_f\)</span>è¾“å…¥é‡‡æ ·çš„æŒ‡å¯¼ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<center>
<img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/sample.jpg" style="zoom:47%;">
</center>
<center>
Figure 2. æ‰¾ä¸åˆ°ä¸€ä¸ªæˆ‘æ»¡æ„çš„ä½œå›¾å·¥å…·ï¼Œåªèƒ½æ‰‹ç”»äº†
</center>
<p>â€‹ å¯è§ï¼Œ<span class="math inline">\(N_c\)</span>å¦‚æœå¯ä»¥æ­£ç¡®å­¦ä¹ ï¼Œåœ¨éšœç¢ç‰©å‘¨å›´å½¢æˆè¾ƒé«˜çš„ä¸é€æ˜åº¦ï¼ˆopacityæ¯”è¾ƒå¤§ï¼‰ï¼Œnormalized weightåœ¨éšœç¢ç‰©å‘¨å›´å½¢æˆçš„ã€éšœç¢ç‰©CDFã€‘å°±ä¼šç±»ä¼¼äºé˜¶è·ƒå‡½æ•°ã€‚é‚£ä¹ˆå½“æˆ‘åœ¨[0, 1]åŒºé—´ä¸Šè¿›è¡Œå‡åŒ€é‡‡æ ·ï¼ˆé‡‡æ ·ä¸åŒweightçš„ç‚¹ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®CDFæ›²çº¿åæŸ¥æ‰¾åˆ°çš„lengthï¼Œéƒ½ä¼šé›†ä¸­åœ¨éšœç¢ç‰©é™„è¿‘ã€‚CDFè¶Šç±»ä¼¼ä¸€ä¸ªé˜¶è·ƒå‡½æ•°ï¼Œé‚£ä¹ˆé€†å˜æ¢é‡‡æ ·çš„ç‚¹å°†è¶Šé›†ä¸­ã€‚ä¸è¿‡æ³¨æ„ï¼Œä¸ºäº†å¿«é€Ÿé€†å˜æ¢é‡‡æ ·ï¼Œnear boundåˆ°far boundçš„åˆ†æ®µæœ€å¥½æ˜¯æœ‰åºçš„ï¼š</p>
<ul>
<li>åœ¨CPUä¸Šå®ç°æ—¶ï¼Œæœ‰åºæ„å‘³ç€å¯ä»¥äºŒåˆ†æŸ¥æ‰¾ï¼Œæ ¹æ®è¾“å…¥çš„weightï¼Œä»¥åŠweightåˆ°lengthçš„æ˜ å°„è¡¨ï¼Œä¾¿å¯ä»¥æŸ¥æ‰¾å¯¹åº”çš„length</li>
<li>åœ¨GPUä¸Šå®ç°æ—¶ï¼Œ<strong><u>ä¸å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</u></strong>ã€‚äºŒåˆ†æŸ¥æ‰¾é€»è¾‘æ€§å¼ºäºè®¡ç®—æ€§ï¼ŒCUDAå®ç°å°†å¼•èµ·å¤§é‡warp divergenceï¼ŒæŸå®³GPUå¹¶è¡Œåº¦ã€‚ä¸è¿‡å³ä½¿æ˜¯é¡ºåºæŸ¥æ‰¾ï¼Œå®ç°ä¹Ÿè¿˜ç®—ç®€å•ï¼Œå¹¶ä¸”æœ‰æ•ˆç‡ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> __shared__ <span class="type">float</span> data[];         <span class="comment">/// length: output_pnum + 6 </span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> ray_id = offset + blockIdx.x, pt_id = threadIdx.x, output_pnum = blockDim.x;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> state_id = ray_id * output_pnum + pt_id;</span><br><span class="line"><span class="built_in">curand_init</span>(state_id, <span class="number">0</span>, r_offset, &amp;r_states[state_id]);</span><br><span class="line"><span class="type">const</span> <span class="type">float</span> weight = <span class="built_in">curand_uniform</span>(&amp;r_states[state_id]);</span><br><span class="line"></span><br><span class="line">data[pt_id] = weights[ray_id * coarse_bins + (pt_id % coarse_bins)];</span><br><span class="line">__syncthreads();</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bin_id = <span class="number">0</span>, max_comp = coarse_bins - <span class="number">1</span>;         </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_comp; i++) &#123;</span><br><span class="line">    bin_id += <span class="built_in">int</span>(weight &gt; data[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä»£ç å¦‚ä¸Šã€‚ç”±äºæœ€ç»ˆéœ€è¦è¾“å‡º128ä¸ªç‚¹ï¼Œè€Œ<span class="math inline">\(N_c\)</span>çš„åˆ†æ®µæ˜¯64ä»½ï¼Œä¸ºäº†é¿å…æ•°æ®æ‹·è´æ—¶çš„warp divergenceï¼Œåœ¨å°†æ•°æ®åŠ è½½åˆ°shared memoryæ—¶ï¼Œè¿›è¡Œpaddingï¼šåŸæœ¬64ä¸ªåˆ†æ®µï¼Œåªéœ€è¦å­˜å‚¨64ä¸ªlengthï¼ˆfloatï¼‰ï¼Œä½†ç”±äºåœ¨æˆ‘çš„è®¾è®¡ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹é‡‡æ ·ä¸€ä¸ªç‚¹ï¼Œ128ä¸ªçº¿ç¨‹å¦‚ä½•å¤åˆ¶64ä¸ªfloatï¼Ÿå¿…ç„¶æœ‰çº¿ç¨‹ä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (threadIdx.x &lt; <span class="number">64</span>)</span><br><span class="line">	<span class="comment">// çº¿ç¨‹idå°äº64çš„çº¿ç¨‹ï¼Œå¤åˆ¶æ•°æ®ï¼Œå¤§äº64çš„çº¿ç¨‹ï¼Œä»€ä¹ˆäº‹éƒ½ä¸åš</span></span><br><span class="line">__syncthreads();</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤å¤„å°±å·²ç»å¼•å…¥warp divergenceäº†ï¼Œè™½ç„¶å¯èƒ½å¹¶ä¸ä¸¥é‡ã€‚å¦‚æœè€ƒè™‘åˆ°å°†shared memoryæ‰©å¤§åˆ°128ä¸ªfloatï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¤åˆ¶åˆ°è‡ªå·±idå¯¹åº”çš„shared memoryåŒºï¼Œå°±ä¸ä¼šæœ‰warp divergenceç°è±¡ã€‚æ­¤å¤–ï¼Œç”±äº64Bå¯¹äº shared memoryæ¥è¯´çœŸçš„ä¸æ˜¯ä»€ä¹ˆå¼€é”€ï¼Œæ‰€æœ‰çº¿ç¨‹ä¸€èµ·æ‰§è¡Œæ—¶ï¼Œå¤šä½™çš„64æ¬¡å¤åˆ¶æ“ä½œä¸ä¼šå¢åŠ æ—¶é—´å¼€é”€ï¼ˆ<strong><u>æ€ä¹ˆè¯´å‘¢ï¼Œå¯èƒ½è¿™åªæ˜¯æˆ‘çš„ä¸€å¢æƒ…æ„¿</u></strong>ï¼Œæ¯•ç«Ÿè¿™ä¸ªå®ç°ï¼Œ<strong><u>æ²¡æœ‰ç»•å¼€bank conflict</u></strong>ï¼‰ï¼Œæœ€å¤šå°±æ˜¯å¢åŠ åŠŸè€—ï¼Œæ‰€ä»¥è¿™æ ·åšä¹Ÿæ— å¦¨ã€‚</p>
<p>â€‹ æ­¤åï¼Œæˆ‘åªéœ€è¦éå†å¤§å°ä¸º64çš„æœ‰åºæ•°ç»„ã€‚å½“å‰é‡‡æ ·weightå°äºlengthçš„éƒ¨åˆ†å…¨éƒ¨ä½¿å¾—è®¡æ•°å™¨+1ï¼Œä¾¿åˆ©ç»“æŸä¹‹åï¼Œå°±å¯ä»¥çŸ¥é“è‡ªå·±åœ¨å“ªä¸€ä¸ªåŒºåŸŸã€‚è¿™æ ·çš„å®ç°å®Œå…¨æ²¡æœ‰warp divergenceï¼Œä½†æ˜¯bank conflictå°±å¦è¯´äº†ã€‚ä¸å¾—ä¸è¯´ï¼Œè¿™ä¹ˆçœ‹æ¥æˆ‘çš„GPUç¼–ç¨‹æŠ€æœ¯è¿˜æ˜¯å¾ˆèœï¼Œè¦æƒ³è®¾è®¡å®Œç¾çš„GPUç¨‹åºï¼Œè¿˜æ˜¯éœ€è¦æ›´ä¸°å¯Œçš„ç»éªŒã€‚ï¼ˆæ‰€ä»¥Instant-NGP 5s NeRFè®­ç»ƒæ˜¯çœŸçš„ç‰›é€¼ï¼‰</p>
<h3 id="è·å¾—é‡‡æ ·ç‚¹">2.3 è·å¾—é‡‡æ ·ç‚¹</h3>
<p>â€‹ å¯¹äºNeRFåœ¨é‡‡æ ·ç¯èŠ‚å¾—åˆ°çš„å…‰çº¿ï¼Œæ¯æ¡å…‰çº¿ä¸Šæ‰€æœ‰çš„ç‚¹æœ€åç”Ÿæˆçš„RGBAå€¼éƒ½åªä¼šå‚ä¸æ‰€åœ¨å…‰çº¿çš„ç›‘ç£å­¦ä¹ ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šè¢«æŠ•å½±åˆ°åˆ«çš„è§†è§’ä¸‹ï¼‰ï¼Œæ•…åœ¨ç¡®å®šå…‰çº¿ä»¥åŠé‡‡æ ·ç‚¹ä¹‹åï¼Œå°±ä¸å†éœ€è¦å›¾åƒä½ç½®ã€ç›¸æœºå‚æ•°ç­‰ç­‰ä¿¡æ¯äº†ã€‚</p>
<p>â€‹ é¦–å…ˆï¼Œå¦‚ä½•åœ¨é’ˆå­”ç›¸æœºå‡è®¾ä¸‹ï¼Œé€šè¿‡ç„¦è·ä»¥åŠå›¾åƒä½ç½®è·å¾—ç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘ï¼Ÿçº¯é’ˆå­”ç›¸æœºæ¨¡å‹ååˆ†ç®€å•ï¼š</p>
<center>
<img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/600px-Pinhole.png" style="zoom:90%;">
</center>
<center>
Figure 3. é’ˆå­”ç›¸æœºæ¨¡å‹[1]
</center>
<p>â€‹ å½’ä¸€åŒ–ç›¸æœºåæ ‡ç³»ä¸‹çš„å…‰çº¿æ–¹å‘ä¸åƒç´ åæ ‡ä¹‹é—´çš„å…³ç³»ä¸ºï¼š <span class="math display">\[
\begin{equation}
\begin{pmatrix}
f &amp; 0 &amp; W/2\\
0 &amp; f &amp; H/2\\
0 &amp; 0 &amp; 1
\end{pmatrix}
\begin{pmatrix}
X_{\text{normed}}\\
Y_{\text{normed}}\\
1
\end{pmatrix}=
\begin{pmatrix}
u\\
v\\
1
\end{pmatrix}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆåªéœ€è¦å°†ä¸Šè¿°å…¬å¼å–åï¼Œå°±å¯ä»¥è½»æ¾å¾—åˆ° <span class="math inline">\(X_{\text{normed}}=(u-W/2)/f\)</span> ä»¥åŠ <span class="math inline">\(Y_{\text{normed}}=(v-H/2)/f\)</span>ã€‚æˆ‘ä»¬é€šå¸¸è®¨è®ºçš„ç›¸æœºæ¨¡å‹å› ä¸ºæœ‰é•œå¤´ï¼Œå†…å‚ä¸­çš„<span class="math inline">\(f\)</span>ä¸€èˆ¬éƒ½ä¸æ˜¯å®é™…ç„¦è·ï¼Œè€Œæ˜¯å®é™…ç„¦è·ä¹˜ä»¥è½´æ”¾å¤§ç³»æ•°ã€‚åœ¨NeRF blenderæ•°æ®é›†ä¸­ï¼Œç„¦è·ä»…ç”±FOVç»™å‡ºï¼Œæ²¡æœ‰å…¶ä»–å†…å‚ç³»æ•°ï¼Œæ•…çŸ¥ä½¿ç”¨çš„ç›¸æœºæ¨¡å‹æ˜¯æœ€ç®€å•çš„é’ˆå­”æ¨¡å‹ã€‚æ­¤å¤–ï¼Œæ³¨æ„COLMAPä»¥åŠä¸ä¹‹ç›¸å…³çš„æ•°æ®é›†çš„å…‰è½´å®šä¹‰ç›¸å¯¹äºæ ‡å‡†ç›¸æœºåæ ‡ç³»è€Œè¨€ï¼Œyä»¥åŠzè½´å–åï¼ˆä½“ç°åœ¨å¤–å‚ä¸Šï¼Œå¦‚æœæˆ‘ä»¬ä¸åšyï¼Œzè½´å–åçš„è¯ï¼Œå¤–å‚å°±æ˜¯é”™è¯¯çš„ï¼‰ã€‚æ•…æœ€åå…‰çº¿æ–¹å‘åº”è¯¥è¢«è¡¨ç¤ºä¸ºï¼š <span class="math display">\[
\begin{equation}
\begin{pmatrix}
(u-\frac{W}2)/f\\
(\frac{H}2-v)/f\\
-1
\end{pmatrix}
\end{equation}
\]</span> â€‹ è·å¾—å…‰çº¿æ–¹å‘ä¹‹åï¼Œæ³¨æ„ä¸è¦å½’ä¸€åŒ–ã€‚å½’ä¸€åŒ–å…‰çº¿çš„æ–¹å‘å‘é‡ <strong><u>åªåœ¨positional encodingå‰è¿›è¡Œ</u></strong>ã€‚è¿‡æ—©åœ°å½’ä¸€åŒ–ï¼Œä¼šä½¿å¾—ä¸€ä¸ªæ¢¯å°å½¢frustumï¼Œæˆä¸ºä¸€ä¸ª... å…·æœ‰å¼§åº¦çš„å½¢çŠ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œæ¢¯å°å½¢frustumæ›´åŠ ç¬¦åˆæ ‡å‡†ç›¸æœºæ¨¡å‹ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">æ­£å¸¸æ¢¯å°frustum</th>
<th style="text-align: center;">å¼§å½¢frustum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/flat.png"></td>
<td style="text-align: center;"><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/round.png"></td>
</tr>
</tbody>
</table>
<p>â€‹ NeRFé‡‡æ ·ç‚¹éœ€è¦åœ¨ä¸€ä¸ªå…¨å±€åæ ‡ç³»ä¸‹ï¼ˆæ˜¾ç„¶ï¼Œå¦åˆ™éƒ½åœ¨è‡ªå·±çš„ç›¸æœºåæ ‡ç³»ä¸‹ï¼Œå­¦ä¹ çš„å†…å®¹å°†ä¼šæœ‰å†²çªï¼‰ã€‚æ•…å…‰çº¿æ–¹å‘éœ€è¦æ ¹æ®å¤–å‚è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»ã€‚å…‰çº¿æ–¹å‘ç›´æ¥å·¦ä¹˜å¤–å‚çš„æ—‹è½¬åˆ†é‡å³å¯ã€‚æ­¤ååªéœ€è¦æ ¹æ®æ–¹å‘ï¼Œåˆ†æ®µä»¥åŠå™ªå£°æŠ–åŠ¨è¿›è¡Œé‡‡æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sampled_coords = coords[indices]</span><br><span class="line">resolution = (far - near) / point_num</span><br><span class="line">all_lengths = torch.linspace(near, far - resolution, point_num).to(target_device)</span><br><span class="line">lengths = all_lengths + torch.rand((ray_num, point_num)).to(target_device) * resolution</span><br><span class="line"><span class="comment"># torch sum (ç›¸æœºåæ ‡ç³»å…‰çº¿ ç‚¹ä¹˜ ç›¸æœºå¤–å‚æ—‹è½¬) ç­‰ä»·äº ï¼ˆç›¸æœºå¤–å‚æ—‹è½¬çŸ©é˜µ çŸ©é˜µä¹˜ å…‰çº¿æ–¹å‘ï¼‰ï¼Œåªä¸è¿‡è¿™æ ·å¤„ç†ç›´æ¥å¾—åˆ°è¡Œå‘é‡ï¼Œæ¯”è¾ƒæ–¹ä¾¿</span></span><br><span class="line">ray_raw = torch.<span class="built_in">sum</span>(torch.cat([sampled_coords / focal, -torch.ones(sampled_coords.shape[<span class="number">0</span>], <span class="number">1</span>, dtype = torch.float32).to(target_device)], dim = -<span class="number">1</span>).unsqueeze(-<span class="number">2</span>) * cam_tf[:, :-<span class="number">1</span>], dim = -<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å¾ˆå¤šnoneï¼Œæ˜¯ä¸ºäº†å¢åŠ ç»´åº¦ï¼Œray_raw.shape =ï¼ˆå…‰çº¿æ•°,6ï¼‰,è€Œlengths.shape = (å…‰çº¿æ•°ï¼Œé‡‡æ ·ç‚¹æ•°)</span></span><br><span class="line">pts = cam_tf[:, -<span class="number">1</span>] + ray_raw[:, <span class="literal">None</span>, :] * lengths[:, :, <span class="literal">None</span>]</span><br></pre></td></tr></table></figure>
<h3 id="æ¸²æŸ“">2.4 æ¸²æŸ“</h3>
<p>â€‹ å‡ ä¹æ‰€æœ‰å…³äºNeRFçš„è®ºæ–‡ï¼Œåœ¨prerequisiteéƒ¨åˆ†ï¼Œéƒ½ä¼šå†™åŸå§‹NeRFçš„å…‰çº¿æ¸²æŸ“å…¬å¼ã€‚NeRFçš„å…‰çº¿æ¸²æŸ“å…¬å¼æ˜¯ç”±å›¾å½¢å­¦çš„volume renderingç§¯åˆ†å…¬å¼å¾—æ¥çš„ï¼Œä½†ç”±äºç§¯åˆ†æ²¡æœ‰æ›´ç®€å•çš„è§£æå½¢å¼ï¼Œåªèƒ½ä½¿ç”¨ç´¯åŠ è¿›è¡Œè¿‘ä¼¼ã€‚æˆ‘å¹¶ä¸æ˜¯ç‰¹åˆ«æ˜ç™½å…¶ä¸­ä½¿ç”¨æŒ‡æ•°å‡½æ•°çš„åŸå› ï¼ˆ1984å¹´çš„å…‰çº¿æ¸²æŸ“åŸæ–‡ä¹Ÿæ²¡æœ‰çœ‹å¾—ç‰¹åˆ«æ˜ç™½ï¼‰ï¼Œä½†æ˜¯å¦‚æœå°†æŒ‡æ•°å‡½æ•°ç†è§£ä¸ºä»»æ„å¢å‡½æ•°ï¼Œå…¶å®æ¸²æŸ“å…¬å¼ä¹Ÿå¾ˆå¥½ç†è§£ã€‚ <span class="math display">\[
\begin{align}
&amp;C(\pmb{r})=\sum^N_{i=1}T_i(1-\exp(-\sigma_i\delta_i))\pmb{c_i}\\
&amp;T_i=\prod_{j=1}^{i-1}\exp(-\sigma_i\delta_i)=\exp\left(\sum_{j=1}^{i-1}-\sigma_i\delta_i \right)
\end{align}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\delta_i={t_{i+1}-t_{i}}\)</span>ï¼Œä¹Ÿå°±æ˜¯ç›¸é‚»ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œ<span class="math inline">\(\sigma_i\)</span>æ˜¯è®¡ç®—çš„volume densityï¼ˆä¸é€æ˜åº¦å› å­ï¼‰ã€‚é‚£ä¹ˆä»é‡‡æ ·ç‚¹iåˆ°é‡‡æ ·ç‚¹i+1ä¹‹é—´çš„é€æ˜åº¦ï¼Œè¢«å»ºæ¨¡ä¸ºï¼š<span class="math inline">\(1-\exp(-\sigma_i\delta_i)\)</span>ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸é€æ˜åº¦æˆ–è€…ä¸¤ç‚¹é—´è·ç¦»è¶Šå¤§ï¼Œæœ€åå¾—åˆ°çš„é€æ˜åº¦è¶Šä½ã€‚é€æ˜åº¦è¶Šé«˜ï¼Œåˆ°è¾¾i+1é‡‡æ ·ç‚¹æ—¶ï¼Œi+1é‡‡æ ·ç‚¹çš„RGBå°†è¢«æ›´å¤šåœ°ä¿ç•™ã€‚é‚£ä¹ˆ<span class="math inline">\(T_i\)</span>åˆ™æ˜¯ä¸€ä¸ªæ¦‚ç‡å› å­ï¼Œæ­¤æ¦‚ç‡å› å­è€ƒè™‘äº†é®æŒ¡å…³ç³»ï¼šå‡è®¾å…‰çº¿åœ¨ç»è¿‡é å‰çš„é‡‡æ ·ç‚¹æ—¶ï¼Œé€šè¿‡äº†ä¸é€æ˜åº¦è¾ƒé«˜çš„åŒºåŸŸï¼Œé‚£ä¹ˆè¿™æ¡å…‰çº¿å‡»ä¸­åé¢ç‚¹çš„æ¦‚ç‡ï¼Œåº”è¯¥é™ä½ã€‚æˆ‘ä»¬ä¸èƒ½æŠ›å¼ƒæ­¤æ¦‚ç‡å› å­è€Œå®Œå…¨ä½¿ç”¨é€æ˜åº¦ã€‚è€ƒè™‘è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼š</p>
<p><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/eg.png"></p>
<center>
Figure 4. é®æŒ¡å…³ç³»çš„è€ƒè™‘
</center>
<p>â€‹ å‡è®¾é‡‡æ ·ç‚¹åªæœ‰è¿™ä¸¤ä¸ªï¼Œä¸¤ä¸ªç‰©ä½“çš„ä¸é€æ˜åº¦éƒ½è¾ƒé«˜ã€‚ä¸è€ƒè™‘é®æŒ¡å…³ç³»æ—¶ï¼Œç”±<span class="math inline">\(1-\exp(-\sigma_i\delta_i)\)</span>è®¡ç®—å¾—åˆ°çš„é€æ˜åº¦æ˜¯ç›¸å¯¹æ¯”è¾ƒæ¥è¿‘çš„ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸¤ä¸ªä¸åŒç‰©ä½“RGBå€¼çš„å¹³å‡ï¼Œå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚<span class="math inline">\(T_i\)</span>åˆ™å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>â€‹ æ¸²æŸ“çš„å®ç°å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œæ ¹æ®å…¬å¼å®ç°å°±è¡Œã€‚</p>
<h3 id="æ‚é¡¹">2.5 æ‚é¡¹</h3>
<ul>
<li><p>ç²—ç½‘ç»œä½¿ç”¨çš„é‡‡æ ·ç‚¹ï¼ŒåŒæ ·éœ€è¦æ”¾å…¥ç²¾ç½‘ç»œä¸­ï¼Œä¸ç²¾ç½‘ç»œçš„é€†å˜æ¢é‡‡æ ·ç‚¹åˆå¹¶ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œæ¸²æŸ“ <strong><u>ä¸€å®šè¦ä¿è¯è¾“å…¥ç‚¹ä»¥åŠæ·±åº¦å€¼æœ‰åº</u></strong>ï¼Œæ ¹æ®æ¸²æŸ“å…¬å¼ä¸­çš„<span class="math inline">\(\delta_i=t_{i+1}-t_i\)</span>å°±å¯ä»¥çŸ¥é“ã€‚æ•…åˆå¹¶ç²—ç½‘ç»œã€ç²¾ç½‘ç»œé‡‡æ ·ç‚¹ä¹‹åï¼Œéœ€è¦sortã€‚æ€ä¹ˆè¯´å‘¢ï¼ŒPyTorchå¯¹å¼ é‡sortçš„æ”¯æŒï¼Œå¯æ¯”modern-gpu CUDAåº“çš„merge sortå¿«å¤šäº†...</p></li>
<li><p><code>curand_init</code>ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ï¼Œé¦–å…ˆéœ€è¦å¼•ç”¨å¤´æ–‡ä»¶<code>&lt;curand.h&gt;</code> ä»¥åŠ <code>&lt;curand_kernel.h&gt;</code>ï¼Œæ­¤å¤–ï¼Œå…¶å››ä¸ªå‚æ•°ä¸­ï¼Œæœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦ï¼š</p>
<table>
<colgroup>
<col style="width: 26%">
<col style="width: 6%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>seed</th>
<th>subsequence</th>
<th>offset</th>
<th>randomState</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ä¸åŒçš„blockä»¥åŠçº¿ç¨‹å¯ä»¥æ ¹æ®å…¶idç›´æ¥è·å¾—ä¸åŒseed</td>
<td>æ²¡ç”¨</td>
<td><strong><u>åˆ«å¿˜è®°è®¾ç½®</u></strong>ï¼Œå‡è®¾æ¯æ¬¡ä½¿ç”¨çš„randStateéƒ½åœ¨kernelä¸­è¢«newå‡ºæ¥ï¼Œå¦‚æœä¸æ ¹æ®å‡½æ•°æ‰§è¡Œçš„æ¬¡æ•°è®¾ç½®offsetï¼Œæ¯æ¬¡çš„randomStateéƒ½ä¼šæ˜¯ä¸€æ ·çš„</td>
<td>48ä½ï¼Œè¿˜æŒºå¤§ï¼Œå»ºè®®åˆ†å—newï¼ŒèŠ‚çœå†…å­˜ã€‚è¯¦æƒ…è§<code>deterministic_sampler.cu</code></td>
</tr>
</tbody>
</table></li>
<li><p>NeRFæ•°æ®é›†éæ ‡å‡†pytorchæ•°æ®é›†ï¼Œæ•°æ®é›†åŠ è½½éœ€è¦è‡ªå·±å®ç°ã€‚é¦–å…ˆéœ€è¦å®ç°ä¸€ä¸ªDatasetç±»ï¼ˆç»§æ‰¿torchçš„ç›¸å…³ç±»ï¼‰ï¼Œå…¶ä¸­å¿…é¡»è¦è‡ªå®šä¹‰<code>__getitem__</code>å‡½æ•°ï¼ˆç›¸å½“äºC++ä¸­çš„<code>[]</code>è¿ç®—ç¬¦é‡è½½ï¼‰ã€‚æœ‰Datasetç±»ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨Dataloaderäº†ï¼Œtorchçš„dataloaderæœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€æ˜¯å¯ä»¥é€šè¿‡å¤šworkersçš„æ–¹å¼æé«˜åŠ è½½æ•°æ®é›†çš„ååèƒ½åŠ›ï¼Œä½¿å¾—åŠ è½½æ•°æ®é›†çš„è€—æ—¶è¢«æ©ç›–ã€‚æ­¤å¤–ï¼Œdataloaderéå¸¸èŠ‚çº¦æ˜¾å­˜ï¼Œä¸éœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½å­˜åœ¨æ˜¾å­˜ä¹‹åç´¢å¼•ï¼Œç¬”è€…éå¸¸æ¨èè¿™ç§æ–¹å¼ã€‚</p></li>
</ul>
<hr>
<h3 id="iii.-å¤ç°ç»“æœ">III. å¤ç°ç»“æœ</h3>
<p>â€‹ èˆ’æœå•¦ã€‚debugä¹‹åè¿˜ç®—æˆåŠŸï¼Œå”¯ä¸€ä¸çˆ½çš„å°±æ˜¯ debugè€—æ—¶å¤ªé•¿ï¼Œä»¥ä¸ºæ˜¯ä»€ä¹ˆé‡è¦çš„ç»†èŠ‚å®ç°å‡ºé”™ï¼Œæœ€åç«Ÿç„¶å¯èƒ½è´¥åœ¨äº†positional encodingæ²¡æœ‰catåŸè¾“å…¥ä¸Š...</p>
<p>â€‹ å…³äºå®ç°çš„ä¾èµ–é¡¹ï¼Œè§Githubé¡¹ç›®çš„<a href="https://github.com/Enigmatisms/NeRF/blob/master/README.md"><code>README.md</code></a>ã€‚å…¶ä¸­ä½¿ç”¨åˆ°äº†APEXåŠ é€Ÿï¼ŒO2ç­‰çº§ä¼˜åŒ–ï¼ˆå®æµ‹ï¼ŒO3ç­‰çº§ä¼˜åŒ–ä½¿å¾—æˆ‘çš„lossä»ä¸€å¼€å§‹å°±æ˜¯NaNï¼Œéæ¦‚ç‡æ€§NaNï¼‰ã€‚O2ä¼˜åŒ–çš„é€Ÿåº¦å·²ç»å¾ˆå¿«äº†ï¼Œç›¸å¯¹äºåŸå§‹æ— æ··åˆç²¾åº¦åŠ é€Ÿè€Œè¨€ï¼Œå·²ç»åŠ é€Ÿäº†40-50%ã€‚12.5så¯ä»¥è·‘å®Œ100æ¬¡è®­ç»ƒã€‚åœ¨è¿™é‡Œï¼Œä¸€æ¬¡è®­ç»ƒåŒ…æ‹¬ï¼šç²—ç½‘ç»œé‡‡æ ·ï¼Œ1024æ¡å…‰çº¿+64ä¸ªç‚¹/æ¯æ¡å…‰çº¿--&gt; ç²—ç½‘ç»œè®­ç»ƒ --&gt; ç²—ç½‘ç»œæ¸²æŸ“ --&gt; é€†å˜æ¢é‡‡æ · 128ç‚¹/æ¯æ¡å…‰çº¿ --&gt; ç²¾ç½‘ç»œ192ç‚¹/æ¯æ¡å…‰çº¿ è¿›è¡Œè®­ç»ƒ --&gt; ç²¾ç½‘ç»œæ¸²æŸ“ã€‚é€Ÿåº¦è¿˜è¡Œï¼Œä½†å¯¹æ¯”èµ·5s NeRF... å¤ªæ‹‰äº†ã€‚</p>
<p>â€‹ æˆ‘æ²¡æœ‰ä»€ä¹ˆè€å¿ƒï¼Œä¸æƒ³çœ‹åˆ°æœ€åè®­ç»ƒå¾—æœ‰å¤šå¥½ï¼Œåªè¦æœ‰ä¸ªå¯ä»¥çš„ç»“æœï¼Œå°±è¯´æ˜å¤ç°æˆåŠŸï¼Œå¯¹è®ºæ–‡çš„ç†è§£å……åˆ†ï¼š</p>
<p><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/lego_1.png"></p>
<center>
Figure 5. epoch 1è®­ç»ƒç»“æœï¼ˆ100å¼ å›¾åƒå…¨éƒ¨é‡‡æ ·ï¼‰
</center>
<p><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/lego_2.png"></p>
<center>
Figure 6.è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç»“æœ
</center>
<p><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/lego_3.png"></p>
<center>
Figure 7.çº¦ä¸‰å°æ—¶è®­ç»ƒåï¼ˆ1000 epochsï¼‰å¾—åˆ°çš„ç»“æœï¼ˆ400*400pxï¼‰
</center>
<p>â€‹ Lossçš„å˜åŒ–æ›²çº¿ï¼ˆdrumsï¼‰è®­ç»ƒç»“æœ</p>
<p><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/curve.png"></p>
<center>
Figure 8. drums 1400 epochsï¼ˆ800*800åˆ†è¾¨ç‡ï¼‰lossæ›²çº¿
</center>
<p>â€‹ ä¸€äº›æœ‰è¶£ï¼ˆå¤±è´¥è®­ç»ƒç»“æœï¼‰çš„å›¾ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">å¥½çœ‹çš„legoçƒ§æ¯</th>
<th style="text-align: center;">legoå½©è™¹</th>
<th style="text-align: center;">æ›´å¥½çœ‹çš„legoäº‘</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/beautiful_2.png"></td>
<td style="text-align: center;"><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/beautiful_1.png" style="zoom:54%;"></td>
<td style="text-align: center;"><img src="/2022/03/27/NeRF%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0/false_result.png" style="zoom: 54%;"></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://en.wikipedia.org/wiki/Pinhole_camera_model#:~:text=The%20pinhole%20camera%20model%20describes,are%20used%20to%20focus%20light.">Wikipedia: Pinhole Camera Model</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>NeRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Neural Radiance Fieldã€1ã€‘</title>
    <url>/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/</url>
    <content><![CDATA[<h1 id="neural-rf">Neural RF</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ æ·±åº¦å­¦ä¹ çš„å¤§ç¯å¢ƒä¸‹ï¼Œè§†å›¾åˆæˆï¼ˆview synthesisï¼‰å¿…ç„¶ä¸ä¼šç¼ºå¸­ï¼ˆæ¯•ç«Ÿæ²¡ä»€ä¹ˆæ•°å­¦èƒ½åŠ›ä¹Ÿèƒ½æï¼Œæ˜¯å§ï¼‰ã€‚NeRFä½œä¸ºå…¶ä¸­æ¯”è¾ƒæ°å‡ºçš„å·¥ä½œä¹‹ä¸€ï¼Œæ–‡ç« åç»­ä¹Ÿå—åˆ°å¾ˆå¤šå…³æ³¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºã€NeRF++ï¼ŒNeRF--ï¼ŒPoint NeRFã€‘ã€‚æœ¬æ–‡æ˜¯ä¸€ç¯‡å…³äºNeRFåŠå…¶++ç‰ˆæœ¬çš„è®ºæ–‡ç†è§£ï¼Œåç»­å°†åœ¨[Neural Radiance Fieldã€2ã€‘]ä¸­ä»‹ç»Point NeRFä»¥åŠNeRFçš„å¤ç°ï¼š</p>
<ul>
<li><a href="https://arxiv.org/pdf/2003.08934.pdf?ref=https://githubhelp.com">Mildenhall, Ben, et al. "Nerf: Representing scenes as neural radiance fields for view synthesis." <em>European conference on computer vision</em>. Springer, Cham, 2020.</a></li>
<li><a href="https://arxiv.org/pdf/2010.07492.pdf">Zhang, Kai, et al. "Nerf++: Analyzing and improving neural radiance fields." <em>arXiv preprint arXiv:2010.07492</em> (2020).</a></li>
</ul>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/bench.gif" style="zoom:100%;">
</center>
<center>
Figure 1. æ‹¿ä¸ªè§†é¢‘å½“NeRF demoæ˜¯å§?ï¼ˆè¯¯ï¼‰
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-nerfæœ¬ç¯‡">II. NeRFæœ¬ç¯‡</h2>
<h3 id="æ–‡ç« è„‰ç»œ">2.1 æ–‡ç« è„‰ç»œ</h3>
<p>â€‹ æœ¬æ–‡ç”±äºæ˜¯ç¥ç»ç½‘ç»œradiance fieldè¡¨å¾çš„å¼€å±±ä¹‹ä½œï¼Œæ‰€ç”¨æ–¹æ³•ä»¥åŠæ€æƒ³éƒ½è¾ƒä¸ºç®€å•ï¼Œæ¸…æ™°æ˜“æ‡‚ã€‚</p>
<p>â€‹ æœ¬è®ºæ–‡æœ‰ä¸‰ä¸ªä¸»è¦è´¡çŒ®ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡ä½¿ç”¨ç¥ç»ç½‘ç»œï¼ˆMLPï¼‰å¯¹è¿ç»­çš„volumetricç©ºé—´è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶ä½¿ç”¨å¯å¾®æŠ•å½±æ¨¡å‹çš„ç¦»æ•£è¿‘ä¼¼è®¾è®¡ä¼˜åŒ–æ–¹æ³•</li>
<li>è®¾è®¡äº†ä¸€ç§positional encodingï¼Œå¯ä»¥å°†ä½é¢‘çš„ç©ºé—´ä½å§¿è¾“å…¥è½¬åŒ–ä¸ºé«˜ç»´å‘é‡ï¼Œæå‡æ¨¡å‹çš„è¡¨ç¤ºèƒ½åŠ›</li>
<li>è®¾è®¡äº†ä¸€ç§å±‚çº§åŒ–çš„é‡‡æ ·ç®—æ³•ï¼Œé€šè¿‡coarse-to-fineï¼Œcoarse sampleré‡‡æ ·ç»“æœå¯¹fine samplerè¿›è¡ŒæŒ‡å¯¼ï¼Œä½¿å¾—fine samplerå¯ä»¥æ›´åŠ èšç„¦äºç‰©ä½“è¡¨é¢é™„è¿‘çš„é‡‡æ ·ï¼Œæå‡é‡‡æ ·è®­ç»ƒæ•ˆç‡</li>
</ul>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/nerf.png" style="zoom:100%;">
</center>
<center>
Figure 2. NeRFç½‘ç»œä¿¡æ¯å¤„ç†è¿‡ç¨‹
</center>
<p>â€‹ ç½‘ç»œçš„ä¿¡æ¯å¤„ç†æµç¨‹ï¼š</p>
<div class="note danger no-icon"><p>ç»™å®šå¤šå¼ å·²çŸ¥å†…å¤–å‚çš„å›¾åƒï¼Œä»è¿™äº›å›¾åƒä¸­ï¼ŒéšæœºæŒ‘é€‰ä¸€äº›å…‰çº¿ï¼ˆè¿ç”¨åˆ°äº†ç›¸æœºæ¨¡å‹ï¼‰ï¼Œåœ¨å…‰çº¿ä¸Šè¿›è¡Œç‚¹çš„é‡‡æ ·ï¼ˆè¿™é‡Œå¿½ç•¥coarse2fineå±‚çº§åŒ–é‡‡æ ·ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›é‡‡æ ·ç‚¹å°±ä¼šæœ‰å¹³ç§»æ—‹è½¬ä¿¡æ¯ï¼Œåˆ†åˆ«è¢«è¡¨ç¤ºä¸ºï¼ˆå¹³ç§»ï¼‰<span class="math inline">\(\pmb{x}\)</span>ï¼Œæ—‹è½¬è¢«è¡¨ç¤ºæˆ<span class="math inline">\(\pmb{d}\)</span>ï¼ˆä¸€ä¸ª3Då•ä½å‘é‡)</p>
<ul>
<li>
é‡‡æ ·çš„è¿›è¡Œï¼šä¸ºäº†é¿å…ä½¿ç”¨å›ºå®šçš„voxel volumeï¼ˆæ„æ€æ˜¯è¯´ï¼Œä½œè€…ä¸å¸Œæœ›åœ¨è¿›è¡ŒvoxelåŒ–ä¹‹åï¼Œæ¯æ¬¡å…‰çº¿åœ¨volumeä¸­é‡‡æ ·ï¼Œæ‰“å‡»åˆ°åŒä¸€ä¸ªvoxelæ—¶å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå›ºå®šçš„ä½ç½®ï¼Œè¿™æ ·ç½‘ç»œæœ€åçš„è¾“å‡ºä¼šç›´æ¥ä¸voxelçš„é‡åŒ–ç²¾åº¦æœ‰å…³ï¼‰ï¼Œä½œè€…å‡åˆ†å…‰çº¿ä¸ºNæ®µï¼ˆé‡‡æ ·Nä¸ªç‚¹ï¼‰ï¼Œæ¯æ®µå†…ç”±å‡åŒ€åˆ†å¸ƒé‡‡æ ·ä¸€ä¸ªç‚¹
</li>
<li>
ä½†æ˜¯æ˜¾ç„¶ï¼Œè¿™æ ·ä¼šé‡‡æ ·åˆ°å¤§é‡çš„é®æŒ¡ç‚¹æˆ–è€…ç©ºåŸŸç‚¹ï¼Œä½œè€…è®¤ä¸ºè¿™éå¸¸ä¸åˆé€‚ã€‚æ•…ä½œè€…ä½¿ç”¨ä¸€ä¸ªcoarse samplerï¼Œä¸€ä¸ªfine samplerã€‚coarse sampleré‡‡æ ·æ›´å°‘çš„ç‚¹ï¼ˆæ¯æ¡çº¿æ®µçš„ç­‰åˆ†Næ›´å°ï¼‰ï¼Œè¿™äº›ç‚¹å…ˆåœ¨MLPä¸­è¿›è¡Œevaluationï¼Œåˆ¤å®šæ¯æ¡çº¿ä¸Šå“ªäº›ç‚¹å±äºæ¯”è¾ƒå¥½çš„ç‚¹ï¼ˆæ¥è¿‘å®é™…çš„è¡¨é¢ï¼‰ï¼Œfine samplerå¯ä»¥ç€é‡åœ¨è¿™äº›åŒºåŸŸè¿›è¡Œé‡‡æ ·
</li>
<li>
coarse sampler é‡‡æ ·å¾—åˆ°çš„ç‚¹ä¹Ÿä¼šå‚ä¸ä¼˜åŒ–ï¼Œå½“ç„¶ç”±äºcoarse sampleré‡‡æ ·çš„ç‚¹å±äºæŒ‡å¯¼æ€§çš„ç‚¹ï¼Œå…¶evaluationä¸èƒ½å­˜åœ¨å¤ªå¤§çš„computation overheadï¼Œæ•…ä½œè€…åŒæ—¶ä¹Ÿç”¨äº†ä¸€ä¸ªcoarseç½‘ç»œï¼Œæ­¤ç½‘ç»œä¹Ÿå‚ä¸ä¼˜åŒ–ï¼Œä¼˜åŒ–å¯ä»¥ä½¿å¾—æ­¤ç½‘ç»œèƒ½æ›´å¥½åˆ¤å®šé‡‡æ ·åŒºåŸŸçš„å¥½åï¼Œç»™å‡ºçš„æƒé‡æ›´åˆç†ã€‚æ­¤æ€æƒ³å¾ˆæœ‰è¶£ã€‚
</li>
</ul>
</div>
<div class="note info no-icon"><p>ç‚¹è¿›è¡Œpositional embedä¹‹åï¼Œè¾“å…¥åˆ°MLPç½‘ç»œä¸­ï¼Œç½‘ç»œè¾“å‡ºæ¯ä¸ªç‚¹ï¼š</p>
<ul>
<li>
ä¸ä½ç½®ä»¥åŠæ–¹å‘ï¼ˆç›¸æœºå‘å‡ºçš„å…‰çº¿æœå‘ï¼‰ç›¸å…³çš„RGBå€¼ï¼ˆç›¸å½“äºè§‚æµ‹åˆ°çš„é¢œè‰²ï¼‰
</li>
<li>
åªä¸ä½ç½®ç›¸å…³çš„opacityï¼šå¯ä»¥è®¤ä¸ºï¼Œè¿™æ˜¯ç½‘ç»œå¯¹äºæ­¤ç‚¹æ¥è¿‘æœ‰æ•ˆè¡¨é¢ç‚¹çš„æ¦‚ç‡è¡¨ç¤ºï¼Œæˆ–è€…å•çº¯è®¤ä¸ºï¼Œè¿™æ˜¯ç©ºé—´ä¸­æŸç‚¹çš„å…‰å¯¼ç‡
</li>
</ul>
</div>
<div class="note success no-icon"><p>æœ€åé¢œè‰²ä½¿ç”¨volume renderingæ¨¡å‹è¿›è¡Œæ¸²æŸ“ï¼Œå¯ä»¥å¾—åˆ°æœ€åçš„ç»“æœ</p>
</div>
<h3 id="ä¸€äº›é—®é¢˜">2.2 ä¸€äº›é—®é¢˜</h3>
<p>ï¼ˆ1ï¼‰è®ºæ–‡ç†è§£è¿‡ç¨‹ä¸­æœ€åˆçš„é˜»ç¢æ˜¯ï¼šradiance fieldç©¶ç«Ÿæ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ</p>
<blockquote>
<p>We represent a static scene as a continuous <strong><u>5D function</u></strong> that outputs the radiance emitted in each direction (Î¸, Ï†) at each point (x, y, z) in space, and a density at each point which acts like a differential opacity controlling how much radiance is accumulated by a ray passing through (x, y, z)</p>
</blockquote>
<p>â€‹ å…¶ä¸­ (Î¸, Ï†) åº”å½“æ˜¯è‡ªå˜é‡ï¼Œ (x, y, z) ä¹Ÿæ˜¯è‡ªå˜é‡ã€‚ç»™å®šä¸€ä¸ªè§‚æµ‹è§’åº¦ï¼Œä»¥åŠä¸€ä¸ªç‚¹ï¼Œè¾“å‡ºrgbä»¥åŠä¸€ä¸ªç±»ä¼¼alphaé€šé“çš„ä¸œè¥¿ã€‚ä¸ªäººçš„ç–‘é—®åœ¨äºï¼Œæ­¤ç‚¹ï¼ˆxï¼Œyï¼Œzï¼‰åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸RGBä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿé¦–å…ˆï¼Œä¸Šæ–‡æ‰€è¯´çš„radianceï¼ŒæŒ‡çš„å®Œå…¨å°±æ˜¯RGBå€¼ï¼ˆå…‰çº¿ï¼‰ï¼Œå¯¹äºä¸€ä¸ªå›ºå®šç‚¹è€Œè¨€ï¼Œä¸åŒæ–¹å‘è§‚æµ‹çš„é¢œè‰²å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼ˆç”±äºå…‰ç…§çš„åŒºåˆ«ï¼‰ï¼Œæ•…RGBå€¼ä¸åŒï¼Œä½†åªæœ‰ä¸€ä¸ªRGBæ˜¯æ— æ³•å®Œæˆè§†è§‰å»ºæ¨¡çš„ï¼Œéœ€è¦é€æ˜åº¦ã€‚æ¯”å¦‚ï¼Œå¯¹äºç‰©ä½“æ­£å‰æ–¹çš„ä¸€ä¸ªç©ºæ°”ç‚¹ï¼Œåœ¨ä¸è§‚æµ‹ç‰©ä½“ç›¸åŒçš„æ–¹å‘ä¸Šï¼Œæˆ‘ç¡®å®ä¹Ÿå¯ä»¥è®¤ä¸ºæ­¤ç‚¹å‘å‡ºäº†ä¸ç‰©ä½“ç›¸åŒé¢œè‰²çš„å…‰ï¼Œä½†åœ¨åˆ«çš„è§†è§’ä¸‹ï¼Œç‰©ä½“ä¸æ­¤ç‚¹åœ¨æˆåƒå¹³é¢ä¸Šå¹¶ä¸é‡åˆæ—¶ï¼Œç©ºæ°”ç‚¹äº§ç”Ÿçš„RGBå°±éœ€è¦è¢«é€æ˜åº¦åŠ æƒæˆ0ï¼Œä½¿ä¹‹ä¸å½±å“æœ€åçš„RGBè¾“å‡ºã€‚</p>
<p>â€‹ ä½†è¯´å®åœ¨çš„ï¼šâ€œa differential opacity controlling how much radiance is accumulated by <strong><u>a ray passing through (x, y, z)</u></strong>â€ï¼Œæˆ‘å¯¹è¿™å¥è¯çš„ç†è§£å¹¶ä¸æ˜¯ç‰¹åˆ«æ·±ã€‚åœ¨æˆ‘ç²—æµ…çš„ç†è§£ä¸­ï¼Œæ­¤å¥çš„æ„ä¹‰æ˜¯ï¼šopacityé‡æ§åˆ¶çš„æ˜¯æœ€åæ¸²æŸ“çš„ç»“æœï¼Œæœ¬ç‚¹åœ¨æˆåƒæ—¶èƒ½å¯¹ç»“æœäº§ç”Ÿå¤šå¤§å½±å“ï¼Ÿæ¸²æŸ“åˆ°2Dæˆåƒå¹³é¢ä¸ŠæŸä¸€(u, v)ç‚¹çš„é¢œè‰²ï¼Œæ˜¯ä¸åŒ3Dç‚¹äº§ç”Ÿå…‰çº¿é¢œè‰²åœ¨æ­¤å¤„æŠ•å½±çš„åŠ æƒå¹³å‡ã€‚</p>
<p>â€‹ åœ¨åæ–‡æ‰€æåˆ°çš„NeRF++ä¸€æ–‡ä¸­ï¼Œä½œè€…é€šä¿—åœ°è§£é‡Šäº†NeRFè®­ç»ƒçš„ç»“æœã€‚</p>
<p>ï¼ˆ2ï¼‰è®­ç»ƒè¿‡ç¨‹ä¸­åŒä¸€æ¡å…‰æŸä¸Šï¼Œä¸åŒçš„3D volumeç‚¹æœ€åèåˆæˆçš„ç»“æœæ˜¯å¦ä¸ä¹‹å‰çœ‹çš„æŸå‡ ç¯‡multi-view depth estimationæ–¹æ³•ç›¸åŒï¼Ÿ</p>
<p>â€‹ å¹¶ä¸ä¸€æ ·ï¼Œmulti-view depth estimation äººå®¶çœŸçš„ä½¿ç”¨äº†dense voxel volumeï¼Œä½†æœ¬å·¥ä½œä¸­ï¼Œqueryç‚¹ä»…é™äºå…‰æŸä¸Šï¼Œå¹¶ä¸ä¼šå®é™…å˜æ¢åˆ°æŸä¸€ä¸ªvoxel volumeä¸­ï¼Œå†è¿›è¡Œå åŠ ã€‚æœ¬æ–‡è®­ç»ƒqueryå¾—åˆ°çš„ç‚¹ï¼Œå¹¶ä¸åœ¨å›ºå®šçš„voxelä¸­ï¼Œä½œè€…ä¹Ÿæåˆ°ï¼Œå›ºå®šçš„voxelä¼šä½¿å¾—æœ€ç»ˆçš„ç»“æœä¸voxelåˆ†è¾¨ç‡ç›¸å…³ï¼Œå¹¶ä¸”ä½œè€…æœ€åå¾—åˆ°çš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªæœ‰èƒ½åŠ›æ˜ å°„è¿ç»­ç©ºé—´çš„å‡½æ•°ã€‚</p>
<p>ï¼ˆ3ï¼‰ä»ç›´è§‰ä¸Šè®¨è®ºï¼Œpositional embeddingsä¸ºä»€ä¹ˆæœ‰åŠ©äºè¡¨å¾é«˜ç»´ä¿¡æ¯ï¼Ÿ</p>
<p>â€‹ æ­¤å¤„çš„positional embeddingsä¸æ˜¯learnable positional embeddingsï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯ç®€å•æš´åŠ›åœ°ä»<span class="math inline">\((x, y, z, \theta, \phi)\)</span>é€šè¿‡æŸä¸€ä¸ªç¥ç»ç½‘ç»œï¼ˆæ¯”å¦‚ä¸€ä¸ªMLPï¼‰æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œå› ä¸ºç®€å•è¿™æ ·åšæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œæ¯•ç«Ÿä¹‹åçš„åœºæ™¯è¡¨ç¤ºå°±æ˜¯ä¸€ä¸ªMLPï¼ŒMLPæ¥MLPç›¸å½“äºä¸€ä¸ªæ›´å¤§çš„MLPã€‚ä½œè€…åœ¨æ­¤å¤„ç”¨äº†ç±»ä¼¼äºTransformerçš„å¤„ç†æ–¹æ³•ï¼Œä¹Ÿå³ç”¨äº†ä¸€ç³»åˆ—ä¸åŒé¢‘ç‡çš„ <span class="math inline">\(\sin\)</span>, <span class="math inline">\(\cos\)</span> å‡½æ•°ç»„åˆæˆä¸€ä¸ªé«˜ç»´è¡¨å¾ã€‚é‚£ä¹ˆå¦‚ä½•æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´å‘é‡æˆ‘ä»¬å·²ç»æ¸…æ¥šäº†ï¼Œé‡ç‚¹æ˜¯ï¼šä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>â€‹ ç¬¬ä¸€ï¼Œå¦‚æœä»ä¸ªäººç›´è§‚ä¸Šç†è§£æ¥çœ‹ï¼Œä¹‹å‰æˆ‘ä»¬è®¨è®ºåˆ†ç±»å™¨æ—¶ï¼Œç»å¸¸ä¼šè¯´ï¼šä½ç»´åˆ†ä¸å¼€çš„ï¼ŒæŸä¸ªé«˜ç»´ç©ºé—´ä¸‹å¯èƒ½å°±å¯ä»¥åˆ†å¼€äº†ã€‚ä½ç»´ç©ºé—´ä¸‹çš„ç‰©ç†ä¸´è¿‘æ€§ï¼Œåœ¨é«˜ç»´ç©ºé—´ä¸­ä¸ä¸€å®šæˆç«‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ç»´è·ç¦»è¿‘çš„æ•°æ®å¯èƒ½åœ¨é«˜ç»´çš„å·®å¼‚å¾ˆå¤§ã€‚ä¸¤ä¸ªç›¸è¿‘çš„5Dè¾“å…¥ï¼Œç”±äºæ·±åº¦ä¸è¿ç»­æˆ–è€…ç‰©ä½“å½¢çŠ¶çªå˜ï¼Œè§‚æµ‹åˆ°çš„é¢œè‰²å¯èƒ½æˆªç„¶ä¸åŒï¼Œé‚£ä¹ˆè¿™ç§è¾“å…¥ä¸Šçš„ç©ºé—´ä¸Šè¶‹äºè¿ç»­å¹³æ»‘æ€§è´¨ï¼Œä¾¿æ˜¯ä½é¢‘ï¼Œç»è¿‡éçº¿æ€§æ˜ å°„ä¹‹åï¼Œè‡ªç„¶æ˜¯å¯èƒ½åˆ°æŸä¸€ä¸ªé«˜ç»´ç©ºé—´çš„ï¼Œåœ¨æ­¤é«˜ç»´ç©ºé—´ä¸‹ï¼Œä¸¤ä¸ªåŸè¿‘ä¼¼5Dè¾“å…¥æœ‰è¾ƒå¤§å·®åˆ«ï¼Œä¹Ÿå°±å½¢æˆäº†é«˜é¢‘ä¿¡å·ï¼ˆä½é¢‘å³å¹³æ»‘ç¼“å˜ï¼Œé«˜é¢‘åˆ™é—´æ–­è·³å˜ï¼‰ã€‚</p>
<p>â€‹ ç¬¬äºŒï¼Œä½œè€…æä¾›äº†ä¸€ç¯‡ICML 2018è®ºæ–‡[1]ï¼Œè®ºæ–‡ä¸­æå‡ºï¼š</p>
<blockquote>
<p>By using tools from Fourier analysis, we highlight a learning bias of deep networks towards low frequency functions.</p>
</blockquote>
<p>â€‹ å¦‚æœä¸é¢„å…ˆå°†æœ¬èº«å°±æ˜¯ä½é¢‘ä¿¡æ¯çš„ä½ç½®ä¸æ—‹è½¬å˜æ¢åˆ°é«˜ç»´ç©ºé—´ä¸‹ï¼Œç¥ç»ç½‘ç»œçš„è¡¨ç¤ºèƒ½åŠ›å°†ä¼šå—åˆ°æ›´å¤§çš„å‰Šå¼±ï¼ˆä½é¢‘è¾“å…¥--&gt; ç½‘ç»œå€¾å‘äºå­¦ä¹ ä½é¢‘ä¿¡æ¯ --&gt; æ¬ æ‹Ÿåˆï¼‰ã€‚</p>
<p>ï¼ˆ4ï¼‰volume densityæ˜¯è§†è§’ä¸å˜çš„ï¼Œæœ‰ä»€ä¹ˆé“ç†å—ï¼Ÿ</p>
<blockquote>
<p>We encourage the representation to be multiview consistent by restricting the network to predict the volume density Ïƒ as a function of only the location x</p>
</blockquote>
<p>â€‹ å¦‚æœè¯´densityåªä¸ä½ç½®æœ‰å…³ï¼Œé‚£ä¹ˆä½œè€…ç›¸å½“äºæ½œåœ¨åœ°åšäº†ç‰©ä½“è¡¨é¢é¢„æµ‹ï¼ˆé¢„æµ‹å“ªäº›æ˜¯å®é™…çš„ç‰©ä½“ç‚¹ï¼Œå“ªäº›æ˜¯ç©ºæ°”ç‚¹æˆ–è€…æ˜¯å†…éƒ¨ç‚¹ï¼‰ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯èƒ½çº¯ç²¹æ˜¯è¡¨é¢ä¼°è®¡+é€æ˜ç‰©ä½“é€æ˜åº¦ä¼°è®¡ã€‚NeRF++ä¸­ä¹Ÿç»™äº†ä¸€ä¸ªç±»ä¼¼çš„ã€éå¸¸ç®€æ˜çš„è§‚ç‚¹ã€‚</p>
<p>ï¼ˆ5ï¼‰ä»¥ä¸‹å…¬å¼ä¸­ä¸ºä»€ä¹ˆæœ‰ä¸€ä¸ªæŒ‡æ•°åˆ†å¸ƒï¼Ÿæ˜¯ä¹‹å‰çš„ä¸€ä¸ªå·²æœ‰æ¨¡å‹å—ï¼Ÿ <span class="math display">\[
\begin{equation}
C(\mathbf{r})=\int_{t_n}^{t_f}T(t)\sigma(\mathbf{r}(t))c(\mathbf{r}(t), \mathbf{d})dt, \text{ where } T(t)=\exp\left(-\int_{t_n}^t\sigma(\mathbf{r}(s))ds\right)
\end{equation}
\]</span> â€‹ æ˜¯çš„ï¼Œè¿™æ¶‰åŠåˆ°ä¸€äº›å›¾å½¢å­¦é‚»åŸŸçš„çŸ¥è¯†ã€‚Beer' s Lawä¸­æåˆ°çš„Volumetric Attenuation[2], å¦‚æœè®¤ä¸ºæŸä¸ªåŠé€æ˜æè´¨çš„é€æ˜åº¦ï¼ˆå…‰å¯¼ç‡ï¼‰æ˜¯æ’å®šçš„ï¼Œç©¿è¿‡å…¶ä¸­çš„å…‰çº¿å‡ºå°„æ—¶çš„å…‰å¼ºä¸åœ¨å…¶ä¸­ç©¿è¡Œçš„è·ç¦»æˆè´ŸæŒ‡æ•°å…³ç³»ã€‚æ­¤æŒ‡æ•°çš„å­˜åœ¨ä¸ <strong><u>å…‰çº¿ç©¿è¿‡ä¸€ä¸ªå…·æœ‰ä¸€å®šå¯¼å…‰ç‡ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ç©ºé—´ä¸­æœ‰ä¸€å®šdensityé˜»æŒ¡å…‰çš„ç²’å­ï¼‰çš„ä»‹è´¨è€Œä¸ä¸è¿™äº›ç²’å­ç¢°æ’çš„æ¦‚ç‡</u></strong>ã€‚ç”±äºä½œè€…æ˜¯åœ¨å…‰æŸä¸Šç¦»æ•£é‡‡æ ·ï¼Œæœ€åä½œè€…ç”¨äº†ä¸€ä¸ªç¦»æ•£æ±‚å’Œè¿‘ä¼¼äº†æ­¤ç§¯åˆ†ï¼Œç”šè‡³æœ€åä½œè€…è¿˜è¯´ï¼š</p>
<blockquote>
<p>This function for calculating <span class="math inline">\(\hat{C}(r)\)</span> from the set of (<span class="math inline">\(c_i, \sigma_i\)</span>) values is trivially differentiable and r<strong><u>educes to traditional alpha compositing</u></strong> with alpha values <span class="math inline">\(\alpha_i=1-\exp(-\sigma_i\delta_i)\)</span>.</p>
</blockquote>
<h3 id="ä¸€äº›æ‰©å±•æƒ³æ³•">2.3 ä¸€äº›æ‰©å±•æƒ³æ³•</h3>
<ul>
<li>ä¸ªäººæ„Ÿè§‰è¿™ä¸ªæ¨¡å‹æ˜¯å¯ä»¥é¢„è®­ç»ƒçš„ï¼Ÿé€šè¿‡ä»¿çœŸï¼Œå¯ä»¥ç”Ÿæˆå¾ˆå¤šè§†ç‚¹ä½å§¿å·®è·å¾ˆå°çš„å›¾åƒï¼Œå³ä½¿æ˜¯ç®€å•çš„åœºæ™¯ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ˜¯å¦å¯ä»¥åˆ›é€ ä¸€ä¸ªâ€œå…·æœ‰ç©ºé—´è¿ç»­æ€§â€å¹¶ä¸”â€œå…·æœ‰ä¸€å®š2Dåœºæ™¯è¿˜åŸèƒ½åŠ›â€çš„å¤§ç¯å¢ƒï¼Ÿä½¿ç”¨ä»¿çœŸæ•°æ®ï¼Œç”Ÿæˆå°è§†ç‚¹ä½å§¿å·®è·å›¾åƒè®­ç»ƒï¼Œå¹¶è¿›è¡Œç›‘ç£ï¼ˆè€ŒéæŠ•å½±å›åˆ°è¾“å…¥å›¾åƒï¼‰ï¼Œå¯èƒ½å¯ä»¥å¸®åŠ©è¿ç»­å¹³æ»‘å‡½æ•°çš„æ„å»ºï¼Ÿ</li>
<li>å·²çŸ¥NeRFæ˜¯ volumetric-basedï¼ˆå¼±volumetricï¼‰ï¼Œé‚£ä¹ˆPoint-based NeRFçš„åœ°ä½æ˜¯å¦æœ‰ç±»ä¼¼äº Eulerian &lt;---&gt; Lagrangianå¯¹å¶çš„å…³ç³»ï¼Ÿæ¢è¨€ä¹‹ï¼ŒPoint-based NeRFåœ¨NeRFé—®é¢˜ä¸Šç›¸è¾ƒäºvolumetric-based NeRFå–å¾—çš„æˆåŠŸï¼Œæ˜¯å¦åœ¨æ¿€å…‰SLAMé¢†åŸŸä¹Ÿæœ‰æŒ‡å¯¼æ„ä¹‰ï¼Ÿ</li>
</ul>
<hr>
<h2 id="iii.-nerf">III. NeRF++</h2>
<p>â€‹ NeRF++å¯ä»¥è¯´æ˜¯ä¸€ç¯‡å¾ˆå¥½çš„NeRFè¡¥å……æ–‡ï¼Œå…¶ä¸­ä¸å…‰è®¨è®ºäº†NeRFçš„æˆåŠŸåŸå› ï¼Œå¹¶ä¸”ä¹Ÿæå‡ºè§£å†³äº†NeRFåœ¨æ— çº¦æŸåœºæ™¯ï¼ˆå­˜åœ¨å¤§èŒƒå›´èƒŒæ™¯ï¼‰ä¸‹æ•ˆæœä¸å¥½é—®é¢˜çš„æ–¹æ³•ã€‚ä¸ªäººçš„å»ºè®®æ˜¯ï¼Œå¦‚æœçœ‹äº†NeRFä¸€æ–‡ï¼Œæƒ³è¦åŠ æ·±ç†è§£ï¼Œä¸€å®šè¦çœ‹çœ‹NeRF++ã€‚</p>
<p>â€‹ æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>è§£é‡Šäº†ä¸ºä»€ä¹ˆNeRFå¯ä»¥åœ¨æœ‰â€œshape-radiance ambiguityâ€é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å¾—åˆ°å¾ˆå¥½çš„ç»“æœ</li>
<li>æå‡ºäº†ä¸€ç§æ–°çš„parameterizationæ–¹æ³•ï¼Œç”¨äºè§£å†³unboundedå¤§èŒƒå›´èƒŒæ™¯åœºæ™¯é—®é¢˜</li>
</ul>
<h3 id="shape-radiance-ambiguity">3.1 Shape-Radiance Ambiguity</h3>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/sra.png" style="zoom:80%;">
</center>
<center>
Figure 3. Shape-Radiance Ambiguity é—®é¢˜ï¼šå½¢çŠ¶ä¸å¯¹ä½†æ˜¯é¢œè‰²å¯¹äº†ä¹Ÿèƒ½æ¢å¤å°‘éƒ¨åˆ†è§†è§’ä¸‹çš„å›¾åƒ
</center>
<p>â€‹ ä¹ä¸€çœ‹ï¼Œçœ‹ä¸æ‡‚ã€‚è¿™å•¥æ„æ€ï¼Ÿæˆ‘ä»¬é¦–å…ˆæ¥çœ‹NeRFçš„è¾“å‡ºï¼ŒNeRFå¯¹äºæ¯ä¸€ä¸ª3Dç‚¹ï¼Œåœ¨æ¯ä¸€ä¸ªè§†è§’ä¸‹ï¼Œè¾“å‡ºopacityï¼ˆview-independentï¼‰ä»¥åŠRGBï¼ˆview-dependentï¼‰ã€‚æ­¤opacityï¼Œæ­£å¦‚ä½œè€…æ‰€è¯´ï¼š</p>
<blockquote>
<p>NeRF reconstructs an <strong><u>opacity field <em>Ïƒ</em> representing a soft shape</u></strong>, along with a radiance field <strong>c</strong> representing view-dependent surface texture.</p>
</blockquote>
<p>â€‹ å°±æ˜¯ç‰©ä½“å½¢çŠ¶çš„ä¸€ç§softï¼ˆæŒ‡æ¨¡æ‹Ÿé‡ï¼Œåœ¨ç‰©ä½“çœŸæ­£å½¢çŠ¶é™„è¿‘çš„å€¼æ˜¯å¹³æ»‘è¿‡æ¸¡çš„ï¼‰è¡¨ç¤ºã€‚é‚£ä¹ˆåœ¨ä»…ä»…æ¸²æŸ“å¥½ä¸€ä¸ªï¼ˆæˆ–è€…å°‘æ•°çš„train setï¼‰è§†è§’çš„æƒ…å†µä¸‹ï¼ŒRGBä¸opacityä¼šå¦‚ä½•è¢«è®­ç»ƒï¼Ÿæœ¬æ–‡ä½œè€…ä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šå‡è®¾æˆ‘è®­ç»ƒæ—¶ä»…æœ‰å°‘æ•°å‡ ä¸ªè§†è§’ï¼Œæˆ‘è®¤ä¸ºåœ°å°†ç‰©ä½“çš„å½¢çŠ¶ï¼ˆopacityï¼‰<strong><u>è®­ç»ƒæˆä¸€ä¸ªçƒ</u></strong>ï¼Œè€Œé¢œè‰²ï¼Œåˆ™æ ¹æ®é‡æŠ•å½±ï¼ˆæ¸²æŸ“ï¼‰çš„ç»“æœä¸åŸå›¾çš„å·®åˆ«è¿›è¡Œä¼˜åŒ–ã€‚é‚£ä¹ˆå¯ä»¥å¯¹æ¯”ä¸€ä¸‹ï¼Œé¢„æœŸç»“æœä¸è¿™æ ·è®­ç»ƒçš„ç»“æœä¹‹é—´çš„å·®åˆ«ï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">æ­£å¸¸è®­ç»ƒ</a></li><li class="tab"><a href="#span-unique-name-2">è®­ä¸ªçƒ</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ æœ€åçš„ç»“æœï¼Œåº”å½“æ˜¯ï¼šæŸä¸€3Dç‚¹åœ¨æŸä¸€è§†è§’ä¸‹è§‚æµ‹åœ¨æˆåƒå¹³é¢ä¸Šä½“ç°çš„é¢œè‰² = ä¸åŒç‚¹ <strong><u>éƒ¨åˆ†å‡†ç¡®çš„</u></strong> RGBä¸ <strong><u>å‡†ç¡®çš„</u></strong> opacityï¼ˆå¯¹åº”äº†å‡†ç¡®çš„ç‰©ä½“å½¢çŠ¶ï¼‰çš„åŠ æƒå’Œã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ æ­¤ç»“æœåˆ™æ˜¯ï¼šæŸä¸€3Dç‚¹åœ¨æŸä¸€è§†è§’ä¸‹è§‚æµ‹åœ¨æˆåƒå¹³é¢ä¸Šä½“ç°çš„é¢œè‰² = å‡†ç¡®çš„RGB * 1ï¼ˆopacityåœ¨å•ä½çƒä¸Šï¼‰ã€‚</p></div></div></div>
<p>â€‹ ä½œè€…æƒ³è¡¨è¾¾çš„ä¹Ÿå°±æ˜¯ï¼šåœ¨ä¸éœ€è¦ç²¾ç¡®model 3Då½¢çŠ¶æ—¶ï¼Œåœ¨æŸå‡ ä¸ªå°‘æ•°è§†è§’ä¸‹ï¼Œæˆ‘ä¹Ÿèƒ½æŠŠæ­£ç¡®çš„2Då›¾åƒè¾“å‡ºã€‚æ¯”å¦‚ä¸‹é¢è¿™å¼ è¡—å¤´è‰ºæœ¯ï¼Œæ˜¾ç„¶ä½œè€…å¹¶æ²¡æœ‰åœ¨å¢™ä¸ŠçœŸçš„æä¸€ä¸ªè¿™æ ·çš„æ´ï¼Œä½†æ˜¯ä»–å´èƒ½æˆåŠŸåœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼ŒæŠŠä»–æƒ³è¦çš„3Dæ•ˆæœç»™ç”»å‡ºæ¥ã€‚</p>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/optical-illusion-murals-street-art-1010-19.jpg" style="zoom:100%;">
</center>
<center>
Figure 4. 2D-3Dè§†è§‰é”™è§‰ï¼šå½¢çŠ¶å®Œå…¨ä¸å¯¹ï¼Œä½†æ˜¯èƒ½è¡¨ç¤ºæ­£ç¡®çš„3Dæ„ä¹‰
</center>
<p>â€‹ è¿™æ˜¯ä¸ªä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œ<strong><u>è¿‡æ‹Ÿåˆé—®é¢˜</u></strong>ã€‚å°‘æ•°è§†è§’ä¸‹ï¼Œæˆ‘åªéœ€è¦é€šè¿‡ç¡¬è°ƒè¾“å‡ºä½¿å¾—ä¸è¾“å…¥ä¸€è‡´ï¼Œå®Œå…¨ä¸ç”¨ç®¡åŸç‰©ä½“å½¢çŠ¶èƒ¡æ¥ï¼Œå°±èƒ½è¾¾åˆ°ä¸€ä¸ªä½lossï¼Œè¿™æ ·çš„ç»“æœæœ‰æ³›åŒ–èƒ½åŠ›å—ï¼Ÿæ˜¾ç„¶æ˜¯æ²¡æœ‰çš„ã€‚NeRF++ä½œè€…åšäº†ä¸€ä¸ªå…³äºã€çƒå½¢opacityã€‘ç‰©ä½“çš„å®éªŒï¼š</p>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/demo.png" style="zoom:100%;">
</center>
<center>
Figure 3. æ¢è§†è§’åçš„æ³›åŒ–èƒ½åŠ›æå·®
</center>
<p>â€‹ é‚£ä¹ˆä¸ºä»€ä¹ˆNeRFé¿å…äº†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½œè€…è®¤ä¸ºï¼šå¦‚æœä¸å°½å¯èƒ½å‡†ç¡®è¡¨ç¤ºç‰©ä½“çš„3Dä¿¡æ¯ï¼ˆopacityå°½å¯èƒ½æ­£ç¡®ï¼‰ï¼Œé‚£ä¹ˆRGBè¾“å‡ºå¯¹åº”çš„å‡½æ•°å°†ä¼šæ˜¯é«˜é¢‘çš„ï¼Œä¸å¹³æ»‘çš„å‡½æ•°ã€‚å¾ˆæ˜¾ç„¶ï¼Œä¸€ä¸ªçƒçŠ¶ç‰©ä½“ï¼Œå¦‚æœè¦åœ¨å‡ ä¸ªä¸åŒçš„è§‚æµ‹ä¸‹çœ‹åˆ°çš„éƒ½æ˜¯ä¸€å¼ ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŒ–æ˜æœºçš„å›¾æ¡ˆï¼Œé‚£å¯¹äºæ¯ä¸€ä¸ª3Dç‚¹ï¼Œ<strong><u>å®ƒåœ¨ä¸åŒçš„è§‚æµ‹è§’åº¦ä¸‹çš„é¢œè‰²</u></strong> å¿…ç„¶æ˜¯å·®åˆ«å·¨å¤§çš„ï¼Œå°çš„è§‚æµ‹è§’å·®åˆ«å°±èƒ½å¸¦æ¥å¾ˆå¤§çš„è¾“å‡ºå˜åŒ–ï¼Œè¿™ä¸ªå‡½æ•°æ˜¾ç„¶æ˜¯é«˜é¢‘çš„ã€‚</p>
<p>â€‹ è€Œç”±è®ºæ–‡[1]ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ ç¥ç»ç½‘ç»œå­¦ä¹ é«˜é¢‘å‡½æ•°ç›¸å¯¹å›°éš¾ï¼Œä½é¢‘å‡½æ•°ä¼šè¢«ä¼˜å…ˆå­¦ä¹ ã€‚è€Œä½é¢‘å¯¹åº”ç€å¹³æ»‘ï¼Œå…³äºè¿™ç‚¹ï¼Œä½œè€…è¯´ï¼š</p>
<blockquote>
<p>For the correct shape, the surface light field will generally be much smoother (in fact, constant for Lambertian materials).</p>
</blockquote>
<p>â€‹ ç¡®å®å¦‚æ­¤ï¼Œæ­£å¸¸ç‰©ä½“ï¼Œå°¤å…¶æ˜¯å¤§å¤šæ•°äººé€ ç‰©ï¼Œé¢œè‰²éƒ½æ˜¯åˆ†å—ç›¸ç­‰çš„ï¼Œä¸åŒè§†è§’ä¸‹ç”±äºå…‰ç…§é—®é¢˜å¯èƒ½æœ‰ä¸€å®šå·®åˆ«ï¼Œä½†æ€»ä½“ä¸Šè¯´ï¼Œåº”è¯¥è¿˜æ˜¯å…·æœ‰å¹³æ»‘æ€§çš„ã€‚æ­¤å¤–ï¼Œé«˜é¢‘å‡½æ•°å¦‚æœéœ€è¦è¢«ç¥ç»ç½‘ç»œæ‰€è¡¨è¾¾ï¼Œå°†éœ€è¦æ›´å¤šå‚æ•°ã€‚æ¯•ç«Ÿå¯¹äºMLPæ¥è¯´ï¼Œæœ‰é™çš„å‚æ•°ï¼Œä»£è¡¨äº†å¯¹ç©ºé—´æœ‰é™çš„çº¿æ€§åˆ’åˆ†ï¼Œè€Œæœ‰é™çš„å±‚æ•°ï¼ˆå¯¹åº”æœ‰é™çš„activationï¼‰ï¼Œåˆ™å¯¹åº”ç€æœ‰é™çš„å¤æ‚å½¢çŠ¶ï¼ˆéçº¿æ€§å˜æ¢æ„å‘³ç€ç½‘ç»œå¯ä»¥è¡¨è¾¾æ›´åŠ å½¢çŠ¶ä¸°å¯Œçš„æµå½¢ï¼‰ã€‚è€Œä¸”ï¼Œæ ¹æ®ç»éªŒï¼Œè¿‡æ‹Ÿåˆï¼ˆé«˜é¢‘å‡½æ•°ï¼‰éƒ½æ˜¯åœ¨over-parameterizationä»¥åŠæ ·æœ¬è¿‡å°‘æ—¶å‘ç”Ÿçš„ã€‚</p>
<p>â€‹ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä½œè€…è¿˜è®¤ä¸ºNeRFçš„ç½‘ç»œç»“æ„è®¾è®¡ä¹Ÿä¸ shape radiance ambiguity çš„æ¶ˆé™¤æœ‰å…³ã€‚ä½†è¿™ä¸ªç†è®ºå°±ä¸å¦‚ä¸Šé¢æ‰€è¯´æƒ³æ³•é‚£ä¹ˆæœ‰ã€Ah-hahã€‘çš„æ„Ÿè§‰äº†ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚</p>
<h3 id="inverse-sphere-parameterization">3.2 Inverse Sphere Parameterization</h3>
<p>â€‹ ç”¨ä¸€å¥è¯æ¥æ€»ç»“è¿™éƒ¨åˆ†å·¥ä½œï¼Œå°±æ˜¯ï¼šInverse depthã€‚åœ¨åŒç›®è§†è§‰ä¸­ï¼Œå‡å¦‚æˆ‘ä»¬è¦ç›´æ¥è¡¨ç¤ºæ·±åº¦å›¾ï¼Œé€šå¸¸æ˜¯åšä¸åˆ°çš„ï¼Œå°¤å…¶åœ¨å®¤å¤–ã€‚å‡è®¾æˆ‘ä»¬çœ‹åˆ°äº†å¤©ç©ºï¼Œé‚£ä¹ˆå¤©ç©ºçš„è·ç¦»æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬debugæŸ¥çœ‹ä¸€ä¸‹å˜é‡ï¼Œå¥¥ NaN å•Šï¼Œé‚£æ²¡äº‹äº†ã€‚å¯¹äºåœºæ™¯ä¸­å­˜åœ¨è¾ƒå¤šè¾ƒè¿œç‰©ä½“æ—¶ï¼Œå³ä½¿æ²¡æœ‰infè·ç¦»ï¼Œä¹Ÿå¯èƒ½ä½¿å¾—ç½‘ç»œä¸å¾—ä¸å­¦ä¹ ã€è¾“å‡ºéœ€è¦åŠ ä¸€ä¸ªå¤§biasã€‘è¿™ç§å‚»ç‰¹å¾ã€‚åœ¨åŒç›®ç­‰åº”ç”¨ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½å–inverse depthï¼Œè·ç¦»è¿œå°±0ï¼Œè·ç¦»å†æ€ä¹ˆè¿‘ä¹Ÿä¸å¯èƒ½1/0ã€‚</p>
<p>â€‹ çœ‹NeRFä¸€æ–‡ä¸­çš„demoå°±çŸ¥é“ï¼Œå®ƒçš„è¾“å…¥ï¼Œéƒ½æ˜¯ä¸€äº›é™å®šå¤§å°çš„ç‰©ä½“ï¼Œå¹¶ä¸”è¿™äº›ç‰©ä½“è¿˜ç‰¹åœ°å»é™¤äº†èƒŒæ™¯ã€‚emmmï¼Œä½ è¯´å¦‚æœä¸€ä¸ªç½‘ç»œåªèƒ½å¤„ç†è¿™ç§æ•°æ®ï¼Œæˆ‘ä»¬ä¼šè¯„ä»·å®ƒï¼šæœªæ¥å¯æœŸã€‚é‚£ä¹ˆæœ¬ç€ã€æœªæ¥å·¥ä½œæœªæ¥å½•ã€‘çš„æƒ³æ³•ï¼Œæ˜¯æˆ‘åšå®¡ç¨¿äººæˆ‘å°±ç»™ä½ æ‹’äº†ï¼ˆè¯¯ï¼‰ã€‚ä¸ªäººè®¤ä¸ºï¼Œè‡³å°‘èƒŒæ™¯è¿˜æ˜¯è¦æœ‰çš„å§ï¼Œä¸ç„¶çœ‹èµ·æ¥è¿˜çœŸç¼ºç‚¹å®é™…æ„ä¹‰ã€‚NeRF++ä½œè€…è®¤ä¸ºï¼Œå¸¸è§„NeRFï¼Œç”±äºè®­ç»ƒä½¿ç”¨çš„æ˜¯ç‚¹é‡‡æ ·è¿™ç§æ–¹æ³•ï¼Œå¯¹äºå¤§å‹unboundedåœºæ™¯æ¥è¯´ï¼Œè¿œè·ç¦»ä¸‹é‡‡æ ·è¦å¤šå°‘ä¸ªç‚¹æ‰ç®—å¤Ÿï¼Ÿç¦»æ•£çš„è¯ï¼Œèƒ½å¾ˆå¥½è¿‘ä¼¼æ¸²æŸ“è¿‡ç¨‹çš„ç§¯åˆ†å—ï¼Ÿå¤ªç¨ å¯†çš„è¯ï¼Œæ˜¯å¦ä¼šä½¿å¾—ç½‘ç»œä¸“æ³¨äºèƒŒæ™¯å»ºæ¨¡ï¼Œä½¿å¾—å‰æ™¯çš„æ•ˆæœå˜å·®ï¼Ÿå¹¶ä¸”ä¹Ÿæ¶ˆè€—è®¡ç®—èµ„æºï¼Ÿä½œè€…å‘ç°ç¡®å®ä¼šè¿™æ ·ï¼š</p>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/nearfar.png" style="zoom:80%;">
</center>
<center>
Figure 5. ç»å…¸é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—
</center>
<p>â€‹ é’ˆå¯¹æ­¤é—®é¢˜ï¼Œä½œè€…æå‡ºäº†è¿™æ ·çš„æ–¹æ³•ï¼š</p>
<ul>
<li>ç”±äºå¤šè§†è§’é‡å»ºé—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯é’ˆå¯¹ç‰©ä½“çš„ï¼ˆæœ‰focusï¼Œæœ‰ä¸€ä¸ªå¯ä»¥ è¢«bound çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡å‘¨å›´éƒ¨åˆ†boundedåŒºåŸŸï¼Œç”¨ä¸€ä¸ªNeRFæ¥æè¿°ï¼Œæ­¤NeRFä»€ä¹ˆä¹Ÿä¸éœ€è¦æ”¹ï¼Œå› ä¸ºå¤„ç†çš„åŒºåŸŸæ˜¯å°èŒƒå›´boundedçš„åŒºåŸŸã€‚é€‰æ‹©ä¸€ä¸ªçƒå‹åŒºåŸŸï¼Œæ‰€æœ‰çš„ç›¸æœºä½ç½®éƒ½è¢«åŒ…æ‹¬åœ¨è¿™ä¸ªçƒå‹åŒºåŸŸå†…ã€‚</li>
<li>å¤–éƒ¨åŒºåŸŸï¼Œå…¨éƒ¨ç”¨inverse sphereè¡¨ç¤ºã€‚</li>
</ul>
<center>
<img src="/2022/03/13/Neural-Radiance-Field%E3%80%901%E3%80%91/inverse.png" style="zoom:67%;">
</center>
<center>
Figure 6. å·²çŸ¥å…‰çº¿æ–¹å‘ä¸ræ±‚å…¶åœ¨inverse sphereä¸Šçš„æŠ•å½±
</center>
<p>â€‹ ä¸Šå›¾å°±èƒ½å¾ˆæ¸…æ™°åœ°è¯´æ˜inverse sphereçš„å·¥ä½œåŸç†ã€‚å¯¹äºä¸€ä¸ªå·²çŸ¥rï¼Œå½“rå°äºä¸€ä¸ªé˜ˆå€¼<span class="math inline">\(r_0\)</span>æ—¶ï¼Œè¯´æ˜æ­¤ç‚¹åœ¨boundedåŒºåŸŸå†…ï¼Œå¯ä»¥ç›´æ¥ç”¨NeRFåŠå…¶å¯¹åº”çš„é‡‡æ ·æ±‚å’Œè¿‘ä¼¼ç§¯åˆ†æ¥è®¡ç®—æ¸²æŸ“ç»“æœã€‚å¤§äº<span class="math inline">\(r_0\)</span>æ—¶ï¼Œç”¨inverse sphereå¯¹åº”çš„é‡‡æ ·æ–¹æ³•ï¼š<u><strong>åªéœ€è¦åœ¨<span class="math inline">\(r&#39;=1/r\)</span>ï¼Œ <span class="math inline">\(r&#39;\)</span>åœ¨[0, 1]åŒºé—´å†…éšæœºé‡‡æ ·å³å¯</strong></u>ã€‚ç”±äº3Dç‚¹ç‚¹påœ¨å…‰çº¿ä¸Šï¼ˆä¸åœ¨sphereåŠå¾„æ–¹å‘ä¸Šï¼‰ï¼Œä¸€èˆ¬éœ€è¦æ ¹æ®rå€¼ä»¥åŠå…‰çº¿æ–¹å‘ï¼Œæ±‚å…¶åœ¨inverse sphereä¸Šçš„æŠ•å½±ä½ç½®<span class="math inline">\((x&#39;,y&#39;,z&#39;)\)</span>ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°æ–¹æ³•äº†ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="http://proceedings.mlr.press/v97/rahaman19a/rahaman19a.pdf">Rahaman, Nasim, et al. "On the spectral bias of neural networks." <em>International Conference on Machine Learning</em>. PMLR, 2019. ã€æ³¨ï¼šä½œè€…è²Œä¼¼ICMLè½¬åˆŠPMLRäº†ã€‘</a></p>
<p>[2] <a href="https://graphics.cg.uni-saarland.de/courses/cg1-2019/">Philipp Slusallek, Computer Graphics: Chapter - Volume Rendering.</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>NeRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Nvidia ç®€å•ç¯å¢ƒå·¥ç¨‹</title>
    <url>/2021/11/21/Nvidia-%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E5%B7%A5%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="ampere-pytorch">Ampere Pytorch</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ è¿‘æ—¥è®­ç»ƒç¥ç»ç½‘ç»œèŠ±äº†äº”å…­åå—é’±ï¼Œåœ¨<a href="http://www.ai-galaxy.cn/">æ™ºæ˜Ÿäº‘</a>å¹³å°ä¸Šã€‚è¿™ä¸ªäº‘å¹³å°æ€»çš„æ¥è¯´è¿˜æ˜¯å¾ˆä¾¿å®œçš„ï¼ŒRTX 3090å¤§æ¦‚4å…ƒ/hï¼Œä¹‹å‰è®­ç»ƒèƒ¶å›Šç½‘ç»œçš„æ—¶å€™è¿˜ç‹ å¹äº†è¿™ä¸ªå¹³å°ä¸€æ³¢ã€‚ä½†æˆ‘æœ€è¿‘æ„Ÿè§‰ï¼Œè¯¥å¹³å°è²Œä¼¼æœ‰ç‚¹å‘ï¼š</p>
<ul>
<li>RTX 2080Tiçš„è®­ç»ƒé€Ÿåº¦æ¯”æˆ‘çš„MX 150ï¼ˆæ¯”GTX 960æ›´å·®ä¸€ç‚¹çš„å¡ï¼‰æ›´æ…¢ï¼ŒRTX 3090æ²¡æœ‰3090çš„æ ·å­</li>
<li>ç¯å¢ƒéå¸¸è¿·æƒ‘ï¼šæ¯”å¦‚å…¶1080 Tiçš„ç¯å¢ƒï¼ŒCUDA10.0 + Torch 1.4.0ï¼Œç›´æ¥æ²¡åŠæ³•è·‘</li>
</ul>
<p>â€‹ äºæ˜¯ä¹æˆ‘åœ¨åŠå…¬å®¤ä¸€ä¸ªåŒäº‹çš„ç”µè„‘ä¸Šè£…äº†æ•´ä¸ªæ·±åº¦å­¦ä¹ ç¯å¢ƒã€‚å¾ˆä¸å¹¸ï¼ˆåˆå¹¸è¿ï¼‰çš„æ˜¯ï¼Œä»–çš„æ˜¾å¡æ˜¯RTX 3060ï¼Œå¯¹åº”æ¶æ„ä¸ºå®‰åŸ¹ï¼ˆAmpere sm_86ï¼‰ï¼Œä¸å…¼å®¹ä½ç‰ˆæœ¬torchï¼Œä½¿ç”¨ä¸äº†CUDAåŠ é€Ÿã€‚è€ƒè™‘åˆ°æˆ‘ä¹‹å‰æœ‰è£…æ˜¾å¡é©±åŠ¨æçˆ†ç³»ç»Ÿçš„ç»å†ï¼Œæˆ‘å†³å®šè®°å½•ä¸€ä¸‹æœ¬æ¬¡ç¯å¢ƒå·¥ç¨‹çš„è¿‡ç¨‹ã€‚</p>
<center>
<img src="/2021/11/21/Nvidia-%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E5%B7%A5%E7%A8%8B/3060.png" style="zoom:67%;">
</center>
<center>
Figure 1. çœ‹èµ·æ¥å¾ˆä¾¿å®œ é»„ä»å‹‹Yes
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-è¿‡ç¨‹">II. è¿‡ç¨‹</h2>
<h3 id="æŸ¥çœ‹ç¯å¢ƒ">2.1 æŸ¥çœ‹ç¯å¢ƒ</h3>
<p>â€‹ ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯éœ€è¦æŸ¥çœ‹ç¡¬ä»¶å‚æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­å³ä¸Šè§’ä¼šå‡ºç°CUDAç‰ˆæœ¬ï¼š</p>
<center>
<img src="/2021/11/21/Nvidia-%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E5%B7%A5%E7%A8%8B/smi.png">
</center>
<center>
Figure 2. nvidia-smiç‰ˆæœ¬å·
</center>
<p>â€‹ ä½†è¿™åªæ˜¯è¯¥é©±åŠ¨ï¼ˆ426.00ï¼‰å¯ä»¥æ”¯æŒçš„ <strong><u>æœ€é«˜ç‰ˆæœ¬CUDA</u></strong>ã€‚éœ€è¦æŸ¥çœ‹è‡ªå·±çš„CUDAç‰ˆæœ¬åˆ™éœ€è¦ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nvcc --version</span><br></pre></td></tr></table></figure>
<p>â€‹ ç„¶åæˆ‘å‘ç°ï¼Œè¯¥åŒå­¦çš„é©±åŠ¨æ˜¯475.05.xxï¼ˆå¿˜äº†ï¼‰ï¼Œä½†æ˜¯CUDAç‰ˆæœ¬å´æ˜¯9.1ã€‚è™½è¯´è‹±ä¼Ÿè¾¾é©±åŠ¨å‘ä¸‹å…¼å®¹ï¼Œä½†æ˜¯9.1å¬èµ·æ¥åƒæ˜¯ä¸Šä¸ªä¸–çºªçš„ä¸œè¥¿ï¼ˆé›¾ï¼‰ã€‚ç›´æ¥å‡çº§CUDAå³å¯ã€‚</p>
<h3 id="ä¹±æé©±åŠ¨">2.2 ä¹±æé©±åŠ¨</h3>
<p>â€‹ æˆ‘é€‰æ‹©çš„æ˜¯CUDA 11.4ï¼Œå…¶å®‰è£…ç¨‹åºå¯ä»¥é™„å¸¦å®‰è£…é©±åŠ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰é©±åŠ¨ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚Ubuntu 18.04ç«¯æˆ‘é€‰æ‹©çš„æ˜¯è„šæœ¬æ–‡ä»¶å®‰è£…(.run æ–‡ä»¶)ï¼Œå› ä¸ºè¿™ä¸ªå¯ä»¥å—æ§ã€‚ä½†æ˜¯å®‰è£…æ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š</p>
<blockquote>
<p>Existing package manager found... (ç„¶åå»ºè®®ä½ åœ¨ç»§ç»­å®‰è£…å‰removeè¿™ä¸ªexisting package manager of the driver).</p>
</blockquote>
<p>â€‹ <a href="https://askubuntu.com/questions/1211919/error-installing-cuda-toolkit-existing-package-manager-installation-of-the-driv">Ask Ubuntu</a>ä¸Šæœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œè¯´æ˜¯<code>--toolkit --silent --override</code>ç­‰ç­‰flagä¸Šå»å°±è¡Œäº†ã€‚ä½†ä¸ªäººå°è¯•æ— æ•ˆï¼ŒæŒ‰ç…§å›ç­”ç›´æ¥æ‰§è¡Œä¹‹åï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿæ²¡å®‰è£…å¥½CUDAã€‚ç›´æ¥è¿è¡Œè„šæœ¬ï¼Œæš—è£…è„šæœ¬ä¼šåˆ—ä¸¾å°†ä¼šè¢«å®‰è£…çš„å†…å®¹ï¼Œç¬¬ä¸€æ¬¡å®‰è£…æ—¶æˆ‘ç›´æ¥å–æ¶ˆäº†é™¤äº†Toolkitä¹‹å¤–çš„å…¶ä»–é€‰é¡¹ï¼Œæœ€åè²Œä¼¼ä¹Ÿæ²¡è£…ä¸Šå»ã€‚</p>
<p>â€‹ <strong><u>æˆ‘æ€’äº†ï¼Œå¼€å§‹æš´åŠ›äº†èµ·æ¥ï¼ˆå®‰å…¨çš„æš´åŠ›ï¼‰</u></strong>ã€‚æˆ‘å•ªåœ°ä¸€ä¸‹ç«™èµ·æ¥äº†ï¼Œå¾ˆå¿«å•Šï¼Œè¾“å…¥äº†ä»¥ä¸‹è„šæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">ä¸‹é¢è¿™ä¸€å¥ä¸ºäº†çœ‹çœ‹è¿™ä¸ªç”µè„‘ä¸Šéƒ½è£…äº†å“ªäº›CUDAç›¸å…³åº“</span></span><br><span class="line">dpkg -l | grep &quot;cuda&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">åˆ é™¤CUDAç›¸å…³åŒ…ä»¥åŠå…¶é…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo apt-get remove cuda*</span><br><span class="line">sudo apt-get purge cuda*</span><br><span class="line"><span class="meta"># </span><span class="language-bash">ä¸è¦éšä¾¿ç”¨autoremoveï¼é™¤éä½ çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆæˆ–è€…ä½ å¯¹autoremoveçš„åŒ…è¿›è¡Œä»”ç»†çš„æ£€æŸ¥</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">CSDNä¸Šå°±æœ‰autoremoveï¼Œè¯„è®ºåŒºå·²ç»æœ‰å´©æºƒè€å“¥è¯´è‡ªå·±autoremoveäº†ä¸€äº›é‡è¦åŒ…ä¸å¾—ä¸é‡è£…ç³»ç»Ÿäº†</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">æ˜¾å¡é©±åŠ¨ï¼Œåˆ é™¤</span></span><br><span class="line">sudo apt-get remove nvidia*</span><br><span class="line">sudo apt-get purge nvidia*</span><br></pre></td></tr></table></figure>
<p>â€‹ æ‰§è¡Œç»“æŸä¹‹åï¼Œrebootã€‚</p>
<h3 id="å®‰è£…é©±åŠ¨">2.3 å®‰è£…é©±åŠ¨</h3>
<p>â€‹ æ‰§è¡Œäº†ä¸Šé¢è¿™äº›å‘½ä»¤ä¹‹åæˆ‘é‡å¯äº†ç”µè„‘ï¼Œæœç„¶ï¼Œå›¾å½¢ç•Œé¢æ‰“ä¸å¼€äº† ï¼Œå› ä¸ºæ˜¾å¡é©±åŠ¨å·²ç»æ²¡äº†ã€‚çœ‹åˆ°è¿™é‡Œå¹¶ä¸”æ‰§è¡Œåˆ°è¿™é‡Œçš„xdmå¯ä»¥å‡†å¤‡é‡è£…ç³»ç»Ÿäº†ï¼ˆè¯¯ï¼‰ã€‚åœ¨ç”µè„‘å¯åŠ¨ç•Œé¢ï¼ŒGRUBæœ‰é€‰æ‹©ç³»ç»Ÿçš„ç”»é¢ï¼Œé€‰æ‹©Ubuntu Recoveryé¡¹ï¼Œè¿›å…¥recoveryæ¨¡å¼è¿›è¡Œé©±åŠ¨å®‰è£…ã€‚recoveryä¸éœ€è¦æ˜¾å¡é©±åŠ¨ä¹Ÿå¯ä»¥å¯åŠ¨å›¾å½¢ç•Œé¢ã€‚</p>
<p>â€‹ è¿›å…¥recoveryæ¨¡å¼ä¹‹åï¼Œæ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç³»ç»Ÿé‡Œæ²¡æœ‰æ˜¾å¡é©±åŠ¨äº†ï¼ˆnvidia-smiæŠ¥é”™äº†ï¼‰ï¼Œé‚£å°±å¯ä»¥è‚†æ— å¿Œæƒ®åœ°è£…é©±åŠ¨äº†ã€‚ç›´æ¥è¿è¡Œé©±åŠ¨å®‰è£…è„šæœ¬ï¼Œå®‰è£…é¡¹å¯ä»¥å…¨éƒ¨å‹¾é€‰ã€‚å®‰è£…å®Œæ¯•ä¹‹åï¼Œå®‰è£…ç¨‹åºå°†ä¼šæç¤ºæˆ‘ä»¬è¿›è¡Œç¯å¢ƒå˜é‡è®¾å®šï¼Œæ­¤æ—¶åªéœ€è¦ä¿®æ”¹<code>.bashrc</code>æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=$PATH:...</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:...</span><br></pre></td></tr></table></figure>
<p>â€‹ æ£€æŸ¥<code>nvidia-smi</code>ä»¥åŠ<code>nvcc</code>ä¸¤ä¸ªæŒ‡ä»¤æ˜¯å¦å¯ä»¥æ­£ç¡®æ‰§è¡Œã€‚æŒ‰ä»¥ä¸Šæ­¥éª¤ï¼ˆå…ˆåˆ é™¤ï¼Œå†é‡è£…ï¼‰çš„æ–¹å¼ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚é‡å¯å³å¯ï¼Œé‡å¯ä¹‹åå®‰è£…ä¸€äº›æ‰©å±•åº“ï¼ˆå¯é€‰ï¼‰æ¯”å¦‚cuDNNä»¥åŠNCCLï¼Œè¿™ä¸¤ä¸ªåº“çš„å®‰è£…è¦é¢†åªæœ‰ä¸€ä¸ªï¼šä¸Šè‹±ä¼Ÿè¾¾å®˜ç½‘å¯¹ç…§æ¸…æ¥šè‡ªå·±çš„é©±åŠ¨ã€CUDAç‰ˆæœ¬å¯¹åº”å“ªä¸ªç‰ˆæœ¬çš„cuDNNæˆ–è€…NCCLï¼Œç‰ˆæœ¬å¯¹äº†å°±æ²¡é—®é¢˜ï¼Œåæ­£éƒ½æ˜¯<code>.deb</code>åŒ…ï¼Œä¸€ä¸ª<code>sudo dpkg -i</code>å®‰è£…å°±ç»“æŸäº†ã€‚</p>
<h3 id="å®‰è£…pytorch">2.4 å®‰è£…Pytorch</h3>
<p>â€‹ Pytorchå³ä½¿åœ¨æœ€æ–°çš„é©±åŠ¨ä»¥åŠCUDAï¼ˆ11.4ï¼‰å®‰è£…å¥½ä¹‹åï¼Œä»ç„¶ä¸åŒå…¶çƒ¦åœ°å‘Šè¯‰ä½ ï¼š<code>sm_86</code> is not a supported architecture for Pytorch, among [... up to sm_70] blahblahblahã€‚åœ¨è¿™é‡Œæˆ‘é‡åˆ°äº†ä¸¤ä¸ªå‘ï¼š</p>
<h4 id="å¤šé‡pytorch">2.4.1 å¤šé‡Pytorch</h4>
<p>â€‹ æˆ‘æƒŠå¥‡åœ°å‘ç°ï¼Œpipç®¡ç†åŒ…çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªåº“å…è®¸å¤šä¸ªç‰ˆæœ¬å­˜åœ¨ã€‚å¯¹äºè¿™ç§è¡Œä¸ºï¼Œæˆ‘ä¸æ˜¯å¾ˆèƒ½ç†è§£ï¼Œæ¯•ç«ŸæŒ‰æˆ‘çš„ç†è§£ï¼Œå¤§å¤šæ•°ç”¨æˆ·çš„Pythonç‰ˆæœ¬æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰è·¨ç‰ˆæœ¬çš„éœ€æ±‚ï¼ˆç”¨Dockeræˆ–è€…Condaç®¡ä¸€ç®¡ä¸å¥½ä¹ˆï¼‰ã€‚ä½†æˆ‘åœ¨æ‰§è¡Œ<code>pip3 list</code> ä¹‹åï¼Œå‘ç°ç”µè„‘ä¸Šæœ‰ï¼š<code>1.7.1\1.8.0\1.10.0</code> ä¸‰ä¸ªç‰ˆæœ¬çš„torchï¼Œæ¯æ¬¡å®‰è£…å‰çš„åˆ é™¤å®é™…ä¸Šéƒ½æ²¡æœ‰åˆ é™¤å¹²å‡€ã€‚</p>
<h4 id="cuda-wheel">2.4.2 CUDA Wheel</h4>
<p>â€‹ æœ¬åœ°å®‰è£… CUDA 11.4 å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ CUDA11.4 æ”¯æŒã€‚æˆ‘ä»¬çŸ¥é“ï¼ˆä½ çŸ¥é“å—ï¼‰ï¼ŒPythonè™½ç„¶ä½œä¸ºä¸€ç§åŠ¨æ€è¯­è¨€ï¼Œè¿è¡Œæ—¶è§£é‡Šï¼Œå®ƒä¹Ÿæ˜¯æ”¯æŒä½¿ç”¨ç¼–è¯‘å¥½çš„åº“çš„ï¼ˆåªè¦ç¼–è¯‘æˆ <code>.so</code> æˆ–è€… <code>.dll</code> åŠ¨æ€åº“å°±è¡Œï¼‰ï¼Œpip3 ä¸åªæ˜¯å®‰è£…æºç ï¼Œå®ƒä¹Ÿä¼šå®‰è£…ä¸€äº›åŠ¨æ€åº“ï¼Œ<strong><u>è¿™äº›åŠ¨æ€åº“çš„ç¼–è¯‘æ–¹å¼</u></strong>å†³å®šäº† pip3 å®‰è£…çš„åº“æœ¬èº«çš„ä¸€äº›æ€§è´¨ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ <a href="https://enigmatisms.github.io/2021/09/23/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%901%E3%80%91/">CUDA è¸©å‘å®å½• ã€1ã€‘</a> ä¸­å·²ç»å®è·µè¿‡ï¼ŒCUDAç¨‹åºä½œä¸ºCUDA Extensionè¢« pytorch / python è°ƒç”¨ï¼Œè¢«è°ƒç”¨çš„ç¨‹åºæ˜¯ç”± nvcc ç¼–è¯‘çš„ï¼Œnvccçš„ä¸€äº› flag åˆ™å†³å®šäº†ä»£ç å—åˆ°ä»€ä¹ˆæ ·çš„ architecture æ”¯æŒï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ˜¾å¼å®šä¹‰ <code>-arch=sm_86</code> å°±èƒ½ä½¿å¾— <code>sm_86</code> æ¶æ„å¾—åˆ°æ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­éœ€è¦é€‰æ‹©CUDA Wheelsï¼Œä¹Ÿå°±æ˜¯æ‰‹åŠ¨å†™ä¸€ä¸ªï¼ˆ+xxxï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install torch==1.10.0+cu113</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸Šé¢çš„ <code>+cu113</code> å°±è¡¨ç¤ºï¼Œæˆ‘ä»¬é€‰æ‹©CUDA 11.3 wheelsï¼Œåº”è¯¥å°±æ˜¯è¯´ï¼Œæœ¬åº“çš„ç¼–è¯‘æ˜¯æœ‰ CUDA 11.3 å®Œæˆçš„ã€‚è™½ç„¶æœ¬åœ°æ˜¯11.4ï¼Œä½†å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œå¯¹äº RTX 3060 è¿™ç§ <code>sm_86</code> capability çš„è®¾å¤‡ï¼Œåªè¦ CUDA 11 + å°±å¯ä»¥äº†ã€‚</p>
<p>â€‹ å¦ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ° CUDA å®Œæˆåº“å®‰è£…ï¼šä»å®˜ç½‘ä¸Šä¸‹è½½sourceï¼ˆPytorchåº•å±‚å°±æ˜¯åœ¨è°ƒç”¨C++ä»£ç å˜›ï¼‰ï¼Œæœ¬åœ°ç”¨ nvcc å¯¹ source è¿›è¡Œæ‰‹åŠ¨ç¼–è¯‘ï¼Œä½†è¿™ç¡®å®æœ‰ä¸€ç‚¹éº»çƒ¦ã€‚</p>
<h3 id="éªŒè¯">2.5 éªŒè¯</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.cuda.is_available()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tmp = torch.zeros(<span class="number">1</span>).cuda()</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ åªè¦æ²¡æœ‰ä»»ä½•warningæˆ–è€…errorï¼Œå°±æ˜¯æˆåŠŸã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>ç¯å¢ƒå·¥ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Particle Filter Simulation</title>
    <url>/2021/08/07/Particle-Filter-Simulation/</url>
    <content><![CDATA[<h1 id="particle-filter">Particle Filter</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ å¤§äºŒä¹°äº†ä¸€æœ¬ <em>Probability Robotics(of Sebastian Thrun, et al)</em>ï¼Œå…¶ä¸­ç²’å­æ»¤æ³¢çš„æ¦‚ç‡è®ºçŸ¥è¯†è®²å¾—å¾ˆæ¸…æ¥šã€‚å¤§äºŒå­¦å®Œæ¦‚ç‡è®ºä¹‹åç»™æˆ‘çœ‹æ˜ç™½äº†ï¼Œäººç”Ÿç¬¬ä¸€æ¬¡åœ¨ç†è®ºå­¦ä¹ ä¸Šé‚£ä¹ˆæœ‰æˆå°±æ„Ÿã€‚ä½†æ˜¯çœ‹å®Œä¹‹åæ€»è§‰å¾—å¹²å·´å·´çš„ï¼Œä¸çŸ¥é“å¦‚ä½•åº”ç”¨ã€‚æœ€è¿‘å†™å®Œäº† Volume2D Shaderï¼Œçªç„¶æƒ³åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•å¯ä»¥åº”ç”¨ç²’å­æ»¤æ³¢ï¼Œäºæ˜¯å®ç°äº†ä¸€ç‰ˆã€‚åŠå¤©å†™å®Œï¼Œæ•ˆæœä¸é”™ï¼Œè§<a href="https://github.com/Enigmatisms/ParticleFilter">[Github RepoğŸ”—:Enigmatisms/ParticleFilter]</a>ï¼š</p>
<p><img src="/2021/08/07/Particle-Filter-Simulation/ray2.png"></p>
<center>
Figure 1. Particle Filter ä¸­ä½¿ç”¨Volume2D Shaderè¿›è¡Œçš„æ¿€å…‰é›·è¾¾scanä»¿çœŸ
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-ç†è®ºæ¨å¯¼">II. ç†è®ºæ¨å¯¼</h2>
<h3 id="ç›®æ ‡">2.1 ç›®æ ‡</h3>
<p>â€‹ æˆ‘ä»…ä»…è®¨è®ºç²’å­æ»¤æ³¢åœ¨localizationä¸­çš„ä½œç”¨ï¼Œè™½ç„¶localizationåªæ˜¯PFç†è®ºåº”ç”¨çš„ä¸€ä¸ªå°æ–¹å‘ã€‚å¦‚æœæ²¡æœ‰ç»™å®šåˆå€¼ï¼Œä¹Ÿæ²¡æœ‰å¾ˆå¥½åœ°åˆ©ç”¨è§‚æµ‹ä¿¡æ¯ï¼ŒlocalizationåŸºæœ¬å°±æ˜¯åœ¨ä¹±çŒœå…¶åœ¨ç©ºé—´ä¸­çš„ä½ç½®ã€‚å¹¶ä¸”ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œåªä½¿ç”¨å½“å‰scanä¹Ÿæ— æ³•å‡†ç¡®è·å¾—å®šä½ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤§é‡çš„é‡å¤åœ°å›¾ç‰¹å¾ã€‚</p>
<p>â€‹ å¥½åœ¨æˆ‘ä»¬æœ‰è¿ç»­çš„è§‚æµ‹ä»¥åŠè¿ç»­çš„æ§åˆ¶ï¼Œå‡è®¾æ§åˆ¶ä¸è§‚æµ‹åºåˆ—ï¼š</p>
<ul>
<li>æ§åˆ¶åºåˆ—: <span class="math inline">\(U_t:\{u_1,u_2,...u_{t}\}\)</span>â€‹â€‹ï¼Œ<span class="math inline">\(u_t\)</span>â€‹è¡¨ç¤ºä»çŠ¶æ€<span class="math inline">\(x_{t-1}\)</span>â€‹è¿‡æ¸¡åˆ°<span class="math inline">\(x_t\)</span>â€‹çš„æ§åˆ¶â€‹</li>
<li>è§‚æµ‹åºåˆ—ï¼š<span class="math inline">\(Z_t:\{z_0,z_1,....z_{t}\}\)</span>â€‹â€‹ï¼Œ<span class="math inline">\(z_t\)</span>â€‹è¡¨ç¤ºåœ¨çŠ¶æ€<span class="math inline">\(x_t\)</span>â€‹â€‹ä¸‹çš„è§‚æµ‹â€‹</li>
</ul>
<p>â€‹ æˆ‘ä»¬ä¸å¸Œæ±‚é€šè¿‡<span class="math inline">\(z_t\)</span>â€‹æ¥æ±‚ä½¿å¾—<span class="math inline">\(P(x_t|z_t)\)</span>â€‹â€‹æœ€å¤§çš„<span class="math inline">\(x_t\)</span>ï¼Œè€Œæ˜¯éœ€è¦æ±‚ï¼š <span class="math display">\[
\begin{equation}\label{post}
x_t^* = \mathop{\arg \max}_{x_t}P(x_t|Z_t,U_t)
\end{equation}
\]</span> â€‹ å®é™…ä¸Šï¼Œå¯ä»¥è¯´å…¬å¼<span class="math inline">\(\eqref{post}\)</span>å®šä¹‰çš„æ˜¯ä¸€ä¸ªåéªŒæ¦‚ç‡ã€‚ä¹Ÿå°±æ˜¯æœ€å¤§åŒ–ä¸€ä¸ªåéªŒæ¦‚ç‡äº†ï¼Œå•Šè¿™ä¸å°±æ˜¯ è´å¶æ–¯æ»¤æ³¢å—ï¼Ÿç¡®å®ï¼Œç²’å­æ»¤æ³¢å°±æ˜¯è´å¶æ–¯æ»¤æ³¢çš„ä¸€ä¸ªéå‚æ•°å®ç°ã€‚</p>
<p>â€‹ ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œæ²¡æœ‰é©¬å°”å¯å¤«å‡è®¾ï¼Œäº‹æƒ…ä¼šå˜å¾—å¾ˆå¤æ‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹ä¸€å¤§ä¸²æ§åˆ¶ / çŠ¶æ€åºåˆ—è¿›è¡Œå¤„ç†ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p>
<h3 id="ç²’å­ä¸é‡‡æ ·">2.2 ç²’å­ä¸é‡‡æ ·</h3>
<p>â€‹ è¿™æ˜¯ä¸æ˜¯è‡ªç„¶è®¡ç®—ï¼Ÿç²’å­æ˜¯ä¸€ä¸ªä¸ªçš„å¯èƒ½çŠ¶æ€ï¼š<span class="math inline">\(x_{t,1},x_{t,2},...x_{t,k}\)</span>â€‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰kä¸ªå‡è®¾çš„çŠ¶æ€ã€‚æ­¤æ—¶æˆ‘ä»¬åº”è¯¥è¿ç”¨è´å¶æ–¯å­¦æ´¾çŸ¥è¯†ï¼Œé¦–å…ˆç”±ä¿¡æ¯åŒ…å«å…³ç³»ï¼ˆä¹‹å‰çš„è§‚æµ‹ä¸æ§åˆ¶åŒ…å«åœ¨çŠ¶æ€<span class="math inline">\(x_{t-1,i}\)</span>ä¸­ï¼‰ <span class="math display">\[
\begin{equation}\label{info}
P(x_{t,i}|Z_t,U_t,x_{0,i})=P(x_{t,i}|z_t,u_t,x_{t-1,i})
\end{equation}
\]</span> â€‹ æ¥ä¸‹æ¥çš„è´å¶æ–¯æ»¤æ³¢å˜æ¢å¯ä»¥è¯´å¾ˆå¦™äº†ï¼š <span class="math display">\[
\begin{equation}
P(x_{t,i}|z_t,u_t,x_{t-1,i}) = \frac{P(x_{t,i}, z_t,u_t,x_{t-1,i})}{P(z_t,u_t,x_{t-1,i})}
\end{equation}
\]</span> â€‹ æ—¢ç„¶æ˜¯è¦ä½¿ç”¨è´å¶æ–¯ï¼Œé‚£ä¹ˆå°±è¦æƒ³åŠæ³•æŠŠè§‚æµ‹å’ŒçŠ¶æ€äº’æ¢ä½ç½®ï¼š <span class="math display">\[
\begin{equation}\label{eqn4}
\frac{P(x_{t,i}, z_t,u_t,x_{t-1,i})}{P(z_t,u_t,x_{t-1,i})}=\frac{P(z_t|x_{t,i},u_t,x_{t-1,i})P(x_{t,i},u_t,x_{t-1,i})}{P(z_t|u_t,x_{t-1,i})P(x_{t-1,i},u_t)}
=\frac{P(z_t|x_{t,i},u_t,x_{t-1,i})P(x_{t,i}|u_t,x_{t-1,i})}{P(z_t|u_t,x_{t-1,i})}
\end{equation}
\]</span> â€‹ æ³¨æ„ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸¤ä¸ªè®ºæ–­æˆç«‹ï¼š <span class="math display">\[
\begin{align}
&amp; P(z_t|x_{t,i},u_t,x_{t-1,i}) = P(z_t|x_{t,i})\label{within} \\
&amp; P(x_{t,i}|u_t,x_{t-1,i}) \text{ is a known prior}\label{prior}
\end{align}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{within}\)</span>â€‹è¯´çš„æ˜¯ï¼šè§‚æµ‹<span class="math inline">\(z_t\)</span>â€‹åªä¸å½“å‰çŠ¶æ€<span class="math inline">\(x_t\)</span>â€‹æœ‰å…³ã€‚è®ºæ–­<span class="math inline">\(\eqref{prior}\)</span>â€‹æŒ‡çš„æ˜¯ï¼Œç”±æ§åˆ¶å¼•èµ·çš„çŠ¶æ€è½¬ç§»è¯¯å·®åˆ†å¸ƒæ˜¯å·²çŸ¥çš„ï¼ˆæ¯”å¦‚æœ¬å®ç°ä¸­ï¼Œæˆ‘å‡è®¾æˆ‘çš„æ§åˆ¶å™ªå£°æ˜¯ç™½å™ªå£°ï¼Œé‚£ä¹ˆæ­¤å¤„å°±æ˜¯ä¸€ä¸ªé«˜æ–¯é¡¹ï¼‰ã€‚â€‹</p>
<p>â€‹ é‚£ä¹ˆå…¬å¼<span class="math inline">\(\eqref{eqn4}\)</span>â€‹å¯ä»¥è¢«è¿›ä¸€æ­¥åŒ–ç®€ä¸ºä¸‹å¼ï¼Œå…¶ä¸­<span class="math inline">\(\eta\)</span>æ˜¯æˆ‘ä»¬ä¸å…³å¿ƒçš„å½’ä¸€åŒ–å› å­ã€‚ <span class="math display">\[
\begin{equation}\label{eqn7}
\eta P(z_t|x_{t,i})P(x_{t,i}|u_t,x_{t-1,i})
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆç†è§£ï¼šçŠ¶æ€ç²’å­iåœ¨ç¬¬tæ—¶åˆ»çš„è§‚æµ‹<span class="math inline">\(z_t\)</span>â€‹â€‹ä¸‹ï¼Œæ‹¥æœ‰çŠ¶æ€<span class="math inline">\(x_{t,i}\)</span>â€‹çš„æ¦‚ç‡ä¸º<span class="math inline">\(\eqref{eqn7}\)</span>ï¼ŒåŒ…å«ä¸¤ä¸ªç»„ä»½ï¼š</p>
<ul>
<li>çŠ¶æ€ç²’å­ä¸è§‚æµ‹çš„å¥‘åˆç¨‹åº¦ï¼ˆç»™å®šçŠ¶æ€èƒ½ç”Ÿæˆå¯¹åº”è§‚æµ‹å—ï¼‰<span class="math inline">\(P(z_t|x_{t,i})\)</span></li>
<li>æ§åˆ¶çŠ¶æ€è½¬ç§»å™ªå£°å…ˆéªŒ<span class="math inline">\(P(x_{t,i}|u_t,x_{t-1,i})\)</span>â€‹</li>
</ul>
<p>â€‹ åœ¨2.5å°èŠ‚é‡Œï¼Œæˆ‘ç®€å•åœ°è¯´ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•å¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œå»ºæ¨¡çš„ã€‚</p>
<h3 id="åˆ†å¸ƒå˜æ¢">2.3 åˆ†å¸ƒå˜æ¢</h3>
<p>â€‹ ç²’å­æ»¤æ³¢å®é™…ä¸Šæ˜¯ç”¨ç²’å­ä¸é‡‡æ ·æ¥è¿‘ä¼¼ä»»æ„åˆ†å¸ƒï¼Œåœ¨å…¬å¼<span class="math inline">\(\eqref{eqn7}\)</span>â€‹â€‹â€‹ä¸­ï¼Œå·²ç»è¯´æ˜äº†<span class="math inline">\(P(x_{t,i}|x_{t-1,i},z_t,u_t)\)</span>â€‹çš„ç»„æˆæˆåˆ†ã€‚ç²’å­æ»¤æ³¢å®é™…ä¸Šè¿˜åšäº†ä¸€ä¸ªè¿™æ ·çš„äº‹æƒ…ï¼Œæˆ‘ä»¬çŸ¥é“æ¦‚ç‡è®ºä¸­ï¼Œæ¦‚ç‡æ˜¯éœ€è¦å½’ä¸€åŒ–çš„ï¼Œè€Œå½’ä¸€åŒ–å› å­åœ¨è¿ç»­PDFä¸­ä¸€èˆ¬éƒ½æ¶‰åŠåˆ°ç§¯åˆ†ã€‚å¾ˆå¤šæ—¶å€™ï¼Œç§¯åˆ†æ˜¯å¾ˆéš¾çš„ï¼Œä¸ä¸€å®šèƒ½ç§¯å‡ºæ¥ã€‚è¦è·å–ç›®æ ‡åˆ†å¸ƒï¼Œå°±å­˜åœ¨ä¸€å®šéš¾åº¦äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œç²’å­æ»¤æ³¢å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„å»ºè®®åˆ†å¸ƒï¼Œå»æ¨å¯¼ä¸€ä¸ªå¤æ‚çš„ç›®æ ‡åˆ†å¸ƒã€‚</p>
<p>â€‹ æˆ‘ä»¬é‡æ–°å®šä¹‰ä¸€ä¸‹é—®é¢˜ã€‚<span class="math inline">\(P(x_{t,i}|x_{t-1,i},z_t,u_t)\)</span>æ˜¯å½“å‰ç‚¹çš„å­˜åœ¨ç½®ä¿¡åº¦ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›ï¼Œç®—æ³•å¯ä»¥æ˜¯è¿­ä»£å¼ï¼ˆé©¬å°”å¯å¤«ï¼‰çš„ï¼Œä¹Ÿå°±æ˜¯è¦ä»ä¸Šä¸€ä¸ªè¿­ä»£çš„ç²’å­å¯¹åº”çš„ç½®ä¿¡åº¦ï¼Œè®¡ç®—æœ¬æ¬¡è¿­ä»£å¯¹åº”ç²’å­çš„ç½®ä¿¡åº¦ã€‚äºæ˜¯æ ¹æ®æ§åˆ¶çŠ¶æ€è½¬ç§»åˆ†å¸ƒï¼Œå¯ä»¥å¾—åˆ°å»ºè®®åˆ†å¸ƒï¼š <span class="math display">\[
P(x_{t,i}|x_{t-1,i},z_t,u_t)=P(x_{t,i}|x_{t-1,i},u_t)P(x_{t-1,i}|x_{t-2,i},z_{t-1},u_{t-1})
\]</span> â€‹ å¯ä»¥å‘ç°ï¼Œç­‰å·å³è¾¹ç¬¬äºŒé¡¹å°±æ˜¯ä¸Šä¸€æ¬¡è¿­ä»£å¯¹åº”ç²’å­çš„åˆ†å¸ƒã€‚æ ¹æ®çŠ¶æ€è½¬ç§»è¿›è¡Œäº†åˆ†å¸ƒå˜æ¢ï¼Œå¾—åˆ°äº†æ–°çš„å»ºè®®åˆ†å¸ƒã€‚<strong><u>ä½†æ˜¯æˆ‘ä»¬å¹¶éç›´æ¥æ¥å—æ–°çš„å»ºè®®åˆ†å¸ƒï¼Œ</u></strong>ä¸ºä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>çŠ¶æ€çš„è½¬ç§»å¸¦æ¥æ–°çš„ä¿¡æ¯ã€‚é€šä¿—åœ°è¯´ï¼Œåˆ°ä¸€ä¸ªæ–°çš„åœ°ç‚¹ï¼Œå°±å¯ä»¥ä»ä¸åŒçš„è§’åº¦è§‚å¯Ÿç¯å¢ƒã€‚</p>
</blockquote>
<p>â€‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°çš„è§‚æµ‹ï¼Œæ¥è¡¡é‡ï¼Œè¿™äº›æ–°çš„ç‚¹æ˜¯å¦é€‚åˆï¼ŸåŸæ¥çš„ç²’å­ï¼Œæ˜¯åˆ†å¸ƒçš„é‡‡æ ·ã€‚é‚£ä¹ˆï¼Œç¬¦åˆæ–°çš„è§‚æµ‹çš„ç²’å­ï¼Œè‡ªç„¶å¯ä»¥ç»™ä¸€ä¸ªå¤§æƒé‡ï¼Œè€Œä¸ç¬¦åˆæ–°è§‚æµ‹çš„ç²’å­ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸é‚£ä¹ˆé‡è§†ã€‚è¿™å°±æ¶‰åŠåˆ°å¯¹ç²’å­è¿›è¡ŒåŠ æƒä»¥åŠé‡é‡‡æ ·ã€‚</p>
<h3 id="åŠ æƒ-é‡é‡‡æ ·">2.4 åŠ æƒ é‡é‡‡æ ·</h3>
<p>â€‹ æˆ‘ä»¬å¸Œæœ›ç»™ç²’å­imposeä¸€ä¸ªæƒé‡ã€‚ä½†æ˜¯ç²’å­å·²ç»æ˜¯åˆ†å¸ƒçš„ä¸€ä¸ªä¾‹åŒ–äº†ï¼ˆé‡‡æ ·ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ¯ä¸ªç²’å­ç»´æŠ¤ä¸€ä¸ªæƒé‡ï¼Œæ¯æ¬¡æ›´æ–°æƒé‡</li>
<li>æ¯æ¬¡é‡æ–°ç”Ÿæˆä¸€ç¾¤ç²’å­ï¼Œæ ¹æ®æƒé‡è¿›è¡Œç”Ÿæˆ</li>
</ul>
<p>â€‹ ç¬¬ä¸€ç§æ€æƒ³å¾ˆå¥½ç†è§£ã€‚æ¯”å¦‚åœ¨localizationé—®é¢˜ä¸­ï¼Œæˆ‘åœ¨ä½å§¿ç©ºé—´ä¸­æœ‰å¾ˆå¤šä½å§¿çš„ä¼°è®¡ç²’å­ï¼Œé‚£ä¹ˆæœ€åç²’å­æ±‚åŠ æƒå¹³å‡åº”è¯¥å°±æ˜¯ç»“æœã€‚</p>
<p>â€‹ è€Œç¬¬äºŒç§æ€æƒ³ï¼Œåˆ™æ˜¯æŠŠæƒé‡éšå«åœ¨ç²’å­æ•°é‡ä¸­ï¼Œè¿™ç§æ€æƒ³æ˜¯çœŸæ­£ç¬¦åˆâ€œç²’å­æ˜¯å¯¹åº”åˆ†å¸ƒçš„é‡‡æ ·â€çš„ã€‚æ˜¾ç„¶ï¼Œåœ¨Nç»´ç©ºé—´ä¸­æŸä¸ªåŒºåŸŸç²’å­æ•°å¤šï¼Œè‡ªç„¶æ­¤å¤„åˆ†å¸ƒå°±åº”è¯¥æ¯”è¾ƒå¤§ã€‚</p>
<p>â€‹ ç›´æ¥è¿›è¡Œéšæœºçš„Metropolis-Hastingé‡‡æ ·ï¼Œéœ€è¦çš„æ—¶é—´å¼€é”€æ¯”è¾ƒå¤§ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ ¹æ®è¿™ç¯‡æ–‡ç« [2]ï¼Œé‡Œé¢è¯´ï¼š</p>
<blockquote>
<p>ç®€å•éšæœºé‡é‡‡æ ·ï¼šï¼ˆ1ï¼‰ç”ŸæˆNä¸ªå‡åŒ€åˆ†å¸ƒéšæœºæ•°ï¼ˆ2ï¼‰éšæœºæ•°æ•°åˆ—æ’åºï¼ˆ3ï¼‰æ ¹æ®éšæœºæ•°æ•°åˆ—ä»¥åŠç²’å­çš„æƒé‡è¿›è¡Œé‡é‡‡æ ·ã€‚</p>
</blockquote>
<p>â€‹ è¿™ä¸ªæ­¥éª¤æ˜¯ï¼šè®¾ç‚¹içš„æƒé‡æ˜¯<span class="math inline">\(w_i\)</span>ï¼Œç”Ÿæˆçš„éšæœºæ•°æ•°åˆ—æ˜¯<span class="math inline">\(y_i\)</span>ã€‚åˆ™å¯¹äºæ‰€æœ‰çš„<span class="math inline">\(y_i\)</span>ï¼Œå¦‚æœ<span class="math inline">\(y_i\)</span>è½åœ¨<span class="math inline">\(\left(\sum_{k=1}^iw_k,\sum_{k=1}^{i+1}w_k\right]\)</span>ä¸­ï¼Œé‚£ä¹ˆå¯¹åº”ç²’å­çš„é‡‡æ ·æ•°+1ã€‚å¯çŸ¥è¿™æ ·çš„é‡‡æ ·æ–¹æ³•ï¼Œå¤æ‚åº¦æ˜¯<span class="math inline">\(O(NlogN)\)</span>ï¼Œæ¯•ç«Ÿéœ€è¦æ’åºï¼Œä½†æ˜¯è¿™æ˜¯å®Œå…¨éšæœºçš„ã€‚å®Œå…¨éšæœºçš„ä¸¤ä¸ªåå¤„å°±ä½“ç°å‡ºæ¥äº†ï¼š</p>
<ul>
<li>ä¸èƒ½ä¿è¯æ•°æ®é›†çš„éå†æ€§ï¼Œæœ‰äº›æ•°æ®å¯èƒ½æ ¹æœ¬æ²¡æœ‰åŠæ³•è¢«é‡‡æ ·åˆ°</li>
<li>è®¡ç®—å¤æ‚åº¦å¤§ï¼Œå¤§å‹é‡‡æ ·æ—¶é—´æ¶ˆè€—å¤§ã€‚</li>
</ul>
<p>â€‹ æ›´å¥½çš„ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œè¯¦è§ã€Šæ¦‚ç‡æœºå™¨äººã€‹ç¬¬å››ç« ã€‚æˆ‘çš„å®ç°ä¸­ï¼Œä½¿ç”¨çš„å°±æ˜¯ã€Šæ¦‚ç‡æœºå™¨äººã€‹ä¸­çš„â€œä½æ–¹å·®é‡‡æ ·â€ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼Œå¹¶ä¸”æ˜¯éå†æ€§çš„ã€‚</p>
<p>â€‹ é‡é‡‡æ ·çš„ç›®çš„å°±æ˜¯ä½¿å¾—å»ºè®®åˆ†å¸ƒè½¬åŒ–ä¸ºç›®æ ‡åˆ†å¸ƒã€‚å¯¹äºç²’å­æ»¤æ³¢ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·ç†è§£é—®é¢˜ï¼šæ»¤æ³¢çš„å®Œæ•´è¿­ä»£è¿‡ç¨‹ï¼ˆä»0åˆ°æ”¶æ•›æœ‰tä¸ªè¿­ä»£ï¼‰ï¼Œé‚£ä¹ˆå¸Œæœ›æœ€å¤§åŒ–ï¼š <span class="math display">\[
\begin{equation}\label{new_obj}
P(x_{0:t,i}|z_{1:t},u_{1:t})
\end{equation}
\]</span> â€‹ ä»¥localizationä»»åŠ¡æ¥è¯´ã€‚å¦‚æœä¸€ä¸ªçŠ¶æ€æ˜¯æ¯”è¾ƒæ­£ç¡®çš„ï¼Œé‚£ä¹ˆä¸ç®¡å¦‚ä½•è¿­ä»£ï¼Œå…¶ç½®ä¿¡åº¦åœ¨ä¸åŒçš„è¿­ä»£ä¸­éƒ½åº”è¯¥æ¯”è¾ƒå¤§ã€‚é‚£ä¹ˆæ ¹æ®å…¬å¼<span class="math inline">\(\eqref{eqn7}\)</span>â€‹â€‹ï¼Œå¯ä»¥å±•å¼€ä¸ºç±»ä¼¼çš„ç»“æ„ï¼ˆè¿™æ˜¯ç›®æ ‡åˆ†å¸ƒï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{eqn11}
\eta P(z_t|x_{0:t,i}, z_{1:t},u_{1:t})P(x_{0:t,i}|u_t,z_{1:t-1,i})
\end{equation}
\]</span> â€‹ è¿›ä¸€æ­¥æ ¹æ®è´å¶æ–¯å’Œé©¬å°”å¯å¤«æ€§ï¼Œå¯ä»¥ä½œè¿›ä¸€æ­¥å±•å¼€ï¼Œå¯å¾—åˆ°å»ºè®®åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒä¹‹æ¯”ä¸<span class="math inline">\(P(z_t|x_{t_i})\)</span>â€‹æˆæ­£æ¯”ã€‚</p>
<h3 id="ç®€å•å»ºæ¨¡">2.5 ç®€å•å»ºæ¨¡</h3>
<p>â€‹ æ­¤éƒ¨åˆ†ï¼Œæˆ‘ç®€è¦ä»‹ç»ä¸€ä¸‹åœ¨åŸºäºVolume2D Shaderçš„æ¿€å…‰é›·è¾¾æ¨¡æ‹Ÿå™¨ä¸­ï¼Œå¦‚ä½•å»ºæ¨¡ä¸€äº›åˆ†å¸ƒã€‚æœ€ä¸ºé‡è¦çš„é¦–å…ˆå°±æ˜¯ä¼¼ç„¶<span class="math inline">\(P(z_t|x_t)\)</span>ï¼Œä¹Ÿå³ï¼Œç»™å®šçŠ¶æ€ä¸‹ï¼Œäº§ç”Ÿè§‚æµ‹<span class="math inline">\(z_t\)</span>çš„å¯èƒ½æ€§ã€‚æ­¤å¤„æˆ‘å°†å…¶å»ºæ¨¡ä¸ºï¼š</p>
<ul>
<li>ç»™å®š<span class="math inline">\(x_t\)</span>ï¼ˆçŠ¶æ€ï¼Œä¹Ÿå³ç²’å­å¯¹åº”çš„ä½å§¿ï¼‰ï¼Œæˆ‘åœ¨æ­¤å¤„æ¨¡æ‹Ÿä¸€ä¸ªæ¿€å…‰ç‚¹äº‘ï¼ˆå› ä¸ºå·²çŸ¥åœ°å›¾ï¼‰ï¼Œä¸å®é™…çš„è§‚æµ‹<span class="math inline">\(z_t\)</span>è¿›è¡Œæ¯”è¾ƒã€‚ç›¸ä¼¼åˆ™å¯¹åº”çš„æ¦‚ç‡å¤§ï¼Œä¸ç›¸ä¼¼åˆ™æ¦‚ç‡å°ã€‚</li>
<li>é‚£ä¹ˆç›¸ä¼¼æ€§çš„æ¯”è¾ƒï¼Œåˆ™æ˜¯åŸºäºæ¨¡æ‹Ÿæ¿€å…‰ç‚¹äº‘å¯¹åº”è§’åº¦ä¸Šçš„rangeå·®å€¼ã€‚å…¶å®åªè¦ç†è§£ä¼¼ç„¶åœ¨æ­¤å¤„çš„ä½œç”¨ï¼Œè¿™ä¸ªæ¨¡å‹å¾ˆå¥½å»ºç«‹ã€‚</li>
</ul>
<p>â€‹ å¦ä¸€æ–¹é¢ï¼Œæ˜¯çŠ¶æ€è½¬ç§»æ¨¡å‹ã€‚æ­¤å¤„ç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªæ–¹å·®ä¸ç§»åŠ¨å¤§å°ç›¸å…³çš„é«˜æ–¯å™ªå£°ã€‚</p>
<hr>
<h2 id="iii.-ç»“æœ">III. ç»“æœ</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/08/07/Particle-Filter-Simulation/img1.png"></th>
<th style="text-align: center;"><img src="/2021/08/07/Particle-Filter-Simulation/img3.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">é•¿èµ°å»Šé—®é¢˜ åˆå§‹åŒ–</td>
<td style="text-align: center;">é•¿èµ°å»Šé—®é¢˜ ç¬¬ä¸‰æ¬¡è¿­ä»£ï¼ˆç§»åŠ¨3æ¬¡ï¼‰</td>
</tr>
<tr class="even">
<td style="text-align: center;"><img src="/2021/08/07/Particle-Filter-Simulation/img9.png"></td>
<td style="text-align: center;"><img src="/2021/08/07/Particle-Filter-Simulation/img16.png"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">é•¿èµ°å»Šé—®é¢˜ ç¬¬ä¹æ¬¡è¿­ä»£ï¼ˆç§»åŠ¨9æ¬¡ï¼‰</td>
<td style="text-align: center;">é•¿èµ°å»Šé—®é¢˜ ç¬¬åå…­æ¬¡è¿­ä»£ï¼ˆç§»åŠ¨16æ¬¡ï¼‰</td>
</tr>
</tbody>
</table>
<p>â€‹ å¯¹äºä¸å®Œå…¨çš„é•¿èµ°å»Šé—®é¢˜ï¼ˆè™½ç„¶ç›¸ä¼¼ä½†æ˜¯è¿˜æœ‰ä¸€å®šåŒºåˆ«çš„ç¯å¢ƒï¼‰ï¼Œç²’å­æ»¤æ³¢è¿˜æ˜¯å¯ä»¥åº”å¯¹çš„ã€‚ï¼ˆ2000ä¸ªç²’å­ï¼‰ã€‚</p>
<video src="cv_output.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 1. é•¿èµ°å»Šé—®é¢˜è¿­ä»£è¿‡ç¨‹ï¼ˆæ…¢é€Ÿï¼‰
</center>
<video src="cv_output2.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 2. éšæœºåœ°å›¾å®šä½é—®é¢˜ï¼ˆæ…¢é€Ÿï¼‰
</center>
<hr>
<h3 id="reference">Reference</h3>
<p>[1] Probability Robotics (Sebastian Thrun, et al)</p>
<p>[2] ç²’å­æ»¤æ³¢å¸¸ç”¨é‡é‡‡æ ·ç®—æ³•åˆ†ææ¯”è¾ƒï¼ŒèŒƒæ¾æ¹ƒç­‰</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>SLAM</tag>
        <tag>æ¦‚ç‡è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>Redmi G 2021é”é¾™ç‰ˆåŒç³»ç»Ÿç¯å¢ƒå·¥ç¨‹è®°å½•</title>
    <url>/2022/02/17/Redmi-G-2021%E9%94%90%E9%BE%99%E7%89%88%E5%8F%8C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%B7%A5%E7%A8%8B%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h1 id="amd-yes">AMD Yes!</h1>
<hr>
<p>æ–°ç”µè„‘ Redmi G 2021 Ryzen7 ç‰ˆè£…<strong><u>åŒç³»ç»Ÿ</u></strong> ï¼ˆwin11 + ubuntu 18.04 LTSï¼‰è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œä»¥åå¦‚æœè¦æ¢è®¾å¤‡å¤§æ¦‚ç‡è¿˜å¾—å†æ¥ä¸€éï¼Œæœ¬ç¯‡æƒå½“è®°å½•ã€‚ä¸è¿‡è¯´å®è¯ï¼Œä»æœ¬ç¯‡å­—æ•°æ¥çœ‹ï¼Œåº”è¯¥ç®—å¾—ä¸Šä¸€ç¯‡æ­£è§„postè€Œä¸æ˜¯snippetäº†ã€‚è¿™ç¡®å®ä¹Ÿä¸snippetæ¿å—çš„è®¾ç½®ç†å¿µç›¸æ‚–ï¼Œä¸è¿‡å¯èƒ½æˆ‘å°±æ˜¯é‚£ä¹ˆå•°å—¦å§ã€‚PSï¼šæœ¬æ–‡ä¸AMD yesæ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="flannæ‰¾ä¸åˆ°">FLANNæ‰¾ä¸åˆ°</h2>
<p>â€‹ ä½¿ç”¨<code>flann</code>åº“æ—¶ï¼Œåœ¨<code>CMakeLists</code>ä¸­æ˜¯éœ€è¦<code>find_package</code>æ“ä½œçš„ï¼Œä½†<code>flann</code>å¦‚ä½•æ‰¾ï¼Ÿ</p>
<p>â€‹ é¦–å…ˆå¦‚æœæˆ‘ä»¬ä¸€æ³¢ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone &lt;flannä»“åº“åœ°å€ï¼Œè¿™é‡Œä¸å†™ï¼Œéšä¾¿æ‰¾éƒ½èƒ½æ‰¾åˆ°&gt;</span><br><span class="line">cd flann/; mkdir build; cd build/</span><br><span class="line">cmake ..; make -j</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>â€‹ å®‰è£…<code>flann</code>åº“ï¼Œè™½ç„¶<code>flann</code>ä¼šè¢«æˆåŠŸå®‰è£…åˆ°<code>/usr/local/include</code>ä¸‹ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šå®‰è£…è·¯å¾„å°±ä¼šåˆ°è¿™ä¸ªåœ°æ–¹ï¼‰ï¼Œä½†å…¶<code>.cmake</code>é…ç½®æ–‡ä»¶å¯¹CMakeè€Œè¨€æ˜¯ä¸å¯è§çš„ï¼Œé¦–å…ˆï¼ˆ1ï¼‰<code>make install</code>æ²¡æœ‰è‡ªå·±å¤åˆ¶<code>.cmake</code>æ–‡ä»¶ï¼Œå¹¶ä¸”ï¼ˆ2ï¼‰<code>locate</code>ä¹Ÿæ˜¯æ²¡èƒ½æ‰¾åˆ°<code>.cmake</code>æ–‡ä»¶ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼‰</p>
<p>â€‹ æœ€åçš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª:</p>
<ul>
<li>å¯ä»¥åœ¨<code>flann</code>åº“ä¸‹çš„<code>cmake</code>æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°<code>FindFlann.cmake</code>ï¼Œå°†å…¶å¤åˆ¶åˆ°<code>cmake</code>å¯¹åº”çš„é…ç½®æ–‡ä»¶å¤¹ä¸‹:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/share/cmake-3.10/Modules/</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™ä¸ªåšæ³•å¾ˆé­”æ³•ï¼Œå¹¶ä¸”è¦æ‰‹åŠ¨æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™é‚£ç§ï¼‰ï¼Œä½†ä¸€åŠ³æ°¸é€¸ã€‚</p>
<ul>
<li>å¦‚æœæœ‰rosï¼ˆå¯¹ï¼Œæˆ‘æœ‰ï¼‰ï¼Œé‚£ä¹ˆpclåº“ä¸­è‡ªå¸¦<code>flann</code> åªéœ€è¦æŒ‡å®špclå¯¼å…¥<code>flann</code>å³å¯ï¼ˆCMakeé…ç½®ï¼‰</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(PCL REQUIRED COMPONENTS kdtree)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="lz4å†²çª">LZ4å†²çª</h2>
<p>â€‹ æœæ°”ã€‚lz4åœ¨ROS melodicä¸­æœ‰ä¸€ä»½å®ç°ï¼ˆlz4.hï¼‰ç›¸å…³ï¼Œåœ¨<code>pcl</code>åº“ä¸­åˆæœ‰ä¸€ä»½å®ç°ï¼ˆå­˜åœ¨<code>/usr/include/flann</code>ä¸‹ï¼‰ã€‚é¦–å…ˆå¦‚æœCMakeè¦èƒ½æ‰¾åˆ° lz4ï¼Œå°±éœ€è¦ä½¿ç”¨<code>pkg-config</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(PkgConfig REQUIRED)</span><br><span class="line">pkg_check_modules(LZ4 REQUIRED liblz4)</span><br></pre></td></tr></table></figure>
<p>â€‹ å¦‚æœæ²¡æœ‰<code>pkg-config</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>apt install</code>è¿›è¡Œå®‰è£…ã€‚</p>
<p>â€‹ å‘ç”Ÿå†²çªç¡®å®å¯ä»¥ä½¿ç”¨<a href="https://github.com/ethz-asl/lidar_align/issues/16#">æŸä¸ªGithub issue</a>ä¸­æåˆ°çš„æ–¹æ¡ˆè§£å†³ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ¶‰åŠåˆ°ä¿®æ”¹<code>/usr/include</code>ä¸‹çš„å¤´æ–‡ä»¶ï¼Œéå¸¸ä¸ä¼˜é›…ã€‚ä¸ªäººåœ¨å¯’å‡å‰é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå½“æ—¶è²Œä¼¼è§£å†³äº†ï¼Œä½†æ²¡æœ‰è®°å½•ä¸‹æ¥ï¼Œç°åœ¨ä¹Ÿå›å¿†ä¸èµ·æ¥ï¼Œåªèƒ½ç­‰å›åˆ°å­¦æ ¡åæŸ¥çœ‹å­¦æ ¡ç”µè„‘äº†ã€‚</p>
<hr>
<h2 id="nvidia">Nvidia!!!</h2>
<p>â€‹ è‹±ä¼Ÿè¾¾çœŸæŠ˜ç£¨åˆ°æˆ‘äº†ã€‚ä¹‹å‰æˆ‘åœ¨<a href="https://enigmatisms.github.io/2021/11/21/Nvidia-%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E5%B7%A5%E7%A8%8B/">[Nvidia ç®€å•ç¯å¢ƒå·¥ç¨‹]</a>ä¸­æåˆ°å¦‚ä½•å®‰è£…æ˜¾å¡é©±åŠ¨ï¼Œä½†äº‹å®è¯æ˜è¿™ä»½æ•™ç¨‹åšå®¢éå¸¸ä¸å®Œå…¨ã€‚</p>
<ul>
<li>æˆ‘åœ¨å®éªŒå®¤å¦ä¸€å°RTX 3060ä¸Šå®‰è£…æ—¶é‡åˆ°äº†æ— æ³•å®‰è£…CUDA 11.3çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯GPUä¸å¯¹åº”çš„460+ driverä¸é€‚é…ï¼ˆæˆ‘å¿˜äº†æ˜¯ä¸æ˜¯460+äº†ï¼Œç”±äºCUDA 11.4å¯¹åº”470.95ï¼Œä¸ªäººçŒœæµ‹CUDA 11.3æ²¡åˆ°470ï¼Œæˆ‘ä¹Ÿä¸æƒ³èŠ±æ—¶é—´å»è€ƒè¯ï¼‰
<ul>
<li>ä¸èƒ½å®‰è£…11.3ç¡®å®æœ‰äº›ä¸æ–¹ä¾¿ï¼Œè‹±ä¼Ÿè¾¾çš„apexï¼ˆæŸä¸ªauto mixed precisionåº“ï¼‰éœ€è¦CUDAä¸pytorchç‰ˆæœ¬å¯¹ä¸Š... ä½†æˆ‘11.4 + torch(cu113)çœŸå°±ä¸è¡Œï¼Œæ‰€ä»¥ä¸€ç›´æƒ³å¸äº†11.4è£…11.3 ä½†éƒ½å¤±è´¥ï¼Œè¡¨ç°åœ¨ <strong><u>å®‰è£…11.3ä¹‹å</u></strong> ç”µè„‘é‡å¯ä¼šé»‘å±ï¼Œå¡åœ¨ç™»å½•ç•Œé¢ï¼Œæ— è®ºä½¿ç”¨recoveryè¿˜æ˜¯ç›´æ¥å¯åŠ¨éƒ½ä¸è¡Œï¼Œå¹¶ä¸”åœ¨recoveryçš„rootæƒé™å‘½ä»¤è¡Œä¸­ä½¿ç”¨<code>nvidia-smi</code>å¯èƒ½å¡çˆ†ç”µè„‘ã€‚</li>
</ul></li>
<li>RTX 3060ï¼ˆfor laptop computerï¼‰ç”šè‡³éƒ½ä¸èƒ½å®‰è£…CUDA 11.4ï¼Œè¡¨ç°ç±»ä¼¼ä¹Ÿæ˜¯é»‘å±ï¼Œä½†æ˜¯<code>nvidia-smi</code>åœ¨recovery root consoleä¸­æ­£å¸¸
<ul>
<li>ä½¿ç”¨åšå®¢ä¸­çš„<code>sudo apt-get --purge remove nvidia-*</code>å¹¶ä¸èƒ½å®Œå…¨åˆ é™¤è‹±ä¼Ÿè¾¾é©±åŠ¨ï¼ˆä¹‹å‰éƒ½æ˜¯å¯ä»¥çš„ï¼‰ã€‚æ‰§è¡Œå‘½ä»¤å¯¼è‡´<code>0 package to add\delete\update</code>ï¼Œç­‰äºæ²¡åŠ¨ï¼ŒåŸå› ä¸æ˜</li>
<li>æ— è®ºæ€ä¹ˆåˆ ï¼Œ<code>nvidia-smi</code>éƒ½é˜´é­‚ä¸æ•£ï¼Œä½†å¦‚æœè¿™æ ·å¸è½½ç„¶åå®‰è£…åˆ«çš„ç‰ˆæœ¬CUDAï¼Œåˆä¸ä¼šæç¤ºè¯´ç”µè„‘ä¸­å·²ç»æœ‰ä¸€ä¸ªç°æœ‰çš„è‹±ä¼Ÿè¾¾é©±åŠ¨è€Œå†²çªäº†ã€‚</li>
</ul></li>
</ul>
<p>â€‹ æœ€åä¸€ç›´åˆ ä¸æ‰ï¼Œå…¶ä»–æŒ‡ä»¤éƒ½æ— æ•ˆäº†ï¼Œåªèƒ½é‡è£…ç³»ç»Ÿï¼Œä¸€å¤©åŠçš„å·¥ä½œç™½å¹²ã€‚</p>
<p>â€‹ è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼š</p>
<div class="note danger"><p>æ ¹æœ¬ä¸åº”è¯¥ç”¨<code>sudo apt-get --purge remove</code>ä»¥åŠ<code>sudo apt autoremove</code>è¿™ä¹ˆæš´åŠ›è€Œä¸”å±é™©çš„æ–¹å¼æ¥å¸è½½æ˜¾å¡é©±åŠ¨ã€‚</p>
</div>
<p>â€‹ è‹±ä¼Ÿè¾¾å·²ç»å†™å¥½äº†:</p>
<ul>
<li>ä½¿ç”¨<code>nvdia-uninstall</code>å‘½ä»¤å¯ä»¥ç›´æ¥å¹²å‡€å¸è½½ï¼ˆä¹‹å‰æˆ‘ä¸çŸ¥é“è¿™ä¸ªï¼‰</li>
<li>ä½¿ç”¨<code>/usr/local/cuda-x</code>ä¸‹çš„è„šæœ¬<code>cuda-uninstaller.sh</code>å¯ä»¥æ–¹ä¾¿åœ°å¸è½½CUDA</li>
</ul>
<p>â€‹ è¿™ä¸¤ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥å‡ ä¹æ²¡æœ‰ç ´åæ€§ï¼Œåœ¨ç»å†äº†11.3\11.4çš„å¤±è´¥ä¹‹åï¼Œ11.4ä¸­æˆ‘ç›´æ¥ç”¨ä¸Šè¿°å‘½ä»¤å¸è½½å¹¶é‡è£…11.6ï¼Œå¹²å‡€åˆå«ç”Ÿã€‚</p>
<hr>
<h2 id="opencvæ–°å‘">OpenCVæ–°å‘</h2>
<p>â€‹ OpenCVè¿˜æ˜¯æˆ‘çš„å¿…è£…åº“ã€‚ä½†å®‰è£…opencvå¯¹æˆ‘æ¥è¯´å·²ç»æ˜¯ä¸€ä»¶å¾ˆä¹…æ²¡åšè¿‡çš„äº‹æƒ…äº†ï¼Œéš¾å…å¿˜æ‰å¾ˆå¤šç»†èŠ‚ã€‚</p>
<ul>
<li><p>é¦–å…ˆå‡†å¤‡å¥½<code>opencv_contrib</code>ï¼Œé‡Œé¢è¿˜æ˜¯æœ‰å¾ˆå¤šå€¼å¾—å®‰è£…çš„æ‹“å±•å†…å®¹çš„</p></li>
<li><p><strong><u>å‡†å¤‡å¥½opencvéœ€è¦å®‰è£…çš„ä¸€äº›åº“</u></strong>ï¼šè¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒ <a href="https://gist.github.com/raulqf/f42c718a658cddc16f9df07ecc627be7">[raulqf/Install_OpenCV4_CUDA11_CUDNN8.md]</a> è¿™ä¸ªGistã€‚æ²¡æœ‰è¿™äº›åº“æ˜¯è¿‡ä¸äº†cmakeçš„</p></li>
<li><p><code>libEGL.so</code>æ¶ˆå¤±é—®é¢˜ï¼š</p></li>
</ul>
<blockquote>
<p>The imported target "QT5::Gui" references the file "/usr/lib/x86_64-linux-gnu/libEGL.so" but this file does not exist.</p>
</blockquote>
<p>â€‹ å¾ˆå¥‡æ€ªçš„ä¸€ä¸ªé—®é¢˜ï¼Œ<code>libEGL.so</code>æ˜¯å¯ä»¥è¢«locateåˆ°çš„ï¼Œåœ¨ubuntuçš„æ–‡ä»¶propertyä¸­å¯ä»¥çœ‹åˆ°ï¼ˆç›´æ¥ç”¨GUIæŸ¥çœ‹propertyï¼‰ï¼Œ<code>libEGL.so</code>è¦ä¹ˆæ˜¯<strong><u>ä¸å­˜åœ¨</u></strong>ï¼Œè¦ä¹ˆæŒ‡å‘äº†ä¸€ä¸ªä¸å­˜åœ¨çš„<code>so.x</code>æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶ä¸æ˜¯çœŸæ­£çš„é™æ€åº“ï¼Œåªæ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼‰ï¼Œè¿™é‡Œæé†’ä¸€ä¸‹è®¾ç½®è½¯é“¾æ¥çš„æ–¹å¼ï¼Œè¿™ä¹ˆä¹…äº†éƒ½å¿˜äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ln -s &lt;source name&gt; &lt;target name&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤å¤„æˆ‘ä»¬åªéœ€è¦é¦–å…ˆ<code>locate libEGL.so</code>ï¼Œå‘ç°æœ‰å¾ˆå¤š<code>.so.1.0</code>ä»¥åŠ<code>.so.1.0.0</code>ä¹‹ç±»çš„æ–‡ä»¶ï¼Œæˆ–è€…ä¸€äº›ç±»ä¼¼çš„ï¼Œä¸åœ¨<code>/usr/lib/x86_64-linux-gnu/</code>ä¸‹çš„æ–‡ä»¶ï¼Œéƒ½æ˜¯å¯ä»¥æ‹¿æ¥ä½¿ç”¨çš„ã€‚åˆ›å»ºå¥½å¯¹åº”çš„è½¯é“¾æ¥ï¼Œå‘½åä¸º<code>libEGL.so</code>ï¼ˆä»¥åŠ<code>libGL.so</code>å› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¹Ÿå­˜åœ¨ç›¸åŒé—®é¢˜ï¼‰æ”¾åœ¨ä¸Šè¿°ç›®å½•ä¸‹å³å¯ã€‚</p>
<ul>
<li>oracle-java ç¼–è¯‘opencv javaç‰ˆï¼šæˆ‘ç”¨ä¸åˆ°ï¼Œä½†æ˜¯å®ƒç¡¬è¦æˆ‘è¿™æ ·å¹²ã€‚åªèƒ½ä¸‹è½½openjdkã€‚<code>openjdk-default</code>é»˜è®¤ç‰ˆæœ¬ï¼ˆå½“å‰ï¼‰11.0.13ï¼Œä½†æ˜¯opencvå‚»ä¹ä¹åœ°è¦æ±‚æˆ‘å®‰è£…11.0.4ï¼Œå¹¶ä¸”è¦æ±‚æˆ‘å®‰è£…<code>oracle-java11-installer-local</code>
<ul>
<li>ä½†å¾ˆä¸å¹¸ï¼Œopenjdkä¸oracle-javaç‰ˆæœ¬å¯¹ä¸ä¸Šï¼Œ<code>oracle-java11-installer-local</code>ä¸èƒ½æ­£å¸¸å®‰è£…ï¼Œç³»ç»Ÿéœ€è¦æˆ‘æŠŠå¯¹åº”11.0.4 <code>oracle-java11-installer-local</code>çš„debåŒ…æ”¾åˆ°<code>/var/cache/oracle-java11-installer-local</code>ä¸‹</li>
<li>æˆ‘ç…§åšçš„ï¼Œæ— è¯¯ï¼Œä½†æ˜¯ç³»ç»Ÿå°±æ˜¯ä¸è®¤è´¦ï¼Œä¸€ç›´è®¤ä¸ºæˆ‘æ²¡æœ‰è¿™ä¹ˆåšï¼Œå”å”æˆ‘å•Šï¼ŒçœŸçš„è¦ç”Ÿæ°”äº†</li>
<li>ä¸€æ€’ä¹‹ä¸‹æƒ³ç»•å¼€<code>oracle-java11-installer-local</code>çš„å®‰è£…ï¼Œä½†æ˜¯ç³»ç»Ÿä¸å…è®¸ï¼Œå‘Šè¯‰æˆ‘ï¼š</li>
</ul></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 not fully installed or removed.</span><br><span class="line">After this operation, 0 B of additional disk space will be used.</span><br><span class="line">E: Internal Error, No file name for oracle-java11-installer-local:amd64</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™ä¸ªé—®é¢˜æ˜¯ï¼šè£…åˆ°ä¸€åŠç”±äºä¸€äº›é—®é¢˜è€Œæ²¡è£…å¥½çš„åŒ…ï¼Œä½¿å¾—æ–°çš„dpkgè¯·æ±‚æ²¡åŠæ³•å®Œæˆã€‚é‚£ä¹ˆå¦‚ä½•å–æ¶ˆè¿™æ ·çš„ <strong><u> not fully installed or removed</u></strong> çš„å®‰è£…è¿›ç¨‹å‘¢ï¼Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo dpkg --force-depends --purge oracle-java11-installer-local</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯¹äºæœ¬é—®é¢˜çš„ <code>oracle-java11-installer-local</code>ï¼Œè¿™æ ·å³å¯ã€‚</p>
<hr>
<h2 id="rtw89-8852ae">RTW89-8852AE</h2>
<p>â€‹ é¢ã€‚åˆšä¹°å›ç”µè„‘æ¥çš„ç¬¬ä¸‰å¤©ï¼ˆå¼€å§‹è£…ubuntuï¼‰ï¼Œè£…å®Œå‘ç°ä¸èƒ½è”ç½‘ï¼Œååˆ†æ¶å¿ƒï¼ˆæ˜¾ç¤º <strong><u>No WiFi Adapter Found</u></strong>ï¼‰ã€‚ç”±äºwin11å¯ä»¥æ­£å¸¸è”ç½‘ï¼Œç½‘å¡ç¡¬ä»¶ç«¯è‚¯å®šæ²¡æœ‰é—®é¢˜ï¼Œæ¨æµ‹æ²¡æœ‰ç½‘å¡é©±åŠ¨ï¼Œå†ä¸€æŸ¥è§£å†³æ–¹æ¡ˆåæˆåŠŸè§£å†³... ä¸è¿‡åœ¨è¿™é‡Œï¼Œæˆ‘å¹¶ä¸èƒ½çœç•¥ <strong><u>â€œä¸€æŸ¥â€</u></strong> çš„è¿‡ç¨‹ï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤æˆ‘æ˜¯ä¸æ¸…æ¥šç”¨æ³•çš„:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lspci			# ç”¨äºæ˜¾ç¤ºå½“å‰ä¸»æœºçš„æ‰€æœ‰PCIæ€»çº¿ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>â€‹ æ‰§è¡Œç»“æŸåå‡ºäº†ä¸€å¤§å †ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰ç”¨çš„å°±åªæœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">02:00.0 Network controller: Realtek Semiconductor Co., Ltd. Device 8852</span><br><span class="line">03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 15)</span><br></pre></td></tr></table></figure>
<p>â€‹ Ethernet controllerä¸€èˆ¬éƒ½æ˜¯æœ‰çº¿ç½‘ç»œç½‘å¡ã€‚å®é™…ä¸Šæœ‰ç”¨çš„å°±æ˜¯è¿™ä¸€æ¡å‘½ä»¤ï¼Œä½†ææ¸…æ¥š <strong><u>å°±æ˜¯è¿™ä¸€æ¡æœ‰ç”¨</u></strong> çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆæ›²æŠ˜çš„ã€‚å…¶ä¸­è¿˜é‡åˆ°è¿™ä¹ˆä¸€äº›æŒ‡ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo lshw -class network</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*-network                 </span><br><span class="line">     description: Wireless interface</span><br><span class="line">     product: Realtek Semiconductor Co., Ltd.</span><br><span class="line">     vendor: Realtek Semiconductor Co., Ltd.</span><br><span class="line">     physical id: 0</span><br><span class="line">     bus info: pci@0000:02:00.0</span><br><span class="line">     logical name: wlp2s0</span><br><span class="line">     version: 00</span><br><span class="line">     serial: &lt;xxxxxxxxxxxxxxxxxxxx&gt;</span><br><span class="line">     width: 64 bits</span><br><span class="line">     clock: 33MHz</span><br><span class="line">     capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless</span><br><span class="line">     configuration: broadcast=yes driver=rtw89_pci driverversion=5.4.0-100-generic firmware=N/A ip=&lt;xxxxxxxxxxxxxxxxxxxx&gt; latency=0 link=yes multicast=yes wireless=IEEE 802.11</span><br><span class="line">     resources: irq:85 ioport:3000(size=256) memory:d1800000-d18fffff</span><br><span class="line">*-network</span><br><span class="line">     description: Ethernet interface</span><br><span class="line">     product: RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller</span><br><span class="line">     vendor: Realtek Semiconductor Co., Ltd.</span><br><span class="line">     physical id: 0</span><br><span class="line">     bus info: pci@0000:03:00.0</span><br><span class="line">     logical name: eno1</span><br><span class="line">     version: 15</span><br><span class="line">     serial: &lt;xxxxxxxxxxxxxxxxxxxx&gt;</span><br><span class="line">     capacity: 1Gbit/s</span><br><span class="line">     width: 64 bits</span><br><span class="line">     clock: 33MHz</span><br><span class="line">     capabilities: pm msi pciexpress msix bus_master cap_list ethernet physical tp mii 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation</span><br><span class="line">     configuration: autonegotiation=on broadcast=yes driver=r8169 firmware=rtl8168h-2_0.0.2 02/26/15 latency=0 link=no multicast=yes port=MII</span><br><span class="line">     resources: irq:24 ioport:2000(size=256) memory:&lt;xxxxxxxxxxxxxxxxxxxx&gt; memory:&lt;xxxxxxxxxxxxxxxxxxxx&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>â€‹ éšå»äº†ä¸€äº›é‡è¦ä¿¡æ¯ã€‚åœ¨æ²¡æœ‰å®‰è£…8852å¯¹åº”çš„ç½‘å¡é©±åŠ¨å‰ï¼Œç¬¬ä¸€é¡¹ï¼ˆç¬¬ä¸€ä¸ª<code>*-network</code>ï¼Œæ¯ä¸€é¡¹è¡¨ç¤ºä¸€ä¸ªç½‘ç»œæ§åˆ¶è®¾å¤‡ï¼‰æ˜¾ç¤ºçš„æ˜¯ <strong><u>unmanaged</u></strong>ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤ï¼ˆå¤šäº†æˆ‘ä¹Ÿæ²¡è®°ä½ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iwconfig</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ˜¯ä»€ä¹ˆï¼Ÿå¸¸ç”¨çš„æ˜¯<code>ifconfig</code>ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äºï¼š</p>
<blockquote>
<p>iwconfig is similar to ifconfig, but is dedicated to wireless networking interfaces.[1]</p>
</blockquote>
<p>â€‹ å¥½ï¼Œé‚£ä¹ˆåœ¨<code>lspci</code>ä¹‹åï¼Œæˆ‘å·²ç»çŸ¥é“äº†Realtek 8852ç½‘ç»œæ§åˆ¶å™¨è¿™ä¸ªå‹å·ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŸ¥æ‰¾ç½‘å¡é©±åŠ¨äº†ï¼Œæ­¤å¤„å¿½ç•¥googleçš„è¿‡ç¨‹ï¼Œæ‰¾åˆ°äº†Githubåº“ï¼š<a href="https://github.com/lwfinger/rtw89">[Github: lwfinger/rtw89]</a>ï¼Œç›´æ¥ç¼–è¯‘å®‰è£…å°±å¯ä»¥ä½¿ç”¨ï¼</p>
<p>â€‹ ä½†æ˜¯åœ¨å®‰è£…å‰ä¸€å®šè¦æ³¨æ„ï¼ŒRedmi G 2021 é»˜è®¤æ˜¯æ‰“å¼€äº†secure bootçš„ï¼ˆæˆ‘ä¸€å¼€å§‹è¿˜è¢«è’™åœ¨é¼“é‡Œï¼‰ï¼Œsecure bootçš„æƒ…å†µä¸€å®šè¦æŒ‰ç…§repoä¸­READMEçš„æŒ‡ç¤ºå®‰è£…ï¼Œå¦åˆ™å°±ä¼šä¸æˆåŠŸã€‚æˆ‘ç›´æ¥å–æ¶ˆäº†secure bootï¼Œç›´æ¥å®‰è£…æˆåŠŸã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://wiki.debian.org/iwconfig">Debian/iwconfig</a></p>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>ç¯å¢ƒå·¥ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust C++å°è®°å½•</title>
    <url>/2022/08/20/Rust-C-%E5%B0%8F%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h1 id="rustc">Rust/C++</h1>
<hr>
<p>â€‹ å¾ˆä¹…ä¹‹å‰ï¼ˆ3ä¸ªæœˆå‰å§ï¼‰å†™çš„æ–‡æ¡£äº†ï¼Œå½“æ—¶è¿˜åœ¨å­¦Rustä»¥åŠé›¶é›¶æ•£æ•£åœ°å­¦ä¸€äº›C++STLåº“ç”¨æ³•ï¼ˆå“ªçŸ¥ã€Šeffective modern C++ã€‹è¿™èˆ¬å¥½ä¹¦ï¼Ÿï¼‰ã€‚Rustéƒ¨åˆ†çš„è®°å½•è¿˜æŒºæœ‰è¶£çš„ï¼ŒC++éƒ¨åˆ†å°±æ²¡æœ‰é‚£ä¹ˆæœ‰è¶£äº†ã€‚ç´¢æ€§å°±è´´åœ¨æ­¤å¤„ï¼Œä¾›æ—¥åæŸ¥é˜…ã€‚ï¼ˆä¸è¿‡å¾ˆé•¿å•Šï¼Œè¿™å«snippetï¼Ÿï¼‰</p>
<span id="more"></span>
<hr>
<h2 id="rust-éƒ¨åˆ†">Rust éƒ¨åˆ†</h2>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
åŒ…ç®¡ç†ï¼šlib.rsä¸mod.rsçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘åœ¨mod.rsæˆ–è€…lib.rsä¸­å†™ä»€ä¹ˆå†…å®¹ï¼Œä¼šå¦‚ä½•å½±å“æ•´ä¸ªåŒ…ï¼Ÿæ¯”å¦‚æˆ‘æ˜¯å¦å¯ä»¥åœ¨lib.rsæˆ–è€…mod.rsä¸­è¿›è¡Œå…¨å±€çš„useï¼Ÿ</li>
</ul>
<p>â€‹ ä¸ªäººè®¤ä¸ºå¯ä»¥è¿™ä¹ˆç†è§£ï¼š<code>lib.rs</code>å£°æ˜äº†ä¸€ä¸ªcrateä¸­æ‰€åŒ…å«çš„æ¨¡å—ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ add.rs</span><br><span class="line">â”œâ”€â”€ sub.rs</span><br><span class="line">â”œâ”€â”€ main.rs</span><br><span class="line">â””â”€â”€ lib.rs</span><br></pre></td></tr></table></figure>
<p>â€‹ åˆ™<code>add,rs</code> ä»¥åŠ<code>sub.rs</code>æ˜¯æ­¤crateçš„ä¸¤ä¸ªæ¨¡å—ï¼Œåœ¨<code>lib.rs</code>å¯¹æ­¤ä¸¤æ¨¡å—çš„â€œå­˜åœ¨æ€§â€è¿›è¡Œå£°æ˜ã€‚ä¸€èˆ¬æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> add;		<span class="comment">// å¯ä»¥åŠ pub</span></span><br><span class="line"><span class="keyword">mod</span> sub;		<span class="comment">// å¯ä»¥åŠ pub</span></span><br></pre></td></tr></table></figure>
<p>â€‹ å¯¹äºä¸è¿™äº›æ¨¡å—å¤„äºåŒä¸€ç›®å½•çš„<code>main.rs</code>ï¼Œå¯ä»¥ä¸éœ€è¦<code>lib.rs</code>å°±åœ¨<code>main.rs</code>ä¸­é€šè¿‡<code>mod xxx;</code>çš„æ–¹å¼å£°æ˜æ¨¡å—ã€‚ä½†å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶ä¸æ¨¡å—ä¸åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œè²Œä¼¼ï¼ˆæ®æˆ‘æ‰€çŸ¥ï¼‰åªèƒ½é€šè¿‡ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate_name::add;</span><br><span class="line"><span class="keyword">use</span> crate_name::sub;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·çš„æ–¹å¼è°ƒç”¨æ¨¡å—ã€‚è¿™æ ·è°ƒç”¨æ¨¡å—å¿…é¡»é€šè¿‡<code>lib.rs</code>å¯¹æ¨¡å—è¿›è¡Œå£°æ˜ï¼å¦åˆ™ç¼–è¯‘å°†å‡ºç°ï¼šæ‰¾ä¸åˆ°æ¨¡å— çš„é”™è¯¯ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œ<code>mod.rs</code>æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿå¯¹äºä¸€ä¸ªå¤§å‹çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½å°†å…¶æ‹†ä¸ºå¤šä¸ªæ–‡ä»¶ã€‚æ¯”å¦‚<code>add.rs</code>ï¼Œæˆ‘ä»¬å°†å…¶æ‹†åˆ†ä¸ºï¼š<code>add_inplace.rs</code>ï¼Œ<code>add_2_digits.rs</code>ï¼Œ<code>add_more_than2.rs</code>ä¸‰ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸‰ä¸ªæ–‡ä»¶æŒ‰ç…§å¦‚ä¸‹æ‰€ç¤ºçš„æ–¹å¼è¿›è¡Œæ•´ç†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src</span><br><span class="line">â”œâ”€â”€ add</span><br><span class="line">...			â”œâ”€â”€ add_inplace.rs</span><br><span class="line">			â”œâ”€â”€ add_2_digits.rs</span><br><span class="line">			â””â”€â”€ add_more_than2.rs</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤æ—¶æˆ‘ä»¬éœ€è¦<code>mod.rs</code>æ¥åŒä¸€æ•´ä¸ªæ¨¡å—å†…éƒ¨çš„æ‰€æœ‰å­æ¨¡å—ã€‚åœ¨<code>add/</code>ä¸­å»ºç«‹å«åš<code>mod.rs</code>çš„æ–‡ä»¶ï¼Œæˆ–è€…ä¸<code>add/</code>åŒçº§å»ºç«‹<code>add.rs</code>ç›®å½•ï¼Œå†…éƒ¨å£°æ˜å­æ¨¡å—ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> add_inplace;</span><br><span class="line"><span class="keyword">mod</span> add_2_digits;</span><br><span class="line"><span class="keyword">mod</span> add_more_than2;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ•…ç®€å•æ¥è¯´ï¼š<code>lib.rs</code>å£°æ˜ä¸€ä¸ªcrateä¸‹çš„æ‰€æœ‰æ¨¡å—ï¼Œ<code>mod.rs</code>å£°æ˜ä¸€ä¸ªæ¨¡å—ä¸‹çš„æ‰€æœ‰å­æ¨¡å—ã€‚</p>
<p>â€‹ P.S: åœ¨useè¯­å¥å¼•å…¥çš„æ¨¡å—åè¿‡é•¿æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>as</code>é‡å‘½åã€‚ä¾‹å¦‚å‡è®¾æœ‰ä¸ªå«åš<code>numpy</code>çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥<code>use numpy as np;</code></p>
<hr>
<ul>
<li><p><input type="checkbox" disabled checked>
const ä¸ staticåœ¨Rustä¸­çš„å…·ä½“å«ä¹‰ï¼Œä¸å…¨å±€å˜é‡ä¹‹é—´çš„å…³ç³»</p></li>
<li><p>staticå®šä¹‰çš„å€¼ä¸€èˆ¬æ˜¯å…¨å±€å˜é‡ï¼Œå…·æœ‰è¶…é•¿å£°æ˜å‘¨æœŸã€‚æ³¨æ„ç”±äºstaticå®šä¹‰å…¨å±€ <strong><u>å˜é‡</u></strong>ï¼Œå…¶ç»“æœæ˜¯æœ‰åœ°å€çš„ã€‚</p></li>
<li><p>constå®šä¹‰çš„æ˜¯çœŸæ­£çš„å¸¸é‡ï¼Œæ˜¯compile timeå¯çŸ¥çš„å€¼ï¼Œç±»ä¼¼äºC++ä¸­çš„<code>constexpr</code>ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œconstexpréƒ½æ˜¯compile time variableï¼‰ã€‚å¯¹åº”åœ°ï¼ŒRustä¹Ÿå­˜åœ¨<code>const fn</code>ï¼Œä½œç”¨ç±»ä¼¼äºC++çš„<code>constexpr</code>å‡½æ•°ã€‚å¦‚æœè¦ä½¿å¾—ä¸€ä¸ªå‡½æ•°è¾“å‡ºconstå€¼ï¼Œåˆ™æ­¤å‡½æ•°éœ€è¦æ˜¯<code>const fn</code>ã€‚</p></li>
<li><p>åœ¨C++ä¸­ï¼Œå¦‚æœç¼–è¯‘å™¨å‘ç°æˆ‘ä»¬åœ¨ç»™ä¸€ä¸ª<code>constexpr</code>å€¼å–åœ°å€ï¼ˆ<code>&amp;</code>ï¼‰ï¼Œåˆ™ç¼–è¯‘å™¨å°†ä¼šç»™æ­¤å€¼åˆ†é…ä¸€ä¸ªåœ°å€ï¼Œå¦åˆ™ä¸€èˆ¬æ¥è¯´ï¼Œ<code>constexpr</code>å€¼ä¸ä¼šå ç”¨å†…å­˜ã€‚</p></li>
</ul>
<hr>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
iter() ä¸forå¾ªç¯ï¼š</li>
</ul>
<p>â€‹ ä¸€èˆ¬æ¥è¯´ï¼Œé™¤éå˜é‡å·²ç»æ˜¯iteratorï¼ˆæˆ–è€…IntoIterç­‰ç­‰ï¼‰ï¼Œforå¾ªç¯ä¸€èˆ¬éƒ½æ˜¯é’ˆå¯¹<code>x.into_iter()</code>ï¼Œ<code>x.iter_mut()</code>ï¼Œ<code>x.iter()</code>ä¸‰ç§å½¢å¼è¿›è¡Œçš„ï¼š</p>
<ul>
<li><code>into_iter</code>è¿”å›å€¼è§†ä¸Šä¸‹æ–‡è€Œå®šã€‚æ¯”å¦‚æŸä¸ªå®¹å™¨ä¸­æŒæœ‰çš„æ˜¯referenceï¼Œé‚£ä¹ˆå°†è¿”å›referenceï¼Œæ˜¯å€¼å°±è¿”å›å€¼ã€‚<code>into_iter</code>åœ¨éå†è¿‡ç¨‹ä¸­å°†å‘ç”Ÿmoveï¼ŒåŸå®¹å™¨å°†è¢«consumedï¼Œä¸å†æœ‰æ•ˆï¼Œä½†è¿”å›çš„æ˜¯å…·æœ‰æ‰€æœ‰æƒçš„å†…å®¹ã€‚</li>
<li><code>iter</code>ä¸<code>iter_mut</code>ä¸€èˆ¬åˆ™ï¼ˆåˆ†åˆ«ï¼‰è¿”å›immutable references ä»¥åŠ mutable referencesï¼Œä¸ä¼šæ¶ˆè€—åŸæœ‰å®¹å™¨ã€‚</li>
</ul>
<p>â€‹ iteratorå†…éƒ¨å…·æœ‰å¾ˆå¤šæœ‰ç”¨çš„å‡½æ•°ï¼š</p>
<ul>
<li><code>advance_by</code>ï¼šä¸<code>next</code>ä¸åŒï¼Œ<code>advance_by</code>æ˜¯éå•æ­¥çš„ç§»åŠ¨ï¼Œå¯ä»¥ä¼ å…¥ä¸€å€¼ç¡®å®šiteratorå‰è¿›çš„æ­¥æ•°ã€‚è¶…è¿‡è¿”å›è¿”å›Errã€‚</li>
<li><code>all</code>ä¸<code>any</code>ï¼Œä¸¤ä¸ªå‡½æ•°å‡å¯ä»¥ä¼ å…¥é—­åŒ…ï¼Œç”¨ä»¥åˆ¤å®šæ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚å«ä¹‰ä¸pythonçš„<code>all</code>ä¸<code>any</code>ä¸€è‡´ã€‚</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>collect</code>ï¼Œä¸ªäººæ„Ÿè§‰ç±»ä¼¼äº<code>from_iter</code>ã€‚äº‹å®ä¸Šï¼Œæ­¤å‡½æ•°è¿”å›ä¸€ä¸ª<code>FromIterator</code>ã€‚ä¹Ÿå³å¯ä»¥ç”±iteratoræ„é€ ä¸€äº›æ•°æ®ç»“æ„ï¼Œå¦‚vecã€‚æ¯”å¦‚ï¼š</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">vector</span>: <span class="type">Vec</span>&lt;<span class="type">usize</span>&gt; = (<span class="number">0</span>..=<span class="number">10</span>).<span class="title function_ invoke__">map</span>(|x| &#123;x * x + <span class="number">2</span> * x&#125;).<span class="title function_ invoke__">collect</span>();</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­ï¼Œå·¦è¾¹çš„typeæ˜¯å¿…é¡»è¦ç¡®å®šçš„ï¼Œå¦åˆ™collectæ— æ³•å¾—çŸ¥è‡ªå·±åº”è¯¥è¿”å›ä»€ä¹ˆç±»å‹ã€‚</p>
<ul>
<li><code>chain</code>ï¼šç±»ä¼¼äº<code>extend</code>æˆ–è€…<code>concatenate</code>ã€‚<code>a.iter().chain(b.iter())</code>å°†è¿”å›ä¸²è”çš„iteratorï¼Œç”¨äºéå†ç­‰ã€‚</li>
<li><code>cycle</code>ï¼šå°†iteratoré¦–ä½ä¸²æ¥ï¼Œä½¿å¾—iteratoræˆä¸ºç¯çŠ¶</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>filter</code>ï¼šä¼ å…¥é—­åŒ…ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„iteratorï¼Œæ–°çš„iteratorä¸­åªå«æœ‰é—­åŒ…å‡½æ•°ç¡®å®šçš„å€¼ã€‚æ¯”å¦‚ä¸€ä¸ªåˆ¤å®šå¶æ•°çš„å‡½æ•°ç­‰ã€‚</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>filter_map</code>ï¼šä¼ å…¥é—­åŒ…ï¼Œæ­¤é—­åŒ…å‡½æ•°è¿”å›<code>Option</code>ã€‚å¯¹äºè¿”å›å€¼ä¸º<code>Some&lt;T&gt;</code>çš„å€¼ï¼Œå°†è¢«æ”¾å…¥è¿”å›çš„è¿­ä»£å™¨ä¸­ã€‚ç›¸å½“äº<code>.filter().map()</code></li>
<li><code>flatten</code>ï¼šå½“ç»“æ„ä¸­å­˜åœ¨nested iteratoræ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤flattenå±•å¹³ã€‚ä¾‹å¦‚ï¼š<code>Vec&lt;Vec&lt;i32&gt;&gt;</code>ï¼Œå¯ä»¥ç”¨flattenå…ˆå±•å¼€ï¼ˆ<strong><u>è¿”å›IntoIterator</u></strong>ï¼‰ï¼Œå†collectã€‚</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>fold</code>ï¼šå¯¹æ­¤iteratorè¿›è¡Œä¸€ä¸ªå‹ç¼©æ“ä½œï¼Œä¾‹å¦‚<code>(0..10).fold(0, |acc, x|&#123;acc + x&#125;)</code>å¯ä»¥æ±‚ç´¯åŠ æ“ä½œã€‚</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>for_each</code>ï¼šä¼ å…¥ä¸€ä¸ªé—­åŒ…ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œæ“ä½œã€‚</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>last</code>ï¼šä¸è¿‡æ³¨æ„ï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªO(n)æ“ä½œ</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>nth</code>ï¼š<code>last</code>å°±æ˜¯<code>nth</code>çš„ä¸€ä¸ªç‰¹ä¾‹è€Œå·²</li>
<li><code>partition</code>ï¼šconsumeæ­¤iteratorï¼Œå¹¶è¿”å›<strong><u>ä¸¤ä¸ª</u></strong>collectionï¼ˆæ¯”å¦‚ä¸¤ä¸ªvecï¼‰ã€‚<code>partition</code>ä¼ å…¥ä¸€ä¸ªé—­åŒ…ï¼Œå¯ä»¥è®¤ä¸ºæ­¤é—­åŒ…å‡½æ•°è¿”å›å€¼ä¸ºtrueçš„å…ƒç´ åœ¨ä¸€ä¸ªcollectionä¸­ï¼Œåä¹‹åˆ™åœ¨å¦ä¸€ä¸ªcollectionä¸­ã€‚æ³¨æ„ï¼Œç”±äºå¯¹äº<code>iter()</code>è¿”å›çš„iteratorè€Œè¨€ï¼Œå¦‚æœåŸå®¹å™¨å†…éƒ¨å…ƒç´ çš„ç±»å‹æ˜¯<code>T</code>ï¼Œé‚£ä¹ˆiteratorçš„<code>Self::Item</code>å°±æ˜¯<code>&amp;T</code>ã€‚è€Œpartitionè¾“å…¥çš„é—­åŒ…è¦æ±‚ä¼ å…¥<code>&amp;Self::Item</code>ï¼Œä¹Ÿå³æœ€åï¼Œè¾“å…¥å°†ä¼šæ˜¯<code>&amp;&amp;T</code>ï¼Œæ­¤æ—¶å¯ä»¥åœ¨é—­åŒ…å‡½æ•°å‚æ•°å‰åŠ <code>&amp;</code>ç”¨äºdereference</li>
<li><code>product</code>ï¼šç›¸å½“äºè¿”å›å•å€¼çš„<code>cumprod</code></li>
<li><code>reduce</code>ï¼šä½¿ç”¨æŸä¸€å‡½æ•°å°†å€¼å‹ç¼©ä¸ºä¸€ä¸ªï¼ˆä¸foldå‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡ä¸éœ€è¦æä¾›åˆå€¼ï¼‰</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>rev</code>ï¼šåå‘è¿­ä»£ã€‚å¹¶ä¸”æ³¨æ„åå‘è¿­ä»£å™¨ä¸æ­£å‘è¿­ä»£å™¨ä¸æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚</li>
<li><code>skip</code>ï¼šè¾“å…¥ä¸€ä¸ªå€¼nï¼Œè¿­ä»£å™¨å°†ä»start+nå¼€å§‹ï¼ˆè·³è¿‡åˆå§‹å€¼ï¼‰ã€‚<code>skip_while</code>ï¼šè¾“å…¥ä¸€ä¸ªé—­åŒ…ï¼ˆè¿”å›true | falseï¼‰ï¼Œç›´åˆ°é—­åŒ…è¿”å›falseä¹‹å‰çš„æ‰€æœ‰å€¼éƒ½ä¼šè¢«è·³è¿‡ã€‚</li>
<li><code>step_by</code>ï¼šç›¸å½“äºpython range(0, end, step)</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>take</code>ï¼šä¼ å…¥ä¸€ä¸ªå€¼nï¼Œè¿­ä»£å™¨æœ€å¤šå–åˆ°start+n ï¼ˆ<code>skip</code>çš„å¯¹ç§°æ“ä½œï¼‰ã€‚<code>take_while</code>ï¼šè¾“å…¥é—­åŒ…ï¼Œç›´åˆ°é—­åŒ…è¿”å›falseä¹‹å‰çš„æ‰€æœ‰å€¼éƒ½ä¼šè¢«å–å‡ºåˆ°æ–°çš„iteratorä¸­ã€‚æ³¨æ„æ­¤takeä¸Optionçš„takeä¸åŒï¼ŒOptionçš„takeåº”è¯¥ä¼šä½¿å¾—åŸå€¼ä¸ºNoneï¼ˆå¯ä»¥è®¤ä¸ºè¿™æ˜¯æŸç§æ„ä¹‰ä¸Šçš„consumeï¼‰ï¼Œä½†iteratorçš„takeä¸ä¼šä¿®æ”¹æˆ–æ¶ˆè€—åŸå€¼</li>
<li>ï¼ˆå¸¸ç”¨ï¼‰<code>zip</code>ä¸<code>unzip</code>ï¼šç±»ä¼¼äºpythonï¼Œ<code>zip</code>å°†ä¸¤ä¸ªè¿­ä»£å™¨æ‰“åŒ…æˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ­¤è¿­ä»£å™¨æ˜¯ä¸¤ä¸ªè¿­ä»£å™¨å…ƒç´ çš„tupleã€‚unzipåˆ™å°†è¿™æ ·çš„è¿­ä»£å™¨é‡æ–°æ‹†ä¸ºä¸¤ä¸ªå®¹å™¨ï¼ˆä¸ä¸€å®šæ˜¯è¿­ä»£å™¨ï¼Œå¯ä»¥æ˜¯Vecï¼‰</li>
</ul>
<hr>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
Rustä¸­çš„é—­åŒ…ä»¥åŠç¨‹åºä¸­çš„é—­åŒ…æ¦‚å¿µ</li>
</ul>
<p>â€‹ æ›¾ç»æˆ‘æƒ³ææ¸…æ¥šä¸ºä»€ä¹ˆæˆ‘æ— æ³•ç¡®å®šclosureçš„ç±»å‹ï¼Œé—®é¢˜æ˜¯è¿™æ ·çš„ï¼šæˆ‘æƒ³è¿”å›æŸä¸ªiteratorç»è¿‡mapåçš„ç»“æœï¼Œå¦‚ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">map_test</span>() <span class="punctuation">-&gt;</span> &lt;?&gt; &#123;</span><br><span class="line">    (<span class="number">0</span>..<span class="number">10</span>).<span class="title function_ invoke__">map</span>(|i| &#123;i * <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä½†æ˜¯ä¸€ç›´æ— æ³•å†™å¯¹è¿”å›å€¼ã€‚<code>rust-analyzer</code>å‘Šè¯‰æˆ‘ï¼Œè¿”å›å€¼åº”è¯¥æ˜¯<code>Map&lt;Range&lt;i32&gt;, |i32| -&gt; i32&gt;</code>ã€‚æˆ‘å°è¯•å¡«åœ¨è¿”å›å€¼type annotationä¸­ï¼ŒæŠ¥é”™ï¼Œæ— æ³•ç›´æ¥å¡«<code>Map&lt;Range&lt;i32&gt;, |i32| -&gt; i32&gt;</code>ï¼Œç¼–è¯‘å™¨æ— æ³•è§£æ<code>|i32| -&gt; i32</code>ï¼ˆå­˜åœ¨è¯­æ³•é”™è¯¯ï¼‰ã€‚åæ¥æˆ‘åˆå°è¯•äº†ä¸€äº›é­”æ³•ï¼Œè¯¸å¦‚ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">map_test</span>&lt;T&gt;() <span class="punctuation">-&gt;</span> Map&lt;Range&lt;<span class="type">i32</span>&gt;, T&gt; <span class="keyword">where</span> T: <span class="title function_ invoke__">Fn</span>(<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    (<span class="number">0</span>..<span class="number">10</span>).<span class="title function_ invoke__">map</span>(|i| &#123;i * <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿˜æ˜¯ä¸è¡Œã€‚æŠ¥é”™å¤§æ„ï¼šè¿”å›å€¼æ˜¯<code>map(closure xxxxx ï¼ˆæ–‡ä»¶åï¼Œè¡Œåˆ—å·ï¼‰)</code>è€Œéœ€è¦<code>T</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿”å›å€¼ç±»å‹ä¸åŒ¹é…ã€‚</p>
<p>â€‹ ä¹‹åæˆ‘åœ¨stackoverflowä¸Šå¶ç„¶çœ‹åˆ°è¿™æ ·çš„é—®é¢˜ï¼šæœ‰äººæƒ³æŠŠåŒ¿åé—­åŒ…æ¨å…¥Vecä¸­ï¼Œä½†æ˜¯Vecæ— æ³•è§£æåŒ¿åé—­åŒ…çš„ç±»å‹ã€‚ä¸‹é¢çš„ä½¬è¿™ä¹ˆå›ç­”åˆ°ï¼š</p>
<blockquote>
<p>Each closure has an <strong><u>auto-generated, unique, anonymous type</u></strong>. As soon as you add the first closure to the vector, that is the type of all items in the vector. However, when you try to add the second closure, it has a <strong><u>different auto-generated, unique, anonymous type</u></strong>, and so you get the error listed.</p>
</blockquote>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®šclosureçš„ç±»å‹è²Œä¼¼æ˜¯ä¸å¯èƒ½çš„ã€‚è™½ç„¶å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">f1</span> = |i: <span class="type">i32</span>| <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;i * <span class="number">2</span>&#125;;			<span class="comment">// Ok</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">f2</span> = |i: <span class="type">i32</span>| &#123;i * <span class="number">2</span>&#125;;						<span class="comment">// Ok</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">f3</span> = |i| <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;i * <span class="number">2</span>&#125;;			      <span class="comment">// Err</span></span><br></pre></td></tr></table></figure>
<p>â€‹ å‰ä¸¤å¥å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œ<code>rust-analyzer</code>ä¹Ÿä¼šæ¨å¯¼å‡º<code>|i32| -&gt; i32</code>çš„ç±»å‹æ¥ï¼Œä½†æƒ³è¦ç»™<code>f1</code>ç­‰å˜é‡è¿›è¡Œtype annotationæ˜¯åšä¸åˆ°çš„ã€‚æ­¤å¤–æ³¨æ„ï¼Œå¦‚æœé—­åŒ…çš„è¾“å…¥ä¸è¿›è¡Œtype annotationï¼ˆå¦‚<code>f3</code>ï¼‰ï¼Œå°†ä¼šæŠ¥é”™ã€‚è€Œè¾“å‡ºç±»å‹å¯ä»¥ä¸è¦ï¼ˆç¼–è¯‘å™¨å¯ä»¥æ¨å¯¼å‡ºæ¥ï¼‰ã€‚</p>
<hr>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
Trait &amp; impl &amp; Box&lt;dyn TraitObject&gt;</li>
</ul>
<p>â€‹ Rust Programming Languageä¸€ä¹¦å…¨é¢åœ°ä»‹ç»äº†traitçš„æ€§è´¨ã€‚å…¶åŸºæœ¬ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">TraitName</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">your_method</span>(&lt;args...&gt;) <span class="punctuation">-&gt;</span> ReturnType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå³æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰Traitï¼ˆæ›¿æ¢TraitNameï¼‰ï¼Œå¹¶ä¸”é™å®šæ­¤traitä¸­çš„æ¥å£ã€‚æ‰€æœ‰å…·æœ‰æ­¤traitçš„ç±»å‹ï¼Œéƒ½éœ€è¦è‡ªå®šä¹‰è¿™äº›æ¥å£ã€‚å¯ä»¥ç†è§£ä¸ºï¼šTraitç±»ä¼¼äºåŸºç±»ï¼Œå…¶ä¸­å­˜åœ¨è™šå‡½æ•°ã€‚æˆ‘ä»¬åœ¨å­¦ä¹ é“¾è¡¨æ—¶å·²ç»æ¥è§¦è¿‡ï¼Œå¦‚æœéœ€è¦é“¾è¡¨å…·æœ‰è¿­ä»£å™¨ï¼Œéœ€è¦ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">LinkIterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = ...;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå³ä½¿å¾—ç±»å‹<code>LinkIterator</code>å…·æœ‰ç‰¹æ€§Iteratorã€‚ç±»ä¼¼äºè™šå‡½æ•°å®é™…ä¸Šæ˜¯å¯ä»¥æœ‰é»˜è®¤å®šä¹‰çš„ï¼Œtrait methodä¹Ÿå¯ä»¥åœ¨å®šä¹‰traitæ—¶å®šä¹‰é»˜è®¤å®ç°ã€‚å¯¹äºä½¿ç”¨æ­¤ç‰¹æ€§çš„ç±»å‹ï¼Œå¦‚æœè¦ä½¿ç”¨é»˜è®¤æ–¹æ³•ï¼Œåœ¨<code>impl</code>å—ä¸­ä¸é‡å®šä¹‰æ­¤trait methodå³å¯ã€‚ç‰¹æ€§ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥ç±»ä¼¼äºç»“æ„ä½“æ–¹æ³•è¿›è¡Œè°ƒç”¨<code>.method()</code>ï¼Œå¹¶ä¸”ï¼Œç‰¹æ€§æ–¹æ³•æ˜¯å¯ä»¥åœ¨ç±»å‹ä¹‹é—´å…±äº«çš„ã€‚</p>
<p>â€‹ æ›´æœ‰è¶£çš„æ¥äº†ï¼šåœ¨C++æ³›å‹ç¼–ç¨‹ä¸­ï¼Œå‡è®¾æˆ‘æœ‰è¿™æ ·çš„ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ­¤æ¨¡æ¿å‡½æ•°æ¥å—ä¸€ä¸ªç±»å‹Tï¼Œæˆ‘éœ€è¦è°ƒç”¨ç±»å‹Tä¸­çš„æŸä¸ªæ–¹æ³•<code>.method()</code>ï¼Œä¹Ÿå³ç±»å‹Tå¿…é¡»ä¿è¯å…¶å®ç°äº†æ­¤æ–¹æ³•ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿä»¥ä¸ªäººçš„ç†è§£ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeBaseClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SomeBaseClass</span>(<span class="type">int</span> val): <span class="built_in">val</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">printVal</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;val is %d\n&quot;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span> : <span class="keyword">public</span> SomeBaseClass &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SomeClass</span>(<span class="type">int</span> val): <span class="built_in">SomeBaseClass</span>(val) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MutatedClass</span> : <span class="keyword">public</span> SomeBaseClass &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MutatedClass</span>(<span class="type">int</span> val): <span class="built_in">SomeBaseClass</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printVal</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;mutated class val is %d\n&quot;</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">callPrintVal</span><span class="params">(<span class="type">const</span> SomeBaseClass&amp; base)</span> </span>&#123;</span><br><span class="line">    base.<span class="built_in">printVal</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">SomeClass <span class="title">class1</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function">MutatedClass <span class="title">class2</span><span class="params">(<span class="number">6</span>)</span></span>;</span><br><span class="line">    <span class="built_in">callPrintVal</span>(class1);</span><br><span class="line">    <span class="built_in">callPrintVal</span>(class2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·å¯ä»¥ä½¿å¾—æ‰€æœ‰ç»§æ‰¿äº†<code>SomeBaseClass</code>çš„å­ç±»å¯ä»¥è¿›è¡Œè°ƒç”¨ã€‚è€ŒRustæ²¡æœ‰structçš„ç»§æ‰¿ï¼Œä¹Ÿä¸èƒ½è¿™æ ·éšå¼è½¬æ¢ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½¿å¾—å‡½æ•°å¯ä»¥æ“ä½œæŸä¸€ä¸ªå®ç°äº†æŸä¸€åŠŸèƒ½çš„å…¨ä½“ç±»å‹ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨<code>impl TraitObject</code>ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨trait bounds:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">some_func</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">TraitObject</span>) &#123;</span><br><span class="line">    item.<span class="title function_ invoke__">method</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">some_func</span>&lt;T: TraitObject&gt;(item: &amp;T) &#123;</span><br><span class="line">    item.<span class="title function_ invoke__">method</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">some_func</span>&lt;T&gt;(item: &amp;T) <span class="keyword">where</span> T: TraitObject &#123;</span><br><span class="line">    item.<span class="title function_ invoke__">method</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ•…åªè¦çŸ¥é“ç¬¬ä¸€ç§å†™æ³•ä¸åä¸¤ç§å†™æ³•å…·æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåªä¸è¿‡åä¸¤ç§å†™æ³•ä¼ å…¥çš„æ˜¯ç±»å‹ã€‚è€ŒBookåˆ™ç»™å‡ºäº†ä¸€ä¸ªå…·ä½“çš„åŒºåˆ«ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item1: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>, item2: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸Šä¸‹ä¸¤è¡Œä»£ç å‡å¯ä»¥æ¥å—ä»»æ„å®ç°äº†Summaryç‰¹æ€§çš„ç±»å‹ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå‡½æ•°æ˜¾å¼è¦æ±‚äº†ä¸¤ä¸ªå‚æ•°item1ï¼Œitem2å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p>
<p>â€‹ å¦ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢ï¼šè¿”å›å€¼æ˜¯impl TraitObjectæ—¶ï¼Ÿæ„ä¹‰ç±»ä¼¼ï¼šæˆ‘ä»¬å¸Œæœ›è¿”å›å€¼å®ç°äº†æ­¤ç‰¹æ€§<code>TraitObject</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ­¤æ–¹æ³•è§£å†³é—­åŒ…ä¸­æåˆ°çš„è¿”å›map(é—­åŒ…)é—®é¢˜ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">map_test</span>() <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    (<span class="number">0</span>..<span class="number">10</span>).<span class="title function_ invoke__">map</span>(|i| &#123;i * <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä½†è¿”å›å€¼çš„typeæç¤ºæ˜¯ï¼š<code>impl Iterator</code>ã€‚å¹¶ä¸”å½“æˆ‘æƒ³æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œéå†æ—¶ï¼ŒæŠ¥é”™äº†ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">map_test</span>();</span><br><span class="line"><span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> result.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ åŸå› å¾ˆç®€å•ï¼š<code>.iter()</code>æ˜¯ <strong><u>éIteratorå¯¹è±¡</u></strong>è¿”å›å®ç°äº†Iteratorç‰¹æ€§å¯¹è±¡æ—¶çš„æ–¹æ³•ã€‚è€Œç”±äºå®ç°äº†Iteratorç‰¹æ€§çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨forå¾ªç¯éå†ï¼Œä¹Ÿä¸å¿…ä½¿ç”¨<code>.iter()</code>ã€‚ï¼ˆäº‹å®ä¸Šï¼Œåªéœ€è¦çœ‹çœ‹<code>result.next</code>å­˜ä¸å­˜åœ¨å°±çŸ¥é“äº†ï¼‰ã€‚ç”¨Rust Referenceçš„ä¸€æ®µè¯æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š</p>
<blockquote>
<p><code>impl Trait</code> provides ways to specify <strong><u>unnamed but concrete types that implement a specific trait</u></strong>. It can appear in two sorts of places: argument position (where it can act as an anonymous type parameter to functions), and return position (where it can act as an abstract return type).</p>
</blockquote>
<hr>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
moveï¼šè¿™ç©æ„æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿå¯ä»¥æ˜¾å¼è½¬ç§»æ‰€æœ‰æƒï¼Ÿ</li>
</ul>
<p>â€‹ Rust Bookå¦‚æ˜¯è§£é‡Šmoveå…³é”®å­—ï¼š</p>
<blockquote>
<p>Capture a closure's environment by value.</p>
<p><code>move</code> converts any variables captured by reference or mutable reference to variables captured by value.</p>
</blockquote>
<p>â€‹ ä¹Ÿå³å¼ºåˆ¶æŒæœ‰closureä»ç¯å¢ƒä¸­æ•è·çš„å˜é‡ï¼Œå°†å˜é‡æ‰€æœ‰æƒè½¬ç§»ç»™closureã€‚å…³äºè¿™ä¸€åˆ‡çš„è§£é‡Šï¼Œstackoverflowä¸Šæœ‰ä¸€ä¸ª<a href="https://stackoverflow.com/questions/62252966/why-is-the-move-keyword-necessary-when-it-comes-to-threads-why-would-i-ever-n">éå¸¸æ¸…æ™°çš„å›ç­”</a>ï¼ˆæ’åå‰äºŒçš„å›ç­”éƒ½å¾ˆæ¸…æ™°æ˜“æ‡‚ï¼‰ï¼Œå¹¶ä¸”äºŒæ¥¼è¿˜é¡ºå¸¦ä»‹ç»äº†ä¸€ä¸‹<code>FnOnce</code>ï¼Œ<code>Fn</code>ï¼Œ<code>FnMut</code>ç‰¹æ€§ã€‚</p>
<hr>
<ul class="task-list">
<li><input type="checkbox" disabled checked>
dynï¼šä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿç”¨æ¥åšä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>â€‹ å¾ˆæœ‰è¶£çš„ä¸€ä¸ªå…³é”®å­—ã€‚å·²çŸ¥ä½¿ç”¨<code>impl TraitObject</code>ï¼Œå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªä»»æ„å®ç°äº†<code>TraitObject</code>çš„ç±»å‹ã€‚ä½†å¦‚æœæˆ‘ä»¬éœ€è¦æŒæœ‰æ•°ä¸ªè¿™æ ·çš„ç±»å‹ï¼Œå°†å…¶å­˜åœ¨å®¹å™¨é‡Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå°è¯•ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">vec</span>: <span class="type">Vec</span>&lt;<span class="keyword">impl</span> <span class="title class_">TraitObject</span>&gt; = Vec::<span class="title function_ invoke__">new</span>();	<span class="comment">// Error: `impl Trait` only allowed in function and inherent method return types, not in variable binding</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">vec</span>: <span class="type">Vec</span>&lt;TraitObject&gt; = Vec::<span class="title function_ invoke__">new</span>();	<span class="comment">// Error: trait objects must include the `dyn` keyword</span></span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æœ‰ä¸¤ä¸ªé”™ï¼šï¼ˆ1ï¼‰Vecå¹¶ä¸çŸ¥é“å®ç°äº†TraitObjectçš„ç±»å‹éƒ½æœ‰äº›ä»€ä¹ˆï¼Œç±»å‹æ˜¯ <strong><u>åŠ¨æ€çš„</u></strong>ï¼Œæ•…éœ€è¦ä½¿ç”¨<code>dyn</code>ã€‚ï¼ˆ2ï¼‰å®ç°äº†<code>TraitObject</code>çš„ç±»å‹å¹¶æ²¡æœ‰ç¡®å®šçš„å¤§å°ï¼ˆtrait bound <code>Sized</code>æ²¡æœ‰è¢«æ»¡è¶³ï¼‰ï¼Œæ•…æ— æ³•æ”¾åœ¨Vecä¸­ã€‚æ•…ç»¼ä¸Šæ‰€è¿°ï¼Œæ­£ç¡®çš„ä¹¦å†™åº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">vec</span>: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> TraitObject&gt;&gt; = Vec::<span class="title function_ invoke__">new</span>();	<span class="comment">// åŠ¨æ€ç±»å‹ + Boxï¼ˆå †åˆ†é…ï¼‰ç¡®å®šå¤§å°</span></span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><p><input type="checkbox" disabled checked>
selfä¸Selfçš„åŒºåˆ«</p></li>
<li><p>Selfæ˜¯å½“å‰objectè‡ªèº«çš„ç±»å‹ï¼ˆæ³¨æ„ï¼ŒRustä¸­åªæœ‰ä¸ç±»å‹ã€ç‰¹æ€§æœ‰å…³çš„å†…å®¹æ‰ä¼šæœ‰é¦–å­—æ¯å¤§å†™ï¼Œè¯­æ³•æç¤ºç”šè‡³ä¸å»ºè®®ä½ ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼‰</p></li>
<li><p>selfï¼šå½“å‰object</p></li>
<li><p><input type="checkbox" disabled checked>
ä¸€äº›å‡½æ•°æˆ–è€…ç”¨æ³•ï¼š</p></li>
</ul>
<p>â€‹ è¿™é‡Œä¸»è¦è®²ä¸€ä¸‹<code>to_owned</code>å‡½æ•°ã€‚<code>to_owned</code>æ˜¯ç‰¹æ€§<code>std::borrow::ToOwned</code>æä¾›çš„æ–¹æ³•ã€‚å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·è¯´çš„ï¼š</p>
<blockquote>
<p>A generalization of <code>Clone</code> to borrowed data.</p>
<p>Some types make it possible to go from borrowed to owned, usually by implementing the <code>Clone</code> trait. But <code>Clone</code> works only for going from <code>&amp;T</code> to <code>T</code>. The <code>ToOwned</code> trait generalizes <code>Clone</code> to construct owned data from any borrow of a given type.</p>
</blockquote>
<p>â€‹ è¿™é‡Œä¸å¤šè¯´äº†ã€‚æ–‡æ¡£ä¸¾äº†ä¸¤ä¸ªä¾‹å­è¯´æ˜cloneåªèƒ½ç”±<code>&amp;T</code>è½¬<code>T</code>ï¼Œè€Œ<code>to_owned</code>çµæ´»å¤šå˜ï¼š</p>
<ul>
<li><code>&amp;str</code>é€šè¿‡<code>to_owned</code>æ–¹æ³•è½¬ä¸º<code>String</code> Â <code>&amp;[i32]</code>ï¼ˆsliceï¼‰é€šè¿‡<code>to_owned</code>è½¬åŒ–ä¸ºVecã€‚</li>
</ul>
<hr>
<h2 id="céƒ¨åˆ†">C++éƒ¨åˆ†</h2>
<p>â€‹ æœ€è¿‘åœ¨çœ‹C++ä¸Rustçš„asynchronous programmingéƒ¨åˆ†ï¼ŒåŠ ä¸Šå¥½ä¹…æ²¡æœ‰å†™å¤šçº¿ç¨‹ç¨‹åºäº†ï¼Œæ•…ç®€å•å›é¡¾ä¸€ä¸‹ä¸€äº›åŸºç¡€åº“ã€‚<code>future</code>åœ¨è¿™å°±ä¸æäº†ã€‚</p>
<h3 id="unique_lock---lock_guard---shared_mutex---scoped_lock">unique_lock - lock_guard - shared_mutex - scoped_lock</h3>
<p>â€‹ åœ¨è®¨è®ºåˆ°è¿™äº›é”çš„æ—¶å€™ä¼šè®¨è®ºåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šRAIIï¼ˆresource acquisition is initializationï¼‰ï¼ŒRAIIçš„å¥½å¤„æ˜¯ï¼ˆåªæ˜¯æµ…æ˜¾åœ°äº†è§£ä¸€ä¸‹ï¼‰ï¼š</p>
<ul>
<li><strong>RAII avoids using objects in an invalid state.</strong> <strong>RAII simplifies cleanup after partial construction.</strong>[1] æ¯”å¦‚å¦‚æœæ„é€ å‡½æ•°å¤±è´¥äº†ï¼Œæ­¤objectå°†ä¸ä¼šè¿›è¡Œææ„ï¼ˆèµ„æºåœ¨æ„é€ å‡½æ•°ç»“æŸå°±å·²ç»è¢«é‡Šæ”¾äº†ï¼‰</li>
<li><strong><u>RAII is about scopes</u></strong>ã€‚å…·ä½“æŒ‡ï¼šè·å–èµ„æºæ—¶è°ƒç”¨constructorï¼Œèµ„æºæ— æ•ˆæ—¶ï¼ˆæ¯”å¦‚åˆ é™¤ï¼Œæˆ–è€…åœ¨èŒƒå›´å¤–ï¼‰è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ã€‚</li>
<li>RAIIæ˜¯å¦ä¸€ç§å½¢å¼çš„garbage collectorï¼Œç”¨äºç”³è¯·ä»¥åŠé‡Šæ”¾èµ„æºã€‚</li>
</ul>
<p>â€‹ lockçš„RAII featureåˆ™å…·ä½“æŒ‡çš„æ˜¯ä»¥ä¸‹å‡ ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>std::lock ä¸ std::unlockéƒ½åšä¸åˆ°RAIIï¼Œå› ä¸ºæœ¬è´¨ä¸Šä»–ä»¬æ˜¯å¯¹ä¸€ä¸ªå­˜åœ¨çš„é”å¯¹è±¡è¿›è¡Œæ“ä½œã€‚æ²¡æœ‰RAIIæ„å‘³ç€å¦‚æœä¸Šé”äº†ï¼Œå°±å¿…é¡»è¦æ‰‹åŠ¨è§£é”ï¼Œå¦åˆ™å¯èƒ½å‡ºç°é—®é¢˜</li>
<li>std::lock_guardä¸std::unique_lockéƒ½æœ‰RAIIå±æ€§ï¼šlock_guardä¸ä»…ä»…æ˜¯è‡ªåŠ¨è§£é”ï¼Œåœ¨æ„é€ æ—¶è¿˜ä¼šè‡ªåŠ¨ä¸Šé”ã€‚unique_lockåˆ™æä¾›äº†deferredé€‰é¡¹ï¼Œä½¿å¾—å…¶åœ¨æ„é€ æ—¶ä¸ç«‹åˆ»ä¸Šé”ã€‚è‡ªåŠ¨è§£é”æ˜¯ä¸€ä¸ªå€¼å¾—æ‹¥æœ‰çš„å±æ€§ã€‚</li>
</ul>
<h5 id="stdunique_lock">std::unique_lock</h5>
<p>â€‹ unique_locké€šå¸¸ä¸conditional variableä¸€èµ·ä½¿ç”¨ã€‚ç”±äºconditional variableï¼ˆç®€ç§°cvï¼‰ä½¿ç”¨æ—¶é€šå¸¸éœ€è¦ç­‰å¾…ä¸€ä¸ªé”ï¼ˆå¯¹åº”çš„çŠ¶æ€ï¼‰å˜ä¸ºå¯ç”¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">cv.<span class="built_in">wait</span>(mut);</span><br></pre></td></tr></table></figure>
<p>â€‹ å¦‚æœ<code>mut</code>æ˜¯æ™®é€šçš„mutexï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœwaitè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œå°±ä¼šé€ æˆmutæ— æ³•åœ¨waitç»“æŸè¿›è¡Œunlockï¼Œè¿™ä½¿å¾—å‡ºé”™ä¹‹åï¼Œå¾ˆéš¾è¿›è¡Œexception handlingï¼ˆemmmï¼Œå¤§æ¦‚è¿™å°±æ˜¯not exception safe?ï¼‰ã€‚å¦‚æœä½¿ç”¨unique_lockä½œä¸ºmutï¼Œunique_lockå¯ä»¥åˆ©ç”¨RAIIç‰¹æ€§åœ¨exceptionæ—¶è¿›è¡Œè§£é”ã€‚å¹¶ä¸”unique_lockå¯ä»¥å¾ˆå¥½åœ°ä¿è¯è‡ªèº«æ˜¯æŒæœ‰mutexçš„ï¼Œä»¥å…å·²æœ‰çš„mutexè¢«åˆ é™¤ã€moveåï¼Œå°è¯•å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„é”è¿›è¡Œæ“ä½œã€‚</p>
<p>â€‹ unique_lockä¹Ÿå¯ä»¥æ‰‹åŠ¨è§£é”ï¼ˆunlockæ–¹æ³•ï¼‰ã€‚lock_guardå°±æ²¡é‚£ä¹ˆæ–¹ä¾¿äº†ã€‚</p>
<p>â€‹ è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼Œstd::unique_lockä»¥åŠmutexæœ¬èº«æ˜¯å¦å¯ä»¥è¢«å¼•ç”¨å‘¢ï¼Ÿ</p>
<h5 id="stdscoped_lock-stdlock_guard">std::scoped_lock &amp; std::lock_guard</h5>
<p>â€‹ stackoverflowä¸Šæœ‰ä¸æ­¢ä¸€æ¡ç­”æ¡ˆç§°std::scoped_lockå¼ºäºstd::lock_guardï¼Œå»ºè®®æ˜¯ï¼š</p>
<blockquote>
<ol type="1">
<li><code>lock_guard</code> if you need to lock exactly 1 mutex for an entire scope.</li>
<li><code>scoped_lock</code> if you need to lock a number of mutexes that is not exactly 1.</li>
<li><code>unique_lock</code> if you need to unlock within the scope of the block (which includes use with a <code>condition_variable</code>).</li>
</ol>
</blockquote>
<p>â€‹ scoped_lockçš„å®ç°ä¸Šæ›´å€¾å‘äºè¿›è¡Œå¤šmutexæ“ä½œï¼ˆscoped_lockå…·æœ‰å¯å˜ä¸ªæ•°å‚æ•°æ¨¡æ¿ï¼‰ï¼Œunique_lockåˆ™å·²ç»è¯´äº†ï¼šåœ¨ä¸cvä¸€èµ·ä½¿ç”¨æ—¶æœ€å¤§çš„å¥½å¤„æ˜¯exception safeå¹¶ä¸”ä¿è¯é”çš„æŒæœ‰ï¼ˆä¸æŒæœ‰å°±æŠ¥é”™ï¼‰ï¼Œå¹¶ä¸”å¯æ‰‹åŠ¨è§£é”ã€‚lock_guardåƒæ˜¯ä¸€ä¸ªç‰¹ä¾‹åŒ–çš„scoped_lockã€‚</p>
<p>â€‹ ä¸å¾—ä¸è¯´stackoverflowæ˜¯ä¸€ä¸ªå¥½ç½‘ç«™ï¼Œä¼šæœ‰é¡¶å°–C++å¼€å‘è€…å›ç­”ä½ çš„é—®é¢˜ï¼Œç”šè‡³åŒ…æ‹¬STLæ ‡å‡†å§”å‘˜ä¼šçš„å¤§å“¥ï¼š</p>
<blockquote>
<p>When I brought it up in committee, the answer was "nothing." ---<a href="https://stackoverflow.com/users/576911/howard-hinnant">Howard Hinnant</a></p>
</blockquote>
<h5 id="stdshared_mutex">std::shared_mutex</h5>
<p>â€‹ shared_mutex ä½¿ç”¨åœºæ™¯å¾ˆæ˜ç¡®ï¼šè¯»è€…å†™è€…æ¨¡å‹ã€‚å¤šä¸ªè¯»è€…è¯»æ—¶ï¼Œmutexå¯ä»¥å¤šæ¬¡ä¸Šé”ï¼ˆå†…éƒ¨æœ‰é”è®¡æ•°å™¨ï¼Ÿï¼‰åªæœ‰è®¡æ•°å™¨ä¸º0æ—¶ï¼Œå†™è€…æ‰èƒ½å†™ã€‚é‚£ä¹ˆä¸ä½¿ç”¨shared_mutexåº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿè®¡æ•°å™¨mcé”ä»¥åŠä¸€ä¸ªè®¡æ•°å™¨cnt</p>
<p>â€‹ å¯¹äºè¯»è€…è€Œè¨€ï¼š</p>
<pre class="mermaid">
graph TB

A(mc.lock)
B(cnt+&#x3D;1)
C(mc.unlock)
D(READ)
E(mc.lock)
F(cnt-&#x3D;1)
G(mc.unlock)
A--&gt;B--&gt;C--&gt;D--&gt;E--&gt;F--&gt;G

</pre>
<p>â€‹ å¯¹äºå†™è€…è€Œè¨€ï¼š</p>
<pre class="mermaid">
graph TB

graph LR;
A(mc.lock);
B(cnt&#x3D;&#x3D;0 ?);
C(READ);
D(mc.unlock);

A--&gt;B--&gt;|Yes|C--&gt;D
B--&gt;|No|D

</pre>
<p>â€‹ åº”è¯¥ä¸ä¼šå­˜åœ¨æ­»é”çš„é—®é¢˜ã€‚å¯¹äºshared_mutexè€Œè¨€ï¼Œä¸Šè¿°åŠŸèƒ½è¢«ç›´æ¥åŒ…å«åœ¨äº†æ­¤æ•°æ®ç»“æ„ä¸­ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] https://stackoverflow.com/questions/712639/understanding-the-meaning-of-the-term-and-the-concept-raii-resource-acquisiti#:~:text=RAII%20avoids%20using%20objects%20in,we%20even%20use%20the%20object.&amp;text=There%20are%20three%20error%20cases,but%20copying%20the%20files%20failed.</p>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>Rust</tag>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>Rust CUDAæ··åˆç¼–ç¨‹</title>
    <url>/2022/08/09/Rust-CUDA%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<p>â€‹ ï¼ˆæœªå®Œæˆï¼Œè¯·å‹¿ç‚¹å‡»ï¼‰Rust FFIï¼ˆforiegn function interfaceï¼‰éå¸¸æœ‰å¸å¼•åŠ›ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ç”¨ç†Ÿäº†<a href="https://github.com/nannou-org/nannou">nannou</a>åº“ä¹‹åï¼ˆå•Šï¼Œnannouï¼Œæ¯”OpenCVé¦™äº†ä¸çŸ¥é“å¤šå°‘å€ï¼ŒOpenGL-baseåº“ç‰›é€¼ï¼ï¼‰ã€‚CUDAç¼–ç¨‹ä¹Ÿå±äºå¾ˆæœ‰å¸å¼•åŠ›çš„æ´»åŠ¨ï¼ˆè°ä¼šè®¨åŒä¼˜åŒ–ä»£ç ï¼Œåœ¨å·²ç»æ¯”å¤šçº¿ç¨‹CPUå¿«nå€çš„åŸºç¡€ä¸Šçœ‹ç€å®ƒè·‘å¾—è¶Šæ¥è¶Šå¿«å‘¢ï¼‰ã€‚ä¸¤è€…æ”¾åœ¨ä¸€èµ·åªèƒ½è¯´æ˜¯è®©äººè§‰å¾—ä¸‡äº‹çš†ç©ºã€‚æœ¬æ–‡è®°å½•äº†åœ¨ä»¥ä¸‹ä¸¤ä¸ªé¡¹ç›®ï¼š</p>
<ul>
<li>LSMv2ï¼šCUDAåŠ é€Ÿçš„æ¿€å…‰é›·è¾¾ä»¿çœŸå™¨ï¼ˆsimple 2D ray casterï¼‰</li>
<li>ShadowCasterï¼šCUDAåŠ é€Ÿçš„ç©ºåŸŸè®¡ç®—ç®—æ³•ï¼ˆ2Dé˜´å½±æŠ•å°„ç®—æ³•ï¼‰</li>
</ul>
<p>â€‹ ä¸­ï¼Œä½¿ç”¨CUDA/Rustæ··åˆç¼–ç¨‹æ‰€é‡åˆ°çš„/äº§ç”Ÿçš„ï¼šï¼ˆ1ï¼‰è¯­è¨€æ–¹é¢çš„å‘ã€‚ï¼ˆ2ï¼‰CUDAç¨‹åºè®¾è®¡ä¸Šçš„ä¸€äº›å‘ã€‚ï¼ˆ3ï¼‰ä¸€äº›ç®—æ³•è®¾è®¡æ€è·¯ã€‚</p>
<span id="more"></span>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>GPU</tag>
        <tag>CUDA</tag>
        <tag>Rust FFI</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustå­¦ä¹  I</title>
    <url>/2022/05/03/Rust%E5%AD%A6%E4%B9%A0-I/</url>
    <content><![CDATA[<h1 id="rust---i">Rust - I</h1>
<hr>
<h2 id="intros">Intros</h2>
<p>â€‹ Rustï¼Œå¥½ï¼å¯èƒ½ä¸»è¦ç”±äºæ‰€æœ‰æƒæœºåˆ¶ä¸Šçš„åˆ›æ–°ï¼Œå­¦ä¹ æ—¶çš„æ„Ÿè§‰ä¸å­¦å…¶ä»–è¯­è¨€çš„æ„Ÿè§‰å®Œå…¨ä¸åŒï¼Œäºæ˜¯æ²¡æœ‰åƒå­¦JSä¸€æ ·ï¼Œè§‰å¾—æ— èŠï¼Œä¹Ÿæ²¡æœ‰åƒè§‰åƒå­¦haskellä¸€æ ·ï¼Œè§‰å¾—è¿‡äºæŠ½è±¡ã€‚ä½†æ˜¯è¿™æ ·ä¸€ç§è¯­è¨€åˆ›æ–°ï¼Œå¿…ç„¶ä¼šç»™å­¦ä¹ å¸¦æ¥éšœç¢ï¼Œæ¯•ç«Ÿç¼–ç¨‹æ€æƒ³æ˜¯å®Œå…¨ä¸åŒçš„ã€‚æ­¤å¤–ï¼Œå¯èƒ½æˆ‘ä½¿ç”¨Rustçš„å·¥å…·é“¾ä¸å¯¹ï¼Œä¸ªäººè®¤ä¸ºvscodeå¯¹äºRustçš„æ”¯æŒæ˜æ˜¾ä¸è¶³ï¼ˆç¼ºä¹è‡ªåŠ¨è¡¥å…¨ï¼Œæ²¡æœ‰å‡½æ•°å¿«é€ŸæŸ¥çœ‹ä»¥åŠå®šä¹‰è·³è½¬ç­‰ç­‰ï¼‰ï¼Œç¬¬ä¸€å¤©å­¦çš„æ—¶å€™ï¼Œåªèƒ½å®ç°ä¸€äº›å¼ºé€»è¾‘æ€§ç®—æ³•ï¼ˆæ¯”å¦‚ä»€ä¹ˆå¿«æ’ï¼Œå½’å¹¶æ’åºç­‰ç­‰ï¼‰ï¼Œæ— æ³•æ·±å…¥ä½¿ç”¨æ•°æ®ç»“æ„ï¼ˆç»™æˆ‘ä¸€ä¸ªæ•°æ®ç»“æ„æˆ‘æ ¹æœ¬ä¸çŸ¥é“é‡Œé¢æœ‰ä»€ä¹ˆæ–¹æ³•ï¼‰ã€‚</p>
<p>â€‹ ç¬¬ä¸€å¤©å¿«ç»“æŸæ—¶ï¼Œæƒ³å­¦ä¹ ä¸€ä¸‹Rustçš„å¯è§†åŒ–å·¥å…·Plottersï¼Œç»“æœå‘ç°ï¼Œä¹‹å‰ä»èœé¸Ÿæ•™ç¨‹äº†è§£çš„å†™æ³•è¿‡äºç²—æµ…ï¼ŒåŸºæœ¬çœ‹ä¸æ‡‚Plottersä»£ç ï¼Œé‚æŠ•èº«æ›´åŠ æ·±å…¥çš„å­¦ä¹ ã€‚ä½†å´å‘ç°ï¼Œç»™è‡ªå·±è®¾ç½®çš„å°ç›®æ ‡ --- å†™ä¸€ä¸ªé“¾è¡¨ï¼ŒæŒ‰ç…§ä¹‹å‰äº†è§£çš„è¯­æ³•çŸ¥è¯†ï¼Œæˆ‘éƒ½æ˜¯å†™ä¸å‡ºæ¥çš„ã€‚å¿«è¦æ”¾å¼ƒåªæ˜¯æ¥è§¦åˆ°äº†ä¸€ä¸ªæ•™ç¨‹ä»¥åŠå…¶å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://rust-unofficial.github.io/too-many-lists/index.html">Rust unofficial - Learning Rust With Entirely Too Many Linked Lists</a></li>
<li><a href="https://doc.rust-lang.org/std/index.html">Rust-lang docs</a></li>
</ul>
<p>â€‹ æ•™ç¨‹è¯¦ç»†ä»‹ç»äº†å¯¹äºé“¾è¡¨çš„å®ç°ï¼Œè¾ƒä¸ºé€šä¿—æ˜“æ‡‚ï¼Œæœ‰äº›éš¾ä»¥æ€è€ƒçš„é—®é¢˜ï¼Œå…¶å®æ²‰ä¸‹å¿ƒæ¥æƒ³ä¹Ÿå¾ˆå¿«èƒ½æƒ³å‡ºæ¥ã€‚æœ¬æ–‡æ˜¯è·Ÿç€æ•™ç¨‹å®ç°è¿‡ç¨‹ä¸­ï¼Œç¬”è€…å¯¹äºé‡åˆ°çš„ä¸€äº›é—®é¢˜çš„å¤„ç†æ–¹æ³•ä»¥åŠè‡ªå·±çš„å¿ƒå¾—ã€‚ç”±äºç¬”è€…éå¸¸ä¸å–œæ¬¢ä¾è‘«èŠ¦ç”»ç“¢ï¼ˆå› ä¸ºè¿™æ ·ï¼Œæ„Ÿè§‰è‡ªå·±å®Œå…¨å­¦ä¸åˆ°ä¸œè¥¿ï¼‰ï¼Œæ‰€ä»¥ç¬”è€…ä¹Ÿåœ¨è‡ªå·±çš„å®ç°ä¸­æ•´æ´»ï¼ˆè¶…å‰å­¦ä¹ ï¼‰ï¼Œæœ¬æ–‡ä¹Ÿè®°å½•äº†æ•´æ´»è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘åŠå¤„ç†æ–¹æ³•ã€‚æœ¬ç¯‡ä¸ºRustå­¦ä¹ å¿ƒå¾—çš„ç¬¬ä¸€ç« ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-ç”¨rustå®ç°é“¾è¡¨">II. ç”¨Rustå®ç°é“¾è¡¨</h2>
<h3 id="null-pointer-optimizationçš„æ„ä¹‰">2.1 null pointer optimizationçš„æ„ä¹‰ï¼Ÿ</h3>
<p>â€‹ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">		Empty,</span><br><span class="line">    	<span class="title function_ invoke__">NotEmpty</span>(a_pointer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ é€šå¸¸æ¥è¯´ï¼Œenumç±»å‹<code>Foo</code>ï¼ˆå¯ä»¥å°†enumçš„å†…å­˜åŠŸèƒ½ç†è§£ä¸ºä¸€ä¸ªunionï¼‰éœ€è¦æœ‰è¶³å¤Ÿç©ºé—´ä»¥å­˜å‚¨å…¶è¡¨ç¤ºçš„æ•°æ®ï¼Œä¹Ÿå³åœ¨<code>Empty</code>ä»¥åŠ<code>NotEmpty</code>ä¸¤ä¸ªç±»å‹ä¹‹é—´ï¼Œé€‰æ‹©æ‰€å ç©ºé—´æœ€å¤§çš„é‚£ä¸ªç±»å‹å¯¹åº”çš„å†…å­˜æ¶ˆè€—ä½œä¸ºenumç±»å‹<code>Foo</code>çš„å¤§å°ã€‚ä½†æ˜¯ï¼Œ<code>Foo</code>å¦‚ä½•æ‰èƒ½çŸ¥é“å½“å‰è¡¨ç¤ºçš„æ˜¯<code>Empty</code>è¿˜æ˜¯<code>NotEmpty</code>ç±»å‹ï¼Ÿé€šå¸¸ï¼Œéœ€è¦é¢å¤–çš„ç©ºé—´ï¼ˆæ¯”å¦‚ä¸€ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨ä¸€ä¸ªå«tagçš„åŸŸï¼Œä»¥æŒ‡ç¤ºå½“å‰<code>Foo</code>çš„çœŸæ­£å«ä¹‰ã€‚æœ‰ä¸€ç§ä¾‹å¤–ï¼Œä¾‹å¦‚ä»¥ä¸Šè¿™ä¸ªä¾‹å­ï¼š</p>
<p>ï¼ˆ1ï¼‰<code>Empty</code> æ²¡æœ‰å…³è”æ•°æ®</p>
<p>ï¼ˆ2ï¼‰<code>NotEmpty</code> æˆ‘ä»¬è®¤ä¸ºæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯¹äºæ­¤æŒ‡é’ˆè€Œè¨€ï¼Œæ•°æ®ä½ä¸º0ï¼ˆç©ºæŒ‡é’ˆï¼‰æ˜¯ä¸å…è®¸çš„</p>
<p>â€‹ ä¹Ÿå³ï¼Œæ­¤ä¾‹å­ä¸­ï¼Œ<code>NotEmpty</code>ä¸­ä¸è¢«å…è®¸çš„ç»“æœï¼ˆå…¨0ï¼‰æ°å¥½å¯ä»¥è¢«ç”¨äºè¡¨ç¤º<code>Empty</code>ã€‚åˆ™æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦tagåŸŸæ¥è¡¨ç¤º<code>Foo</code>çš„å®é™…æ„ä¹‰ï¼ˆFooä¸­æ•°æ®å¯ä»¥ç›´æ¥åˆ¤å®šï¼‰ã€‚</p>
<h3 id="é”™è¯¯---private-type-xxx-in-public-interface">2.2 é”™è¯¯ - <code>private type 'xxx' in public interface</code></h3>
<p>â€‹ å¦‚æœæˆ‘ç›´æ¥å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;elem: <span class="type">i32</span>&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">    test_elem: Foo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯å¦‚ä»¥ä¸‹è¿™ä¸¤ç§å†™æ³•ï¼Œéƒ½ä¼šå‡ºç°é—®é¢˜</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span> &#123;elem: <span class="type">i32</span>&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Bar</span> &#123;				<span class="comment">// ç¬¬ä¸€ç§å†™æ³•</span></span><br><span class="line">    <span class="keyword">pub</span> test_elem: Foo</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Bar</span> &#123;				<span class="comment">// ç¬¬äºŒç§å†™æ³•</span></span><br><span class="line">    <span class="title function_ invoke__">First</span>(Foo),</span><br><span class="line">    Second</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸¤ç§å†™æ³•éƒ½ä¼šæŠ¥é”™ï¼Œç¼–è¯‘å™¨è®¤ä¸ºï¼š<code>can't leak private type</code>ã€‚structä¸­çš„æƒé™ï¼Œä¸åŒäºC++çš„ç»“æ„ä½“ï¼ˆé»˜è®¤publicï¼‰ï¼Œstructé»˜è®¤privateï¼Œå¦‚æœæ˜¾å¼å®šä¹‰äº†<code>pub</code>å…³é”®å­—æ‰æˆä¸ºpublicçš„ã€‚è€Œå¯¹äºenumè€Œè¨€ï¼Œåªè¦enumæœ¬èº«æ˜¯publicçš„ï¼Œå…¶ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯publicçš„ã€‚ä½†Rustä¸å…è®¸ç”¨æˆ·åœ¨å…¬å¼€çš„ç±»å‹ä¸­ï¼Œæš´éœ²ç§æœ‰ç±»å‹ï¼Œæ­£å¦‚å‚ä¸å›½å®¶æœºå¯†é¡¹ç›®çš„ç§‘å­¦å®¶ï¼Œå³ä½¿è¿™ä¸ªç§‘å­¦å®¶ï¼ˆçš„å­˜åœ¨ï¼‰å¹¶éæœºå¯†ï¼Œä»–ä¹Ÿä¸èƒ½éšæ„è®¨è®ºæœºå¯†çš„å†…å®¹ã€‚</p>
<h3 id="memreplaceçš„ä½œç”¨">2.3 <code>mem::replace</code>çš„ä½œç”¨</h3>
<p>â€‹ å¦‚æœæˆ‘ä»¬ä½¿ç”¨é“¾è¡¨å®ç°stackï¼Œä¹Ÿå³ä¸è®°å½•é“¾è¡¨çš„å°¾éƒ¨ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦pushæ–°çš„å€¼åˆ°é“¾è¡¨ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°ä¿®æ”¹é“¾è¡¨çš„è¡¨å¤´ï¼šæˆ‘ä»¬éœ€è¦æ–°åˆ›å»ºä¸€ä¸ªNodeï¼Œæ­¤Nodeçš„headæ˜¯åŸæ¥é“¾è¡¨çš„headï¼ˆstackå †ç§¯æ€§ï¼‰ï¼Œå‡è®¾Nodeçš„ä¸¤ä¸ªåŸŸï¼šdataï¼ˆæ•°æ®ï¼‰ä¸nextï¼ˆé“¾è¡¨æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„â€œæŒ‡é’ˆâ€ï¼‰ï¼Œæœ‰ä¸¤ä¸ªå†…å®¹éœ€è¦ä¿®æ”¹ï¼š</p>
<p>ï¼ˆ1ï¼‰headæœ¬èº«çš„å€¼ï¼Œéœ€è¦ä¿®æ”¹ä¸ºæœ€æ–°çš„Nodeï¼Œè¿™ä¸ªåªéœ€è¦ä¿®æ”¹headçš„æŒ‡å‘</p>
<p>ï¼ˆ2ï¼‰æ–°Nodeçš„nextï¼Œç”±äºæˆ‘ä»¬éœ€è¦åŸæ¥çš„headä½œä¸ºnextï¼Œè¿™é‡Œæ¶‰åŠåˆ°ç§»åŠ¨æˆ–è€…å¤åˆ¶ã€‚å¦‚æœç”¨å¤åˆ¶ï¼šæˆ‘å¾ˆæƒŠè®¶æˆ‘çæä¸€é€šç«Ÿç„¶è¿‡ç¼–è¯‘äº†ï¼ˆè§ä¸‹ä»£ç å—ï¼‰ï¼Œé¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸‹stackä½¿ç”¨çš„åˆ—è¡¨ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    head: Link,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Link</span> &#123;</span><br><span class="line">    Empty,</span><br><span class="line">    <span class="title function_ invoke__">More</span>(<span class="type">Box</span>&lt;Node&gt;),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    elem: <span class="type">i32</span>,</span><br><span class="line">    next: Link,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        List &#123; head: Link::Empty &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ é‚£ä¹ˆå‡è®¾æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªpushï¼Œå°±æ¶‰åŠåˆ°äº†å°†headèµ‹å€¼ç»™nextçš„æ“ä½œï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">push</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, elem: <span class="type">i32</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">new_node</span> = Node &#123;</span><br><span class="line">            elem: elem,</span><br><span class="line">            next: <span class="keyword">self</span>.head,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä½†æ˜¯ç›´æ¥è¿™æ ·æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºself.head ä¼šè¢«moveæ‰ï¼Œmoveä¼šä½¿å¾—å½“å‰é“¾è¡¨çš„headç›´æ¥è¢«é”€æ¯ï¼Œä¹Ÿå³é“¾è¡¨éƒ¨åˆ†è¢«æ‘§æ¯äº†ï¼ˆæˆ–è€…è¯´æˆï¼Œpartially-initializedï¼Œæœ‰ä¸€éƒ¨åˆ†æ²¡æœ‰åˆå§‹åŒ–ï¼‰ã€‚å¦‚ä¸Šï¼Œåœ¨åŒæ ·çš„ä½ç½®ï¼ˆnextå¤„ï¼‰ä½¿ç”¨cloneï¼Œå¦‚æ³¨é‡Šæ‰€ç¤ºï¼Œä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚ç¼–è¯‘å™¨æç¤ºï¼šcloneæ˜¯æ²¡æœ‰è¢«å®ç°çš„ç‰¹æ€§ï¼ˆself.headæ²¡æœ‰Cloneå‡½æ•°ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚è€ƒè™‘åˆ°headæ˜¯ä¸€ä¸ªLinkï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠLinkçš„cloneå‡½æ•°å®ç°äº†ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥äº†ï¼Ÿå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Clone</span> <span class="keyword">for</span> <span class="title class_">Link</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Link &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            Link::Empty =&gt; Link::Empty,</span><br><span class="line">            Link::<span class="title function_ invoke__">More</span>(next) =&gt; Link::<span class="title function_ invoke__">More</span>(next.<span class="title function_ invoke__">clone</span>()),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­éœ€è¦æ³¨æ„çš„ç‚¹ï¼š<code>Link</code>çš„enumè¯­æ³•ç‰¹æ€§ï¼Œéœ€è¦åˆ¤å®šå½“å‰<code>Link</code>çš„å®é™…æ„ä¹‰ï¼ˆmatchï¼‰ã€‚å¦‚æœæ˜¯<code>Empty</code> éœ€è¦è¿”å›<code>Empty</code>ï¼Œè¯·ä½¿ç”¨namespaceæŒ‡å®š <strong><u>è¿”å›çš„<code>Empty</code>æ˜¯<code>Link</code>ä¸­å®šä¹‰çš„ã€‚</u></strong> å¦‚æœæ˜¯<code>More</code>ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰<code>Link::More(next)</code> æ­¤å¤„çš„nextæ˜¯ä¸€ä¸ªshared referenceï¼Œå¦‚æœè¦ç”¨æ¥åˆå§‹åŒ–åˆ™éœ€è¦è§£å¼•ç”¨<code>*next</code>ã€‚ä½†æ˜¯å¾ˆé—æ†¾ï¼Œè¿™é‡Œä¼šæŠ¥é”™ï¼Œç›´æ¥<code>*next</code>æ˜¯ä¸€ä¸ªç§»åŠ¨æ“ä½œã€‚ä¼šä½¿å¾—<code>Link</code>æˆä¸º partially-initializedçš„æ•°æ®ï¼Œè¿™æ˜¯ä¸è¢«å…è®¸çš„ã€‚</p>
<p>ï¼ˆ2ï¼‰ç›´æ¥ä½¿ç”¨<code>next.clone()</code>ã€‚å¾ˆæŠ±æ­‰ï¼Œè¿™é‡Œåˆæœ‰é—®é¢˜ï¼š</p>
<blockquote>
<ul>
<li>the method <code>clone</code> exists for struct <code>Box&lt;Node&gt;</code>, but its trait bounds were not satisfied</li>
<li>struct Node ----------- doesn't satisfy <code>Node: Clone</code></li>
</ul>
</blockquote>
<p>â€‹ ä¸ªäººçŒœæµ‹ï¼Œè¿™æ˜¯ç”±äºNodeæœ¬èº«æ²¡æœ‰å®ç°cloneå‡½æ•°å¯¼è‡´çš„ï¼Œäºæ˜¯è¿™é‡Œæˆ‘å®ç°cloneã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Clone</span> <span class="keyword">for</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Node &#123;</span><br><span class="line">        Node &#123;</span><br><span class="line">            elem: <span class="keyword">self</span>.elem,</span><br><span class="line">            next: <span class="keyword">self</span>.next.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·ç«Ÿç„¶è¿‡ç¼–è¯‘äº†ï¼Œå¹¶ä¸”ï¼Œç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œè¯´æ˜è¿™æ ·çš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œå¯ä»¥é€šè¿‡æš‚æ—¶ä¿å­˜ä¸€ä»½åŸæ•°æ®çš„copyã€‚ä½†æ˜¯è¿™æ ·æ˜¯å¦æ›´æ…¢ï¼Ÿæµ‹è¯•æ˜¾ç¤ºï¼Œè¿™ç§éœ€è¦cloneçš„æ–¹æ³•ï¼Œåœ¨åŒæ ·è¿›è¡Œ2000æ¬¡pushçš„æƒ…å†µä¸‹ï¼Œæ¯”å®˜æ–¹æ–‡æ¡£ä¸­ä½¿ç”¨<code>std::mem::replace</code>çš„ç‰ˆæœ¬ï¼Œæ…¢å°†è¿‘2000å€... æ‰€ä»¥è¿˜æ˜¯å¥½å¥½å­¦ä¹ å®˜æ–¹å®ç°å§ã€‚</p>
<blockquote>
<p>Time elapsed for my push: 309.202965ms Time elapsed for swap push: 160.718Âµs</p>
</blockquote>
<h3 id="åœ¨å¾ªç¯ä¸­ä½¿ç”¨matchæ–¹æ³•">2.4 åœ¨å¾ªç¯ä¸­ä½¿ç”¨matchæ–¹æ³•</h3>
<p>â€‹ å­¦ä¹ æ•™ç¨‹çš„æ—¶å€™æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œå¯¹äºåªæœ‰ä¸¤ä¸ªåˆ†ç±»çš„enumï¼Œå¯ä»¥ä½¿ç”¨matchçš„è¯­æ³•ç³–ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">ptr</span>: &amp;Link = &amp;stack.head;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = ptr &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼Œ<code>Link::More(node)</code>æœ¬èº«æ˜¯enumç±»å‹ï¼ˆæ­¤ä¾‹å­ä¸­ï¼Œæ˜¯<code>Link</code>ï¼‰çš„ä¸€ä¸ªå¸¸å¼•ç”¨ï¼ˆshared refï¼Œä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºå¸¸å¼•ç”¨ï¼Œæ˜¯å› ä¸ºä¸ªäººè®¤ä¸ºè¿™ä¸ªä¸C++ä¸­çš„å¸¸å¼•ç”¨éå¸¸ç±»ä¼¼ï¼‰ï¼Œè€Œnodeåˆ™æ˜¯å¯¹åº”çš„<code>Link::More</code>ç±»å‹çš„å¸¸å¼•ç”¨ï¼Œæ­¤å¤„ä¹Ÿå°±æ˜¯<code>&amp;Box&lt;Node&gt;</code>ç±»å‹çš„ã€‚é‚£ä¹ˆæ ¹æ®è¿™ä¸ªè¯­æ³•ç³–ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªéå†æ ˆçš„æ–¹æ³•ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">show_stack</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span>: &amp;Link = &amp;<span class="keyword">self</span>.head;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = ptr &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Stack: &#123;&#125;&quot;</span>, node.elem);</span><br><span class="line">        ptr = &amp;node.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ é¦–å…ˆï¼Œptréœ€è¦æ˜¯ã€å¯å˜çš„ã€‘å¸¸å¼•ç”¨ï¼ˆç›¸å½“äºconst type *ï¼‰ï¼Œæ‰èƒ½æ”¹å˜å…¶æŒ‡å‘ã€‚æˆ‘ä»¬åˆ¤å®šï¼Œå¦‚æœpträ¸æ˜¯<code>Link::Empty</code>ï¼Œç”±äºæ­¤æ—¶<code>ptr</code>å®é™…å¯¹åº”äº†ä¸€ä¸ª<code>&amp;Box&lt;Node&gt;</code>ï¼Œæˆ‘ä»¬å°†<code>ptr</code>å¯¹åº”çš„Nodeä¸­å…ƒç´ å–å‡ºï¼Œå¹¶ä½¿å¾—ptræŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆæ³¨æ„ï¼Œæ˜¯<code>node.next</code>æ˜¯<code>Link</code>ç±»å‹çš„ï¼Œä½†æˆ‘ä»¬éœ€è¦çš„<code>ptr</code>æ˜¯å¯¹<code>Link</code>çš„å¼•ç”¨ï¼Œæ•…éœ€è¦ç¬¦å·<code>&amp;</code>ï¼‰</p>
<h3 id="å…³äºæ³›å‹ç¼–ç¨‹generics">2.5 å…³äºæ³›å‹ç¼–ç¨‹ï¼ˆgenericsï¼‰</h3>
<p>â€‹ æˆ‘æƒ³ç›´æ¥ä½¿ç”¨æ¨¡æ¿ç±»å‹Tä½œä¸ºæ ˆçš„ç±»å‹ã€‚äºæ˜¯éœ€è¦ä¿®æ”¹å®šä¹‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">List</span>&lt;T&gt; &#123;head: Link&lt;T&gt;&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&lt;T&gt; &#123;</span><br><span class="line">    elem: T,</span><br><span class="line">    next: Link&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&lt;T&gt; &#123;</span><br><span class="line">    elem: T,</span><br><span class="line">    next: Link&lt;T&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ‰€æœ‰ç›¸å…³ä½ç½®éƒ½éœ€è¦å¢åŠ <code>&lt;T&gt;</code>ä»¥æŒ‡ç¤ºå½“å‰ç±»å‹æ˜¯æ¨¡æ¿ç±»å‹ã€‚éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<p>ï¼ˆ1ï¼‰å¦‚æœè¦åˆå§‹åŒ–æ¨¡æ¿ç±»å‹ï¼Œåœ¨ç±»å‹å£°æ˜æ—¶éœ€è¦å¸¦æœ‰<code>&lt;T&gt;</code>ï¼Œè€Œæ„é€ æ—¶ï¼ˆç­‰å·å³è¾¹ï¼‰ä¸éœ€è¦ï¼Œæ¯”å¦‚ï¼š<code>let new_node: Node &lt;T&gt; = Node &#123;...&#125;;</code>ï¼Œå¦‚æœå³è¾¹å¸¦äº†æ¨¡æ¿ï¼Œåˆ™ä¼šæŠ¥é”™ï¼š<code>chained comparison operator</code>ã€‚ç±»å‹å£°æ˜åŒæ ·ä¹ŸåŒ…æ‹¬è¿”å›å€¼ã€‚å¦‚æœä¸å£°æ˜ç±»å‹ï¼Œåˆ™ä¼šè¿›è¡Œè‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œç»‘å®šç±»å‹ã€‚<code>T</code>æ ¹æ®å…ˆåé¡ºåºè¿›è¡Œç±»å‹ç»‘å®šï¼Œä¾‹å¦‚<code>Node</code>çš„ä¸¤ä¸ªå˜é‡éƒ½æ˜¯ç±»å‹<code>T</code>ï¼Œè€Œåˆå§‹åŒ–æ—¶ï¼Œç”±ç¬¬ä¸€ä¸ªå˜é‡ä¼ å…¥çš„<code>f32</code>ç»‘å®š<code>T = f32</code>ï¼Œè€Œç¬¬äºŒä¸ªå˜é‡åˆ™æ˜¯<code>i32</code>ï¼Œäº§ç”Ÿå†²çªï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>ï¼ˆ2ï¼‰<code>impl</code>éœ€è¦æœ‰<code>&lt;T&gt;</code>ï¼Œä¹Ÿå³ä¾‹å¦‚<code>impl&lt;T&gt; ... Link&lt;T&gt;</code></p>
<p>â€‹ ä½†æ˜¯äº‹æƒ…å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œä¸æ˜¯æ”¹å¥½äº†æ‰€æœ‰çš„æ¨¡æ¿å£°æ˜ä¸å®šä¹‰å°±èƒ½é€šè¿‡ç¼–è¯‘äº†ï¼ˆsadï¼‰ã€‚è¿™é‡Œå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ä¹‹å‰å®ç°äº†ä¸€ç‰ˆåŸºäº<code>clone</code>æ–¹æ³•çš„pushï¼Œé‚£ä¹ˆæƒ³è¦æ­£ç¡®åº”ç”¨<code>clone</code>ï¼Œéœ€è¦ <strong><u>ç±»å‹æ”¯æŒcloneæ–¹æ³•</u></strong>ã€‚è€ŒåŸæ¥ä½¿ç”¨çš„<code>i32</code>ï¼Œç”±äºæ˜¯åŸºæœ¬ç±»å‹ï¼Œåœ¨<code>Node</code>è¿›è¡Œcloneæ—¶ç›´æ¥æŒ‰å€¼ä¼ é€’ï¼Œæ— éœ€cloneï¼Œç°åœ¨ç”±äºæ˜¯æœªçŸ¥çš„ç±»å‹<code>T</code>ï¼Œç”±äºå…¶å¾ˆå¯èƒ½ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ•…ç›´æ¥ <code>elem: self.elem</code> é»˜è®¤å¼•å‘ moveã€‚</p>
<p>â€‹ æƒ³è¦é¿å…moveï¼Œç®€å•çš„æƒ³æ³•æ˜¯æˆ‘ç›´æ¥ <code>elem: self.elem.clone()</code>ã€‚èªæ˜å§ï¼Ÿä¸å¤ªèªæ˜ã€‚<code>self.elem</code>ä½œä¸ºç±»å‹<code>T</code>çš„å˜é‡ï¼Œéœ€è¦å®ç°<code>Clone</code>æ–¹æ³•ã€‚å¯¹äºç±»å‹<code>T</code>è€Œè¨€ï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆå®ç°å®ƒçš„<code>Clone</code>æ–¹æ³•ï¼ˆåªå­¦äº†ä¸¤å¤©ï¼Œå·¨èœçš„ï¼‰ï¼Œé‚£æˆ‘åªèƒ½é™åˆ¶ç±»å‹<code>T</code>åŒ…å«äº†<code>Clone</code>ç‰¹æ€§äº†ã€‚äºæ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">List</span>&lt;T&gt; <span class="keyword">where</span> T: <span class="built_in">Clone</span> &#123;head: Link&lt;T&gt;&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Link</span>&lt;T&gt; <span class="keyword">where</span> T: <span class="built_in">Clone</span> &#123;</span><br><span class="line">    Empty,</span><br><span class="line">    <span class="title function_ invoke__">More</span>(<span class="type">Box</span>&lt;Node&lt;T&gt;&gt;),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&lt;T&gt; <span class="keyword">where</span> T: <span class="built_in">Clone</span> &#123;</span><br><span class="line">    elem: T,</span><br><span class="line">    next: Link&lt;T&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­ï¼Œwhereé™åˆ¶äº†<code>T</code>éœ€è¦å­˜åœ¨çš„ç‰¹æ€§ï¼Œè¿™è¢«ç§°ä¸º<code>trait bound</code>ã€‚æ²¡æœ‰æ»¡è¶³å°±ä¼šæŠ¥é”™ï¼š<code>E0277: required by this bound in xxx</code> ã€‚å¯¹åº”åœ°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>impl</code>å—ä¸­ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨ç±»å‹<code>T</code>å·²ç»å®ç°äº†æŸä¸ªtraitï¼Œä¹Ÿå³<code>impl&lt;T: Clone&gt;</code>ã€‚</p>
<p>â€‹ è¿™æ ·è¿˜æ²¡å®Œï¼ä¹‹å‰å†™çš„å‡½æ•°è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼ŒçŒœçŒœæ”¹äº†ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: std::fmt::Display + <span class="built_in">Clone</span>&gt; List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">show_stack</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span>: &amp;Link&lt;T&gt; = &amp;<span class="keyword">self</span>.head;</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = ptr &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Stack: &#123;&#125;&quot;</span>, node.elem);</span><br><span class="line">            ptr = &amp;node.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ç­”æ¡ˆæ˜¯ï¼Œå°†<code>impl&lt;T: Clone&gt;</code>ä¿®æ”¹ä¸º<code>impl&lt;T: std::fmt::Display + Clone&gt;</code>ã€‚è¿™æ˜¯å› ä¸ºRustç¼–è¯‘å™¨è®¤ä¸ºï¼Œç±»å‹<code>T</code>æ˜¯ä»€ä¹ˆå•Šï¼Ÿæˆ‘æ€ä¹ˆdisplayå®ƒå•Šï¼Ÿä½ å®ç°äº†Displayæ–¹æ³•æ²¡ï¼Ÿæ˜¾ç„¶æˆ‘æ²¡æœ‰ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦æœ‰å¿…è¦åœ¨æ•´ä¸ªstackä¸­éƒ½æ·»åŠ æ­¤çº¦æŸå‘¢ï¼Ÿæ¯”å¦‚<code>pub struct List&lt;T&gt; where T Clone + std::fmt::Display</code>ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¯æœ‰å¯æ— ã€‚å¦‚æœä¸åŠ ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„è‡ªå®šä¹‰<code>T</code>è€Œè¨€ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨<code>show_stack</code>æ–¹æ³•äº†ã€‚ä¹Ÿå³ï¼Œ<code>impl</code>å—åœ¨æ­¤å¤„ï¼Œåªé™åˆ¶äº†å¯¹äºæ­¤æ–¹æ³•çš„è°ƒç”¨ã€‚æ²¡æœ‰å®ç°<code>std::fmt::Display</code>ç‰¹æ€§çš„ç±»å‹ï¼Œä¸è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±è¡Œäº†ï¼Œå…¶ä»–åŠŸèƒ½å¹¶ä¸å½±å“ã€‚P.S. æ³¨æ„å¤šé‡çº¦æŸçš„å†™æ³•æ˜¯åŠ å·ã€‚P.S.2ï¼Œä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘å¯èƒ½ä¼šè€ƒè™‘åˆ é™¤åŸºäºcloneçš„ç‰ˆæœ¬ï¼Œä½¿å¾—å¤æ‚ç±»å‹<code>T</code>ä¸ä¸€å®šéœ€è¦å®ç°<code>Clone</code>ç‰¹æ€§ã€‚P.S.3ï¼Œæ³¨æ„ï¼Œåœ¨typeç”¨æ³•ä¸­ï¼Œå¦‚æœtype aliasæ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»å‹ï¼Œåˆ™æ— éœ€å†™ç‰¹æ€§çº¦æŸï¼ˆå†™äº†ä¹Ÿä¼šè¢«ç¼–è¯‘å™¨å¿½ç•¥å¹¶ä¸”æŠ¥ä¸€ä¸ªwarningçš„ï¼‰ã€‚</p>
<h3 id="å…³äºæ‰€æœ‰æƒç§Ÿå€Ÿä»¥åŠmove">2.6 å…³äºæ‰€æœ‰æƒï¼Œç§Ÿå€Ÿä»¥åŠmove</h3>
<p>â€‹ æ˜¯æ—¶å€™å†™popäº†ã€‚popï¼Œå¾ˆæ˜¾ç„¶éœ€è¦è€ƒè™‘æ ˆæ˜¯å¦ç©ºã€‚ç”±äºæ ˆæ˜¯å¦ç©ºç”±enumçš„çŠ¶æ€è¡¨ç¤ºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨matchå³å¯ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸‹matchçš„è¯­æ³•ç³–ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">pop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = &amp;<span class="keyword">self</span>.head &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">pop_elem</span> = node.elem.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="keyword">self</span>.head = node.next;</span><br><span class="line">        <span class="keyword">return</span> pop_elem;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;Can not pop from an empty stack.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œæœ‰ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<p><span id="match_move"></span></p>
<p>ï¼ˆ1ï¼‰è¿›è¡Œmatchæ“ä½œæ—¶ï¼Œå¦‚æœç›´æ¥å†™<code>let Link::More(node) = self.head</code>ï¼Œä¼šå‘ç”Ÿmoveï¼ˆæ¯•ç«Ÿæœ‰letåœ¨è¿™é‡Œå˜›ï¼Œå¯ä»¥ç†è§£æˆnodeæ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„å˜é‡ï¼Œ<code>self.head</code>å°†å˜æ›´æ‰€æœ‰æƒï¼‰ã€‚æˆ‘ä»¬å¹¶ä¸å¸Œæœ›<code>self.head</code>ä¸§å¤±æ‰€æœ‰æƒï¼ˆè€Œè¢«é”€æ¯ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸€ä¸ªå¯å˜å¼•ç”¨æ¥ä½¿ç”¨self.headã€‚æ¶‰åŠåˆ°å¼•ç”¨çš„åœ°æ–¹æ˜¯ä¸å¯ä»¥å‘ç”Ÿmoveçš„ï¼Œå› ä¸ºå¼•ç”¨åªæ˜¯ç§Ÿå€Ÿäº†å˜é‡ï¼Œè·å¾—äº†ä¸´æ—¶çš„è®¿é—®æˆ–ä¿®æ”¹èƒ½åŠ›ï¼Œå°±åƒä½æˆ¿é—®é¢˜ï¼Œå…±äº«å¼•ç”¨ï¼ˆsharedï¼‰åªå¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸èƒ½ä¿®æ”¹ï¼ˆæ¯”å¦‚å¦‚æœé€‰æ‹©ä½é…’åº—ï¼Œå°±ä¸èƒ½éšæ„è£…ä¿®ï¼‰ï¼Œä¸ä¹‹ç›¸æ¯”ï¼Œå¯å˜å¼•ç”¨å°±åƒæ˜¯å¯¹æˆ¿å­çš„é•¿ç§Ÿï¼Œå¯ä»¥è¿›è¡Œè£…ä¿®ã€‚ä½†è¿™ä¸¤ç§å¼•ç”¨éƒ½ä¸æ”¹å˜åŸæˆ¿ä¸»å¯¹æˆ¿å±‹çš„æ‰€æœ‰æƒï¼Œæ­¤æ—¶å¦‚æœå‘ç”Ÿmoveï¼ˆæ‰€æœ‰æƒçš„è½¬è®©ï¼‰ï¼Œåˆ™æ˜¯åœ¨è¿›è¡Œè¿æ³•çŠ¯ç½ªæ´»åŠ¨ï¼ˆæ²¡æœ‰æ‰€æœ‰æƒçš„äººï¼Œè¦æŠŠå½“å‰æˆ¿å±‹çš„æ‰€æœ‰æƒè½¬ç§»ç»™åˆ«äººï¼‰ã€‚æ•…<code>self.head</code>ä¹‹å‰éœ€è¦å¢åŠ æ‰€æœ‰æƒå¼•ç”¨ã€‚</p>
<p>ï¼ˆ2ï¼‰ç”±äºå¢åŠ äº†å¼•ç”¨ï¼Œæ­¤å¤„çš„<code>node</code>ä¹Ÿæ˜¯åŸ<code>self.head</code>å®é™…æ•°æ®çš„å¼•ç”¨ï¼ˆ&amp;Box&lt;Node&lt;T&gt;&gt;ï¼‰ã€‚é‚£ä¹ˆè¿™å°±æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ<code>self.head</code>æ˜¯å€¼ï¼ˆvalueï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨<code>self.head.next</code> ï¼ˆå®é™…ä¸èƒ½è¿™æ ·è®¿é—®ï¼Œæˆ‘è¿™é‡Œåªåšä¸€ä¸ªç¤ºæ„ï¼‰æ¥é‡å†™<code>self.head</code>ã€‚ä½†<code>node</code>æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨<code>self.head = node.next</code>çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†<code>node</code>çš„nexté¡¹moveç»™<code>self.head</code>ï¼Œå¯¹å¼•ç”¨è¿›è¡Œçš„moveï¼Œæ˜¯ä¸è¢«å…è®¸çš„ã€‚æœä¸å…¶ç„¶ï¼Œæœ€åæŠ¥é”™äº†ã€‚</p>
<p>â€‹ æ­¤å¤„ä¾ç„¶å¯ä»¥ä½¿ç”¨<code>mem::replace</code>ã€‚æ³¨æ„<code>mem::replace</code>çš„æ€§è´¨ï¼š</p>
<blockquote>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">replace</span>&lt;T&gt;(dest: &amp;<span class="keyword">mut</span> T, src: T) <span class="punctuation">-&gt;</span> T</span><br></pre></td></tr></table></figure>
<p>Moves <code>src</code> into the referenced <code>dest</code>, returning the previous <code>dest</code> value.</p>
</blockquote>
<p>â€‹ replaceå°†ç›®çš„ä½ç½®ç”¨srcæ›¿æ¢ï¼Œå¹¶ä¸” <strong><u>æŒ‰å€¼</u></strong> è¿”å›destä½ç½®çš„å˜é‡ã€‚æ­£å¥½ï¼Œæˆ‘ä»¬éœ€è¦<code>self.head</code>æŒ‰å€¼è€ŒéæŒ‰å¼•ç”¨è¿”å›çš„ç»“æœã€‚è¿™æ ·è·å¾—çš„<code>node</code>å°±å¯ä»¥è¿›è¡Œmoveï¼ˆå› ä¸ºæŒ‰å€¼ä¼ é€’çš„<code>node</code>å…·æœ‰æ‰€æœ‰æƒï¼‰ã€‚åˆ™å¯ä»¥ç®€å•é‡å†™ç¬¬äºŒè¡Œï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.head, Link::Empty) &#123;...</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·å°±å¯ä»¥è¿‡ç¼–è¯‘äº†ã€‚P.Sï¼šå¦‚æœéœ€è¦å¯æ§çš„é”™è¯¯æ§åˆ¶ï¼Œå¯ä»¥è¿”å›<code>Option&lt;T&gt;</code>ï¼Œå½“Emptyæ—¶è¿”å›Noneï¼Œå°±ä¸ç”¨ä¸å¯æ¢å¤çš„panicå®äº†ã€‚</p>
<h3 id="dropç‰¹æ€§çš„å®ç°">2.7 Dropç‰¹æ€§çš„å®ç°</h3>
<p>â€‹ ç”±äºåŸæœ¬çš„stacké“¾è¡¨ï¼Œè‡ªåŠ¨ææ„è¿‡ç¨‹ä¸èƒ½è¿›è¡Œå°¾é€’å½’ä¼˜åŒ–ï¼Œä¸ºäº†é˜²æ­¢ææ„æ—¶çˆ†æ ˆï¼Œéœ€è¦æ‰‹åŠ¨ææ„ï¼Œä¹Ÿå³å®ç°Dropç‰¹æ€§ã€‚ç›´æ¥å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Clone</span> + <span class="built_in">Default</span>&gt; <span class="built_in">Drop</span> <span class="keyword">for</span> <span class="title class_">List</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span> = &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.head;</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(node) = mem::<span class="title function_ invoke__">replace</span>(ptr, Link::Empty)&#123;</span><br><span class="line">            ptr = &amp;<span class="keyword">mut</span> node.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ çœ‹èµ·æ¥å¥½åƒå¾ˆæœ‰é“ç†ï¼Ÿé¦–å…ˆï¼Œæˆ‘å°†ptræŒ‡å‘çš„æœ¬èŠ‚ç‚¹æ¢å‡ºï¼ˆåˆ°å€¼ï¼‰ï¼ŒåŒæ—¶ä½¿å¾—åŸå˜é‡ç½®ä¸ºEmptyï¼Œå†ä½¿å¾—ptræŒ‡å‘æ¢å‡ºåçš„å€¼å¯¹åº”çš„nextã€‚ä½†è¿™æ ·å†™æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæˆ‘è¿™æ ·å®ç°ï¼Œåˆ©ç”¨äº†ä¸€ä¸ªç‰¹æ€§ï¼šæˆ‘å°†ptræ¢å‡ºåˆ°å€¼ï¼Œæ­¤å€¼æ˜¯ä¸´æ—¶å˜é‡ï¼Œåœ¨ç»“æŸæœ¬æ¬¡å¾ªç¯ä¹‹åï¼Œä¼šææ„ï¼Œä¹Ÿå³æ­¤nodeæ— æ•ˆäº†ï¼Œå¹¶ä¸”åŸå˜é‡ä¹Ÿè®¾æˆäº†Emptyã€‚ä½†æˆ‘å¯¹node.nextè¿›è¡Œçš„å¼•ç”¨æ“ä½œï¼Œé˜»æ­¢äº†æˆ‘åˆ©ç”¨ä¸´æ—¶å˜é‡çŸ­ç”Ÿå‘½å‘¨æœŸçš„ç‰¹æ€§ï¼ŒptræŒ‡å‘çš„å†…å®¹å°†å¯èƒ½æ— æ•ˆã€‚æ•…è¿™æ ·å†™ä¼šè§¦å‘ç¼–è¯‘é”™è¯¯ã€‚</p>
<p>â€‹ æ­£ç¡®çš„å†™æ³•ä»ç„¶æ˜¯ï¼ŒæŒ‰å€¼ä¼ é€’ï¼šptråº”è¯¥ä¸€ç›´æ˜¯ä¸‹ä¸€ä¸ªnodeçš„å€¼ï¼Œå¯ä»¥å†™æˆï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Clone</span> + <span class="built_in">Default</span>&gt; <span class="built_in">Drop</span> <span class="keyword">for</span> <span class="title class_">List</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span> = mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.head, Link::Empty);</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Link</span>::<span class="title function_ invoke__">More</span>(<span class="keyword">mut</span> node) = ptr&#123;</span><br><span class="line">            ptr = mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node.next, Link::Empty);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·ï¼Œæ¯ä¸€ä¸ªnodeåŸæœ‰çš„å˜é‡éƒ½ä¼šç”±replaceæ–¹æ³•ï¼Œå°†æ‰€æœ‰æƒè½¬ç§»åˆ°pträ¸­ï¼ŒåŸå˜é‡å…¨éƒ¨ç½®ä¸ºEmptyã€‚æ³¨æ„ï¼Œç”±äºæ˜¯æŒ‰å€¼è½¬ç§»çš„ï¼Œç»™åŸå˜é‡èµ‹å€¼Emptyä¹Ÿå¹¶ä¸ä¼šå¦¨ç¢æˆ‘ä»¬åœ¨replaceåä½¿ç”¨ptrå–å‡ºå…¶ä¸­çš„nodeï¼Œå› ä¸ºæ‰€æœ‰æƒä»¥åŠå˜é‡çœŸæ­£çš„ä¿¡æ¯å·²ç»è½¬ç§»åˆ°äº†pträ¸­ã€‚å…¶ä¸­éœ€è¦æ³¨æ„çš„ä¸¤ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰nodeè¿™ç©æ„ï¼Œå¦‚æœä¸åŠ å‰é¢çš„mutï¼Œæ˜¯é”™çš„ã€‚å› ä¸ºè¿™é‡Œæˆ‘ä»¬å†™çš„æ˜¯<code>let &lt;variable&gt; = ...</code> è¿™æ ·çš„å¥å¼ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå˜é‡nodeï¼Œä½†æ˜¯æ²¡æœ‰å°†å…¶å®šä¹‰æˆå¯å˜çš„ã€‚å¯¹äºä¸å¯å˜å˜é‡ï¼Œä¸èƒ½ä½¿ç”¨å¯å˜å¼•ç”¨ï¼Œåœ¨ä¸‹ä¸€è¡Œçš„replaceå¤„ä¼šæŠ¥é”™ã€‚å¯¹<code>while let</code>å¥å¼ä¸­ï¼Œç­‰å·å‰é¢å˜é‡ï¼Œä¹Ÿéœ€è¦ç†è§£æˆæ˜¯ä¸€ä¸ªæ­£è§„çš„å˜é‡å®šä¹‰è¿‡ç¨‹ã€‚é‚£ä¹ˆæ­¤å¤„ï¼Œå°†<code>while let</code>å†™ä¸ºæ ‡å‡†çš„matchå½¢å¼ï¼Œä¹Ÿæœ‰åŒæ ·çš„æ“ä½œï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Clone</span> + <span class="built_in">Default</span>&gt; <span class="built_in">Drop</span> <span class="keyword">for</span> <span class="title class_">List</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span> = mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.head, Link::Empty);</span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="keyword">match</span> ptr &#123;</span><br><span class="line">                Link::<span class="title function_ invoke__">More</span>(<span class="keyword">mut</span> node) =&gt; &#123;</span><br><span class="line">                    ptr = mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node.next, Link::Empty);</span><br><span class="line">                &#125;,</span><br><span class="line">                Link::Empty =&gt; &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œloopä¸matchçš„é…åˆç”¨æ³•ï¼ˆåœ¨å¤šç±»å‹enumä¸‹ä½¿ç”¨çš„é€»è¾‘ï¼‰ã€‚åˆ™æ ¹æ®è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œmatchçš„è¿‡ç¨‹ä¸­å¯èƒ½å®šä¹‰æ–°çš„å˜é‡ï¼Œé‚£ä¹ˆæ­¤å˜é‡çš„æ€§è´¨å¯ä»¥æ ¹æ®æ‹¬å·å†…çš„å†…å®¹è¿›è¡Œç¡®å®šã€‚</p>
<p>ï¼ˆ2ï¼‰è¿˜æœ‰å¦ä¸€ç§å†™æ³•<code>while let Link::More(node) = &amp;mut ptr</code>ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¹Ÿå¯ä»¥è¿‡ç¼–è¯‘ï¼šè¿™æ ·å†™ï¼Œnodeæ˜¯ptrçš„ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ç»“æ„ä½“ä¸­çš„æŸä¸ªå€¼ï¼Œè‡ªç„¶å¯ä»¥å¯å˜å¼•ç”¨è‡ªè¿™ä¸ªç»“æ„ä½“çš„å¯å˜å¼•ç”¨äº†ã€‚æ­¤å¤„çš„å¼•ç”¨ä¸ä¼šå åŠ ï¼Œ<code>&amp;mut node.next</code>ä¸ä¼šç§°ä¸ºå¼•ç”¨çš„å¼•ç”¨ï¼ˆå› ä¸º<code>node.next</code>ä¸æ˜¯å¼•ç”¨ï¼Œ<code>node</code>æ‰æ˜¯ï¼‰ã€‚æ•…replaceåï¼Œå¯ä»¥æŠŠ<code>node,next</code>å¤„å¯¹åº”çš„å˜é‡æ‰€æœ‰æƒç§»åŠ¨åˆ°pträ¸­ï¼Œå˜é‡çš„ç±»å‹ï¼ˆptræ˜¯<code>Link&lt;T&gt;</code>ï¼‰ä¹Ÿå¯ä»¥å¯¹åº”replaceçš„ç»“æœã€‚</p>
<hr>
<h2 id="iii.-stack-with-option">III. Stack with Option</h2>
<h3 id="è½¬å‘option">3.1 è½¬å‘Option</h3>
<p>â€‹ ä¸éš¾å‘ç°ï¼Œå‰é¢çš„<code>enum Link</code>å°±æ˜¯ä¸€ä¸ªå¼±åŒ–ç‰ˆçš„Optionã€‚è‡³äºä¸ºä»€ä¹ˆæ˜¯å¼±åŒ–ç‰ˆçš„ï¼Œç­”æ¡ˆå¾ˆæ˜¾ç„¶ï¼ŒOptionä½œä¸ºä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„æ¨¡å—ï¼Œè‡ªç„¶æœ‰æ›´å¤šæ–¹ä¾¿ä½¿ç”¨çš„å‡½æ•°ã€‚å…¶ä¸­ä¸€ä¸ªå°±æ˜¯takeå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹takeå‡½æ•°çš„å®šä¹‰ï¼š</p>
<blockquote>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">take</span>&lt;T&gt;(dest: &amp;<span class="keyword">mut</span> T) <span class="punctuation">-&gt;</span> T </span><br></pre></td></tr></table></figure>
<p>Replaces <code>dest</code> with the default value of <code>T</code>, returning the previous <code>dest</code> value.</p>
</blockquote>
<p>â€‹ è¿™é‡Œæœ‰ä¸¤ç§å½¢å¼çš„takeï¼Œä¸€ä¸ªæ˜¯<code>std::mem::take</code>ï¼ˆå®˜æ–¹æ–‡æ¡£éå¸¸æ¸…æ™°ï¼‰ï¼Œå¦ä¸€ç§æ˜¯ï¼šå®ä¾‹åŒ–çš„Optionå¯ä»¥è°ƒç”¨çš„takeå‡½æ•°ã€‚ä¸¤è€…çš„åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡<code>mem::take</code>é’ˆå¯¹æ‰€æœ‰ç±»å‹ã€‚æŸ¥çœ‹Optionçš„å®˜æ–¹æ–‡æ¡£å¯ä»¥çŸ¥é“ï¼Œtakeè¿”å›Optionè‡ªèº«çš„åŒæ—¶ï¼Œå°†åŸå˜é‡è®¾ä¸ºNoneï¼Œç›¸å½“äºè¿›è¡Œæ‰€æœ‰æƒè½¬ç§»çš„å‡½æ•°ï¼Œç”¨æ­¤å‡½æ•°å¯ä»¥é¿å…moveã€‚è€Œå¯¹äº<code>mem::take</code>ï¼Œå®˜æ–¹æ–‡æ¡£ç»™äº†ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„ä¾‹å­ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Buffer</span>&lt;T&gt; &#123; buf: <span class="type">Vec</span>&lt;T&gt; &#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Buffer&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_and_reset</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="comment">// error: cannot move out of dereference of `&amp;mut`-pointer</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">buf</span> = <span class="keyword">self</span>.buf;</span><br><span class="line">        <span class="keyword">self</span>.buf = Vec::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        buf</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸Šé¢çš„errorè¯´çš„å°±æ˜¯ï¼šç”±äºå‡½æ•°ä¼ å…¥çš„æ˜¯selfçš„å¯å˜å¼•ç”¨ï¼Œä¸èƒ½è¢«moveï¼Œæ•…æŠ¥é”™ã€‚</p>
<p>â€‹ é‚£ä¹ˆï¼Œä½¿ç”¨takeå‡½æ•°ï¼Œå¯ä»¥ç®€åŒ–åŸæ¥ä½¿ç”¨<code>mem::replace</code>çš„ä½ç½®ï¼Œå¦‚dropå‡½æ•°ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Clone</span> + <span class="built_in">Default</span>&gt; <span class="built_in">Drop</span> <span class="keyword">for</span> <span class="title class_">List</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ptr</span> = <span class="keyword">self</span>.head.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">mut</span> node) = ptr&#123;</span><br><span class="line">            ptr = node.next.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ åªéœ€è¦è®°ä½ï¼Œptréœ€è¦æ¥å—æŒ‰å€¼ä¼ é€’çš„ç»“æœï¼Œè¿™æ ·ä¸ä¼šå¼•èµ·moveé—®é¢˜ã€‚æ­¤å¤–ï¼ŒOptionè¿˜å®ç°äº†ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼š<code>map</code>ä»¥åŠ<code>unwrap</code>ã€‚</p>
<p>â€‹ mapï¼Œæœ‰é‚£ä¹ˆä¸€äº›ç±»ä¼¼äºpythonä¸­çš„mapã€‚pythonä¸­çš„mapå¯ä»¥å°†ä¸€ä¸ªiteratorä¸­çš„æ‰€æœ‰å…ƒç´ é€šè¿‡æŸä¸ªå‡½æ•°è¿›è¡Œæ˜ å°„ã€‚è€Œæ­¤å¤„çš„mapï¼Œæ˜¯å°†Optionè¿›è¡Œå˜æ¢ã€‚å®˜æ–¹çš„å®šä¹‰æ˜¯ï¼šmapå¯ä»¥é€šè¿‡ä¼ å…¥çš„å‡½æ•°ï¼Œå°†<code>Option&lt;T&gt;</code>è½¬æ¢ä¸º<code>Option&lt;U&gt;</code>ï¼š</p>
<blockquote>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">map</span>&lt;U, F&gt;(<span class="keyword">self</span>, f: F) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;U&gt;</span><br></pre></td></tr></table></figure>
<p>Maps an <code>Option&lt;T&gt;</code> to <code>Option&lt;U&gt;</code> by applying a function to a contained value.</p>
</blockquote>
<p>â€‹ å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ã€‚å¯¹äº<code>Option&lt;String&gt;</code>ç±»å‹çš„å˜é‡æ¥è¯´ï¼ˆä¹Ÿå°±æ˜¯å¸¦æœ‰Noneé€‰é¡¹çš„Stringï¼‰ï¼Œç›´æ¥æ±‚<code>len()</code>æ˜¯éå¸¸ç¹ççš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¥½å‡ è¡ŒmatchæŒ‡ä»¤å—æˆ–è€…<code>if let</code>è¯­æ³•ç³–æ‰èƒ½å¾—åˆ°å…¶é•¿åº¦ã€‚è€Œå¯¹äºmapè€Œè¨€ï¼Œ<strong><u>ç”±äºä¼ å…¥çš„å‡½æ•°ï¼Œæ“ä½œçš„æ˜¯Tï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªT-&gt;Uçš„æ˜ å°„å‡½æ•°</u></strong>ï¼Œå¯ä»¥å¾ˆè½»æ¾åœ°è·å¾—å…¶é•¿åº¦ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = some_string.<span class="title function_ invoke__">map</span>(|s| &#123;s.<span class="title function_ invoke__">len</span>()&#125;);</span><br></pre></td></tr></table></figure>
<p>â€‹ é‚£ä¹ˆï¼Œmapçš„å˜ä½“æœ‰<code>map_or</code>ä»¥åŠ<code>map_or_else</code>ï¼Œæˆ‘è§‰å¾—æ¯”è¾ƒæœ‰ä»·å€¼çš„æ˜¯<code>map_or</code>ã€‚å…¶å®ä¸å…‰æ˜¯mapå‡½æ•°æœ‰<code>_or</code>ä»¥åŠ<code>_or_else</code>å®ç°ï¼Œå…¶ä»–ä¸€äº›å‡½æ•°ä¹Ÿæœ‰è¿™æ ·çš„å®ç°ï¼Œå¦‚ä¹‹åè¦è¯´çš„<code>unwrap</code>, <code>ok</code>ï¼Œ<code>or</code>æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚<code>map_or</code>çš„è¾“å…¥åˆ™æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">map_or</span>&lt;U, F&gt;(<span class="keyword">self</span>, default: U, f: F) <span class="punctuation">-&gt;</span> U</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå³éœ€è¦æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚ä¹Ÿå³å½“ç»“æœä¸ºNoneæ—¶ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„ç»“æœã€‚<code>map_or_else</code>åˆ™æ˜¯ï¼Œä¼ å…¥ä¸¤ä¸ªå‡½æ•°ï¼Œå¦‚æœå½“å‰å€¼éNoneï¼Œåˆ™æ‰§è¡Œç¬¬äºŒä¸ªå‡½æ•°ï¼ˆfï¼‰ï¼Œå¦åˆ™æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>â€‹ è€Œunwrapï¼Œæ ¹æ®å…¶åå­—ç†è§£ï¼Œä¹Ÿå³è§£åŒ…ã€‚æ˜¾ç„¶ï¼Œåœ¨Optionä¸­ï¼Œæˆ‘ä»¬å°†æœ‰æ„ä¹‰çš„å€¼åŒ…åœ¨äº†Someä¸­ï¼Œä½†é€šå¸¸æˆ‘ä»¬å¯èƒ½éœ€è¦å†…éƒ¨çš„å€¼ã€‚ä½¿ç”¨matchå—åŒæ ·å¤ªè¿‡å¤æ‚ï¼Œæˆ‘ä»¬è€ƒè™‘ç”¨unwrapï¼Œè¿™ä¸ªå‡½æ•°å®é™…å°±æ˜¯ä¸€ä¸ª<code>Option&lt;T&gt;</code>åˆ°Tçš„æ˜ å°„ã€‚åŒæ ·åœ°ï¼Œå…¶<code>_or</code>ä»¥åŠ<code>_or_else</code>æ–¹æ³•ï¼Œéƒ½æœ‰ç±»ä¼¼çš„mapå¯¹åº”å‡½æ•°çš„å‡½æ•°æ€æƒ³ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>unwrap_or_else</code>ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Returns the contained <a href="https://doc.rust-lang.org/std/option/enum.Option.html#variant.Some"><code>Some</code></a> value or computes it from a <strong><u>closure</u></strong>.</p>
</blockquote>
<p>â€‹ é—­åŒ…ï¼Ÿè¿™é‡Œè¯´çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬ä¼ é€’çš„åŒ¿åå‡½æ•°ï¼Œå†™æ³•å°±æ˜¯<code>|Someçš„å†…éƒ¨å˜é‡| &#123;æœ‰è¿”å›å€¼çš„å‡½æ•°ä½“&#125;</code>ã€‚æ­¤å‡½æ•°ä¸C++çš„åŒ¿åå‡½æ•°å¾ˆåƒï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨æ•è·å˜é‡ï¼ˆæ•è·çš„å˜é‡ä¹Ÿä¸€æ ·æ— éœ€å†™åœ¨<code>|Â·|</code>ï¼ˆæˆ–C++ä¸­<code>[Â·]</code>ï¼‰ä¸­ï¼‰ï¼Œç”¨åœ¨å‡½æ•°ä½“ä¸­è¿›è¡Œè®¡ç®—ã€‚</p>
<p>â€‹ çŸ¥é“<code>map</code>çš„å·¥ä½œåŸç†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç«‹åˆ»ç”¨mapè¿›è¡Œä¸€äº›ç¨‹åºæ”¹å†™ã€‚æ¯”å¦‚stackä¸­çš„popï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¿®æ”¹headçš„åŒæ—¶ï¼Œå¯ä»¥è¿”å›åŸheadå¯¹åº”nodeçš„å€¼ã€‚åˆ™å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œä¹¦å†™ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">pop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">        <span class="keyword">self</span>.head.<span class="title function_ invoke__">take</span>().<span class="title function_ invoke__">map</span>(|node &#123;</span><br><span class="line">            	<span class="keyword">self</span>.head = node.next;</span><br><span class="line">            	node.elem</span><br><span class="line">            &#125;).<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ­¤å¤„çš„é€»è¾‘å¾ˆç®€å•ï¼šé¦–å…ˆtake()å°†<code>self.head</code>ç½®Noneï¼Œå¹¶ä¸”è¿”å›å®é™…å­˜å‚¨çš„Some(node)ï¼ŒSome(node)è¿›å…¥mapä¸­çš„å‡½æ•°è¢«å¤„ç†ï¼Œå–å‡ºå…¶ä¸­çš„nodeï¼ˆæŒ‰å€¼ï¼‰ï¼Œé‡æ–°è¦†ç›–<code>self.head</code>ï¼ˆnodeå˜é‡å†…éƒ¨å€¼çš„moveï¼‰ï¼ŒæŒ‰å€¼è¿”å›nodeçš„elemåŸŸã€‚ä½†æ³¨æ„å¦‚æœæ²¡æœ‰<code>.unwrap()</code>ï¼Œå¦‚ä¸Šè¿”å›çš„Some(T)æˆ–è€…Noneï¼Œå¦‚æœè¦è¿”å›çœŸæ­£çš„<code>T</code>ç±»å‹å€¼ï¼Œåˆ™éœ€è¦åŠ ä¸Š<code>unwrap</code>ï¼Œä½†è¿™ä¸æ˜¯å¾ˆå±é™©ï¼Œå½“stackä¸ºemptyæ—¶ï¼Œä¹Ÿä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆï¼ˆæˆ‘ä»¬åˆ å»äº†emptyå¤„ç†ï¼‰ã€‚</p>
<h3 id="as_ref-as_mut-as_deref">3.2 as_ref | as_mut | as_deref</h3>
<p>â€‹ ä¹‹å‰æˆ‘æƒ³å®ç°ä¸€ä¸ªtopå‡½æ•°ï¼Œä¸è¿‡æ­¤topå‡½æ•°æ˜¯è¿”å›å€¼çš„å‡½æ•°ï¼Œè€Œå®˜æ–¹æ•™ç¨‹åˆ™è¯´ï¼šæˆ‘ä»¬åº”è¯¥å®ç°ä¸€ä¸ªè¿”å›å¼•ç”¨çš„topï¼ˆæ•™ç¨‹å«åšpeekï¼‰ã€‚å¼€å§‹æˆ‘è§‰å¾—è¿™å¥½åƒä¹Ÿä¸æ˜¯ä»€ä¹ˆéš¾äº‹å§ï¼Ÿäºæ˜¯æˆ‘å†™äº†ä¸€æ³¢ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">top</span>(&amp; <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">    <span class="keyword">self</span>.head.<span class="title function_ invoke__">map</span>(|node|&#123;</span><br><span class="line">        &amp;node.elem</span><br><span class="line">    &#125;).<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ç»“æœç›´æ¥æŠ¥é”™äº†ï¼Œé”™è¯¯ä¿¡æ¯ï¼š</p>
<blockquote>
<p>&amp;node.elem returns a reference to data owned by the current function</p>
<p>self.head.map(|node|{... move occurs because <code>self.head</code> has type <code>Option&lt;Box&lt;second::Node&lt;T&gt;&gt;&gt;</code>, which does not implement the <code>Copy</code> trait</p>
</blockquote>
<p>â€‹ æˆ‘çš„ç†è§£æ˜¯ï¼Œself.head.mapç”±äºå®é™…æ˜¯matchæ–¹æ³•çš„ä¸€ç§ç®€åŒ–å½¢å¼ï¼Œé‚£ä¹ˆæ ¹æ®matchå€¾å‘äºmoveå€¼è¿™ä¸ªç‰¹æ€§ï¼Œself.headè¢«éšå¼moveäº†ã€‚è¿™æ ·ä¼šå¯¼è‡´é”™è¯¯ã€‚è€Œä¸åŸå…ˆä¸åŒï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨take()å‡½æ•°ï¼ˆtakeä¼šä½¿å¾—åŸæ¥çš„self.headè¢«è®¾ä¸ºNoneï¼ŒåŒæ ·ä¸€æ¬¡takeçš„ç»“æœä¹Ÿä¸èƒ½è¢«moveåˆ°å¤šä¸ªå˜é‡ä¸­ï¼‰ã€‚æ•™ç¨‹ä¸Šæ¨èä½¿ç”¨<code>as_ref</code>æ–¹æ³•ï¼Œäºæ˜¯æˆ‘åœ¨å®˜æ–¹æ–‡æ¡£ä¸ŠæŸ¥äº†ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚çœ‹åˆ°è¿™ä¸ªå‡½æ•°ä¸­çš„å…¶ä¸­ä¸€å¥è¯ï¼Œæˆ‘ç»ˆäºé€å½»åœ°ç†è§£äº†æ–‡æ¡£ä¸­çš„ä¸¤å¥è¯çš„æ„ä¹‰ï¼š</p>
<ul>
<li>"Consume the original" è¡¨ç¤ºåŸå˜é‡å°†è¢«é”€æ¯ï¼ˆè¢«moveï¼Œæ‰€æœ‰æƒä¸§å¤±ï¼‰</li>
<li>"Preserving the original" è¡¨ç¤ºä¿ç•™åŸå˜é‡</li>
</ul>
<p>â€‹ ä½†æ˜¯<code>as_ref</code>æ–‡æ¡£ä¸­æ‰€è¯´çš„ï¼š"Converts from <code>&amp;Option&lt;T&gt;</code> to <code>Option&lt;&amp;T&gt;</code>." å…·ä½“è¡¨ç¤ºä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¼•ç”¨ç¬¦å·åœ¨å†…éƒ¨å¤–éƒ¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œä»ç„¶ä»¥stackä¸­çš„å†…å®¹ä¸ºä¾‹å­ã€‚stackçš„Linkï¼Œå…¶ç±»å‹æ˜¯<code>Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code>ã€‚é‚£ä¹ˆä¸Šé¢è¿™å¥è¯çš„æ„æ€å°±æ˜¯å°†<code>&amp;...</code> è½¬åŒ–ä¸º<code>Option&lt;&amp; Box&lt;Node&lt;T&gt;&gt;&gt;</code>ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹mapçš„æ€§è´¨ã€‚æˆ‘ä»¬åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­å†™çš„æ˜¯<code>&amp; self</code>ï¼Œè¿™å°±å¯¼è‡´äº†<code>self.head.map</code>æ— æ³•è¿›è¡Œï¼Œè¿™æ˜¯å› ä¸ºï¼Œç”±äºmapå…·æœ‰ç±»ä¼¼matchçš„å±æ€§ï¼Œä¼šå¯¼è‡´<code>self.head</code>å‘ç”Ÿmoveï¼ˆåˆ°æ–°äº§ç”Ÿçš„å˜é‡<code>node</code>ä¸­ï¼Œå¦‚æœè¿˜ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œè¯·å‚è€ƒ<a href="#match_move">æœ¬åšå®¢çš„è¿™é‡Œ</a>ï¼‰ï¼Œå¼•ç”¨å†…éƒ¨æ˜¯ä¸å…è®¸å‘ç”Ÿmoveçš„ï¼Œæ•…æŠ¥é”™ã€‚è€Œ<code>take</code>åˆ™å°†å†…éƒ¨çš„Nodeå–äº†å‡ºæ¥ï¼Œä½†æ˜¯æ˜¯æŒ‰å€¼å–çš„ï¼ŒåŸæ¥çš„<code>head</code>å†…å®¹å˜æˆäº†Noneï¼Œå¹¶ä¸”éš¾ä»¥æ¢å¤ã€‚æ•…è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›ä»¥ä¸€ç§ä¸ç ´ååŸæ¥çš„<code>self.head</code>çš„æ–¹å¼ï¼Œè¿”å›ä¸€ä¸ªå¯¹<code>self.head</code>ä¸­nodeçš„å¼•ç”¨ã€‚æ³¨æ„åˆ°ï¼šç”±äºå‚æ•°åˆ—è¡¨ä¸­<code>&amp;self</code>çš„å­˜åœ¨ï¼Œè¿™é‡Œçš„<code>self.head</code>å®é™…ä¸Š <strong>å°±æ˜¯<code>&amp;Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code></strong>ã€‚</p>
<p>â€‹ å¦‚æœå°†å…¶è½¬åŒ–æˆ<code>Option &lt;&amp;Box&lt;Node&lt;T&gt;&gt;&gt;</code>ï¼Œé‚£ä¹ˆmapå¾—åˆ°çš„ç»“æœnodeï¼Œå°±æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆ<code>&amp;Node&lt;T&gt;</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç æ¥ç¡®å®šï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">top_node</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;Node&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.head.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">map</span>(|node|&#123;</span><br><span class="line">            node</span><br><span class="line">        &#125;).<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼Œç”±äºä»¥ä¸Šä»£ç åªæ˜¯æµ‹è¯•ä½¿ç”¨ï¼Œæˆ‘æ²¡æœ‰å®šä¹‰æˆpublicå‡½æ•°ï¼ˆäº‹å®ä¸Šï¼Œå®šä¹‰æˆpublicå‡½æ•°ä¼šæŠ¥é”™ï¼ŒNodeæ˜¯ä¸€ä¸ªç§æœ‰ç±»å‹ï¼Œè¢«æ”¾åœ¨äº†å…¬å…±åŒºåŸŸï¼Œprivate type leaké”™è¯¯ï¼‰ã€‚è¿™æ®µä»£ç æ˜¯å¯ä»¥è¿‡ç¼–è¯‘çš„ï¼ˆæ”¾åœ¨å¯¹åº”çš„<code>impl</code>å—ä¸­ï¼‰ã€‚åˆ™è¯´æ˜ï¼Œnodeæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚æ•…ä¸å‘ç”Ÿmoveï¼Œ<code>self.head</code>è¢«æˆåŠŸä¿å­˜ä¸‹æ¥äº†ã€‚å¤ªå¥½äº†ï¼Œæˆ‘ä»¬åˆèµ¢å•¦ï¼é‚£ä¹ˆï¼Œæœ€åå¦‚æœè¦è¿”å›<code>&amp;node.elem</code>ï¼Œåªéœ€è¦åœ¨<code>self.head</code>ä¹‹åï¼ŒåŠ ä¸Š<code>.as_ref()</code>å³å¯ã€‚</p>
<p>â€‹ é‚£ä¹ˆä½™ä¸‹çš„ä¸¤ä¸ªå‡½æ•°ï¼Œæ ¹æ®åˆ†æ<code>as_ref</code>æ—¶çš„ç»éªŒï¼Œç†è§£èµ·æ¥åº”è¯¥ä¼šå®¹æ˜“å¾ˆå¤šï¼š</p>
<ul>
<li><code>as_mut</code>: Converts from <code>&amp;mut Option&lt;T&gt;</code> to <code>Option&lt;&amp;mut T&gt;</code>. ä¹Ÿå³ï¼Œå½“ç»“æ„ä½“æˆå‘˜å‡½æ•°ä½¿ç”¨<code>&amp;mut self</code>è¾“å…¥æ—¶ï¼Œ<code>as_mut</code>åæ¥çš„<code>map</code>å°†å¯ä»¥è¾“å‡ºnodeçš„å¯å˜å¼•ç”¨</li>
<li><code>as_deref</code>: æˆ‘é”™äº†ï¼Œæˆ‘æš‚æ—¶ä¸æƒ³å»é€’å½’derefä»¥åŠ<code>Deref::Target</code>æ˜¯ä¸ªä»€ä¹ˆç©æ„ã€‚</li>
</ul>
<p>â€‹ è¿™é‡Œæˆ‘æƒ³å†æŒ‰ç…§è‡ªå·±çš„ç†è§£ï¼Œè§£è¯»ä¸€ä¸‹å®˜æ–¹æ•™ç¨‹çš„ä¾‹å­ã€‚å®˜æ–¹æ•™ç¨‹æƒ³é€šè¿‡è‡ªå®šä¹‰çš„<code>peek_mut</code>ä¿®æ”¹æ ˆé¡¶æ•°æ®ï¼Œä½†æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">list.<span class="title function_ invoke__">peek_mut</span>().<span class="title function_ invoke__">map</span>(|&amp;<span class="keyword">mut</span> value| &#123;</span><br><span class="line">    value = <span class="number">42</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ ·å†™æ˜¯æ˜¾ç„¶ä¸å¯ä»¥çš„ã€‚é¦–å…ˆï¼Œ<code>peek_mut</code>å°±å¦‚æˆ‘ä»¬çš„<code>top_node_mut</code>ä¸€æ ·ï¼Œè¿”å›çš„æ˜¯<code>&amp;mut T</code> ï¼ˆå®˜æ–¹æ•™ç¨‹åˆ™æ˜¯è¿”å›<code>Option&lt;&amp;mut T&gt;</code>ï¼‰ï¼Œåœ¨mapä¹‹åï¼Œå°†æˆä¸º<code>&amp;mut T</code>ï¼Œä¹Ÿå³ï¼Œvalueæœ¬èº«å°±æ˜¯ä¸€ä¸ªmutable referenceï¼Œé‚£ä¹ˆæ­¤ä¾‹å­ä¸­ï¼Œå¯¹äºä¸€ä¸ªmutable referenceï¼Œå†è¿›è¡Œå¼•ç”¨ï¼Œæˆäº†mutable referenceçš„mutable referenceï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿé¦–å…ˆï¼Œmutable referenceå˜é‡valueï¼Œåªæ˜¯è¯´ <strong><u>å…¶æŒ‡å‘çš„å†…å®¹æ˜¯å¯å˜çš„</u></strong>ï¼Œä½†å¹¶æ²¡æœ‰å£°æ˜ï¼Œvalueæœ¬èº«å¯ä»¥å˜ï¼ˆä¹Ÿå³valueä¸å¯ä»¥æ”¹å˜æŒ‡å‘ï¼Œä½†æ˜¯èƒ½æ”¹å˜æŒ‡å‘çš„å†…å®¹ï¼‰ï¼Œåªæœ‰valueæœ¬èº«æœ‰mutå±æ€§ï¼Œæ‰èƒ½å®‰å…¨åœ°å¯¹valueè¿›è¡Œmutable referenceã€‚è¿™é‡Œæ˜¾ç„¶æ²¡æœ‰è¿™æ ·çš„æ¡ä»¶ï¼Œå¹¶ä¸”å³ä½¿æŒ‚ä¸Šäº†è¿™ä¸ªå¼•ç”¨ï¼Œæœ€åä¿®æ”¹çš„ä¹Ÿæ˜¯valueå€¼ï¼Œè€Œä¸æ˜¯valueæŒ‡å‘çš„å€¼ã€‚</p>
<hr>
<h2 id="rust-å…¶ä»–todoé¡¹">Rust å…¶ä»–TODOé¡¹</h2>
<ul>
<li>å€¼å¾—ä¸€è®°ï¼Œå›å¤´ææ¸…æ¥šåŸç†ï¼ˆä¸»è¦æ˜¯dynå…³é”®è¯ç”¨æ³•ï¼‰ï¼šä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼ˆcallbackç±»å†™æ³•ï¼‰</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">sort_test</span>(&amp; bubble_sort);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">sort_test</span>(sort_func: &amp;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>(&amp;<span class="keyword">mut</span> [<span class="type">i32</span>])) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">arr</span> = [<span class="number">7</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">    <span class="title function_ invoke__">sort_func</span>(&amp;<span class="keyword">mut</span> arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">bubble_sort</span>(arr: &amp;<span class="keyword">mut</span> [<span class="type">i32</span>]) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Vec</code> åˆ‡ç‰‡çš„<code>to_vec</code>å‡½æ•°ä¸åˆ‡ç‰‡ç±»å‹ï¼ˆåˆ‡ç‰‡è½¬æ•°ç»„æˆ–å…¶ä»–æ•°æ®ç±»å‹æ—¶çš„overheadï¼‰
<ul>
<li><code>Vec</code>åˆ‡ç‰‡ä¹‹åä¼šå˜æˆ <code>&amp;[type]</code>ï¼Ÿæ¯”å¦‚<code>&amp;vec[3..9]</code> å®é™…ä¸Šæ˜¯<code>&amp; [i32]</code>?</li>
</ul></li>
<li><code>cargo new --lib &lt;name&gt;</code> çš„ <code>lib</code>å…·ä½“èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ</li>
<li><code>Box</code> è¯´æ˜¯å †çš„æŒ‡é’ˆï¼Ÿå…¶ä½œç”¨ç±»ä¼¼äºCä¸­åŠ¨æ€åˆ†é…å†…å­˜çš„ç»“æ„?</li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustå­¦ä¹  II</title>
    <url>/2022/05/03/Rust%E5%AD%A6%E4%B9%A0-II/</url>
    <content><![CDATA[<h1 id="rust---ii">Rust - II</h1>
<hr>
<h2 id="i.-intro">I. Intro</h2>
<p>â€‹ å˜é‡çš„lifetimeä¹‹å‰çš„éƒ¨åˆ†ï¼Œç†è§£èµ·æ¥éƒ½æ¯”è¾ƒç®€å•ã€‚è€Œä¸€åˆ°lifetimeå‡ºåœºï¼Œä¸€ç¾¤å¦–é­”é¬¼æ€ªä¹Ÿå°±è·Ÿç€å‡ºåœºäº†ã€‚ä¸è¿‡å…¶å®æ˜¯å› ä¸ºä¹‹å‰çš„ä¸¤å¤©å­¦ä¹ ä¸­ï¼Œå¯¹äºå˜é‡çš„å¼•ç”¨ï¼Œæ‰€æœ‰æƒçš„ç§Ÿå€Ÿç†è§£ä¸å¤Ÿåˆ°ä½ã€‚æœ¬æ–‡ä»ç„¶æ˜¯åœ¨è·Ÿç€Rustå®˜æ–¹ï¼ˆçš„éå®˜æ–¹ï¼Œå®ƒè‡ªå·±å†™çš„ï¼‰æ•™ç¨‹å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæ•´æ´»æ‰©å±•çš„ä¸€äº›è®°å½•ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-ä½¿å¾—stackæ›´å¼º">II. ä½¿å¾—stackæ›´å¼º</h2>
<h3 id="è¿­ä»£å™¨çš„æ„é€ ">2.1 è¿­ä»£å™¨çš„æ„é€ </h3>
<p>â€‹ åœ¨ä¹‹å‰çš„å®è·µä¸­ï¼Œä¸ºäº†æŸ¥çœ‹æˆ‘çš„stackæ˜¯å¦æ­£ç¡®ï¼Œæˆ‘ä½¿ç”¨matchè¯­æ³•ç³–å†™äº†ä¸€ä¸ªç®€å•çš„éå†æ–¹æ³•ã€‚ä½†è¿™ç§éå†æ–¹æ³•ä¸å¤Ÿå¼ºï¼Œå®ƒæ— æ³•ä½¿å¾—æˆ‘å¯ä»¥ç›´æ¥ä½¿ç”¨forå¾ªç¯éå†æ­¤stackã€‚å¦‚æœè¦ç›´æ¥forå¾ªç¯éå†ï¼Œæ­£å¦‚C++ä¸­ä¸€æ ·ï¼Œéœ€è¦é‡æ„ï¼ˆæˆ–è€…å®ç°ï¼‰iteratorç›¸å…³æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç»<code>IntoIter</code>ï¼Œ<code>Iter</code>ä¸<code>IterMut</code></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">IntoIter</span>&lt;T&gt;(List&lt;T&gt;) <span class="keyword">where</span> T: <span class="built_in">Default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">into_iter</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> IntoIter&lt;T&gt; &#123;</span><br><span class="line">        <span class="title function_ invoke__">IntoIter</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">IntoIter</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = T;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">pop</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œiteratorè¿™ç©æ„å°±åƒC++ä¸­çš„è¿­ä»£å™¨ä¸€æ ·ï¼Œä¸åŸç±»å‹æ˜¯ä¸åŒçš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸ªå«åš<code>IntoIter</code>çš„æ¨¡å—ã€‚å®é™…ä¸Šè¿™å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸æ˜¯<code>List&lt;T&gt;</code>æœ¬èº«æœ‰è¿­ä»£å™¨ï¼Œè€Œæ˜¯å…¶åœ¨æ‰§è¡Œ<code>into_iter</code>å‡½æ•°ä¹‹åï¼Œè¿”å›çš„è¿­ä»£å™¨å¯ä»¥è¿›è¡Œè¿­ä»£ã€‚é‚£ä¹ˆï¼Œä»¥ä¸Šä»£ç çš„ä¸‰ä¸ªå—ï¼Œåˆ†åˆ«ä»£è¡¨äº†ï¼šå®šä¹‰éœ€è¦è¿”å›çš„è¿­ä»£å™¨ç±»å‹ï¼ˆ<code>IntoIter</code>ï¼‰ï¼Œç»™<code>List</code>å®ç°è¿”å›è¿­ä»£å™¨çš„æ“ä½œï¼Œå®é™…å®ç°è¿­ä»£å™¨çš„å†…éƒ¨åŠŸèƒ½<code>next</code></li>
<li><code>self.0</code>æ˜¯ä»€ä¹ˆç©æ„ï¼Ÿæ³¨æ„åˆ°ï¼Œæ­¤structåªæœ‰ä¸€ä¸ªåŸŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªtuple structï¼ˆå†…éƒ¨çš„å˜é‡æ²¡æœ‰åå­—ï¼‰ï¼Œé‚£ä¹ˆä»–ä»¬çš„åŸŸå¯ä»¥æŒ‰ç…§<code>self.k</code>æ¥ä¾é¡ºåºè®¿é—®ã€‚æ­¤å¤–ï¼Œç”±äºè¿™é‡Œè°ƒç”¨äº†popï¼Œå¹¶ä¸”æˆ‘ä»¬å‘ç°ï¼Œè¿”å›å€¼æ˜¯<code>Option&lt;T&gt;</code>ï¼Œä¸éš¾å‘ç°æ­¤è¿­ä»£å™¨ä¼šé€æ­¥é”€æ¯åŸ<code>List</code>ã€‚åœ¨æ‰§è¡Œ<code>into_iter</code>æ“ä½œä¹‹åï¼ŒåŸå˜é‡ï¼ˆstackæœ¬ä½“ï¼‰åº”è¯¥ä¸§å¤±äº†æ‰€æœ‰æƒï¼Œè½¬ç§»åˆ°ä¸€ä¸ª<code>IntoIter</code>å˜é‡ä¸­ã€‚æˆ‘ä»¬è¦æ±‚åŸstackæ˜¯mutableçš„ï¼ˆä¸æ˜¯mutableä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼Œå…¨åŸŸé™æ­¢ç®¡ç†çš„stackæ˜¯å§ï¼‰ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œpopã€‚</li>
</ul>
<p>â€‹ æ€ä¹ˆè¯´å‘¢ï¼Œæ­¤å®ç°éœ€è¦éå¸¸éµå®ˆå›ºå®šç¨‹å¼ï¼Œæ•…ä¹Ÿæ²¡æœ‰ç»™æˆ‘æ•´æ´»ç•™ä¸‹å¤ªå¤§çš„ç©ºé—´ã€‚</p>
<p>â€‹ ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘å¹¶ä¸æƒ³ä½¿å¾—åŸæ¥çš„stackè¢«é”€æ¯ï¼Œæˆ‘åªæƒ³è¿­ä»£ä¸€ä¸‹ï¼Œè¾“å‡ºçœ‹çœ‹ã€‚åˆ™æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªè¿”å›å¼•ç”¨çš„iteratorï¼Œä¹Ÿå³æˆ‘å¸Œæœ›å†…éƒ¨çš„æ‰€æœ‰é€»è¾‘éƒ½æ˜¯å¼•ç”¨ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Iter</span>&lt;T&gt; <span class="keyword">where</span> T: <span class="built_in">Default</span> &#123;</span><br><span class="line">	this: &amp;Link&lt;T&gt;				<span class="comment">// thisçš„typeä¸stack.headä¸€è‡´ï¼Œè®°å½•æ­¤thisï¼Œæ‰èƒ½åœ¨æ¯ä¸€æ¬¡nextæ—¶çŸ¥é“ä¸‹ä¸€æ¬¡nextåº”è¯¥ä»ä½•å¤„å¼€å§‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; List&lt;T&gt; &#123;			<span class="comment">// è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„è¿­ä»£å™¨</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">iter</span>(&amp; <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Iter</span>(&amp; <span class="keyword">self</span>.head)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">Iter</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = &amp;T;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;		<span class="comment">// æ³¨æ„ï¼Œä¸ºä»€ä¹ˆéœ€è¦&amp;mut å‘¢ï¼Ÿæ¯ä¸€æ¬¡nextï¼Œæˆ‘ä»¬éƒ½è¦ä¿®æ”¹Iterçš„thisæŒ‡å‘ï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ªï¼‰</span></span><br><span class="line">        <span class="keyword">self</span>.this.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">map</span>(|node|&#123;</span><br><span class="line">            <span class="keyword">self</span>.this = &amp;node.next;</span><br><span class="line">            &amp;node.elem</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ é€»è¾‘çœ‹èµ·æ¥å¾ˆæ­£ç¡®ï¼Œå¯¹å§ï¼Ÿçœ‹äº†ä¸€çœ¼å®˜æ–¹æ•™ç¨‹ï¼Œå¾ˆä¸ä¸€æ ·ã€‚ã€‚ã€‚ä½†æ˜¯æ²¡å…³ç³»ï¼è¦æœ‰è‡ªä¿¡ã€‚ç»“æœä¸€ç¼–è¯‘å°±çˆ†ç‚¸äº†ï¼Œæ— å¥ˆç…äº†ä¸€çœ¼å®˜æ–¹æ•™ç¨‹ï¼Œç»“æœå‘ç°å®ƒä¹Ÿçˆ†ç‚¸äº†ã€‚å¯ä»¥çš„ï¼Œæˆ‘ä»¬éƒ½ç‚¸åœ¨äº† <strong><u>lifetime</u></strong> è¿™ç©æ„ä¸Šã€‚</p>
<h2 id="impotant-lifetime">2.2 Impotant: Lifetime</h2>
<p>â€‹ äººçš„ä¸€ç”Ÿå•Šï¼ˆlifetimeï¼‰ï¼Œä»–è‡ªå·±å°±ä¸çŸ¥é“ã€‚ä¸€ä¸ªäººçš„å‰é€”å‘½è¿å•Šï¼Œå½“ç„¶è¦é è‡ªæˆ‘å¥‹æ–—ã€‚å•ŠåŒæ—¶è¿˜è¦è€ƒè™‘åˆ°å†å²çš„è¿›ç¨‹ã€‚æˆ‘å½“å¹´åœ¨ä¸Šæµ·å½“...ï¼ˆå†…å®¹å¿«æ¶‰å«Œè¿è§„äº†ï¼‰ã€‚lifetimeï¼Œå…¶å®æ˜¯æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„æ¦‚å¿µï¼Œå°±æ˜¯å˜é‡çš„ç”Ÿå­˜å‘¨æœŸå˜›ã€‚ä½†æ˜¯ä¸ç®¡æ˜¯Cã€C++è¿˜æ˜¯Pythonï¼Œéƒ½å·²ç»æŠŠç”Ÿå­˜å‘¨æœŸç®¡ç†çš„äº‹ç»™åšäº†ï¼Œæˆ‘ä»¬å…¶å®å¾ˆéš¾æ¥è§¦åˆ°ç”Ÿå­˜å‘¨æœŸçš„é—®é¢˜ï¼ˆé™¤äº†C++ä¸­ï¼Œæœ€å¥½ä¸è¦è¿”å›å‡½æ•°ä¸­ä¸´æ—¶å˜é‡çš„å¼•ç”¨æˆ–æŒ‡é’ˆè¿™æ ·çš„ä¾‹å­å¤–ï¼‰ã€‚æ­£å¦‚å®˜æ–¹æ•™ç¨‹æ‰€è¯´ï¼š</p>
<blockquote>
<p>Lifetimes are unnecessary in garbage collected languages because the garbage collector ensures that everything magically lives as long as it needs to. Most data in Rust is <em>manually</em> managed, so that data needs another solution. C and C++ give us a clear example what happens if you just let people take pointers to random data on the stack: pervasive unmanageable unsafety. This can be roughly separated into two classes of error:</p>
<ul>
<li>Holding a pointer to something that went out of scope</li>
<li>Holding a pointer to something that got mutated away</li>
</ul>
<p>Lifetimes solve both of these problems, and 99% of the time, they do this in a totally transparent way.</p>
</blockquote>
<p>â€‹ æŠ„äº†å¥½å¤§ä¸€æ®µå•Šï¼Œæˆ‘å°±ä¸ç¿»è¯‘äº†ï¼Œåæ­£çœ‹ä¸æ‡‚çš„éƒ½åº”è¯¥åæ€ä¸€ä¸‹è‡ªå·±é«˜ä¸­å¤§å­¦å­¦çš„è‹±è¯­éƒ½ç”¨æ¥å¹²ä»€ä¹ˆäº†ï¼Œçœ‹ä¸è‰¯ç½‘ç«™å»äº†ï¼Ÿçœæµï¼šRustå¯ä»¥é¿å…å¼•ç”¨æŒ‡é’ˆå¤±æ•ˆé—®é¢˜ï¼Œå„ç§å¤„ç†éƒ½æ˜¯å®Œå…¨é€æ˜çš„ã€‚å¼ºå•Šï¼Œåªèƒ½è¯´ã€‚</p>
<p>â€‹ ä½†åŒæ—¶lifetimeæ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒä¸ºå¤æ‚çš„æ¦‚å¿µï¼ˆä¸Šåˆçœ‹äº†åŠå°æ—¶æ¦‚å¿µï¼Œæ„£æ˜¯æ²¡çœ‹æ‡‚ï¼‰ã€‚é¦–å…ˆæˆ‘ä»¬ç¡®å®šä¸€ä¸‹ï¼Œlifetimeçš„åº”ç”¨åœºæ™¯ã€‚å¯¹äºæ™®é€šçš„å˜é‡è€Œè¨€ï¼Œå…¶å®ä¸€èˆ¬ä¸éœ€è¦è€ƒè™‘lifetimeæ¦‚å¿µï¼Œå€’æ˜¯å¼•ç”¨ï¼ˆreferenceï¼‰è¿™äº›ç©æ„ï¼Œç”±äºä»–ä»¬å¯èƒ½æŒ‡å‘ä¸€ä¸ªå·²ç»moveã€out of scopeæˆ–è€…å…¶ä»–åŸå› å¤±æ•ˆçš„å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚ä¹Ÿå³ï¼šå¯¹äºå¼•ç”¨è€Œè¨€ï¼Œæˆ‘ä»¬å¸Œæœ›å…¶æŒ‡å‘çš„å˜é‡æ´»ç€çš„æ—¶é—´å¯ä»¥è‡³å°‘ä¸å¼•ç”¨å˜é‡æœ¬èº«ä¸€æ ·é•¿ã€‚åˆ«åœ¨å¼•ç”¨è¿˜validçš„æ—¶å€™ï¼Œç™½å‘äººé€é»‘å‘äººäº†ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆç¼–è¯‘å™¨å¯èƒ½ä¼šæœ‰lifetimeçš„å›°æƒ‘å‘¢ï¼Ÿè¿™é‡Œæˆ‘å¼•ç”¨<a href="https://www.youtube.com/watch?v=juIINGuZyBc">Youtubeä¸Šä¸€ä¸ªåšä¸»çš„ä¾‹å­</a></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str1</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;The first string.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str2</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;2nd string.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>: &amp;<span class="type">str</span> = <span class="title function_ invoke__">longer_string</span>(&amp;str1, &amp;str2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Longer string is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longer_string</span>(x: &amp;<span class="type">String</span>, y: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">String</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ®µç¨‹åºçœ‹èµ·æ¥å¾ˆæ­£ç¡®ï¼Œä½†å®é™…ä¸Šæ²¡åŠæ³•ç¼–è¯‘ã€‚ä¸ºä»€ä¹ˆï¼Ÿç¼–è¯‘å™¨è®¤ä¸ºï¼š<code>longer_string</code>å‡½æ•°è¾“å…¥è¾“å‡ºçš„lifetimeæ˜¯æœ‰é—®é¢˜çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœmainæ”¹å†™æˆï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">str1</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;The first string.&quot;</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str2</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;2nd string.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>: &amp;<span class="type">str</span> = <span class="title function_ invoke__">longer_string</span>(&amp;str1, &amp;str2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Longer string is &#123;&#125;&quot;</span>, result);</span><br></pre></td></tr></table></figure>
<p>â€‹ ç¡®å®å°±æ˜¯é”™çš„äº†ã€‚ä½†æ˜¯ä½ ä¼šè§‰å¾—ï¼Œè¯¶å‘€è¿™ä¸å°±è·Ÿjsä¸€æ ·å˜›ï¼Œä¸€ä¸ªå—å†…éƒ¨çš„å˜é‡ä¸èƒ½åœ¨å¤–éƒ¨è®¿é—®ï¼Œå¾ˆæ­£å¸¸å•Šåšä¸€ä¸ªæ£€æŸ¥åº”è¯¥å°±çŸ¥é“ã€‚ç¡®å®ï¼Œä½†å¦‚æœè¿›ä¸€æ­¥æ”¹å‘¢ï¼Ÿ</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">str2</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;2nd string.&quot;</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str1</span> = String::<span class="title function_ invoke__">from</span>(<span class="string">&quot;The first string.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>: &amp;<span class="type">str</span> = <span class="title function_ invoke__">longer_string</span>(&amp;str1, &amp;str2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Longer string is &#123;&#125;&quot;</span>, result);</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œå·²ç»ä¸ä»…ä»…æ˜¯resultåœ¨å±€éƒ¨å—ä¸­çš„é—®é¢˜äº†ã€‚å¯ä»¥æ ¹æ®<code>longer_string</code>çš„å®šä¹‰çŸ¥é“ï¼Œè¿”å›çš„å¼•ç”¨æ˜¯<code>&amp; str1</code>ã€‚è€Œå³ä¾¿printlnå¯ä»¥è®¿é—®åˆ°å˜é‡resultï¼ŒresultæŒ‡å‘çš„ä¹Ÿå·²ç»æ˜¯ä¸€ä¸ªé”€æ¯åçš„å˜é‡ã€‚æ­¤å¤–ï¼Œä¸Šé¢è¿™ä¸ªä¾‹å­çš„æµç¨‹å·²ç»éå¸¸ç®€å•äº†ï¼Œæ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ— æ³•åˆ¤å®šåœ¨å¼•ç”¨resultå­˜æ´»æ—¶ï¼Œå…¶æŒ‡å‘çš„å†…å®¹æ˜¯å¦ä¹Ÿæ˜¯å­˜æ´»çš„ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œé™å®šï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longer_string</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">String</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">String</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">String</span>&#123; ...</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œ<code>'a</code>è¡¨ç¤ºé™å®šçš„lifetimeï¼Œä¸»è¦ç”¨æ¥é™å®šè¾“å…¥è¾“å‡ºçš„lifetimeï¼ˆè¾“å…¥ä¹‹é—´å…¶å®æ— æ‰€è°“ï¼‰ã€‚lifetimeå®é™…ä¸Šæ˜¯genericçš„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ç±»ä¼¼æ¨¡æ¿çš„æ–¹æ³•ï¼Œä½¿ç”¨å°–æ‹¬å·è¿›è¡Œé™å®šã€‚<code>a</code>å®é™…åªæ˜¯ä¸€ä¸ªåå­—ï¼Œæˆ‘ä»¬å¯ä»¥éšä¾¿èµ·ï¼Œä½†æ˜¯æƒ¯ä¾‹å°±æ˜¯å•ä¸ªå°å†™çš„å­—æ¯ã€‚æ³¨æ„ï¼Œæ­¤å¤„è™½ç„¶<code>x</code>ä¸<code>y</code>çš„lifetimeå¯èƒ½ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬ä»ç„¶å†™äº†ä¸¤ä¸ªä¸€æ ·çš„<code>'a</code>ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¾‘å™¨å°†ä¼šé€‰æ‹©æ›´å°çš„ä¸€ä¸ªä½œä¸ºè¾“å‡ºçš„lifetimeã€‚è¿™æ ·çš„lifetimeé™å®šï¼Œæ ¹æœ¬ç›®çš„æ˜¯ï¼š <strong><u>ä½¿å¾—è¾“å…¥è‡³å°‘å¯ä»¥ä¸è¾“å‡ºå­˜æ´»å¾—ä¸€æ ·ä¹…</u></strong>ã€‚</p>
<p>â€‹ <strong><u>æ³¨æ„ï¼š</u></strong> lifetimeç”¨åœ¨<code>type</code>ï¼Œå‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ç±»ç­‰ä¸Šï¼Œä¸€èˆ¬<strong><u>ä¸éœ€è¦ç”¨åœ¨å‡½æ•°çš„å†…éƒ¨</u></strong>ã€‚ä¸ªäººçš„ç†è§£æ˜¯ï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªå£°æ˜çš„â€œç‰¹æ€§â€ï¼Œè€Œä¸éœ€è¦å‡ºç°åœ¨å®ç°é‡Œã€‚æˆ‘ä»¬å°è¯•ä½¿ç”¨lifetimeæ¥ä¿®æ”¹stackçš„iteratorï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Iter</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="keyword">where</span> T: <span class="built_in">Default</span>&#123;			<span class="comment">// è¿™é‡Œåº”è¯¥è¡¨ç¤ºçš„æ˜¯ï¼ŒIterèƒ½å­˜æ´»å¤šä¹…ï¼ŒthisæŒ‡å‘çš„å†…å®¹å°±åº”è¯¥å­˜æ´»å¤šä¹…ï¼ˆå› ä¸ºthiså¼•ç”¨çš„lifetimeç°åœ¨ä¸Iterä¸€è‡´ï¼‰</span></span><br><span class="line">    this: &amp;<span class="symbol">&#x27;a</span> Link&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; List&lt;T&gt; &#123;				 <span class="comment">// Listæœ¬èº«ä¸éœ€è¦æ˜¾å¼lifetimeæ¦‚å¿µï¼Œæ•…ä¸ç”¨å†™</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">iter</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Iter&lt;T&gt; &#123;			<span class="comment">// æ ¹æ®lifetimeçœç•¥ç¬¬ä¸‰è§„åˆ™ï¼Œè¾“å…¥æœ‰&amp;selfï¼Œåˆ™è¾“å‡ºçš„lifetimeé»˜è®¤ä¸selfä¸€è‡´ï¼Œè¿™æ ·iterçš„lifetimeä¼šä¸é“¾è¡¨æœ¬èº«ä¸€è‡´ï¼Œå†…éƒ¨çš„å¼•ç”¨ä¹Ÿä¸€æ ·</span></span><br><span class="line">        Iter&#123;this: &amp;<span class="keyword">self</span>.head&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">Iter</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="keyword">where</span> T: <span class="built_in">Default</span> &#123;		<span class="comment">// ç”±äºIteråœ¨æ¨¡æ¿å®šä¹‰ä¸­ï¼Œæœ‰&lt;&#x27;a, T&gt;ï¼Œæˆ‘ä»¬åœ¨implå—ä¸­ã€Iteræ¨¡æ¿å®šä¹‰ä¸­ä¹Ÿè¦å†™&#x27;a</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = &amp;a&#x27; T;															<span class="comment">// type éœ€è¦è®¾ç½®lifetime</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;					<span class="comment">// è¿™é‡Œä¸éœ€è¦pubï¼Œå†™pubä¼šæŠ¥é”™ï¼Œè¯´æ˜¯`pub` not permitted here because it&#x27;s impliedã€‚ä¼°è®¡æ˜¯å› ä¸ºimplå—ä¸­é»˜è®¤pub</span></span><br><span class="line">        <span class="keyword">self</span>.this.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">map</span>(|node|&#123;</span><br><span class="line">            <span class="keyword">self</span>.this = &amp;node.next;</span><br><span class="line">            &amp;node.elem</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œæ³¨æ„ï¼Œä¸èƒ½å†™æˆï¼š<code>&lt;'a, T: Default&gt;</code> å¦åˆ™ä¼šå‡ºç°ä¸€äº›<code>'a</code> not bounded è¿™ç§å¥‡æ€ªçš„ï¼Œæˆ‘ä¸çŸ¥é“å¦‚ä½•å¤„ç†çš„é”™è¯¯ã€‚å…³äºlifetimeçœç•¥ï¼ˆellisionï¼‰è§„åˆ™ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ•™ç¨‹<a href="https://rust-unofficial.github.io/too-many-lists/second-iter.html">An Ok Stack: Iter</a>ï¼Œä¹Ÿå¯ä»¥çœ‹ä¸Šæ–‡æåˆ°çš„æ²¹ç®¡åšä¸»çš„è§†é¢‘ã€‚exmmmç»“æœæˆ‘å‘ç°ï¼Œé€šè¿‡ä½œè€…å®ç°çš„æ–¹æ³•ï¼Œåé¢è¿˜æœ‰æŠ¥é”™ï¼Ÿæˆ‘è¿™ä¸€ç‰ˆæœ¬åŠ ä¸Šlifetime annotationå°±ç›´æ¥è¿‡ç¼–è¯‘äº†ã€‚æ•´æ´»ï¼å¼€å§‹ï¼ˆä½†å®é™…ä¸Šï¼Œæˆ‘å’Œæ•™ç¨‹å®ç°çš„å®Œå…¨ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œè™½ç„¶åŠŸèƒ½ä¸Šç±»ä¼¼ï¼Œè¯´å®è¯ï¼Œæˆ‘è§‰å¾—ä½œè€…å®ç°æœ‰ç‚¹å¤æ‚ï¼Ÿï¼ˆå¼€å§‹é£˜äº†ï¼‰ï¼‰ã€‚è®©æˆ‘éå¸¸æƒŠè®¶çš„æ˜¯... æˆ‘æ„Ÿè§‰è¿™ç©æ„æ˜¯ä¸ªç«‹å³æ•°å•Šï¼Œæ€ä¹ˆè¿˜èƒ½å¼•ç”¨å‘¢ï¼Ÿ</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">assert_eq!</span>(iterator.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="number">4</span>));			<span class="comment">// å†™çš„iteræµ‹è¯•ï¼Œå¦‚æœå»æ‰&amp;ç¬¦å·ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¯´iterator.next()è¿”å›äº†ä¸€ä¸ªOption&lt;&amp;i32&gt;ï¼Œè€Œä½ è¿™æ˜¯Option&lt;i32&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™é‡Œæˆ‘ä¿å­˜æ•™ç¨‹ä¸­å‡ ä¸ªæœ‰è¶£çš„ï¼ˆé¢œï¼‰è¡¨æƒ…ï¼ˆä½œè€…ç¼–è¯‘è¿è·ªä¸‰æŠŠï¼‰ï¼š</p>
<blockquote>
<p>(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”» ---&gt; (ï¾‰à²¥ç›Šà²¥ï¼‰ï¾‰ï»¿ â”»â”â”» ---&gt; ğŸ˜­</p>
</blockquote>
<p>â€‹ çœ‹åˆ°æœ€åï¼Œä½œè€…ç›´æ¥ç¥­å‡ºäº†<code>as_deref</code>ï¼Œå¥½å§ï¼Œæˆ‘ä¸èƒ½å› ä¸ºæˆ‘çš„å®ç°å¯ä»¥ç¼–è¯‘å°±ä¸ç®¡ä»–è¿™ä¸€ç‰ˆæœ¬ï¼Œæˆ‘ä¹Ÿæƒ³çŸ¥é“<code>as_deref</code>æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ä½œè€…åšçš„äº‹æƒ…å¾ˆç®€å•ï¼šä½œè€…çš„nexté¡¹ä¿å­˜çš„æ˜¯nodeï¼Œç”±äºnodeå®é™…å·²ç»æ˜¯å†…éƒ¨Linkå†…éƒ¨çš„ç±»å‹äº†ï¼ˆè¢«å°è£…äº†ï¼Œå› ä¸ºLinkæ˜¯<code>Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code>ï¼‰ï¼Œä½œè€…éœ€è¦é€šè¿‡mapå°†å…¶å–å‡ºï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">next: <span class="keyword">self</span>.head.<span class="title function_ invoke__">map</span>(|node| &amp;*node)			<span class="comment">// ç›´æ¥è¿™æ ·ä¼šå¯¼è‡´ç§»åŠ¨çš„(self.headè¢«ç§»åŠ¨)ï¼Œéœ€è¦as_ref</span></span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼Œnodeæœ¬èº«ï¼ˆç”±mapï¼Œä¹Ÿå³matchç±»æ–¹æ³•å–å‡ºï¼‰æ˜¯<code>Box&lt;Node&lt;T&gt;&gt;</code>ï¼Œéœ€è¦ä»å †ä¸­å–å‡ºåˆ™ç”¨*ã€‚ä½œè€…ç”¨äº†<code>deref</code>ï¼Œä½†æ˜¯æˆ‘å‘ç°åªè¦æ”¹æˆï¼šâ€˜</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Iter</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; &#123;</span><br><span class="line">    next: <span class="type">Option</span>&lt;&amp;<span class="symbol">&#x27;a</span> <span class="type">Box</span>&lt;Node&lt;T&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å¹¶ä¸”æŠŠmapä¸­nodeä¹‹å‰çš„<code>&amp;*</code>å»æ‰å…¶å®å°±å¯ä»¥äº†ã€‚<code>as_deref</code>ï¼Œå®˜æ–¹æ–‡æ¡£çš„æ„æ€å†™çš„å¾ˆæ˜ç¡®ï¼š</p>
<blockquote>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">as_deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;&lt;T <span class="keyword">as</span> Deref&gt;::Target&gt;</span><br></pre></td></tr></table></figure>
<p>Converts from <code>Option&lt;T&gt;</code> (or <code>&amp;mut Option&lt;T&gt;</code>) to <code>Option&lt;&amp;mut T::Target&gt;</code>.</p>
<p>Leaves the original <code>Option</code> in-place, creating a new one containing a mutable reference to the inner typeâ€™s [<code>Deref::Target</code>] type.</p>
</blockquote>
<p>â€‹ å¯èƒ½åˆšå¼€å§‹æœ‰ç‚¹æ™•ï¼Œä»€ä¹ˆæ˜¯<code>T::Target</code>ï¼Ÿç»“åˆstackä¾‹å­ï¼Œä»¥åŠè¿™ä¸ªå‡½æ•°çš„åå­—å°±å¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œå®é™…ä¸Šåšäº†ä¸€ä¸ªdereferenceæ“ä½œï¼Œä»<code>Box</code>ä¸­å°†è¢«Boxedçš„å…ƒç´ å–å‡ºï¼Œtargetå®é™…ä¸Šå°±æ˜¯<code>Node&lt;T&gt;</code>ã€‚è¿™é‡Œï¼Œ<code>as_deref</code>åšäº†ä¸¤ä»¶è¿ç»­çš„äº‹æƒ…ï¼šï¼ˆ1ï¼‰ç»™è¿”å›å€¼å¢åŠ å¼•ç”¨ï¼Œï¼ˆ2ï¼‰dereferenceæ“ä½œï¼Œå–å‡ºboxå†…å…ƒç´ ã€‚å…¶å®çœ‹<code>std::ops::Deref</code>çš„è¯´æ˜ä¹Ÿå¯ä»¥çŸ¥é“ï¼š</p>
<blockquote>
<p>Used for immutable dereferencing operations, like <code>*v</code>.</p>
</blockquote>
<p>â€‹ é‚£ä¹ˆï¼Œ<code>self.head</code>è¿›è¡Œ<code>as_deref</code>æ“ä½œçš„ç»“æœä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ã€‚ä»<code>&amp;Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code>å…ˆè½¬åŒ–ä¸º<code>Option&lt;&amp;Box&lt;Node&lt;T&gt;&gt;&gt;</code>å†æˆä¸º<code>Option&lt;&amp;Node&lt;T&gt;&gt;</code>ã€‚æˆ‘è‡ªå·±åŸæ¥çš„å®ç°ï¼Œè¯´æ˜¯<code>this: Link&lt;T&gt;</code> ä½†ç”±äº<code>Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code>ï¼Œæ•…å®é™…ä¸Šæˆ‘åŸæ¥çš„å®ç°å’Œæˆ‘è‡ªå·±çš„ä¿®æ”¹<code>next: Option&lt;&amp;'a Box&lt;Node&lt;T&gt;&gt;&gt;</code>åº”è¯¥æ˜¯æ²¡æœ‰å¤ªå¤§å·®åˆ«çš„ã€‚</p>
<h3 id="ç†è§£æœ‰è¯¯">2.3 ç†è§£æœ‰è¯¯ï¼Ÿ</h3>
<p>â€‹ å°è¯•å®ç°<code>IterMut</code>ä½†å‡ºç°äº†é—®é¢˜ï¼Œæ­¤é—®é¢˜æˆ‘æƒ³äº†å¾ˆä¹…æ²¡æœ‰æƒ³æ˜ç™½ï¼Œäºæ˜¯åœ¨stackoverflowä¸ŠæŒ‚äº†ä¸€ä¸‹ï¼Œä¸¤å°æ—¶åæœ‰ä¸¤ä¸ªäººå›å¤äº†æˆ‘ã€‚å…¶ä¸­ä¸€äººçš„â€œä¿®æ”¹â€å®é™…ä¸Šä¸å®˜æ–¹æ•™ç¨‹å®Œå…¨é‡åˆï¼Œå¯¹æˆ‘çš„å¸®åŠ©ä¸å¤§ï¼Œä½†ä»–åœ¨å›ç­”ä¸­æåˆ°çš„ä¸œè¥¿å¯¹æˆ‘å¾ˆæœ‰å¯å‘ã€‚é—®é¢˜åœ¨è¿™é‡Œï¼š<a href="https://stackoverflow.com/questions/72090145/lifetime-confusion-for-iterator">Stackoverflow: Lifetime Confusion for iterator</a>ã€‚è¿™é‡Œæˆ‘é‡æ–°åˆ—ä¸€ä¸‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">IterMut</span>&lt;<span class="symbol">&#x27;a</span>, T&gt;&#123;</span><br><span class="line">    this: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> Link&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">iter_mut</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> IterMut&lt;T&gt; &#123;</span><br><span class="line">        IterMut &#123;</span><br><span class="line">            this: &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.head</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">IterMut</span>&lt;<span class="symbol">&#x27;a</span>, T&gt;&#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> T;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = <span class="keyword">self</span>.this &#123;</span><br><span class="line">            <span class="keyword">self</span>.this = &amp;<span class="keyword">mut</span> node.next;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> node.elem)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// self.this.as_mut().map(|node|&#123;</span></span><br><span class="line">        <span class="comment">//     self.this = &amp;mut node.next;</span></span><br><span class="line">        <span class="comment">//     &amp;mut node.elem</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>â€‹ ä½¿ç”¨å¦‚ä¸Šæ–¹æ³•å®ç°ä¸€ä¸ª<code>IterMut</code>ï¼Œï¼ˆè¿™é‡Œä¸ºäº†å¯ä»¥æ›´åŠ æ¸…æ™°åœ°çœ‹å‡ºå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Œå°†<code>map</code>æ›¿æ¢ä¸ºäº†matchæ–¹æ³•ï¼ŒåŸæ¥çš„å®ç°åœ¨æ³¨é‡Šä¸­ï¼‰ã€‚è¿™é‡Œä¼šæŠ¥é”™ï¼šè¯´æˆ‘å‘è¿”å›çš„<code>Some(&amp;mut node.elem)</code>çš„å£°æ˜å‘¨æœŸå®é™…ä¸Šæ˜¯<code>'1</code>ï¼ˆä¸åŒ¿åç”Ÿå‘½å‘¨æœŸå¼•ç”¨&amp;mut selfä¸€è‡´ï¼‰ï¼Œè€Œæˆ‘åœ¨<code>impl</code>å—ä¸­æ˜¾å¼å®šä¹‰äº†ä¸€ä¸ª<code>'a</code>ï¼Œä¸¤è€…å†²çªäº†ï¼Œé”™è¯¯æ˜¯ï¼š</p>
<blockquote>
<p>returning this value requires that <code>'1</code> must outlive <code>'a</code></p>
</blockquote>
<p>â€‹ è¿™é‡Œæˆ‘æ ¹æ®æ­ªæœä»ä»¬çš„å›ç­”ä»¥åŠæˆ‘è‡ªå·±ç†è§£ï¼Œè§£é‡Šä¸€ä¸‹äº§ç”Ÿæ­¤é—®é¢˜çš„åŸå› ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>IterMut</code>ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>'a</code>ã€‚è¿™ä¸ª<code>IterMut</code>ä½¿ç”¨<code>iter_mut</code>å‡½æ•°è¿”å›ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”Ÿå‘½å‘¨æœŸçœç•¥è§„å¾‹å¾—åˆ°ï¼Œ<code>IterMut</code>çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯Listçš„<code>self</code>å‘¨æœŸã€‚ä¹Ÿå³<code>'a</code>ä¸<code>List</code>ï¼ˆstackæœ¬ä½“ï¼‰ä¸€è‡´ï¼ˆæˆ–è€…è¯´ï¼Œ<code>IterMut</code>è‡³å°‘ä¸stackæœ¬ä½“æ´»å¾—ä¸€æ ·ä¹…ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œç”±äºæˆ‘å¯¹Rustè¯­è¨€çš„ç†è§£æœ‰é™ï¼Œæˆ‘æ— æ³•ç¡®å®šä»¥ä¸‹ä¸¤ä¸ªæƒ³æ³•å“ªä¸€ä¸ªæ˜¯æ­£ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨æ­¤åˆ†æ”¯ï¼Œä¸¤ä¸ªéƒ½è®°å½•ä¸‹æ¥ï¼š</p>
<p>ï¼ˆ1ï¼‰ä¸ªäººæ›´åŠ å€¾å‘äºè¿™ç§è§£é‡Šï¼šnextå‡½æ•°ä¸­çš„<code>&amp;mut self</code>å¯èƒ½æœ‰å•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºè¿™é‡Œçš„selfåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œä¸ä¸€å®šéœ€è¦ä¸å®ä¾‹åŒ–çš„æœ¬ä½“æœ‰åŒæ ·çš„ç”Ÿå‘½å‘¨æœŸï¼ˆæ›´çŸ­å³å¯ï¼‰ã€‚ä¹Ÿå³å‡å¦‚<code>IterMut</code>çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯<code>'a</code>ï¼Œ<code>&amp;mut self</code>å¯èƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸ<code>'b</code>ã€‚self.thisæ²¡åŠæ³•å¯¼å‡ºæ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸåˆ°nodeä¸­ï¼Œæ¯•ç«Ÿself.thisç”Ÿå‘½å‘¨æœŸåº”è¯¥æ˜¯<code>'a</code> ï¼ˆä¸<code>IterMut</code>ä¸€è‡´ï¼‰ï¼Œè€Œå¯¹äºselfçš„å¼•ç”¨åˆæ˜¯ç”Ÿå‘½å‘¨æœŸ<code>'b</code>çš„ã€‚å¦‚æœè¦ä¿è¯ä¼ å‡ºçš„<code>&amp;mut node.elem</code>æ˜¯æœ‰æ•ˆçš„ï¼Œ<code>'b</code>æ˜¾ç„¶åº”è¯¥é•¿äº<code>'a</code>ï¼Œï¼ˆå› ä¸º<code>Item = &amp;'a mut T</code>'ï¼Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>'a</code>çš„ï¼‰ã€‚è€Œå¦‚æœ<code>'b</code>é•¿äº<code>'a</code>ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼šæˆ‘å¦‚ä½•ç¡®å®šè¿”å›å€¼ä½•æ—¶æ— æ•ˆå‘¢ï¼Ÿå¦‚æœ<code>'b</code>å¾ˆé•¿ï¼Œåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨nextæ—¶ï¼Œä¼šå¯¹æ­¤<code>IterMut</code>åˆ›å»ºä¸€ä¸ªæ–°mutable referenceï¼Œè€ŒåŸæ¥çš„mutable referenceï¼ˆè¿˜è®°å¾—å—ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>'b</code>ï¼‰<strong><u>è¿˜æ²¡æœ‰é”€æ¯</u></strong>ï¼</p>
<div class="note warning"><p>â€‹ Rustä¸å…è®¸å¯¹åŒä¸€ä¸ªå˜é‡ä¿ç•™å¤šä¸ªvalidçš„mutable referenceï¼Œç”šè‡³ä»¥ä¸‹æƒ…å†µä¹Ÿæ˜¯ä¸å…è®¸çš„ï¼ˆä¸€ä¸ªå¼•ç”¨æ•´ä½“ï¼Œä¸€ä¸ªå¼•ç”¨å†…éƒ¨åŸŸï¼‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TestStruct</span> &#123;a: <span class="type">i32</span>, b: <span class="type">f32</span>&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">t1</span> = TestStruct&#123;a: <span class="number">0</span>, b: <span class="number">1.5</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr1</span>: &amp;<span class="keyword">mut</span> TestStruct = &amp;<span class="keyword">mut</span> t1;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr2</span>: &amp;<span class="keyword">mut</span> <span class="type">i32</span> = &amp;<span class="keyword">mut</span> t1.a;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Elem &#123;&#125;&quot;</span>, ptr2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Elems &#123;&#125;, &#123;&#125;&quot;</span>, ptr1.a, ptr1.b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å…³äºæ­¤é—®é¢˜æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œè§ï¼š<a href="https://oribenshir.github.io/afternoon_rusting/blog/mutable-reference">Multiple Mutable Reference</a></p>
</div>
<p>â€‹ æ­¤å¤–ï¼Œå…³äºè¿™ç§è§£é‡Šï¼Œstackoverflowä¸Šçš„å¤§ä½¬ä¹Ÿè¯´ï¼š</p>
<blockquote>
<ul>
<li>So to use the exclusive reference there must be a guarantee that you can't obtain the same mutable reference again. (Note that as written, if you call <code>next()</code> twice you'll get the same mutable reference back, which would be a problem -- that's why the lifetime of the return value must be bound to the lifetime of <code>&amp;mut self</code> in this particular implementation.)</li>
<li>The principal problem lies in trying to take a reference to the whole <code>head</code>. While that reference lives, you can't hand out mutable references to anything inside it.</li>
</ul>
</blockquote>
<p>ï¼ˆ2ï¼‰nextæ²¡æœ‰å•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…¶ä¸­çš„<code>&amp;mut self</code>ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯<code>'a</code>ã€‚è¿™ä¹Ÿä¼šå¼•å‘ç±»ä¼¼çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“<code>'a</code>æ˜¯éå¸¸é•¿çš„ï¼ˆä¸stackæœ¬ä½“ä¸€è‡´ï¼‰ï¼Œè€Œè¿™é‡Œè™½ç„¶<code>&amp;mut self</code>åœ¨nextå‡½æ•°ç»“æŸä¹‹åï¼Œçœ‹ä¼¼å·²ç»ä¸è§äº†ï¼ˆæœ¬æ¬¡<code>&amp;mut self</code>å·²ç»é”€æ¯äº†ï¼‰ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œç”±äºæˆ‘ä»¬å®šä¹‰äº†<code>&amp;mut self</code>çš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>'a</code>ï¼Œå®ƒå®é™…è¿˜æ˜¯å­˜æ´»ç€çš„ã€‚æ•…ä¹Ÿä¼šå‡ºç°å¤šmutable referenceçš„é—®é¢˜ã€‚</p>
<p>â€‹ å·²ç»çŸ¥é“é”™äº†ï¼Œæ±‚æ±‚Rustä¸è¦å†æ‰“æˆ‘äº†ï¼Œ\(Tç›ŠT)/ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç»†è‡´åˆ†æä¸€ä¸‹æ•™ç¨‹çš„å®ç°ã€‚åœ¨stackoverflowçš„å›ç­”ä¸­ï¼Œå‚ä¸å›ç­”çš„å¤§ä½¬è¯´ï¼š</p>
<blockquote>
<p>The principal problem lies in trying to take a reference to the whole <code>head</code>.</p>
</blockquote>
<p>â€‹ åŸå®ç°ä¸­ï¼Œåœ¨æ„é€ <code>IterMut</code>çš„è¿‡ç¨‹ä¸­ï¼Œthisä¼ å…¥çš„å‚æ•°æ˜¯<code>&amp;mut self.head</code>ã€‚è€Œ<code>self.head</code>çš„ç”Ÿå‘½å‘¨æœŸéå¸¸é•¿ï¼ˆä¸stackæœ¬ä½“ä¸€è‡´ï¼‰ã€‚å¦‚æœåƒä½œè€…ä¸€æ ·ï¼ŒthisæŒ‡å‘çš„ä¸æ˜¯ä¸€ä¸ªLinkç»“æ„ï¼Œè€Œæ˜¯ä¸€ä¸ªNodeï¼Œå¯èƒ½å¯ä»¥è§£å†³é—®é¢˜ã€‚æ•™ç¨‹ä¸­å®ç°æ˜¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">IterMut &#123;</span><br><span class="line">    this: <span class="keyword">self</span>.head.<span class="title function_ invoke__">as_deref_mut</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>as_deref_mut</code>å¯ä»¥å°†<code>&amp;mut Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code>è½¬åŒ–ä¸º<code>Option&lt;&amp;mut Node&lt;T&gt;&gt;</code>ã€‚è€Œ<code>self.head.as_deref_mut()</code>å¾—åˆ°çš„è¿™ä¸ªnodeï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ªäººçš„ç†è§£æ˜¯ï¼šå¯ä»¥å¾ˆçŸ­ï¼å› ä¸ºè¿™ä¸æ˜¯stackä¸­å¸¸é©»çš„headï¼ˆåªè¦stackåœ¨å°±æœ‰ï¼‰ï¼Œnodeæ˜¯å¯ä»¥è½»æ˜“invalidateçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹‹æ‰€ä»¥ç”¨nodeå†™ï¼Œå°±æ˜¯å› ä¸ºheadå·²ç»æˆäº†... è€ä¸æ­»çš„ç©æ„ã€‚å¯¹äºä¸€ä¸ªnodeè€Œè¨€ï¼Œåªè¦takeå®ƒï¼Œå®ƒå°±ä¹‹åå°±æ²¡äº†ï¼Œé”€æ¯äº†ï¼Œä½¿å¾—æ­¤ç”Ÿå‘½å‘¨æœŸä¸ä¼šå½±å“ä»£ç çš„å…¶ä»–éƒ¨åˆ†ï¼Œä¹Ÿä¸ä¼šä½¿å¾—æŸä¸ªå¼•ç”¨æ´»å¤ªé•¿è€ŒæŒ¤å å¯ä»¥ç”¨çš„mutable referenceèµ„æºã€‚å…¶ä»–å…¶å®æ²¡æœ‰å¤ªå¥½è¯´çš„ã€‚åæ§½ä¸€ä¸‹ï¼Œè¿™æ ·çš„next peeking... è²Œä¼¼ä¼šæ¯æ‰æ•´ä¸ªstackï¼Œæˆ‘ä¸èƒ½åšåˆ°ä¿®æ”¹ä¹‹åè¿˜ä¿è¯åŸæ¥çš„ç»“æ„ï¼Ÿ</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸçš„å…¶ä»–é—®é¢˜">2.4 ç”Ÿå‘½å‘¨æœŸçš„å…¶ä»–é—®é¢˜</h3>
<p>â€‹ lifetimeæ·±ç©¶èµ·æ¥å¾ˆæ˜¯å¤æ‚ï¼Œåœ¨ç¼–å†™ç¨‹åºçš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“æç³Šæ¶‚ã€‚è¿™é‡Œæˆ‘æƒ³å†åˆ†æä¸€ä¸‹stackoverflowä¸Šå…³äºconflict lifetimeçš„å¦ä¸€ä¸ªä¾‹å­ã€‚ä¸ªäººè§‰å¾—ï¼Œè¿™ä¸ªä¾‹å­ç†è§£èµ·æ¥è¾ƒä¸ºç®€å•ï¼Œå¹¶ä¸”å¦‚æœä½ çœŸçš„ç†è§£äº†lifetimeï¼Œåˆ†æè¿™ä¸ªä¾‹å­æ˜¯å¾ˆè½»æ¾çš„ã€‚åŸé—®é¢˜ï¼š<a href="https://stackoverflow.com/questions/41270052/cannot-infer-an-appropriate-lifetime-for-autoref-due-to-conflicting-requirements">Cannot infer an appropriate lifetime for autoref due to conflicting requirements</a></p>
<p>â€‹ å…¶ä¸­ä¸€ä¸ªä½¬å°†é—®é¢˜è¿›è¡Œäº†ç®€åŒ–ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FontLoader</span>(<span class="type">String</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Font</span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FontLoader</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">load</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Font &#123;</span><br><span class="line">        <span class="title function_ invoke__">Font</span>(&amp;<span class="keyword">self</span>.<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Window</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Phi</span>&lt;<span class="symbol">&#x27;window</span>&gt; &#123;</span><br><span class="line">    window: &amp;<span class="symbol">&#x27;window</span> Window,</span><br><span class="line">    loader: FontLoader,</span><br><span class="line">    font: <span class="type">Option</span>&lt;Font&lt;<span class="symbol">&#x27;window</span>&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;window</span>&gt; Phi&lt;<span class="symbol">&#x27;window</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">do_the_thing</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">font</span> = <span class="keyword">self</span>.loader.<span class="title function_ invoke__">load</span>();</span><br><span class="line">        <span class="keyword">self</span>.font = <span class="title function_ invoke__">Some</span>(font);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¯•é—®ï¼Œä¸ºä»€ä¹ˆloadå‡½æ•°ç¼–è¯‘æ—¶ï¼Œæ— æ³•æ­£ç¡®å¯¼å‡ºlifetimeï¼Ÿé¦–å…ˆï¼Œçœ‹ç¬¬äºŒä¸ª<code>impl</code>å—ï¼Œæ­¤å—é™åˆ¶äº†ï¼ˆå®šä¹‰äº†ï¼‰<code>Phi</code>ç»“æ„ä½“çš„ç”Ÿå­˜æ—¶é—´ã€‚ä½†æ­¤å¤„ï¼Œ<code>&amp;mut self</code>å´ä»ç„¶æ˜¯ä¸€ä¸ªlocalçš„lifetimeï¼ˆå¹¶ä¸ä¸€å®šæ˜¯<code>'window</code>ï¼‰ï¼Œæ¥ä¸‹æ¥çš„æµç¨‹æ˜¯ï¼š</p>
<ul>
<li>loader.loadã€‚loaderæ²¡æœ‰æ ‡æ³¨ç”Ÿå­˜å‘¨æœŸã€‚loadä¹‹åï¼Œè¿”å›çš„loadå°†ä¼šè£…å…¥loaderçš„ç”Ÿå‘½å‘¨æœŸï¼ˆè¿™é‡Œç¬¦åˆç”Ÿå­˜å‘¨æœŸçœç•¥è§„åˆ™ï¼Œæ•…<code>&amp;self.0</code>å¯¹åº”çš„ç”Ÿå­˜å‘¨æœŸ --- loaderçš„ç”Ÿå­˜å‘¨æœŸè¢«è£…å…¥ã€‚ï¼‰</li>
<li>è¿”å›åï¼Œå¸Œæœ›ä½¿ç”¨Optionå°è£…è£…å…¥<code>self.font</code>ï¼Œä½†æ˜¯self.fontçš„ç”Ÿå‘½å‘¨æœŸæ˜¯<code>'window</code>...ï¼Œé‚£ä¹ˆloaderçš„å‘¨æœŸæ˜¯<code>'window</code>å—ï¼Ÿæˆ‘ä»¬å·²ç»è¯´äº†ï¼Œå¹¶ä¸è§å¾—ã€‚å‡å¦‚æ²¡æœ‰äººæ“ä½œè¿™ä¸ªå˜é‡ï¼Œå¾ˆå¯èƒ½<code>self.loader</code>ç›´åˆ°ç»“æ„ä½“<code>Phi</code>è¢«é”€æ¯æ—¶æ‰éšä¹‹é”€æ¯ã€‚ä½†æ˜¯... å‡è®¾å®ƒåœ¨ä¹‹å‰å°±è¢«moveäº†å‘¢ï¼Ÿæ•…è¿™é‡Œæˆ‘ä»¬å°†loaderçš„ç±»å‹æ”¹å†™ä¸º<code>&amp;'window Fontloader</code>ã€‚è¿™æ ·ï¼Œåªè¦loaderæœ¬èº«å­˜æ´»æ—¶é—´å¤Ÿé•¿ï¼Œå°±ä¸ä¼šæœ‰å†²çªé—®é¢˜ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>SVMç®—æ³•ä¸å®ç°</title>
    <url>/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="svm">SVM</h1>
<hr>
<h2 id="preface">Preface</h2>
<p>â€‹ SVM (Support Vector Machine æ”¯æŒå‘é‡æœº) æ›¾ä¸€åº¦å¯¼è‡´æ·±åº¦å­¦ä¹ çš„é€€æ½®ï¼ˆ1995ï¼‰ã€‚Geoffrey Hintonæå‡ºBPä¹‹åï¼Œé‡åˆ°äº†sigmoidæ¿€æ´»å‡½æ•°æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œæ°å¥½æ­¤æ—¶Vapnikæå‡ºç»Ÿè®¡å­¦ä¹ ç†è®ºï¼Œæ­£å¼æå‡ºéçº¿æ€§SVMå¹¶å°†å…¶åº”ç”¨ï¼Œä½¿å¾—è¿™ä¸ªåˆ†ç±»å™¨ç››è¡Œäº†20å¹´ï¼Ÿç›´åˆ°DLçš„æ¢…å¼€ä¸‰åº¦ã€‚ æ°å¥½å¤§ä¸‰ä¸‹å­¦æœŸæœ‰ã€Šæ¨¡å¼è¯†åˆ«ã€‹è¯¾ï¼Œä¸”æœ‰å­¦é•¿è¯´ä»–è€ƒå‰æ¯å¤©å¿…æ¨ä¸€éSVMåŸç†ï¼Œä¸å¦‚ç°åœ¨è¶ã€Šè¿ç­¹å­¦ã€‹è¿˜çƒ­ç€ï¼Œå°è¯•è‡ªå·±æ¨å¯¼ä¸€éï¼Œå¹¶å®ç°è¿™ä¸€ä¸ªç»å…¸ç®—æ³•ã€‚</p>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/history.jpg"></p>
<center>
Figure 1. æ·±åº¦å­¦ä¹ çš„å‘å±•å†ç¨‹ ä»¥åŠ95å¹´SVMå¸¦æ¥çš„å†²å‡»ï¼ˆå›¾æºä¸æ˜ï¼‰
</center>
<span id="more"></span>
<p>â€‹ SVMä½œä¸ºç»å…¸çš„â€œæœ€å¤§é—´éš”â€ï¼ˆmaximum marginï¼‰åˆ†ç±»å™¨ï¼Œé™¤äº†å…¶ç²¾å·§çš„æ•°å­¦å˜æ¢ï¼ˆLagrangeå¯¹å¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘è‡ªå·±æ¨å‡ºæ¥äº†æ‰€ä»¥è§‰å¾—å¾ˆå¦™å§:laughing:ï¼‰ä¹‹å¤–ï¼Œâ€œæ”¯æŒå‘é‡â€çš„æ€æƒ³æ˜¯æœ€å¦™ä¹‹å¤„ã€‚è¿™ç§æ–¹æ³•å¤§å¤§å‡å°‘äº†è®­ç»ƒæ—¶ä½¿ç”¨çš„ç»´æ•°ï¼Œé¿å…äº†å†…å­˜çˆ†ç‚¸é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å°‘é‡æ ·æœ¬è¿›è¡Œè®­ç»ƒã€‚</p>
<hr>
<h2 id="è¶…å¹³é¢çš„æ„ä¹‰">è¶…å¹³é¢çš„æ„ä¹‰</h2>
<p>â€‹ å‡è®¾ä¸€ä¸ªå¹³é¢ï¼Œå…¶åˆ°åŸç‚¹çš„æ³•å‘é‡ä¸º<span class="math inline">\(\pmb{w}\)</span>ï¼Œåˆ°åŸç‚¹çš„è·ç¦»ä¸º<span class="math inline">\(b\)</span>ï¼Œé‚£ä¹ˆå¹³é¢æ–¹ç¨‹åº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{equ:hyper}
\pmb{w}^T\pmb{x}+b=0
\end{equation}
\]</span> â€‹ å®é™…ä¸Šè¿™æ˜¯æ–¹ç¨‹ï¼š <span class="math display">\[
\begin{equation}\label{equ:plain}
Ax+By+Cz+....+b=0
\end{equation}
\]</span> â€‹ è¿›è¡Œçš„æ¨å¹¿ï¼Œé‚£ä¹ˆå¯¹äºå…¬å¼<span class="math inline">\(\eqref{equ:hyper}\)</span>ï¼Œå¦‚æ­¤å®šä¹‰æ–¹å¼ä¸ºä»€ä¹ˆå¯ä»¥å®šä¹‰ä¸€ä¸ªå¹³é¢ï¼Ÿxä¸ºä»€ä¹ˆä¸€å®šåœ¨ä¸€ä¸ªç”±<span class="math inline">\(\pmb{w}\)</span>ä»¥åŠ<span class="math inline">\(b\)</span>å®šä¹‰çš„å”¯ä¸€å¹³é¢ä¸Šï¼Ÿæ¨å¯¼å¦‚ä¸‹ï¼Œå¦‚å›¾(1)ï¼Œè¿‡åŸç‚¹åšå‚ç›´äºè¶…å¹³é¢çš„å‚çº¿ï¼Œè®¾äº¤ç‚¹ä¸ºPï¼Œå¹³é¢ä¸Šä¸€ç‚¹xç›¸å¯¹äºPç‚¹çš„ç›¸å¯¹å‘å‘é‡ä¸ºx'ã€‚é‚£ä¹ˆæœ‰ï¼š <span class="math display">\[
\begin{align}
&amp; \pmb{v}=\vert b\vert\frac{\pmb{w}}{\Vert\pmb{w}\Vert} \\
&amp; \pmb{x}=\pmb{x}&#39;+\pmb{v}      \\
&amp; \pmb{w}^T\pmb{x}+b = \pmb{w}^T\pmb{x}&#39;+\pmb{w}^T\pmb{v}+b = 0
\end{align}
\]</span> â€‹ æ¨å¯¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/svm.JPG"></p>
<center>
Figure 2. è¶…å¹³é¢æ•°å­¦æ„ä¹‰æ¢ç©¶
</center>
<p>â€‹ å¦‚æœè¦æ¨ç®—ä¸€ä¸ªç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»ï¼Œæ¯”å¦‚ä¸Šå›¾çš„ç‚¹yåˆ°è¶…å¹³é¢çš„è·ç¦»ï¼Œç›¸å½“äºæ˜¯ï¼šyäº¤è¶…å¹³é¢äºy'ç‚¹ï¼Œè€Œç”±äºy'åœ¨è¶…å¹³é¢ä¸Šï¼Œäºæ˜¯æœ‰<span class="math inline">\(\pmb{w}^T\pmb{y}&#39;+b=0\)</span>ï¼Œé‚£ä¹ˆç”±äº<span class="math inline">\(\pmb{y} = \pmb{y}&#39;+\pmb{y}&#39;&#39;\)</span>ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼š <span class="math display">\[
\begin{equation}\label{equ:predist}
\pmb{w}^T\pmb{y}+b=\pmb{w}^T\pmb{y}&#39;&#39;
\end{equation}
\]</span> â€‹ è€Œå…¬å¼<span class="math inline">\(\eqref{equ:predist}\)</span>å³ä¾§ç›¸å½“äºæ˜¯y''åœ¨æœªå•ä½åŒ–çš„æ–¹å‘å‘é‡ä¸Šçš„æŠ•å½±ï¼Œå•ä½åŒ–ä¹‹åå¯ä»¥å¾—åˆ°è·ç¦»ã€‚é‚£ä¹ˆæ•´ä¸ªç‚¹åˆ°è¶…å¹³é¢è·ç¦»å…¬å¼å¦‚ä¸‹ï¼š <span class="math display">\[
d = \frac{\vert \pmb{w}^T\pmb{x}+b\vert}{\Vert \pmb{w}\Vert}
\]</span></p>
<hr>
<h2 id="ç›®æ ‡å‡½æ•°å¯¼å‡º">ç›®æ ‡å‡½æ•°å¯¼å‡º</h2>
<p>â€‹ å¯¹äºä¸€ä¸ªäºŒåˆ†ç±»çš„SVMï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°<strong>ä¸€ä¸ª</strong>è¶…å¹³é¢ï¼Œèƒ½å¤Ÿæœ€ä¼˜åœ°å°†ä¸¤ç±»æ•°æ®åˆ†å¼€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›¾ç‰‡æ¥æºè§reference[1]ã€‚</p>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/margin.png"></p>
<center>
Figure 3. SVMä¸è¶…å¹³é¢
</center>
<p>â€‹ è”ç³»ä»¥ä¸‹å…¶ä»–çš„åˆ†ç±»æ–¹æ³•ï¼Œæ¯”å¦‚è¯´LDAï¼ˆLinear Discriminative Analysisï¼‰ï¼Œåœ¨ç®—æ³•æ„å»ºæ—¶å°±å­˜åœ¨ä¸€ç‚¹å°±æ˜¯ï¼šä½¿ç±»é—´æ–¹å·®æ˜¯æœ€å¤§çš„ã€‚ä¹Ÿå°±æ˜¯å¸Œæœ›ä¸¤ç±»ä¹‹é—´çš„é—´éš”æ˜¯æœ€å¤§çš„ã€‚åœ¨SVMä¸­ï¼Œä¸è¡¡é‡ç±»é—´æ–¹å·®ï¼Œè¡¡é‡çš„æ˜¯â€œmarginâ€ï¼ˆå°±æ˜¯Figure 3ä¸­çš„é»„è‰²åŒºåŸŸï¼‰ã€‚</p>
<p>â€‹ ä»ç®€å•çš„ä¾‹å­å¼•å…¥ï¼Œæˆ‘ä»¬è®¨è®ºäºŒåˆ†ç±»çº¿æ€§åˆ†ç±»å™¨ã€‚å¯¹äºä¸€ä¸ªçº¿æ€§å¯åˆ†çš„å¾…åˆ†ç±»æ•°æ®é›†ï¼Œä¸¤ä¸ªç±»åˆ«é—´éœ€è¦æ‰¾ä¸€ä¸ªè¶…å¹³é¢ã€‚æ˜¾ç„¶ï¼Œä¸¤ä¸ªç±»åˆ«éƒ½ä¼šæœ‰ç¦»è¿™ä¸ªè¶…å¹³é¢è·ç¦»æœ€è¿‘çš„æ•°æ®ç‚¹ï¼Œè¿™ä¸ªæœ€çŸ­è·ç¦»ï¼ˆè¡¨å¾çš„æ˜¯ä¸€ç§é”™è¯¯å®¹é™ï¼Œå¦‚æœä¸º0åˆ™æ°å¥½åœ¨ä¸å¯åˆ¤å®šçš„è¾¹ç•Œä¸Šï¼‰å¦‚æœè®°ä¸º<span class="math inline">\(d_1, d_2\)</span>çš„è¯ï¼Œæˆ‘ä»¬æ˜¾ç„¶æ˜¯å¸Œæœ›<span class="math inline">\(d_1, d_2\)</span>å°½å¯èƒ½å¤§çš„ï¼ˆæœ€å®¹æ˜“å‡ºç°é”™è¯¯çš„æ•°æ®ç‚¹ï¼ˆç¦»åˆ†ç±»è¶…å¹³é¢æœ€è¿‘çš„ç‚¹ï¼‰ç¦»åˆ†ç±»ç•Œé™è¶Šè¿œï¼‰ã€‚åƒè¿™æ ·å¯ä»¥å®šä¹‰è¶…å¹³é¢æ‰€åœ¨ä½ç½®çš„æ•°æ®ç‚¹ï¼ˆæœ€å®¹æ˜“å‡ºç°åˆ†ç±»é”™è¯¯ï¼Œæœ€åº”è¯¥è¢«è®¨è®ºï¼‰ï¼Œè¢«ç§°ä¸ºâ€œæ”¯æŒå‘é‡ï¼ˆsupport vectorï¼‰â€ï¼Œæ­¤åè®¨è®ºçš„éƒ½æ˜¯æ”¯æŒå‘é‡ç¡®å®šçš„è¶…å¹³é¢é—´çš„è·ç¦»é—´éš”ã€‚å¦‚ä½•è¡¡é‡è¿™ä¸ªè·ç¦»ï¼Ÿæ˜¾ç„¶å¯ä»¥ä½¿ç”¨å‡ ä½•è·ç¦»çš„æ¨å¹¿ï¼ˆç»´æ•°ä¸Šçš„æ¨å¹¿ï¼‰ã€‚å¯ä»¥é€šè¿‡2-èŒƒæ•°æ¥å®šä¹‰ç©ºé—´ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œä½†ç”±äºè¿™æ˜¯ç‚¹ä¸å¹³é¢ä¹‹é—´çš„è·ç¦»ï¼Œéœ€è¦ç‚¹ä¸å¹³é¢çš„è·ç¦»å…¬å¼ã€‚</p>
<p>â€‹ ä»æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ï¼šâ€œå¸Œæœ›æœ€å¯èƒ½åˆ†ç±»é”™è¯¯çš„æ•°æ®ç‚¹å¯¹åº”çš„æœ€çŸ­è¶…å¹³é¢è·ç¦»é—´éš”-æ˜¯-æœ€å¤§çš„â€è¿™ä¸ªæƒ³æ³•ä¸Šæ¥çœ‹æˆ‘ä»¬åº”è¯¥å°†è·ç¦»çš„ç”Ÿæˆåˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ul>
<li>ç»™å®šè¶…å¹³é¢æ—¶ï¼Œå¦‚ä½•è¡¡é‡å“ªä¸ªæ•°æ®ç‚¹æ˜¯æœ€å®¹æ˜“åˆ†ç±»é”™è¯¯çš„ï¼Ÿ</li>
<li>åœ¨ç»™å®šæ”¯æŒå‘é‡æ—¶ï¼Œå¦‚ä½•è¿›è¡Œè¶…å¹³é¢å‚æ•°çš„ç¡®å®šä¸ä¼˜åŒ–ï¼Ÿ</li>
</ul>
<p>â€‹ å¼€å§‹æ—¶ä¸ªäººæ„Ÿè§‰ï¼Œè¿™ä¸ªé—®é¢˜<strong><u>æœ‰ç‚¹è‡ªå¾ªç¯çš„æ„Ÿè§‰</u></strong>ã€‚è¶…å¹³é¢ç¡®å®šä¾èµ–æ”¯æŒå‘é‡ï¼Ÿæ”¯æŒå‘é‡ç»™å®šåæ‰èƒ½ç¡®å®šè¶…å¹³é¢å‚æ•°ï¼Ÿè¿™ä¸å°±äº§ç”Ÿäº†é¸¡ç”Ÿè›‹ è›‹ç”Ÿé¸¡çš„æ‚–è®ºäº†å—ï¼Ÿæœ‰å…³è¿™ä¸ªé—®é¢˜çš„è®¨è®ºï¼Œåœ¨å¤„ç†å®Œç›®æ ‡å‡½æ•°çš„æ•°å­¦å˜æ¢ä¹‹åæˆ‘å†ä»æ•°å­¦çš„è§’åº¦ä¸Šè°ˆä¸€ä¸‹æˆ‘ä¸ªäººçš„ç†è§£ã€‚</p>
<h3 id="è·ç¦»è¡¡é‡">è·ç¦»è¡¡é‡</h3>
<p>â€‹ å¯¹äºä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œè¶…å¹³é¢å·²ç»å®šä¹‰ä¸ºï¼š<span class="math inline">\(\pmb w^Tx+b = 0\)</span>ï¼Œé‚£ä¹ˆå¦‚æœæ‰€æœ‰æ•°æ®éƒ½èƒ½æ­£ç¡®åˆ†ç±»ï¼Œä¸¤ä¸ªæ•°æ®é›†çš„æ•°æ®ç‚¹ä¸€å®šä¼šå‘ˆç°ï¼šä¸€ä¸ªç±»åˆ«çš„æ•°æ®åœ¨è¶…å¹³é¢çš„â€œä¸Šæ–¹â€ï¼ˆæ­£æ–¹å‘ä¸Šï¼‰ï¼Œå¦ä¸€ä¸ªç±»åˆ«åˆ™å…¨éƒ¨åœ¨â€œä¸‹æ–¹â€ã€‚ç›¸åº”åœ°ï¼Œ<span class="math inline">\(\pmb w^Tx+b\)</span>å¯èƒ½å¤§äº0æˆ–è€…å°äº0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š <span class="math display">\[
\left\{
\begin{array}{l}
\pmb w^Tx+b &gt; 0,\large{\text{æ­£ç±»}} &amp;\\
\pmb w^Tx+b &lt; 0,\large{\text{è´Ÿç±»}} &amp;
\end{array}
\right.
\]</span> â€‹ è€Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬çš„æ ·æœ¬ç‚¹æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ªç‚¹ï¼Œåœ¨æ­£ç±»ä¸­ï¼Œæ­£å€¼æœ€å°ï¼Œè´Ÿç±»ä¸­èµ‹å€¼æœ€å°ã€‚é‚£ä¹ˆå¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªæœ€å°å€¼è¿›è¡Œå°ºåº¦å½’ä¸€åŒ–ï¼š <span class="math display">\[
\left\{
\begin{array}{l}
\pmb w^Tx+b \ge 1,\large{\text{æ­£ç±»}} &amp;\\
\pmb w^Tx+b \le -1,\large{\text{è´Ÿç±»}} &amp;
\end{array}
\right.
\]</span> â€‹ é‚£ä¹ˆä½¿ç”¨ä¸€ä¸ªå°trickï¼Œç”¨sgn(Â·) å‡½æ•°å¤„ç†ä»¥ä¸Šå¼å­ï¼š <span class="math display">\[
\begin{equation}\label{equ:dist}
d_f=y_i(\pmb w^Tx+b),\text{ where } y_i =1 \text{ if æ­£ç±» otherwise } y_i = -1
\end{equation}
\]</span> â€‹ è¿™æ ·å¯ä»¥ä¿è¯ï¼š<span class="math inline">\(d_f\)</span>åœ¨åˆ†ç±»æ­£ç¡®æ—¶æ’ä¸ºæ­£å€¼ï¼Œå¹¶ä¸”è®©é—®é¢˜å°½å¯èƒ½ç®€å•åŒ–ã€‚ï¼ˆ<span class="math inline">\(y_i\)</span>å½“ç„¶å¯ä»¥ä¸å–æ­£è´Ÿ1ï¼Œä½†æ˜¯å–å…¶ä»–çš„å€¼è®©é—®é¢˜å½¢å¼ç¨å¾®å¤æ‚äº†ä¸€ç‚¹ç‚¹ï¼Œæ²¡æœ‰ä»€ä¹ˆå¿…è¦ï¼‰ã€‚æ ¹æ®åœ¨ä¹‹å‰å°èŠ‚è®¨è®ºçš„è¶…å¹³é¢è·ç¦»å…¬å¼ï¼Œå·²çŸ¥<span class="math inline">\(\vert\pmb w^Tx+b=1\vert\)</span>ï¼ˆå¯¹äºæ”¯æŒå‘é‡è€Œè¨€ï¼‰ï¼Œé‚£ä¹ˆä¸¤ä¸ªç±»è·ç¦»è¶…å¹³é¢çš„è·ç¦»æ˜¯å„ä¸º<span class="math inline">\(1/\Vert\pmb{w}\Vert\)</span>ã€‚é‚£ä¹ˆä¼˜åŒ–é—®é¢˜å³ä¸ºï¼š $$ <span class="math display">\[\begin{equation}\label{equ:simple}
\left\{
\begin{array}{l}
\text{max }\frac{2}{\Vert\pmb{w}\Vert} &amp;\\
\text{s.t. } y_i(\pmb w^Tx+b) \ge 1, \text{ for } i\in1,2,...n &amp;
\end{array}
\right.

\rightarrow

\left\{
\begin{array}{l}
\text{min }{ \frac 12 \Vert\pmb{w}\Vert^2} &amp;\\
\text{s.t. } y_i(\pmb w^Tx+b) \ge 1, \text{ for } i\in1,2,...n &amp;
\end{array}
\right.
\end{equation}\]</span> $$ â€‹ ç†æƒ³æƒ…å†µä¸‹ï¼Œéœ€è¦ä¼˜åŒ–çš„é—®é¢˜å°±æ˜¯æŒ‰ç…§å…¬å¼<span class="math inline">\(\eqref{equ:simple}\)</span>å®šä¹‰çš„ã€‚</p>
<h3 id="éç†æƒ³æƒ…å†µ">éç†æƒ³æƒ…å†µ</h3>
<p>â€‹ å“ªæœ‰é‚£ä¹ˆå¤šçº¿æ€§å¯åˆ†çš„æ•°æ®é›†ï¼Ÿåˆ†ç±»é”™è¯¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ— æ³•é¿å…ï¼ˆä»–ä»¬ä¸­å‡ºäº†ä¸€ä¸ªå›å¾’ï¼‰ã€‚åŸæœ‰çš„çº¿æ€§å¯åˆ†æ¡ä»¶å¤ªå¼ºäº†ï¼Œéœ€è¦è¿›è¡Œä¸€å®šçš„æ¾å¼›æ‰å…·æœ‰æ³›åŒ–èƒ½åŠ›ã€‚èªæ˜çš„æ•°å­¦å®¶ä»¬æƒ³åˆ°çš„åŠæ³•æ˜¯ï¼šè®¾å®šä¸€ä¸ªå®¹é™<span class="math inline">\(\zeta_i\)</span>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ¾å¼›å› å­ï¼Œä¸è¿½æ±‚æ‰¾åˆ°æœ€å°çš„é‚£å¯¹ã€‚åä¹‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¶…å¹³é¢é—´éš”å®½åº¦ä»¥åŠå…è®¸çš„é”™åˆ†ç±»æ·±åº¦ï¼ˆæŸä¸ªæ•°æ®é›†è¯¯å…¥æ•Œè¥çš„è·ç¦»ï¼‰ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚</p>
<p>â€‹ ç”±äº<span class="math inline">\(y_i(\pmb w^Tx+b) \ge 1\)</span>å¾ˆéš¾è¾¾æˆï¼Œé‚£ä¹ˆæ€»å¯ä»¥<span class="math inline">\(y_i(\pmb w^Tx+b) \ge 1 - \zeta_iï¼Œ\zeta_i \ge 0\)</span>å§ã€‚é‚£ä¹ˆï¼Œæ‰€æœ‰<span class="math inline">\(\zeta_i\)</span>çš„å’Œï¼ˆå®ƒä»¬éƒ½æ˜¯éè´Ÿçš„ï¼‰æ˜¾ç„¶åæ˜ äº†å¯¹è¿™ä¸ªåˆ†ç±»å™¨çš„æ¾å¼›ç¨‹åº¦ã€‚é—®é¢˜å°±åœ¨äºï¼Œæˆ‘ä»¬å¸Œæœ› æ¾å¼›ä¸€ç‚¹ï¼Œæ³›åŒ–èƒ½åŠ›å¼ºä¸€ç‚¹ï¼Ÿè¿˜æ˜¯ä¸¥æ ¼ä¸€ç‚¹ï¼Œæ­£ç¡®ç‡é«˜ä¸€ç‚¹ï¼Ÿé€šè¿‡ä¸€ä¸ªå¯è°ƒçš„ç³»æ•°æ¥å†³å®šï¼š <span class="math display">\[
\sum_{i=1}^n\zeta_i+\frac{\lambda}{2}\Vert\pmb{w} \Vert^2
\]</span> â€‹ <span class="math inline">\(\lambda\)</span>å°±æ˜¯èµ·æƒè¡¡ä½œç”¨çš„åŠ æƒç³»æ•°ã€‚</p>
<hr>
<h2 id="ç›®æ ‡å‡½æ•°æ•°å­¦å˜æ¢">ç›®æ ‡å‡½æ•°æ•°å­¦å˜æ¢</h2>
<p>â€‹ æ¾å¼›åçš„é—®é¢˜åŸç›®æ ‡å‡½æ•°è¡¨è¾¾å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{equ:tar1}
\left\{
\begin{array}{l}
    \text{min } \frac 1n \sum_{i=1}^n\zeta_i+\frac{\lambda}{2}\Vert\pmb{w} \Vert^2 &amp;\\
    \text{s.t. }y_i(\pmb{w}^T\pmb{x}_i+b) \ge 1-\zeta_i,\zeta_i\ge0\text{ for }i\in1,2,...n &amp;\\
\text{where } \zeta_i \text{ is max} (0, 1-y_i(\pmb{w}^T\pmb{x}_i+b)) &amp;
\end{array}
\right.
\end{equation}
\]</span> â€‹ ç”±äºè¿™æ˜¯ä¸€ä¸ªå¤šå˜é‡æœ‰çº¦æŸä¼˜åŒ–é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨Lagrangeä¹˜å­æ³•å†™å‡ºå…¶Lagrangeä¹˜å­å‡½æ•°ã€‚æ ¹æ®è¿ç­¹å­¦å­¦è¿‡çš„çŸ¥è¯†ï¼ˆè¿ç­¹å­¦ ç¬¬ä¸‰ç« ç¬¬äº”è®² æœ‰çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜çš„KKTæ–¹æ³•ï¼‰ï¼š</p>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/or.JPG"></p>
<center>
Figure 4. æ¥è‡ªè¥¿å®‰äº¤å¤§ è¿ç­¹å­¦è¯¾ç¨‹ ç¿Ÿæ¡¥æŸ±è€å¸ˆç­‰
</center>
<p>â€‹ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶<span class="math inline">\(\zeta_i \text{ = max} (0, 1-y_i(\pmb{w}^T\pmb{x}_i+b))\)</span>æˆç«‹ï¼Œ<span class="math inline">\(\zeta_i\)</span>ä»ç„¶æ˜¯ä¸€ä¸ªäººä¸ºé€‰å–çš„å‚æ•°ï¼Œç”¨äºè§„å®šï¼šç¬¬iä¸ªæ•°æ®ç‚¹ç›¸å¯¹è¾¹ç•Œçš„åç¦»ï¼ˆè¿›å…¥é”™è¯¯åˆ†ç±»åŒºçš„æ·±åº¦ï¼‰å¤§å°å®¹è®¸å€¼ï¼Œæ‰€ä»¥å®é™…ä¸Š<span class="math inline">\(\zeta_i\)</span>å¹¶ä¸æ˜¯<span class="math inline">\(\pmb{w}\)</span>æˆ–è€…<span class="math inline">\(b\)</span>çš„å‡½æ•°ã€‚ <span class="math display">\[
\begin{equation}\label{equ:lag}
L(\pmb{w},b, \zeta_i,\lambda_i,\mu_i)=\frac 1n \sum_{i=1}^n\zeta_i+\frac{\lambda}{2}\Vert\pmb{w} \Vert^2-\sum_{i=1}^n\lambda_i[y_i(\pmb{w}^T\pmb{x}_i+b)+\zeta_i-1]-\sum_{i=0}^n\mu_i\zeta_i
\end{equation}
\]</span> â€‹ åˆ™ç”±KKTæ¡ä»¶ï¼Œéœ€è¦å¯¹<span class="math inline">\(\eqref{equ:lag}\)</span>å®šä¹‰çš„<span class="math inline">\(L(\pmb{w},b, \zeta_i,\lambda_i,\mu_i)\)</span>è¿›è¡Œå¾®åˆ†æ“ä½œã€‚ä¹Ÿå³æ‰€æœ‰åå¯¼æ•°éƒ½åº”è¯¥æ˜¯0ï¼š <span class="math display">\[
\begin{align}
&amp;\frac{\partial L}{\partial \pmb{w}} = \lambda\pmb{w} - \sum_{i=1}^n\lambda_iy_i\pmb{x_i} = 0\rightarrow\lambda\pmb{w} =\sum_{i=1}^n\lambda_iy_i\pmb{x_i}\label{equ:pw}\\
&amp;\frac{\partial L}{\partial b} =\sum_{i=1}^n \lambda_iy_i = 0\label{equ:pb}\\
&amp;\frac{\partial L}{\partial \zeta_i} = \frac 1n -\lambda_i-\mu_i = 0\label{equ:pz}
\end{align}
\]</span> â€‹ å°†å…¬å¼<span class="math inline">\(\eqref{equ:pw}\eqref{equ:pb}\eqref{equ:pz}\)</span>å¸¦å…¥åˆ°å…¬å¼<span class="math inline">\(\eqref{equ:lag}\)</span>ä¸­ï¼Œå¯ä»¥å¾—åˆ°Lagrangeå¯¹å¶é—®é¢˜ï¼Œæ˜¾ç„¶æœ‰ï¼š <span class="math display">\[
\begin{align}
&amp;\sum_{i=1}^n\lambda_i[y_i(\pmb{w}^T\pmb{x}_i+b)+\zeta_i-1] = 0 \quad\text{(KKTæ¡ä»¶)}\\ 
&amp;\begin{array}
&amp;L=\sum_{i=1}^n(\frac 1n-\lambda_i-\mu_i)\zeta_i+\frac{\lambda}{2}\Vert\pmb{w} \Vert^2-\sum_{i=1}^n\lambda_iy_i(\pmb{w}^T\pmb{x}_i+b)+\sum_{i=0}^n\lambda_i\\=\frac{\lambda}{2}\Vert\pmb{w} \Vert^2-\sum_{i=1}^n\lambda_iy_i\pmb{w}^T\pmb{x}_i+\sum_{i=0}^n\lambda_i
\end{array}\\
&amp;L=\frac{1}{2\lambda}\left (\sum_{i=1}^n\lambda_iy_i\pmb{x_i}\right)^T\sum_{i=1}^n\lambda_iy_i\pmb{x_i}-
\frac{1}{\lambda}\sum_{i=1}^n\lambda_iy_i\left(\sum_{j=1}^n\lambda_jy_j\pmb{x_j}\right)^T\pmb{x}_i+\sum_{i=0}^n\lambda_i
\end{align}
\]</span> â€‹ æœ€ååŒ–ç®€å¾—åˆ°ï¼Œç›¸å¯¹äºåŸé—®é¢˜ï¼ˆPrimalï¼‰ï¼Œæ­¤ä¸ºLagrangeå¯¹å¶é—®é¢˜ï¼Œæ³¨æ„åœ¨å¯¹å¶è®¨è®ºä¸‹ï¼Œéœ€è¦è¿›è¡Œæœ€å¤§åŒ–ã€‚ <span class="math display">\[
\begin{equation}\label{equ:dual}
L&#39;(\lambda_i)=\sum_{i=0}^n\lambda_i - \frac{1}{2\lambda}\left (\sum_{i=1}^n\lambda_iy_i\pmb{x_i}\right)^T\sum_{i=1}^n\lambda_iy_i\pmb{x_i}
\end{equation}
\]</span> â€‹ çº¦æŸæ¡ä»¶å¦‚ä½•å˜æ¢ï¼Ÿä¹Ÿå°±æ˜¯æ­¤å¤„æ¯ä¸ª<span class="math inline">\(\lambda_i\)</span>çš„çº¦æŸæ¡ä»¶æ˜¯ï¼Ÿé¦–å…ˆï¼Œå…¬å¼<span class="math inline">\(\eqref{equ:pb}\)</span>å®šä¹‰çš„çº¦æŸæ²¡æœ‰èƒ½å¤Ÿå¸¦å…¥åŸé—®é¢˜ä¸­ï¼Œäºæ˜¯ç§°ä¸ºå¯¹å¶é—®é¢˜çš„ä¸€ä¸ªçº¦æŸé¡¹ï¼Œå¹¶ä¸”<span class="math inline">\(\lambda_i\)</span>æœ¬èº«å°±æ˜¯å¤§äºç­‰äº0çš„ã€‚é‚£ä¹ˆå®ƒæœ‰ä¸Šç•Œå—ï¼Ÿæœ‰çš„ï¼Œç”±äºå…¬å¼<span class="math inline">\(\eqref{equ:pz}\)</span>ä¸­<span class="math inline">\(\mu_i\)</span>æ˜¯éè´Ÿçš„ï¼Œå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{equ:cond}
\text{s.t. }\sum_{i=1}^n \lambda_iy_i = 0 \text{ and } 0\le\lambda_i\le\frac 1n
\end{equation}
\]</span></p>
<p>â€‹ è€Œå®é™…ä¸Šï¼Œåªè¦èƒ½æ±‚å‡ºå…¬å¼<span class="math inline">\(\eqref{equ:dual}\)</span>å¯¹åº”çš„å¯¹å¶é—®é¢˜çš„è§£ï¼ˆ<span class="math inline">\(\lambda_i\)</span>ï¼‰ï¼Œä¹Ÿå°±å¯ä»¥æ ¹æ®å…¬å¼<span class="math inline">\(\eqref{equ:pw}\)</span>è®¡ç®—å‡º<span class="math inline">\(\pmb{w}\)</span>ï¼Œè€Œç”±æ‰€æœ‰çš„support vectorä»¥åŠ<span class="math inline">\(\pmb{w}\)</span>å¯ä»¥æ±‚å‡ºbï¼Œä¹Ÿå°±å”¯ä¸€ç¡®å®šäº†è¶…å¹³é¢ã€‚ä¹‹æ‰€ä»¥è¿›è¡Œå¯¹å¶å˜æ¢ï¼Œæ˜¯å› ä¸ºåŸé—®é¢˜å¤ªéš¾ä»¥è®¨è®ºäº†ï¼ŒåŸé—®é¢˜å¹¶ä¸æ˜¯ç®€å•çš„äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œå¹¶ä¸”å­˜åœ¨çƒ¦äººçš„<span class="math inline">\(\zeta_i\)</span>ï¼Œçº¦æŸæ¡ä»¶ä¹Ÿä»¤äººéš¾å—ï¼Œè€Œå¯¹å¶ä¹‹åï¼Œçº¦æŸå˜æˆäº†çº¿æ€§çš„ï¼Œå¹¶ä¸”ç›®æ ‡å‡½æ•°çš„å½¢å¼å˜å¾—ç®€å•äº†ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›äºŒæ¬¡è§„åˆ’çš„ç®—æ³•æ±‚å‡º<span class="math inline">\(\lambda_i\)</span>ã€‚</p>
<hr>
<h2 id="é€»è¾‘è‡ªå¾ªç¯">é€»è¾‘è‡ªå¾ªç¯ï¼Ÿ</h2>
<p>â€‹ å¼€å§‹æˆ‘å¯¹è¿™ä¸ªç®—æ³•çš„æ€æƒ³éå¸¸ä¸ç†è§£ã€‚æˆ‘èµ·åˆè®¤ä¸ºï¼š</p>
<blockquote>
<ul>
<li>ç»™å®šäº†è¶…å¹³é¢ï¼Œæ‰çŸ¥é“ä¸åŒç±»åˆ«ä¸­å“ªä¸ªæ•°æ®ç‚¹è·ç¦»è¶…å¹³é¢æœ€è¿‘</li>
<li>ç»™å®šäº†æ”¯æŒå‘é‡ï¼Œæ‰èƒ½æ±‚å‡ºè¶…å¹³é¢å‚æ•°æ¥ï¼ˆé—´éš”æœ€å¤§å˜›ï¼‰</li>
</ul>
</blockquote>
<p>â€‹ è¿™ä¸¤ç‚¹çœ‹èµ·æ¥å°±è·Ÿæ‚–è®ºä¸€æ ·ï¼Œè§£å†³å…¶ä¸­ä¸€ç‚¹ä»¿ä½›æ˜¯è¦åŸºäºå¦ä¸€ç‚¹çš„è§£å†³ã€‚ä½†æœ€åæˆ‘ä»¬åŒ–ç®€å¾—åˆ°çš„ç›®æ ‡å‡½æ•°å´å¾ˆæœ‰è¶£ï¼š<span class="math inline">\(\eqref{equ:dual}\)</span>ä¸­å¹¶æ²¡æœ‰å‡ºç°ã€ï¼ˆ1ï¼‰è¶…å¹³é¢å‚æ•°ï¼ˆ2ï¼‰é€‰è°ä¸ºæ”¯æŒå‘é‡ ã€‘çš„ä¿¡æ¯ã€‚</p>
<p>â€‹ è§£å¼€è¿™ä¸ªâ€œè‡ªå¾ªç¯â€çš„å…³é”®åœ¨äºå¯¹å¶é—®é¢˜çš„<span class="math inline">\(\lambda_i\)</span>ï¼Œå¯¹å¶é—®é¢˜çš„è§£å†³ç¡®å®æ˜¯ä¸ä¾èµ–äºä»¥ä¸Šä¿¡æ¯çš„ï¼Œå®ƒæ˜¯æ ¹æ®æ‰€æœ‰çš„è®­ç»ƒæ ·æœ¬ç‚¹ä¼˜åŒ–å‡ºæ¥çš„ï¼Œè€Œè¿™ä¸ª<span class="math inline">\(\lambda_i\)</span>å®é™…ä¸Šå°±è•´å«äº†æ”¯æŒå‘é‡çš„ä¿¡æ¯ã€‚å‡è®¾<span class="math inline">\(\lambda_k = 0\)</span>ï¼Œç”±å…¬å¼<span class="math inline">\(\eqref{equ:pw}\)</span>çŸ¥ï¼Œæ ·æœ¬<span class="math inline">\(x_k\)</span>å°±ä¸å½±å“<span class="math inline">\(\pmb{w}\)</span>çš„è®¡ç®—äº†ï¼Œä¹Ÿå°±æ˜¯è¯´<span class="math inline">\(x_k\)</span>å°±ä¸æ˜¯æ”¯æŒå‘é‡ã€‚<span class="math inline">\(\lambda_i\)</span>ä¸ä¸º0çš„æ•°æ®æ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„æ”¯æŒå‘é‡ï¼Œä»–ä»¬æ‰å‚ä¸è®¡ç®—ï¼Œå†³å®šè¶…å¹³é¢ã€‚</p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼šç®—æ³•çš„æ¨å¯¼é€»è¾‘æœ‰èµ–äºè¿™æ ·çš„ä¸€ä¸ªâ€œé€»è¾‘è‡ªå¾ªç¯â€ï¼Œå› ä¸ºåªè¦å¾ªç¯ä¹‹ä¸­çš„ä¸€ä¸ªç¯èŠ‚è¢«è§£å†³äº†ï¼Œå¦ä¸€ä¸ªç¯èŠ‚ä¹Ÿå°±éšä¹‹è§£å†³äº†ã€‚è€Œé€šè¿‡å·§å¦™çš„æ•°å­¦å˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç»•å¼€â€œè‡ªå¾ªç¯â€çš„æ–¹æ³•ï¼Œé€šè¿‡ä¼˜åŒ–å…ˆæ±‚å‡ºè•´å«äº†æ”¯æŒå‘é‡é€‰å–æ„ä¹‰çš„<span class="math inline">\(\lambda_i\)</span>ï¼Œå†æ±‚å‡ºè¶…å¹³é¢å‚æ•°<span class="math inline">\(\pmb{w},b\)</span>ã€‚</p>
<hr>
<h2 id="smo-äºŒæ¬¡è§„åˆ’æ±‚è§£">SMO äºŒæ¬¡è§„åˆ’æ±‚è§£</h2>
<p>â€‹ SMOï¼ˆSequential Minimal Optimizationï¼‰<a href="#ref">[3]</a> æ˜¯ä¸€ä¸ªSVMç®—æ³•å¯¹å¶é—®é¢˜çš„å¿«é€Ÿè®¡ç®—æ–¹æ³•ï¼Œå®ƒå¯ä»¥æå¤§åœ°å‡å°å†…å­˜ç©ºé—´æ¶ˆè€—ï¼Œå¹¶ä¸”å…¶è§£æ˜¯è§£æçš„ï¼Œè€Œä¸éœ€è¦å¯¹QPå¯¹å¶é—®é¢˜<span class="math inline">\(\eqref{equ:dual}\)</span>è¿›è¡Œå¤æ‚çš„æ•°å€¼è§£è®¡ç®—ã€‚SMOçš„ä¸¤å¤§ç²¾é«“æ€æƒ³æ˜¯ï¼š</p>
<ul>
<li>å‚æ•°è¿­ä»£è®¡ç®—â€œåˆ†æ²»â€å¾—åˆ°ä¸€ä¸ªä¸ªçš„QP sub-problemsï¼Œæ¯ä¸ªsub-problemåªéœ€è¦è§£ä¸€ä¸ªä¸¤å‚æ•°QPä¼˜åŒ–é—®é¢˜ã€‚</li>
<li>ä½¿ç”¨ä¸€ä¸ªå¯å‘å¼ç®—æ³•ï¼Œé€‰æ‹©æ¯æ¬¡è¿›è¡Œè¿­ä»£çš„ä¸¤ä¸ªå‚æ•°ã€‚</li>
</ul>
<p>â€‹ ç”±äºè®ºæ–‡<a href="#ref">[3]</a>ä¸­ï¼Œå¯å‘å¼ç®—æ³•éƒ¨åˆ†æˆ‘æ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œåªçœ‹æ‡‚å­é—®é¢˜åˆ†å‰²éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨æ¥ä¸‹æ¥çš„ç®—æ³•å®ç°è¿‡ç¨‹ä¸­ï¼Œåªå®ç°éå¯å‘å¼ï¼ˆéšæœºçš„ï¼‰å‚æ•°é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªéå¯å‘çš„SMOï¼Œæ•ˆç‡ä¸Šå¯èƒ½ä¼šä½ä¸€äº›ã€‚</p>
<blockquote>
<p>In order to speed convergence, SMO uses heuristics to choose which two Lagrange multipliers to jointly optimize.</p>
</blockquote>
<p>â€‹ æœ‰å…³KKTæ¡ä»¶ä¸æ»¡è¶³ç‚¹çš„åˆ é™¤ä»¥åŠéè¾¹ç•Œç‚¹çš„å¤„ç†è¿™é‡Œæ²¡æœ‰çœ‹æ‡‚ï¼ˆä¸æ˜¯å¾ˆæ¸…æ¥šè¿™æ ·åšçš„ç†ç”±ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œå¯èƒ½å¯¹KKTæ¡ä»¶çš„ç†è§£ä¸å¤Ÿæ·±å…¥å§ï¼Œä¸å¤ªèƒ½æƒ³æ¸…æ¥š ä¸æ»¡è¶³KKTæ¡ä»¶å¯¹ä¼˜åŒ–çš„å½±å“ï¼‰ã€‚æ‰€ä»¥æ•´ä¸ª2.2å°èŠ‚è¯»å®Œä¹‹åï¼Œåœ¨å®ç°ä¸­éƒ½ç•¥è¿‡äº†ã€‚</p>
<h3 id="kernel-éçº¿æ€§">Kernel éçº¿æ€§</h3>
<p>â€‹ ä¸ºäº†ä½¿è®¨è®ºä¸å¤±ä¸€èˆ¬æ€§ï¼Œä¸Šæ¥å°±åº”è¯¥è®¨è®ºæ ¸å‡½æ•°è¡¨ç¤ºä¸‹çš„SVMï¼Œè€Œéä¹‹å‰å°èŠ‚ä¸­æ¨å¯¼çš„çº¿æ€§SVMï¼ˆçº¿æ€§SVMä¹Ÿå°±æ˜¯æ ¸å‡½æ•°æ˜¯æ ‡å‡†å†…ç§¯çš„æƒ…å†µï¼‰ã€‚</p>
<p>â€‹ ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯æ ‡å‡†å†…ç§¯æ ¸ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå‘é‡ç›´æ¥è¿›è¡Œå†…ç§¯æ“ä½œã€‚åœ¨å…¬å¼<span class="math inline">\(\eqref{equ:dual}\)</span>ä¸­ï¼Œç”¨åˆ°äº†å†…ç§¯ï¼Œå› ä¸ºå…¬å¼<span class="math inline">\(\eqref{equ:dual}\)</span>å®é™…å¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{equ:dot}
L&#39;(\lambda_i)=\sum_{i=0}^n\lambda_i
-\frac{1}{2\lambda}\sum_{i=1}^{n}\sum_{j=1}^n\lambda_i\lambda_jy_iy_j\pmb{x}_i^T\pmb{x}_j
\end{equation}
\]</span> â€‹ è€Œç›´æ¥å†…ç§¯å¯¹åº”çš„æ˜¯çº¿æ€§çš„ç©ºé—´ã€‚å¦‚æœå¯¹xåšéçº¿æ€§å˜æ¢ï¼Œè¾¾åˆ°ç©ºé—´å˜æ¢çš„ç›®çš„ï¼Œåœ¨å˜æ¢åçš„ç©ºé—´ä¸‹æ˜¯çº¿æ€§çš„è¶…å¹³é¢ï¼Œä½†åœ¨åŸç©ºé—´ä¸‹å·²ç»å˜æˆåˆ«çš„å½¢çŠ¶ï¼Œä½¿å¾—åŸæœ¬çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®åœ¨æ–°ç©ºé—´ä¸‹å¯åˆ†ã€‚ <span class="math display">\[
\begin{equation}\label{equ:kernel}
k(\pmb{x}_i, \pmb{x}_j)=\phi(\pmb{x}_i)\phi(\pmb{x}_j)
\end{equation}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{equ:dot}\)</span>ä¸­çš„å†…ç§¯é¡¹æ›¿æ¢ä¸ºå…¬å¼<span class="math inline">\(\eqref{equ:kernel}\)</span>çš„æ ¸å‡½æ•°å³å¯ã€‚</p>
<h3 id="å‚æ•°åˆ†æ²»">å‚æ•°â€œåˆ†æ²»â€</h3>
<p>â€‹ SMOç®—æ³•åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿä¸ªäººæ„Ÿè§‰è¿™æœ‰ç‚¹åƒcoordinate descentï¼Œä½†æ˜¯æ„Ÿè§‰ç®€å•çš„coordinate descentæ— æ³•èƒœä»»SVMå¯¹å¶é—®é¢˜çš„æ±‚è§£ã€‚å› ä¸ºå¼<span class="math inline">\(\eqref{equ:cond}\)</span>ä¸­å®šä¹‰äº†çº¿æ€§çº¦æŸï¼Œcoordinate descentæ²¡æœ‰åŠæ³•ç›´æ¥æ»¡è¶³çº¿æ€§çº¦æŸã€‚åœ¨è®ºæ–‡ä¸­ï¼ˆSMOç®—æ³•è®ºæ–‡ï¼‰ï¼Œä½œè€…ä¹Ÿè¯´åˆ° é—®é¢˜çš„æœ€å°è®¨è®ºå‚æ•°ä¸ªæ•°ä¸º2ï¼Œå› ä¸ºåªè®¨è®ºä¸€ä¸ªå‚æ•°æ—¶æ— æ³•æ»¡è¶³çº¿æ€§çº¦æŸæ¡ä»¶ã€‚äºæ˜¯ä½œè€…çœŸå°±ä¸¤ä¸ªä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¨è®ºï¼Œä½œè€…è¯´åˆ°ï¼š</p>
<blockquote>
<p>The advantage of SMO lies in the fact that solving for two Lagrange multipliers can be done analytically.</p>
</blockquote>
<p>â€‹ ç¡®å®å¦‚æ­¤ï¼Œå¹¶ä¸”è¿™ä¸ªè§£æè§£çš„æ¨å¯¼è¿˜ç®—æ¯”è¾ƒç®€å•ã€‚ç”±äºSMOä¸­sub-problemæ±‚è§£çš„è®ºæ–‡æ€è·¯æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œåœ¨æ­¤å¤„åªç®€å•å›é¡¾ä¸€ä¸‹è®ºæ–‡çš„æ–¹æ³•ã€‚</p>
<h4 id="i.-çº¦æŸç¡®å®š">I. çº¦æŸç¡®å®š</h4>
<p>â€‹ ç”±äºåªé€‰å–ä¸¤ä¸ªå‚æ•°ï¼Œç»´åº¦å¥½ä½å•Šï¼Œå¯ä»¥è¿›è¡Œå¯è§†åŒ–ã€‚æ³¨æ„æˆ‘è‡ªå·±çš„æ¨å¯¼å’Œã€Šæ¨¡å¼è¯†åˆ«ã€‹ä¹¦ä»¥åŠSMOè®ºæ–‡ä¸Šçš„é—®é¢˜å½¢å¼å‡ä¸åŒï¼Œä¹¦ä»¥åŠè®ºæ–‡å‡æ˜¯<span class="math inline">\(C\)</span>å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯ä¸‹å¼å®šä¹‰çš„lossï¼Œä¸ºäº†ä¸è®ºæ–‡ä¸€è‡´ï¼Œæˆ‘ç°åœ¨å°±è®¨è®ºå…¬å¼<span class="math inline">\(\eqref{equ:book}\)</span>ï¼‰å®šä¹‰çš„losså¯¼å‡ºçš„å¯¹å¶é—®é¢˜ï¼š <span class="math display">\[
\begin{equation}\label{equ:book}
C\sum_{i=1}^n\zeta_i+\frac{1}{2}\Vert\pmb{w} \Vert^2
\end{equation}
\]</span> â€‹ ç”±çº¦æŸé¡¹<span class="math inline">\(\eqref{equ:cond}\)</span>ç»“åˆä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œé€‰å–çš„<span class="math inline">\(\alpha_i(å³\lambda_i),\alpha_j\)</span>çš„çº¿æ€§çº¦æŸä¸constatntå€¼çº¦æŸåœ¨äºŒç»´æƒ…å†µä¸‹å¾ˆç®€å•ã€‚åˆ†<span class="math inline">\(y_i==y_j\)</span>æ˜¯å¦ä¸ºtrueä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œæ¯ç§å­˜åœ¨ä¸¤ä¸ªæƒ…å†µï¼ˆè®ºæ–‡ä¸­æ¯ç§åªç”»å‡ºä¸€æ¡çº¿æ€§çº¦æŸçš„å¯è§†åŒ–å›¾ï¼Œçº¢çº¿æ˜¯æˆ‘åæ¥åŠ ä¸Šçš„ï¼‰ï¼š</p>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/fig1.JPG"></p>
<center>
Figure 5. äºŒç»´çº¦æŸå¯è§†åŒ–
</center>
<p>â€‹ æ¯æ¬¡åªéœ€åœ¨è¿™æ–œç‡ä¸º<span class="math inline">\(\pm1\)</span>çš„çº¿æ®µä¸Šæ±‚çº¦æŸæå°å€¼ï¼ˆäºŒæ¬¡å‡½æ•°ï¼ˆçº¿æ€§æ ¸ï¼‰æˆ–æ˜¯å…¶ä»–å‡¸é—®é¢˜ï¼ˆéçº¿æ€§æ ¸ï¼‰ï¼‰å³å¯ã€‚</p>
<h4 id="ii.-æå€¼æ±‚è§£">II. æå€¼æ±‚è§£</h4>
<p>â€‹ æ˜¾ç„¶ï¼Œç”±äºåªæœ‰ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œæ ¹æ®çº¿æ€§çº¦æŸï¼Œä¸€ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå‚æ•°è¡¨ç¤ºï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å…ˆæ›´æ–°ä¸€ä¸ªå‚æ•°ï¼Œå†æ ¹æ®æ›´æ–°å€¼æ±‚å¦ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå®Œæˆè¿­ä»£ã€‚é‚£ä¹ˆåœ¨æ±‚å…¶ä¸­ä¸€ä¸ªå‚æ•°æ—¶ï¼Œæ ¹æ®çº¿æ€§çº¦æŸï¼Œé—®é¢˜å°±ä¼˜ç‚¹ç±»ä¼¼äºcoordinate descentäº†ã€‚</p>
<ul>
<li>é¦–å…ˆç¡®å®šå¸¦ä¼˜åŒ–å‚æ•°çš„å€¼åŒºé—´(L, H)</li>
<li>æ±‚ä¸€ç»´æœ€å°å€¼é—®é¢˜çš„æå€¼ç‚¹<span class="math inline">\(\alpha^{new}\)</span></li>
<li><span class="math inline">\(\alpha^{new}\)</span>å¯èƒ½ä¸åœ¨(L, H)èŒƒå›´å†…ï¼Œæ ¹æ®å•å³°ä»¥åŠå‡¸æ€§éœ€è¦è¿›è¡Œclipping
<ul>
<li><span class="math inline">\(\alpha^{new} &gt; H\)</span>ï¼Œåˆ™æœ€å°å€¼åœ¨Hå¤„å–å¾—</li>
<li>åä¹‹<span class="math inline">\(\alpha^{new}&lt;L\)</span>åˆ™æœ€å°å€¼åœ¨Lå¤„å–å¾—</li>
<li>å¦åˆ™ <span class="math inline">\(\alpha^{new}\in(L,H)\)</span>ï¼Œæœ€åçš„æå°å€¼ç‚¹å°±æ˜¯<span class="math inline">\(\alpha^{new}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[
\begin{equation}\label{equ:update}
\alpha_2^{new}=\alpha_2+\frac{y_2(E_1-E_2)}{\eta}\\
\text{where } \eta = k(\pmb{x}_1, \pmb{x}_1)+k(\pmb{x}_2, \pmb{x}_2)-2k(\pmb{x}_1, \pmb{x}_2)
\end{equation}
\]</span></p>
<p>â€‹ æ­¤å¤„<span class="math inline">\(\eta\)</span>æ˜¯å…¬å¼<span class="math inline">\(\eqref{equ:dot}\)</span>åœ¨æ ¸å‡½æ•°æ›¿æ¢ä¸‹çš„ç›®æ ‡å‡½æ•°çš„ äºŒé˜¶å¯¼ã€‚Eåˆ™æ˜¯é¢„æµ‹è¯¯å·®<span class="math inline">\(u_{pred}-y_i\)</span>ã€‚æ„Ÿè§‰æ›´æ–°å¼<span class="math inline">\(\eqref{equ:update}\)</span>æœ‰ç‚¹åƒç‰›é¡¿æ³•çš„è¿­ä»£è¿‡ç¨‹ã€‚åˆ™æ ¹æ®çº¿æ€§çº¦æŸï¼Œ<span class="math inline">\(\alpha_1\)</span>æ›´æ–°åçš„å€¼ä¹Ÿå¯ä»¥å†™å‡ºæ¥ã€‚</p>
<h4 id="iii.-è®¡ç®—éœ€è¦çš„ç»“æœ">III. è®¡ç®—éœ€è¦çš„ç»“æœ</h4>
<p>â€‹ æ¯ä¸€æ­¥<span class="math inline">\(\alpha_1,\alpha_2\)</span>æ›´æ–°éƒ½å¯ä»¥æ ¹æ®æ–°çš„å€¼è®¡ç®—ä¸€æ¬¡<span class="math inline">\(\pmb{w},b\)</span>ã€‚å½“æ‰€æœ‰å‚æ•°è®¡ç®—å®Œæ¯•ä¹‹åï¼Œç®—æ³•ä¹Ÿå°±ç»“æŸäº†ã€‚<span class="math inline">\(\pmb{w}^{new}\)</span>æ€ä¹ˆæ¥çš„å¾ˆå¥½æ‡‚ï¼Œè€Œ<span class="math inline">\(b\)</span>çš„æ›´æ–°è¿­ä»£è¿‡ç¨‹ç›¸å¯¹éº»çƒ¦ä¸€äº›ã€‚ç”±äº<span class="math inline">\(b=\pmb{w}^Tx_i-y_i\)</span>æˆç«‹ï¼Œåœ¨kernelå­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œbæ˜¯ï¼š <span class="math display">\[
b=\left[
\sum_{i=1}^n\lambda_iy_ik(\pmb{x}_j, \pmb{x}_i)
\right] -y_i
\]</span> â€‹ æ ¹æ®ä¸Šå¼è¿›è¡Œæ›´æ–°ï¼Œå†™å‡ºç›¸å¯¹å€¼è¡¨è¾¾å¼å³å¯ã€‚</p>
<hr>
<h2 id="å®ç°smoç®—æ³•">å®ç°SMOç®—æ³•</h2>
<p>â€‹ è®ºæ–‡ä¸­ç»™å‡ºäº† ç»™å®šä¸¤ä¸ªæ•°æ®æ—¶è®¡ç®—çš„ä¼ªä»£ç ã€‚æŒ‰ç…§è®ºæ–‡è¿›è¡Œå®ç°ï¼Œä»£ç è§<a href="https://github.com/Enigmatisms/TorchLearning/blob/master/optim/svm.py">Github Repository ğŸ”—:TorchLearning</a>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/res1.png"></th>
<th style="text-align: center;"><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/res2.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">è·ç¦»é€‚ä¸­</td>
<td style="text-align: center;">è·ç¦»è¾ƒè¿œ</td>
</tr>
<tr class="even">
<td style="text-align: center;"><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/res3.png"></td>
<td style="text-align: center;"><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/res4.png"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">å­˜åœ¨è¾ƒå¤§é‡å </td>
<td style="text-align: center;">å­˜åœ¨è¾ƒå°é‡å </td>
</tr>
</tbody>
</table>
<p>â€‹ åœ¨ä½¿ç”¨ä¸åŒçš„éšæœºæ•°æ®è¿›è¡Œè¶…å¹³é¢æ±‚è§£æ—¶å‘ç°ï¼Œå­˜åœ¨å½“Cè¿‡å¤§æ—¶ï¼Œå¯¼è‡´è®¡ç®—çš„è¶…å¹³é¢å®Œå…¨é”™è¯¯çš„é—®é¢˜ã€‚SMOç®—æ³•çš„æ”¶æ•›é€Ÿåº¦çœ‹èµ·æ¥æå¿«ï¼Œé€šå¸¸åªéœ€è¦è¿­ä»£3-6æ¬¡å°±èƒ½æ”¶æ•›ã€‚æ³¨æ„ï¼Œåœ¨è¿™é‡Œæ•°æ®ç‚¹å¹¶ä¸ç®—å¤šï¼š</p>
<ul>
<li>ç»´æ•°3ï¼Œæ­£è´Ÿç±»æ€»å’Œåªæœ‰84ä¸ªæ ·æœ¬ã€‚</li>
</ul>
<hr>
<h2 id="å…¶ä»–çš„è®¨è®º">å…¶ä»–çš„è®¨è®º</h2>
<h3 id="ç©ºé—´å˜æ¢">ç©ºé—´å˜æ¢</h3>
<p>â€‹ ä¹‹å‰æˆ‘å°±å¬è¯´ï¼ŒSVMæ˜¯å°†ä½ç»´æ•°æ®å‡ç»´åˆ°é«˜ç»´ç©ºé—´ï¼Œä½ç»´ä¸­ä¸å¥½è¿›è¡Œåˆ†ç±»çš„æ•°æ®ï¼Œé«˜ç»´ä¸‹å¯èƒ½å¯ä»¥å¾ˆå¥½åˆ†å¼€ã€‚ä½†æ˜¯è¯»å®ŒåŸç†ï¼Œå®ç°å®Œä»£ç ä¹‹åä¹Ÿæ²¡æœ‰å‘ç°å“ªé‡Œæœ‰ç»´åº¦çš„å‡é«˜ã€‚</p>
<p>â€‹ å®é™…ä¸Šï¼Œç»´åº¦çš„å‡é«˜åœ¨æ ¸å‡½æ•°ä¸­â€œæœ‰æ‰€ä½“ç°â€ï¼Œåœ¨<a href="https://zhuanlan.zhihu.com/p/57648645">ã€è¿™ç¯‡æ–‡ç« ã€‘</a>ä¸­ï¼Œä½œè€…æåˆ°ï¼š</p>
<blockquote>
<p>é‚£æˆ‘ä»¬æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†æ•°æ®æ˜ å°„åˆ°é«˜ç»´ç©ºé—´å‘¢ï¼Ÿå³åˆ›å»ºä¸€äº›æ–°çš„ç‰¹å¾ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºç‰¹å¾ <span class="math inline">\(x_3=x^2,x_4=y^2\)</span></p>
</blockquote>
<p>â€‹ è™½ç„¶çœ‹èµ·æ¥ç»´æ•°ä»(x, y)å˜ä¸ºäº†<span class="math inline">\((x, y, x_3, x_4)\)</span>ï¼Œä½†æ˜¯<span class="math inline">\(x_3,x_4\)</span>å¹¶ä¸æ˜¯ç‹¬ç«‹çš„ç»´åº¦ï¼Œä¸ªäººå€¾å‘äºè®¤ä¸ºè¿™æ˜¯åœ¨åŸç©ºé—´å¯¹æ•°æ®çš„ç©ºé—´åˆ†å¸ƒè¿›è¡Œäº†å˜æ¢ã€‚æ¯”å¦‚è¯´å°†ä¸¤ç±»ç¯å½¢ï¼ˆåŒå¿ƒåœ†ï¼‰åˆ†å¸ƒçš„æ•°æ®å˜æ¢åˆ°ç›¸åŒç»´åº¦çš„å¦ä¸€ä¸ªç©ºé—´ä¸‹ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªç©ºé—´ä¸‹ä¸¤ç±»æ•°æ®æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚å½“ç„¶ï¼Œéè¦è¯´è¿™æ˜¯é«˜ç»´ç©ºé—´ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥å§ã€‚</p>
<p>â€‹ æ ¸å‡½æ•°æ–¹æ³•å›ºç„¶æ˜¯çº¿æ€§çš„éçº¿æ€§è¿ˆå‡ºçš„ä¸€å¤§æ­¥ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰æ ¸å‡½æ•°çš„é€‰æ‹©æœ‰èµ–äºæ•°æ®çš„ç©ºé—´åˆ†å¸ƒã€‚åœ¨ä¸æ˜åˆ†å¸ƒçš„æƒ…å†µä¸‹ï¼Œéšæ„é€‰æ‹©æ ¸å‡½æ•°å°†ä¼šé€ æˆåˆ†ç±»èƒ½åŠ›çš„ä¸‹é™ï¼Œé äººå·¥æ¯”è¾ƒé€‰æ‹©æ˜¾ç„¶ä¸æ˜¯ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚</p>
<h3 id="å¤šåˆ†ç±»é—®é¢˜">å¤šåˆ†ç±»é—®é¢˜</h3>
<p>â€‹ SVMæ˜¯å…¸å‹çš„äºŒåˆ†ç±»åˆ†ç±»å™¨ï¼Œä½†æˆ‘ä»¬ç”¨çš„SVMå´æœ‰å¤šåˆ†ç±»çš„èƒ½åŠ›ã€‚å…³äºå¤šåˆ†ç±»ï¼Œä¸ªäººçš„æƒ³æ³•æ˜¯ï¼š</p>
<ul>
<li>å¯¹æ¯ä¸ªç±»ï¼Œåªéœ€è¦åŒºåˆ†æœ¬ç±»å’Œå…¶ä»–å³å¯ã€‚æ„å»ºä¸€ä¸ªä¸ªçš„æœ¬ç±»ä»¥åŠå…¶ä»–ç±»çš„äºŒåˆ†ç±»é—®é¢˜åº”è¯¥å°±å¯ä»¥ã€‚</li>
</ul>
<p>â€‹ ç»´åŸºä¸Šè¯´ï¼š</p>
<blockquote>
<p>Building binary classifiers that distinguish between one of the labels and the rest (<em>one-versus-all</em>) or between every pair of classes (<em>one-versus-one</em>).</p>
</blockquote>
<p>â€‹ ä¸ªäººæ›´å€¾å‘äºone-versus-oneå½¢å¼çš„ã€‚åœ¨ã€Šæ¨¡å¼è¯†åˆ«ã€‹ä¸€ä¹¦ä¸Šä»‹ç»äº†å¦‚ä½•å¤„ç†å¤šåˆ†ç±»é—®é¢˜ï¼ˆæ„Ÿè§‰åƒæ˜¯one-versus-allå½¢å¼çš„ï¼‰ã€‚è€Œone-versus-oneå­˜åœ¨è¿™æ ·çš„ç‰¹ç‚¹ï¼ˆä¸ªäººè®¤ä¸ºï¼‰ï¼š</p>
<ul>
<li>å®ç°ç®€å•ï¼Œä¸éœ€è¦åšè¿‡å¤šç®—æ³•æ”¹åŠ¨ï¼Œå¯ä»¥ç›´æ¥ç”±å¤šä¸ªäºŒåˆ†ç±»SVMç»„åˆï¼ˆä¼˜ç‚¹ï¼‰</li>
<li>å†…å­˜/è®¡ç®—èµ„æºæ¶ˆè€—å¤§ï¼Œæ¯ä¸¤ä¸ªæ•°æ®ç±»åˆ«ä¹‹é—´éƒ½éœ€è¦è®¡ç®—/å‚¨å­˜ä¸€ä¸ª<span class="math inline">\(\pmb{w},b\)</span>ï¼ˆç¼ºç‚¹ï¼‰</li>
</ul>
<p>â€‹ æ ¹æ®one-versus-oneæ€æƒ³ä»¥åŠäºŒåˆ†ç±»SVMæ„å»ºçš„ä¸€ä¸ªå¤šåˆ†ç±»SVMç»“æœå¦‚ä¸‹ï¼ˆåªç”»å‡ºè¶…å¹³é¢ / æ•°æ®ï¼‰ï¼Œå¦‚æœéœ€è¦è¿›è¡Œpredictï¼Œpredictæ€æƒ³å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ±‚æ‰€æœ‰çš„äºŒåˆ†ç±»SVM predictï¼Œå¯¹æ¯ä¸€ç±»è¿›è¡Œç´¯åŠ ï¼ˆå¯ä»¥ç”¨ä¸€ä¸ªlistä¿å­˜æ¯ä¸€ç±»ç´¯åŠ ç»“æœï¼‰</li>
<li>å–ç´¯åŠ å€¼æœ€å¤§çš„ç±»ï¼ˆç®€å•çš„æƒ³æ³•ï¼Œå¯¹äºä¸€ä¸ªæ•°æ®ç‚¹ï¼Œå…¶è½åœ¨æ­£ç¡®çš„ç±»ä¸­æ—¶ï¼Œåœ¨æ¯ä¸ªäºŒåˆ†ç±»SVMä¸­çš„è¾“å‡ºåº”è¯¥éƒ½ä¸º1ï¼‰ä½œä¸ºpredictå€¼ã€‚</li>
</ul>
<p><img src="/2021/02/24/SVM%E7%AE%97%E6%B3%95%E4%B8%8E%E5%AE%9E%E7%8E%B0/res5.png"></p>
<center>
Figure 6. å¤šåˆ†ç±»one-versus-oneçš„è¶…å¹³é¢
</center>
<hr>
<h2 id="reference">Reference</h2>
<p><span id="ref"></span></p>
<p>[1] By Larhmam - Own work, CC BY-SA 4.0,<a href="https://commons.wikimedia.org/w/index.php?curid=73710028">linkğŸ”—</a></p>
<p>[2] Wikipedia, <a href="https://en.wikipedia.org/wiki/Support-vector_machine">Support-vector machine</a></p>
<p>[3] Platt, John (1998). <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr-98-14.pdf">"Sequential Minimal Optimization: A Fast Algorithm for Training Support Vector Machines"</a></p>
<p>[4] å¼ å­¦å·¥ï¼ˆç¼–è‘—ï¼‰ï¼Œæ¨¡å¼è¯†åˆ«ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ï¼Œæ¸…åå¤§å­¦å‡ºç‰ˆç¤¾</p>
<p></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>ML</tag>
      </tags>
  </entry>
  <entry>
    <title>Swin Transformer å¤ç°</title>
    <url>/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="swin-transformer">Swin Transformer</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ Swin Transformerè·ICCV best paperä¹‹åï¼Œå°±æ€»æœ‰å¾ˆå¤šäººæèµ·å®ƒã€‚ä¸ªäººåœ¨å‰æ®µæ—¶é—´å¤ç°äº†ä¸€ä¸ªä¸ViTç›¸å…³çš„å·¥ä½œï¼ˆCompact Convolution Transformerï¼‰ï¼Œæ„Ÿè§‰å®ç°å¤ªç®€å•ï¼ˆè®­ç»ƒéš¾ï¼‰ï¼Œé‚æƒ³å°è¯•ä¸€äº›æ›´åŠ å¤æ‚çš„å·¥ä½œã€‚åŒæ—¶æˆ‘å½“ç„¶ä¹Ÿæƒ³çœ‹çœ‹best paperåˆ°åº•æ˜¯ä»€ä¹ˆæ°´å¹³ã€‚æ­¤è®ºæ–‡å†™å¾—å¾ˆæ¸…æ™°ï¼Œå®éªŒåšå¾—éå¸¸æ¼‚äº®ï¼Œæ€æƒ³ä¹Ÿå¾ˆæœ‰è¶£ï¼Œä¸è¿‡å¯ä»¥è¯´æ˜¯ä¸€ç¯‡typicalç¥ç»ç½‘ç»œæ–‡ç« ï¼š<strong><u>ä¸€ä¸ªå…¬å¼éƒ½æ²¡æœ‰</u></strong>ï¼ˆattentionå…¬å¼ä»¥åŠå¤æ‚åº¦è®¡ç®—å…¬å¼ä¸ç®—ï¼‰ã€‚ä¸ªäººè™½ç„¶æƒŠå¹äºå…¶SOTAè¡¨ç°ï¼Œä½†ç”±äºå­˜åœ¨ä¸å¯è§£é‡Šçš„é­”æ³•ï¼Œä¹Ÿå§‹ç»ˆè§‰å¾—å¾ˆè†ˆåº”ã€‚æœ¬æ–‡æ˜¯æˆ‘åœ¨å¤ç°è¿‡ç¨‹ä¸­çš„æ•´ç†çš„ä¸€äº›æ€è·¯å’Œæˆ‘è§‰å¾—æœ¬è®ºæ–‡ä¸­ç–‘éš¾ä¹‹å¤„åŠå…¶ç†è§£ã€‚å¤ç°è§ï¼š<a href="https://github.com/Enigmatisms/Maevit/tree/master/swin">Github/Maevit(è¿™å®é™…æ˜¯ViTçš„å¤ç°repo)</a></p>
<p>â€‹ è®ºæ–‡åŸæ–‡ï¼š<a href="https://arxiv.org/abs/2103.14030">Liu, Ze, et al. "Swin transformer: Hierarchical vision transformer using shifted windows." <em>arXiv preprint arXiv:2103.14030</em> (2021).</a></p>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/intro.png"></p>
<center>
Figure 1. è‰ºæœ¯ä¹‹å›½ï¼šè¿˜æœ‰ä¸€ä¸ªXJTUçš„ï¼ˆMSRA nbï¼‰[1]
</center>
<span id="more"></span>
<h2 id="ii.-some-points">II. Some Points</h2>
<h3 id="å¤æ‚åº¦">2.1 å¤æ‚åº¦</h3>
<p>â€‹ å¤æ‚åº¦è®¡ç®—ï¼ˆäºŒæ¬¡éƒ¨åˆ†ï¼‰ï¼šå›¾åƒå¤§å°ä¸º<span class="math inline">\(h\times w\)</span>ï¼Œé‚£ä¹ˆç”±åˆ†å—å¤§å°ä¸ºMï¼Œå¯ä»¥å¾—åˆ°<span class="math inline">\(h\times w/M^2\)</span>ä¸ªpatchï¼Œæ¯ä¸ªpacthçš„å¤§å°æ˜¯<span class="math inline">\(M^2\)</span>ã€‚è€Œå¯¹äºä¸€ä¸ªpatchï¼Œç›¸å½“äºæ˜¯ç”¨ä¸€ä¸ªå°ViTï¼Œå¯¹<span class="math inline">\(M^2\)</span> patch tokenè¿›è¡Œ â€œglobalâ€ attentionï¼Œå¤æ‚åº¦<span class="math inline">\(O({(M^2)}^2)=O(M^4)\)</span>æ•…æ€»å¤æ‚åº¦ï¼š<span class="math inline">\(O(M^2hw)\)</span>ï¼Œå¯¹äºé€šé“æ•°ä¸º2Cçš„embeddingè€Œè¨€ï¼Œå°±å¦‚è®ºæ–‡æ‰€è¯´çš„ï¼š<span class="math inline">\(O(2M^2hwC)\)</span></p>
<p>â€‹ è¿™ä¹ˆè¯´Set transformerä¸­çš„induced point æœºåˆ¶ï¼Œå¯èƒ½ä¹Ÿå¯ä»¥åº”ç”¨åˆ°è¿™é‡Œæ¥ï¼Ÿ</p>
<h3 id="masked-attention">2.2 Masked Attention</h3>
<p>â€‹ Masking å¾ˆå¥½ç†è§£ï¼Œç”±äºåŸå›¾æ˜¯ç‰©ç†ä¸Šè¿ç»­çš„ï¼Œç»è¿‡äº†ä¸€æ¬¡å¾ªç¯ç§»åŠ¨æ“ä½œä¹‹åï¼Œå¾ªç¯ç§»åŠ¨çš„åˆ†ç•Œé¢æ˜¯ç‰©ç†ä¸Šä¸è¿ç»­çš„åŒºåŸŸï¼Œæ•…åœ¨è¿›è¡Œæ³¨æ„åŠ›æœºåˆ¶å¤„ç†æ—¶ä¸èƒ½åŒ…æ‹¬åˆ†ç•Œé¢ä¸¤è¾¹çš„åŒºåŸŸã€‚æ¯”å¦‚ï¼š</p>
<center>
<img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/shift.png" style="zoom:100%;">
</center>
<center>
Figure 2. å¾ªç¯ç§»åŠ¨ç¤ºæ„å›¾
</center>
<p>â€‹ å³è¾¹æ˜¯å¾ªç¯ç§»åŠ¨å‰çš„å›¾ï¼Œå·¦è¾¹æ˜¯å¾ªç¯ç§»åŠ¨åçš„å›¾ã€‚æˆ‘ä»¬å¸Œæœ›ï¼Œèƒ½å¤Ÿåˆ†å—è¿›è¡Œattentionã€‚ä¸ªäººçš„ç†è§£å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œå…¶å®è¿™ä¸ªå¾ˆç®€å•ï¼šæˆ‘ä½¿ç”¨å®˜æ–¹å®ç°åšäº†ä¸€ä¸ªå°å®éªŒä¹‹åï¼Œå¤§æ¦‚æ˜ç™½äº†å…¶åŒ…å«çš„æ€æƒ³ï¼ˆä½†æ˜¯è¿™ä¸ªçŸ©é˜µæ“ä½œæˆ‘å¯èƒ½åšä¸æ¥ï¼Œæœ‰ç‚¹å¦™ï¼Œæˆ‘é¡¶å¤šè‡ªå·±åœ¨è¿™å¾ªç¯ï¼‰ï¼š</p>
<p>â€‹ è¿™ä¸ªå°å®éªŒçš„è®¾ç½®å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šå›¾åƒå¤§å°ä¸º 4 * 4ï¼Œwindowå¤§å°ä¸º 2 * 2ï¼Œåç§»ä¸º1 * 1ï¼Œå¾—åˆ°çš„å››ä¸ªmaské•¿è¿™æ ·(å…¶ä¸­ï¼Œé»„è‰²ä¸º0ï¼Œç´«è‰²ä¸º-100ï¼‰ï¼š</p>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/mask.png"></p>
<center>
Figure 3. attention mask
</center>
<p>â€‹ ãªã‚“ã§ï¼Ÿå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªå¯è§†åŒ–ï¼šæˆ‘ä»¬å°†16ä¸ªå—ç¼–å·ï¼Œå¹¶è¿›è¡Œå¾ªç¯ç§»åŠ¨ï¼Œå¾ªç¯ç§»åŠ¨åçš„å›¾å’ŒåŸå›¾ï¼š</p>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/new.png" style="zoom:50%;"></p>
<center>
Figure 4. å¾ªç¯ç§»åŠ¨illustration
</center>
<p>â€‹ æ³¨æ„åŠ›æ“ä½œå°†æŠŠä¸€ä¸ªwindowå†…çš„å…ƒç´ flattenï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªwindowå†…çš„ ((6, 7), (10, 11)) -&gt; (6, 7, 10, 11)ã€‚flattenæ“ä½œæ˜¯è¡Œä¼˜å…ˆçš„ã€‚æ•…å¯¹äºç¬¬ä¸€ä¸ªwindowè€Œè¨€ï¼Œç”±äºå†…éƒ¨çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯åŸå›¾ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œattentionæ“ä½œï¼Œæ•…attention maskå€¼å…¨ä¸º0ã€‚</p>
<ul>
<li>ç¬¬äºŒä¸ªwindowï¼š((8, 5), (12, 9)) -&gt; (8, 5, 12, 9)ã€‚ç”±äº(8, 5) ä»¥åŠ (12, 9)ä¸¤ä¸¤ä¸èƒ½åšattentionæ“ä½œï¼Œæ•…maskåº”è¯¥å°±æ˜¯figure 2ä¸­çš„ç¬¬äºŒä¸ªå›¾ã€‚æ¯”å¦‚å›¾ä¸­4 * 4çŸ©é˜µçš„(0, 1)ä½ç½®æ˜¯-100ï¼Œä»£è¡¨äº†å—8ä¸å—5ä¹‹é—´çš„attention logitå€¼åº”è¯¥åŠ ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿåç½®ï¼Œä¹Ÿå°±æ˜¯æ¶ˆå»äº†ä¸¤ä¸ªå—ä¹‹é—´çš„å…³è”ã€‚</li>
<li>æ­¤åçš„ä¸¤ä¸ªwindowéƒ½èƒ½å¾ˆå¿«ä»¥è¿™ä¸ªæ€æƒ³æ¨å‡ºã€‚</li>
</ul>
<p>â€‹ ä»£ç ä¸­åˆ™æ˜¯è¿™ä¹ˆå®ç°çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">H, W = input_resolution</span><br><span class="line">img_mask = torch.zeros((<span class="number">1</span>, H, W, <span class="number">1</span>))  <span class="comment"># 1 H W 1</span></span><br><span class="line">h_slices = (<span class="built_in">slice</span>(<span class="number">0</span>, -self.window_size),</span><br><span class="line">            <span class="built_in">slice</span>(-self.window_size, -self.shift_size),</span><br><span class="line">            <span class="built_in">slice</span>(-self.shift_size, <span class="literal">None</span>))</span><br><span class="line">w_slices = (<span class="built_in">slice</span>(<span class="number">0</span>, -self.window_size),</span><br><span class="line">            <span class="built_in">slice</span>(-self.window_size, -self.shift_size),</span><br><span class="line">            <span class="built_in">slice</span>(-self.shift_size, <span class="literal">None</span>))</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="comment"># åˆ†å—èµ‹å€¼æ“ä½œ ç»è¿‡åˆ†å—èµ‹å€¼ä¹‹åï¼Œä¸€ä¸ªwindowå†…å¯ä»¥è¿›è¡Œattentionæ“ä½œçš„å—ä¸ºåŒä¸€ä¸ªid</span></span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> h_slices:			</span><br><span class="line">    <span class="comment"># æ¯”å¦‚cnt = 0ï¼Œæ ¹æ®h_slicesä¸w_slicesçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œèµ‹å€¼ç»™[0:-win_size, 0:-win_size] è¿™æ ·æ˜¯æ²¡æœ‰é—®é¢˜çš„</span></span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> w_slices:							 </span><br><span class="line">        img_mask[:, h, w, :] = cnt</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">mask_windows = window_partition(img_mask, self.window_size)  <span class="comment"># nW, window_size, window_size, 1 --&gt; åˆ†windowæ“ä½œ</span></span><br><span class="line">mask_windows = mask_windows.view(-<span class="number">1</span>, self.window_size * self.window_size)	<span class="comment"># flattenæ“ä½œï¼šï¼ˆæ‰€æœ‰batchçš„æ‰€æœ‰windowï¼Œwindowå†…æ‰€æœ‰å—ï¼‰</span></span><br><span class="line"><span class="comment"># æ­¤å¤„é­”æ³•ï¼šunsqueeze(1) å¯¼è‡´ mw ä¸º (B, 1, N), unsqueeze(2) å¯¼è‡´ mw ä¸º (B, N, 1)</span></span><br><span class="line"><span class="comment"># ç›¸å½“äºè®¡ç®—æ—¶ï¼Œä¸€ä¸ªæŒ‰è¡Œrepeatï¼ˆå‰è€…ï¼‰ ä¸€ä¸ªæŒ‰åˆ—repeatï¼ˆåè€…ï¼‰ï¼Œç›¸å½“äºè‡ªå·±å‡è‡ªå·±çš„è½¬ç½® å°±å¯ä»¥å¾—åˆ°ï¼šç›¸åŒidçš„ä½ç½®æ˜¯0ï¼Œä¸åŒçš„æ˜¯ä¸€ä¸ªé0å€¼</span></span><br><span class="line">attn_mask = mask_windows.unsqueeze(<span class="number">1</span>) - mask_windows.unsqueeze(<span class="number">2</span>)		   </span><br><span class="line"><span class="comment"># æ‰€æœ‰éé›¶å€¼å˜ä¸º-100</span></span><br><span class="line">attn_mask = attn_mask.masked_fill(attn_mask != <span class="number">0</span>, <span class="built_in">float</span>(-<span class="number">100.0</span>)).masked_fill(attn_mask == <span class="number">0</span>, <span class="built_in">float</span>(<span class="number">0.0</span>))</span><br></pre></td></tr></table></figure>
<h2 id="iii.-relative-position-bias">III. Relative Position Bias</h2>
<h3 id="positional-embeddings">3.1 Positional Embeddings</h3>
<p>â€‹ å®é™…ä¸Šï¼Œæˆ‘å¯¹position embeddingsï¼ˆç‰¹åˆ«æ˜¯non-learnable PEï¼‰åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„è¿˜å¹¶ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šã€‚position embeddings å¦‚ä½•è¡¨ç¤ºä½ç½® æ˜¯å¦æœ‰ç›´è§‚çš„ç†è§£ï¼Ÿ</p>
<blockquote>
<p>Moreover, positional embeddings are trainable as opposed to encodings that are fixed.</p>
</blockquote>
<p>â€‹ æ„æ€å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œä¸€ä¸ªç®€å•çš„positional embeddingsï¼ˆåªåœ¨åˆå§‹æ—¶åŠ å…¥çš„é‚£ç§ï¼‰å¯ä»¥è¢«å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š <span class="math display">\[
\begin{equation}\label{pos}
\epsilon_{ij}=\frac{\text{lin}_q(x_i)(\text{lin}_k(x_j))^T+\text{lin}_q(x_i)(\text{lin}_k(p_{j}))^T}{\sqrt d_k}
\end{equation}
\]</span> â€‹ ä¸ªäººè®¤ä¸ºæ›´åŠ åˆç†çš„è¡¨ç¤ºåº”è¯¥æ˜¯ï¼ˆå¦‚æœå¯¹äºåˆå§‹å°±åŠ åˆ°embeddingä¸Šçš„position embeddingsæ¥è¯´ï¼‰ï¼š <span class="math display">\[
\begin{equation}
\epsilon_{ij}=\frac{\text{lin}_q(x_i + p_i)(\text{lin}_k(x_j + p_j))^T}{\sqrt d_k}
\end{equation}
\]</span> â€‹ åœ¨æŸç¯‡åšå®¢ä¸­çš„è¡¨è¿°æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå…¬å¼<span class="math inline">\(\eqref{pos}\)</span>ä¸­çš„<span class="math inline">\(\text{lin}_k(p_{j})\)</span> æˆ‘ä»¬å°†å…¶æ”¹ä¸º<span class="math inline">\(p_{ij}\)</span>ï¼Œæ­¤å¤„<span class="math inline">\(p_{ij}\)</span>æ˜¯æ•´ä¸ªpositional embeddingsçš„(i, j)å…ƒç´ ï¼Œè¡¨ç¤ºäº†å¤„äºä½ç½®içš„queryç›¸å¯¹äºå¤„äºjä½ç½®çš„keyçš„ä½ç½®å…³ç³»ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ä¸ä½ç½®æœ‰å…³ç³»çš„ç›¸å…³æ€§ã€‚æ¯”å¦‚ï¼Œåœ¨CVåº”ç”¨ä¸­ï¼Œå¸¸è§çš„inductive biaså°±æ˜¯ï¼šä¸´è¿‘å…³è”æ€§ï¼Œå³ä½¿ç»è¿‡åˆ†å—ï¼Œç›¸é‚»çš„å—ä¸å—ï¼ˆæˆ–è€…ä½ç½®ç›¸è¿‘çš„ï¼‰ä¹‹é—´ä¹Ÿæ˜¯æœ‰å…³è”æ€§çš„ã€‚ä¸€èˆ¬çš„positional embeddingsï¼Œä¸´è¿‘çš„ä¸¤ä¸ªä½ç½®ï¼Œpositional embeddingsçš„æŸä¸ªmetricsï¼ˆæ¯”å¦‚å·®å€¼ã€ç‚¹ä¹˜ï¼‰å¯èƒ½æ¯”è¾ƒå°ï¼ˆå¤§ï¼‰ã€‚</p>
<p>â€‹ æœ¬èŠ‚çš„é‡ç‚¹æ˜¯è®¨è®ºç›¸å¯¹ä½ç½®åµŒå…¥ï¼Œå› ä¸ºç»å¯¹ä½ç½®åµŒå…¥ä¹‹å‰å·²ç»å®ç°è¿‡äº†ï¼ˆå°±å¾ˆç®€å•ï¼‰ï¼Œç‰¹åˆ«æ˜¯learnable positional embeddingsï¼Œå°±æ²¡æœ‰ä»€ä¹ˆå¥½è®¨è®ºçš„ã€‚æˆ‘ä»¬å·²ç»è¯´äº†ï¼Œç›¸å¯¹ä½ç½®åµŒå…¥æ˜¯ä¸ºäº†è§£å†³ç»å¯¹ä½ç½®åµŒå…¥æ— æ³•ç¼–ç ä»»æ„å¤šçš„ä½ç½®çš„ç¼ºç‚¹ã€‚è¿™é‡Œæˆ‘è®¨è®ºä¸€ä¸‹music transformerä¸­çš„relative positional embeddingsï¼ˆè®¡ç®—æ¯”è¾ƒç®€å•ï¼‰ï¼š <span class="math display">\[
\begin{equation}
\text{Attn}_{rel}=\text{softmax}(\frac{QK^T+S_{rel}}{\sqrt{d_k}})V,\text{ where }S_{rel}=QR^T
\end{equation}
\]</span> â€‹ æˆ‘æ„Ÿè§‰ä¸Šé¢çš„å…¬å¼æ€ªæ€ªçš„ï¼Œå› ä¸ºï¼š</p>
<ul>
<li><span class="math inline">\(Q\)</span>ï¼ˆqueryï¼‰ä¸ä»…ä¸æ˜ å°„<span class="math inline">\(W_q\)</span>æœ‰å…³ï¼Œä¸æ•°æ®æœ¬èº«ä¹Ÿæ˜¯æœ‰å…³ç³»çš„ï¼Œä¸åŒçš„å›¾åƒ<span class="math inline">\(Q\)</span>å·®åˆ«å¾ˆå¤§ï¼Œé‚£ä¹ˆä¸€ä¸ª<span class="math inline">\(R\)</span>æ€ä¹ˆèƒ½å¾ˆå¥½æ•è·åˆ°ä¸åŒqueryå‘é‡ä¹‹é—´çš„å…³è”æ€§ï¼Ÿä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}
A=\begin{pmatrix}
1 &amp; 2 &amp; 3 &amp; 4 \\
5 &amp; 6 &amp; 7 &amp; 8 \\
9 &amp; 10 &amp; 11 &amp; 12 \\
13 &amp; 14 &amp; 15 &amp; 16 \\
\end{pmatrix}\xrightarrow{\text{flatten}}(1,...,16)
\end{equation}
\]</span></p>
<p>â€‹ ä¸Šä¾‹å­ä¸­ï¼ˆCVäºŒç»´ï¼‰ï¼Œå…ƒç´ 1åœ¨ä½ç½®ä¸Šåº”ä¸ï¼ˆ2ï¼Œ5ï¼‰æœ‰ç€æœ€ç´§å¯†çš„å…³ç³»ï¼Œé‚£ä¹ˆåº”è¯¥<span class="math inline">\(QR^T\)</span>è®¡ç®—çš„ç»“æœåœ¨(0,1)(1,0)ä½ç½®éƒ½è¾ƒå¤§ï¼ˆsoftmaxä¹‹åä¹Ÿä¼šè¾ƒå¤§ï¼‰ï¼Œä½†æ˜¯<span class="math inline">\(QR^T\)</span>çš„è®¡ç®—ä¸­ï¼Œå¯¹ä»»ä½•<span class="math inline">\(Q\)</span>è€Œè¨€<span class="math inline">\(R\)</span>æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„çŸ©é˜µ<span class="math inline">\(A\)</span>ï¼Œå…ƒç´ 1ä¸å…ƒç´ 2ã€5å‡åº”è¯¥æœ‰æ­¤å…³ç³»ï¼Œé‚£ä¹ˆåœ¨<span class="math inline">\(Q\)</span>æ”¹å˜çš„æƒ…å†µä¸‹ï¼Œä»€ä¹ˆæœºåˆ¶ä¿è¯äº†<span class="math inline">\(QR^T\)</span>çš„ç¨³å®šæ€§å‘¢ï¼Ÿè¿™å·²ç»æ˜¯äººç±»éš¾ä»¥ç†è§£çš„é­”æ³•äº†ï¼Œä¾‹å¦‚ï¼šç›¸é‚»ä¸¤patchï¼Œç”±äºä½ç½®ä¸´è¿‘å¯èƒ½ç¡®å®å­˜åœ¨ä¸€å®šå…³ç³»ï¼Œå¯¹äºä¸åŒçš„æ•°æ®éƒ½æœ‰è¿™æ ·çš„å…±æ€§ï¼Œ<span class="math inline">\(R\)</span>ä¹Ÿåªèƒ½å»å­¦å¯ä»¥æ³›åŒ–çš„å…±æ€§äº†ã€‚</p>
<h3 id="rpeçš„å®ç°">3.2 RPEçš„å®ç°</h3>
<h4 id="music-transformer">3.2.1 Music Transformer</h4>
<p>â€‹ ä¸åŒçš„relative positional embeddingså®ç°æœ‰ä¸€äº›å·®åˆ«ã€‚æœ€æ—©æœŸçš„relative positional embeddings æœ‰è¿™æ ·çš„é—®é¢˜ï¼šç©ºé—´å¤æ‚åº¦æ˜¯<span class="math inline">\(O(L^2D)\)</span>ã€‚å› ä¸ºï¼š</p>
<p>â€‹ æ±‚è§£relative positional embeddingså¸¦æ¥çš„è·ç¦»logitï¼Œéœ€è¦å¾—åˆ°queryä¸PEä¹‹é—´çš„ç‚¹ä¹˜ã€‚è€ƒè™‘ä¸€ä¸ªheadçš„æƒ…å†µï¼ŒQçš„å½¢çŠ¶åº”è¯¥æ˜¯ï¼š<span class="math inline">\((L,D_h)\)</span>ï¼Œå…¶ä¸­Læ˜¯åºåˆ—é•¿åº¦ï¼Œ<span class="math inline">\(D_h\)</span>æ˜¯å¯¹åº”headçš„embedding dimensionã€‚æˆ‘ä»¬å¸Œæœ›çŸ¥é“ï¼Œqueryçš„æ¯ä¸ªå‘é‡ï¼ˆembeddingï¼‰ä¸ä¸åŒè·ç¦»ä½ç½®çš„ç›¸å…³ç¨‹åº¦ï¼Œæ¯”å¦‚ï¼Œ<span class="math inline">\(Q\)</span>çš„ç¬¬iè¡Œï¼ˆåºåˆ—ä¸­ç¬¬iä¸ªtokençš„embeddingï¼‰ï¼Œéœ€è¦è®¡ç®—å…¶ä¸å„ä¸ªä½ç½®çš„åˆ†æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š <span class="math display">\[
\begin{equation}
\text{logit}(q_i)=q_iE_r^T,\text{ where }E_r=(\text{PE}_0,...,\text{PE}_{L-1}) ,\text{PE.shape}=(1,D_h)
\end{equation}
\]</span> â€‹</p>
<p>â€‹ è€Œç›´æ¥è®¡ç®—<span class="math inline">\(QE_r^T\)</span>çš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼šå®ƒç®—å‡ºæ¥çš„çŸ©é˜µå’Œæˆ‘ä»¬éœ€è¦çš„çŸ©é˜µåˆ†åˆ«æ˜¯è¿™æ ·çš„,å…¶ä¸­<span class="math inline">\(v_{i,j}\)</span>è¡¨ç¤ºçš„æ˜¯ç¬¬ i ä¸ªqueryå‘é‡å’Œ ä¸å…¶è·ç¦»ä¸ºjçš„ä½ç½®çš„logit biasã€‚ <span class="math display">\[
\begin{equation}
A=\begin{pmatrix}
v_{0,0} &amp; v_{0,1} &amp; ... &amp; v_{0, L-1}\\
v_{1,0} &amp; v_{1,1} &amp; ... &amp; v_{1, L-1}\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
v_{L-1,0} &amp; v_{L-1,1} &amp; ... &amp; v_{L-1, L-1}\\
\end{pmatrix},B=\begin{pmatrix}
v_{0,0} &amp; v_{0,1} &amp; ... &amp; v_{0, L-1}\\
v_{1,1} &amp; v_{1,0} &amp; ... &amp; v_{1, L-2}\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
v_{L-1,L-1} &amp; v_{L-1,L-2} &amp; ... &amp; v_{L-1, 0}\\
\end{pmatrix}
\end{equation}
\]</span> â€‹ ä»¥Açš„æœ€åä¸€ä¸ªè¡Œçš„é¦–å°¾ä¸¤ä¸ªå…ƒç´ ä¸ºä¾‹ã€‚<span class="math inline">\(v_{L-1,0}\)</span>è¡¨ç¤ºçš„æ˜¯æœ€åä¸€ä¸ªembeddingä¸è‡ªèº«çš„ä½ç½®åç§»logitåç½®ï¼Œè€Œæœ€åä¸€ä¸ªå…ƒç´ <span class="math inline">\(v_{L-1,L-1}\)</span>è¡¨ç¤ºçš„åˆ™æ˜¯ï¼šæœ€åä¸€ä¸ªembeddingä¸ç›¸è·L-1è·ç¦»ä½ç½®çš„logitåç½®ã€‚è€Œæˆ‘ä»¬åè¿‡æ¥çœ‹æœ€åä¸€è¡Œçš„self attentionï¼Œæœ€åä¸€è¡Œçš„self attentionçš„ç»“æœlogitä¸­ï¼Œæœ€åä¸€ä¸ªå…ƒç´ è¡¨ç¤ºçš„æ‰æ˜¯è‡ªå·±ä¸è‡ªèº«çš„attentionå€¼ã€‚</p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´æ¥è®¡ç®—<span class="math inline">\(QE_r^T\)</span>æ˜¯ä¸è¡Œçš„ï¼Œè¿™æ ·è®¡ç®—ä¼šå¯¼è‡´self attention ä¸ positional attentionæ±‚å‡ºçš„logitåœ¨é€»è¾‘æ„ä¹‰ä¸Šçš„é”™ä½ã€‚Bæ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼šä»å¯¹è§’çº¿å…ƒç´ çš„ä¸‹æ ‡å°±èƒ½çœ‹å‡ºã€‚</p>
<p>â€‹ é‚£ä¹ˆå¦‚æœè¦è¿›è¡Œç›´æ¥çš„çŸ©é˜µè¿ç®—ï¼Œä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯ï¼šæˆ‘å¯ä»¥ç›´æ¥è®¡ç®—ä¸€ä¸ªä¸­é—´çŸ©é˜µRï¼ŒRåŒ…å«äº†ï¼ˆæ—‹è½¬è¿‡çš„ï¼‰<span class="math inline">\(E_r\)</span>ï¼Œè¿™æ ·ï¼Œå¯¹äºæ¯ä¸€ä¸ªqueryå‘é‡ï¼Œå…¶è®¡ç®—éƒ½åº”è¯¥æ˜¯æ­£ç¡®çš„ï¼Œå†ç›´æ¥çŸ©é˜µç›¸ä¹˜ï¼ˆ<u><strong>æ¯•ç«Ÿèƒ½ç›´æ¥çŸ©é˜µè¿ç®—çš„ï¼ŒCPUä¸Šå¯ä»¥SIMDï¼ŒGPUä¸Šå¹¶è¡Œåº¦å¥½</strong></u>ï¼‰ã€‚é‚£ä¹ˆå¯ä»¥å°†<span class="math inline">\(Q\)</span>ä¸<span class="math inline">\(E_r\)</span>å¤„ç†æˆè¿™æ ·ï¼š <span class="math display">\[
\begin{equation}
Q.\text{shape}=(L,1,D_h),R.\text{shape}=(L,L,D_h),S_{rel}=QR^T
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼ŒRç¬¬ä¸€ç»´åº¦ä¸‹æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª<span class="math inline">\(E_r\)</span>ã€‚è¿™ç§å®ç°ç®€å•ç›´è§‚ï¼Œä½†æ˜¯ï¼Œå†…å­˜å¼€é”€å¾ˆå¤§ï¼Œé•¿åºåˆ—ä¸å‹å¥½ã€‚æ—¢ç„¶ç›¸å¯¹ä½ç½®åµŒå…¥æ˜¯ä¸ºäº†è§£å†³é•¿åºåˆ—å»ºæ¨¡é—®é¢˜ï¼Œé‚£ä¹ˆè‡ªç„¶å…¶æ—¶é—´å¤æ‚åº¦ä»¥åŠç©ºé—´å¤æ‚åº¦ä¸èƒ½å› ä¸ºåºåˆ—é•¿åº¦å¢é•¿è€Œå˜å¾—éš¾ä»¥æ¥å—ã€‚äºæ˜¯ï¼Œmusic transformerçš„ä½œè€…æå‡ºäº†ä¸€ç§ç©ºé—´å¤æ‚åº¦ä¸º<span class="math inline">\(O(LD)\)</span>çš„æ–¹æ³•ã€‚</p>
<p>â€‹ å¾ˆæ˜¾ç„¶ï¼Œç›´æ¥è®¡ç®—<span class="math inline">\(QE_r^T\)</span>å·²ç»åŒ…å«äº†æ‰€æœ‰éœ€è¦<span class="math inline">\(S_{rel}\)</span>çš„ä¿¡æ¯ï¼Œåªä¸è¿‡å¯¹åº”å…³ç³»é”™äº†ï¼ˆä½ç½®æœ‰è¯¯ï¼‰ã€‚å¦‚ä½•é€šè¿‡<span class="math inline">\(QE_r^T\)</span>çš„ç»“æœè®¡ç®—<span class="math inline">\(S_{rel}\)</span>ï¼Ÿ</p>
<p>â€‹ ä½œè€…ç”¨äº†ä¸€ä¸ªå·§å¦™çš„çŸ©é˜µæ“ä½œï¼špad + reshapeï¼šå›¾ç¤ºä¸€ä¸‹ï¼š</p>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/rel.png" style="zoom: 67%;"></p>
<center>
Figure 5. skewingæ“ä½œå›¾ç¤º
</center>
<p>â€‹ ä½œè€…åœ¨æ–‡ç« ä¸­è¯´åˆ°ï¼š</p>
<blockquote>
<p>Pad a dummy column vector of length L before the leftmost column.</p>
</blockquote>
<p>â€‹ è¿™æ ·å†reshapeä¹‹åï¼Œå¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼ŒåŸæœ‰çš„æœ‰æ•ˆå…ƒç´ ä¸¢å¤±ï¼Œå¼•å…¥çš„çŸ©é˜µä¸­å‡ºç°äº†ä¸€äº›dummy elementsã€‚å¹¶ä¸”æ„Ÿè§‰å‡ºç°äº†ï¼šç¬¬iè¡Œå…ƒç´ è¢«æŒ¤åˆ°ç¬¬jè¡Œçš„æƒ…å†µã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé•¿åº¦ä¸º5çš„åºåˆ—ï¼Œ<span class="math inline">\(S_{rel}\)</span>çš„index 2è¡Œåº”è¯¥æ˜¯ï¼ˆå¾ªç¯å³ç§»2ï¼‰ï¼š <span class="math display">\[
\begin{equation}
(1,2,3,4,5)\rightarrow(4,5,1,2,3)
\end{equation}
\]</span> â€‹ æ‰€ä»¥ä¸ªäººæ„Ÿè§‰paddingæ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼Œåº”è¯¥ç›´æ¥è¿›è¡Œä¸€äº›å˜æ¢ï¼šçº¿æ€§å˜æ¢æ˜¯ä¸å¯èƒ½çš„ï¼ˆä¸å­˜åœ¨ä¸€ä¸ªçŸ©é˜µRï¼Œå¯ä»¥å°†ç¬¬ä¸€è¡Œæ—‹è½¬0ï¼Œç¬¬äºŒè¡Œæ—‹è½¬1ï¼Œç¬¬ä¸‰è¡Œæ—‹è½¬2,...ï¼Œå› ä¸ºå¦‚æœå­˜åœ¨è¿™æ ·çš„çŸ©é˜µï¼Œåˆ™å¯¹äºçŸ©é˜µAï¼ŒAåªæœ‰ç¬¬ä¸€åˆ—å…¨æ˜¯1ï¼Œå…¶ä»–å…¨æ˜¯0ï¼Œè¿™æ ·æ˜¾ç„¶æ²¡æœ‰é€†çš„çŸ©é˜µï¼ŒRæˆäº†å®ƒçš„é€†ï¼‰ã€‚ä¸ªäººè§‰å¾—ï¼Œä¸€ä¸ªç®€å•çš„å®ç°åº”è¯¥æ˜¯ï¼šè®¡ç®—ä¸€ä¸ªå¾ªç¯ç§»åŠ¨è¿‡çš„ç´¢å¼•çŸ©é˜µï¼Œæ¯”å¦‚æˆ‘çŸ¥é“æœ¬æ¬¡éœ€è¦è®¡ç®—çš„seq lengthä¸ºNï¼Œé‚£ä¹ˆæˆ‘é¦–å…ˆè®¡ç®—ä¸€ä¸ªå¤§å°ä¸º<span class="math inline">\(N * N\)</span>çš„ç´¢å¼•çŸ©é˜µï¼Œæ ¹æ®æ­¤ç´¢å¼•çŸ©é˜µå–<span class="math inline">\(QE_r^T\)</span>å…ƒç´ ï¼Œä½†è¿™æ ·åˆå¼•å…¥äº†ä¸€ä¸ª<span class="math inline">\(O(N^2)\)</span>å¤æ‚åº¦çš„å­˜å‚¨å¼€é”€ï¼ˆæ¯”<span class="math inline">\(O(N^2D)\)</span>å°äº†å¾ˆå¤šï¼Œ16ä½ä¸€èˆ¬å°±å¤Ÿç”¨ï¼Œç›¸å½“äºå‡ å¼ å¤§å‹åŒé€šé“å›¾åƒï¼‰ã€‚</p>
<div class="note info"><p>å¯èƒ½è¿™æ˜¯ä¼˜é›…çš„å®ç°ï¼Œæ¯•ç«Ÿæˆ‘å‘ç°swinä¹Ÿæ˜¯è¿™ä¹ˆæ±‚çš„ã€‚music transformeråœ¨å¹²å•¥ï¼Ÿæ˜¯æˆ‘æ²¡çœ‹æ‡‚è¿˜æ˜¯æœ¬èº«å°±æ˜¯é”™çš„ï¼Ÿä¸åº”è¯¥é”™äº†å•Šã€‚</p>
</div>
<h4 id="æ„Ÿè§‰æ­£ç¡®çš„å®ç°">3.2.2 æ„Ÿè§‰æ­£ç¡®çš„å®ç°</h4>
<p>â€‹ æ‰€ä»¥ï¼Œæˆ‘å¸¦ç€æ€€ç–‘æ€åº¦çœ‹äº†ä¸€ä¸‹music transformerä»¥åŠswin transformerçš„å®ç°ã€‚music transformerè¿˜çœŸæ˜¯è¿™æ ·å†™çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> self.relative_pos:</span><br><span class="line">    <span class="comment">#apply same position embeddings across the batch</span></span><br><span class="line">    <span class="comment">#Is it possible to apply positional self-attention over</span></span><br><span class="line">    <span class="comment">#only half of all relative distances?</span></span><br><span class="line">    Er  = self.Er[:, embedding_start:, :].unsqueeze(<span class="number">0</span>)</span><br><span class="line">    QEr = torch.matmul(queries, Er.transpose(-<span class="number">1</span>,-<span class="number">2</span>))</span><br><span class="line">    QEr = self._mask_positions(QEr)</span><br><span class="line">    <span class="comment">#Get relative position attention scores</span></span><br><span class="line">    <span class="comment">#combine batch with head dimension</span></span><br><span class="line">    SRel = self._skew(QEr).contiguous().view(b*h, t, t)</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­çš„skewæ¯«æ— ä¿ç•™åœ°å®ç°äº†è®ºæ–‡çš„æ€æƒ³ï¼Œä¸ªäººæ„Ÿè§‰éå¸¸è¯¡å¼‚ã€‚ä¸ªäººè§‰å¾—åŸå› å¯èƒ½æ˜¯ï¼šå®ƒæ˜¯music transformerï¼Œåªä¿ç•™ä¸€ä¸ªæ–¹å‘çš„attentionï¼Œæ•…å¯èƒ½æœ‰æ‰€ä¸åŒï¼Ÿ</p>
<p>â€‹ ä¸ªäººæ€è€ƒåå‡ºæ¥çš„å®ç°ä¸è¿™ç¯‡åšå®¢ï¼š<a href="https://theaisummer.com/positional-embeddings/">AI Summer:How Positional Embeddings work in Self-Attention (code in Pytorch)</a>ç»™å‡ºçš„å®ç°æ–¹æ³•å¾ˆç›¸ä¼¼ã€‚ä½†åœ¨swin transformerä¸­ï¼Œæˆ‘è¿˜æ˜¯å¿½ç•¥äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼šæ™®é€šçš„åºåˆ—ä¸€èˆ¬æ˜¯ä¸€ç»´çš„ï¼Œæ‰€ä»¥å±•å¼€ä¹‹åçš„ç›¸å¯¹è·ç¦»å®é™…ä¸Šæ˜¯ä¸€ç»´åº¦é‡ï¼š <span class="math display">\[
\begin{equation}\label{rm}
\begin{pmatrix}
0 &amp; 1 &amp; 2 &amp; ... &amp; L-1\\
-1 &amp; 0 &amp; 1 &amp; ... &amp; L-2\\
-2 &amp; -1 &amp; 0 &amp; ... &amp; L-3\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 
-L+1 &amp; -L+2 &amp; -L+3 &amp; ... &amp; 0\\
\end{pmatrix}
\end{equation}
\]</span> â€‹ è€Œå¯¹äºäºŒç»´å›¾åƒä¸­çš„embeddingsï¼Œæ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ul>
<li>ç›¸å¯¹ä½ç½®ç¼–ç ä»¥åŠç»å¯¹ä½ç½®ç¼–ç è§£å†³çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯å¯ä»¥ç›¸äº’è½¬åŒ–çš„</li>
<li>æ­£è´Ÿæ–¹å‘æœ‰åˆ«ï¼Œx+1ä»¥åŠx-1æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯xï¼Œyæ–¹å‘ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„</li>
</ul>
<p>â€‹ æˆ‘ä»¬ä»¥ window size = 2 çš„æƒ…å†µæ¥è¯´æ˜swin transformerä¸­çš„â€œç›¸å¯¹ä½ç½® <strong><u>bias</u></strong>ï¼ˆè‡³äºä¸ºä»€ä¹ˆè¦ <strong><u>åŠ ç²—</u></strong>ä»¥åŠâ€œåŒå¼•å·â€ï¼Œä¹‹åä¼šè¯´åˆ°ï¼‰â€çš„å®ç°ï¼šå¯¹äºä»¥ä¸‹Aï¼ŒBï¼ŒCï¼ŒDå››ä¸ªä½ç½®çš„åƒç´ æ¯ä¸ªä½ç½®ç›¸å¯¹äºå…¶ä»–ä¸åŒä½ç½®åƒç´ çš„äºŒç»´è·ç¦»åˆ†åˆ«æ˜¯ï¼ˆæ³¨æ„æœ‰æ–¹å‘ï¼‰ <span class="math display">\[
\begin{align}
&amp;\text{image}=\begin{pmatrix}
A &amp; B\\
C &amp; D
\end{pmatrix}\\
&amp;A:\begin{pmatrix}
(0,0) &amp; (0,1)\\
(1,0)  &amp; (1, 1)
\end{pmatrix}\\
&amp;B:\begin{pmatrix}
(0,-1) &amp; (0,0)\\
(1,-1)  &amp; (1, 0)
\end{pmatrix}\\
&amp;C:\begin{pmatrix}
(-1,0) &amp; (-1,1)\\
(0,0)  &amp; (0, 1)
\end{pmatrix}\\
&amp;D:\begin{pmatrix}
(-1,-1) &amp; (-1,0)\\
(0,-1)  &amp; (0, 0)
\end{pmatrix}\\
\end{align}
\]</span> â€‹ éšä¾¿è¯´æ˜ä¸€ä¸ªå…ƒç´ çš„æ„ä¹‰ï¼Œä»¥Dçš„ç¬¬ä¸€è¡Œç¬¬äºŒåˆ—å…ƒç´ (-1, 0)ä¸ºä¾‹ï¼šè¿™é‡Œè¯´æ˜çš„æ˜¯ï¼š<span class="math inline">\(D\)</span>ä¸<span class="math inline">\(B\)</span>çš„ç›¸å¯¹ä½ç½®å·®åˆ«ï¼šBç›¸å¯¹äºDæ˜¯è¡Œ-1ï¼Œåˆ—ä¸å˜ï¼Œæ•…ä¸º(-1, 0)ã€‚é‚£ä¹ˆå°†æ¯ä¸ªå…ƒç´ æˆ˜å¹³å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{flat}
\begin{pmatrix}
(0,0) &amp; (0,1) &amp; (1,0)  &amp; (1, 1)     \\
(0,-1) &amp; (0,0) &amp; (1,-1)  &amp; (1, 0)   \\
(-1,0) &amp; (-1,1) &amp; (0,0)  &amp; (0, 1)   \\
(-1,-1) &amp; (-1,0) &amp; (0,-1)  &amp; (0, 0) \\
\end{pmatrix}\\
\end{equation}
\]</span> â€‹ æˆ‘åœ¨å…¬å¼<span class="math inline">\(\eqref{rm}\)</span>ä¸‹é¢çš„æ— åºåˆ—è¡¨ä¸­è¯´åˆ°ï¼šxã€yæ–¹å‘æ˜¯ç­‰ä»·çš„ï¼Œæ•…å®é™…ä¸Šå…¬å¼<span class="math inline">\(\eqref{flat}\)</span>ä¸­ä¸åŒçš„ç›¸å¯¹åæ ‡å€¼å¯ä»¥ç®€åŒ–ï¼šæ¯”å¦‚æˆ‘ä»¬ä»å·¦ä¸‹è§’å¼€å§‹æ ‡è®°idï¼Œç›¸åŒçš„ç›¸å¯¹åæ ‡å€¼idç›¸åŒï¼Œå¯ä»¥å°†å…¬å¼<span class="math inline">\(\eqref{flat}\)</span>æ ‡è®°ä¸ºï¼ˆæ ‡è®°ä¸å”¯ä¸€ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{id}
\begin{pmatrix}
4 &amp; 5 &amp; 7  &amp; 8  \\
2 &amp; 4 &amp; 6  &amp; 7  \\
1 &amp; 3 &amp; 4  &amp; 5  \\
0 &amp; 1 &amp; 2  &amp; 4 \\
\end{pmatrix}\\,
\begin{pmatrix}
3 &amp; 4 &amp; 5  &amp; 6  \\
2 &amp; 3 &amp; 4  &amp; 5  \\
1 &amp; 2 &amp; 3  &amp; 4  \\
0 &amp; 1 &amp; 3  &amp; 4 \\
\end{pmatrix}\\
\end{equation}
\]</span> â€‹ æˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li>åœ¨ä¸€ä¸ªè¡¨ä¸­é¢„å­˜ä¸åŒidå¯¹åº”çš„bias</li>
<li>å°†è¿™ä¸ªè¡¨å˜æˆlearnableçš„ï¼Œæ¯æ¬¡ç´¢å¼•å°±å¥½äº†ï¼Œè®©ç½‘ç»œè‡ªå·±å­¦å€¼</li>
</ul>
<p>â€‹ å…¬å¼<span class="math inline">\(\eqref{id}\)</span>çœ‹èµ·æ¥çœŸçš„å¾ˆåƒç»å¯¹ä½ç½®ç¼–ç çš„æ ·å­ï¼Œäº‹å®ä¸Šè¿™é‡Œå°±ä½“ç°äº†ç»å¯¹ä½ç½®ç¼–ç å’Œç›¸å¯¹ä½ç½®ç¼–ç çš„å…±åŒæ€§ä»¥åŠç›¸äº’è½¬åŒ–ã€‚å°±åƒç›¸å¯¹ä½å§¿ä¸€æ ·ï¼Œåªè¦ä¸ä¸€ä¸ªglobalé¡¹ï¼ˆç»å¯¹é‡ï¼‰ç»“åˆï¼Œç›¸å¯¹å°±ä¼šè½¬åŒ–æˆç»å¯¹ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p>â€‹ å€¼å¾—ä¸€æçš„æ˜¯ï¼šå¯¹äºwindow sizeä¸ºLçš„windowæ¥è¯´ï¼Œå› ä¸ºæ¯ä¸ªåƒç´ ç‚¹åœ¨ä¸åŒæ–¹å‘ä¸Šæœ€å¤šæœ‰<span class="math inline">\(2L-1\)</span>ä¸ªä¸åŒä½ç½®ï¼Œé‚£ä¹ˆ(x, y)çš„ç›¸å¯¹ä½ç½®ç»„åˆä¹Ÿå°±æœ‰<span class="math inline">\((2L-1)^2\)</span>ç§æƒ…å†µã€‚æ¯”å¦‚ï¼Œå…¬å¼<span class="math inline">\(\eqref{id}\)</span>å¯¹åº”L=2çš„æƒ…å†µï¼Œå°±æœ‰9ç§ä¸åŒçš„ä½ç½®ï¼ŒL=3æ—¶ä¸º49ç§... ç­‰ç­‰ï¼Œéƒ½æ˜¯å¯ä»¥éªŒè¯çš„ã€‚ç†è§£äº†è¿™ä¸ªï¼Œindexingæœºåˆ¶å°±åªå‰©ä¸€ä¸ªé—®é¢˜äº†ï¼šæ€ä¹ˆå®ç°ã€‚è¿™ä¸ª... ä¹Ÿä¸èƒ½å®Œå…¨è¯´æ˜¯é—®é¢˜å§ã€‚</p>
<div class="note warning"><p>â€‹ æˆ‘åœ¨æŸå¤©åˆå¤œæ€è€ƒå®ç°æ–¹æ³•ï¼Œæƒ³äº†ä¸€å°æ—¶æ²¡æœ‰å¤´ç»ªï¼Œé‚ç¡è§‰ã€‚ç¬¬äºŒå¤©æ—©ä¸Šé†’æ¥åœ¨åºŠä¸ŠèŠ±äº†ä¸‰åˆ†é’Ÿæƒ³åˆ°äº†å®ç°æ–¹æ³•ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ç¡çœ éå¸¸é‡è¦ã€‚å®ç°æ€æƒ³éå¸¸ç®€å•ï¼Œæ‰€æœ‰å…¶ä»–ä½ç½®çš„indexï¼Œéƒ½å¯ä»¥å¤ç”¨(0, 0)ä½ç½®çš„indexï¼Œå¹¶åœ¨(0, 0)ä½ç½®çš„indexè¡¨å…ƒç´ ä¸­åŠ ä¸Šç›¸åŒçš„åç½®å°±å¯ä»¥äº†ã€‚</p>
</div>
<p>â€‹ å…³äº2D relative positional biasï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼špositional biasçš„shapeåº”è¯¥å¦‚ä½•ï¼Ÿ</p>
<blockquote>
<p>å½“ç„¶æ˜¯<span class="math inline">\((\text{head num}, 2L-1,2L-1)\)</span></p>
</blockquote>
<p>â€‹ ä½†æ˜¯ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿ</p>
<p>â€‹ é¦–å…ˆï¼Œrelative positional biasä¹‹æ‰€ä»¥ä¸embedding dimensionä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼Œæ˜¯å› ä¸ºäººå®¶å« <strong><u>bias</u></strong>ï¼Œå­¦çš„å†…å®¹å¹¶ä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆå‘é‡ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—softmaxæ—¶åŠ å…¥çš„åç½®ï¼Œæ˜¯ä¸€ç»´çš„ï¼Œå¹¶ä¸”æ¯ä¸ªheadæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>â€‹ å…¶æ¬¡ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå¤§å°ä¸º<span class="math inline">\(2L-1\)</span>çš„æ–¹é˜µå‘¢ï¼Ÿå› ä¸ºä¸¤ä¸ªæ–¹å‘éƒ½æœ‰<span class="math inline">\(2L-1\)</span>ç§ä¸åŒçš„ä½ç½®ã€‚</p>
<hr>
<h2 id="iv.-å¤ç°ç»“æœ">IV. å¤ç°ç»“æœ</h2>
<p>â€‹ swin transformeré’ˆå¯¹çš„æ˜¯å¤§å‹æ•°æ®é›†ï¼ˆImageNetï¼‰ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯æˆ‘ç”µè„‘æ²¡åŠæ³•å¸¦åŠ¨çš„ï¼ˆå®éªŒå®¤çš„å•3060ä¹Ÿæ²¡åŠæ³•è·‘ï¼‰ã€‚æ‰€ä»¥æˆ‘æ‰¾äº†ä¸€äº›"compact ImageNet"ï¼Œæœ€åé€‰å®šçš„æ˜¯imagenette2-320ï¼ˆä¸timm docsä½¿ç”¨åŒä¸€ä¸ªæ•°æ®é›†ï¼‰ã€‚æ•°æ®é›†ä¸­å›¾åƒçš„é«˜å›ºå®šä¸º320ã€‚æ•°æ®é›†å…±æœ‰åä¸ªåˆ†ç±»ï¼Œæ¯ä¸ªåˆ†ç±»å¤§çº¦1000å¼ å›¾ç‰‡ï¼ˆå¾ˆå°äº†ï¼‰ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/1.JPEG"></th>
<th style="text-align: center;"><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/2.JPEG"></th>
<th style="text-align: center;"><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/3.JPEG"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">æ”¶éŸ³æœº</td>
<td style="text-align: center;">å¡è½¦</td>
<td style="text-align: center;">é±¼</td>
</tr>
</tbody>
</table>
<center>
Figure 6. ä¸€äº›åˆ†ç±»å›¾ç‰‡ï¼ˆç›¸æ¯”ä¹‹ä¸‹CIFAR-10å°±æ˜¯é«˜ç³Šï¼‰
</center>
<p>â€‹ ä¸å¾—ä¸è¯´ï¼Œ224 * 224çš„å›¾åƒç¡®å®éå¸¸åƒæ˜¾å­˜ã€‚batch sizeä¸º50æ—¶æ˜¾å­˜å ç”¨æ˜¯10GBï¼Œå†é«˜å°±ç‚¸æˆ‘æ˜¾å¡äº†ï¼Œæ•…æœ€åbatch sizeå–äº†ä¸€ä¸ªä¿é™©çš„40ï¼ˆçº¦8GBå ç”¨ï¼‰ã€‚å¤ç°ç»“æœå¦‚ä¸‹ï¼š</p>
<p>â€‹ é¦–å…ˆå¾—è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä½¿ç”¨çš„å‚æ•°åŸºæœ¬ä¸CCTä¸€è‡´ï¼Œå¹¶æ²¡æœ‰è°ƒè¿‡ï¼Œä¹Ÿä¸æƒ³è´¹äº‹å»è°ƒï¼Œåªæ˜¯æƒ³ç†è§£ä¸€ä¸‹æœ¬æ–‡çš„æ€æƒ³ã€‚æ–‡ä¸­ä½¿ç”¨çš„ç°ä»£CVè®­ç»ƒæ–¹æ³•ï¼Œæ¯”å¦‚cutmixç­‰ç­‰è¿™äº›æ“ä½œï¼Œæˆ‘ä¸€æ¦‚æ²¡æœ‰ä½¿ç”¨ï¼Œscheduleræ›¾ç»ä½¿ç”¨è¿‡timmå®ç°çš„ä½™å¼¦é€€ç«ï¼Œä½†æ˜¯æœ€å¤§æœ€å°å­¦ä¹ ç‡è®¾ç½®ä¸åˆé€‚ï¼Œå¯¼è‡´è®­ç»ƒç»“æœç›´æ¥å´©äº†ï¼ˆä»70%è°ƒåˆ°10%ï¼‰ï¼Œç¬”è€…ä¹Ÿå¹¶ä¸æƒ³èŠ±æ—¶é—´è°ƒã€‚æœ€ç»ˆçš„ç»“æœå¤§æ¦‚æ˜¯ï¼ˆå­˜åœ¨è¿‡æ‹Ÿåˆï¼ŒåŒæ ·ç¬”è€…ä¹Ÿæ‡’å¾—è°ƒä¼˜äº†ï¼‰ï¼š</p>
<ul>
<li>è®­ç»ƒé›†83.5% æµ‹è¯•é›†78% (imagenette2-320)</li>
<li>é™¤äº†ç¬¬ä¸€æ¬¡ä½¿ç”¨160 epochsä¹‹å¤–ï¼Œå…¶ä½™å‡æ˜¯250 epochsï¼Œå­¦ä¹ ç‡å›ºå®šåˆ†åˆ«å›ºå®š(1e-5, 5e-6ä»¥åŠ4e-6)</li>
</ul>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/trainacc.png"></p>
<center>
Figure 7. train set accuracy
</center>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/testacc.png"></p>
<center>
Figure 8. test set accuracy
</center>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/trainloss.png"></p>
<center>
Figure 9. train set loss
</center>
<p><img src="/2022/01/10/Swin-Transformer%E5%A4%8D%E7%8E%B0/testloss.png"></p>
<center>
Figure 10. test set loss
</center>
<hr>
<h2 id="v.-ä¸€äº›torchå‡½æ•°">V. ä¸€äº›torchå‡½æ•°</h2>
<h5 id="torch.triu">torch.triu</h5>
<blockquote>
<p>triu(input, diagonal=0, *, out=None) -&gt; Tensor Returns the upper triangular part of a matrix (2-D tensor) or batch of matrices</p>
</blockquote>
<p>â€‹ ä¹Ÿå³å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°è·å¾—æŸä¸ªçŸ©é˜µçš„ä¸Šä¸‰è§’éƒ¨åˆ†ã€‚å¯¹åº”çš„ä¸‹ä¸‰è§’æ˜¯<code>torch.tril</code>ã€‚å…¶ä¸­çš„diagonalå‚æ•°æŒ‡ç¤ºäº†ï¼šç›¸å¯¹äºçœŸæ­£çš„å¯¹è§’çº¿çš„åç§»é‡ï¼Œé»˜è®¤ä¸º0ï¼Œä¹Ÿå³å¯¹è§’çº¿ä¸‹æ–¹çš„æ‰€æœ‰å…ƒç´ è®¾ä¸º0ã€‚å¦‚æœæ˜¯æ­£æ•°ï¼Œæ¯”å¦‚1ï¼Œå°†ä¼šä½¿å¾—0å…ƒç´ åˆ†ç•Œçº¿å‘å³ä¸Šæ–¹åç§»ï¼ˆ1ï¼‰ï¼Œåä¹‹å¾€å·¦ä¸‹æ–¹ã€‚ä¸æ˜¯å¾ˆå¸¸ç”¨ã€‚</p>
<h5 id="torch.masked_fill">torch.masked_fill</h5>
<p>â€‹ æœ¬å®ç°ä¸­ä½¿ç”¨äº†æ­¤å‡½æ•°ï¼šåœ¨attention maskä¸­ï¼Œå°†æ‰€æœ‰ä¸ºè´Ÿæ•°çš„åŒºåŸŸå˜ä¸º-100ï¼ˆä½¿å¾—logitå¾ˆå°ï¼‰ã€‚ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ç›¸å½“äºæ¡ä»¶å¼ é‡ï¼ˆä¸€èˆ¬ä¼šè½¬åŒ–æˆtrue falseçš„boolå¼ é‡ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦fillçš„å€¼ã€‚</p>
<h5 id="torch.gather">torch.gather</h5>
<p>â€‹ æœ¬å®ç°ä¸­ï¼Œrelative positional biasä¸€å¼€å§‹çš„å®ç°ä½¿ç”¨è¿‡ã€‚gatherå®é™…ä¸Šåœ¨æ²¡æœ‰viewæ”¹å˜å½¢çŠ¶çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æ ¹æ®æä¾›çš„indexï¼Œåœ¨åŸå§‹çŸ©é˜µä¸­è¿›è¡Œç´¢å¼•ï¼Œå¾—åˆ°çš„å€¼ç»„æˆä¸€ä¸ªæ–°çš„çŸ©é˜µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rpe = torch.gather(s, -<span class="number">1</span>, self.relp_indices.repeat(batch_size, win_num, self.head_num, <span class="number">1</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸Šå…¬å¼å¯ä»¥ç›´æ¥åœ¨æœ€åä¸€ç»´åº¦é€‰æ‹©ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼Œdim = -1ï¼‰ï¼Œç›´æ¥æ ¹æ®ç´¢å¼•(self.relp_indices)ï¼Œä»ä¸€ä¸ªï¼ˆæœ€åä¸¤ä¸ªç»´åº¦ï¼‰shapeä¸º(2L - 1, 2L-1)çš„çŸ©é˜µä¸­ç›´æ¥å–å‡ºä¸€ä¸ªå¤§å°ä¸º(L, L)çš„çŸ©é˜µã€‚</p>
<h5 id="torch.register_buffer">torch.register_buffer</h5>
<p>â€‹ torchæœ‰ä¸¤ä¸ªå¸¸ç”¨çš„ ä¸ "register" æœ‰å…³çš„å‡½æ•°ï¼š<code>register_buffer</code>ä»¥åŠ<code>register_parameter</code></p>
<ul>
<li>register_bufferä¼šå°†å¯¹åº”çš„å¼ é‡åŠ å…¥åˆ°model.state_dictä¸­ï¼Œä½†æ˜¯å®ƒä¸ä¼šå‚ä¸åå‘ä¼ æ’­è®¡ç®—ã€‚è¿™ç»™æˆ‘ä»¬ä¿å­˜æ¨¡å‹ä¸­ä¸€äº›æ— å…³å‚æ•°ï¼ˆæˆ–è€…å¸¸æ•°ï¼‰æä¾›äº†ä¾¿åˆ©ï¼Œè¿™æ ·åŠ å…¥model.state_dictä¸­çš„å‚æ•°å¯ä»¥ç›´æ¥è¢«torch.saveä¿å­˜</li>
</ul>
<h5 id="torch.view-torch.reshape-torch.contiguous">torch.view / torch.reshape / torch.contiguous</h5>
<blockquote>
<p>help(torch.reshape): Contiguous inputs and inputs with compatible strides can be reshaped without copying, but you should not depend on the copying vs. viewing behavior.</p>
</blockquote>
<p>â€‹ viewåªèƒ½é’ˆå¯¹contiguousçš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œæ˜¯åœ¨åº•å±‚æ•°æ®å†…å­˜ç»„ç»‡åŸºç¡€ä¸Šï¼Œè¿”å›ä¸€ç§ä»¥ä¸åŒäºåº•å±‚æ•°æ®å†…å­˜ç»„ç»‡æ–¹å¼çš„è§†è§’ï¼ˆviewï¼Œæˆ–è®¤ä¸ºæ˜¯æ­¥é•¿ï¼‰æ¥æŸ¥çœ‹æ•°æ®çš„tensorã€‚æ¯”å¦‚ï¼šåº•å±‚æ˜¯çŸ©é˜µ<span class="math inline">\(A_{2\times2}\)</span>ï¼Œtransposeä¹‹åæ˜¯<span class="math inline">\(B_{2\times2}\)</span> <span class="math display">\[
\begin{equation}
A=\begin{pmatrix}
1 &amp; 2\\
3 &amp; 4
\end{pmatrix},
B=\begin{pmatrix}
1 &amp; 3\\
2 &amp; 4
\end{pmatrix}
\end{equation}
\]</span> â€‹ Aåœ¨å†…å­˜ä¸­å®é™…ä¸Šæ˜¯æŒ‰ç…§è¡Œä¼˜å…ˆè¿›è¡Œä¸€ç»´å­˜å‚¨çš„ï¼šå®é™…ä¸Šä¿å­˜çš„æ•°æ®æ˜¯(1, 2, 3, 4)å¹¶ä¸”æŒ‰ç…§stride = (2, 1)è¿›è¡Œè®¿é—®ã€‚è€ŒBä½œä¸ºAçš„transposeï¼Œå®é™…ä¸Šæ²¡æœ‰ä¿®æ”¹å†…å­˜ç»„ç»‡ï¼ˆtransposeåçš„æ•°æ®ä¸Aå…±ç”¨å†…å­˜ï¼ˆ<strong><u>å¦‚æœä¸å°å¿ƒå¯èƒ½ä¼šå¯¼è‡´ä¸æƒ³è¦çš„ä¿®æ”¹</u></strong>ï¼‰ï¼‰ï¼Œä½†æ˜¯æ˜¯ä»¥stride = (1, 2) è®¿é—®æ•°æ®ã€‚è¿™é‡Œçš„stride = (i, j)å¯ä»¥è®¤ä¸ºæ˜¯ï¼š</p>
<ul>
<li>è¡Œæ–¹å‘ä¸Šçš„ç´¢å¼•å¢åŠ 1ï¼Œåœ¨ç‰©ç†åœ°å€çš„å¯»å€ä¸­éœ€è¦ç§»åŠ¨iä¸ªä½ç½®</li>
<li>åˆ—æ–¹å‘ä¸Šç´¢å¼•å¢åŠ 1ï¼Œç‰©ç†åœ°å€å¯»å€éœ€è¦ç§»åŠ¨jä¸ªä½ç½®</li>
</ul>
<p>â€‹ æ•…ç”±äºBæ˜¯(1, 2)ï¼Œé‚£ä¹ˆB[0, 1] = (BåŸºåœ°å€ + 1 * 2åç§»).value = 3ã€‚B[1, 0] = (BåŸºåœ°å€ + 1 * 1åç§»).value = 2ã€‚</p>
<p>â€‹ ä¸Šç¤ºä¾‹ä¸­ï¼ŒAæ˜¯contiguousçš„ï¼Œä½†Bå¹¶ä¸æ˜¯ï¼Œå› ä¸ºå…¶è®¿é—®æ•°æ®çš„æ–¹å¼åœ¨å†…å­˜ä¸­ä¸æ˜¯çº¿æ€§è¿ç»­çš„ã€‚æ•…Bè¿™æ ·çš„çŸ©é˜µï¼Œ<strong><u>ä¸èƒ½ç›´æ¥view</u></strong></p>
<ul>
<li>ç›´æ¥viewæ“ä½œä¸æ”¹å˜å†…å­˜ç»„ç»‡æ–¹å¼ï¼Œviewå‰åæ•°æ®å…±äº«å†…å­˜</li>
<li>reshapeç›¸å½“äºæ˜¯ X.contiguous().viewã€‚å¦‚æœä¸€ä¸ªçŸ©é˜µä¸æ˜¯contiguousçš„ï¼Œcontiguousæ“ä½œå°†ä¼šå¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´å¹¶å¤åˆ¶åŸæ¥çš„tensorï¼Œä»¥æ–°çš„viewè¿›è¡Œæ•°æ®å­˜å‚¨</li>
<li>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>permute</code>, <code>narrow</code>, <code>expand</code>, <code>transpose</code>æ“ä½œä¹‹åï¼Œå‡ä¼šä½¿å¾—contiguousä¸æˆç«‹ã€‚ä½†æ˜¯<code>view</code>æ“ä½œè¿‡åï¼Œè™½ç„¶strideå¯èƒ½å‘ç”Ÿæ”¹å˜ï¼Œä½†å…¶å¹¶ä¸å½±å“contiguousæ€§ã€‚</li>
</ul>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://github.com/microsoft/Swin-Transformer">Github: microsoft/Swin-Transformer</a></p>
<p>[2] <a href="https://arxiv.org/abs/1809.04281">Huang, Cheng-Zhi Anna, et al. "Music transformer." <em>arXiv preprint arXiv:1809.04281</em> (2018).</a></p>
<p>[3] <a href="https://theaisummer.com/positional-embeddings/">AI Summer:How Positional Embeddings work in Self-Attention (code in Pytorch)</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>&lt;i class=&quot;fas fa-quote-left&quot;&gt;&lt;/i&gt;   To strive, to seek, to find, and not to yield.   &lt;i class=&quot;fas fa-quote-right&quot;&gt;&lt;/i&gt;</title>
    <url>/2021/02/11/To-strive-to-seek-to-find-and-not-to-yield/</url>
    <content><![CDATA[<center>
<i class="fas fa-quote-left"></i> To follow knowledge like a sinking star<br> Beyond the utmost bound of human thought. <i class="fas fa-quote-right"></i>
</center>
<p><br> <span id="more"></span></p>
<p>Read, and fell in love. Wondering whether I will lose restless heart like this when I'm old. Yet here I am, and I possess.</p>
<hr>
<p><br></p>
<center>
<font size="5"><b>Ulysses </b></font><font size="2">by Tennyson</font>
</center>
<p><br></p>
<p>It little profits that an idle king,</p>
<p>By this still hearth, among these barren crags,</p>
<p>Matchâ€™d with an aged wife, I mete and dole</p>
<p>Unequal laws unto a savage race,</p>
<p>That hoard, and sleep, and feed, and know not me.</p>
<p><br></p>
<p>I cannot rest from travel: I will drink</p>
<p>Life to the lees: all times I have enjoyed</p>
<p>Greatly, have suffered greatly, both with those</p>
<p>That loved me, and alone; on shore, and when</p>
<p>Through scudding drifts the rainy Hyades</p>
<p>Vexed the dim sea: I am become a name</p>
<p><br></p>
<p>For always roaming with a hungry heart</p>
<p>Much have I seen and known â€“ cities of men</p>
<p>And manners, climates, councils, governments,</p>
<p>Myself not least, but honored of them all â€“</p>
<p>And drunk delight of battle with my peers,</p>
<p>Far on the ringing plains of windy Troy,</p>
<p>I am a part of all that I have met;</p>
<p>Yet all experience is an arch wherethrough</p>
<p>Gleams that untravelled world, whose margin fades</p>
<p>For ever and for ever when I move</p>
<p><br></p>
<p>How dull it is to pause, to make an end,</p>
<p>To rust unburnished, not to shine in use!</p>
<p>As though to breathe were life. Life piled on life</p>
<p>Were all too little, and of one to me</p>
<p>Little remains: but every hour is saved</p>
<p>From that eternal silence, something more,</p>
<p>A bringer of new things; and vile it were</p>
<p>For some three suns to store and hoard myself,</p>
<p>And this grey spirit yearning in desire</p>
<p>To follow knowledge like a sinking star,</p>
<p>Beyond the utmost bound of human thought.</p>
<p><br></p>
<p>This is my son, mine own Telemachus,</p>
<p>To whom I leave the sceptre and the isle â€“</p>
<p>Well-loved of me, discerning to fulfil</p>
<p>This labour, by slow prudence to make mild</p>
<p>A rugged people, and through soft degrees</p>
<p>Subdue them to the useful and the good.</p>
<p>Most blameless is he, centred in the sphere</p>
<p>Of common duties, decent not to fail</p>
<p>In offices of tenderness, and pay</p>
<p>Meet adoration to my household gods,</p>
<p>When I am gone. He works his work, I mine.</p>
<p><br></p>
<p>There lies the port; the vessel puffs her sail:</p>
<p>There gloom the dark broad seas. My mariners,</p>
<p>Souls that have toilâ€™d, and wrought, and thought with me â€“</p>
<p>That ever with a frolic welcome took</p>
<p>The thunder and the sunshine, and opposed</p>
<p>Free hearts, free foreheads â€“ you and I are old;</p>
<p>Old age hath yet his honour and his toil;</p>
<p>Death closes all: but something ere the end,</p>
<p>Some work of noble note, may yet be done,</p>
<p>Not unbecoming men that strove with Gods.</p>
<p><br></p>
<p>The lights begin to twinkle from the rocks:</p>
<p>The long day wanes: the slow moon climbs: the deep</p>
<p>Moans round with many voices. Come, my friends,</p>
<p>â€˜Tis not too late to seek a newer world.</p>
<p>Push off, and sitting well in order smite</p>
<p>The sounding furrows; for my purpose holds</p>
<p>To sail beyond the sunset, and the baths</p>
<p>Of all the western stars, until I die.</p>
<p>It may be that the gulfs will wash us down:</p>
<p>It may be we shall touch the Happy Isles,</p>
<p>And see the great Achilles, whom we knew.</p>
<p>Thoâ€™ much is taken, much abides; and though</p>
<p><br></p>
<p>We are not now that strength which in old days</p>
<p>Moved earth and heaven; that which we are, we are;</p>
<p>One equal temper of heroic hearts,</p>
<p>Made weak by time and fate, but strong in will</p>
<p>To strive, to seek, to find, and not to yield.</p>
<p><br></p>
<hr>
<p>Poem written by <a href="https://en.wikipedia.org/wiki/Alfred%2C_Lord_Tennyson">Alfred, Lord Tennyson <i class="fab fa-wikipedia-w"></i></a>.</p>
<p>å¯æƒœwikiè¢«å¢™äº†ï¼Œçœ‹ç™¾åº¦å§-&gt;<a href="https://baike.baidu.com/item/%E9%98%BF%E5%B0%94%E5%BC%97%E9%9B%B7%E5%BE%B7%C2%B7%E4%B8%81%E5%B0%BC%E7%94%9F/3303915?fr=aladdin">Alfred, Lord Tennyson</a></p>
<p><br></p>
<hr>
]]></content>
      <categories>
        <category>life</category>
      </categories>
      <tags>
        <tag>poetry</tag>
      </tags>
  </entry>
  <entry>
    <title>Taichi Learning I</title>
    <url>/2023/01/11/Taichi-Learning-I/</url>
    <content><![CDATA[<h1 id="taichi-lang-i">Taichi Lang I</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ å·¨ä½¬ä»¬çš„å·¥ä½œï¼ˆèƒ¡æ¸Šæ˜ï¼Œæå­æ‡‹ both from MIT CSAILï¼‰ï¼š</p>
<ul>
<li>Taichi: A Language for High-Performance Computation on Spatially Sparse Data Structures. ToG 2019</li>
</ul>
<p>â€‹ åˆšå¥½æœ€è¿‘å·¥ä½œä¸å›¾å½¢å­¦é«˜åº¦ç›¸å…³ï¼Œå¹¶ä¸”ä¸€ç›´è§‰å¾—è‡ªå·±Pythonæ–¹é¢çš„æŠ€æœ¯æ ˆå¤ªæµ…äº†ï¼ˆè¯­æ³•ã€ä»£ç åŠ é€Ÿäº†è§£å¾—ä¸å¤Ÿæ·±å…¥ï¼‰ï¼Œäºæ˜¯æƒ³äº†è§£ä¸€ä¸‹è¿™ä¸ªè¯­è¨€ï¼ˆä¸Pythoné«˜åº¦è€¦åˆï¼‰ã€‚è¿™ä¸ªè¯­è¨€åœ¨å‰å¹´ä¸ƒæœˆæˆ‘åˆšå¼€å§‹åšæ¯•è®¾çš„æ—¶å€™Dingerå°±åœ¨çµ®çµ®å¨å¨è¯´Taichiæ€ä¹ˆæ€ä¹ˆé¦™äº†ï¼Œå½“æ—¶ä¹Ÿç©äº†å‡ ä¸ªdemoï¼Œä½†æ²¡æœ‰å»äº†è§£è¯­è¨€æœ¬èº«ã€‚æœ€è¿‘å¼€å§‹äº†è§£åè§‰å¾—ï¼Œè¦æ·±å…¥äº†è§£è¿™ä¸ªè¯­è¨€è¿˜æ˜¯éœ€è¦ä¸€äº›å¤–å›´çŸ¥è¯†çš„è¾…åŠ©ï¼ˆæ¯”å¦‚ï¼Œå­¦äº†CUDAã€LLVMç­‰åˆ™ä¼šè§‰å¾—æ¥å—å…¶è®¾è®¡æ€æƒ³æ˜¯ä¸€ä»¶æ¯”è¾ƒå®¹æ˜“çš„äº‹æƒ…ï¼‰ã€‚å­¦è¿™ä¸ªè¯­è¨€çš„ç›®æ ‡å½“ç„¶æ˜¯ç”¨Taichiå†™ä¸€ä¸ªç®€å•çš„ path tracer å‡ºæ¥å»...ã€‚æœ¬æ–‡çš„ä¸»è¦å†…å®¹æœ‰ï¼šï¼ˆ1ï¼‰è¿™å‡ å¤©å­¦ä¹ æ—¶é‡åˆ°çš„é—®é¢˜ï¼ˆ2ï¼‰ä¸€äº›Taichiåº•å±‚åŸç†ï¼ˆ3ï¼‰Python decoratorè¡¥å……ï¼ˆ4ï¼‰è‡ªå·±åšçš„ä¸€äº›å°demoã€‚</p>
<center>
<img src="/2023/01/11/Taichi-Learning-I/logo.png" style="zoom: 50%;">
</center>
<center>
Figure 1. æ··å…ƒå½¢æ„å¤ªæ é—ªç”µäº”è¿é­
</center>
<span id="more"></span>
<h2 id="ii.-taichi-scope">II. Taichi scope</h2>
<h3 id="æ¦‚å¿µ-è°ƒç”¨é—®é¢˜">2.1 æ¦‚å¿µ &amp; è°ƒç”¨é—®é¢˜</h3>
<p>â€‹ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®Taichi scopeä¸Python scopeçš„å®šä¹‰ï¼ˆä¹‹åä¼šç»™å‡ºä¸€äº›ç”±äºæˆ‘æ²¡æœ‰å½»åº•ææ¸…æ¥šå®šä¹‰è€ŒçŠ¯é”™çš„ä¾‹å­ï¼‰ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼š</p>
<div class="note warning"><ul>
<li>The code inside a kernel or a Taichi function is in the <em>Taichi scope</em>. The code in the Taichi scope is <strong><u>compiled</u></strong> by Taichi's runtime and <strong><u>executed in parallel</u></strong> on multi-core CPU or GPU devices for high-performance computation. The Taichi scope corresponds to the <code>__device__</code> side in CUDA.</li>
<li>Code outside of the Taichi scope is in the <em>Python scope</em>. The code in the Python scope is native Python and executed by Python's <strong><u>virtual machine</u></strong>, <em>not</em> by Taichi's runtime. The Python scope corresponds to the <code>__host__</code> side in CUDA.</li>
</ul>
</div>
<p>â€‹ æˆ‘è¿›è¡Œäº†ä¸€äº›å°æ ‡æ³¨ï¼ˆ<code>__device__</code>, <code>__host__</code>ï¼‰ã€‚å°±è¯­è¨€ç‰¹æ€§è€Œè¨€ï¼Œä¸æˆ‘çš„ç†è§£ï¼ˆç±»ä¼¼CUDAï¼‰åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œç”šè‡³è¿kernel callçš„æ–¹å¼ä¹Ÿéå¸¸ç±»ä¼¼ï¼škernel functionåªèƒ½åœ¨Python scopeä¸­è¢«è°ƒç”¨ï¼Œä¸å¯ä»¥åœ¨kernelæˆ–è€…<code>ti.func</code>ä¸­è¿›è¡Œè°ƒç”¨ã€‚CUDAå®é™…ä¸Šæ”¯æŒè¿™ä¸€æ“ä½œï¼ˆdynamic parallelismï¼‰ï¼Œä½†éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘æŠ€æœ¯ä»¥åŠè¶³å¤Ÿé«˜çš„archï¼ˆè€Œä¸”ä»æˆ‘ä¹‹å‰çš„ç»éªŒæ¥çœ‹ï¼ŒåŠ¨æ€å¹¶è¡Œçš„kernelè°ƒkernelæŠ€æœ¯ä¸ä¸€å®šæœ‰å¤šå¿«ï¼‰ã€‚</p>
<p>â€‹ ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ä»¥è¯´æ˜å¦‚ä¸‹é—®é¢˜ï¼š</p>
<blockquote>
<p>A kernel can take multiple arguments. Note that you <em>cannot</em> pass any arbitrary Python object to a kernel because Python objects can be <strong>highly dynamic</strong> and may hold data that Taichi's compiler cannot recognize.</p>
</blockquote>
<p>â€‹ æˆ‘åœ¨å†™SDF marching squaresæ—¶ç”±äºæœ‰å¦‚ä¸‹éœ€æ±‚ï¼š</p>
<ul>
<li>å¯è§†åŒ–çš„SDFé¢œè‰²æ˜¯ä¸åŒç‰©ä½“é¢œè‰²çš„æ··åˆï¼Œæ··åˆç­–ç•¥åŸºäºSDFï¼ˆæˆ–è€…è·ç¦»å€¼ï¼‰çš„å¤§å°ã€‚å¦‚æœæ˜¯ç®€å•çš„SDF marching squaresç®—æ³•ï¼Œåªéœ€è¦æŠŠä¸åŒç‰©ä½“SDFåŠ åœ¨ä¸€èµ·å³å¯ã€‚ä½†ç”±äºæœ‰é¢œè‰²æ··åˆéœ€æ±‚ï¼Œæ¯ä¸€ä¸ªç‰©ä½“çš„SDFéœ€è¦è¢«ä¿å­˜ï¼ˆä»¥ä¾›åç»­ä½¿ç”¨ï¼Œé‡ç®—å½“ç„¶ä¼šæ›´è€—æ—¶ï¼‰</li>
<li>æˆ‘ä¸€å¼€å§‹ç›´æ¥ç”¨ä¸€ä¸ªPython <code>list</code> å­˜å‚¨<code>taichi.field</code>ï¼Œç›¸å½“äºï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sdf_maps = [ti.field(dtype = ti.f32, (width, hieght)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ball_num)]</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸€å¼€å§‹ï¼Œæˆ‘åœ¨Python shellä¸­è¿›è¡Œäº†ç®€å•çš„éªŒè¯ï¼ˆæ˜¯å¦ä¼šæŠ¥é”™ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹å…¶ä¸­çš„é¡¹ï¼‰ï¼Œå‘ç°æ— é—®é¢˜ã€‚åœ¨å®é™…è¿è¡Œæ—¶åˆ™æŠ¥é”™ï¼ˆæŠ¥é”™ä¿¡æ¯å¤§æ¦‚æ˜¯ï¼‰ã€‚é¦–å…ˆç®€å•æä¸€ä¸‹æŠ¥é”™å¤„çš„é€»è¾‘ï¼š</p>
<ul>
<li><code>@ti.kernel</code> å‡½æ•°ï¼Œå‡½æ•°ä¼ å…¥ä¸€ä¸ª<code>i32</code>ï¼ˆä½œä¸ºå½“å‰å¤„ç†ç‰©ä½“çš„indexï¼‰ã€‚é‚£ä¹ˆå¦‚æœéœ€è¦è®¡ç®—å¯¹åº”indexç‰©ä½“çš„SDFï¼Œåˆ™éœ€è¦<code>sdf_maps[index]</code>ï¼Œå°†fieldä»listä¸­å–å‡ºã€‚</li>
</ul>
<p>â€‹ å¾ˆå¿«å•Šï¼Œç›´æ¥æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TypeError: list indices must be integers or slices, not Expr</span><br></pre></td></tr></table></figure>
<p>â€‹ æˆ‘å¤§ä¸ºä¸è§£ã€‚æˆ‘ä¼ å…¥çš„indexéƒ½å·²ç»è¿›è¡Œannotationå»ï¼Œä¸ºä»€ä¹ˆè¯´indexæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Ÿå„ç§å°è¯•æ— æœï¼Œæœ€åæŠŠ<code>list of 2D ti.field</code> æ¢æˆäº†ä¸€ä¸ª3D <code>ti.field</code>ï¼ˆæˆ‘ä¸€å¼€å§‹çš„color mapindexingä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚ä¸€ä¸ªminimalçš„ä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ti.init()</span><br><span class="line">glob = [ti.field(ti.f32, (<span class="number">20</span>, <span class="number">20</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">@ti.kernel</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">indexing</span>(<span class="params">idx: <span class="built_in">int</span></span>):</span><br><span class="line">    field = glob[idx % <span class="number">8</span>]</span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> field:</span><br><span class="line">        field[i, j] = <span class="built_in">float</span>(idx)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    indexing(i)</span><br></pre></td></tr></table></figure>
<p>â€‹ ç¬¬äº”è¡Œçš„<code>idx: int</code>æ¢æˆ<code>idx: ti.i32</code>ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä»æŠ¥é”™çš„ä½ç½®æ¥çœ‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ast\ast_transformer.py&quot;, line 250, in build_Subscript get_ref=get_ref)</span><br><span class="line">impl.py&quot;, line 149, in subscript return value[_indices[0]]</span><br></pre></td></tr></table></figure>
<p>â€‹ åº”è¯¥æ˜¯åœ¨è¿›è¡Œä¸€äº›é­”æ³•ç¼–è¯‘æˆ–è€…LLVMè½¬æ¢ã€‚å¯¹æ­¤ï¼ŒGithubçš„ä¸€ä¸ªissueæ˜¯<a href="https://github.com/taichi-dev/taichi/issues/2104">[è¿™æ ·è§£é‡Šçš„]</a>ã€‚</p>
<blockquote>
<p>This is because Taichi doesn't like Python lists as data storage. The <code>Expr</code> here is acutually a <strong>Taichi integer</strong>, not Python integer, therefore cannot pass (åŸæ–‡æ‰“é”™äº†ï¼Œè¾¾æˆäº†assâ™‚) as index to a Python list.</p>
</blockquote>
<p>â€‹ ãªã‚‹ã»ã©! æ­¤å³ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼šPythonä¸Taichiæ•°æ®ç»“æ„æœ€å¥½ä¸è¦æ··ç”¨ã€‚Pythonå¯ä»¥è½»æ˜“è®¿é—®Taichiçš„æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚åœ¨<code>ti.init</code>ä¹‹ååˆ›å»ºä¸€ä¸ª<code>ti.Vector.field</code>ï¼Œé€šè¿‡indexingå¯ä»¥å¾ˆç®€å•è®¿é—®ï¼‰ï¼Œä½†åœ¨kernelä¸­å´æ— æ³•å¾ˆå¥½åœ°å¯¹Pythonçš„åŠ¨æ€æ•°æ®ç»“æ„è¿›è¡Œè®¿é—®ã€‚è€Œä¸”åŠ¨æ€æ„å‘³ç€ï¼Œç¼–è¯‘æ—¶æ‰€å¤„ç†çš„å†…å®¹éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œè°èƒ½çŸ¥é“forå¾ªç¯å†…è¦å¯¹ä»€ä¹ˆæ ·çš„å˜é‡è¿›è¡Œéå†å‘¢ï¼Ÿ</p>
<p>â€‹ é¡ºä¾¿æä¸€å¥ï¼Œkernelè¦æ±‚è¿˜æŒºå¤šï¼š</p>
<ul>
<li>åªèƒ½æœ‰ä¸€ä¸ªreturnè¯­å¥ï¼ˆå¾ˆä¹…ä¹‹å‰çš„CUDAå¥½åƒä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰</li>
<li>åªèƒ½è¿”å›ä¸€ä¸ªå˜é‡ï¼ˆä¸åƒpythonå¯ä»¥packæˆä¸€ä¸ªtupleï¼‰</li>
<li>è¿”å›å˜é‡çš„å…ƒç´ ä¸è¦è¶…è¿‡30ï¼ˆ... ä¸ºä»€ä¹ˆï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ä¹ˆï¼‰</li>
<li>è¿”å›å€¼å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼ˆæ¯”å¦‚æˆ‘è¿”å›ä¸€ä¸ªVectorï¼Œä½†æ˜¯è¿”å›çš„type annotationæ˜¯i32... è¿™æ ·çš„caståšä¸åˆ°ï¼‰</li>
<li>kernelå‡½æ•°è¾“å…¥å˜é‡æœ‰å¤§å°é™åˆ¶ï¼ˆå•Šè¿™ï¼‰ï¼šOpenGLä¸º32ä¸ªelementï¼Œå…¶ä»–ä¸º64ä¸ªã€‚</li>
<li>kernelä¼šå°†å…¨å±€å˜é‡è§†ä¸ºå¸¸é‡ï¼ˆä¸å½“æŒ‡é’ˆï¼‰ï¼Œåº”å½“åªæœ‰fieldåšå¾—åˆ°éå¸¸é‡ï¼š<code>Vector</code>, <code>Matrix</code>, <code>Ndarray</code> éƒ½æ˜¯æ— æ³•è¿›è¡Œkernelå†…indexingçš„ï¼Œä¼šæŠ¥é”™å¦‚ä¸‹é”™è¯¯ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AssertionError: __getitem__ cannot be called in Taichi-scope</span><br></pre></td></tr></table></figure>
<div class="note danger"><p>â€‹ å…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘å¤šå˜´å‡ å¥ã€‚Taichiæœ‰å¼ºåˆ¶ loop unrolling æœºåˆ¶ï¼ˆä½¿å¾—for loopæ— éœ€åˆ¤æ–­å¾ªç¯æ¡ä»¶ï¼Œæ›´å¿«ï¼‰ï¼Œæ‰€ä»¥åœ¨kernelä¸­çš„ Vector, Matrixï¼Œå…¶indiceséƒ½éœ€è¦æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆcompile-time constantsï¼‰ã€‚ä¹Ÿå³ï¼š</p>
<ul>
<li>field å¯ä»¥ä½¿ç”¨å˜é‡è¿›è¡Œindexingæ“ä½œ</li>
<li>Vectorï¼ŒMatrixåœ¨Taichi scopeä¸­åªèƒ½ç”¨å¸¸é‡è¿›è¡Œindexingã€‚ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ï¼Œé˜»æ­¢äº†ä»»æ„çš„å‘é‡ã€çŸ©é˜µæ“ä½œï¼ˆåªèƒ½ä½¿ç”¨å†…ç½®çš„å‡½æ•°æ“ä½œï¼‰ï¼ŒCUDAè‡³å°‘è¿˜æœ‰å¾ˆé«˜çš„è‡ªç”±åº¦ï¼ˆå¯¹åº”çš„å¼€å‘éš¾åº¦å½“ç„¶ä¹Ÿæ¯”è¾ƒé«˜ï¼‰ã€‚</li>
</ul>
</div>
<ul>
<li>scope local variableï¼Œçœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vec = ti.Vector([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">@ti.kernel</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_vec</span>():</span><br><span class="line">    <span class="comment"># global vec</span></span><br><span class="line">    vec = ti.Vector([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Process started: <span class="subst">&#123;vec&#125;</span>&quot;</span>)</span><br><span class="line">set_vec()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Process completed: <span class="subst">&#123;vec&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºå°†ä¼šå…¨éƒ½æ˜¯<code>[1 2 3]</code>ã€‚æ„Ÿè§‰å¾ˆå¥‡æ€ªï¼Ÿä¸å¥‡æ€ªï¼Œå¯¹Pythoneræ¥è¯´å¾ˆå¥‡æ€ªï¼šC/C++ä¸­é‡åçš„local variableä¼˜å…ˆçº§éƒ½ä¼šæ›´é«˜ï¼Œç”±äºTaichiæ˜¯ç¼–è¯‘å¼çš„ï¼Œ<code>vec</code>åœ¨kernelå†…å®šä¹‰äº†ä¸€ä¸ªé‡åçš„local variableï¼Œæ”¹å˜å®ƒçš„å€¼å½“ç„¶ä¸ä¼šå½±å“globalå˜é‡ã€‚è€Œå¦‚æœä½ æƒ³è¦æ”¹å˜globalå˜é‡ï¼Œåœ¨Pythonä¸­æˆ‘ä»¬å­¦è¿‡<code>global</code>å…³é”®å­—ï¼Œä½†åœ¨Taichiä¸­è¢«banå»ï¼ˆä¼šæŠ¥é”™ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Unsupported node &quot;Global&quot;</span><br></pre></td></tr></table></figure>
<p>â€‹ è€Œ<code>@ti.func</code>çš„è¦æ±‚åˆ™å¾ˆå®½æ¾ã€‚</p>
<h3 id="åå‘é—®é¢˜---python-scopeåšä¸åˆ°çš„äº‹">2.2 åå‘é—®é¢˜ - Python scopeåšä¸åˆ°çš„äº‹</h3>
<p>â€‹ æœ€ç®€å•çš„ï¼šPython scopeä¸­æ— æ³•è°ƒç”¨<code>@ti.func</code>ä¿®é¥°çš„å‡½æ•°ï¼Œæ­£å¦‚CUDAä¸­ï¼ŒCPUæ— æ³•è°ƒç”¨<code>__device__</code>å£°æ˜çš„å‡½æ•°è€Œåªèƒ½ç”±<code>__global__</code>æˆ–è€…å¦ä¸€ä¸ª<code>__device__</code>å‡½æ•°è°ƒç”¨ä¸€æ ·ã€‚ä»ç°åœ¨é‡åˆ°çš„é—®é¢˜æ¥çœ‹ï¼Œè¿™éƒ¨åˆ†å¯ä»¥è¯´çš„å†…å®¹å¹¶ä¸å¤šï¼š</p>
<ul>
<li><code>ti.random</code> ä¸å¯åœ¨python scopeä¸­è¢«è°ƒç”¨ï¼ˆæ­¤å¤–éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°åªæ¥å—primitive types, æ¯”å¦‚float, intä¹‹ç±»çš„ï¼Œå‡è®¾æˆ‘éœ€è¦ä¸€ä¸ªrandom matrixï¼Œæœ€ç®€å•çš„åŠæ³•å¯èƒ½æ˜¯ç”¨<code>numpy</code>å†åˆ©ç”¨Taichiçš„<code>from_numpy</code>æ¥å£ï¼‰ã€‚</li>
<li>åŸå­æ“ä½œï¼ˆ<code>atomic_xxx</code>ç³»åˆ—ï¼‰ï¼Œçœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_atomic</span>():</span><br><span class="line">    field = ti.field(ti.i32, (<span class="number">20</span>, <span class="number">20</span>))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @ti.kernel</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">increment</span>():</span><br><span class="line">         <span class="keyword">for</span> i, j <span class="keyword">in</span> field:</span><br><span class="line">             ti.atomic_add(field[i, j], <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">    increment()</span><br><span class="line">    ti.atomic_add(field[<span class="number">0</span>, <span class="number">0</span>], <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼Œç¬¬ä¹è¡Œå¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ï¼ˆè™½ç„¶è¿™é‡Œç”¨åŸå­æ“ä½œå¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼ŒåŸå§‹ä»£ç å°±ä¸ä¼šæœ‰ä»€ä¹ˆrace conditionï¼‰ã€‚è€Œç¬¬åè¡Œä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...\taichi\lang\ops.py&quot;, line 1235, in atomic_add</span><br><span class="line">    expr.Expr(_ti_core.expr_atomic_add(x.ptr, y.ptr), tb=stack_info()))</span><br><span class="line">AttributeError: &#x27;int&#x27; object has no attribute &#x27;ptr&#x27;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸ªäººè®¤ä¸ºåŸå› ä¸kernelç¼–è¯‘æœºåˆ¶æœ‰å…³ï¼šç›´æ¥åœ¨Python scopeä¸­è¿è¡Œä½¿ç”¨çš„æ˜¯Pythonè™šæ‹Ÿæœºä»¥åŠè§£é‡Šå™¨ï¼Œå¯èƒ½ä¸å­˜åœ¨æŒ‡é’ˆè¿™ç§ç©æ„ï¼Ÿè€Œå¦‚æœåœ¨Taichi scopeä¸­æ‰§è¡Œï¼Œä¼šå…ˆç¼–è¯‘å¹¶è½¬ä¸ºå¯¹åº”backendï¼ˆå¦‚æœæ˜¯C++åç«¯åˆ™å¯ä»¥æœ‰æŒ‡é’ˆè®¾è®¡ï¼‰ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŸå­æ“ä½œå¹¶æ²¡æœ‰è¢«ç›´æ¥ç¦æ­¢ï¼ˆ<code>ti.random</code>åˆ™ç›´æ¥æŠ¥é”™è¯´ä¸èƒ½åœ¨Python scopeä¸­è¢«è°ƒç”¨ï¼‰ã€‚</p>
<p>â€‹ æ­¤å¤–æ³¨æ„ï¼ŒæŸäº›å‡½æ•°åœ¨<code>ti.init</code>è°ƒç”¨ä¹‹å‰ä¸èƒ½è°ƒç”¨ï¼ˆå¯èƒ½ï¼Œæ‰€æœ‰å‡½æ•°å§ï¼‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<code>ti.field</code>åˆ›å»ºä¸€ä¸ªfieldï¼Œè¿™ä¸ªå‡½æ•°ä¸èƒ½å…ˆäº<code>ti.init</code>è°ƒç”¨ï¼Œä½†<code>ti.Vector</code>ä¹‹ç±»çš„æ•°æ®ç»“æ„ï¼ˆTaichiåŸºæœ¬ç»“æ„ï¼Œåœ¨<code>ti.types</code>ä¸­å¯ä»¥æ‰¾åˆ°ç±»å‹çš„ï¼Œæ˜¯å¯ä»¥çš„ï¼‰ï¼š</p>
<ul>
<li>æ¯”å¦‚<code>ti.VectorNdarray</code>ï¼Œ<code>ti.MatrixNdarray</code>ï¼Œåœ¨<code>ti.types</code>ä¸­æ²¡æœ‰ï¼Œè™½ç„¶åœ¨æ²¡æœ‰initæ—¶è°ƒç”¨ä¸ä¼šå‘Šè¯‰ä½ <code>May be call ti.init() first?</code>ï¼Œä½†ç”±äºåœ¨æ„é€ å‡½æ•°ä¸­éƒ½æœ‰ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.arr = impl.get_runtime().prog.....</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>get_runtime()</code>åœ¨<code>ti.init</code>è¢«è°ƒç”¨å‰æ˜¯<code>None</code>ï¼Œæ‰€ä»¥å…¶å®éšå¼è¦æ±‚äº†initã€‚</p>
<h3 id="æ³›å‹ä¸ç¼–è¯‘è¿‡ç¨‹">2.3 æ³›å‹ä¸ç¼–è¯‘è¿‡ç¨‹</h3>
<p>â€‹ æˆ‘è¿˜æ²¡æœ‰æ·±å…¥åˆ°æ³›å‹çš„ä½¿ç”¨ï¼Œæ•…æœ¬èŠ‚åªç®€å•æä¸€äº›è®¾è®¡ä»¥åŠé€»è¾‘å±‚é¢çš„å†…å®¹ã€‚</p>
<h4 id="why-type-annotation">2.3.1 Why type annotation</h4>
<p>â€‹ C++çš„æ³›å‹è¿˜ä¸æ˜¯ç‰¹åˆ«ç†Ÿï¼ˆuse caseä¸å¤šï¼Œç»ƒå¾—å°‘ï¼Œè®¾è®¡æ³›å‹å°é¡¹ç›®æœ‰ç‚¹... å›°éš¾ï¼Ÿè´¹è„‘å­ï¼Ÿï¼‰ï¼Œåªèƒ½è¿›è¡Œä¸€äº›åŸºç¡€ç¼–ç¨‹ã€‚å””ï¼Œç°åœ¨æ¥è§¦äº†ä¸‰ç§æ³›å‹ï¼Œä¸‰ç§éƒ½æ˜¯æµ…å°è¾„æ­¢ï¼ˆæ·¦ï¼Œæ„Ÿè§‰ä¸‡é‡‘æ²¹ä»€ä¹ˆéƒ½ä¸ä¼šæï¼‰ï¼š</p>
<ul>
<li>C++ meta-programming</li>
<li>Rust generics (Rustå¤ªä¹…æ²¡å†™äº†ï¼Œæœ‰ç‚¹å¿˜äº†)</li>
<li>Taichi meta-programming</li>
</ul>
<p>â€‹ ï¼ˆ<strong><u>æ­£æ–‡å¼€å§‹</u></strong>ï¼‰å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰è¿™æ ·çš„ä¸€æ®µè¯ï¼š</p>
<div class="note info"><ul>
<li>Type hinting in Python is recommended, <em>not</em> mandatory.</li>
<li>Taichi makes it mandatory that you type hint the arguments and the return value of a kernel unless it does not have an argument or a return statement.</li>
</ul>
</div>
<p>â€‹ ä¹Ÿå³è¦æ±‚è¿›è¡Œæ˜¾å¼çš„type annotationï¼ˆåœ¨ç¼–è¯‘æ—¶Taichi backendç¼–è¯‘ç›¸å½“äºç±»å‹å£°æ˜ï¼‰ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·ï¼ŸåŸå› å…¶å®å¾ˆç®€å•ï¼Œç±»å‹æ¨æ–­ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ã€‚æˆ‘ä»¬åœ¨C++ä¸­æ¥è§¦äº†å¾ˆå¤šç±»å‹æ¨æ–­çš„caseï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty1&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inference_case1</span><span class="params">(Ty1&amp; val)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">inference_case1</span>(a);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty2&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inference_case2</span><span class="params">(Ty2 val)</span></span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">inference_case2</span>(b);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty3, <span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">inference_case3</span><span class="params">(<span class="type">const</span> std::vector&lt;Ty3&gt;&amp; vec, T idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> vec.<span class="built_in">begin</span>() + idx;</span><br><span class="line">&#125;</span><br><span class="line">std::vector&lt;<span class="type">size_t</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="type">uint32_t</span> idx = <span class="number">2</span>; </span><br><span class="line"><span class="keyword">auto</span> result = <span class="built_in">inference_case3</span>(vec, idx);</span><br></pre></td></tr></table></figure>
<p>â€‹ é—®ä¸Šè¿°<code>Ty1</code>ï¼Œ<code>Ty2</code>ï¼Œ<code>idx</code>åˆ†åˆ«æ¨å¯¼å‡ºæ¥æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿè¿™é‡Œåªç»™å‡ºç»“è®ºï¼Œä¸æ¸…æ¥šçš„è¯è‡ªå·±å»è¡¥ï¼š<code>Ty1 = const int</code>ï¼Œ<code>Ty2 = int</code>ï¼Œ<code>std::vector&lt;int&gt;::const_iterator</code>ã€‚ä½†ä»è¿™æ ·çš„ç®€å•ä¾‹å­å¯ä»¥å‘ç°ï¼ˆæˆ‘çš„ç›®å‰çš„ç†è§£ï¼Œå¯èƒ½æ˜¯é”™çš„ï¼Œæ¯•ç«Ÿæˆ‘æ³›å‹å­¦å¾—ä¸æ·±ï¼‰ï¼ŒC++å¯ä»¥è¿›è¡Œç±»å‹æ¨æ–­ä¸€å®šåœ¨äºå‚ä¸æ¨å¯¼çš„ç±»å‹ä¸€å®šæ˜¯ç¼–è¯‘æœŸå¯çŸ¥çš„ï¼ˆç›´æ¥ï¼Œæˆ–é—´æ¥ï¼‰ã€‚å¯¹äºTaichiè€Œè¨€ï¼Œç”±äºkernel functionæ˜¯ä»Python scopeä¸­è°ƒç”¨çš„ï¼ŒPythonä½œä¸ºå¼±ç±»å‹åŠ¨æ€è¯­è¨€ï¼Œç±»å‹æ˜¯ä¸å®šçš„ï¼Œä½ è¦è®©Taichiç¼–è¯‘å™¨æ— ä¸­ç”Ÿæœ‰ï¼Œä»ä½ éƒ½ä¸ä¸€å®šçŸ¥é“æ˜¯ä¸ªå•¥çš„ç±»å‹ä¸­æ¨å‡ºæ¥ç®€ç›´æ˜¯å¼ºäººé”â™‚ç”·ã€‚æ‰€ä»¥å‚æ•°ã€è¿”å›å€¼éœ€è¦å¼ºåˆ¶type hintï¼ˆè¿”å›å€¼çš„è¯ï¼Œæˆ‘æ€»æ„Ÿè§‰å¯ä»¥æ¨å‡ºæ¥çš„æ ·å­ï¼Ÿä¹ä¸€æƒ³è„‘å­é‡Œæ²¡æœ‰å¾ˆå¥½çš„æ— æ³•æ¨å‡ºçš„ä¾‹å­...ï¼‰ã€‚</p>
<h4 id="ç¼–è¯‘è¿‡ç¨‹åœ¨åšä»€ä¹ˆ">2.3.2 ç¼–è¯‘è¿‡ç¨‹åœ¨åšä»€ä¹ˆ</h4>
<p>â€‹ ç²—æµ…ç†è§£ä¸€ä¸‹ï¼Œè¿™é‡Œåªæä¸€äº›é‡è¦è¿‡ç¨‹ï¼š</p>
<pre class="mermaid">
graph LR

A(Python code)--&gt;|AST transformation|B(Python&#x2F;Taichi AST)--&gt;|Optimization &#x2F; compile|C(Taichi IR)--&gt;|Optimization &#x2F; compile|D(Kernels)

</pre>
<center>
Figure 2. ç¼–è¯‘è¿‡ç¨‹é‡è¦äº‹ä»¶ï¼ˆä¸ªäººç†è§£ï¼‰
</center>
<p>â€‹ é¦–å…ˆæ˜¯AST transformationï¼ˆAbstract Syntax Treeï¼‰ï¼Œç›¸å½“äºå°†Python codeç»„ç»‡æˆæ›´å®¹æ˜“åˆ†æã€è·Ÿè¸ªçš„è¡¨å¾ï¼ˆæ¯”å¦‚ï¼Œæ¸…æ¥šåœ°è®°å½•æ¯ä¸ªsymbolåœ¨ç¬¬å‡ è¡Œç¬¬å‡ åˆ—ï¼Œå±äºè°ƒç”¨ã€å‡½æ•°åã€å˜é‡è¿˜æ˜¯ä»€ä¹ˆå…¶ä»–çš„ç±»å‹ï¼‰ï¼Œè¿™æ˜¯Python codeåœ¨è¿›å…¥è§£é‡Šå™¨ä¹‹å‰çš„ä¸€æ­¥é‡è¦æ“ä½œï¼ˆå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§â€œç¼–è¯‘â€ï¼‰ï¼Œè¯¦è§<a href="https://medium.com/@wshanshan/intro-to-python-ast-module-bbd22cd505f7">[è¿™ç¯‡æ–‡ç« ]</a>ã€‚Taichiä¹Ÿä¼šç”Ÿæˆå¯¹åº”çš„ASTï¼Œå¯¹ASTè¿›è¡Œåˆ†æï¼Œç”ŸæˆTaichiä¸­é—´è¡¨ç¤ºï¼ˆIR - intermediate representationï¼‰ï¼Œä¸LLVMä¸åŒï¼ŒTaichiä¸­é—´è¡¨ç¤ºæ›´åŠ â€œé«˜çº§â€ï¼ˆhigh-levelï¼‰ï¼Œç²’åº¦æ›´å¤§ã€æ›´åŠ æŠ½è±¡ï¼Œæ‰€ä»¥ä¿ç•™äº†å¾ˆå¤šåŸæœ‰çš„ä¿¡æ¯ï¼Œå¯¹Taichi IRå…ˆè¿›è¡Œä¸€æ¬¡ä¼˜åŒ–å¯ä»¥å¾—åˆ°æ›´å¥½çš„ä¼˜åŒ–æ•ˆæœï¼š</p>
<center>
<img src="/2023/01/11/Taichi-Learning-I/image-20230111101008259.png" alt="image-20230111101008259" style="zoom:67%;">
</center>
<center>
Figure 3. å¯åˆ†æåº¦ä¸ä¼˜åŒ–åŠ›åº¦çš„trade-offï¼šè¶Šåº•å±‚è¶Šå®¹æ˜“è¿›è¡Œä¼˜åŒ–ï¼Œä½†è¶Šé¡¶å±‚ä¿¡æ¯è¶Šå¤šã€å¯ä»¥è¿›è¡Œä¼˜åŒ–è´¨é‡è¶Šé«˜
</center>
<p>â€‹ èƒ¡æ¸Šæ˜åœ¨å…¶PPTä¸­æäº†ä¸€äº›æœ‰è¶£çš„ç‚¹ï¼Œç”¨ä»¥ä½è¯â€œä¿¡æ¯è¶Šå¤šï¼Œä¼˜åŒ–æœºä¼šè¶Šå¤šâ€è¿™ä¸€è§‚ç‚¹ï¼š</p>
<ul>
<li>æŒ‡é’ˆåä¸å¯ç›¸äº’è¦†ç›–ï¼š<code>a</code>å°±æ˜¯<code>a</code>ï¼Œ<code>b</code>å°±æ˜¯<code>b</code>ï¼Œé™¤éä¸¤è€…ç›¸åŒï¼Œå¦åˆ™ä¸¤è€…ä¸ä¼šæŒ‡å‘åŒä¸€ä½ç½®</li>
<li>å†…å­˜è®¿é—®å…¨ç»æ‰‹<code>field[indices]</code>ï¼šCä¸­çš„æŒ‡é’ˆå¯ä»¥çµæ´»åœ°castï¼Œâ€œå‡ ä¹ä»»æ„åœ°â€æŒ‡å‘ä»»ä½•objectï¼Œè¿™ä¼šç»™ä¼˜åŒ–é€ æˆéº»çƒ¦ï¼Œè€ŒTaichiä¸­ï¼ŒæŒ‡å‘çš„objectä»¥åŠç±»å‹éƒ½æ˜¯å›ºå®šçš„ï¼ˆconstä»¥åŠç±»å‹å·²çŸ¥çš„æŒ‡é’ˆï¼‰</li>
<li>ä¿®æ”¹å­˜å‚¨ä¿¡æ¯çš„å”¯ä¸€æ–¹æ³•ï¼š<code>field[indices]</code>ï¼ˆçµæ´»æ€§æ¢é€Ÿåº¦ï¼‰</li>
<li>è¯»æ“ä½œä¸ä¼šä¿®æ”¹ä»»ä½•å†…å®¹ï¼šä¸æŠ¥é”™ï¼Œä¹Ÿä¸ä¼šåœ¨è¶…ç•Œæ—¶â€œæ™ºèƒ½åœ°â€newä¸€ä¸ªobjectå‡ºæ¥</li>
</ul>
<h4 id="interesting-bls">2.3.3 Interesting BLS</h4>
<p>â€‹ æ­¤å¤„çœŸå°±å‡ å¥è¯å¸¦è¿‡ï¼šBlock local storageï¼ˆç›®å‰è¿˜æ²¡ç”¨åˆ°ï¼Œä½†è¯»docsæ—¶çœ‹åˆ°è¿™ä¸ªfeatureï¼Œè§‰å¾—éå¸¸æœ‰æ„æ€ï¼‰ï¼Œå‡å¦‚ä½ æ˜ç™½CUDAå†…å­˜æœºåˆ¶ï¼Œè¿™ä¸ªæ¦‚å¿µå°±éå¸¸ç®€å•ï¼Œä¸‹é¢ä»¥CUDAå†…å­˜æœºåˆ¶è¿›è¡Œç±»æ¯”ï¼š</p>
<ul>
<li>GPUçš„ä¸¤ç±»å†…å­˜ï¼šglobal memoryï¼ˆé¡¾åæ€ä¹‰ï¼Œä»»ä½•blockã€çº¿ç¨‹å‡å¯è®¿é—®ï¼‰ï¼Œshared memoryï¼ˆä¸€ä¸ªblockå†…çš„çº¿ç¨‹å…±äº«ï¼Œä¸åŒblockä¹‹é—´ä¸å¯ç›¸äº’è®¿é—®ï¼‰</li>
<li>global memoryå·¨æ…¢æ— æ¯”ï¼Œshared memoryè®¿é—®é€Ÿåº¦å¯è¾¾global memoryçš„20-100å€ï¼ˆé€šå¸¸ï¼Œ10ä¸ªcycleså†…ï¼Œç›¸æ¯”äº200cyclesä»¥ä¸Šçš„global memoryï¼‰</li>
<li><strong><u>éœ€è¦åå¤è¯»å–æˆ–è€…å†™å…¥çš„å˜é‡</u></strong>ï¼šå¦‚æœä¸å­˜åœ¨å¯„å­˜å™¨ä¸Šï¼Œå°±å¯ä»¥å­˜åœ¨shared memoryä¸ŠåŠ é€Ÿè®¿é—®ã€‚</li>
</ul>
<p>â€‹ Taichiä¹Ÿæœ‰ç±»ä¼¼æ“ä½œï¼Œè§ä¸‹å›¾ï¼Œè¿™é‡Œæˆ‘å°±ä¸å±•å¼€è®²äº†ï¼š</p>
<p><img src="/2023/01/11/Taichi-Learning-I/image-20230111105501475.png" alt="image-20230111105501475" style="zoom: 67%;"></p>
<center>
Figure 4. CUDAï¼ï¼ˆå¹»è§†ï¼‰
</center>
<p>â€‹ è™½ç„¶Taichiæ²¡æœ‰CUDAåº•å±‚é‚£ä¹ˆçµæ´»ï¼Œä½†å®ƒæ•ˆç‡é«˜å•Šï¼Œæˆ‘æ˜¯ç»å†è¿‡è¿™ç§äº‹æƒ…çš„ï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œä¹‹åéœ€è¦å¥½å¥½ç ”ç©¶ä¸€ä¸‹<code>ti.cache_shared</code>ä»¥åŠä¸€äº›è¿›é˜¶åŠ é€Ÿå†™æ³•ã€‚</p>
<p><img src="/2023/01/11/Taichi-Learning-I/image-20230111105638243.png" alt="image-20230111105638243" style="zoom: 75%;"></p>
<center>
Figure 5. æ„Ÿè§‰åƒæ˜¯ä¸­è¯‘è‹±è¯æ•°çˆ†ç‚¸
</center>
<hr>
<h2 id="iii.-pythonç›²åŒº---decorator">III. Pythonç›²åŒº - decorator</h2>
<p>â€‹ é¥æƒ³å…¬ç‘¾å½“å¹´ï¼Œçœ‹ä¸æ‡‚decoratorçš„ç‡ƒæƒ…å²æœˆï¼Œä»¿ä½›å°±åœ¨æ˜¨å¤©ã€‚å½“å¹´å¯¹è¯­è¨€ã€ç®—æ³•çš„æ•æ„Ÿåº¦éƒ½æ²¡æœ‰ä»Šå¤©é‚£ä¹ˆé«˜ï¼ˆç›¸å¯¹é«˜ï¼Œç»å¯¹ä½ï¼‰ï¼Œçœ‹ä¸æ˜ç™½æ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼ŒåŠ ä¸Šç¬”è€…æ¯”è¾ƒç¬¨ã€æ€¥èºï¼Œçœ‹ä¸¤çœ¼å°±æ¶¦äº†...</p>
<p>â€‹ decoratorå…¶å®å¾ˆç®€å•ï¼Œä¸æ‡‚çš„æ—¶å€™è§‰å¾—è£…é€¼ï¼Œæ‡‚äº†å°±è§‰å¾—æŒºè¯­æ³•ç³–çš„ï¼ˆæ¯•ç«Ÿå‡å°‘äº†ä»£ç é‡å¤ç‡ï¼‰ï¼Œå¯¹äºç®€å•çš„ç”¨æ³•ï¼Œå…¶æœ¬è´¨å°±æ˜¯ï¼šç”±äºå‡½æ•°ä¹Ÿæ˜¯objectï¼Œå¯ä»¥èµ‹å€¼æ¥èµ‹å€¼å»çš„ï¼Œä¸€ä¸ªâ€œä¿®é¥°å‡½æ•°â€å¯ä»¥æ¥æ”¶å‡½æ•°objectä½œä¸ºå‚æ•°ï¼Œåœ¨åŸå‡½æ•°çš„åŸºç¡€ä¸Šå¢åŠ ä¸€äº›åŠŸèƒ½ï¼ˆä½†ä¿æŒåŸå‡½æ•°ä»£ç ä¸å˜æ€§ï¼‰ï¼Œå†…éƒ¨å®ç°å°±æ˜¯ä¸€ä¸ªå‡½æ•°wrapperï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_notify</span>(<span class="params">init_func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_wrapper</span>(<span class="params">*args, **kwargs</span>):		<span class="comment"># I will skip this unpacking syntax</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Intialization process started.&quot;</span>)</span><br><span class="line">        ret = init_func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Intialization process completed.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">   	<span class="keyword">return</span> inner_wrapper</span><br><span class="line">        </span><br><span class="line"><span class="meta">@init_notify</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize</span>():</span><br><span class="line">    <span class="comment"># some bad-ass class initialization code</span></span><br></pre></td></tr></table></figure>
<p>â€‹ å®é™…ä¸Šï¼Œ<code>@init_notify</code>è¿‡ç¨‹å°±æ˜¯æŠŠinitializeåŒ…äº†ä¸€å±‚ï¼Œç­‰åŒäº<code>init_notify(initialize)</code>ï¼Œä½†æ˜¯<code>init_notify(initialize)</code>å†™æ³•ä¹Ÿå¤ªå‡½æ•°å¼å»ï¼ˆå‡è®¾æˆ‘æœ‰å¾ˆå¤šwrapperï¼Œæ¯ä¸ªéƒ½è¦åŒ…ä¸€å±‚ï¼Œçœ‹èµ·æ¥å°±è·Ÿæ´‹è‘±ä¼¼çš„ï¼‰ã€‚æ³¨æ„ï¼Œå¦‚æœä¿®é¥°å™¨è¦å¸¦å‚æ•°è¾“å…¥ï¼ˆå¸¦å‚æ•°ä¿®é¥°ï¼‰ï¼Œåˆ™æ›´åŠ å¤æ‚ï¼Œç”±äºä½œä¸ºä¿®é¥°å™¨æœ¬èº«çš„å‡½æ•°åªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š<code>@init_notify</code> æ˜¯ä¿®é¥°å™¨å‡½æ•°ï¼Œå…¶æœ¬èº«çš„å‚æ•°å°±æ˜¯ä¸‹é¢çš„initializeå‡½æ•°ï¼Œè·Ÿåœ¨<code>@</code>åé¢çš„è¿™ä¸€å—æ˜¯ä¸€ä¸ª <strong><u>å•ä¸€å‚æ•°å‡½æ•°</u></strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå•ä¸€å‚æ•°å‡½æ•°ä½†åŒæ—¶æ”¯æŒè¾“å…¥æˆ‘ä»¬éœ€è¦çš„å†…å®¹å°±å¯ä»¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_notify</span>(<span class="params">init_func</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner_wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> process started.&quot;</span>)</span><br><span class="line">            ret = init_func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> process completed.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> inner_wrapper</span><br><span class="line"><span class="keyword">return</span> init_notify</span><br></pre></td></tr></table></figure>
<p>â€‹ è°ƒç”¨å¾ˆç®€å•ï¼š<code>@notify("Initialization")</code>ã€‚åˆ«ä»¥ä¸ºè¿™é‡Œçš„ä¿®é¥°å™¨å‡½æ•°å¸¦äº†å‚æ•°ï¼Œä¿®é¥°å™¨å‡½æ•°ä¸æ˜¯<code>notify</code>ï¼Œè€Œæ˜¯<code>notify</code>çš„è¿”å›å€¼ï¼ˆä¸€ä¸ªå•å‚æ•°å‡½æ•°ï¼‰ã€‚</p>
<p>â€‹ å‚è€ƒTaichiçš„æºç ï¼ŒæŸ¥äº†ä¸€ä¸‹<code>@ti.func / @ti.kernel</code>ï¼Œä»£ç ä¸­ç”¨åˆ°äº†<code>functools</code>çš„<code>wraps</code>å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@functools.wraps(<span class="params">func</span>)</span></span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†è¾“å…¥å‡½æ•°çš„éƒ¨åˆ†ä¿¡æ¯è¿ç§»åˆ°ä¿®é¥°åå‡½æ•°ï¼Œç”±äºä¿®é¥°åå‡½æ•°å®é™…ä¸Šæ˜¯è¿”å›çš„<code>inner_wrapper</code>å‡½æ•°ï¼Œå…¶åå­—ï¼ˆ<code>__name__</code>ï¼‰ï¼Œhelpæ–‡æ¡£ï¼ˆ<code>__doc__</code>ï¼‰éƒ½æ— äº†ï¼Œæ•…å¯ä»¥ç”¨<code>wraps</code>å‡½æ•°ä¿®é¥°<code>inner_wrapper</code>ï¼ˆç›´æ¥åœ¨<code>def inner_wrapper</code>ä¸Šæ–¹åŠ <code>@functools.wraps(func)</code>ï¼‰ã€‚</p>
<div class="note warning"><p>â€‹ æ³¨æ„ï¼ŒTaichiçš„ä¿®é¥°å™¨å‡½æ•°è²Œä¼¼æœ‰ä¸¤ä¸ªè¾“å…¥å‚æ•°ã€‚æœ‰é»˜è®¤å‚æ•°åˆ™æ²¡æœ‰é—®é¢˜ï¼Œä»£ç ä¸­ä¹Ÿç»™å‡ºäº†Trueçš„ä¿®é¥°æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">fn, is_real_function=<span class="literal">False</span></span>):</span><br><span class="line">    	<span class="comment">#...</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">real_func</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="keyword">return</span> func(fn, is_real_function=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼š<code>@real_func</code>å°±è¡Œäº†ã€‚ä¸è¿‡æˆ‘ç°åœ¨è¿˜æ²¡æŸ¥åˆ°ä»€ä¹ˆæ˜¯real function</p>
</div>
<p>â€‹ è¿™é‡Œæä¾›ä¸€ä¸ªå°sidenoteï¼š<code>@pyfunc</code>ä¿®é¥°ï¼šè¡¨ç¤ºè¢«ä¿®é¥°å‡½æ•°å¯ä»¥åœ¨Taichi Â Python scopeä¸­è°ƒç”¨ï¼š</p>
<ul>
<li>åœ¨Taichi scopeä¸­è°ƒç”¨æ—¶ï¼Œä¼šè¿›è¡Œç¼–è¯‘</li>
<li>åœ¨Python scopeä¸­è°ƒç”¨æ—¶ï¼Œç›´æ¥å°±æ˜¯åŸå§‹Python codeçš„æ‰§è¡Œæ–¹å¼ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œç›¸å½“äº<code>__device__ __host__</code>ä¿®é¥°çš„CUDAå‡½æ•°ï¼Œå¯ä»¥åŒæ—¶åœ¨hostä»¥åŠdeviceä¸Šè°ƒç”¨ï¼Œä¸è¿‡CUDAä¼šç¼–è¯‘ç”Ÿæˆä¸¤ä»½ä»£ç ï¼ˆä¸€ä»½æ˜¯NVCCç¼–è¯‘ç”Ÿæˆçš„GPUä»£ç ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯Cç¼–è¯‘å™¨ç”Ÿæˆçš„CPUä»£ç ï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="iv.-show-cases">IV. Show Cases</h2>
<p>â€‹ å¾ˆåƒåœ¾çš„ç©æ„ï¼Œåˆšå­¦ï¼ŒæŠ€æœ¯å¾ˆå·®ã€‚ä¸è¿‡Taichç¡®å®å¼ºï¼ŒSDFè¿™ä¸ªæ¯”æˆ‘ä¹‹å‰ç”¨OpenCVå†™å¾—å¿«å¤šäº†ï¼ˆè™½ç„¶é€»è¾‘ä¸æ˜¯ç‰¹åˆ«ä¸€æ ·ï¼Œä½†åŠŸèƒ½æ›´å¼ºäº†ï¼ŒOpenCVé‚£ä¸€ç‰ˆæœ¬åªèƒ½ç»˜åˆ¶zero level setï¼Œè¿™ä¸€ç‰ˆæœ¬æˆ‘å¯ä»¥æ··åˆé¢œè‰²ï¼‰ã€‚å…·ä½“çš„ä»£ç è§ï¼š<a href="https://github.com/Enigmatisms/learn_taichi">Github: Enigmatisms/learn_taichi</a></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Distance Field visualization</th>
<th style="text-align: center;">SDF marching squares</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2023/01/11/Taichi-Learning-I/DF.gif" style="zoom:166.67%;"></td>
<td style="text-align: center;"><img src="/2023/01/11/Taichi-Learning-I/ms-sdf.gif"></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] Hu, Yuanming, et al. "Taichi: a language for high-performance computation on spatially sparse data structures." <em>ACM Transactions on Graphics (TOG)</em> 38.6 (2019): 1-16.</p>
<p>[2] <a href="https://yuanming.taichi.graphics/publication/2020-life-of-kernel/life_of_a_taichi_kernel.pdf">Yuanming Hu: Life of a Taichi Kernel</a></p>
<p>[3] <a href="https://yuanming.taichi.graphics/publication/2020-taichi-tutorial/taichi-tutorial.pdf">Hu, Yuanming. "The Taichi Programming Language: A Hands-on Tutorial." ACM| Special Interest Group on Computer Graphics and Interactive Techniques Conference Courses, 2020.</a></p>
<p>[4] <a href="https://docs.taichi-lang.org/">Taichi lang docs</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>CUDA</tag>
        <tag>LLVM</tag>
        <tag>Taichi lang</tag>
      </tags>
  </entry>
  <entry>
    <title>Typora &amp; Markdown Intros</title>
    <url>/2021/02/09/Typora-Markdown-Intros/</url>
    <content><![CDATA[<h1 id="typora-markdown">Typora &amp; Markdown</h1>
<hr>
<h2 id="why">Why?</h2>
<p><span id="start"></span></p>
<p>â€‹ æ­¤æ–‡æ’°å†™çš„ç›®çš„æ˜¯ï¼š</p>
<ul>
<li>å½’çº³Typoraï¼ˆMarkdownç¼–è¾‘å™¨ï¼‰ çš„åŸºæœ¬ä½¿ç”¨ï¼ˆå¸¸ç”¨çš„éƒ½èƒ½æ‰¾åˆ°ï¼‰</li>
<li>ç»™æˆ‘Ravençš„å®‰åˆ©ã€‚</li>
</ul>
<center>
æ•ˆç‡å·¥å…·ï¼Œç»ä¸ç™½å¯
</center>
<p></p>
<span id="more"></span>
<h3 id="why-markdown">Why Markdown?</h3>
<p>â€‹ è™½è¯´markdownå®é™…æ˜¯ç»™ ä¸çˆ±ä½¿ç”¨é¼ æ ‡åœ¨wordä¸Šç‚¹æ¥ç‚¹å»çš„äººä½¿ç”¨çš„ï¼ˆå¹¶ä¸”é¢å‘çš„äººç¾¤ä¸€èˆ¬æ˜¯å¯¹æ•²ä»£ç æœ‰å…´è¶£çš„äººï¼‰ï¼Œä½†ç”±äºMarkdownä¸Šæ‰‹æå…¶ç®€å•ï¼Œå¹¶ä¸”ä½¿ç”¨æ•ˆç‡æé«˜ï¼Œ<strong><u>æå…¶é€‚åˆï¼š</u></strong></p>
<ul>
<li>æ’°å†™ReadMeï¼Œå¸®åŠ©ä»–äººç†è§£æŸä¸ªç¨‹åº / æ–‡ä»¶åŒ… / å‹ç¼©åŒ…æ–‡ä»¶ / æ–‡æ¡£ / ä»£ç  å¦‚ä½•ä½¿ç”¨ã€‚</li>
<li>å†™ä¸€äº›é£æ ¼ç®€çº¦è€Œåˆå¥½çœ‹çš„æ–‡æ¡£ï¼Œæ–¹ä¾¿æ’°å†™ tutorials / ideas / agenda / ä¼šè®®è®°å½• / <strong><u>å­¦ä¹ ç¬”è®°</u></strong> / <strong><u>å®éªŒæŠ¥å‘Š</u></strong> / ç­‰ç­‰ï¼Œ<strong><u>å¹¶å¿«é€Ÿç”ŸæˆPDFæ–‡ä»¶</u></strong>ã€‚</li>
<li>ã€Event Horizonã€‘ä¸Šçš„æ‰€æœ‰åšæ–‡ï¼Œå‡æ˜¯markdownæ¸²æŸ“å‡ºæ¥çš„ã€‚</li>
</ul>
<h3 id="why-typora">Why Typora?</h3>
<p><img src="/2021/02/09/Typora-Markdown-Intros/from_site.png"></p>
<center>
Figure 1. æ¥è‡ªå®˜ç½‘çš„å›¾ç‰‡
</center>
<p>â€‹ Typora æ˜¯ä¸€æ¬¾æå…¶è½»é‡çº§çš„Markdownè¯­æ³•ç¼–è¾‘å™¨ï¼Œå…¶ç•Œé¢å°±åƒwindowsè‡ªå¸¦çš„è®°äº‹æœ¬ã€‚å¹¶ä¸”ï¼Œå¯¹äºmarkdownè¯­æ³•æ”¯æŒå®æ—¶æ¸²æŸ“ï¼ˆç›´æ¥æ˜¾ç¤ºæ•ˆæœï¼‰ã€‚æ˜“ç”¨æ€§ä¸ç¾è§‚æ€§ï¼ˆå°¤å…¶æ˜¯å…¶è‡ªå¸¦çš„Pixyllä¸»é¢˜ï¼Œä¸­è‹±æ–‡éƒ½æå…¶ç¾è§‚ï¼‰æ˜¯å…¶å¦å¤–ä¸¤ä¸ªä¼˜ç‚¹ã€‚Typoraæ”¯æŒï¼š</p>
<ul>
<li>Markdownæ‰€æœ‰è¯­æ³•</li>
<li>LaTexæ•°å­¦å…¬å¼æ¸²æŸ“</li>
<li>htmlæ”¯æŒï¼ˆç½‘é¡µå‰ç«¯è¯­è¨€ï¼Œmarkdownè¿›é˜¶ä¸­ç”¨äºç¾åŒ–ï¼Œæœ¬æ–‡ä¼šæå‡ ä¸ªå¸¸ç”¨æ —å­ï¼‰</li>
</ul>
<hr>
<h2 id="level-1-skills">Level 1 Skills</h2>
<p>â€‹ æœ¬èŠ‚å°†ä¼šä»‹ç»åŸºç¡€çš„markdownè¯­æ³•ã€‚è®°å¿†è¿™äº›è¯­æ³•æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œå› ä¸ºéƒ½å¾ˆç®€å•ã€‚</p>
<h3 id="æ— åº-æœ‰åºitems">æ— åº &amp; æœ‰åºitems</h3>
<h4 id="æ— åºitems">æ— åºitems</h4>
<p>â€‹ åœ¨åˆ†ç‚¹æ“ä½œæ—¶ï¼Œå¸¸å¸¸ä¼šä½¿ç”¨ (1) åˆ†ç‚¹å†…å®¹å‰é¢åŠ ä¸Šä¸€ä¸ªé»‘è‰²åœ†ç‚¹ (2) ä½¿ç”¨ç¼–å·ï¼ˆæœ‰åºæ’åˆ—ï¼‰ï¼Œåœ¨markdownä¸­ï¼Œæ— éœ€è¿›è¡Œé¼ æ ‡ç‚¹å‡»ï¼ˆé¼ æ ‡ / è§¦æ§æ¿ / è§¦å± åœ¨æ–‡æ¡£æ’°å†™çš„æ—¶å€™çœŸçš„ç´¯èµ˜ï¼‰ã€‚å¯¹äº <strong>æ— åºåˆ†ç‚¹ï¼Œå¯ä»¥å¦‚ä¸‹è¾“å…¥ï¼š</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> Markdown is easy to use.</span><br><span class="line"><span class="bullet">-</span> Markdown is so goodlooking.</span><br><span class="line"><span class="bullet">-</span> Simplicity is the basic traits.</span><br></pre></td></tr></table></figure>
<p>â€‹ ï¼ˆå‰é¢çš„- å°±æ˜¯å‡å·ï¼Œå½“ç„¶ â€œ*â€ å·ä¹Ÿæ˜¯å¯ä»¥æ›¿æ¢â€œ-â€ å·çš„ï¼‰ï¼Œåœ¨Typoraé¡µé¢ä¸Šå®æ—¶æ˜¾ç¤ºçš„ç»“æœæ˜¯ï¼š</p>
<ul>
<li>Markdown is easy to use.</li>
<li>Markdown is so goodlooking.</li>
<li>Simplicity is the basic traits.</li>
</ul>
<p>â€‹ å½“ç„¶ï¼Œä¸åŒçº§åˆ«çš„itemsï¼ˆåˆ†çº§ï¼‰ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œåªéœ€è¦é€šè¿‡ç¼©è¿›çš„æ–¹å¼ï¼ˆæ¯”å¦‚TABç¼©è¿›ï¼Œæˆ–æ˜¯Typoraæä¾›çš„ <code>Ctrl + ]</code> å¢åŠ ç¼©è¿›ï¼ˆçº§åˆ«å‡å°ï¼ˆå­itemï¼‰ï¼‰ï¼Œ<code>Ctrl + [</code> å‡å°‘ç¼©è¿›ï¼ˆæˆ–è€…è¯´ï¼šçº§åˆ«å¢å¤§ï¼‰ï¼‰ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> Markdown is easy to use.</span><br><span class="line"><span class="bullet">	-</span> Gramma is easy to remember.</span><br><span class="line"><span class="bullet">		-</span> &quot;- + indent&quot; is unordered item.</span><br><span class="line"><span class="bullet">    -</span> Then What?</span><br></pre></td></tr></table></figure>
<p>â€‹ åœ¨Typoraé¡µé¢ä¸Šå®æ—¶æ˜¾ç¤ºçš„ç»“æœæ˜¯ï¼š</p>
<ul>
<li>Markdown is easy to use.
<ul>
<li>Gramma is easy to remember.
<ul>
<li>"- + indent" is unordered item.</li>
</ul></li>
<li>Then What?</li>
</ul></li>
</ul>
<h4 id="æœ‰åºitems">æœ‰åºitems</h4>
<p>â€‹ éœ€è¦æŒ‰ç…§ç¼–å·æ’åˆ—æ—¶ï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> Open the gate.</span><br><span class="line"><span class="bullet">2.</span> Let the army in.</span><br><span class="line"><span class="bullet">3.</span> Close the gate.</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™ä¸ªå…¶å®æœ‰ç‚¹é¸¡è‚‹äº†ï¼Œmarkdownä¼šè‡ªåŠ¨å¸®ä½ è°ƒæ•´ç¼–å·çš„ä½ç½®ã€‚Typoraåˆ™ä¼šå¸®ä½ è‡ªåŠ¨æ·»åŠ ç¼–å·ï¼Œä¹Ÿå³ï¼šè¾“å…¥ä¸€ä¸ª 1. å†æ¢è¡Œï¼Œä¼šè‡ªåŠ¨å‡ºç° 2. 3. ç­‰ç­‰ã€‚ä»¥ä¸Šçš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<ol type="1">
<li>Open the gate.</li>
<li>Let the army in.</li>
<li>Close the gate.</li>
</ol>
<p>â€‹ å½“ç„¶ï¼Œæœ‰åºitemsä¹Ÿæ˜¯å¯ä»¥åˆ†çº§çš„ã€‚åŒæ ·ä½¿ç”¨ç¼©è¿›çš„æ–¹æ³•å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p>
<h4 id="typora-itemsä½¿ç”¨çš„ä¸€ä¸ªå‘">Typora itemsä½¿ç”¨çš„ä¸€ä¸ªå‘</h4>
<ul>
<li><p>éšä¾¿å†™çš„ä¸€å¥è¯ã€‚</p>
<p>éšä¾¿å†™çš„ç¬¬äºŒå¥è¯ã€‚</p></li>
<li><p>éšä¾¿å†™çš„ä¸€å¥è¯</p></li>
</ul>
<p>â€‹ éšä¾¿å†™çš„ç¬¬äºŒå¥è¯ã€‚</p>
<p>â€‹ åœ¨å†™å®Œitemsåï¼Œä¸æƒ³è¦åˆ†ä¸‹ä¸€ä¸ªç‚¹äº†ï¼Œæƒ³è¦å¼€å§‹å¦ä¸€ç«¯æ­£æ–‡ï¼Œä½†æ˜¯æ— è®ºä½¿ç”¨ backspace åˆ é™¤ è¿˜æ˜¯ä½¿ç”¨ <code>Ctrl + [</code> åˆ å»è‡ªåŠ¨æ·»åŠ çš„åˆ†ç‚¹ï¼Œéƒ½ä¼šè®©ä¸‹ä¸€è¡Œçš„é¦–è¡Œç¼©è¿›å˜å¾—å¾ˆå¥‡æ€ªï¼Œä¸»è¦ä½“ç°åœ¨ï¼šæŒ‰ä¸‹TABä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹åªä¼šç¼©è¿›ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æ­¤æƒ…å†µä¸‹ï¼Œç¼©è¿›äº†ä¸æ­¢ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”å‡ºç°äº†é”™ä½çš„æƒ…å†µã€‚</p>
<table>
<thead>
<tr class="header">
<th><img src="/2021/02/09/Typora-Markdown-Intros/ind_1.JPG"></th>
<th>é”™è¯¯æƒ…å†µï¼Œæ­£æ–‡ä¸itemæ–‡å­—å¯¹é½äº†ã€‚å¹¶ä¸”ä¸€ä¸ªtabå°±èƒ½ç¼©è¿›åˆ°æ­¤æƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="/2021/02/09/Typora-Markdown-Intros/ind_2.JPG"></td>
<td>æ­£ç¡®æƒ…å†µï¼Œéœ€è¦ä¸¤ä¸ªtabæ‰èƒ½è¾¾åˆ°é¦–è¡Œç¼©è¿›ä¸¤ä¸ªå­—ç¬¦çš„æƒ…å†µ</td>
</tr>
</tbody>
</table>
<p>â€‹ å¯¹äºå¼ºè¿«ç—‡æ‚£è€…è€Œè¨€ï¼ˆå¦‚ä½œè€…ï¼‰ï¼Œè¿™æ˜¯ä¸èƒ½è¢«æ¥å—çš„ã€‚è§£å†³æ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>åœ¨é”™è¯¯æƒ…å†µçš„è¡Œé¦– ä¸¤æ¬¡tabé”®ï¼Œå…ˆè¿›è¡Œä¸€æ¬¡é¦–è¡Œä¸¤å­—ç¬¦ç¼©è¿›ã€‚</li>
<li>å†ä½¿ç”¨<code>Ctrl + [</code> å–æ¶ˆTyporaè‡ªåŠ¨è®¾ç½®çš„itemç¼©è¿›ï¼Œå³å¯ã€‚</li>
</ul>
<hr>
<h3 id="å­—ä½“å˜æ¢">å­—ä½“å˜æ¢</h3>
<p>â€‹ Markdown å¦‚ä½•æ‰“å‡ºï¼š<em>æ–œä½“ï¼ˆItalicï¼‰</em>ï¼Œ<strong>åŠ ç²—ï¼ˆBoldï¼‰</strong>ï¼Œ<strong><em>æ–œä½“åŠ ç²—ï¼ˆCombinedï¼‰</em></strong>ï¼Œ<u>ä¸‹åˆ’çº¿</u>ï¼Œ<del>åˆ é™¤çº¿</del>å‘¢ï¼Ÿ</p>
<ul>
<li><p>æ–œä½“ä½¿ç”¨ï¼š<code>*æ–œä½“*</code>ï¼Œè¾“å…¥ä¸¤ä¸ª<code>**</code> åœ¨<code>*</code>åŒ…æ‹¬çš„éƒ¨åˆ†å†…éƒ¨å†…è¾“å…¥éœ€è¦æ–œä½“çš„æ–‡å­—å³å¯ã€‚å½“ç„¶ï¼Œä¸ç®¡æ˜¯wordï¼ŒOneNoteè¿˜æ˜¯Typoraï¼Œå¿«æ·é”®éƒ½æ˜¯<code>Ctrl+I</code></p></li>
<li><p>åŠ ç²—ï¼š<code>**åŠ ç²—**</code>ï¼Œéœ€è¦åŠ ç²—çš„æ–‡å­—éœ€è¦å·¦å³å„ä¸¤ä¸ª<code>*</code>ã€‚ä¸ç®¡æ˜¯wordï¼ŒOneNoteè¿˜æ˜¯Typoraï¼Œå¿«æ·é”®éƒ½æ˜¯<code>Ctrl+B</code></p></li>
<li><p>æ–œä½“åŠ ç²—ï¼š<code>***æ–œä½“åŠ ç²—***</code>ï¼Œä¹Ÿå°±æ˜¯éœ€è¦åŠ ç²—çš„éƒ¨åˆ†å·¦å³å„3æ˜Ÿã€‚ä¸ç®¡æ˜¯wordï¼ŒOneNoteè¿˜æ˜¯Typoraï¼Œå¿«æ·é”®éƒ½æ˜¯<code>Ctrl+I+B</code></p></li>
<li><p>ä¸‹åˆ’çº¿ï¼š<font color="blue">è¿™æ˜¯ç¬¬ä¸€ä¸ªHTMLè¯­æ³•çš„å°æ —å­ï¼Œä¸è¿‡å¾ˆç®€å•</font>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;u&gt;éœ€è¦ä¸‹åˆ’çº¿çš„éƒ¨åˆ†&lt;/u&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;u&gt;</code>è¡¨ç¤ºèµ·å§‹ï¼ˆunderlineï¼‰ï¼Œ<code>&lt;/u&gt;</code>å‰çš„<code>/</code>è¡¨ç¤ºç»“æŸã€‚</li>
<li>ä¸ç®¡æ˜¯wordï¼ŒOneNoteè¿˜æ˜¯Typoraï¼Œå¿«æ·é”®éƒ½æ˜¯<code>Ctrl+U</code></li>
</ul></li>
<li><p>åˆ é™¤çº¿ï¼š<code>~~éœ€è¦åˆ é™¤çš„éƒ¨åˆ†~~</code>ï¼Œä¹Ÿå°±æ˜¯å·¦å³å„ä¸¤ä¸ª<code>~</code>ã€‚Typoraä¸­ï¼Œé»˜è®¤å¿«æ·é”®æ˜¯ï¼š<code>Alt+Shift+5</code>ã€‚</p></li>
</ul>
<p>â€‹ ç»™å‡ºä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼€å§‹ï¼š*è¿™æ˜¯æ–‡ä¸­éœ€è¦å€¾æ–œçš„éƒ¨åˆ†*ï¼Œè¿™æ˜¯æ­£å¸¸çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯**éœ€è¦åŠ ç²—çš„éƒ¨åˆ†**ï¼Œè€Œè¿™æ˜¯***ç»¼åˆéƒ¨åˆ†***ã€‚ä¸‹åˆ’çº¿å¯ä»¥&lt;u&gt;è¿™ä¹ˆåŠ &lt;/u&gt;ï¼Œè€Œä¸‹åˆ’çº¿+åŠ ç²—å¯ä»¥è¿™æ ·ï¼Œ&lt;u&gt;**è™½ç„¶Ctrl+B+Uå¿«æ·é”®å®Œå…¨å¯ä»¥è§£å†³**&lt;/u&gt;ã€‚åˆ é™¤çº¿åˆ™æ˜¯~~è¿™æ ·ä½¿ç”¨çš„~~ã€‚</span><br></pre></td></tr></table></figure>
<p>â€‹ å®é™…è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p>â€‹ å¼€å§‹ï¼š<em>è¿™æ˜¯æ–‡ä¸­éœ€è¦å€¾æ–œçš„éƒ¨åˆ†</em>ï¼Œè¿™æ˜¯æ­£å¸¸çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯<strong>éœ€è¦åŠ ç²—çš„éƒ¨åˆ†</strong>ï¼Œè€Œè¿™æ˜¯<strong><em>ç»¼åˆéƒ¨åˆ†</em></strong>ã€‚ä¸‹åˆ’çº¿å¯ä»¥<u>è¿™ä¹ˆåŠ </u>ï¼Œè€Œä¸‹åˆ’çº¿+åŠ ç²—å¯ä»¥è¿™æ ·ï¼Œ<u><strong>è™½ç„¶Ctrl+B+Uå¿«æ·é”®å®Œå…¨å¯ä»¥è§£å†³</strong></u>ã€‚åˆ é™¤çº¿åˆ™æ˜¯<del>è¿™æ ·ä½¿ç”¨çš„</del>ã€‚</p>
<hr>
<h3 id="æ ‡é¢˜ä¸åˆ†å‰²çº¿">æ ‡é¢˜ä¸åˆ†å‰²çº¿</h3>
<p><span id="caption"></span></p>
<p>â€‹ Markdownä¸­çš„æ ‡é¢˜æ˜¯æ ¼å¼åŒ–çš„ã€‚ä¸éœ€è¦è®¾ç½®å¤§å°ä¸æ ¼å¼ï¼ˆä¸è¿‡æ­£å¸¸æƒ…å†µä¸‹æ ‡é¢˜æ˜¯å·¦å¯¹é½çš„ï¼‰ã€‚æ ‡é¢˜ä½¿ç”¨ <code>#</code> + ç©ºæ ¼æ¥è¡¨ç¤ºã€‚</p>
<p></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># ä¸€çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">## äºŒçº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">### ä¸‰çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">#### å››çº§æ ‡é¢˜</span></span><br><span class="line"><span class="section">##### äº”çº§æ ‡é¢˜</span></span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºç»“æœæ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/caption.png"></p>
<center>
Figure 2. æ ‡é¢˜æ ·å¼
</center>
<p>â€‹ æ³¨æ„ï¼Œ<code>#</code>ä¹‹åä¸€å®šè¦è·Ÿä¸Šç©ºæ ¼ï¼Œå†è¾“å…¥æ ‡é¢˜å†…å®¹ã€‚</p>
<p>â€‹ åˆ†å‰²çº¿ï¼šåªéœ€è¦åœ¨éœ€è¦åˆ†å‰²çš„ä½ç½®ï¼ŒåŠ å…¥<code>---</code>å³å¯è¿›è¡Œåˆ†å‰²ï¼ˆæ³¨æ„<code>---</code>ä¸€å®šè¦å¦èµ·ä¸€è¡Œï¼Œåˆ†å‰²çº¿è¡Œä¸­åªèƒ½å†™è¿™ä¸€ä¸ªå†…å®¹ï¼‰ã€‚æ¯”å¦‚æ–‡ä¸­çš„åˆ†å‰²çº¿ï¼Œéƒ½æ˜¯<code>---</code>çš„æ¸²æŸ“ç»“æœï¼Œä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Contents I</span><br><span class="line">---</span><br><span class="line">Contents II</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è¶…é“¾æ¥çš„ä¸¤ç§å¸¸è§æ–¹å¼">è¶…é“¾æ¥çš„ä¸¤ç§å¸¸è§æ–¹å¼</h3>
<p>â€‹ HyperLink ï¼ˆè¶…é“¾æ¥ï¼‰æœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯ <strong><u>ç½‘é¡µè·³è½¬</u></strong>ã€‚å½“ç„¶ï¼Œmarkdownä¸­å­˜åœ¨å¦ä¸€ç§é¡µå†…è·³è½¬çš„æ–¹å¼ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›è¯»è€…åœ¨è¯»åˆ°è¿™æ®µæ–‡å­—çš„æ—¶å€™ï¼Œå»æŸ¥çœ‹æœ¬æ–‡å…¶ä»–ä½ç½®çš„å†…å®¹ï¼Œæ¯”å¦‚ <a href="#start">ã€ç‚¹æˆ‘æŸ¥çœ‹æ–‡ç« å¼€å¤´ã€‘</a>ï¼Œç¡®å®ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ã€‚</p>
<h4 id="ç½‘é¡µè·³è½¬">ç½‘é¡µè·³è½¬</h4>
<p>â€‹ referenceç¼–å†™æ—¶ï¼Œå¯èƒ½æˆ‘ä»¬å¸Œæœ›è¯»è€…å¯ä»¥é€šè¿‡ç‚¹å‡»ç›´æ¥è·³è½¬åˆ°æŸä¸ªä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œç¼–å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[è·³è½¬é“¾æ¥](https://www.baidu.com/)</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>[]</code>å†…éƒ¨æŒ‡å®šï¼šè¶…é“¾æ¥åµŒå…¥åœ¨<code>[]</code>åŒ…æ‹¬çš„æ–‡å­—å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç‚¹å‡»æ­¤æ®µè¢«åŒ…æ‹¬çš„éƒ¨åˆ†ï¼Œå¯ä»¥è¿›è¡Œè·³è½¬ã€‚<code>()</code>å†…éƒ¨åˆ™æ˜¯ç½‘å€äº†ï¼Œç½‘å€åªéœ€è¦åœ¨æµè§ˆå™¨ä¸Šå¤åˆ¶åç²˜è´´äºæ­¤å¤„å³å¯ã€‚ä¸Šè¿°æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</p>
<p>â€‹ <a href="https://www.baidu.com/">è·³è½¬é“¾æ¥</a></p>
<h4 id="é¡µå†…è·³è½¬">é¡µå†…è·³è½¬</h4>
<p>â€‹ å¦‚æœæ˜¯PDFæ–‡ä»¶ï¼Œéœ€è¦è¯»è€…å¯ä»¥æ–¹ä¾¿åœ°éšç€ä½œè€…çš„æ€è·¯èµ°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ã€‚</p>
<ol type="1">
<li><p>åœ¨éœ€è¦è·³è½¬åˆ°çš„ä½ç½®æ’å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;span id=&#x27;name&#x27;&gt;</span><br><span class="line">éœ€è¦è·³è½¬çš„ä½ç½®ï¼Œæ¯”å¦‚ä¸Šä¸ª&quot;è¶…é“¾æ¥çš„ä¸¤ç§å¸¸è§æ–¹å¼&quot;å¼€å¤´éƒ¨åˆ†è·³è½¬åˆ°æ–‡ç« å¼€å¤´ï¼Œåˆ™å°†æ­¤å—æ’å…¥åˆ°æ–‡ç« å¼€å¤´</span><br><span class="line">&lt;/span&gt;</span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">&lt;span id=&#x27;start&#x27;&gt;</span><br><span class="line">	æ­¤æ–‡æ’°å†™çš„ç›®çš„æ˜¯ï¼š</span><br><span class="line">- å½’çº³Typoraï¼ˆMarkdownç¼–è¾‘å™¨ï¼‰ çš„åŸºæœ¬ä½¿ç”¨ï¼ˆå¸¸ç”¨çš„éƒ½èƒ½æ‰¾åˆ°ï¼‰</span><br><span class="line">- ç»™æˆ‘Ravençš„å®‰åˆ©ã€‚</span><br><span class="line">&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œid='name' åœ¨è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œnameæ˜¯æ ‡ç­¾çš„åå­—ã€‚æ¯”å¦‚ä¸€ç¯‡æ–‡ç« å†…éƒ¨å¯èƒ½æœ‰å¾ˆå¤šè·³è½¬ï¼Œä¸ºäº†ä¸æ··æ·†ç›®çš„åœ°ï¼Œéœ€è¦æ ‡è®°ä¸åŒçš„ç›®çš„åœ°çš„åç§°ã€‚æ¯”å¦‚å¼€å¤´æ ‡è®°ä¸º<code>span id='start'</code>ï¼Œè€Œç»“å°¾æ ‡è®°ä¸º<code>span id='ending'</code>ã€‚æ­¤åå°±æ ¹æ®æ ‡è®°è·³è½¬åˆ°éœ€è¦çš„åœ°æ–¹ã€‚</p></li>
<li><p>åœ¨å¼€å§‹è·³è½¬ä½ç½®å¤„å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[ç‚¹æˆ‘è·³è½¬](#name)</span><br></pre></td></tr></table></figure>
<p>â€‹ ç”±äºä½œè€…åœ¨æ–‡ç« å¼€å¤´å¤„è®¾ç½®äº†ä¸€ä¸ªè·³è½¬ç›®çš„åœ°ï¼Œå†™çš„æ˜¯<code>&lt;span id='start'&gt;</code>ï¼Œä¹Ÿå°±æ˜¯ç›®çš„åœ°è¢«ç§°ä¸ºäº†<code>start</code>ï¼Œä¸Šé¢è¿™ä¸ªä¾‹å­çš„name å¦‚æœè®¾ç½®æˆstartï¼Œåˆ™ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<p>â€‹ <a href="#start">ç‚¹æˆ‘è·³è½¬</a>ã€‚å½“ç„¶ä¸€èˆ¬ä¸ºäº†ç¾è§‚ï¼Œå¯ä»¥åœ¨<code>[]</code>å†…å†åŠ ä¸Šä¸€ä¸ª<code>[]</code>ï¼Œå°±ä¼šå˜æˆ<a href="#name">[ç‚¹æˆ‘è·³è½¬]</a>ã€‚æ³¨æ„åœ¨<code>()</code>å†…ï¼Œéœ€è¦ä¸€ä¸ª<code>#</code>ï¼Œæ­¤å¤„ä¸è¡¨ç¤ºä¸€çº§æ ‡é¢˜ã€‚</p></li>
<li><p>æŸ¥çœ‹ç»“æœã€‚</p></li>
</ol>
<hr>
<h3 id="å›¾ç‰‡ä¸è¡¨æ ¼æ’å…¥">å›¾ç‰‡ä¸è¡¨æ ¼æ’å…¥</h3>
<h4 id="å›¾ç‰‡æ’å…¥">å›¾ç‰‡æ’å…¥</h4>
<p>â€‹ Markdownçš„å›¾ç‰‡æ’å…¥è¯­æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">æ–‡ç« ä¸­ç»™å›¾ç‰‡èµ·çš„åˆ«å</span>](<span class="link">å›¾ç‰‡æ‰€åœ¨ä½ç½®</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>[]</code>ä¸­çš„å†…å®¹å¯ä»¥ä¸å¡«å†™ï¼Œä½†æ˜¯å›¾ç‰‡ä½ç½®å¿…é¡»è¦æŒ‡å®šã€‚åœ¨Typoraä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å¿«é€Ÿæ’å…¥å›¾ç‰‡ï¼š(1) å³é”®-&gt;æ’å…¥-&gt;å›¾ç‰‡ã€‚(2) å¿«æ·é”®<code>Ctrl+Shift+I</code>ã€‚</p>
<table>
<thead>
<tr class="header">
<th><img src="/2021/02/09/Typora-Markdown-Intros/insert1.JPG"></th>
<th>å¯ä»¥ç‚¹å‡»æ–‡ä»¶å¤¹å›¾æ ‡è¿›è¡Œå›¾ç‰‡æ’å…¥</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="/2021/02/09/Typora-Markdown-Intros/insert2.JPG"></td>
<td>ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¾“å…¥ï¼Œé»˜è®¤æ˜¯ç»å¯¹è·¯å¾„ï¼ˆå°±æ˜¯è¦è¾“å…¥ä»ç›˜ä½ç½®å¼€å§‹çš„è·¯å¾„ï¼‰</td>
</tr>
</tbody>
</table>
<p>â€‹ æ³¨æ„ï¼Œä¸wordä¸åŒï¼šwordæ’å…¥å›¾ç‰‡åï¼Œä¿®æ”¹æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡ï¼Œä¸ä¼šå¯¹å·²ç»åœ¨æ–‡ç« é‡Œçš„å†…å®¹äº§ç”Ÿå½±å“ï¼ˆæ¯”å¦‚æ›´æ”¹å¤§å° / åˆ é™¤ç­‰ç­‰ï¼Œæ–‡ä¸­çš„å›¾ç‰‡ä¿æŒä¸å˜ï¼‰ï¼Œå› ä¸ºwordä¸­çš„å›¾ç‰‡æ˜¯ä¸€ä»½copyã€‚è€ŒMarkdownä¸­çš„å›¾ç‰‡ï¼Œåªæ˜¯åŸå›¾ç‰‡çš„<strong><u>é“¾æ¥</u></strong>ï¼Œä»»ä½•å¯¹æºæ–‡ä»¶çš„ä¿®æ”¹éƒ½å°†å½±å“æ–‡ä¸­çš„å›¾ç‰‡ã€‚å…¶å¥½å¤„æ˜¯ï¼šæ›´æ”¹å›¾ç‰‡çš„ç»†èŠ‚å¾ˆå®¹æ˜“ï¼Œæ— éœ€é‡æ–°æ’å…¥ã€‚ä½†æ˜¯ï¼Œåœ¨å®Œæˆæ–‡ç« ï¼Œè¾“å‡ºæˆpdfå‰ä¸€å®šè¦ç¡®ä¿å¯¹åº”åå­—çš„å›¾ç‰‡èƒ½å¤Ÿè¢«æ‰¾åˆ°ã€‚</p>
<p>â€‹ <code>()</code>ä¸­ï¼Œé™¤äº†å¯ä»¥å¡«å†™æœ¬åœ°å›¾ç‰‡ï¼ˆæ’å…¥æœ¬åœ°å›¾ç‰‡ï¼‰ï¼Œä¹Ÿå¯ä»¥æ’å…¥ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚æµè§ˆå™¨ä¸€èˆ¬ä¼šæä¾›<strong>å¤åˆ¶å›¾ç‰‡é“¾æ¥</strong>é€‰é¡¹ï¼Œåªéœ€è¦å°†é“¾æ¥å¡«å†™åœ¨<code>()ä¸­å³å¯</code>ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">![èµ·å­](https://bkimg.cdn.bcebos.com/pic/bba1cd11728b4710dac3926bc9cec3fdfd0323ac?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5/format,f_auto)</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://bkimg.cdn.bcebos.com/pic/bba1cd11728b4710dac3926bc9cec3fdfd0323ac?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5/format,f_auto" alt="èµ·å­" style="zoom:50%;"></p>
<center>
Figure 3. èµ·å­çš„ç™¾åº¦ç™¾ç§‘ä¸Šå¤åˆ¶çš„å›¾ç‰‡
</center>
<p>â€‹ Typoraæä¾›äº†å›¾ç‰‡å¤§å°ç¼©æ”¾çš„å¿«æ·é€‰é¡¹ï¼Œåªéœ€è¦å¯¹æ’å…¥çš„å›¾ç‰‡æŒ‰å³é”®ï¼Œæ‰¾åˆ°<code>ã€ç¼©æ”¾å›¾ç‰‡åˆ°ã€‘</code>å³å¯ã€‚ç¼©æ”¾åï¼Œå›¾ç‰‡çš„æºç æ  <strong><u>ä¸å†æ˜¯markdownè¯­æ³•</u></strong>ï¼Œè€Œå˜æˆäº† <strong><u>HTMLè¯­æ³•</u></strong>ï¼Œå› ä¸ºåŸç”Ÿmarkdownä¸æ”¯æŒç¼©æ”¾ï¼Œä½†æ˜¯ä¸ä½¿ç”¨è€…æ— å…³ï¼Œå…¶æ’å…¥è·¯å¾„è¿˜æ˜¯å¯ä»¥éšæ„æ›´æ”¹ï¼Œè¿™ä¸ªç‰¹æ€§å¯¹æœ¬åœ°å›¾ç‰‡ä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=&quot;https://bkimg.cdn.bcebos.com/pic/bba1cd11728b4710dac3926bc9cec3fdfd0323ac?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5/format,f_auto&quot; alt=&quot;èµ·å­&quot; style=&quot;zoom:50%;&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„åˆ°ä¸Šè¿°ä»£ç ä¸­æœ‰ä¸€é¡¹ï¼š<code>style="zoom:50%;"</code>ï¼Œè¡¨æ˜ç¼©æ”¾çš„å¤§å°ã€‚Typoraåªæä¾›äº†é»˜è®¤çš„å‡ ä¸ªç¼©æ”¾ç­‰çº§ï¼Œå¦‚æœè¦æ›´çµæ´»çš„ç¼©æ”¾å¯ä»¥ç›´æ¥æ›´æ”¹<code>50%</code>ä¸ºå…¶ä»–æ•°å€¼ã€‚</p>
<h4 id="è¡¨æ ¼æ’å…¥">è¡¨æ ¼æ’å…¥</h4>
<p>â€‹ åŸç”ŸMarkdownæ”¯æŒè¡¨æ ¼ï¼Œä½†æ˜¯è¡¨æ ¼çš„è¾“å…¥æœ‰ç‚¹éº»çƒ¦ï¼ˆTyporaæä¾›äº†æ›´å¿«æ·çš„æ’å…¥æ–¹å¼ï¼‰ï¼Œå¯ä»¥å…ˆçœ‹åŸç”Ÿè¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|å§“å|ç­çº§|å­¦å·|æˆç»©|</span><br><span class="line">|:-|:-:|-:|:-:|</span><br><span class="line">|A|1|001|59|</span><br><span class="line">|B|1|002|58|</span><br><span class="line">|C|1|003|57|</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºçš„ç»“æœå¦‚å›¾ï¼ˆPixyllä¸»é¢˜ä¸‹çš„å›¾è¡¨ï¼Œæœ€ç¾è§‚çš„é‚£ç§ï¼‰ï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/table.png"></p>
<center>
Figure 4. Typora Pixyllä¸»é¢˜è¡¨æ ¼
</center>
<p>â€‹ æ³¨æ„åˆ°å…¶ä¸­æœ‰äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|:-|:-:|-:|:-:|</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿™æ˜¯ä»€ä¹ˆï¼Ÿæ­¤å¤„è¡¨ç¤ºå›¾è¡¨çš„å¯¹é½æ–¹å¼ï¼š<code>:-</code>å†’å·åœ¨å·¦è¾¹è¡¨ç¤ºå·¦å¯¹é½ã€‚<code>:-:</code>ä¸¤è¾¹æœ‰å†’å·è¡¨ç¤ºå±…ä¸­ï¼Œ<code>-:</code>å³è¾¹å†’å·è¡¨ç¤ºå³å¯¹é½ã€‚åŸç”Ÿè¯­æ³•ä¸‹ï¼Œä¸å†™å¯¹é½æ–¹å¼æ˜¯ä¸ä¼šæ¸²æŸ“è¡¨æ ¼çš„ï¼Œå‡ºæ¥çš„å°±æ˜¯è¿™ä¸€å †ç¥ç§˜ä»£ç ã€‚</p>
<p>â€‹ Typoraå³é”®å¯ä»¥æ’å…¥è¡¨æ ¼ï¼Œåœ¨æ’å…¥çš„è¡¨æ ¼å·¦ä¸Šæ–¹å¯ä»¥é€‰æ‹©å¯¹é½æ–¹å¼ / è¡¨æ ¼sizeï¼ˆåˆ— * è¡Œï¼‰ã€‚ä½†æ˜¯è¡¨æ ¼çš„å¤§å°ï¼ˆæ¯ä¸ªcellçš„é•¿å®½ï¼‰æ ¹æ®æ‰€åœ¨åˆ—å’Œè¡Œçš„å†…å®¹è‡ªåŠ¨è°ƒæ•´ã€‚æ³¨æ„ï¼Œè¡¨æ ¼å†…ä¹Ÿå¯ä»¥ä½¿ç”¨markdown / HTML / LaTexè¯­æ³•ã€‚</p>
<hr>
<h3 id="todosä¸å¼•ç”¨">TODOsä¸å¼•ç”¨</h3>
<p>â€‹ ä»£åŠé¡¹ / å¼•ç”¨ æ˜¯markdownæä¾›çš„å¦å¤–ä¸¤ç§è¾“å‡ºæ ·å¼ï¼šå¦‚å›¾æ‰€ç¤º</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/todos.png"></p>
<center>
Figure 5. å¼•ç”¨ä¸å¾…åŠé¡¹è¾“å‡ºç¤ºä¾‹
</center>
<h4 id="å¼•ç”¨">å¼•ç”¨</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ä¸€çº§å¼•ç”¨</span><br><span class="line">&gt;&gt; äºŒçº§å¼•ç”¨</span><br><span class="line">&gt;&gt;&gt; ä¸‰çº§å¼•ç”¨</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„&gt;å·åé¢è¦åŠ ç©ºæ ¼ã€‚å¼•ç”¨å¯ä»¥ä¸€ç›´å¥—å¨ƒä¸‹å»ã€‚</p>
<p>â€‹ æœ‰çš„æ—¶å€™å¯èƒ½å¡åœ¨å¼•ç”¨è¯­æ³•é‡Œå‡ºä¸æ¥ï¼ˆè¾“å…¥ä¸äº†æ­£å¸¸çš„æ–‡å­—ï¼Œæ¢è¡Œä¹‹åä»ç„¶æ˜¯å¼•ç”¨åŒºå†…ï¼‰ï¼Œåªéœ€è¦ä½¿ç”¨<code>Ctrl+[</code>å‡å°‘ç¼©è¿›å³å¯é€€å‡ºå¼•ç”¨ã€‚</p>
<h4 id="todos">TODOs</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- [x] 14:00-16:00</span><br><span class="line">- [ ] 16:00-18:00</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼šé¦–å…ˆæ˜¯<code>-</code>å·ï¼Œ<strong>ç©ºæ ¼</strong>åï¼Œå†è¾“å…¥<code>[ ]</code>ï¼ˆä¸­æœ‰ç©ºæ ¼ï¼‰ï¼Œå†ç©ºæ ¼è¾“å…¥æ–‡å­—ã€‚å…¶ä¸­è¾“å…¥æœ‰xçš„è¡¨æ˜å·²ç»å®Œæˆçš„ï¼ŒåŸç”Ÿmarkdownä¸­éœ€è¦è¾“å…¥xï¼Œä½†Typoraä¸­å¯ä»¥ç›´æ¥ç‚¹å‡»ï¼Œè‡ªåŠ¨è¾“å…¥xã€‚</p>
<hr>
<h3 id="ä»£ç ç‰‡æ®µä¸ä»£ç å—">ä»£ç ç‰‡æ®µä¸ä»£ç å—</h3>
<p>â€‹ ä¸€èˆ¬ä¼šç»™ç¨‹åºå‘˜ä½¿ç”¨ï¼Œæ¯”å¦‚è¦å¼ºè°ƒä¸€å—ä»£ç çš„æ—¶å€™ã€‚Markdownæ˜¯å¯ä»¥æ ¹æ®é€‰æ‹©çš„è¯­è¨€è¿›è¡Œè¯­æ³•é«˜äº®(Syntax Highlights) ä»¥åŠè‡ªåŠ¨æ ‡æ³¨è¡Œå·çš„ï¼Œä»¥ä¸‹æ˜¯C++ä»£ç çš„ä¸€ä¸ªå®ä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;Hello Markdown!\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ å®é™…ä¸Šï¼Œæ‰€æœ‰éœ€è¦å¼ºè°ƒçš„éæ–‡ç« å†…å®¹éƒ½å¯ä»¥æ”¾åœ¨ä»£ç å—ä¸­ã€‚åŸç”Ÿmarkdownè¯­æ³•æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">...</span><br><span class="line">â€‹```</span><br></pre></td></tr></table></figure>
<p>â€‹ éœ€è¦æŒ‡å®šè¯­è¨€æ—¶ï¼ŒTyporaåœ¨ä»£ç å—å³ä¸‹è§’å¯ä»¥è¾“å…¥è¯­è¨€ï¼ˆç‚¹å‡»ä»£ç å—åå³ä¸‹è§’ä¼šå‡ºç°ï¼‰ï¼ŒåŸç”Ÿè¯­æ³•æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">```è¯­è¨€åç§°</span><br><span class="line"></span><br><span class="line">â€‹```</span><br><span class="line">ä¾‹å¦‚</span><br><span class="line">â€‹```python</span><br><span class="line">print(&quot;Hello markdown.&quot;)</span><br><span class="line">â€‹```</span><br></pre></td></tr></table></figure>
<p>â€‹ å¦‚æœä¸éœ€è¦æ•´æ®µçš„ä»£ç ï¼Œè€Œæ˜¯éœ€è¦å¼ºè°ƒæŸäº›å°éƒ¨åˆ†çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨â€œ`â€ç¬¦å·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ’å…¥å›¾ç‰‡çš„å¿«æ·é”®æ˜¯`Ctrl+Shift+I`</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="emoji">Emoji</h3>
<p>â€‹ è¿™ä¸ªå¥½åƒæ˜¯Typoraæä¾›çš„ï¼ˆåŸç”Ÿmarkdownå¥½åƒä¹Ÿæœ‰ï¼Œä½†æ˜¯emojiçš„åç§°è¦å»è®°ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼‰ã€‚æ¯”å¦‚æˆ‘è¦è¾“å…¥ä¸€ä¸ªå¾®ç¬‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:smile:</span><br></pre></td></tr></table></figure>
<p>â€‹ å¾®ç¬‘å°†ä¼šæŒ‰ç…§ä¸Šé¢çš„è¯­æ³•æ˜¾ç¤ºå‡ºæ¥ï¼š:smile:ã€‚å¯¹Typoraè€Œè¨€ï¼Œè¾“å…¥è‹±æ–‡å†’å·åï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªå­—æ¯éƒ½å¯èƒ½æœ‰å¯¹åº”çš„emojiï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/emoji.png"></p>
<center>
Figure 6. Markdownè‡ªå¸¦çš„emoji
</center>
<hr>
<h3 id="typoraçš„ä¸€äº›è®¾ç½®ä¸åŠŸèƒ½">Typoraçš„ä¸€äº›è®¾ç½®ä¸åŠŸèƒ½</h3>
<p><span id="setting"></span></p>
<p>â€‹ Typoraä¸ªæ€§åŒ–è®¾ç½®å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ä½¿ç”¨å…¶æºå¸¦çš„ä¸€äº›åŠŸèƒ½ï¼šå³ä¸Šè§’<code>[æ–‡ä»¶]</code>-&gt;<code>[åå¥½è®¾ç½®]</code>-&gt;<code>[Markdown]</code>ä¸­ï¼ˆmarkdownè®¾ç½®æ›´ä¸ºå¸¸ç”¨ï¼‰ï¼š</p>
<p></p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/setting1.png"></p>
<center>
Figure 7. å¸¸ç”¨è®¾ç½®1
</center>
<p><img src="/2021/02/09/Typora-Markdown-Intros/setting2.png"></p>
<center>
Figure 8. å¸¸ç”¨è®¾ç½®2
</center>
<p>â€‹ åœ¨Typoraä¸­è¿˜æœ‰ä¸¤ç§æ¨¡å¼å¯ä»¥è®¾ç½®ï¼š</p>
<ul>
<li>æ‰“å­—æœºæ¨¡å¼ï¼ˆé¡µé¢è‡ªåŠ¨å®šä½åˆ°å½“å‰è¡Œæ‰€åœ¨ä½ç½®ï¼Œæ— éœ€æ»šè½®æ»šåŠ¨ï¼‰ï¼ˆå¯ä»¥è‡ªå·±è¯•è¯•çœ‹ï¼šå¿«æ·é”®<code>F8</code>ï¼‰</li>
<li>ä¸“æ³¨æ¨¡å¼ï¼ˆå…¶ä»–å†…å®¹çš„å¯è§æ€§ä¼šå˜ä½ï¼ˆåŠ é›¾ï¼‰ï¼Œå½“å‰ä¹¦å†™å†…å®¹æ­£å¸¸æ˜¾ç¤ºï¼‰ï¼ˆå¯ä»¥è‡ªå·±è¯•è¯•çœ‹ï¼šå¿«æ·é”®<code>F9</code>ï¼‰
<ul>
<li>å·¦ä¸Šè§’ï¼šè§†å›¾ä¸­å¯ä»¥è¿›è¡Œè®¾ç½®</li>
</ul></li>
</ul>
<h4 id="ç›®å½•ç»„ç»‡">ç›®å½•ç»„ç»‡</h4>
<p>â€‹ å¦‚æœéœ€è¦å¿«é€Ÿå»ºç«‹ç›®å½•ï¼Œå¯ä»¥ç›´æ¥åœ¨æ–‡ç« å¼€å¤´è¾“å…¥:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[toc]</span><br></pre></td></tr></table></figure>
<p>â€‹ è¡¨ç¤ºï¼ˆtable of contentsï¼‰ï¼Œè¿™ä¸ªç›®å½•çš„å»ºç«‹æ˜¯æ ¹æ®<a href="#caption">ã€æ ‡é¢˜ä¸åˆ†å‰²çº¿ã€‘</a>ä¸­çš„æ ‡é¢˜çº§æ•°æ¥ç»„ç»‡çš„ã€‚ç›®å½•å¯ä»¥ç”¨åœ¨ï¼š</p>
<ul>
<li>å®éªŒæŠ¥å‘Š / é•¿æ–‡ ä¸­</li>
<li>å¹¶ä¸”ï¼Œç”Ÿæˆpdfæ—¶ï¼Œä¼šè‡ªåŠ¨æ’å…¥ä¹¦ç­¾ï¼ˆæ¯ä¸ªæ ‡é¢˜éƒ½ä¼šæœ‰ä¹¦ç­¾ï¼Œä¹¦ç­¾ä¸‹æ ¹æ®æ ‡é¢˜çº§æ•°è¿˜ä¼šæœ‰å­ä¹¦ç­¾ï¼‰</li>
</ul>
<hr>
<h2 id="level-2-skills">Level 2 Skills</h2>
<p>â€‹ æ­¤éƒ¨åˆ†å†…å®¹è¾ƒä¸ºè¿›é˜¶ï¼Œä½†æ˜¯å¦‚1 / 3èŠ‚è€Œè¨€ï¼Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´éƒ½å¾ˆå®ç”¨ï¼ˆç¬¬ä¸‰èŠ‚éš¾è®°ï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å®ç”¨çš„HTMLå‘½ä»¤ï¼ˆç®€å•å¯å¤åˆ¶ï¼‰</li>
<li>LaTexæ•°å­¦å…¬å¼è¾“å…¥</li>
<li>mermaidï¼ˆå—çŠ¶æµç¨‹å›¾ï¼‰ / flowï¼ˆæ ‡å‡†æµç¨‹å›¾ï¼‰ / ganttï¼ˆç”˜ç‰¹å›¾ï¼‰ç»˜åˆ¶</li>
</ul>
<hr>
<h3 id="å®ç”¨htmlå‘½ä»¤">å®ç”¨HTMLå‘½ä»¤</h3>
<blockquote>
<p><em>HTML</em>ç§°ä¸ºè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œæ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ã€‚å®ƒåŒ…æ‹¬ä¸€ç³»åˆ—æ ‡ç­¾ï¼é€šè¿‡è¿™äº›æ ‡ç­¾å¯ä»¥å°†ç½‘ç»œä¸Šçš„æ–‡æ¡£æ ¼å¼ç»Ÿä¸€ï¼Œä½¿åˆ†æ•£çš„Internetèµ„æºè¿æ¥ä¸ºä¸€ä¸ªé€»è¾‘æ•´ä½“ã€‚<a href="https://baike.baidu.com/item/HTML/97049?fr=aladdin">HTML ç™¾åº¦ç™¾ç§‘</a></p>
</blockquote>
<p>â€‹ æœ¬æ–‡ä¸æ•™HTMLæ€ä¹ˆå†™ï¼ˆä¸æ˜¯æœ¬æ–‡çš„ç›®çš„ï¼‰ï¼Œå¹¶ä¸”HTMLä¹Ÿä¸åƒåŸç”Ÿmarkdowné‚£ä¹ˆç®€æ´ï¼Œä½†æ˜¯æœ‰äº›éå¸¸å®ç”¨çš„ç¼–è¾‘å‘½ä»¤ä¸å¾—ä¸æã€‚</p>
<h4 id="æ–‡å­—çš„å±…ä¸­ä¸ä¿®æ”¹">æ–‡å­—çš„å±…ä¸­ä¸ä¿®æ”¹</h4>
<p>â€‹ åŸç”Ÿmarkdownè²Œä¼¼ä¸æ”¯æŒç›´æ¥å±…ä¸­ï¼Œä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä¹Ÿä¸å¯èƒ½ç›´æ¥å°±ç”¨ç©ºæ ¼æ‰‹åŠ¨å±…ä¸­äº†ã€‚å±…ä¸­ / å­—ä½“è°ƒæ•´ç­‰æ–¹é¢ç›¸å¯¹éº»çƒ¦ï¼ˆè™½ç„¶æ— éœ€é¼ æ ‡ç‚¹å‡»ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;center&gt;éœ€è¦å±…ä¸­çš„éƒ¨åˆ†&lt;/center&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ˜¾ç¤ºçš„ç»“æœæ˜¯ï¼š</p>
<center>
éœ€è¦å±…ä¸­çš„éƒ¨åˆ†
</center>
<p>â€‹ è€Œå­—ä½“å¤§å° / é¢œè‰² / å­—å‹è°ƒæ•´ï¼Œéœ€è¦åº”ç”¨<code>&lt;font&gt;</code>è¯­æ³•ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">3</span> <span class="attr">color</span>=<span class="string">&#x27;blue&#x27;</span> <span class="attr">face</span>=<span class="string">&#x27;é»‘ä½“&#x27;</span>&gt;</span>é»‘ä½“ï¼Œsize=3çš„è“è‰²å­—<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">4</span> <span class="attr">color</span>=<span class="string">&#x27;red&#x27;</span> <span class="attr">face</span>=<span class="string">&#x27;å¾®è½¯é›…é»‘&#x27;</span>&gt;</span>å¾®é»‘ï¼Œsize=4çš„çº¢è‰²å­—<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">5</span> <span class="attr">color</span>=<span class="string">&#x27;green&#x27;</span> <span class="attr">face</span>=<span class="string">&#x27;Arial&#x27;</span>&gt;</span> Arialå­—ä½“ï¼Œsize=5çš„ç»¿è‰²å­—<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><font size="3" color="blue" face="é»‘ä½“">é»‘ä½“ï¼Œsize=3çš„è“è‰²å­—</font> <font size="4" color="red" face="å¾®è½¯é›…é»‘">å¾®é»‘ï¼Œsize=4çš„çº¢è‰²å­—</font> <font size="5" color="green" face="Arial"> Arialå­—ä½“ï¼Œsize=5çš„ç»¿è‰²å­—</font></p>
<p>â€‹ å¤šé‡ç‰¹æ€§å åŠ ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;center&gt;&lt;font size=3 color=&#x27;blue&#x27; face=&#x27;é»‘ä½“&#x27;&gt;å±…ä¸­é»‘ä½“size3è“è‰²å­—/font&gt;&lt;/center&gt;</span><br></pre></td></tr></table></figure>
<center>
<font size="3" color="blue" face="é»‘ä½“">å±…ä¸­é»‘ä½“size3è“è‰²å­—/font&gt;
</font></center>
<hr>
<h4 id="åˆ†é¡µ-é«˜çº§è¡¨æ ¼">åˆ†é¡µ / é«˜çº§è¡¨æ ¼</h4>
<p>â€‹ å‡å¦‚æˆ‘ä»¬å¸Œæœ›æŸå¤„æ–‡å­—åï¼Œå¦èµ·ä¸€é¡µï¼Œç›´æ¥æ‰“æ¢è¡Œå¤ªä¸æ–¹ä¾¿äº†ï¼ˆå¹¶ä¸”markdownä¸­æ²¡æœ‰é¡µæ•°è¿™ä¸ªæ¦‚å¿µï¼Œè½¬ä¸ºpdfåæ‰èƒ½çœ‹åˆ°åˆ†é¡µæ•ˆæœï¼‰ã€‚å¯ä»¥å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div style=&quot;page-break-after: always;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>â€‹ è¡¨ç¤ºæ­¤å¤„ä¹‹åï¼Œè¿›è¡Œæ–°åŠ ä¸€é¡µçš„æ“ä½œã€‚é€šå¸¸ç”¨äºï¼šabstractä¸ä¸‹æ–‡çš„åˆ†å‰² / ç›®å½•ä¸ä¸‹æ–‡çš„åˆ†å‰² / æ­£æ–‡ä¸referenceçš„åˆ†å‰²ã€‚</p>
<p>â€‹ <strong><u>é«˜çº§è¡¨æ ¼</u></strong>ï¼šåŸç”Ÿmarkdownä¸æ”¯æŒå•å…ƒæ ¼åˆå¹¶ï¼Œéœ€è¦ä½¿ç”¨HTMLçš„<code>&lt;table&gt;</code>æ ‡ç­¾æ‰èƒ½å¾—åˆ°æ‰©å±•ã€‚å…·ä½“æ–¹æ³•ååˆ†å¤æ‚ï¼Œä¸ä½œä¸ºé‡ç‚¹ï¼Œåªæ˜¯æä¸€ä¸‹ï¼Œæœ‰å…´è¶£è€…å‚çœ‹ï¼š</p>
<ul>
<li><a href="https://www.runoob.com/html/html-tables.html">ã€HTML è¡¨æ ¼ | èœé¸Ÿæ•™ç¨‹ğŸ”—ã€‘</a></li>
<li><a href="https://blog.csdn.net/lhrdlp/article/details/100861546">ã€CSDN HTMLè¡¨æ ¼ å•å…ƒæ ¼åˆå¹¶ğŸ”—ã€‘</a></li>
</ul>
<hr>
<h4 id="ä¹‹å‰è®²è¿‡çš„html">ä¹‹å‰è®²è¿‡çš„HTML</h4>
<ul>
<li><code>&lt;u&gt;...&lt;/u&gt;</code> ä¸‹åˆ’çº¿è¯­æ³•</li>
<li><code>&lt;span id='name'&gt;...&lt;/span&gt;</code>ï¼Œè®¾ç½®è·³è½¬ä½ç½®æ ‡è®°è¯­æ³•</li>
</ul>
<hr>
<h3 id="latex-æ•°å­¦å…¬å¼æ¸²æŸ“">LaTex æ•°å­¦å…¬å¼æ¸²æŸ“</h3>
<p>â€‹ ä»€ä¹ˆæ˜¯<a href="https://baike.baidu.com/item/LaTeX/1212106?fr=aladdin">[<span class="math inline">\(\LaTeX\)</span>ç™¾åº¦ç™¾ç§‘ğŸ”—]</a>ï¼Œ<a href="(https://www.latex-project.org/)">[<span class="math inline">\(\LaTeX\)</span>å®˜ç½‘]</a></p>
<p>â€‹ åŸç”Ÿçš„markdownä¸æ”¯æŒï¼ˆGithubä¸Šçš„readmeå°±ä¸ç›´æ¥æ”¯æŒ<span class="math inline">\(\LaTeX\)</span>è¯­æ³•ï¼‰ï¼Œä½†æ˜¯Typoraæ”¯æŒã€‚æœ‰æ•°å­¦å…¬å¼è¾“å…¥éœ€è¦çš„æœ‹å‹å¯ä»¥ä½¿ç”¨å†…ç½®çš„åŠŸèƒ½ã€‚æ³¨æ„å¯èƒ½éœ€è¦åœ¨è®¾ç½®ä¸­æ‰“å¼€LaTexæ”¯æŒï¼Œè¯¦è§<a href="#setting">ã€Typoraçš„ä¸€äº›è®¾ç½®ä¸åŠŸèƒ½ã€‘</a>ã€‚</p>
<h4 id="å†…è”å…¬å¼">å†…è”å…¬å¼</h4>
<p>â€‹ å°±æ˜¯è¡Œå†…åµŒå…¥å…¬å¼ï¼Œæ¯”å¦‚ï¼š<span class="math inline">\(P(x|y)=\frac{P(x,y)}{P(y)}\)</span>æˆ–æ˜¯ï¼š<span class="math inline">\(f:D \subset \mathbb R^n\rightarrow \mathbb R\)</span>ã€‚åªéœ€è¦ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¯”å¦‚ï¼š$P(x|y)=\frac&#123;P(x,y)&#125;&#123;P(y)&#125;$</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿå°±æ˜¯LaTexè¯­æ³•æ˜¯è¢«$ç¬¦å·ï¼ˆå·¦å³å„ä¸€ä¸ªï¼‰åŒ…å›´çš„ã€‚</p>
<h4 id="å…¬å¼å—">å…¬å¼å—</h4>
<p><span class="math display">\[
2D_{JS}(P_R|P_G)=\int_xP_R(x)log(\frac{P_R(x)}{\frac{P_R(x) + P_G(x)}{2}})dx + \int_xP_G(x) log(\frac{P_G(x)}{\frac{P_R(x) + P_G(x)}{2}})dx
\]</span></p>
<p>â€‹ è¿˜æ²¡æœ‰æ¥è§¦è¿‡LaTexçš„æœ‹å‹ï¼Œå°±ä¸æŒ‡æœ›ä½ ç«‹é©¬å†™å‡ºä»¥ä¸Šçš„å…¬å¼æ¥äº†ã€‚ä¸Šé¢å…¬å¼çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">2D_&#123;JS&#125;(P_R|P_G)=\int_xP_R(x)log(\frac&#123;P_R(x)&#125;&#123;\frac&#123;P_R(x) + P_G(x)&#125;&#123;2&#125;&#125;)dx + \int_xP_G(x) log(\frac&#123;P_G(x)&#125;&#123;\frac&#123;P_R(x) + P_G(x)&#125;&#123;2&#125;&#125;)dx</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>â€‹ é‡ç‚¹å°±æ˜¯å¼€å¤´å’Œç»“å°¾æ’å…¥ä¸¤ä¸ª<code>$$</code>ã€‚</p>
<h4 id="å¸¸ç”¨latexè¯­æ³•">å¸¸ç”¨<span class="math inline">\(\LaTeX\)</span>è¯­æ³•</h4>
<p><img src="/2021/02/09/Typora-Markdown-Intros/latex1.png"></p>
<center>
Figure 9. LaTexå¸¸ç”¨è¯­æ³•
</center>
<p>â€‹ å…¬å¼å—è¯­æ³•ï¼ˆå¤šè¡Œå…¬å¼ï¼Œ<strong><u>å·¦å¯¹é½</u></strong>ï¼Œæ¯ä¸ªå…¬å¼<strong><u>ç‹¬ç«‹æ ‡å·</u></strong>ï¼‰</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;align&#125;</span><br><span class="line"><span class="built_in">&amp;</span> x = a + b 	<span class="keyword">\\</span> <span class="comment">% \\ä¸ºæ¢è¡Œ</span></span><br><span class="line"><span class="built_in">&amp;</span> x = c + d</span><br><span class="line"><span class="keyword">\end</span>&#123;align&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
\begin{align}
&amp; x = a + b     \\ % \\ä¸ºæ¢è¡Œ
&amp; x = c + d
\end{align}
\]</span></p>
<p>â€‹ å¤šè¡Œå…¬å¼ï¼Œæ‰€æœ‰å…¬å¼æ ‡å·åªæœ‰ä¸€ä¸ª:</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">x = a + b 	<span class="keyword">\\</span> <span class="comment">% \\ä¸ºæ¢è¡Œ</span></span><br><span class="line">x = c + d</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
\begin{equation}
x = a + b   \\ % \\ä¸ºæ¢è¡Œ
x = c + d
\end{equation}
\]</span></p>
<p>â€‹ å…¶ä»–çš„è¯­æ³•å¯ä»¥è§ä¸Šä¸€ç¯‡åšæ–‡<a href="https://enigmatisms.github.io/2021/02/05/LaTex%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AE%B0%E5%BD%95/">[LaTexåŸºç¡€è¯­æ³•è®°å½•]</a>ã€‚æœ‰äº›è¯­æ³•æ”¯æŒï¼ˆæ¯”å¦‚çŸ©é˜µ / å¤§èŠ±æ‹¬å· / å…¬å¼lableæ·»åŠ ï¼‰ï¼Œæœ‰äº›ä¸æ”¯æŒï¼ˆå›¾ç‰‡æ“ä½œ / åˆ†èŠ‚ï¼‰</p>
<hr>
<h3 id="mermaid-flow-gantt">Mermaid / Flow / Gantt</h3>
<p>â€‹ è¿™ä¸‰ç§æ˜¯å¸¸è§çš„å›¾è¡¨ï¼ˆå—çŠ¶é€»è¾‘å›¾ï¼‰ï¼ˆæµç¨‹å›¾ï¼‰ï¼ˆç”˜ç‰¹å›¾ï¼ˆå¤šç”¨äºé¡¹ç›®ç®¡ç†ï¼‰ï¼‰ï¼Œè¿™äº›å›¾è¡¨éƒ½æ˜¯åŸºäºä¸‰ä¸ªâ€œ`â€ç¬¦å·çš„ä»£ç å—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">```mermaid</span><br><span class="line">...</span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line">â€‹```flow</span><br><span class="line">...</span><br><span class="line">â€‹```</span><br><span class="line"></span><br><span class="line">â€‹```gantt</span><br><span class="line">...</span><br><span class="line">â€‹```</span><br></pre></td></tr></table></figure>
<h4 id="mermaid">Mermaid</h4>
<p>â€‹ åªæä¾›ç®€å•çš„ç¤ºä¾‹ï¼šmermaidå›¾è¡¨é€šå¸¸çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/mermaid2.png"></p>
<center>
Figure 10. TBä¸LRä¸¤ç§ç©ºé—´æ’å¸ƒçš„è¾“å‡º
</center>
<p>â€‹ å·¦å›¾æ˜¯ä¸Šä¸‹å¼æ’åˆ—ï¼ˆ<code>graph TB</code>ï¼‰å³å›¾æ˜¯å·¦å³å¼æ’åˆ—ï¼ˆ<code>graph LR</code>ï¼‰ã€‚</p>
<p>â€‹ mermaidå›¾æä¾›äº†å‡ ç§ <strong>ã€çº¿å‹ã€‘</strong>ï¼Œã€<strong>æ¡†å‹</strong>ã€‘ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ç»†ç›´çº¿ï¼ˆæ— å‘<code>---</code>ï¼‰ï¼Œç»†ç®­å¤´ï¼ˆæœ‰å‘<code>--&gt;</code>ï¼‰ï¼Œç²—ç›´çº¿ï¼ˆ<code>===</code>ï¼‰ï¼Œç²—ç®­å¤´ï¼ˆ<code>==&gt;</code>ï¼‰</li>
<li>ç›´è§’æ¡†ï¼ˆA[å†…å®¹]ï¼‰ï¼Œåœ†è§’æ¡†ï¼ˆ A(å†…å®¹) ï¼‰ï¼Œåœ†å½¢æ¡†ï¼ˆ A((å†…å®¹)) ï¼‰ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A((A))--&gt;B[B]</span><br><span class="line">B--&gt;C((C))</span><br><span class="line">B---D(D)</span><br><span class="line">C===E(E)</span><br><span class="line">D==&gt;E((E))</span><br></pre></td></tr></table></figure>
<p>â€‹ è¾“å‡ºçš„ç»“æœä¸ºï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/mermaid3.png"></p>
<center>
Figure 11. ä¸åŒçº¿å‹ä¸æ¡†å‹çš„è¾“å‡º
</center>
<h4 id="flowæµç¨‹å›¾">Flowæµç¨‹å›¾</h4>
<p>â€‹ æµç¨‹å›¾ä¸­æœ‰äº”ä¸ªä¸»è¦ç»“æ„ï¼šå…¶ä¹¦å†™å¦‚è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr class="header">
<th>ç»“æ„</th>
<th>ä¹¦å†™æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>å¼€å§‹æ¡†ï¼ˆåœ†è§’æ¡†ï¼‰</td>
<td>start</td>
</tr>
<tr class="even">
<td>è¾“å…¥è¾“å‡ºæ¡†ï¼ˆå¹³è¡Œå››è¾¹å½¢ï¼‰</td>
<td>inputoutput</td>
</tr>
<tr class="odd">
<td>æµç¨‹æ¡†ï¼ˆç›´è§’æ¡†ï¼‰</td>
<td>operation</td>
</tr>
<tr class="even">
<td>æ¡ä»¶åˆ¤å®šï¼ˆè±å½¢æ¡†ï¼‰</td>
<td>condition</td>
</tr>
<tr class="odd">
<td>ç»“æŸæ¡†ï¼ˆåœ†è§’æ¡†ï¼‰</td>
<td>end</td>
</tr>
</tbody>
</table>
<p>â€‹ ä¸€ä¸ªä¹¦å†™ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">start=&gt;start: Program starts</span><br><span class="line">input=&gt;inputoutput: Input</span><br><span class="line">operation=&gt;operation: System checking</span><br><span class="line">condition=&gt;condition: System failed?</span><br><span class="line">output=&gt;inputoutput: Output</span><br><span class="line">error=&gt;operation: Error</span><br><span class="line">end=&gt;end: Shutdown</span><br><span class="line"></span><br><span class="line">start(right)-&gt;input</span><br><span class="line">input(right)-&gt;operation</span><br><span class="line">operation(right)-&gt;condition</span><br><span class="line">condition(no,right)-&gt;output</span><br><span class="line">condition(yes,bottom)-&gt;error(right)-&gt;output</span><br><span class="line">output(right)-&gt;end</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯¹äº<code>=&gt;</code>å·¦è¾¹çš„éƒ¨åˆ†ï¼Œå…¶å®æ˜¯æ¯ä¸ªæ¡†çš„åç§°ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªoperationæ¡†å«åšerrorã€‚<code>=&gt;</code>å³è¾¹åˆ™æ˜¯æ¡†ç±»å‹ã€‚ä¸ŠåŠéƒ¨åˆ†ä¸­ï¼Œæ‰€æœ‰çš„æ¡†è¢«å®šä¹‰äº†ï¼ŒåŒ…æ‹¬å…¶ç±»å‹ä»¥åŠå†…å®¹ï¼ˆç±»å‹åå†’å· + ç©ºæ ¼ è¾“å…¥å†…å®¹ï¼‰ï¼Œä¸‹åŠéƒ¨åˆ†åˆ™æ˜¯å…¶ä¸­çš„æµç¨‹è½¬æ¢å…³ç³»ï¼ˆ<code>-&gt;</code>è¡¨ç¤º flowçš„æ–¹å‘ï¼‰</p>
<p>â€‹ æ³¨æ„ conditionå¯å¤šåˆ†æ”¯ï¼Œæ‰€ä»¥ä¼šæœ‰(no) / (yes)æ ‡ç­¾ï¼Œå…¶ä»–çš„(right / bottom)éƒ½æŒ‡çš„æ˜¯ç®­å¤´çš„ç©ºé—´æ–¹å‘ã€‚äº‹å®ä¸Šï¼Œflowåªèƒ½ç”»ä¸€äº›ç®€å•çš„æµç¨‹å›¾ï¼Œå¤æ‚çš„æµç¨‹å›¾ä¸­å„ä¸ªæ¡†çš„ä½ç½®æå…¶éš¾ç¼–æ’ã€‚è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/02/09/Typora-Markdown-Intros/flow.JPG"></p>
<center>
Figure 12. flowæµç¨‹å›¾è¾“å‡ºçš„ç»“æœ
</center>
<h4 id="ganttæ—¶é—´å›¾">Ganttæ—¶é—´å›¾</h4>
<p>â€‹ ç»™ä¸€ä¸ªä¾‹å­å§ï¼Œfrom <a href="https://blog.csdn.net/zyxhangiian123456789/article/details/102479437">[CSDN Gantt Graph]</a>ã€‚ä¸ªäººå…¶å®æ²¡æœ‰ä½¿ç”¨åœ¨è¿™ä¸ªçš„éœ€æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gantt</span><br><span class="line">dateformat YYYY-MM-DD</span><br><span class="line">Title The expected refining schedule</span><br><span class="line">section DS1</span><br><span class="line">Oil 3 (25,000): done, 0h, 100h</span><br><span class="line">Oil 4 (24,000): crit, 96h</span><br><span class="line">Oil 8 (24,000): crit, 176h</span><br><span class="line">section DS2</span><br><span class="line">Oil 1 (16,000): done, 0h, 48h</span><br><span class="line">Oil 2 (26,000): done, 78h</span><br><span class="line">oil 11 (82,300): crit, 246h</span><br><span class="line">section DS3</span><br><span class="line">Oil 5 (15,000): done, 0h, 60h</span><br><span class="line">Oil 4 (17,000): done, 68h</span><br><span class="line">oil 6 (18,000): done, 72h</span><br><span class="line">oil 10 (43,055): crit, 172h</span><br><span class="line">section DS4</span><br><span class="line">Oil 7 (22,000): done, 0h, 35h</span><br><span class="line">Oil 8 (103,000): active, 165h</span><br><span class="line">oil 9 (107,638): crit, 172h</span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/09/Typora-Markdown-Intros/gantt.JPG"></p>
<center>
Figure 13. Ganttå›¾ç»˜åˆ¶ç»“æœ
</center>
<hr>
<h2 id="å®è·µç»ƒä¹ ">å®è·µç»ƒä¹ ï¼</h2>
<ul>
<li>ä¸€å¥è¯ï¼šå°è¯•-&gt;ç†Ÿç»ƒ å°±èƒ½å‘ç°word / WPS æœ‰å¤šéš¾ä»¥ä½¿ç”¨ã€‚</li>
<li>è¯»è€…å¯ä»¥å°è¯•ä½¿ç”¨Markdownå†™ä¸€ä»½ç¬”è®°ã€‚è¦æ±‚åŒ…å«ï¼š
<ul>
<li>å°é¢çš„è®¾è®¡ï¼ˆæ¯”å¦‚å±…ä¸­ / å¼ºåˆ¶åˆ†é¡µ / å­—ä½“å˜æ¢ / å›¾ç‰‡æ’å…¥ï¼‰</li>
<li>ç›®å½•ï¼ˆtocæ’å…¥ / å¼ºåˆ¶åˆ†é¡µï¼‰</li>
<li>æ­£æ–‡ï¼ˆæ ‡é¢˜ / å¼ºè°ƒ / åˆ†ç‚¹ / è¶…é“¾æ¥ / å¼•ç”¨ / è¡¨æ ¼ / ä»£ç å—(optional) / LaTeX(optional) ï¼‰</li>
</ul></li>
</ul>
<center>
<font size="5"> Amat Victoria Curam. 2021.2.10</font>
</center>
<p>â€‹</p>
]]></content>
      <categories>
        <category>tutorial</category>
      </categories>
      <tags>
        <tag>typesetting</tag>
      </tags>
  </entry>
  <entry>
    <title>Vision Transformers</title>
    <url>/2021/11/28/Vision-Transformers/</url>
    <content><![CDATA[<h1 id="vit">ViT</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ å»å¹´çš„ä¸€ä¸ªå·¥ä½œ<a href="#refs">[1]</a>ï¼ŒVision Transformerçš„æˆåŠŸå¸¦åŠ¨äº†å˜å½¢é‡‘åˆšåœ¨è§†è§‰é‚»åŸŸçš„åº”ç”¨ã€‚CNN-basedçš„backboneå¯èƒ½å°±å¿«è´¥åœ¨NASä»¥åŠViTè¡ç”Ÿæ¨¡å‹æ‰‹ä¸‹äº†ã€‚ä¸ºäº†å›é¡¾transformerä»¥åŠåŠ æ·±ç†è§£ï¼Œæˆ‘å¤ç°äº†è¿™ç¯‡è®ºæ–‡<a href="#refs">[2]</a>ï¼ˆå…¶ä¸­çš„ViT-Liteä»¥åŠCCTï¼‰ã€‚è¿™ä¸ªå·¥ä½œæ˜¯å¯¹ViTè¿›è¡Œè½»å‹åŒ–ï¼Œå¹¶ä¸”ä½œè€…ä¹Ÿæå‡ºäº†ä½¿ç”¨å·ç§¯åŠ å…¥inductive biasçš„æ–¹æ³•ã€‚è®ºæ–‡æå‡ºçš„ç½‘ç»œå¤ç°èµ·æ¥å¾ˆç®€å•ï¼Œæ¯•ç«Ÿä¸æ˜¯ä»€ä¹ˆå¤§å‹ç½‘ç»œä»¥åŠå¤æ‚æ¶æ„ï¼Œä½†æ˜¯è¦å¤ç°å…¶ç»“æœæ„Ÿè§‰è¿˜æ˜¯æŒºåƒç»éªŒçš„ã€‚å¤ç°è§ï¼š<a href="https://github.com/Enigmatisms/Maevit">[GithubğŸ”—:Enigmatisms/Maevit]</a></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/11/28/Vision-Transformers/train.png"></th>
<th style="text-align: center;"><img src="/2021/11/28/Vision-Transformers/test.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">æœ€ç»ˆï¼ˆæ— mixupï¼‰è®­ç»ƒé›†å‡†ç¡®ç‡ï¼ˆçº¦99.8%ï¼‰</td>
<td style="text-align: center;">æœ€ç»ˆï¼ˆæ— mixupï¼‰æµ‹è¯•é›†å‡†ç¡®ç‡ï¼ˆçº¦94.5%ï¼‰</td>
</tr>
</tbody>
</table>
<center>
Figure 1. CIFAR-10å®éªŒï¼Œå®˜æ–¹å®ç°æ˜¾ç¤ºçš„æœ€ç»ˆaccçº¦ä¸º94.7%
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-a-few-points">II. A Few Points</h2>
<h3 id="inductive-bias">2.1 Inductive Bias</h3>
<p>â€‹ æŒ‰ç…§Wikipediaçš„å®šä¹‰ï¼Œå½’çº³åç½®å…¶å®å°±æ˜¯ ä¸ºäº†å¤„ç†æ²¡æœ‰è§è¿‡çš„æ•°æ®è€Œåœ¨å­¦ä¹ å™¨ä¸Šåšçš„å‡è®¾ã€‚</p>
<blockquote>
<p>The <strong>inductive bias</strong> (also known as <strong>learning bias</strong>) of a learning algorithm is the set of assumptions that the learner uses to predict outputs of given inputs that it has not encountered.</p>
</blockquote>
<p>â€‹ ç»´åŸºä»¥å¥¥å¡å§†å‰ƒåˆ€åŸç†ä½œä¸ºäº†å…¶ä¸­ä¸€ä¸ªä¾‹å­ã€‚äº‹å®ä¸Šï¼Œå¥¥å¡å§†å‰ƒåˆ€åŸç†è¿™ç§å½’çº³åç½®å®é™…ä¸Šæ˜¯ æƒé‡æ­£åˆ™åŒ–çš„åº•å±‚æ€æƒ³ï¼šæ¨¡å‹ä¸åº”è¯¥è¿‡äºå¤æ‚ã€‚</p>
<blockquote>
<p>A classical example of an inductive bias is <a href="https://en.wikipedia.org/wiki/Occam&#39;s_razor">Occam's razor</a>, assuming that the simplest consistent hypothesis about the target function is actually the best. Here <em>consistent</em> means that the hypothesis of the learner yields correct outputs for all of the examples that have been given to the algorithm.</p>
</blockquote>
<p>â€‹ ViTè®ºæ–‡ä¸­æåˆ°ï¼š</p>
<blockquote>
<p>We note that Vision Transformer has much less image-specific inductive bias than CNNs. In CNNs, locality, two-dimensional neighborhood structure, and translation equivariance are baked into each layer throughout the whole model.</p>
</blockquote>
<p>â€‹ æ­¤å¤„æ‰€è¯´çš„inductive biaså®é™…ä¸Šæ˜¯å·ç§¯ç¥ç»ç½‘ç»œçš„ç‰¹æ€§ã€‚ç”±äºå·ç§¯æ ¸æ¯æ¬¡æ“ä½œéƒ½æ˜¯é’ˆå¯¹æŸä¸ªä½ç½®é¢†åŸŸçš„åƒç´ ï¼ˆæˆ–ç‰¹å¾ï¼‰è¿›è¡Œè¿ç®—ï¼Œå·ç§¯æ“ä½œä¹Ÿå°±åŒ…å«äº†ä¸€ä¸ªè¿™æ ·çš„å‡è®¾ï¼šä¸€ä¸ªåƒç´ ï¼ˆç‰¹å¾ï¼‰çš„ä¿¡æ¯ä¸€èˆ¬ä¸å…¶å‘¨å›´çš„åƒç´ ï¼ˆç‰¹å¾ï¼‰å­˜åœ¨ä¸€å®šçš„å…³è”æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ éè¦å¯¹æ¯ä¸ªå›¾åƒä½ç½®ï¼Œå–å‡ºå…¶å‘¨å›´çš„åƒç´ ï¼Œè¿‡MLPï¼Œç„¶åè¯´MLPä¹Ÿæœ‰è¿™æ ·çš„inductive biasï¼Œé‚£æˆ‘ä¹Ÿæ²¡åŠæ³•ï¼‰ã€‚</p>
<p>â€‹ ç›¸æ¯”ä¹‹ä¸‹ï¼ŒTransformerçœ‹ä»€ä¹ˆéƒ½å…·æœ‰å…¨å±€çœ¼å…‰ã€‚Transformer è¿™ç§ä»NLPè¿‡æ¥çš„ç»“æ„ï¼Œæœ¬æ¥ç”¨äºå¤„ç†è¯­å¥tokençš„embeddingsï¼Œè¯­è¨€è¿™ç§ä¸œè¥¿å°±ä¼šå­˜åœ¨é•¿è·ç¦»çš„å…³è”å…³ç³»ï¼Œå¦‚æœè¦ä½¿ç”¨å·ç§¯ï¼ˆæ¯”å¦‚ä¸€ç»´å·ç§¯ï¼‰ï¼Œå¯èƒ½å±‚æ•°å¾—éå¸¸æ·±æ‰èƒ½ä½¿æ„Ÿå—é‡è¶³å¤Ÿå¤§ã€‚äºæ˜¯ï¼Œå·ç§¯å±‚çš„é¢†åŸŸä¿¡æ¯ç»¼åˆè¿™ç§inductive biasåœ¨transformersä¸­æ˜¯æ‰¾ä¸åˆ°çš„ã€‚æ‰€ä»¥è¯´ï¼ŒViT-Liteçš„ä½œè€…å¸Œæœ›è‡ªå·±èƒ½æŠŠæ›´å¤šä¼ ç»ŸCNNæ¨¡å‹çš„inductive biasèåˆåˆ°ViTæ¨¡å‹ä¸­ï¼ˆæ¯•ç«ŸpatchåŒ–ä»¥åŠæ’å€¼æ˜¯å”¯äºŒåˆ©ç”¨ç‡ç©ºé—´é‚»åŸŸä¿¡æ¯çš„æ“ä½œï¼‰å®é™…ä¸Šåšçš„å·¥ä½œéå¸¸æµ…å±‚ï¼š</p>
<ul>
<li>æˆ‘åœ¨è¾“å…¥Transformerå‰ï¼Œè®©ç”Ÿæˆembeddingsçš„ç½‘ç»œå…·æœ‰å·ç§¯å±‚ä¸å°±è¡Œäº†å—ï¼Ÿçœ‹èµ·æ¥åƒå°æ‰“å°é—¹ã€‚</li>
</ul>
<h3 id="ä¸¤ç¯‡è®ºæ–‡çš„æ€æƒ³">2.2 ä¸¤ç¯‡è®ºæ–‡çš„æ€æƒ³</h3>
<p>â€‹ è®ºæ–‡æ€æƒ³å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯Transformeræ¨¡å‹åœ¨è§†è§‰ä¸­çš„åº”ç”¨ï¼š</p>
<div class="note danger no-icon"><p>ViTå°†å›¾åƒè¿›è¡Œäº†åˆ†å—æ“ä½œï¼ˆpatchï¼‰ï¼Œæ¯ä¸ªpatchè¿›è¡Œtokenizeï¼Œå½¢æˆäº†ä¸€ä¸²embeddingsåºåˆ—ã€‚è€ŒCVTä»¥åŠCCTå®é™…ä¸Šæ˜¯å°†tokenizeçš„åˆ†å—æ“ä½œå˜æˆäº†å·ç§¯æ“ä½œï¼Œä»¥æ­¤å¼•å…¥inductive biasï¼ŒCCTåšå¾—æ›´åŠ å½»åº•ï¼Œä½¿å¾—positional embeddingsä¸æ˜¯å¾ˆå¿…è¦ï¼ˆä½†æ˜¯ä»æˆ‘è‡ªå·±çš„å¤ç°å®éªŒä¸Šçœ‹ï¼Œç»“è®ºå¥½åƒæœ‰ç‚¹ä¸åŒï¼Ÿï¼‰</p>
</div>
<div class="note warning no-icon"><p>Embeddings è¿‡å¤šä¸ªtransformer layerï¼ˆè‡ªæ³¨æ„åŠ› + Feed forwardï¼‰ã€‚å½“ç„¶ï¼Œåœ¨embeddingsè¾“å…¥ä¹‹å‰ï¼Œå¯ä»¥åŠ positional embeddingsä¿¡æ¯ã€‚</p>
</div>
<div class="note info no-icon"><p>ViTéµå¾ªBERTçš„æ¨¡å¼ï¼Œè¾“å‡ºclass tokenè¿›è¡Œåˆ†ç±»ã€‚è€ŒCVT CCTä½¿ç”¨ sequential poolingï¼ˆå®é™…ä¸Šã€‚ã€‚ã€‚å°±æ˜¯ä¸€ç§æ³¨æ„åŠ›poolingæœºåˆ¶ï¼Œä½¿å¾—ä¸å®šé•¿çš„sequenceå¯ä»¥è¾“å‡ºä¸€ä¸ªå•ä¸ªçš„embeddingsè¿›è¡Œåˆ†ç±»ï¼‰ï¼Œç›¸å½“äºæ˜¯éšå¼ä½¿ç”¨class tokenäº†ã€‚</p>
</div>
<div class="note success no-icon"><p>ä¸€å±‚çº¿æ€§å±‚å®Œæˆåˆ†ç±»ã€‚ï¼ˆViT imageneté¢„è®­ç»ƒæ—¶ä½¿ç”¨çš„MLPç¨å¾®æ·±ä¸€ä¸¢ä¸¢ï¼‰ã€‚</p>
</div>
<p>â€‹ å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒåŸè®ºæ–‡åå­—å«åšï¼šAn Image is Worth 16X16 Words....ã€‚å¯ä»¥ä»ä¸­çœ‹å‡ºå…¶â€œpatchifyâ€è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å›ºå®špatchä¸ªæ•°çš„ã€‚è¿™ä½¿å¾—ViTä¸é€‚ç”¨äºä¸åŒçš„æ•°æ®é›†ï¼š</p>
<ul>
<li>CIFAR10å¤§å°åªæœ‰32 * 32ï¼Œé‚£ä¹ˆä¸€ä¸ªpatchåªæœ‰å››ä¸ªåƒç´ ï¼Œèƒ½æœ‰å¤šå°‘ä¿¡æ¯ï¼Ÿä¸ä¼šè¦æˆ‘ä¸Šé‡‡æ ·å§</li>
<li>MNISTæ›´ä¸ç”¨è¯´äº†</li>
<li>ImageNetï¼ŸçœŸæ˜¯è°æœ‰é’±è°workå•Šï¼Œä¸æ˜¯äººäººéƒ½èƒ½è®­çš„åŠ¨image netè¿™ç§è´µç‰©çš„ã€‚æˆ‘ä»¬å°†è¿™ç§äººç§°ä¹‹ä¸ºï¼šå¡æ€ªã€‚ViTæ˜¯ä¸€ä¸ªå¤§æ¨¡å‹ï¼Œå‚æ•°å¾ˆå¤šï¼ˆViT-baseæ•ˆæœä¸å¤ªå¯ï¼ŒViT-èƒ¡æ­Œæ•ˆæœæ‰SOTAï¼Œä½†æ˜¯èƒ¡æ­Œï¼ˆhugeï¼‰ç‰ˆå‚æ•°å·²ç»è¶…ResNet-1001äº†ï¼Œæˆ‘æ²¡ç†è§£é”™çš„è¯ï¼ŒResNet-1001æ˜¯ä¸ªåƒå±‚é¢ç½‘ç»œï¼‰ã€‚</li>
<li>CCTå°±ç›¸å¯¹è½»å‹å¾ˆå¤šäº†ï¼Œè€Œä¸”å¯ä»¥é€‚ç”¨äºå°æ•°æ®é›†ã€‚æˆ‘è‡ªå·±åšå®éªŒä½¿ç”¨çš„å°±æ˜¯CIFAR-10ã€‚</li>
</ul>
<hr>
<h2 id="iii.-è®­ç»ƒtricks">III. è®­ç»ƒtricks</h2>
<h3 id="å†™åœ¨å‰é¢">3.1 å†™åœ¨å‰é¢</h3>
<p>â€‹ æˆ‘è‡ªå·±æœ¬èº«å¾ˆåæ„Ÿè°ƒå‚ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œ<strong><u>äººå·¥æ™ºèƒ½è®­ç»ƒå¸ˆ</u></strong>å°±æ˜¯åˆä¸­æ¯•ä¸šå°±èƒ½å¹²çš„æ´»ï¼Œä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œæ‰“ä¸è¿‡çš„æ—¶å€™ï¼Œè¯¥åŠ å…¥è¿˜æ˜¯è¦åŠ å…¥ï¼Œè‡³å°‘äº†è§£ä½¿è‡ªå·±æ¶å¿ƒçš„äº‹ç‰©åˆ°åº•æ¶å¿ƒåœ¨å“ªï¼Œæ‰æœ‰æœºä¼šå»æ”¹å˜å§ã€‚ç”±äºä¹‹å‰ä¸€ç›´è¢«è®¾å¤‡ä»¥åŠè¿™ç§æ¶å¿ƒæ„Ÿé™åˆ¶ï¼Œä¸€ç›´æ²¡æ€ä¹ˆäº†è§£è®­ç»ƒtricksï¼Œè¿™æ¬¡èŠ±äº†ä¸€ç‚¹æ—¶é—´ç¨å¾®æ¶‰åŠäº†ä¸€ç‚¹ç‚¹ã€‚</p>
<blockquote>
<p>äººå·¥æ™ºèƒ½è®­ç»ƒå¸ˆå’Œé©¯å…½å¸ˆæ²¡æœ‰åŒºåˆ«ï¼Œè®­ç»ƒçš„å®¢ä½“éƒ½æ˜¯èƒ½åŠ›æœªçŸ¥çš„å¯¹è±¡ï¼Œè®­ç»ƒä¸»ä½“éƒ½ä¸éœ€è¦ç‰¹åˆ«é«˜çš„æ™ºåŠ›ã€‚ä¹è§‚åœ°è¯´ï¼Œäººç±»è¿˜æ˜¯æœ‰æœºä¼šç†è§£è‡ªå·±çš„åˆ›é€ çš„ï¼Œä½†è°ƒå‚æ€ªæ²¡æœ‰è¿™ä¸ªæœºä¼šã€‚æ‚²è§‚åœ°è¯´ï¼Œä½ çŒœä¸–ç•Œä¸Šæœ‰å¤šå°‘ç‚¼ä¸¹å¸ˆæ˜¯è°ƒå‚æ€ªï¼Ÿ</p>
</blockquote>
<h3 id="adamw">3.2 AdamW</h3>
<p>â€‹ ä¹‹å‰åœ¨è‡ªå»ºç½‘ç»œè§£å†³ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜æ—¶ï¼Œé‡åˆ°äº†å¾ˆä¸¥é‡çš„è¿‡æ‹Ÿåˆã€‚å½“æ—¶Googleåˆ°çš„å…¶ä¸­ä¸€ç§æ–¹æ¡ˆæ˜¯ï¼šä½¿ç”¨weight-decayï¼Œåœ¨ä¼˜åŒ–å™¨é‡Œç›´æ¥è®¾ç½®å³å¯ã€‚Weight decay å®é™…ä¸Šå°±æ˜¯ L2æ­£åˆ™åŒ–ï¼ˆin SGDï¼‰ï¼Œå¾ˆç®€å•ï¼š <span class="math display">\[
\begin{align}
&amp;L_{\text{final}}=L+L_{\text{L2 Reg}}=L+\alpha\sum_{i=1}^nw_i^2\\
&amp;\frac {d L_{\text{final}}}{dw_i}=\text{grad}+2\alpha w_i\\
&amp;w_{t+1,i}=w_{t,i}-\text{lr}\times (\text{grad}+2\alpha w_i)
\end{align}
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡æ›´æ–°ï¼Œæƒé‡éƒ½ä¼šæ ¹æ®ä¸Šä¸€æ¬¡çš„æƒé‡è¿›è¡Œä¸€å®šçš„è¡°å‡ã€‚</p>
<p>â€‹ è‡³å°‘ï¼Œweight decay = L2 regularizationåœ¨ SGDä¸­æˆç«‹ã€‚åœ¨ä¸€äº›å¤æ‚çš„ä¼˜åŒ–å™¨ï¼Œåˆæœ‰momentumåˆæœ‰å¹³å‡çš„çš„ï¼ˆæ¯”å¦‚Adamï¼‰ï¼Œweight decayå®é™…ä¸Šå’ŒL2 regularizationæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p><img src="/2021/11/28/Vision-Transformers/Adamw.png"></p>
<center>
Figure 2. AdamWä»¥åŠAdamçš„å¯¹æ¯”<a href="#refs">[4]</a>
</center>
<blockquote>
<p>We note that common implementations of adaptive gradient algorithms, such as Adam, <strong><u>limit the potential benefit</u></strong> of weight decay regularization, because the weights do not decay multiplicatively (as would be expected for standard weight decay) but by an <strong><u>additive constant factor</u></strong>. <a href="#refs">[4]</a></p>
</blockquote>
<p>â€‹ è¿™ä¸ªä¼˜åŒ–å™¨åœ¨ä¹‹å‰çš„æŸä¸ªäºŒåˆ†ç±»ä»»åŠ¡ä¸­æˆ‘å·²ç»ç”¨è¿‡äº†ã€‚å…³äºAdamWçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹<a href="#refs">[5]</a></p>
<h3 id="cosineannealingwarmrestarts">3.3 CosineAnnealingWarmRestarts</h3>
<p>â€‹ Torchè‡ªå¸¦çš„cosineLRå¥½åƒå¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„æ ·å­ï¼Œå› ä¸ºlr_scheduler.CosineAnnealingWarmRestartså‡ºæ¥çš„æ˜¯è¿™æ ·çš„ç»“æœï¼ˆä¸‹å›¾ç»¿è‰²ï¼‰ï¼š</p>
<p><img src="/2021/11/28/Vision-Transformers/LEC.png"></p>
<center>
Figure 3. CosineAnnealingWarmRestartsä»¥åŠæˆ‘è‡ªå®šä¹‰çš„å­¦ä¹ ç‡
</center>
<p>â€‹ ç»¿è‰²çš„æ›²çº¿å…¶å­¦ä¹ ç‡æ˜¯ä¸€ç›´åœ¨å›è·³åˆ°æœ€å¤§åˆå§‹å­¦ä¹ ç‡ï¼Œè¿™å¥½å—ï¼Ÿæˆ‘æ²¡æœ‰åœ¨APIé‡Œæ‰¾åˆ°ä»»ä½•å…³äºå­¦ä¹ ç‡å˜å°çš„è®¾ç½®ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªå­¦ä¹ ç‡è®¾ç½®è¿˜æœ‰ä¸ªè¿™æ ·çš„é—®é¢˜ï¼šå¦‚æœè®¾ç½®T_multï¼ˆä¹Ÿå°±æ˜¯è®©restarté¢‘ç‡è¶Šæ¥è¶Šä½ï¼Œcosineå‘¨æœŸè¶Šæ¥è¶Šé•¿çš„ä¸€ä¸ªå› å­ï¼‰ï¼Œå¾ˆéš¾æ§åˆ¶å…¶åœ¨ä¸€å®šepochsåï¼Œå­¦ä¹ ç‡é™åˆ°æœ€ä½ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¥½é™åˆ°æœ€ä½æ‰æ˜¯æœ€å¥½çš„ï¼‰ã€‚</p>
<p>â€‹ æ‰€ä»¥æˆ‘ç”¨LambdaLRè®¾è®¡äº†ä¸€ä¸ªä½™å¼¦å­¦ä¹ ç‡æ›²çº¿ï¼Œæ³¢åŠ¨æ˜¯ä¸ºäº†å…¶æœ‰ä¸€å®šçš„é€€ç«èƒ½åŠ›ï¼Œè€Œæˆ‘åŒæ—¶å¸Œæœ›ï¼š</p>
<ul>
<li>å­¦ä¹ ç‡ä¸æ–­å‡å°</li>
<li>æ³¢åŠ¨é¢‘ç‡ä¸æ–­å‡å°ï¼Œå¹¶ä¸”åœ¨æŒ‡å®šçš„epochå‡åˆ°æœ€å°</li>
</ul>
<p>â€‹ æˆ‘å°†è¿™ä¸ªå­¦ä¹ ç‡ç§°ä¸ºï¼ˆxxx-Decay-Cosine-Annealing-Warm-Restartï¼‰ï¼Œxxxå¯ä»¥æ˜¯çº¿æ€§ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡æ•°ã€‚æ€æƒ³å¾ˆç®€å•ï¼Œå­¦ä¹ ç‡æ›²çº¿è¢«ä¸¤æ¡æ›²çº¿å¤¹ä½ï¼ˆä¸æ˜¯æ¸è¿‘çº¿ï¼Œæ¸è¿‘çº¿å¾ˆéš¾æ±‚ï¼Œä½†æ˜¯å¯ä»¥æŒ‰ç…§æ¸è¿‘çº¿ç†è§£ï¼‰ã€‚ä¸€æ¡ç¡®å®šå­¦ä¹ ç‡æœ€å¤§å€¼ï¼ˆå¯ä»¥æ˜¯çº¿æ€§è¡°å‡æˆ–è€…æŒ‡æ•°è¡°å‡ï¼‰ï¼Œå¦ä¸€æ¡ç¡®å®šå­¦ä¹ ç‡ä¸‹ç•Œï¼ˆæŒ‡æ•°è¡°å‡ï¼‰ï¼Œå¯ä»¥æ ¹æ®åˆå€¼ã€ç»ˆå€¼ä»¥åŠepochsè®¡ç®—æ‰€æœ‰å‚æ•°ã€‚è¯¦æƒ…è§ï¼š(<a href="https://github.com/Enigmatisms/Maevit/blob/master/py/LECosineAnnealing.py">LECosineAnnealing.py</a>)</p>
<p>â€‹ Timm (Pytorch Image Models)æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œé‡Œé¢æä¾›äº†å¯ä»¥è¡°å‡çš„CosineAnnealingWarmRestarts:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> timm.scheduler <span class="keyword">import</span> CosineLRScheduler</span><br><span class="line">lec_sch_func = CosineLRScheduler(opt, t_initial = epochs // <span class="number">2</span>, t_mul = <span class="number">1</span>, lr_min = min_max_ratio, decay_rate = <span class="number">0.1</span>, warmup_lr_init = min_max_ratio, warmup_t = <span class="number">10</span>, cycle_limit = <span class="number">2</span>, t_in_epochs = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ å­¦ä¹ ç‡æ›²çº¿æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2021/11/28/Vision-Transformers/lr.png"></p>
<center>
Figure 4. CosineAnnealingWarmRestarts in timm
</center>
<p>â€‹ Restartä¸æ˜¯ç¬é—´çš„ï¼Œè€Œæ˜¯çº¿æ€§å¢å¤§çš„ï¼ˆåªä¸è¿‡å¾ˆå¿«é€Ÿï¼‰ã€‚å…¶ä¸­æ¶‰åŠåˆ°è¿™ä¹ˆä¸€äº›æ¦‚å¿µï¼š</p>
<ul>
<li>warmup-epochï¼šçƒ­èº«é˜¶æ®µã€‚ä¸€èˆ¬ç”¨äºtrain-from-the-scratchï¼ˆä»å¤´è®­ç»ƒï¼‰ï¼Œå¼€å§‹çš„å­¦ä¹ ç‡å°ï¼Œæ˜¯å› ä¸ºåˆå§‹åŒ–æ¨¡å‹æ—¶ï¼Œå‚æ•°éšæœºï¼Œæ¢¯åº¦ä¹ŸåŸºæœ¬ä¸Šæ˜¯éšæœºçš„ã€‚å¦‚æœå­¦ä¹ ç‡å¤ªå¤§ï¼Œæ¢¯åº¦ä¹±é£ï¼Œå¯èƒ½å¯¼è‡´NaNã€‚å°å­¦ä¹ ç‡ä½¿å¾—æ¢¯åº¦ç¨³å®šï¼Œå¼€å§‹æ—¶å‘æ­£ç¡®æ–¹å‘ç§»åŠ¨ã€‚</li>
<li>cooldown-epochï¼šå†·é™æœŸã€‚å­¦ä¹ ç‡å‡å°åˆ°æœ€å°æ—¶ï¼ˆä¸€èˆ¬æ˜¯å‘¨æœŸæ€§å­¦ä¹ ç‡schedulerç»“æŸï¼‰ï¼Œéœ€è¦å†·é™ä¸€ä¸‹ï¼Œåº¦è¿‡ä¸€æ®µè´¤è€…æ—¶é—´ï¼Œä»¥å°å­¦ä¹ ç‡è®­ç»ƒä¸€æ®µæ—¶é—´ã€‚</li>
</ul>
<h3 id="labelsmoothingce">3.4 LabelSmoothingCE</h3>
<p>â€‹ åˆ†ç±»é—®é¢˜ï¼Œæ ‡ç­¾æ˜¯ç¡¬çš„ã€‚è€Œç¥ç»ç½‘ç»œè¾“å‡ºï¼Œæ˜¯æ¨¡æ‹Ÿé‡ï¼Œç”¨æ¨¡æ‹Ÿè¿‡ç¨‹æ‹Ÿåˆç¦»æ•£è¿‡ç¨‹å­˜åœ¨ä¸€å®šéš¾åº¦ï¼ˆå‚è€ƒï¼šæ­£å¼¦æ³¢æ— é™å åŠ ç”Ÿæˆæ–¹æ³¢çš„å‰å¸ƒæ–¯æ•ˆåº”ï¼‰ã€‚æœ‰å¯èƒ½åœ¨ç½‘ç»œè®¾è®¡å¾—ä¸å¥½æ—¶ï¼Œåˆ†ç±»å¾ˆéš¾æ˜¯æ­£ç¡®çš„ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠç¡¬çš„å˜æˆè½¯çš„ï¼š</p>
<ul>
<li>Labelæœ¬èº«è½¬åŒ–æˆç½®ä¿¡åº¦ï¼ˆä¹‹å‰åœ¨äºŒåˆ†ç±»ä»»åŠ¡ä¸­ç”¨è¿‡ï¼‰</li>
<li>åœ¨è®¡ç®—lossæ—¶è¿›è¡Œlabelå¹³æ»‘ã€‚å¹³æ»‘å˜›ï¼Œé‚£å…¶ç›®çš„ç¦»ä¸å¼€ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæœ¬è´¨å°±æ˜¯æ­£åˆ™åŒ–æ‰‹æ®µï¼Œæ¶¨ç‚¹tricksäº†</li>
<li>Timmå·²ç»å®ç°äº†è¿™ä¸ªlossï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</li>
</ul>
<h3 id="åŠ é€Ÿ">3.5 åŠ é€Ÿ</h3>
<p>â€‹ å¼€å§‹æ—¶æˆ‘å¤ªç¬¨ï¼Ÿäº†ï¼Ÿ5ä¸ªbatchå°±å¾ˆç€æ€¥åœ°evalä¸€æ¬¡ï¼Œå®é™…ä¸Šæ²¡æœ‰å¿…è¦ï¼Œä¸€æ¬¡evaléœ€è¦èŠ±è´¹5-6sï¼ˆCIFAR-10ï¼‰ï¼Œé‚£ä¹ˆbatch sizeï¼ˆå¼€å§‹æ—¶ç”¨çš„æ˜¯64ï¼‰æƒ…å†µä¸‹782ä¸ªbatchå…±éœ€è¦eval 150å¤šæ¬¡ï¼Œæ¯ä¸ªepochè®­ç»ƒçš„æ—¶é—´å¢åŠ äº†10åˆ†å¤šé’Ÿï¼Œå¤ªå‚»äº†ã€‚å¾ˆæ˜¾ç„¶è¿™å¹¶ä¸æ˜¯æˆ‘è¦è¯´çš„åŠ é€Ÿã€‚</p>
<p>â€‹ åŠ é€Ÿæœ‰è¿™ä¹ˆå‡ ç§æ–¹æ³•ï¼š</p>
<ol type="1">
<li>æ··åˆç²¾åº¦ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼ˆåœ¨æˆ‘çš„CUDAç¬¬äºŒç¯‡å­¦ä¹ åšå®¢ä¸­ï¼‰ï¼ŒåŒç²¾åº¦ éå¸¸æ‹‰ï¼Œå•ç²¾åº¦è¿˜è¡Œï¼Œè¦æ˜¯ä½¿ç”¨float16å°±æ›´å¿«äº†ã€‚pytorchæä¾›ä¸€ç§æ··åˆç²¾åº¦çš„æ–¹å¼ï¼šAMPï¼ˆAutomatic Mixed Precisionï¼‰ï¼Œè‡ªåŠ¨ç¡®å®šå“ªäº›æµ®ç‚¹å¯ä»¥ç®€åŒ–ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># From [6]</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># Creates once at the beginning of training</span></span><br><span class="line">scaler = torch.cuda.amp.GradScaler()</span><br><span class="line"><span class="keyword">for</span> data, label <span class="keyword">in</span> data_iter:</span><br><span class="line">   optimizer.zero_grad()</span><br><span class="line">   <span class="comment"># Casts operations to mixed precision</span></span><br><span class="line">   <span class="keyword">with</span> torch.cuda.amp.autocast():</span><br><span class="line">      loss = model(data)</span><br><span class="line">   <span class="comment"># Scales the loss, and calls backward()</span></span><br><span class="line">   <span class="comment"># to create scaled gradients</span></span><br><span class="line">   scaler.scale(loss).backward()</span><br><span class="line">   <span class="comment"># Unscales gradients and calls</span></span><br><span class="line">   <span class="comment"># or skips optimizer.step()</span></span><br><span class="line">   scaler.step(optimizer)</span><br><span class="line">   <span class="comment"># Updates the scale for next iteration</span></span><br><span class="line">   scaler.update()</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“ç„¶ï¼Œtimmå®ç°äº†æ›´å¥½çš„æ¥å£ï¼ˆNativeScalerï¼‰ï¼Œå°±ä¸éœ€è¦è°ƒç”¨ä»€ä¹ˆscale(loss).backward(), stepä¹‹ç±»çš„äº†ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">amp_scaler(loss, opt, clip_grad=<span class="literal">None</span>, parameters = model_parameters(model), create_graph = <span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>cuDNN</li>
</ol>
<p>â€‹ ä¹‹å‰ä¸€ç›´ä¸çŸ¥é“è¿™ä¸ªèƒ½æ€ä¹ˆç”¨ï¼Œåæ­£CSDNåªé¡¾æˆäººä»¥é±¼å˜›ï¼Œå‘Šè¯‰ä½ è£…å§ï¼Œä¹Ÿä¸å‘Šè¯‰ä½ è£…æ¥å¹²å•¥ï¼Œç²ªå‘å®é”¤äº†ï¼ˆè¶Šç”¨è¶Šè§‰å¾—ç²ªå‘ï¼Œå®åŠ›å‘èœé€¼ï¼‰ã€‚cuDNNèƒ½åŠ é€Ÿä¸€äº›è¿ç®—ï¼ŒDLä¸­ï¼Œå…¸å‹çš„å·ç§¯è¿ç®—æ˜¯ä¼šè¢«åŠ é€Ÿçš„ï¼ŒcuDNNè‡ªåŠ¨benchmarkå·ç§¯ï¼Œæ‰¾åˆ°æœ€å¥½çš„å·ç§¯å®ç°ç»™ä½ ç”¨ã€‚åªéœ€ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">torch.backends.cudnn.benchmark = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>å·¥äººé˜¶çº§çš„åŠ›é‡</li>
</ol>
<p>â€‹ æ•°æ®é›†åŠ è½½ï¼ˆDataloaderï¼‰ï¼Œä½¿ç”¨å¤šä¸ªworkersã€‚è¿™é‡Œé‡åˆ°äº†ä¸€äº›è¿™æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>dataloaderå®é™…ä¸Šåœ¨æå¤šè¿›ç¨‹ï¼Œå¤šè¿›ç¨‹é»˜è®¤æ˜¯å¼€å­è¿›ç¨‹çš„ï¼ˆforkï¼‰ï¼Œä½†æ˜¯ï¼š</li>
</ul>
<blockquote>
<p>The CUDA runtime does not support the <code>fork</code> start method; either the <code>spawn</code> or <code>forkserver</code> start method are required to use CUDA in subprocesses. ---- <a href="https://pytorch.org/docs/stable/notes/multiprocessing.html">Pytorch Document</a></p>
</blockquote>
<p>â€‹ å¦‚æœåœ¨ä¸»è¿›ç¨‹ä¸­åˆå§‹åŒ–äº†torch.cudaç¨‹åºï¼ˆå…ˆäºdataloaderæœ‰é™¤äº†model.cuda()çš„åˆ«çš„cudaæ“ä½œã€ï¼Ÿä¸ºä»€ä¹ˆmodelå¯ä»¥è°ƒcudaï¼Œéš¾é“å› ä¸ºå®ƒæ˜¯è¿›ç¨‹é—´å…±äº«çš„ï¼Ÿã€‘ï¼‰ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¯´ä¸èƒ½åœ¨forkçš„subprocessä¸­åˆå§‹åŒ–CUDAã€‚è§£å†³æ–¹æ³•ç¡®å®å°±æ˜¯ï¼Œç”¨spawnæ–¹æ³•ç”Ÿæˆæ–°çš„è¿›ç¨‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">torch.multiprocessing.set_start_method(<span class="string">&#x27;spawn&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ spawnå’Œforkçš„åŒºåˆ«ï¼š<a href="https://stackoverflow.com/questions/64095876/multiprocessing-fork-vs-spawn">stackoverflow.com: multiprocessing fork() vs spawn()</a>ã€‚è¿™é‡Œä¸å¤šè®²ï¼Œspawnæ–¹å¼ç”Ÿæˆè¿›ç¨‹è²Œä¼¼ç‚¸äº†æˆ‘çš„æ˜¾å­˜ï¼ˆ<strong><u>åŸå› å¯èƒ½æœ‰ä¸¤ç‚¹ï¼š</u></strong>1. spawnæœ¬èº«ç‰¹æ€§ï¼Œä¼šå¤§é‡å¤åˆ¶èµ„æºï¼Œæ¯ä¸ªæ–°å¯åŠ¨çš„python3è§£é‡Šè¿›ç¨‹éƒ½å ç”¨éƒ¨åˆ†èµ„æº 2. åœ¨CUDAè¯¯åˆå§‹åŒ–ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œè¯¯åˆå§‹åŒ–é—®é¢˜è§£å†³åº”è¯¥ä¸ä¼šç‚¸æ˜¾å­˜äº†ï¼‰ã€‚ç‚¸æ˜¾å­˜çš„é—®é¢˜ï¼Œ<a href="https://blog.csdn.net/YNNAD1997/article/details/113829532">è¿™ä½CSDNè€å“¥</a>ä¹Ÿç¢°åˆ°äº†ï¼Œä½†ä»–è²Œä¼¼æ²¡æœ‰è§£å†³ã€‚</p>
<p>â€‹ å¼€å§‹æ—¶æˆ‘ä¸€ç›´æ²¡èƒ½ç”¨æˆforkï¼Œéƒ½ä½¿ç”¨spawnï¼ˆå¯åŠ¨å¾ˆæ…¢ï¼Œè€Œä¸”è¿˜ç‚¸æ˜¾å­˜ï¼‰ã€‚æˆ‘å‘ç°å®˜æ–¹å®ç°å¯ä»¥ä½¿ç”¨forkæ–¹å¼ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°å¾ˆå¥‡æ€ªï¼ŒæŸ¥é”™æœ€åå‘ç°æ˜¯ï¼šRandomEraseï¼ˆDataloaderæ•°æ®å¢å¼ºçš„transformï¼‰é»˜è®¤ä½¿ç”¨äº†CUDAï¼Œè®¾ç½®deviceä¸ºcpuå°±å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚</p>
<h3 id="mixup">3.6 Mixup</h3>
<p>â€‹ æˆ‘è¶…ã€‚æˆ‘ä¸çŸ¥é“è¿™ä¸ªå·¥ä½œï¼š<a href="https://arxiv.org/abs/1710.09412">[mixup: Beyond Empirical Risk Minimization]</a>ã€‚è¿™ä¸ªå·¥ä½œè²Œä¼¼æ˜¯ä¸€ç§ç»ˆææ•°æ®å¢å¼ºæ–¹æ³•ã€‚</p>
<p>â€‹ æˆ‘è¶…ã€‚è¿™ç¯‡è®ºæ–‡æˆ‘çœ‹äº†30sä¹‹åå°±å·²ç»æ„Ÿè§‰æœ‰ç‚¹6äº†ï¼Œmixupå°±æ˜¯å°†ä¸¤ä¸ªè®­ç»ƒæ ·æœ¬å åœ¨ä¸€èµ·ï¼Œlabelå¯ä»¥ä¸ä¸€æ ·ï¼Œå åŠ æ˜¯åŠ æƒçš„ï¼Œæœ€åå½¢æˆåŠ æƒçš„labelï¼Œè®©ç½‘ç»œå»å­¦ã€‚ä½œè€…è®¤ä¸ºï¼š</p>
<ul>
<li>è™½ç„¶æ™®é€šçš„æ•°æ®å¢å¼ºç¡®å®ä½¿å¾—è®­ç»ƒæ•°æ®å¢å¤šäº†ï¼Œä½†æ˜¯æ•°æ®å¢å¼ºå¹¶ä¸æ˜¯åœ¨æ•°æ®çš„çœŸå®åˆ†å¸ƒé™„è¿‘é‡‡æ ·ï¼Œè€Œæ˜¯åŠ äº†ä¸€äº›éšæœºå™ªå£°ï¼Œåªæ˜¯å¢å¼ºäº†æŠ—å¹²æ‰°èƒ½åŠ›</li>
<li>ç®€å•åœ°è¯´ï¼Œè€ƒè™‘ä¸€ä¸ªå¤šå³°åˆ†å¸ƒï¼Œmixupå¯ä»¥åœ¨å³°ä¸å³°ä¹‹é—´çš„æŸä¸ªä½ç½®é‡‡æ ·ï¼Œä½¿å¾—labelå’Œæ ·æœ¬åœ¨å¦ä¸€ç§æ„ä¹‰ä¸Šè¢«å¹³æ»‘äº†ã€‚Mixupçš„ä½œè€…è¯´åˆ°ï¼Œmixupå¯è¢«ç†è§£ä¸ºæ˜¯ï¼š</li>
</ul>
<blockquote>
<p>A form of <strong><u>data augmentation</u></strong> that encourages the model f to behave <strong><u>linearly in-between training examples</u></strong></p>
</blockquote>
<hr>
<h2 id="iv.-å¤ç°ç»“æœ">IV. å¤ç°ç»“æœ</h2>
<p>â€‹ æˆ‘æ€€ç–‘æˆ‘å¤ç°ç»“æœä¸å¦‚å®˜æ–¹å®ç°çš„åŸå› æ˜¯æˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨mixupç­–ç•¥ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„æ•°æ®å¢å¼ºã€‚æˆ‘ä»Šæ™šï¼ˆ2021-12-05ï¼‰å°è¯•äº†ä¸€ä¸‹mixupï¼Œä½†è²Œä¼¼ï¼ˆå¯èƒ½æ˜¯æ²¡æœ‰ç”¨å¥½ï¼Œä¹Ÿå¯èƒ½æ˜¯æ‰è®­ç»ƒäº†100ä¸ªepochï¼Œå‡ºä¸äº†ç»“æœï¼‰å¾ˆæ‹‰ï¼Œmixupå‚æ•°ä¸å®˜æ–¹å®ç°ä¸€è‡´ï¼Œå°±æ˜¯æ²¡æœ‰ç›´æ¥è°ƒç”¨timmåº“ç”ŸæˆPrefetchLoaderï¼ˆå› ä¸ºæ²¡æœ‰æ—¶é—´å»çœ‹æ–‡æ¡£ï¼‰ã€‚æ— mixupè®­ç»ƒçš„æœ€ä½³ç»“æœæ˜¯ï¼šè®­ç»ƒé›†accæ¥è¿‘1ï¼Œæµ‹è¯•é›†acc 94.5%ï¼Œè¿‡æ‹Ÿåˆè¿˜æ˜¯æœ‰ç‚¹ä¸¥é‡ï¼š</p>
<p><img src="/2021/11/28/Vision-Transformers/first.png"></p>
<center>
Figure 5. åˆšå¼€å§‹è®­ç»ƒï¼ˆMultiStepLRï¼Œå¹¶ä¸”å®ç°æœ‰ç‚¹é—®é¢˜ï¼‰
</center>
<p><img src="/2021/11/28/Vision-Transformers/cosine.png"></p>
<center>
Figure 6. CosineAnnealingWarmRestarts
</center>
<p><img src="/2021/11/28/Vision-Transformers/lec_lr.png"></p>
<center>
Figure 7. è‡ªå®šä¹‰å­¦ä¹ ç‡
</center>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/11/28/Vision-Transformers/train.png"></th>
<th style="text-align: center;"><img src="/2021/11/28/Vision-Transformers/test.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">æœ€ç»ˆï¼ˆæ— mixupç‰ˆæœ¬ï¼‰è®­ç»ƒé›†å‡†ç¡®ç‡</td>
<td style="text-align: center;">æœ€ç»ˆï¼ˆæ— mixupç‰ˆæœ¬ï¼‰æµ‹è¯•é›†å‡†ç¡®ç‡</td>
</tr>
</tbody>
</table>
<h3 id="æ›´æ–°">12.8 æ›´æ–°</h3>
<p>â€‹ æˆ‘å°è¯•äº†ä¸€ä¸‹Mixupï¼ˆæƒ³è¦è„±ç¦»timmåº“ç”¨mixupè¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œæ¯”å¦‚timmä¸­çš„mixupæŠŠè¾“å…¥è½¬æ¢æˆäº†numpyã€‚ã€‚ã€‚ä¸ºçš„å°±æ˜¯ç”¨é‡Œé¢çš„è´å¡å°”åˆ†å¸ƒï¼Ÿæ‰€ä»¥ä¸å¾—ä¸å†™ä¸€ä¸ªå¯ä»¥æŠŠtensorè½¬æ¢æˆå¯¹åº”numpyæ ¼å¼çš„å‡½æ•°ï¼‰ã€‚ç”¨mixupä¼šä½¿è®­ç»ƒæ—¶çš„æ•ˆæœæ˜æ˜¾å˜å·®ï¼Œä½†æ˜¯ä¸€å–æ¶ˆmixupï¼Œæ•ˆæœå°±å¾ˆå¥½ï¼š</p>
<p><img src="/2021/11/28/Vision-Transformers/Screenshot%20from%202021-12-07%2019-40-38.png"></p>
<center>
Figure 8. å¸¦mixupï¼Œæœ€åçº¦94%
</center>
<hr>
<h2 id="reference">Reference</h2>
<p><span id="refs"></span></p>
<p>[1] <a href="https://arxiv.org/pdf/2010.11929.pdf">Dosovitskiy A, Beyer L, Kolesnikov A, et al. An image is worth 16x16 words: Transformers for image recognition at scale[J]. arXiv preprint arXiv:2010.11929, 2020.</a></p>
<p>[2] <a href="https://arxiv.org/pdf/2104.05704.pdf">Hassani A, Walton S, Shah N, et al. Escaping the big data paradigm with compact transformers[J]. arXiv preprint arXiv:2104.05704, 2021.</a></p>
<p>[3] <a href="https://arxiv.org/abs/1706.03762">Vaswani A, Shazeer N, Parmar N, et al. Attention is all you need[C]//Advances in neural information processing systems. 2017: 5998-6008.</a></p>
<p>[4] <a href="https://openreview.net/pdf?id=rk6qdGgCZ">Fixing Weight Decay Regularization In Adam</a></p>
<p>[5] <a href="https://www.fast.ai/2018/07/02/adam-weight-decay/">AdamW and Super-convergence is now the fastest way to train neural nets</a></p>
<p>[6] <a href="https://efficientdl.com/faster-deep-learning-in-pytorch-a-guide/#4-use-automatic-mixed-precision-amp-">Faster Deep Learning Training with PyTorch â€“ a 2021 Guide</a></p>
<p></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>Volume2D Shader Pro</title>
    <url>/2021/08/02/Volume2D-Shader-Pro/</url>
    <content><![CDATA[<h1 id="volume2d-pro">Volume2D Pro</h1>
<hr>
<h2 id="i.-preface">I. Preface</h2>
<p>â€‹ è§‰å¾—ä¹‹å‰çš„ç®—æ³•å¤ªèœäº†ï¼Œåªèƒ½å¤„ç†æ–¹å½¢éšœç¢ç‰©ï¼ˆè™½ç„¶å¦‚æœè¦ç»™æˆ‘çš„æ¸¸æˆç”¨ä¹Ÿå¤Ÿäº†ï¼‰ï¼Œæ‰€ä»¥æƒ³ç€å‡çº§ä¸€ä¸‹ç®—æ³•ã€‚è¿‘æœŸå®ä¹ åˆšå¥½ä¹Ÿåšäº†ä¸€äº›ç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†å®ä¹ æœŸé—´è®¾è®¡çš„ç®—æ³•å¾ˆéš¾debugï¼ˆbugåˆ¶é€ æœºå°±æ˜¯æˆ‘ï¼‰ï¼Œåœ¨å®ä¹ æœ«æœŸé‡æ–°è®¾è®¡äº†ä¸€ä¸‹ï¼Œè§Github Repoï¼š<a href="https://github.com/Enigmatisms/Volume">[Enigmatisms/Volume]</a></p>
<video src="cv_output.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 1. ä¸è§„åˆ™éšœç¢ç‰©ä½“ç§¯å…‰ç®—æ³•æ•ˆæœ
</center>
<p>â€‹ ä¸å¾—ä¸è¯´ï¼Œå buffå¼ç¼–ç¨‹çœŸçš„å¾ˆæ¶å¿ƒï¼Œä»å®ä¹ å¼€å§‹åˆ°ç°åœ¨æˆ‘éƒ½å¤„äºå buffå¼ç¼–ç¨‹ä¸­ã€‚</p>
<details class="note primary"><summary><p>ä»€ä¹ˆå«å buffå¼ç¼–ç¨‹</p>
</summary>
<p>å buffå¼ç¼–ç¨‹æŒ‡çš„æ˜¯ç¼–å†™çš„ä»£ç ä¸èƒ½ä¸€æ¬¡æ€§é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œéœ€è¦ä¸€ç‚¹ä¸€ç‚¹æµ‹è¯•ä¹‹å‰æ²¡æœ‰è€ƒè™‘åˆ°çš„æ–¹é¢ï¼ˆå®šä¹‰æ¥è‡ª HQYï¼‰</p>

</details>
<span id="more"></span>
<hr>
<h2 id="ii.-ç®—æ³•è®¾è®¡ç®€ä»‹">II. ç®—æ³•è®¾è®¡ç®€ä»‹</h2>
<h3 id="æ•°æ®è¡¨ç¤º">2.1 æ•°æ®è¡¨ç¤º</h3>
<div class="tabs" id="two-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#two-unique-name-1">Edge</a></li><li class="tab"><a href="#two-unique-name-2">Object</a></li></ul><div class="tab-content"><div class="tab-pane active" id="two-unique-name-1"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Edge</span>: <span class="keyword">public</span> std::deque&lt;Eigen::Vector3d&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    std::pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; proj_ids;           <span class="comment">// å¾…æŠ•å½±ç‚¹çš„id</span></span><br><span class="line">    <span class="type">double</span> min_dist = <span class="number">1e9</span>;</span><br><span class="line">    <span class="type">bool</span> valid = <span class="literal">true</span>;                      <span class="comment">// æ˜¯å¦å®Œå…¨è¢«é®æŒ¡</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â€‹ Edgeæ˜¯ä¸€ä¸ªç»§æ‰¿äº†<code>std::vector&lt;Eigen::Vector3d&gt;</code>çš„ç±»ï¼Œé™¤äº†åŒ…å«vectorçš„æ‰€æœ‰ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜å®ç°äº†ä¸€äº›æ–¹æ³•ï¼Œè¯¸å¦‚<strong><u>æ—‹è½¬æ•°ç»„äºŒåˆ†æŸ¥æ‰¾</u></strong>ï¼Œå¸¦å¥‡å¼‚æ€§çš„è§’åº¦åˆ¤å®šç­‰ç­‰ã€‚Edgeå®é™…ä¸Šå°±æ˜¯æ¯ä¸€æ¡å‚ä¸æŠ•å½±çš„è¾¹ï¼Œåœ¨Edgeä¹‹ä¸Šæœ‰Objectæ¥è¿›è¡Œç®¡ç†ã€‚Edgeæ˜¯<strong><u>ä¸æ–­å¼€çš„ï¼Œé¢å‘å…‰æºçš„éšœç¢ç‰©è¾¹ç•Œéƒ¨åˆ†</u></strong>ã€‚</p>
<p>â€‹ Vector3dåœ¨æ­¤å¤„è¡¨ç¤ºçš„æ˜¯ï¼šxï¼Œyï¼Œè§’åº¦ï¼ˆç‚¹åˆ°è§‚æµ‹ç‚¹å½¢æˆçš„å‘é‡ï¼Œæ±‚åæ­£åˆ‡çš„è§’åº¦ï¼‰ã€‚</p></div><div class="tab-pane" id="two-unique-name-2"><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="keyword">using</span> HeapType = std::priority_queue&lt;<span class="type">size_t</span>, std::vector&lt;<span class="type">size_t</span>&gt;, EdgeCompFunctor&gt;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">bool</span> valid;</span><br><span class="line">    <span class="type">double</span> min_dist;</span><br><span class="line">    std::vector&lt;Edge&gt; edges;</span><br><span class="line">    std::pair&lt;<span class="type">double</span>, <span class="type">double</span>&gt; angle_range;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â€‹ Objectæ˜¯Edgeçš„é›†åˆä½“ï¼Œé™¤äº†Edgeä¹‹å¤–è¿˜å°è£…äº†ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œç”¨äºåˆ¤å®šï¼š</p>
<ul>
<li>å“ªäº›Edgeå…ˆå‚ä¸æŠ•å½±</li>
<li>å“ªäº›Edgeå®Œå…¨è¢«é®æŒ¡ç­‰ç­‰</li>
</ul>
<p>â€‹ Objectå†…éƒ¨æœ‰ä¸€ä¸ªEdgeçš„å †ï¼Œå †ç»“æ„åœ¨Volume2Dä¸­ä¹Ÿæ›¾ä½¿ç”¨ï¼Œæœ¬æ¬¡ä½¿ç”¨äº†åŒå±‚å †ï¼Œå¹¶ä¸”å †ç§°ä¸ºäº†ä¸´æ—¶å˜é‡ï¼ˆå› ä¸ºè°ƒè¯•è¿‡ç¨‹ä¸­å‘ç°å…¨å±€å †æœ‰äº›é—®é¢˜ï¼‰ã€‚</p></div></div></div>
<h3 id="è¾¹ç•Œåˆ†å‰²">2.2 è¾¹ç•Œåˆ†å‰²</h3>
<p>â€‹ ä¹‹å‰åœ¨åšç‚¹äº‘ç›¸å…³å·¥ä½œçš„æ—¶å€™ï¼ŒçŸ¥é“ï¼š</p>
<blockquote>
<p>LaserScanå†…éƒ¨çš„ç‚¹éƒ½æ˜¯å…·æœ‰æ–¹å‘æ€§çš„ï¼Œå¯æ ¹æ®ä¸¤ä¸ªç‚¹å½¢æˆçº¿æ®µçš„æ³•å‘é‡åˆ¤å®šé¢å‘æ¿€å…‰å™¨ä¸èƒŒå‘æ¿€å…‰å™¨çš„scan</p>
</blockquote>
<p>â€‹ å’ŒVolume 2Dä¸€æ ·ï¼Œæˆ‘ä¹Ÿä¸å¸Œæœ›å¤ªå¤šæ— æ•ˆçš„è¾¹ç•Œå‚ä¸æŠ•å½±è¿‡ç¨‹ï¼Œè¿›è¡Œâ€œBack Cullingâ€ç†è®ºä¸Šå¯ä»¥å‡å°‘ä¸€åŠçš„è®¡ç®—é‡ï¼ˆéšœç¢ç‰©é¢å‘ä»¥åŠèƒŒå‘å…‰æºçš„éƒ¨åˆ†æ­£å¸¸æ¥è¯´å„å ä¸€åŠï¼‰ã€‚æ•…åœ¨åšè¾¹ç•Œåˆ†å‰²æ—¶ï¼Œåªä¿ç•™é¢å‘å…‰æºè¾¹å¯¹åº”çš„ç‚¹ã€‚</p>
<p>â€‹ æ­¤å¤–ç”±äºè¾¹ç•Œæ˜¯ä½¿ç”¨vectorè¿›è¡Œé¡ºåºä¿å­˜çš„ï¼Œå­˜åœ¨ä»¥ä¸‹çš„å‡ ç§æƒ…å†µéœ€è¦è€ƒè™‘ï¼š</p>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/cases.PNG"></p>
<center>
Figure 1. ä¸‰ç§ä¸åŒçš„æƒ…å†µ
</center>
<div class="tabs" id="fourth-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#fourth-unique-name-1">æœ€ç®€å•çš„æƒ…å½¢</a></li><li class="tab"><a href="#fourth-unique-name-2">å¾ªç¯æ·»åŠ 1</a></li><li class="tab"><a href="#fourth-unique-name-3">å¾ªç¯æ·»åŠ 2</a></li></ul><div class="tab-content"><div class="tab-pane active" id="fourth-unique-name-1"><p>â€‹ æœ€ç®€å•çš„æ˜¾ç„¶å°±æ˜¯ï¼šéœ€è¦æ·»åŠ çš„è¾¹ä»front()æˆ–è€…ä¸­é—´ä½ç½®å¼€å§‹ï¼Œæœ€å¤šéœ€è¦æ·»åŠ åˆ°back()å¤„çš„ç‚¹ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç›´æ¥éå†æ·»åŠ ï¼Œæ— éœ€ä¸‹æ ‡å¾ªç¯ã€‚</p></div><div class="tab-pane" id="fourth-unique-name-2"><p>â€‹ ç¬¬äºŒç§æƒ…å†µåœ¨å¼€å§‹æ’°å†™ä»£ç æ—¶è€ƒè™‘åˆ°äº†ï¼Œè§‰å¾—å¯èƒ½ä¼šæœ‰è¿™ç§éœ€è¦ä»front()åˆ°back()å¾ªç¯è¿æ¥çš„æƒ…å†µã€‚æ‰€ä»¥ä¸€å¼€å§‹è®¾è®¡Edgeç±»å°±ä½¿ç”¨äº†åŒç«¯é˜Ÿåˆ—ï¼ˆçœŸçš„å·ç”¨ï¼‰ã€‚å› ä¸ºå·²çŸ¥ï¼šåŒä¸€ä¸ªObjectä¸Šç”±äºä¸­é—´æœ‰ä¸å¯è§†ï¼ˆèƒŒå‘å…‰æºï¼‰çš„æ®µï¼Œå¯èƒ½ä¼šå°†ä¸€æ¡å®Œæ•´çš„è¾¹ç•Œåˆ†å‰²ä¸ºè‹¥å¹²æ®µé¢å‘å…‰æºçš„edgesï¼Œé‚£ï¼šfront()å¤„åŠ å…¥çš„ç‚¹ç•™åœ¨å¯¹åº”çš„edgeç§ï¼Œè€Œback()å¯¹åº”çš„edgesåˆ™éœ€è¦åå‘åŠ å…¥åˆ°front()å¯¹åº”edgeçš„å¤´éƒ¨ã€‚ä¹Ÿå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Edge::const_reverse_iterator rit = to_add.<span class="built_in">crbegin</span>(); rit != to_add.<span class="built_in">crend</span>(); rit++)</span><br><span class="line">	front.<span class="built_in">push_front</span>(*rit);</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="fourth-unique-name-3"><p>â€‹ ç¬¬ä¸‰ç§æƒ…å†µå¼€å§‹æ²¡æœ‰è€ƒè™‘åˆ°ï¼ˆä¸å‘¨å•Šï¼‰ï¼Œå¤´éƒ¨åªæœ‰ä¸€ä¸ªç‚¹åŠ å…¥ã€‚æˆ‘çš„é€»è¾‘æ˜¯ä¸ä¼šä¿å­˜å­¤ç«‹ç‚¹çš„ï¼ˆå½¢æˆEdgeè‡³å°‘è¦ä¸¤ä¸ªç‚¹ï¼‰ï¼Œè€Œå¦‚æœfront()ç¡®å®åº”è¯¥åŠ å…¥ï¼Œä½†éå†æ—¶ï¼Œfront()è”ç³»çš„è¾¹éƒ½æ˜¯èƒŒå‘è¾¹ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé”™è¯¯åœ°ä¸¢å¼ƒfront()ã€‚æœ€åæ˜¯å¤šåŠ å…¥äº†å‡ ä¸ªåˆ¤æ–­æ‰å®Œæˆè¿™éƒ¨åˆ†ã€‚</p></div></div></div>
<h3 id="å†…å¤–æŠ•å½±">2.3 å†…å¤–æŠ•å½±</h3>
<h4 id="å†…å¤–æŠ•å½±ç®€ä»‹">2.3.1 å†…å¤–æŠ•å½±ç®€ä»‹</h4>
<p>â€‹ å·²çŸ¥ï¼Œæˆ‘çš„ç®—æ³•å¯¹äºEdgeçš„ç®¡ç†åŸºäºç±»Objectï¼Œå…¶é€»è¾‘æ˜¯ï¼š</p>
<ul>
<li>å†…æŠ•å½±ï¼šé¦–å…ˆé€‰æ‹©ç¦»å…‰æºæœ€è¿‘çš„ç‰©ä½“ï¼Œè®¡ç®—è¯¥ç‰©ä½“å†…éƒ¨çš„é®æŒ¡ï¼ˆå†…éƒ¨çš„å½¢çŠ¶å¤æ‚æ—¶ï¼‰</li>
<li>å¤–æŠ•å½±ï¼šæ­¤ç‰©ä½“å¦‚ä½•å½±å“åˆ«çš„ç‰©ä½“ï¼Œå¦‚ä½•åˆ¤å®šé®æŒ¡å…³ç³»</li>
</ul>
<p>â€‹ ä¸ºä»€ä¹ˆè¦åŒºåˆ†å†…å¤–æŠ•å½±å‘¢ï¼Ÿå†…æŠ•å½±ä¸å¤–æŠ•å½±æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿåœ¨æˆ‘æœ€åˆçš„æ„æƒ³ä¸­ï¼ŒåŒºåˆ«æŒºå¤§çš„ï¼Œä½†ä»”ç»†æ€è€ƒåå‘ç°ï¼Œå†…å¤–éƒ½ä¼šæœ‰å¦‚ä¸‹çš„æƒ…å†µå‘ç”Ÿï¼š</p>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/proj.PNG" style="zoom:67%;"></p>
<center>
Figure 2. ä¸¤ç§å†…éƒ¨é®æŒ¡æƒ…å†µ
</center>
<p>â€‹ å°¤å…¶æ˜¯ç¬¬ä¸€ç§ï¼Œå¼€å§‹æ—¶æˆ‘è®¤ä¸ºç¬¬ä¸€ç§æƒ…å†µæ˜¯ä¸ä¼šå‡ºåœ¨å†…æŠ•å½±çš„æƒ…å†µä¸­çš„ï¼Œæˆ‘å¼€å§‹è®¤ä¸ºï¼šå†…éƒ¨ä¸ä¼šæœ‰åˆ‡åˆ†ä¸€æ¡è¾¹ä¸ºä¸¤æ¡çš„æƒ…å†µã€‚ï¼ˆæˆ‘å¯¹åº”çš„åˆ‡åˆ†å‡½æ•°<code>breakEdge</code>å¼€å§‹æ˜¯ç»™å¤–éƒ¨æŠ•å½±å®ç°çš„ï¼‰ï¼Œä½†äº‹å®ä¸Šæ˜¯ï¼Œéƒ½æœ‰å¯èƒ½ã€‚</p>
<h4 id="ä¸¤ä¸ªè®¾è®¡">2.3.2 ä¸¤ä¸ªè®¾è®¡</h4>
<h5 id="proj_ids">proj_ids</h5>
<p>â€‹ proj_idsæ˜¯æ¯ä¸€ä¸ªEdgeéƒ½æºå¸¦çš„ç»“æ„ï¼Œæ˜¯ä¸€ä¸ª<code>std::pair&lt;int, int&gt;</code>ã€‚ä½¿ç”¨è¿™ä¸ªpairå¯ä»¥å¿«é€ŸæŸ¥æ‰¾ï¼Œæ­¤edgeæœ‰å“ªäº›æ˜¯éœ€è¦å‚ä¸åç»­å†…å¤–æŠ•å½±çš„ç‚¹ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/examples.PNG"></p>
<center>
Figure 3. proj_ids ä½¿ç”¨
</center>
<p>â€‹ å›¾ä¸­è“è‰²ç‚¹æ˜¯æŠ•å½±å½¢æˆçš„ç‚¹ï¼Œåœ¨åˆ¤æ–­å¤–éƒ¨é®æŒ¡æ—¶ï¼Œæ˜¾ç„¶åº”è¯¥ç”±å¤–ä¾§ç‚¹ï¼ˆæ„å‘³ç€èŒƒå›´æ›´å¤§ï¼‰æ¥è¿›è¡ŒæŠ•å½±ï¼ˆä¹Ÿå°±æ˜¯çº¢è‰²ç‚¹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè“è‰²ç‚¹åªä¿å­˜ï¼Œä¸å‚ä¸åç»­çš„æŠ•å½±ï¼Œä½†æ˜¯çº¢è‰²ç‚¹ä¸åç»­æŠ•å½±æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚è“è‰²ç‚¹ä¸å‚ä¸è®¡ç®—å¯ä»¥å‡å°‘éƒ¨åˆ†è®¡ç®—è´Ÿæ‹…ã€‚</p>
<h5 id="eigenvector3d">Eigen::Vector3d</h5>
<p>â€‹ ä¸ºä»€ä¹ˆä¸å¥½å¥½åœ°ä½¿ç”¨Eigen::Vector2dï¼Œåå€’è¦ä½¿ç”¨Vector3dï¼Œä¿å­˜ä¸€ä¸ªè§’åº¦ï¼Ÿé¦–å…ˆæˆ‘å¯¹é—®é¢˜åšäº†ä¸€ä¸ªè¿™æ ·çš„å‡è®¾ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬çš„æ¯ä¸€ä¸ªedgeï¼Œä¸Šé¢æ¯ä¸€ä¸ªç‚¹çš„è§’åº¦ï¼ˆç›¸å¯¹äºè§‚æµ‹ç‚¹çš„åæ­£åˆ‡è§’åº¦ï¼‰éƒ½ä¸åŒï¼Œå¹¶ä¸”ç”±äºåšäº†èƒŒé¢å‰”é™¤ï¼Œåœ¨éå¥‡å¼‚ï¼ˆatanå‡½æ•°è§’åº¦ä»<span class="math inline">\(-\pi\)</span>åˆ°<span class="math inline">\(\pi\)</span>çš„å¥‡å¼‚è·ƒè¿ï¼‰æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ªæŒ‰è§’åº¦é€’å¢çš„æ•°ç»„ã€‚å­˜åœ¨å¥‡å¼‚çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ªæ—‹è½¬æ•°ç»„ï¼Œfront()å¿…ç„¶å¤§äºback()</p>
</blockquote>
<p>â€‹ é¡ºåºåŒ–æˆ–è€…æ—‹è½¬é¡ºåºåŒ–çš„æ•°æ®ç»“æ„å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æˆ–æ˜¯æ—‹è½¬æ•°ç»„äºŒåˆ†æŸ¥æ‰¾ï¼Œåœ¨éšœç¢ç‰©è¡¨é¢ç‰¹åˆ«ä¸å¹³ï¼ˆæ¯”å¦‚æ¿€å…‰ç‚¹äº‘ï¼‰æ—¶ï¼Œå¯ä»¥æ˜¾è‘—åŠ å¿«äº¤ç‚¹æœç´¢é€Ÿåº¦ã€‚æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨æ—‹è½¬æ•°ç»„äºŒåˆ†æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æŠ•å½±å…³ç³»ï¼š</p>
<ul>
<li>ä¸»æŠ•å½±è¾¹srcä¸Šçš„ç‚¹ï¼Œå¦‚ä½•æŠ•å½±åˆ°è¢«æŠ•å½±è¾¹dstä¸Šï¼Œsrcçš„front() / back() è§’åº¦å¯¹åº”åˆ°dstçš„å“ªä¸¤ä¸ªç‚¹ä¹‹é—´ï¼Ÿ</li>
<li>ä½¿ç”¨è¿™ä¸¤ä¸ªç‚¹ä»¥åŠå·²çŸ¥çš„srcæŠ•å½±å…‰çº¿ï¼Œè¿›è¡Œäº¤ç‚¹è®¡ç®—</li>
</ul>
<h4 id="ä¸»è¦å‡½æ•°-projedge2edge">2.3.2 ä¸»è¦å‡½æ•° projEdge2Edge</h4>
<p>â€‹ <code>projEdge2Edge</code>æ˜¯ç”¨äºæŠ•å½±çš„ä¸»è¦å‡½æ•°ï¼Œæ­¤å‡½æ•°é€‚ç”¨äºå†…å¤–æŠ•å½±ã€‚å…¶ä¸»è¦é€»è¾‘æ˜¯ï¼š</p>
<div class="note info"><p>é¦–å…ˆè§„å®šï¼šä¸»æŠ•å½±è¾¹ï¼ˆäº§ç”Ÿé®æŒ¡çš„è¾¹ï¼‰ä¸ºsrcï¼Œdståˆ™ä¸ºè¢«é®æŒ¡çš„è¾¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸»æŠ•å½±è¾¹çš„min_distï¼ˆå†…éƒ¨ç‚¹åˆ°å…‰æºçš„æœ€å°è·ç¦»ï¼‰ä¼šæ¯”dstçš„min_distæ›´å°ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ã€‚è§ä¸‹å›¾ã€‚</p>
</div>
<center>
<img src="/2021/08/02/Volume2D-Shader-Pro/special.PNG" style="zoom:50%;">
</center>
<center>
Figure 4. æŒ‰ç…§æœ€å°è·ç¦»å»ºç«‹å †äº§ç”Ÿçš„é—®é¢˜
</center>
<p>â€‹ ä¸Šå›¾é¦–å…ˆé€‰ä¸­æ›´é•¿çš„è¾¹ï¼ˆè“è‰²çº¿è¿æ¥çš„é•¿è¾¹ï¼‰ï¼Œå› ä¸ºæœ€å°è·ç¦»é•¿è¾¹å¯¹åº”æœ€å°ï¼ˆè§‚æµ‹ç‚¹é€‰å¾—å¥½å°±ä¼šè¿™æ ·ï¼‰ã€‚é‚£ä¹ˆåœºè¾¹ä¼šå…ˆäºä¸¤ä¸ªå®é™…ä¸Šåº”è¯¥åˆ¤å®šä¸ºæ›´è¿‘çš„å°éšœç¢ç‰©è¿›è¡ŒæŠ•å½±ï¼Œè¿™æ ·å°±ä¼šå‡ºç°é—®é¢˜ã€‚æ¯”å¦‚ï¼š</p>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/Screenshot from 2021-08-02 02-13-46.png" style="zoom:60%;"></p>
<center>
Figure 5. è¾¹å¼‚å¸¸æ¶ˆå¤±é—®é¢˜
</center>
<p>â€‹ å¯èƒ½åŸå› æ˜¯ï¼Œç”±äºå¼€å§‹çš„å®ç°æ˜¯ï¼šåªè¦dståœ¨srcçš„è§’åº¦èŒƒå›´å†…ï¼ˆè§’åº¦ä¸Šå®Œå…¨è¦†ç›–ï¼‰ï¼Œé‚£ä¹ˆdstå°±ä¼šè¢«è®¾ä¸ºvalid = falseï¼ˆå®Œå…¨è¦†ç›–ä¸éœ€è¦å†æŠ•å½±ï¼‰ã€‚ä½†æ˜¯å¦‚æœsrcé€‰é”™ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸Šé—®é¢˜ã€‚</p>
<p>â€‹ æœ¬å‡½æ•°çš„é€»è¾‘ä¸ºï¼š</p>
<ul>
<li>é¦–å…ˆåˆ¤å®šsrcå¯ç”¨æŠ•å½±ç‚¹æ•°ä¸ºï¼ˆproj_idsä¸­æœ‰å¤šå°‘ä¸ªå¤§äºç­‰äº0è€…ï¼‰ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªï¼Œå¯èƒ½å‡ºç°breakEdgeçš„æƒ…å†µï¼ˆæŠ•å½±äº§ç”Ÿæ–°çš„Edgeï¼‰</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªå¯ç”¨ç‚¹ï¼Œéœ€è¦åˆ¤å®šï¼ˆå®é™…é€»è¾‘æ¯”ä¸‹é¢ç®€ä»‹çš„å¤æ‚å¾—å¤šï¼Œå› ä¸ºæƒ…å†µå¤ªå¤šäº†ï¼‰ï¼š
<ul>
<li>src / dsté¦–å°¾ä¸¤ç‚¹åˆ°è§‚æµ‹ç‚¹çš„è¿çº¿å¤¹è§’æ˜¯å¦å°äº90åº¦ï¼Ÿä¸å°äºåˆ™å¯èƒ½æ˜¯åæ–¹å‘çš„éšœç¢ç‰©ï¼Œä¸åº”è¯¥å‚ä¸</li>
<li>åˆ¤å®šsrcæ˜¯å¦å®Œå…¨è¦†ç›–dstã€‚ä¸ºäº†é¿å…atanè§’åº¦å¥‡å¼‚æ€§ï¼Œè¿™é‡Œä½¿ç”¨äº†åŸºäºå†…ç§¯çš„ç›¸å¯¹åˆ¤å®šæ–¹æ³•ã€‚å…·ä½“å®ç°ä¸è®²äº†ã€‚</li>
<li>å¦‚æœå¯èƒ½å­˜åœ¨å®Œå…¨è¦†ç›–ï¼Œéœ€è¦åå‘ç­›æŸ¥ï¼ˆæŸ¥æ‰¾dsté¦–å°¾ä¸¤ç‚¹ä¼šè¢«srcå†…éƒ¨é‚£ä¸¤å¯¹ç‚¹â€œå¤¹ä½â€ï¼‰ï¼Œå¦‚æœå­˜åœ¨è¿™æ ·çš„ç‚¹å¯¹ï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯å®Œå…¨è¦†ç›–çš„ã€‚</li>
</ul></li>
<li>æ ¹æ®è®¡ç®—ç»“æœæ±‚è§£äº¤ç‚¹ï¼ˆçœç•¥äº†å¾ˆå¤šé€»è¾‘ï¼Œä¸æƒ³è®²ï¼Œé€»è¾‘å¤ªå¤æ‚äº†ï¼ŒåŒ…æ‹¬å¥‡å¼‚å¤„ç†ï¼Œè£•é‡å¤„ç†ï¼Œä¸€äº›æ„æƒ³ä¸åˆ°çš„æƒ…å†µï¼‰</li>
</ul>
<h4 id="äº¤ç‚¹æ±‚è§£">2.4 äº¤ç‚¹æ±‚è§£</h4>
<p>â€‹ æ±‚è§£ä¸¤å¯¹ç‚¹å¯¹åº”çš„ä¸¤æ¡ç›´çº¿çš„äº¤ç‚¹ï¼Œåªéœ€è¦ä¸€äº›æ•°å­¦ä¸Šçš„å¤„ç†ã€‚é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œä¸èƒ½ä½¿ç”¨æ–œæˆªå¼ï¼Œå› ä¸º <strong><u>åœ¨æœ¬é—®é¢˜ä¸­ï¼Œå¯èƒ½å­˜åœ¨æ–œç‡æ— ç©·å¤§çš„ç›´çº¿ï¼Œå¯¼è‡´ç—…æ€</u></strong>ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬çŸ¥é“çº¿æ®µä¸Šä¸€ç‚¹å¯ä»¥ä½¿ç”¨çº¿æ®µçš„æ³•å‘é‡è¡¨ç¤ºï¼š</p>
<blockquote>
<p>ç›´çº¿ä¸Šä¸€ç‚¹(x, y)åˆ°ç›´çº¿ä¸Šå·²çŸ¥ä¸€ç‚¹<span class="math inline">\((x_0,y_0)\)</span>çš„å‘é‡ä¼šå‚ç›´äºæ³•å‘é‡</p>
</blockquote>
<p>â€‹ é‚£ä¹ˆç”±æ­¤ï¼Œäº¤ç‚¹å¯ä»¥åˆ—ä¸¤ä¸ªæ–¹ç¨‹ã€‚å‡è®¾å…‰çº¿å‘å°„ç‚¹ä¸º<span class="math inline">\((x_0, y_0)\)</span>ï¼Œäº¤ç‚¹ä½ç½®ä¸º<span class="math inline">\((x,y)\)</span>ï¼Œéšœç¢ç‰©çš„edgeså¯¹åº”ä¸¤ç‚¹ä¸º<span class="math inline">\((x_1,y_1),(x_2,y_2)\)</span>ï¼Œå…‰çº¿çš„æ–¹å‘å‘é‡ä¸º<span class="math inline">\((v_x,v_y)\)</span>é‚£ä¹ˆæœ‰ï¼š <span class="math display">\[
\begin{align}
&amp; (u_x,u_y)=(x_1-x_2,y_1-y_2) \\
&amp; (-v_y,v_x)\cdot(x-x_0,y-y_0)=0\tag{eq 1}\\
&amp; (-u_y,u_x)\cdot(x-x_1,y-y_1)=0\tag{eq 2}
\end{align}
\]</span> â€‹ ç”±(eq 1), (eq 2)ç»„æˆä¸¤ä¸ªæ–¹ç¨‹ï¼Œå¯ä»¥è§£å‡º<span class="math inline">\((x, y)\)</span>ï¼Œåªéœ€åˆ¤å®šå¯¹åº”é½æ¬¡æ–¹ç¨‹ç³»æ•°çŸ©é˜µè¡Œåˆ—å¼æ˜¯å¦å¾ˆå°ï¼ˆä¸å¯é€†ï¼‰ï¼Œå¦‚æœä¸å¯é€†ï¼Œç›´æ¥è¿”å›è¢«æŠ•å½±ç‚¹æ›´è¿‘çš„é‚£ä¸ªç‚¹ï¼Œå¦‚æœå¯é€†ï¼Œé‚£ä¹ˆè§£å‡ºçš„<span class="math inline">\((x,y)\)</span>å°±æ˜¯ç»“æœã€‚</p>
<h4 id="å…¶ä»–">2.5 å…¶ä»–</h4>
<p>â€‹ è¿˜æœ‰å¾ˆå¤šï¼é€»è¾‘æ˜¯çœŸçš„å¾ˆå¤æ‚ï¼Œæƒ…å†µå¾ˆå¤šï¼Œæˆ‘ä¸æƒ³å†™è¿™ä¸ªï¼Œè¦ä¸€ä¸€è§£é‡Šå¤ªéº»çƒ¦äº†ã€‚</p>
<hr>
<h2 id="iii.-æ•ˆæœä¸€è§ˆ">III. æ•ˆæœä¸€è§ˆ</h2>
<video src="cv_output.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 1. ä¸è§„åˆ™éšœç¢ç‰©ä½“ç§¯å…‰ç®—æ³•æ•ˆæœ
</center>
<video src="cv_output2.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 2. æ›´å¤šéšœç¢ç‰©ä¸‹çš„è¡¨ç°
</center>
<p>â€‹ è¾¹ç•Œè®¡ç®—ç»“æœä½¿ç”¨æˆªå›¾çš„æ–¹å¼è®°å½•äº†ä¸€ä¸‹ï¼š</p>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/Screenshot%20from%202021-08-02%2016-49-37.png"></p>
<center>
Figure 6. è¾¹ç•Œè®¡ç®—ï¼ˆdemo1ï¼‰ï¼Œå›¾ä¸­ç»¿è‰²ç‚¹æ˜¯è§‚æµ‹ç‚¹ï¼Œé»„è‰²æ˜¯è®¡ç®—æœ€åéœ€è¦ç»˜åˆ¶çš„è¾¹
</center>
<p><img src="/2021/08/02/Volume2D-Shader-Pro/Screenshot%20from%202021-08-02%2016-50-01.png"></p>
<center>
Figure 7. è¾¹ç•Œè®¡ç®—ï¼ˆdemo2ï¼‰ï¼Œå›¾ä¸­ç»¿è‰²ç‚¹æ˜¯è§‚æµ‹ç‚¹ï¼Œé»„è‰²æ˜¯è®¡ç®—æœ€åéœ€è¦ç»˜åˆ¶çš„è¾¹
</center>
<hr>
<h2 id="iv.-åº“çš„ä½¿ç”¨">IV. åº“çš„ä½¿ç”¨</h2>
<p>â€‹ æœ¬é¡¹ç›®å·²ç»ä¸Šä¼ è‡³Githubï¼Œè§Githubåº“<a href="https://github.com/Enigmatisms/Volume">[Enigmatisms/Volume]</a>ï¼Œé‡Œé¢æœ‰éå¸¸è¯¦ç»†çš„è¯´æ˜ï¼Œä¸è¿‡æ˜¯è‹±æ–‡çš„ã€‚æ€ä¹ˆè¯´å‘¢ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªç»å¦™çš„è§£å†³åŠæ³•ï¼Œå¯æƒœä»Šæ™šå¾ˆå›°ï¼Œå†™ä¸å®Œï¼ˆè€è´¹é©¬äº†ï¼‰ã€‚å¦‚æœæœ‰ç»†èŠ‚æ–¹é¢çš„ç–‘é—®ï¼Œæ¬¢è¿ç›´æ¥è”ç³»æˆ‘ã€‚</p>
<hr>
<h3 id="reference">Reference</h3>
<p>â€‹ å…³äº<code>EdgeCompFunctor</code>è¿™ä¸ªè¿˜æ˜¯æœ‰å¿…è¦è¯´ä¸€ä¸‹çš„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">EdgeCompFunctor</span>&#123;</span><br><span class="line">    <span class="built_in">EdgeCompFunctor</span>(<span class="type">const</span> std::vector&lt;Edge&gt;&amp; _egs): <span class="built_in">egs</span>(_egs) &#123;&#125;</span><br><span class="line">    <span class="type">const</span> std::vector&lt;Edge&gt;&amp; egs;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="type">const</span> <span class="type">size_t</span>&amp; e1, <span class="type">const</span> <span class="type">size_t</span>&amp; e2)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> egs[e1].min_dist &gt; egs[e2].min_dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â€‹ std::priority_queueæ¥æ”¶ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°ï¼Œç”±äºC++é«˜ç‰ˆæœ¬çš„åŒ¿åå‡½æ•°ç‰¹æ€§å¾ˆä¸é”™ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨åŒ¿åå‡½æ•°æ¥å¡«å……è¿™ä¸ªè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨è¾ƒä¸ºè€å¼çš„Functorå†™æ³•ã€‚è€Œæ­¤å¤„ï¼Œæˆ‘æ›´æ”¹äº†åœ¨Volume2Dç®—æ³•ä¸­ä½¿ç”¨çš„â€œä¿å­˜Edge*â€çš„å®ç°ï¼Œå› ä¸ºå·²çŸ¥ä¿å­˜åœ¨å †ä¸­çš„æŒ‡é’ˆæ²¡æœ‰åŠæ³•æ­£ç¡®æŒ‡å‘vectorã€‚åŸå› æˆ‘å“¥å·²ç»å¸®æˆ‘è§£é‡Šäº†ï¼š</p>
<blockquote>
<ul>
<li>å› ä¸ºvectorçš„å†…éƒ¨å­˜å‚¨çš„åœ°å€æ˜¯ä¼šå˜çš„</li>
<li>æ¯”å¦‚resizeçš„æ—¶å€™ å®ƒä¼šæ„é€ ä¸€ä¸ªæ–°çš„æ•°ç»„ æŠŠåŸæ¥çš„æ•°æ®å¤åˆ¶è¿›å» ç„¶åé”€æ¯ä¹‹å‰çš„æ•°ç»„ è¿™æ ·åœ°å€å°±å˜äº†</li>
<li>å¦‚æœç›´æ¥å­˜æŒ‡é’ˆ æ˜¯ä¼šå¤±æ•ˆçš„</li>
</ul>
</blockquote>
<p>â€‹ è¿™ç§æºå¸¦äº†ä¸€ä¸ªå¸¸å¼•ç”¨ï¼Œåˆå§‹åŒ–EdgeCompFunctoræ—¶éœ€è¦ä¼ å…¥edgesè¿™ä¸ªvectorå¸¸åº”ç”¨çš„å†™æ³•æ¥è‡ªäº<a href="https://stackoverflow.com/questions/8372918/c-std-list-sort-with-custom-comparator-that-depends-on-an-member-variable-for">[stackoverflow/C++ std list sort with custom comparator that depends on an member variable for the object instance]</a>ã€‚æ˜¾ç„¶ï¼Œä¿å­˜ç´¢å¼•æ¯”ä¿å­˜æŒ‡é’ˆä¼˜é›…å¤šäº†ã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>algos</tag>
      </tags>
  </entry>
  <entry>
    <title>What is &#39;snippet&#39; section?</title>
    <url>/1970/01/01/What-is-snippet-section/</url>
    <content><![CDATA[<p>Snippetæ¿å—æ˜¯ä¸“é—¨ä¸ºâ€œå°å‹åšå®¢â€è®¾ç½®çš„ï¼Œæ„åœ¨ä¿å­˜ï¼š</p>
<ul>
<li>å­—æ•°ä¸å¤šä½†æœ‰æ„Ÿè§‰éå¸¸æœ‰è®°å½•çš„å¿…è¦æ€§</li>
<li>ç®€å•æœ‰è¶£ï¼Œæ’°å†™å’Œé˜…è¯»éƒ½ä¸è´¹åŠ›</li>
<li>ä¸€äº›åŸmarkdownæ–‡æ¡£é—å¤±ã€æˆ–æ˜¯æ›´é€‚åˆä½¿ç”¨pdfå…±äº«çš„æ–‡æ¡£</li>
</ul>
<p>Enjoy and Rejoice! ------------ 2022.2.11</p>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>notification</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç¬”è®°ã€‘ä¸¤ç¯‡åŒç›®ç›¸å…³è®ºæ–‡</title>
    <url>/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/</url>
    <content><![CDATA[<h1 id="stereo">Stereo!</h1>
<hr>
<p>â€‹ æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘åœ¨äººæœºæ‰€çš„å·¥ä½œæ˜¯æåŒç›®å¼€å‘ï¼Œä½†æ˜¯å½“æ—¶è¿˜å®Œå…¨ä¸æ‡‚æ·±åº¦å­¦ä¹ ï¼Œè§‰å¾—è¿™å°±æ˜¯ä¸ªç„å­¦ç©æ„ï¼ˆäº‹å®ä¸Šæˆ‘ç°åœ¨è¿˜æ˜¯è¿™ä¹ˆè§‰å¾—ï¼Œåªä¸è¿‡æœ‰äº›ç®€å•çš„ç½‘ç»œï¼Œå…·æœ‰å¾ˆå¥½çš„ç†è®ºè§£é‡Šï¼Œæˆ‘è§‰å¾—è¿˜æŒºå¦™çš„ï¼‰ã€‚ä½†æ˜¯å½“å¹´ï¼ˆä¹Ÿå°±æ˜¯2020ï¼‰çš„KITTIæ¦œå°±å·²ç»è¢«æ·±åº¦å­¦ä¹ åˆ·çˆ†äº†å•Šï¼Œå‰100ç›®æµ‹98ä¸ªéä¼ ç»Ÿæ–¹æ³•ã€‚ç°åœ¨æˆ‘å¯¹æ·±åº¦å­¦ä¹ æœ‰äº†ä¸€å®šäº†è§£ï¼Œä¹Ÿæœ‰äº†å¾ˆå¤šå®è·µçš„ç»éªŒï¼Œæ‰€ä»¥æƒ³ç€æŒ‘æˆ˜ä¸€äº›æ›´éš¾çš„é—®é¢˜é¢†åŸŸï¼Œä¸€äº›ä¸ä¸€æ ·çš„åº”ç”¨åœºæ™¯ï¼ˆæ¯•ç«Ÿè€ç ”ç©¶å¥‡å¥‡æ€ªæ€ªçš„ç½‘ç»œç»“æ„ï¼Œå¤ç°ä¸åŒçš„CVåŸºç¡€ç½‘ç»œç»“æ„å°±è·Ÿè°ƒå‚ä¸€ç‚¹åŒºåˆ«æ²¡æœ‰ï¼‰ã€‚</p>
<p>â€‹ æœ¬æ–‡æ²¡æœ‰ä»»ä½•é™„å¸¦çš„å®ç°ï¼Œæˆ‘åªæŠŠè¿™ä¸¤ç¯‡CVPR2021è®ºæ–‡åªä½œä¸ºå›å½’åŒç›®ç ”ç©¶çš„èµ·å§‹â€œç ”è¯»æ€§â€æ–‡ç« ï¼Œä¸å°è¯•å¤ç°ï¼Œæˆ–è€…å’±ä»¬ä¸æ‰¾å€Ÿå£ï¼Œæˆ‘ä¹‹åç†è§£å¾—æ›´é€å½»å†æ¥å¤ç°ğŸ˜ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-a-decomposition-model-for-stereo-matching1">II. <strong>A Decomposition Model for Stereo Matching</strong>[1]</h2>
<p>â€‹ åŠ é€Ÿäº†ã€‚ä½œè€…èƒ½åŠ é€Ÿ10-100å€ï¼Œå¹¶ä¸”æŠŠå¤æ‚åº¦é™å¾—å¾ˆä½ï¼Œä½¿ç”¨çš„æ€æƒ³æˆ‘ä¹‹å‰æ€è€ƒè¿‡ï¼Œä½†æ˜¯æˆ‘ä¹‹å‰å¹¶ä¸çŸ¥é“æ€ä¹ˆåšï¼Œåªæ˜¯æœ‰ä¸ªç±»ä¼¼çš„æƒ³æ³•ï¼š</p>
<div class="note primary"><p>â€‹ å¦‚æœæˆ‘åªéœ€è¦åœ¨ä¸€ä¸ªè¾ƒå°çš„å›¾åƒä¸Šè¿›è¡ŒåŒç›®åŒ¹é…ï¼ˆä¸‹é‡‡æ ·å›¾åƒï¼‰ï¼Œåœ¨ä¸Šé‡‡æ ·çš„è¿‡ç¨‹ä¸­ä½¿ç”¨å¦ä¸€ä¸ªç½‘ç»œè¿›è¡Œrefineï¼Œåªéœ€è¦å¯¹éƒ¨åˆ†åƒç´ è¿›è¡Œrefineï¼Œæ˜¯ä¸æ˜¯èƒ½æé€Ÿï¼Ÿ</p>
</div>
<p>â€‹ äº§ç”Ÿè¿™ä¸ªæƒ³æ³•çš„åŸå› å¾ˆç®€å•ï¼Œä¹‹å‰åœ¨å°è¯•å­™å‰‘è€å¸ˆçš„â€œä¸Šå¤â€è®ºæ–‡ï¼ˆBPï¼‰æ—¶ï¼Œå¯¹äºæ— çº¹ç†åŒºåŸŸçš„åŒ¹é…æ•ˆæœä¸å¤ªå¥½ã€‚å¤§é¢ç§¯æ— çº¹ç†åŒºåŸŸåœ¨ä¸‹é‡‡æ ·å›¾åƒä¸­å°±åº”è¯¥è¢«è§£å†³ã€‚</p>
<h3 id="ä¸»è¦æ€æƒ³">2.1 ä¸»è¦æ€æƒ³</h3>
<p>â€‹ é¦–å…ˆæŠŠç½‘ç»œæ€»ç»“æ„æ”¾ä¸€ä¸‹ï¼š</p>
<p><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/arch.PNG"></p>
<center>
Figure 2. Decomposition model ç½‘ç»œæ¶æ„
</center>
<p>â€‹ è¯»å®Œè¿˜æ˜¯è§‰å¾—è¿™ç¯‡æ–‡ç« é‡Œæœ‰äº›<strong><u>å¾ˆé­”æ³•</u></strong>çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆä¸é”™çš„æ€æƒ³ã€‚æ–‡ç« çš„æ–¹æ³•ä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››æ­¥ï¼š</p>
<div class="note danger"><ol type="1">
<li>æœ€åº•å±‚ä½¿ç”¨full cost volumeï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯åŒç›®åŒ¹é…é‡Œé¢çš„å†…å­˜æš´åŠ›æ³•ï¼‰ä»¥åŠcost regularizationï¼ˆæ–‡ä¸­ä½¿ç”¨äº†ä¸€ä¸ªå¦‚Figure 3æ‰€ç¤ºçš„ç½‘ç»œï¼Œå¯¹cost volumeåˆé‡æ–°æ˜ å°„äº†ä¸€è¾¹ï¼‰ã€‚æ–‡ç« ç§°cost regularizationçš„ä½œç”¨æ˜¯â€œrectify cost volumeâ€ï¼Œä½†æ˜¯æˆ‘åŠå¤©æ²¡çœ‹æ˜ç™½è¿™å’Œrectifyçš„å…³ç³»ï¼ˆåŒç›®å°±æœ‰rectificationæ“ä½œï¼Œéš¾ä¸æˆæ˜¯ç”¨Conv3dåšäº†ä¸€ä¸ªæ·±åº¦rectificationï¼Ÿï¼‰ã€‚åœ¨è¿™æ ·å›ºå®šå¤§å°çš„å·¦å³è§†å›¾ä¸Šè¿›è¡Œfull cost volumeåŒ¹é…çš„å¼€é”€æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</li>
</ol>
</div>
<div class="note warning"><ol start="2" type="1">
<li>ã€ç¨€ç–çš„ã€æŸå¤±ç»†èŠ‚ã€‘ã€‘æ£€æµ‹ã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ— ç›‘ç£çš„ç½‘ç»œï¼Œè¾“å…¥æ˜¯ï¼šç‰¹å¾é‡‘å­—å¡”ä¸Šä¸€å±‚ï¼ˆç»è¿‡ä¸‹é‡‡æ ·çš„ä¸€å±‚ï¼‰çš„ç‰¹å¾å›¾çš„ä¸Šé‡‡æ ·ç»“æœï¼Œå’Œç‰¹å¾é‡‘å­—å¡”æœ¬å±‚ç‰¹å¾å›¾ã€‚æ— ç›‘ç£åœ°å­¦å‡ºå¯èƒ½å› ä¸ºä¸‹é‡‡æ ·æ“ä½œè€Œä¸¢å¤±çš„ç‰¹å¾ï¼ˆå¯¹åº”çš„positionï¼‰ã€‚æ— ç›‘ç£å­¦ä¹ ï¼Œå°±æ˜¯niceã€‚</li>
</ol>
</div>
<div class="note info"><ol start="3" type="1">
<li>ç¨€ç–åŒ¹é…ã€‚æ—¢ç„¶åœ¨ä¸Šä¸€æ­¥æ“ä½œä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¸…æ¥šæœ‰äº›åœ°æ–¹å°±æ˜¯æ²¡æœ‰åŒ¹é…å¥½ï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥æˆ‘å¯ä»¥å¯¹é‚£äº›æ²¡æœ‰åŒ¹é…å¥½çš„ã€æŸå¤±ç»†èŠ‚ã€‘è¿›è¡Œç¨€ç–çš„åŒ¹é…ã€‚ç”±äºç¨€ç–åŒ¹é…å¯¹åº”çš„ç‰¹å¾ä»¬åˆ†å¸ƒä¸è§„åˆ™å¹¶ä¸”å¤§å°ä¸å›ºå®šï¼Œä½¿ç”¨cost volumeæœç´¢å¯¹åº”çš„æ–¹æ³•æ˜¯ä¸å¥½çš„ã€‚è®ºæ–‡ä½¿ç”¨äº†ä¸€ç§agreementæ€æƒ³ï¼Œä½¿ç”¨cross correlationï¼ˆç›¸å½“äºæ‰¾åˆ°æœ€å¤§â€œå·ç§¯â€å“åº”ç‚¹ï¼‰ï¼Œè½¬æ¢ç»“æœä¸ºsoftmaxï¼Œå†æ±‚æœŸæœ›ï¼Œè¿™ä¸ªæƒ³æ³•ä¸é”™ã€‚</li>
</ol>
</div>
<div class="note success"><ol start="4" type="1">
<li>è§†å·®èåˆã€‚ä¹Ÿå°±æ˜¯ç¨€ç–è§†å·®å›¾èåˆåˆ°ç¨ å¯†è§†å·®å›¾ä¸Šçš„æ“ä½œã€‚è¿™ä¸ªæ“ä½œåˆåˆ†ä¸ºä¸¤æ­¥ï¼š</li>
</ol>
<ul>
<li>è§†å·®å›¾ä¸Šé‡‡æ ·ã€‚è¦æŠŠä¸Šä¸€å±‚è§†å·®é‡‘å­—å¡”çš„ç»“æœç”¨ä¸Šæˆ‘æ€»è¦ä¸Šé‡‡æ ·å§ï¼Œä½†æ˜¯åšå›ºå®šä¸Šé‡‡æ ·ä¸å¥½ç©ï¼Œæˆ‘ä»¬æ¥æä¸€ä¸ªCARAFE[2] ï¼Œä¸€ç§æ›´éªšçš„ä¸Šé‡‡æ ·æ–¹æ³•ï¼Œå…·æœ‰ã€content-awareã€‘èƒ½åŠ›ï¼Œå¾ˆç„ä¹å§ï¼Œè¿™ä¸ªè¿˜å¥½ã€‚æœ€ç„ä¹çš„æ˜¯å®ƒåšäº†ä¸€ä¸ªå¤§concatenationï¼ˆæˆ‘å¾ˆè®¨åŒæ— ç«¯çš„concatæ“ä½œï¼ŒæŠŠä¸ç›¸å…³çš„ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·ä¼šè®©ä¿¡æ¯å¤±å»å…¶åŸæœ‰çš„ç‰©ç†æ„ä¹‰ï¼Œè¿™æ˜¯ä¸ªäººç²—æµ…çš„è§è§£ï¼Œä¼šåœ¨ç¨åè¿›è¡Œè¯´æ˜ï¼‰ï¼Œå¯¹concatçš„ç»“æœè¿›è¡Œäº†å‡ æ¬¡å·ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªmaskï¼ˆä¹Ÿå°±æ˜¯content-awareçš„æƒé‡ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªpixel-wiseçš„æƒé‡å°†ä¸Šä¸€å±‚ä¸Šé‡‡æ ·è§†å·®å’Œæœ¬å±‚èåˆã€‚</li>
</ul>
</div>
<p><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/conv3d.PNG"></p>
<center>
Figure 3. cost regularization
</center>
<h3 id="gradient-flow">2.2 Gradient Flow</h3>
<p>â€‹ æˆ‘ä»¬éœ€è¦è€ƒè™‘æ¢¯åº¦æµçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘åˆ°åº•éœ€è¦ä¼˜åŒ–è°ï¼Ÿæˆ‘çš„lossæœ€ç»ˆä½œç”¨åœ¨å“ªäº›å•å…ƒï¼Ÿåœ¨æ²¡æœ‰çœ‹é™„å½•ä¹‹å‰ï¼Œå°±åº”è¯¥æ€è€ƒè¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>â€‹ é¦–å…ˆæˆ‘ä»¬å‘ç°ï¼Œè¿™ç¯‡æ–‡ç« ä¸æ˜¯pixel2pixelçš„åŒ¹é…ï¼Œè€Œæ˜¯ç‰¹å¾åˆ°ç‰¹å¾çš„åŒ¹é…ï¼ˆå¯èƒ½æ·±åº¦å­¦ä¹ ä¸Šäº†å°±æ˜¯è¿™æ ·çš„ï¼‰ï¼Œç‰¹å¾æå–åœ¨æ–‡ç« ä¸­è¯´çš„æ˜¯ï¼š</p>
<blockquote>
<p>As shown in Figure 2, we first use <strong><u>U-Net</u></strong> to obtain deep features Fl on each level l for the stereo matching.</p>
</blockquote>
<p>â€‹ æˆ‘å½“æ—¶ååº”äº†ä¸€ä¸‹ï¼Œä¹‹å‰è¯»è¿‡ä¸€ç¯‡åšé£æ ¼è¿ç§»çš„æ–‡ç« ï¼ˆå¯¹åº”åšå®¢<a href="https://enigmatisms.github.io/2021/04/21/CNN-Style-Transferè®ºæ–‡å¤ç°/">ã€CNN Style Transferè®ºæ–‡å¤ç°ã€‘</a>ï¼Œæˆªæ­¢åˆ°9.5æˆ‘éƒ½è¿˜æ²¡æœ‰å¡«å‘ï¼‰ï¼Œæ–‡ç« ç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„VGG-19ï¼Œå›ºå®šå‚æ•°ä¸ä¼˜åŒ–ï¼Œæå–ç‰¹å¾ã€‚æœ¬æ–‡æ˜¯è¿™æ ·å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œç‰¹å¾æå–ç½‘ç»œæ˜¯éœ€è¦è¿›è¡Œä¼˜åŒ–çš„ã€‚é‚£ä¹ˆä¸lossç›´æ¥ç›¸å…³çš„å¾…ä¼˜åŒ–å‚æ•°æœ€åé™¤äº†ç‰¹å¾æå–ç½‘ç»œä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆå—ï¼Ÿ</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/part1.PNG"></th>
<th style="text-align: center;"><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/part2.PNG"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">æ­¥éª¤II</td>
<td style="text-align: center;">æ­¥éª¤I</td>
</tr>
</tbody>
</table>
<p>â€‹ è¿™ä¸¤ä¸ªæ­¥éª¤è™½ç„¶åœ¨ç½‘ç»œä¸­ï¼Œä½†æ˜¯å…¶å‚æ•°å¹¶ä¸ç›´æ¥æ ¹æ®æ•´ä¸ªæ¶æ„å¯¹åº”çš„è¾“å‡ºä»¥åŠlossè¿›è¡Œä¼˜åŒ–ã€‚æ¯•ç«Ÿï¼š</p>
<ul>
<li>æ­¥éª¤IIå¯¹åº”çš„æ“ä½œæ˜¯è‡ªç›‘ç£çš„ï¼Œåº”è¯¥å®Œå…¨å¯ä»¥ç‹¬ç«‹è®­ç»ƒ</li>
<li>æ­¥éª¤Iä¹Ÿæ˜¯å¯ä»¥ç‹¬ç«‹çš„ï¼ˆçœ‹å®ç°ï¼‰ï¼Œå‡å¦‚ä½¿ç”¨çš„æ–¹æ³•æ˜¯ç‹¬ç«‹äºè¾“å…¥çš„ä¼ ç»Ÿcost volumeæ³•ï¼Œé‚£å®Œå…¨å¯ä»¥ã€‚å¦åˆ™çš„è¯å¯èƒ½ä¼šæ”¶åˆ°U-Netè¾“å‡ºçš„å½±å“ï¼Œå†…éƒ¨çš„å‚æ•°ä¹Ÿéœ€è¦å‚ä¸ä¼˜åŒ–ã€‚</li>
</ul>
<p>â€‹ åœ¨é™„å½•ä¸­ï¼Œä½œè€…ä¸»è¦è®¨è®ºçš„æ˜¯U-Netç”Ÿæˆçš„ç‰¹å¾å›¾ä½œä¸ºè‡ªå˜é‡æ—¶çš„æ±‚å¯¼ã€‚</p>
<h3 id="ä¸€äº›é—®é¢˜">2.3 ä¸€äº›é—®é¢˜</h3>
<h4 id="detailed-loss-detection">2.3.1 Detailed Loss Detection</h4>
<p>â€‹ æ— ç›‘ç£çš„losså¬èµ·æ¥å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘æ€»æ„Ÿè§‰ä½œè€…ç”¨å­¦ä¹ çš„æ–¹å¼è§£å†³äº†ä¸€ä¸ªNP-hardçš„é—®é¢˜ï¼ˆåº”è¯¥æ˜¯NP-hardï¼‰ï¼Œæˆ‘ç”šè‡³æœ‰ç‚¹æ€€ç–‘å¯è¡Œæ€§ï¼ˆè™½ç„¶æˆ‘åœ¨RMç¯æ¡æ£€æµ‹é‡Œé¢ä¹Ÿè¿™ä¹ˆå¹²è¿‡ï¼‰ã€‚</p>
<p>â€‹ å¦‚æœéœ€è¦äººå·¥æ ‡æ³¨lost detail maskçš„è¯ï¼Œé‚£å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä½œè€…å¸Œæœ›ä½¿ç”¨è¿™æ ·ä¸€ä¸ªæ— ç›‘ç£lossï¼Œä½¿å¾—ä¸¤ä¸ªé›†åˆçš„å·®å¼‚æœ€å¤§ï¼š<strong><u>å±äºlost detailçš„ç‰¹å¾ç‚¹é›†åˆï¼ˆAï¼‰ ä¸ ä¸å±äºå‰ä¸€ä¸ªé›†åˆçš„ç‰¹å¾ç‚¹é›†åˆï¼ˆBï¼‰</u></strong>ï¼ˆæ˜¯ä¸€ä¸ªè¦†ç›–ï¼‰</p>
<p>â€‹ å·®å¼‚ä½“ç°åœ¨ï¼šé›†åˆAçš„å¹³å‡ç‰¹å¾è¯¯å·®åº”è¯¥è¾ƒå¤§ï¼ˆä½ç²¾åº¦ä¸Šé‡‡æ ·åæ— æ³•æ¢å¤çš„åŒºåŸŸï¼‰ï¼Œé›†åˆBçš„å¹³å‡ç‰¹å¾è¯¯å·®å°ã€‚é‚£ä¹ˆä½œè€…ä½¿ç”¨äº†è¿™ä¸ªlossï¼š <span class="math display">\[
\begin{equation}\label{dld}
\mathcal{L}^{DLD}=|FA_l|-\alpha\frac{\sum_{(h,w)\in FA_l}\Vert F_l(h, w)-F_{l-1}&#39;(h,w)\Vert_2}{\vert FA_l \vert}
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(FA_l\)</span>ä¸ºç‰¹å¾é‡‘å­—å¡”ç¬¬lå±‚çš„fine-grainedï¼ˆç»†ç²’åº¦ï¼‰ç‰¹å¾ï¼Œ<span class="math inline">\(F_{l-1}&#39;\)</span>åˆ™æ˜¯ä¸Šé‡‡æ ·çš„ä¸Šä¸€å±‚ç‰¹å¾ã€‚è¿™ä¸ªå¼å­éå¸¸å®¹æ˜“ç†è§£ï¼Œä½†æ˜¯... ä»ä¸€ä¸ªé›†åˆä¸­æŒ‘é€‰ä¸€ä¸ªå­é›†ä½¿å¾—å¯¹äºè¿™ä¸ªé›†åˆå’Œå­é›†å®šä¹‰çš„æŸä¸ªæŸå¤±æœ€å°ï¼Œæ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªNP-hardçš„é—®é¢˜ï¼Œæ¯•ç«Ÿæš´åŠ›ç©·ä¸¾ä¹‹å¤–è²Œä¼¼æ²¡æœ‰åˆ«çš„æ–¹æ³•ã€‚å¹¶ä¸”ï¼Œåœ¨è¿™é‡Œä¼˜åŒ–é—®é¢˜é‡åˆ°çš„æ˜¯ <u><strong>åˆ†æ”¯çš„å¤„ç†</strong></u>ï¼Œæˆ‘ä¼˜åŒ–çš„æ˜¯ä¸€ä¸ªå†³ç­–ï¼Ÿï¼ˆåº”ä¸åº”è¯¥è®¤ä¸ºè¿™ä¸ªç‰¹å¾å±äº<span class="math inline">\(FA_l\)</span>ï¼‰ï¼Œæˆ‘è®°å¾—å¥½åƒTFç”±äºæ˜¯é™æ€å›¾çš„ç¼˜æ•…ä¸æ–¹ä¾¿è®¾ç½®åˆ†æ”¯ï¼Ÿå¦ä¸€æ–¹é¢ï¼Œæˆ‘åˆè§‰å¾—è§£å†³æ–¹æ¡ˆå¯èƒ½ç±»ä¼¼åˆ†ç±»é—®é¢˜ï¼Œè¾“å‡ºæ˜¯æ¨¡æ‹Ÿçš„ï¼Œä½†æ˜¯è®¡ç®—cross entropy lossçš„æ—¶å€™è½¬æ¢æˆäº†longå‹ï¼ˆç¡¬çš„ï¼‰çš„indexã€‚</p>
<h4 id="sparse-matching">2.3.2 Sparse Matching</h4>
<p>â€‹ è¿™ä¸ªæƒ³æ³•æˆ‘è§‰å¾—è¿˜æŒºä¸é”™çš„ã€‚æˆ‘å¾—åˆ°å·¦å³è§†å›¾çš„lost detailsï¼Œç°åœ¨è¦è¿›è¡ŒåŒ¹é…äº†ã€‚ç”±äºocclusionå­˜åœ¨ä¸€å®šä¸€è‡´æ€§ï¼ˆå¹¶ä¸”ç”±äºå­˜åœ¨å¯¹æçº¦æŸï¼‰ï¼Œè¿˜æ˜¯å¯ä»¥å°†lost detailsåœ¨ä¸€ä¸ªæ–¹å‘å·¦å³æ»‘åŠ¨ã€‚é‚£ä¹ˆå¯¹äºè¿™æ ·çš„ï¼šä¸¤ä¸ªä¿¡å·æ»‘åŠ¨æ±‚æœ€å¤§åŒ¹é…çš„é—®é¢˜ï¼Œæ˜¾ç„¶å¯ä»¥ä½¿ç”¨cross correlationã€‚ä½œè€…ç”±æ­¤äº§ç”Ÿäº†ä¸€ä¸ªä¸‰ç»´ç©ºé—´çš„æ¦‚ç‡volumeï¼ˆæ³¨æ„ä¸æ˜¯åˆ†å¸ƒï¼Œå› ä¸ºè¿™æ˜¯æŒ‰ç…§ç¬¬ä¸‰ä¸ªç»´åº¦ä¹Ÿå°±æ˜¯disparityå½’ä¸€åŒ–çš„ï¼‰ã€‚ <span class="math display">\[
\begin{align}
&amp; P_l(h,w,d)=\frac{e^{C_l(h,w,d)-C_l^{max}(h,w)}}{\sum_{d=0}e^{C_l(h,w,d)-C_l^{max}(h,w)}}\\
&amp; C_l(h,w,d)=\text{cross correlation}(F_{\text{left}}(h,w),F_{\text{right}}(h,w-d))\\
&amp; C_l^{max}(h,w)=\max_d C_l(h,w,d)
\end{align}
\]</span> â€‹ æœ€åï¼Œæ¯ä¸ªç¨€ç–ç‚¹çš„è§†å·®å°±ç”±æœŸæœ›å†³å®šäº†ï¼ˆä½œè€…ä¸ºä»€ä¹ˆæŠŠè¿™ä¸ªå«åšregressï¼Ÿï¼‰ <span class="math display">\[
\begin{equation}\label{reg}
\hat{D}_l(h,w)=\sum_{d=0}P_l(h,w,d)\times d
\end{equation}
\]</span></p>
<h4 id="supervised-loss">2.3.3 Supervised Loss</h4>
<p>â€‹ ç®€å•åœ°æä¸€ä¸‹è®ºæ–‡ä½¿ç”¨çš„æœ‰ç›‘ç£lossã€‚æ— ç›‘ç£lossåœ¨lost detail detectioné˜¶æ®µä½¿ç”¨äº†ï¼Œç”¨äºåˆ¤å®šå“ªäº›æ˜¯ä¸¢å¤±ç»†èŠ‚ï¼Œè§å…¬å¼<span class="math inline">\(\eqref{dld}\)</span>ã€‚è€Œè®¡ç®—è§†å·®å›¾çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ç‰¹å¾æå–ç½‘ç»œï¼ŒFusionç½‘ç»œï¼Œåº•å±‚full cost volumeå¯¹åº”çš„ç½‘ç»œéœ€è¦è®­ç»ƒï¼Œè¿™äº›éƒ½æ˜¯åŸºäºdisparityçœŸå€¼è®­ç»ƒçš„ã€‚</p>
<p>â€‹ å¤šå±‚çš„disparityå°±éœ€è¦ç”¨åˆ°å¤šå±‚çš„çœŸå€¼ï¼Œé‚£ä¹ˆå¤šå±‚çœŸå€¼å¯ä»¥ä½¿ç”¨é™é‡‡æ ·æ¥å¾—åˆ°ã€‚ç„¶åä½œè€…ä½¿ç”¨äº†ä¸€ç³»åˆ—çš„smooth L1 Lossã€‚å¥½ç„ä¹å“¦ï¼Œå®é™…ä¸Šå°±æ˜¯Huber Lossã€‚</p>
<hr>
<h2 id="iii.-smd-nets-stereo-mixture-density-networks3">III. SMD-Nets: Stereo Mixture Density Networks[3]</h2>
<p>â€‹ ä¸ªäººè®¤ä¸ºè¿™ç¯‡æ–‡ç« æ²¡æœ‰é‚£ä¹ˆé­”æ³•ï¼Œè¯»èµ·æ¥è§‰å¾—è¿˜æŒºæœ‰é“ç†çš„ã€‚æœ€ä¸»è¦çš„æ€æƒ³å°±æ˜¯ï¼šä½¿ç”¨åŒæ¨¡æ€æè¿°ç»“æœã€‚ä¹‹å‰è¯»çš„å¯¹æ¯”å­¦ä¹ ç›¸å…³çš„æ–‡ç« ï¼Œé‡Œé¢å°±æåˆ°è¿‡ä¸åŒçš„æ¨¡æ€æ•°çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>å•æ¨¡æ€ï¼šè®¡ç®—ååˆ†æ–¹ä¾¿ï¼Œå»ºæ¨¡ç®€å•ï¼Œå¹¶ä¸”ä¹Ÿå…·æœ‰å¹¿æ³›çš„åº”ç”¨èŒƒå›´ï¼Œä½†è¡¨å¾èƒ½åŠ›æœ‰é™ã€‚</li>
<li>å®Œå…¨ç”Ÿæˆå¼æ¨¡å‹ï¼ˆç»ˆæå¤šæ¨¡æ€ï¼‰ï¼šè¡¨å¾èƒ½åŠ›æå…¶å¼ºï¼Œä½†æ˜¯è®¡ç®—é‡ä¸€èˆ¬éƒ½å¾ˆå¤§ï¼ˆæ¯”å¦‚å¯¹æŠ—ç½‘ç»œï¼‰</li>
<li>æ¨¡æ€æ•°å°‘ä¸€äº›çš„å¤šæ¨¡è¡¨å¾ï¼šæŠ˜è¡·ã€‚</li>
</ul>
<p>â€‹ æœ¬æ–‡ä½¿ç”¨åŒæ¨¡æ€æè¿°å‰æ™¯å’ŒèƒŒæ™¯ï¼Œå¹¶ä¸”ç½‘ç»œç»“æ„ / è¾“å…¥ä¸é‚£ä¹ˆé­”æ³•ï¼Œä¹Ÿå…·æœ‰ä¸€å®šçš„è¶…åˆ†è¾¨ç‡èƒ½åŠ›ï¼ˆè™½ç„¶æ„Ÿè§‰æ–¹æ³•æœ‰ç‚¹æ™®é€šï¼Ÿï¼‰ã€‚</p>
<p><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/smd.PNG"></p>
<center>
Figure 4. SMD-Netsçš„ç½‘ç»œç»“æ„
</center>
<h3 id="ä¸»è¦æ€æƒ³-1">3.1 ä¸»è¦æ€æƒ³</h3>
<p>â€‹ ä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<p><span id="quest"></span></p>
<div class="note danger"><ol type="1">
<li>å‰ç«¯ä½¿ç”¨äº†ä¸€ä¸ªç»å…¸çš„åŒç›®è§†è§‰ç½‘ç»œä½œä¸ºéª¨æ¶ï¼Œç”¨äºæå–ç‰¹å¾ã€‚å°±å¦‚Figure 4æœ€å·¦è¾¹ï¼Œå…ˆä¸‹é‡‡æ ·å†ä¸Šé‡‡æ ·çš„å…¸å‹ç»“æ„ï¼ˆå¸¸ç”¨äºSemantic/Detection/Mono/Stereoï¼‰ã€‚æˆ‘ä¸æ˜¯ç‰¹åˆ«äº†è§£è¿™ä¸ªç½‘ç»œæå–å‡ºæ¥çš„ç‰¹å¾æ˜¯å¦ä¸åŸè¾“å…¥å›¾åƒä¿æŒäº†ç©ºé—´ä¸€è‡´æ€§ï¼Œè™½ç„¶å·ç§¯å¯èƒ½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†å…·ä½“æ˜¯å¦‚ä½•ä¿è¯çš„ã€ä¸€ä¸ªç‰¹å®šåŒºåŸŸã€‘å¯¹åº”çš„ã€ç‰¹å¾å›¾å…ƒç´ ã€‘ä¸€å®šåœ¨ç‰¹å¾å›¾å¯¹åº”çš„ä½ç½®ä¸Šï¼Ÿè€Œä¸”çœ‹èµ·æ¥ï¼Œæ·±åº¦å­¦ä¹ çš„å¼•å…¥äº§ç”Ÿäº†å¾ˆå¤šç‰¹å¾-ç‰¹å¾åŒ¹é…çš„æ–¹æ³•ã€‚</li>
</ol>
</div>
<p></p>
<div class="note warning"><ol start="2" type="1">
<li>è¶…åˆ†è¾¨ç‡ï¼šæ’å€¼æ“ä½œï¼Œæ’å€¼æ“ä½œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿå¾—åˆ°ä»»æ„ç²¾åº¦ä½ç½®çš„ç‰¹å¾å‘é‡ã€‚ä¸ªäººå¯¹äºç¬¬äºŒæ­¥çš„ç†è§£æ˜¯ï¼Œä½œè€…å¯¹äºæ¯ä¸€ä¸ªç‚¹éƒ½è®¡ç®—äº†åŒæ¨¡æ€åˆ†å¸ƒçš„å‚æ•°ï¼Œå½¢æˆäº†ä¸€ä¸ªåŒæ¨¡æ€åˆ†å¸ƒçš„äºŒç»´ç»“æ„ï¼ˆå›¾åƒï¼‰ã€‚å¯¹æ¯ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œéƒ½è¿‡ä¸€éMLPï¼Œæœ€åå¾—åˆ°äº”ä¸ªå‚æ•°:</li>
</ol>
<ul>
<li><span class="math inline">\((\mu_1,b_1),(\mu_2,b_2)\)</span>æ˜¯åˆ†å¸ƒçš„å‡å€¼ï¼ˆæœŸæœ›ï¼‰ä¸ä¸ç¡®å®šåº¦</li>
<li><span class="math inline">\(\pi\)</span>æ˜¯ä¸¤ä¸ªæ¨¡æ€çš„é€‰æ‹©å‚æ•°ï¼ˆç›¸å½“äºå‰æ™¯èƒŒæ™¯maskï¼‰</li>
</ul>
</div>
<div class="note info"><ol start="3" type="1">
<li>è¾“å‡ºï¼šæ ¹æ®æ¨¡æ€é€‰æ‹©å‚æ•°ï¼Œä»ä¸¤ä¸ªæ¨¡æ€ä¸­çš„å‡å€¼ä¸­é€‰æ‹©å¯¹åº”çš„è§†å·®å€¼ã€‚</li>
</ol>
</div>
<h3 id="some-points">3.2 Some points</h3>
<p>â€‹ è¿™ç¯‡è®ºæ–‡æˆ‘å€’æ˜¯æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æƒ³è¯´çš„ï¼Œæ„Ÿè§‰æƒ³æ³•å€’æ˜¯æŒºç®€å•çš„ï¼ˆç®€å•ä¸ä»£è¡¨æˆ‘èƒ½ä¸€ä¸‹æƒ³åˆ°ï¼‰ã€‚è™½ç„¶æˆ‘ä¸ªäººå­˜åœ¨ä¸€äº›ç–‘é—®ï¼Œæ„Ÿè§‰ä½œè€…ä¹Ÿæ²¡æœ‰è§£é‡Šæ¸…æ¥šï¼ˆè¦æ€ªå°±æ€ªç¥ç»ç½‘ç»œä¸å¯è§£é‡Šï¼Ÿï¼‰ï¼š</p>
<ul>
<li>å‰æ™¯(foreground)ä¸èƒŒæ™¯(background)çš„åŒºåˆ«åœ¨å“ªï¼Ÿdisparityæ˜æ˜¾å¾ˆå¤§çš„å«foregroundï¼ˆè™½ç„¶æˆ‘æ„Ÿè§‰ä½œè€…å°±æ˜¯å«ç€ç©çš„ï¼‰ï¼Ÿä½œè€…æ›´è¢«æ²¡æœ‰è¯´ä¸¤ä¸ªmodeçš„ç”Ÿæˆæ–¹å¼æœ‰ä½•ä¸åŒã€‚ä¸ºä»€ä¹ˆèƒ½æ°å¥½äº§ç”Ÿè¿™ç§ï¼Œåœ¨å…³é”®åŒºåŸŸæœ‰äº’è¡¥æ€§çš„ä¸¤ä¸ªæ¨¡æ€å‘¢ï¼Ÿåˆä¸ºä»€ä¹ˆåªä½¿ç”¨ä¸¤ä¸ªæ¨¡æ€å‘¢ï¼Ÿ</li>
<li>å½“ç„¶ï¼Œè¿™ç¡®å®å¯ä»¥ç”¨ä¸å¯è§£é‡Šæ€§æ¥è¯´ã€‚æ¯•ç«Ÿåƒ<span class="math inline">\(\pi\)</span>è¿™ç§å­¦å‡ºæ¥çš„ä¸œè¥¿ï¼ŒçœŸçš„å°±è¯´ä¸æ¸…æ¥šå…¶æ·±å±‚æ¬¡çš„åŸç†...</li>
</ul>
<p>â€‹ å¦å¤–ï¼Œæˆ‘ä¸çŸ¥é“åˆ«çš„ç½‘ç»œæ˜¯å¦è¿›è¡Œç¨ å¯†çš„è®­ç»ƒï¼Œæœ¬æ–‡ä¸­ï¼Œç½‘ç»œå¹¶ä¸è¿›è¡Œç¨ å¯†çš„disparityè®­ç»ƒï¼ˆå¯ä»¥è¯´æ˜¯åŠç¨ å¯†ï¼Ÿï¼‰ã€‚é¦–å…ˆå¯¹ç”Ÿæˆå¥½çš„ç‰¹å¾å›¾è¿›è¡Œé‡‡æ ·ï¼Œå¯¹é‡‡æ ·å¾—åˆ°çš„ï¼ˆç¨å¾®ç¨€ç–ä¸€äº›ï¼‰ç‚¹è¿›è¡Œè®­ç»ƒã€‚ç”±äºä½œè€…éœ€è¦æ›´å¤šåœ°èšç„¦äºè¾¹ç¼˜ç‚¹çš„å¤„ç†ï¼Œæ‰€ä»¥ä½œè€…ä½¿ç”¨äº†ä¸€ç§ä¸åŒçš„é‡‡æ ·æ–¹æ³•ï¼š</p>
<ul>
<li>ç”Ÿæˆè¾¹ç¼˜ç‚¹maskï¼Œå…·ä½“çš„æ–¹å¼ä¹Ÿå°±æ˜¯ï¼šé¦–å…ˆæ£€æµ‹æ·±åº¦ä¸è¿ç»­ç‚¹ï¼ˆæ ¹æ®4-è¿é€šæ€§ï¼‰ï¼Œå¯¹æ£€æµ‹ç»“æœè¿›è¡Œè†¨èƒ€
<ul>
<li>åœ¨è¾¹ç¼˜ç‚¹maskå†…é‡‡æ ·ä¸€åŠçš„ç¨€ç–è®­ç»ƒç‚¹æ ·æœ¬</li>
</ul></li>
<li>åœ¨å…¨å›¾çš„éè¾¹ç¼˜ç‚¹åŒºåŸŸè¿›è¡Œå‡åŒ€çš„é‡‡æ ·ï¼Œé‡‡æ ·å¾—åˆ°å¦ä¸€åŠæ ·æœ¬ã€‚</li>
</ul>
<p>â€‹ æ•´ä¸ªæ¡†æ¶æ˜¯æœ‰ç›‘ç£çš„ï¼Œå¹¶ä¸”æ²¡æœ‰é‡‘å­—å¡”ç»“æ„ã€‚å…¶ä½¿ç”¨çš„backboneæ¨¡å‹ï¼ŒPSMå†…éƒ¨ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªå¤§çš„cost volumeçš„ã€‚</p>
<hr>
<h2 id="iv.-dlç«‹ä½“åŒ¹é…">IV. DLç«‹ä½“åŒ¹é…</h2>
<p>â€‹ æ·±åº¦å­¦ä¹ ç”¨åœ¨ç«‹ä½“åŒ¹é…ä¸­ï¼ŸçŸ¥é“èƒ½ç”¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼ŸåŸºäºç‰¹å¾å‘é‡çš„åŒ¹é…çš„æµç¨‹å…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®Œå…¨ä¸çŸ¥é“äº†ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè¡¥å……ä¸€ç¯‡ç»¼è¿°æ€§è®ºæ–‡[4]ï¼Œå¸®è‡ªå·±è¡¥ä¸€è¡¥é¢†åŸŸçŸ¥è¯†ã€‚åªä¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« åŒ…å«äº†å¾ˆå¤šæ–¹æ³•ï¼Œæˆ‘åœ¨æ­¤åªè®¨è®ºåŸºç¡€çš„DL-basedæ–¹æ³•ã€‚</p>
<h3 id="pipeline">4.1 Pipeline</h3>
<p>â€‹ ä¸»è¦æµç¨‹ä»ç„¶å¤§ä½“ç›¸åŒï¼š</p>
<p><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/flow.PNG"></p>
<center>
Figure 5. åŒç›®é…å‡†ç½‘ç»œä¸€èˆ¬çš„æµç¨‹
</center>
<p>â€‹ é‚£ä¹ˆå…¸å‹çš„å‡ ä¸ªç½‘ç»œç»“æ„ï¼Œè®ºæ–‡ä¹Ÿè´´å¿ƒåœ°åˆ—äº†å‡ºæ¥ï¼ˆè¿™ç¯‡è®ºæ–‡çœŸçš„å¾ˆé€‚åˆå…¥é—¨äº†è§£è¡Œä¸šå•Šï¼‰ï¼š</p>
<p><img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/nets.PNG"></p>
<center>
Figure 6. åŒç›®é…å‡†ç½‘ç»œçš„ä¸€äº›å…¸å‹ç»“æ„
</center>
<p>â€‹ è§†å·®å›¾ç”Ÿæˆç½‘ç»œçš„è®­ç»ƒè¾“å…¥å¯ä»¥é€šè¿‡é‡‡æ ·è€Œæ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥å·ç§¯è€Œæ¥ã€‚</p>
<ul>
<li>é‡‡æ ·çš„æ–¹æ³•æ˜¯ï¼šåœ¨è¾“å…¥å›¾åƒä¸­å‡åŒ€â€œæ’­æ’’â€ä¸€äº›ç‚¹ï¼ˆå¯¹åº”äºä¸€ç§ç¨€ç–çš„è®­ç»ƒæ–¹å¼ï¼‰ï¼Œåˆ‡å–ç‚¹ä»¥åŠå…¶é¢†åŸŸçš„ä¿¡æ¯ä½œä¸ºå¯¹åº”è§†å›¾çš„è¾“å…¥ã€‚å¦‚æœæ˜¯æœ‰ç›‘ç£çš„ç»“æ„ï¼Œé‚£ä¹ˆå°±åœ¨å¦ä¸€ä¸ªè§†å›¾ä¸­æŸ¥æ‰¾ï¼š
<ul>
<li>disparityå›¾çœŸå€¼å¯¹åº”ä½ç½®çš„patchï¼ˆä½œä¸ºæ­£æ ·æœ¬ï¼‰</li>
<li>å…¶ä»–disparityå€¼å¯¹åº”çš„patchä½œä¸ºè´Ÿæ ·æœ¬</li>
</ul></li>
<li>ç›´æ¥å·ç§¯ï¼šæ¯ä¸ªç‚¹å¯¹åº”çš„å·ç§¯è¾“å‡ºå°±å·²ç»æ˜¯ç‰¹å¾äº†ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•å¦‚ä½•ä¿è¯å·¦å³ç‰¹å¾ä¸€è‡´ï¼Ÿä¸€ç§ç®€å•çš„æƒ³æ³•å°±æ˜¯ç›´æ¥å…±ç”¨å®Œå…¨ç›¸åŒçš„encoderï¼ˆå­ªç”Ÿç½‘ç»œï¼‰ã€‚</li>
<li>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡ç‰¹å¾æè¿°ï¼Œç›´æ¥ç«¯åˆ°ç«¯ç”Ÿæˆä¸€ä¸ªcostå‡ºæ¥</li>
</ul>
<p>â€‹ è¿™ç§åŸºäºDLç‰¹å¾çš„æè¿°ï¼Œå®é™…ä¸Šæ˜¯å¯¹äººå·¥æè¿°å­çš„å‡çº§ï¼Œå·ç§¯æ“ä½œå¯¹æ¯ä¸ªç‚¹éƒ½ä¼šæœ‰ä¸ªç‰¹å¼‚çš„è¡¨å¾è¾“å‡ºï¼Œå‡è®¾æˆ‘ä»¬çš„å·ç§¯å°±æ˜¯å¥‡æ•°å¤§å°çš„kernelå¹¶ä¸”ä»¥å…¶ä¸­å¿ƒä¸ºanchorï¼Œé‚£ä¹ˆåœ¨(x,y)ä½ç½®çš„å·ç§¯æ˜¾ç„¶å°±ä¼šå¾—åˆ°ä»¥(x,y)ä¸ºä¸­å¿ƒçš„é¢†åŸŸç‰¹å¾æè¿°ï¼Œèƒ½ä¿è¯<a href="#quest">[3.1ä¸­(1)é‡Œæå‡ºé—®é¢˜çš„è§£å†³]</a>ã€‚è¿™ä¸€ç¯èŠ‚ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¸æ˜¯åªå¾—åˆ°ç‰¹å¾ï¼ˆç„¶åç¥å¥‡æµ·èºï¼šä»€ä¹ˆä¹Ÿä¸åšï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨ç‰¹å¾æ¥è¡¡é‡ä¸¤ä¸ªåƒç´ ä½ç½®æ˜¯å¦å­˜åœ¨å…³ç³»ï¼Œæ¯”å¦‚ä½¿ç”¨L1æˆ–è€…L2è·ç¦»æ¥åˆ¤å®šç‰¹å¾çš„ç›¸ä¼¼åº¦ï¼Œè¶Šç›¸ä¼¼è¯´æ˜ä¸¤ä¸ªä½ç½®åŒ¹é…åº¦è¶Šé«˜ã€‚</p>
<p>â€‹ æ ¹æ®losså‡½æ•°å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªcost volumeï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘åªè®¨è®º3D cost volumeã€‚3D cost volumeæ¯ä¸€ä¸ª(x, y)ä½ç½®éƒ½å¯¹åº”äº†ä¸€ä¸²å¯èƒ½åŒ¹é…çš„costï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æˆ‘ä»¬é€‰å®šçš„ç­–ç•¥æ¥è®¡ç®—ä¸€ä¸ªæœ€å¥½çš„disparityã€‚æ–¹æ³•æœ‰å¾ˆå¤šã€‚æˆ‘ç¡®å®æ˜¯å¼€äº†çœ¼äº†ï¼Œå­¦åˆ°äº†ï¼Œè§ä¸‹ä¸€å°èŠ‚ã€‚</p>
<h3 id="cost-volume-regularization">4.2 Cost Volume Regularization</h3>
<p>â€‹ æœ‰äº†cost volumeä¹‹åï¼Œç´§æ¥ç€å°±è¦è¿›è¡Œ<strong><u>cost volume regularization</u></strong>ã€‚ä½†æ˜¯è¿™æ˜¯ä¸ªä»€ä¹ˆæ“ä½œï¼Œä¸regularizationåˆæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>â€‹ æˆ‘ä»¬çŸ¥é“ï¼Œæ­£åˆ™åŒ–ï¼ˆregularizationï¼‰åœ¨æ·±åº¦å­¦ä¹ ä¸­æ˜¯è¢«ç”¨æ¥é˜²æ­¢è¿‡æ‹Ÿåˆçš„ï¼Œå› ä¸ºå¼•å…¥æ­£åˆ™åŒ–æƒ©ç½šä¹‹åï¼ŒåŸæœ¬èµ·ä¼ä¸å¹³çš„è¶…å¹³é¢ï¼Œä¼šå˜å¾—å¹³æ»‘ã€‚è¿™æ˜¯å› ä¸ºæ­£åˆ™åŒ–é¡¹è¦ä¹ˆé™åˆ¶äº†æè¿°è¶…å¹³é¢çš„å‚æ•°ä¸ªæ•°ï¼Œè¦ä¹ˆé™åˆ¶äº†å…¶å–å€¼ï¼Œä½¿ä¹‹æè¿°åŠ›ä¸‹é™ï¼ˆä¸é‚£ä¹ˆæ´»è·ƒï¼‰ã€‚ä¹Ÿå°±å¯ä»¥è®¤ä¸ºï¼Œæ­£åˆ™åŒ–é¡¹<span class="math inline">\(\approx\)</span>å¹³æ»‘é¡¹ã€‚</p>
<p>â€‹ å·§äº†ï¼ŒåŒç›®è§†è§‰é€šå¸¸ä¹Ÿæœ‰å¹³æ»‘é¡¹ï¼ˆè™½ç„¶æˆ‘æ„Ÿè§‰SMD-Netsä¸€å®šç¨‹åº¦ä¸Šåœ¨é„™è§†å¹³æ»‘å‡è®¾ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›ç½‘ç»œçš„è¾“å‡ºä¸è¦é‚£ä¹ˆèµ·ä¼ä¸å¹³çš„ï¼Œä¸€ä¸ªæ·±åº¦å·®ä¸å¤šçš„å¹³é¢å°±ä¸è¦å› ä¸ºå™ªå£°è€Œæœ‰å¤ªå¤§çš„å°èŒƒå›´æ³¢åŠ¨äº†å§ã€‚æ‰€ä»¥éœ€è¦æ–½åŠ å¹³æ»‘é¡¹ï¼Œå½“ç„¶è¿˜å­˜åœ¨ä¸€äº›å…¶ä»–çš„çº¦æŸé¡¹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>(x, y)å·²çŸ¥ä¸(x+d, y)å®Œç¾é…ä¸Šäº†ï¼Œé‚£ä¹ˆ(x+1, y) å¯¹åº”çš„è§†å·®å¿…å®šä¸å¯èƒ½å°äºd-1ï¼ˆå³è§†å›¾åŒ¹é…ä¸äº¤å‰ï¼‰</li>
<li>ä¿è¯æ·±åº¦ä¸è¿ç»­è¾¹ç¼˜é”åˆ©æ€§çš„ä¸€äº›çº¦æŸé¡¹</li>
</ul>
<p>â€‹ é‚£ä¹ˆæ–½åŠ çº¦æŸé¡¹/å¹³æ»‘é¡¹å°±æ˜¯åœ¨åšæ­£åˆ™åŒ–ï¼ç›®çš„å°±æ˜¯ä¼˜åŒ–è¾“å‡ºå›¾åƒï¼Œæ‰€ä»¥å«regularizationã€‚ä¸€èˆ¬æ¥è¯´ï¼Œcost volume regularizationä¼´éšæœ€ç»ˆè§†å·®å›¾çš„äº§ç”Ÿï¼Œè¿™æ˜¯å› ä¸ºregularizationä¹‹åï¼Œfull costå°±æ±‚å‡ºæ¥äº†å•Šã€‚å½“ç„¶æ˜¯é€‰full costæœ€å°çš„ã€‚æ•…å¯ä»¥å°†cost volume regularizationçœ‹ä½œæ˜¯è§†å·®å›¾æ±‚è§£ã€‚</p>
<p>â€‹ <img src="/2021/09/04/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91%E4%B8%A4%E7%AF%87%E5%8F%8C%E7%9B%AE%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87/agg.PNG"></p>
<center>
Figure 7. æœ€ç»ˆdisparityçš„è®¡ç®—
</center>
<p>â€‹ è®ºæ–‡è´´å¿ƒåœ°æŠŠå‡ ç§å¸¸ç”¨çš„regularizationæ–¹æ³•å¯è§†åŒ–äº†å‡ºæ¥ï¼š</p>
<ul>
<li>æ»¢è€…é€šåƒï¼ï¼ˆè¯¯ï¼Œåœ¨è¿™é‡Œç®€å•åœ°cueä¸€ä¸‹æˆ‘çš„å¥³æœ‹å‹ï¼‰ã€‚è°å°é€‰è°ã€‚</li>
<li>è€ƒè™‘ç©ºåŸŸç‰¹æ€§ï¼š2Då·ç§¯ï¼Œç»¼åˆç©ºåŸŸä¿¡æ¯ã€‚</li>
<li>è€ƒè™‘ä¸åŒçš„disparityä¸Šçš„ä¿¡æ¯ï¼šåŸºäºRNNçš„æ­£åˆ™åŒ–</li>
<li>3Då·ç§¯ï¼šå…¨åŸŸæ­£åˆ™åŒ–ï¼ˆè¿™ä¸ªç»“æ„åœ¨ä¸¤ç¯‡è®ºæ–‡çš„regularizationä¸­éƒ½æœ‰ï¼‰</li>
</ul>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] Yao C, Jia Y, Di H, et al. A Decomposition Model for Stereo Matching[C]//Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. 2021: 6091-6100.</p>
<p>[2] Wang. Carafe: Content-aware reassembly of features. In Proceedings of the IEEE International Conference on Computer Vision (ICCV), 2019</p>
<p>[3] Tosi F, Liao Y, Schmitt C, et al. SMD-Nets: Stereo Mixture Density Networks[C]//Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. 2021: 8942-8952.</p>
<p>[4] Laga H, Jospin L V, Boussaid F, et al. A survey on deep learning techniques for stereo-based depth estimation[J]. IEEE Transactions on Pattern Analysis and Machine Intelligence, 2020.</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>stereo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çº¿ä»£ä¸ç¾å¦™ä¼˜åŒ–</title>
    <url>/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h1 id="çŸ©é˜µåˆ†æ-ä¼˜åŒ–">çŸ©é˜µåˆ†æ &amp; ä¼˜åŒ–</h1>
<p>â€‹ æœ€è¿‘æ¥è§¦äº†ä¸€äº›æœ‰è¶£çš„ æœºå™¨å­¦ä¹  / æ§åˆ¶ç®—æ³•ï¼Œå…¶ä¸­çš„æ•°å­¦åŸç†éå¸¸æœ‰æ„æ€ï¼Œå¤§å¤šæ•°éƒ½æ¶‰åŠåˆ°äº†çŸ©é˜µåˆ†è§£ä»¥åŠçº¿æ€§ä»£æ•°è§£æè§£çš„æ±‚å–ã€‚æ¨å¯¼è¿™äº›ç†è®ºå¯ä»¥å¸®åŠ©æ·±å…¥ç†è§£çŸ©é˜µåˆ†è§£ï¼ˆä»¥åŠåˆ†è§£åå­çŸ©é˜µçš„æ•°å­¦æ„ä¹‰ï¼‰ä»¥åŠ çŸ©é˜µåˆ†æå’Œä¼˜åŒ–ç†è®ºçš„æ•°å­¦è”ç³»ï¼Œè¿™äº›ç†è®ºéƒ½éå¸¸ä¼˜é›…è€Œä¸”ç¾å¦™ã€‚</p>
<p><img src="/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/decomp.jpg"></p>
<center>
Figure 1. çŸ©é˜µåˆ†è§£çš„çœŸè°›ï¼šå›¾ä¸º ä¸Šä¸‰è§’åˆ†è§£
</center>
<p>â€‹ æœ¬æ–‡å°†åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>å¡å°”æ›¼æ»¤æ³¢çš„æœ€å°äºŒä¹˜è§£é‡Š</li>
<li>æœ€å°äºŒä¹˜çš„å‡ ä½•è§£é‡Š</li>
<li>è°±èšç±»çš„çŸ©é˜µåˆ†æ</li>
<li>PCAçš„çŸ©é˜µåˆ†æ</li>
</ul>
<span id="more"></span>
<hr>
<h2 id="kfæœ€å°äºŒä¹˜è§£é‡Š">KFæœ€å°äºŒä¹˜è§£é‡Š</h2>
<p>â€‹ Kalman Filterï¼Œä½œä¸ºä¸€ç§â€œæœ€å°äºŒä¹˜â€æ»¤æ³¢å™¨ï¼Œå…¶åº”ç”¨æå…¶å¹¿æ³›ã€‚ä¸ªäººä½¿ç”¨KFè®¾è®¡è¿‡ï¼š</p>
<ul>
<li>ç›®æ ‡è·Ÿè¸ªç®—æ³•ï¼ˆAdaptive Robust KFï¼‰<a href="https://github.com/Enigmatisms/Algorithms-Plus/tree/master/cpp/KF">[GithubğŸ”—ï¼šAlgorithm_Plus/KF]</a></li>
<li>è¯­éŸ³ä¿¡å·å¤„ç†ï¼ˆç™½å™ªå£°æ»¤æ³¢ï¼‰ï¼š<a href="https://github.com/Enigmatisms/AudioDSP">[GithubğŸ”—: AudioDSP]</a></li>
</ul>
<p>â€‹ è™½ç„¶è¯´ï¼ŒKFæ˜¯â€œæœ€å°äºŒä¹˜â€çš„è¿­ä»£å¼æ»¤æ³¢å™¨ï¼Œä½†è‡ªå·±ä»æ¥æ²¡æœ‰é‡Œç»“æœå…¶ä¸­çš„æ•°å­¦åŸç†ï¼Œä¹Ÿå³ï¼š<strong>(1) æœ€å°äºŒä¹˜æœ€ä¼˜æ€§æ˜¯å¦‚ä½•å¾—åˆ°çš„</strong>ï¼Ÿ<strong>(2)ä¸ºä»€ä¹ˆKFæ˜¯è¿­ä»£å¼çš„</strong>ï¼Ÿè€Œå…³äºKFçš„æ·±å…¥åˆ†æï¼ˆåŒ…æ‹¬å‚æ•°æ•´å®šï¼Œè‡ªé€‚åº”åŒ–ï¼Œæ”¶æ•›æ€§è°ˆï¼Œå°†ä¼šåœ¨å¦ä¸€ç¯‡åšæ–‡ä¸­ç»†è®²<a href="https://enigmatisms.github.io/2021/03/07/%E5%8D%A1%E5%B0%94%E6%9B%BC%E8%BF%9B%E9%98%B6%E4%B8%8E%E7%B2%92%E5%AD%90%E6%BB%A4%E6%B3%A2%E5%AE%9E%E7%8E%B0/">ã€å¡å°”æ›¼è¿›é˜¶ä¸ç²’å­æ»¤æ³¢å®ç°ã€‘</a>ï¼‰ã€‚</p>
<h3 id="kfæœ€å°äºŒä¹˜æ€§">KFæœ€å°äºŒä¹˜æ€§</h3>
<p>â€‹ æˆ‘ä»¬å°†æœ€ä¸ºä¸€èˆ¬çš„KFè¿­ä»£å…¬å¼é‡å†™å¦‚ä¸‹ï¼ˆå®é™…ä¸Šä¸ªäººè®¤ä¸ºå®ç°KFæœ€éš¾çš„åœ°æ–¹å°±æ˜¯è®°å…¬å¼ï¼‰ï¼š <span class="math display">\[
\begin{align}
&amp; \breve{x}(k)=A\hat{x}(k-1)+Bu(k)+w(k) \label{transit}\\
&amp; \breve{P}(k)=A\hat{P}(k-1)A^T+Q       \label{covup}\\
&amp; z(k)=H\breve{x}(k)+v(k) \label{obs}\\
&amp; K=\breve{P}(k)H^T(H\breve{P}(k)H^T+R)^{-1}\label{gain}\\
&amp; \hat{x}(k)=\breve{x}(k)+K(z(k)-H\breve{x}(k)) \label{xcor}\\
&amp; \hat{P}(k)=\breve{P}(k)-KH\breve{P}(k)\label{covcor}
\end{align}
\]</span> â€‹ å…¶ä¸­ï¼Œâ€œ<span class="math inline">\(\breve{ }\)</span>â€è¡¨ç¤ºå…ˆéªŒï¼Œâ€œ<span class="math inline">\(\hat{ }\)</span>â€è¡¨ç¤ºåéªŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<table>
<thead>
<tr class="header">
<th>å…ˆéªŒï¼ˆå‰ä¸¤è¡Œï¼‰</th>
<th>åéªŒï¼ˆå‰ä¸¤è¡Œï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\breve{x}(k)\)</span> è¿­ä»£kçš„çŠ¶æ€ï¼ˆå…ˆéªŒå‡å€¼ï¼‰</td>
<td><span class="math inline">\(\hat{x}\)</span>(k) åéªŒå‡å€¼</td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\breve{P}\)</span>(k) çŠ¶æ€kçš„åæ–¹å·®ï¼ˆå…ˆéªŒåæ–¹å·®ï¼‰</td>
<td><span class="math inline">\(\hat{P}\)</span>(k) åéªŒåæ–¹å·®</td>
<td></td>
</tr>
<tr class="odd">
<td>Q çŠ¶æ€è½¬ç§»å™ªå£°åæ–¹å·®</td>
<td>R è§‚æµ‹å™ªå£°åæ–¹å·®</td>
<td></td>
</tr>
<tr class="even">
<td>A çŠ¶æ€è½¬ç§»çŸ©é˜µï¼ŒHè§‚æµ‹çŸ©é˜µ</td>
<td>B æ§åˆ¶çŸ©é˜µ <span class="math inline">\(u(k)\)</span>ç³»ç»Ÿæ§åˆ¶é‡ï¼ˆå¤–ç•Œè¾“å…¥ï¼‰</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(w(k),v(k)\)</span> å™ªå£°ï¼ˆä¸€èˆ¬è®¨è®ºç™½å™ªå£°ï¼‰</td>
<td>K å¡å°”æ›¼å¢ç›Š</td>
<td></td>
</tr>
</tbody>
</table>
<p>â€‹ å…‰çœ‹è¿™ä¸ªè¿­ä»£å¼æ ¹æœ¬ä¸çŸ¥é“ä¸ºä»€ä¹ˆKFä¼šå¾—å‡ºæœ€å°äºŒä¹˜æœ€ä¼˜æ¥ï¼Œåœ¨ã€Šæ¦‚ç‡æœºå™¨äººã€‹ä¸€ä¹¦ä¸Šï¼Œä½œè€…ä½¿ç”¨çš„æ˜¯æ¦‚ç‡åˆ†å¸ƒçš„è½¬ç§»ä»¥åŠæ¨å¯¼æ¥çœ‹å¾…KFçš„è¿­ä»£ä¼˜åŒ–è¿‡ç¨‹ï¼Œå¹¶æ²¡æœ‰ä»æœ€å°äºŒä¹˜çš„è§’åº¦çœ‹å¾…è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬å°è¯•ä»æœ€å°äºŒä¹˜è§’åº¦æ¥åˆ†æKFã€‚</p>
<p>â€‹ è€ƒè™‘ä¸€ä¸ªæ‹Ÿåˆé—®é¢˜ï¼Œæ‹Ÿåˆæ›²çº¿æ—¶ï¼Œæ•°æ®ç‚¹éƒ½æ˜¯ç»™å®šçš„ï¼ˆè€Œä¸”ä¸€èˆ¬æœ‰å™ªå£°ï¼‰ã€‚ä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸ªå¹³æ»‘é—®é¢˜ï¼ˆå› ä¸ºä½¿ç”¨è€…æœ‰unlimited access to all the dataã€éšä¾¿å†™æ®µè‹±æ–‡ã€‘ï¼‰ï¼Œæ ¹æ®<a href="https://www.intechopen.com/books/smoothing-filtering-and-prediction-estimating-the-past-present-and-future">Smoothing, Filtering and Prediction</a>æ‰€è¯´ï¼Œå¹³æ»‘ / æ»¤æ³¢ / é¢„æµ‹æ˜¯é’ˆå¯¹ä¸‰ä¸ªä¸åŒçš„æ—¶é—´ç‚¹ï¼šå¤„ç†è¿‡å»çš„æ•°æ®ï¼ˆå·²ç»æ¥æ”¶å¹¶ä¸”å­˜å‚¨ï¼‰ï¼Œå¤„ç†å½“ä¸‹çš„æ•°æ®ï¼ˆæ¯”å¦‚ç¡®å®šæ›´å‡†ç¡®çš„æµ‹é‡å€¼ï¼‰ï¼Œå¤„ç†æœªæ¥çš„å¯èƒ½æ•°æ®ï¼ˆé¢„æµ‹ï¼‰ã€‚è€ŒKFçš„ä¸€ç§å¸¸ç”¨é¢†åŸŸ-æ§åˆ¶ï¼Œæ˜¯æœ‰å®æ—¶æ€§è¦æ±‚çš„ï¼Œè¦æ±‚è‡³å°‘éœ€è¦è¾¾åˆ°ã€æ»¤æ³¢ã€‘çš„æ ‡å‡†ï¼Œæœ€å¥½èƒ½è¿›è¡Œã€é¢„æµ‹ã€‘ã€‚è€Œä¸€èˆ¬çš„æ‹Ÿåˆï¼ŒåŸºæœ¬éƒ½æ˜¯ä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰çš„ç‚¹ï¼Œæ‰€ä»¥ç€å¯¼è‡´äº†ä¸€èˆ¬çš„æ‹Ÿåˆé—®é¢˜ <strong><u>ä¸æ˜¯å¢é‡æ€§çš„ï¼ˆä¹Ÿå³æœ‰æ–°çš„æ•°æ®ç‚¹ï¼Œéœ€è¦å…¨éƒ¨é‡æ–°è®¡ç®—ï¼Œæ¯”å¦‚lossä¸æ¢¯åº¦ï¼‰</u></strong>ã€‚</p>
<p>â€‹ KFæ˜¾ç„¶å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼ŒKFéœ€è¦å®æ—¶æ›´æ–°ï¼Œå¹¶ä¸”ä¸èƒ½ä¾èµ–å¤ªä¹…è¿œçš„å†å²ä¿¡æ¯ï¼ˆä½é˜¶çš„é©¬å°”å¯å¤«æ€§ï¼‰ã€‚KFçš„é¢„æµ‹è¾“å‡ºæœŸæœ›èƒ½ä¸è§‚æµ‹è´´åˆï¼ˆä½†è¿™ä¹Ÿä¸å®Œå…¨ä¸€å®šï¼Œç”±äºè§‚æµ‹æ˜¯å­˜åœ¨ä¸€å®šçš„å™ªå£°çš„ï¼‰ã€‚æ ¹æ®è®ºæ–‡"<strong><em>Robust Estimation with Unknown Noise Statistics</em></strong>"ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠKFé—®é¢˜é‡å†™æˆå¦‚ä¸‹å½¢å¼ï¼š <span class="math display">\[
\begin{equation}\label{optim}
\begin{pmatrix}
I\\
H
\end{pmatrix}\breve{x}(k)=
\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} +
\begin{pmatrix}
w(k)\\
v(k)
\end{pmatrix}=
\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} + E(k)
\end{equation}
\]</span></p>
<p>â€‹ å‡è®¾æˆ‘ä»¬æ±‚è§£å™ªå£°çŸ©é˜µ<span class="math inline">\(E(k)\)</span>çš„åæ–¹å·®ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š <span class="math display">\[
\begin{equation}\label{ecov}
\mathbb{E}(E(k)E(k)^T)=\begin{pmatrix}
\breve{P}(k) &amp; \mathbf{0}   \\
\mathbf{0} &amp; R(k)
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ åæ–¹å·®ä¸ºä»€ä¹ˆé•¿æˆè¿™æ ·å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼š<span class="math inline">\(w(x)\)</span>è‡ªå·±çš„åæ–¹å·®å°±æ˜¯çŠ¶æ€è½¬ç§»åæ–¹å·®ï¼ˆæ³¨æ„ä¸æ˜¯å™ªå£°åæ–¹å·®Qï¼Œå› ä¸ºQéœ€è¦è¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼‰ï¼Œè€Œ<span class="math inline">\(v(x)\)</span>çš„åæ–¹å·®æ˜¯å™ªå£°åæ–¹å·®ã€‚è€Œ<span class="math inline">\(w(x),v(x)\)</span>é»˜è®¤æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ•…éå¯¹è§’çº¿çŸ©é˜µå—ä¸º0ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹è¿™ä¸ªåæ–¹å·®è¿›è¡ŒçŸ©é˜µåˆ†è§£ï¼š <span class="math display">\[
\begin{equation}
Cholesky(\mathbb{E}(E(k)E(k)^T))=SS^T
\end{equation}
\]</span></p>
<p>â€‹ æ­¤åæ‰€åšçš„äº‹æƒ…æœ‰ç‚¹å¥‡æ€ªï¼ŒçŸ©é˜µ<span class="math inline">\(S\)</span>è¢«å•ç‹¬ä½¿ç”¨äº†ï¼ˆåæ–¹å·®çŸ©é˜µçš„çŸ©é˜µLUåˆ†è§£ä»£è¡¨äº†ä»€ä¹ˆæ„ä¹‰ï¼Ÿï¼‰ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œæ˜¯è¦ä½¿linear transformä¹‹åçš„å™ªå£°åæ–¹å·®ä¸ºå•ä½é˜µï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤å¤„åšäº†ä¸€ä¸ªç™½åŒ–å˜æ¢ï¼‰ã€‚æˆ‘ä»¬çœ‹å…¬å¼<span class="math inline">\(\eqref{optim}\)</span>ï¼Œ<span class="math inline">\(E(k)\)</span>æ˜¯ç³»ç»Ÿçš„å™ªå£°ï¼Œè€Œç³»ç»Ÿé«˜æ–¯å™ªå£°å¹¶ä¸ä¸ºå•ä½é˜µï¼Œé—®é¢˜å¹¶éæ ‡å‡†é—®é¢˜ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ï¼šè¾“å…¥æ²¡æœ‰è¿›è¡Œæ ‡å‡†åŒ–ã€‚é‚£ä¹ˆå¯¹äº<span class="math inline">\(\eqref{optim}\)</span>è€Œè¨€ï¼Œç­‰å·å·¦å³ä¹˜ä»¥<span class="math inline">\(S^{-1}\)</span>å®é™…ä¸Šå°±æ˜¯åœ¨åšç™½åŒ–å˜æ¢ï¼š <span class="math display">\[
\begin{align}
&amp;S^{-1}\begin{pmatrix}
I\\
H
\end{pmatrix}\breve{x}(k)=
S^{-1}\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} +
S^{-1}\begin{pmatrix}
w(k)\\
v(k)
\end{pmatrix}=
S^{-1}\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} + S^{-1}E(k)\label{optim2}
\end{align}
\]</span></p>
<p><span class="math display">\[
\begin{equation}\label{lsp}
X(k){x}(k)+\xi(k)=Y(k)
\end{equation}
\]</span></p>
<p>â€‹ è¿™å°±æ˜¯ä¸ªæ ‡å‡†çš„æœ€å°äºŒä¹˜é—®é¢˜ï¼Œç”±äºæ­¤å¤„<span class="math inline">\(\mathbb{E}\{\xi(k)\xi(k)^T\}\)</span>æ˜¯å•ä½é˜µã€‚æœ‰æ²¡æœ‰å‘ç°æ­¤å¤„æˆ‘ä»¬å·²ç»ä¸å†™<span class="math inline">\(\breve{x}\)</span>äº†ï¼Ÿè™½ç„¶ä»æ¨å¯¼å¼<span class="math inline">\(\eqref{optim}\)</span>æ¥è¯´ï¼Œæ­¤å¤„ç¡®å®åº”è¯¥æ˜¯å…ˆéªŒ<span class="math inline">\(\breve{x}\)</span>ï¼Œä½†æ˜¯æ­¤é—®é¢˜çš„è§£ï¼ˆç”±äºæ¶‰åŠåˆ°æœ¬æ¬¡è§‚æµ‹<span class="math inline">\(z(k)\)</span>è¿›è¡Œçš„åéªŒä¿®æ­£ï¼‰å·²ç»æ˜¯åéªŒäº†ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®pseudoé€†ç†è®ºæ±‚å¾—<span class="math inline">\(x(k)\)</span>çš„è§£ï¼š <span class="math display">\[
\begin{align}
&amp;\hat{x}(k)=\mathop{\text{arg min}}_{x}\Vert Y(k)-X(k)x(k)\Vert^2 \\
&amp;x^*(k)=(X^T(k)X(k))^{-1}X^T(k)Y(k)\label{optim3}
\end{align}
\]</span> â€‹ ä»è€Œå¾—åˆ°äº†åéªŒä¼°è®¡ã€‚è¿™å°±æ˜¯KFçš„ä¼˜åŒ–è¡¨è¾¾å¼ï¼Œè€Œæˆ‘ä»¬èƒ½ä»ä¸­æ¨å‡ºKFçš„è¿­ä»£æ€§è´¨å—ï¼Ÿ</p>
<h3 id="kfè¿­ä»£æ€§è´¨">KFè¿­ä»£æ€§è´¨</h3>
<p>â€‹ åˆ†æä¸éš¾å¾—åˆ°å¦‚ä¸‹å…³ç³»ï¼š <span class="math display">\[
\begin{equation}
X^T(k)X(k)=
(I\quad H^T)(S^{-1})^T(S^{-1})
\begin{pmatrix}
I\\
H
\end{pmatrix}=(I\quad H^T)(SS^T)^{-1}
\begin{pmatrix}
I\\
H
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ è€Œ<span class="math inline">\(SS^T\)</span>æ˜¯å…¬å¼<span class="math inline">\(\eqref{ecov}\)</span>ä¸­çš„åæ–¹å·®çŸ©é˜µï¼Œé‚£ä¹ˆå¯ä»¥è¿›ä¸€æ­¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
X^T(k)X(k)=
(I\quad H)
\begin{pmatrix}
P^{-1}(k) &amp; \mathbf{0} \\
\mathbf{0} &amp; R^{-1}(k)
\end{pmatrix}
\begin{pmatrix}
I\\
H
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ å±•å¼€ä»¥ä¸Šå¼å­å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
(X^T(k)X(k))^{-1}=(P^{-1}+H^TR^{-1}H)^{-1}=P+H^{-1}R(H^{-1})^{T}
\end{equation}
\]</span></p>
<p>â€‹ è¯¶ï¼Œåªéœ€è¦é¡ºç€è¿™æ ·çš„åˆ†è§£ä¸‹å»ï¼Œä¸éš¾å‘ç°ï¼ˆçœŸçš„ä¸éš¾ï¼Œæ‰€ä»¥è´¹ç¯‡å¹…åœ¨è¿™æ¨å…¬å¼äº†ï¼‰ï¼Œä¼˜åŒ–ç»“æœ<span class="math inline">\(\eqref{optim3}\)</span>ä¸ä¹‹å‰çš„åéªŒæ›´æ–°å¼<span class="math inline">\(\eqref{xcor}\)</span>æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è€Œåæ–¹å·®çš„å…ˆéªŒåéªŒæ›´æ–°å®é™…ä¸Šæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†è¯¦ç»†æ¨å¯¼äº†ã€‚å¦™å•Šå…„å¼Ÿä»¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ¨å‡ºäº†æœ€å°äºŒä¹˜ä¸KFçš„å…³ç³»ã€‚</p>
<hr>
<h2 id="æœ€å°äºŒä¹˜çš„å‡ ä½•è§£é‡Š">æœ€å°äºŒä¹˜çš„å‡ ä½•è§£é‡Š</h2>
<p>â€‹ ä¸ŠDIPï¼ˆæ•°å­—å›¾åƒå¤„ç†ï¼‰çš„æ—¶å€™ï¼Œè€å¸ˆçªç„¶æŠ›å‡ºä¸€ä¸ªé—®é¢˜æ¥ï¼š</p>
<p>â€‹ <img src="/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/proj.JPG"></p>
<center>
Figure 2. è§‚æµ‹ è¯¯å·® ä¸çœŸå€¼çš„ç©ºé—´è¡¨ç¤º
</center>
<div class="note default"><p>â€‹ ä¸ºä»€ä¹ˆè¯´ï¼Œè§‚æµ‹å¹³é¢éœ€è¦å’Œè¯¯å·®æ­£äº¤ï¼Ÿï¼ˆä¹Ÿå°±æ˜¯è¯´è§‚æµ‹å¹³é¢çš„æ³•å‘é‡å’Œè¯¯å·®çš„æ–¹å‘æ˜¯é‡åˆçš„ï¼Ÿï¼‰</p>
</div>
<p>â€‹ æƒŠè®¶ï¼Œç«Ÿç„¶æ²¡æœ‰äººè¯´ä¸Šæ¥ä¸ºä»€ä¹ˆï¼ˆå¯èƒ½å¤§å®¶éƒ½æ¯”è¾ƒè°¦è™šå§ï¼‰ã€‚</p>
<p>â€‹ ä»å‡ ä½•<strong>ç›´è§‚</strong>ä¸Šéå¸¸å¥½ç†è§£ä¸ºä»€ä¹ˆã€‚æ˜¾ç„¶ï¼Œè§‚æµ‹<span class="math inline">\(\hat{x}\)</span>æ˜¯ç”±çœŸå€¼çš„æŠ•å½±<span class="math inline">\(\breve{x}\)</span>ä¸è¯¯å·®<span class="math inline">\(e\)</span>æŠ•å½±çš„ç»“åˆï¼Œè€Œå¦‚æœæŠ•å½±å¹³é¢ï¼ˆè§‚æµ‹é¢ï¼‰æ­£å¥½ä¸è¯¯å·®æ˜¯æ­£äº¤çš„ï¼Œé‚£ä¹ˆè¯¯å·®çš„æŠ•å½±å°†ä¼šæ˜¯0ã€‚è€Œåœ¨æœ€å°äºŒä¹˜æ„ä¹‰ä¸‹ï¼Œè¯¯å·®çš„å¹³å‡æŠ•å½±é•¿åº¦æ˜¯æœ€å°çš„ã€‚</p>
<p><img src="/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/err.JPG"></p>
<center>
Figure 3. è¯¯å·®æŠ•å½± æŠ•å½±åå½±å“è§‚æµ‹ï¼ˆå®é™…è§‚æµ‹æ˜¯ç»¿è‰² + ç´«è‰²ï¼‰
</center>
<p>â€‹ é‚£ä¹ˆè¦æ±‚æœ€ä¼˜çš„æŠ•å½±é¢ï¼Œå®é™…ä¸Šæ˜¯è¦ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼š <span class="math display">\[
\begin{equation}\label{f17}
\left\{
\begin{array}{ll}
\text{min }\Vert \pmb{e}-(\pmb{a}^T\pmb{e})\pmb{a}\Vert^2\\
\text{s.t. }\pmb{a}^T\pmb{a}=1
\end{array}
\right.
\end{equation}
\]</span></p>
<p>â€‹ ä»€ä¹ˆæ„æ€ï¼Ÿæ„æ€å°±æ˜¯ï¼Œå‡è®¾<span class="math inline">\(\pmb{a}\)</span>æ˜¯æŠ•å½±å¹³é¢çš„å•ä½æ³•å‘é‡ï¼Œé‚£ä¹ˆ<span class="math inline">\(\pmb{a}^T\pmb{e}\)</span>å°±æ˜¯è¯¯å·®åœ¨å•ä½æ³•å‘é‡ä¸Šçš„æŠ•å½±ï¼Œè€Œ<span class="math inline">\(\pmb{e}-(\pmb{a}^T\pmb{e})\pmb{a}\)</span>å°±æ˜¯è¯¯å·®åœ¨è§‚æµ‹å¹³é¢ä¸Šçš„æŠ•å½±ã€‚éœ€è¦ä½¿å¾—è¿™ä¸ªæŠ•å½±æœ€çŸ­ã€‚</p>
<p>â€‹ é‚£ä¹ˆè§£è¿™ä¸ªé—®é¢˜ï¼Œå®é™…ä¸Šæœ€åä¼šæ±‚å‡ºï¼šéœ€è¦å¯¹è¯¯å·®çš„åæ–¹å·®<span class="math inline">\(\pmb{e}\pmb{e}^T=\Sigma\)</span>è¿›è¡ŒçŸ©é˜µåˆ†è§£ï¼Œæ±‚æœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå°±æ˜¯<span class="math inline">\(\pmb{a}\)</span>ã€‚è€Œè¿™ä¸ªç‰¹å¾å‘é‡å®é™…ä¸Šå¯¹åº”äº†è¯¯å·®çš„ä¸»æ–¹å‘ï¼ˆPCAéƒ¨åˆ†ä¸­ä¼šæåˆ°è¿™ä¸ªæ€æƒ³ï¼‰ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªè§‚æµ‹çš„è¯ï¼Œåˆ™å°±æ˜¯è¯¯å·®çš„æ–¹å‘ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œ<strong><u>å¾ˆç®€å•</u></strong>ï¼Œå…¬å¼<span class="math inline">\(\eqref{f17}\)</span>ç•™ç»™è¯»è€…ä½œä¸ºç»ƒä¹ ã€‚</p>
<hr>
<h2 id="è°±èšç±»çŸ©é˜µåˆ†æ">è°±èšç±»çŸ©é˜µåˆ†æ</h2>
<p>â€‹ è°±èšç±»ï¼ˆspectrum clusteringï¼‰æ˜¯ä¸€ç§å¾ˆç¾å¦™çš„èšç±»ç†è®ºï¼Œå®ƒåŒ…å«äº†<strong><u>å›¾è®º</u></strong>ï¼Œ <strong><u>çŸ©é˜µåˆ†æ</u></strong>ï¼Œ<strong><u>ä¼˜åŒ–ç†è®º</u></strong>ä»¥åŠ<strong><u>æœºå™¨å­¦ä¹ ç†è®º</u></strong>ï¼Œç»¼åˆæ€§çš„ä¸€ä¸ªç®—æ³•ï¼Œç†è§£è¿™ä¸ªç®—æ³•å¯ä»¥å¸®åŠ©å¯¹ä»¥ä¸Šå››ä¸ªæ–¹é¢çš„ç†è®ºéƒ½æœ‰è¿›ä¸€æ­¥çš„è®¤è¯†ã€‚</p>
<h3 id="laplaceç®—å­">Laplaceç®—å­</h3>
<p>â€‹ è¿™æ˜¯æˆ‘DIPè¯¾ç¨‹ä¸­åˆšè®²çš„ç©ºåŸŸæ»¤æ³¢å™¨kernelï¼Œè™½ç„¶ä¹‹å‰å°±çŸ¥é“Laplaceé•¿ä»€ä¹ˆæ ·ï¼Œä½†æ˜¯ä»æ¥æ²¡æœ‰ä»DSPçš„è§’åº¦å»æ€è€ƒï¼Œä¹Ÿæ²¡æœ‰æ€è€ƒå…¶æ•°å­¦åŸç†ã€‚Laplaceç®—å­ç”¨ <strong><u>æ±‚äºŒé˜¶å¯¼</u></strong>ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå°ç¼–ä¹Ÿä¸çŸ¥é“ï¼Œå°ç¼–ä¹Ÿè§‰å¾—å¾ˆæœ‰è¶£ã€‚ä¸€ä¸ªå…¸å‹çš„Laplace kernelé•¿è¿™æ ·ï¼š <span class="math display">\[
\begin{equation}
\begin{pmatrix}
0 &amp; -1 &amp; 0 \\
-1 &amp; 4 &amp; -1 \\
0 &amp; -1 &amp; 0
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ ä»DSPçš„è§’åº¦è€ƒè™‘Laplaceç®—å­çš„è®¾è®¡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ä¸ªé«˜é€šæ»¤æ³¢å™¨å˜›ï¼ˆæ±‚è¾¹ç¼˜ä½¿ç”¨ï¼‰ï¼Œè€Œå¯¹äºç›´æµåˆ†é‡è¿™ç§æ˜¾ç„¶æ˜¯ä½é¢‘çš„ä¿¡å·æˆåˆ†æ¥è¯´ï¼Œå®ƒæ˜¯è¦è¢«é«˜é€šæ»¤æ³¢å™¨æ»¤é™¤çš„ã€‚äºæ˜¯é«˜é€šæ»¤æ³¢å™¨ä¸èƒ½ä¿ç•™ä»»ä½•ç›´æµçš„èƒ½é‡ï¼Œéœ€è¦ä¿è¯å¯¹äºå¹³æ»‘åŒºåŸŸï¼ˆæ¯”å¦‚onesï¼‰ï¼Œå·ç§¯ç»“æœä¸º0ã€‚è€Œå›¾åˆ†æï¼ˆgraphï¼‰ä¸­ï¼Œå¯¹äºç¦»æ•£çš„å›¾è€Œè¨€ä¹Ÿæœ‰Laplaceç®—å­ï¼Œå¹¶ä¸”å…¶ç‰©ç†æ„ä¹‰éå¸¸æ˜ç¡®ï¼š<strong><u>æ±‚å›¾ä¸Šçš„æœ€å°å‰²</u></strong>ã€‚é¦–å…ˆæ¨ä¸€ä¸‹ç¦»æ•£çš„äºŒé˜¶å¯¼ï¼Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¸€é˜¶å¯¼è¡¨è¾¾å¼ï¼š <span class="math display">\[
\begin{equation}\label{de_1}
\frac{df}{dx}=f&#39;(x)=f(x)-f(x-1)
\end{equation}
\]</span></p>
<p>â€‹ è€Œéœ€è¦æ±‚äºŒé˜¶å¯¼ï¼Œä¹Ÿå°±éœ€è¦åœ¨æœ¬å‡½æ•°çš„åŸºç¡€ä¸Šå†æ±‚ä¸€é˜¶å¯¼ï¼š <span class="math display">\[
\begin{equation}\label{de_2}
\frac{d^2f}{dx^2}=f&#39;&#39;(x)=f&#39;(x)-f&#39;(x-1)=f(x)-2f(x-1)+f(x-2)
\end{equation}
\]</span></p>
<p>â€‹ æ¥ä¸‹æ¥åˆ†ææ— å‘å¸¦æƒå›¾ä¸Šçš„LaplaceçŸ©é˜µã€‚</p>
<p>â€‹ é¦–å…ˆå®šä¹‰<span class="math inline">\(W\)</span>ä¸ºæƒé‡çŸ©é˜µï¼ˆæ— å‘å¸¦æƒå›¾çš„é‚»æ¥çŸ©é˜µï¼Œæ³¨æ„<span class="math inline">\(w_{i,i}=0\)</span>ï¼‰ï¼Œ<span class="math inline">\(W\)</span>å°±åˆ»ç”»äº†èŠ‚ç‚¹ä¹‹é—´çš„è”ç³»ç¨‹åº¦ï¼ˆæˆ–è€…costï¼‰ã€‚åœ¨èšç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è®¾å®šï¼Œå‡è®¾ä¸¤ä¸ªæ ·æœ¬ç‚¹ä¹‹é—´çš„å…³ç³»è¶Šç´§å¯†ï¼Œç‰¹å¾è¶Šç±»ä¼¼ï¼Œå¯¹åº”èŠ‚ç‚¹ä¹‹é—´çš„è¾¹æƒä¹Ÿå°±è¶Šå¤§ã€‚é‚£ä¹ˆèšç±»å®é™…ä¸Šå°±æ˜¯åœ¨è¿™æ ·çš„å›¾ä¸Šå¯»æ‰¾ä¸€ä¸ªæœ€å°å‰²ï¼ˆæœ€å°æƒçš„è¾¹é›†åˆï¼‰ï¼Œä½¿å¾—ç»è¿‡è¿™ä¸ªcutä¹‹åå¯ä»¥åˆ†ä¸ºkä¸ªæŒ‡å®šç±»ã€‚</p>
<p>â€‹ æ­¤å¤–ï¼Œå®šä¹‰<span class="math inline">\(D\)</span>ä¸ºåº¦çŸ©é˜µï¼Œä¸æ™®é€šçš„åº¦å®šä¹‰ä¸åŒï¼ˆè¿™ä¸ªåº¦æ˜¯æœ‰æƒçš„ï¼‰ï¼Œ<span class="math inline">\(D\)</span>ä¸ºå¯¹è§’çŸ©é˜µï¼Œå…ƒç´ <span class="math inline">\(d_{i,j}\)</span>çš„æ„ä¹‰æ˜¯ï¼š <span class="math display">\[
\begin{equation}
d_{i,j}=\left\{
\begin{array}{l}
\sum_{j=1}^nw(i,j),\text{ if }i=j \\
0,\text{ otherwise}
\end{array}
\right.{}
\end{equation}
\]</span></p>
<p>â€‹ Dè¡¡é‡çš„å®é™…æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„è”ç³»ç´§å¯†ç¨‹åº¦ã€‚åˆ™æœ‰äº†è¿™ä¸¤ä¸ªçŸ©é˜µï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰<span class="math inline">\(L=D-W\)</span></p>
<p>â€‹ ä¹Ÿå°±æ˜¯åº¦çŸ©é˜µå‡å»é‚»æ¥çŸ©é˜µï¼Œçœ‹èµ·æ¥éå¸¸æŠ½è±¡ï¼Ÿç›´æ¥çœ‹Læ˜¯éš¾ä»¥å¾—åˆ°å…¶ç‰©ç†æ„ä¹‰çš„ï¼Œéœ€è¦æœ‰å…¶ä»–å‘é‡çš„å¸®åŠ©</p>
<h5 id="æ€§è´¨1-å‘é‡å·®å¼‚">æ€§è´¨1 å‘é‡â€œå·®å¼‚â€</h5>
<p><span class="math display">\[
\begin{equation}
\text{Given vector }x,\text{ }Lx=
\begin{pmatrix}
\sum_{j\neq1}w_{1j} &amp; -w_{12} &amp; ... &amp; -w_{1n}\\
-w_{21} &amp; \sum_{j\neq2}w_{2j} &amp; ... &amp; -w_{2n}\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
-w_{n1} &amp; -w_{n,2} &amp; ... &amp; \sum_{j\neq n}w_{nj}
\end{pmatrix}
\begin{pmatrix}
x_1 \\
x_2 \\
\vdots \\
x_n
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ å°†ä¸Šå¼å±•å¼€å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{diff1}
\begin{pmatrix}
\sum_{j\neq1}w_{1j} &amp; -w_{12} &amp; ... &amp; -w_{1n}\\
-w_{21} &amp; \sum_{j\neq2}w_{2j} &amp; ... &amp; -w_{2n}\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
-w_{n1} &amp; -w_{n,2} &amp; ... &amp; \sum_{j\neq n}w_{nj}
\end{pmatrix}
\begin{pmatrix}
x_1 \\
x_2 \\
\vdots \\
x_n
\end{pmatrix}=
\begin{pmatrix}
\sum_{j\neq 1}w_{1j}(x_1-x_j)\\
\sum_{j\neq 1}w_{2j}(x_1-x_j)\\
\vdots\\
\sum_{j\neq 1}w_{nj}(x_n-x_j)\\
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ è¯æ˜å°±æ˜¯æš´åŠ›å±•å¼€ã€‚å¯ä»¥å‘ç°ä¸€ä¸ªxæ—¶ï¼Œå¯¹xåšçº¿æ€§å˜æ¢å®é™…ä¸Šæ±‚äº†xå„ä¸ªå…ƒç´ ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<h5 id="æ€§è´¨2-æ ‡é‡è¾“å‡º">æ€§è´¨2 æ ‡é‡è¾“å‡º</h5>
<p><span class="math display">\[
\begin{equation}\label{diff2}
x^TLx=\sum_{i=1}^n\sum_{j=1}^nw_{ij}(x_i-x_j)^2
\end{equation}
\]</span></p>
<p>â€‹ æ ¹æ®çŸ©é˜µä¹˜æ³•ï¼Œå¯¹å…¬å¼<span class="math inline">\(\eqref{diff1}\)</span>è¿›è¡Œå·¦ä¹˜xæ“ä½œå†å±•å¼€å¾ˆå®¹æ˜“å°±èƒ½å¾—åˆ°ã€‚æ­¤å¤„ï¼Œ<span class="math inline">\(x^TLx\)</span>çš„æ„ä¹‰å®é™…ä¸Šå°±æ˜¯ï¼šæ ¹æ®æ¯ä¸ªèŠ‚ç‚¹çš„å…³è”å…³ç³» <strong><u>åŠ æƒ</u></strong> çš„å‘é‡å†…éƒ¨å·®å¼‚ã€‚ä½†æ˜¯è¿™ä¸ªå‘é‡<span class="math inline">\(x\)</span>åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h5 id="å‘é‡xæ„ä¹‰çš„è®¨è®º">å‘é‡xæ„ä¹‰çš„è®¨è®º</h5>
<p>â€‹ æˆ‘ä»¬è®¨è®ºé—®é¢˜çš„èƒŒæ™¯æ˜¯èšç±»ï¼Œèšç±»ä¸­é™¤äº†æ¯å¯¹èŠ‚ç‚¹ä¹‹é—´çš„ç‰¹å¾å·®å¼‚ä¹‹å¤–ï¼Œæœ€æ˜¾è‘—çš„å·®å¼‚å°±æ˜¯ <strong><u>èšç±»å¯¹åº”çš„ç±»åˆ«å·®å¼‚</u></strong>äº†ã€‚é‚£ä¹ˆxæ°å¥½å¯ä»¥ä½œä¸ºä¸€ä¸ªæŒ‡ç¤ºå‘é‡ï¼Œç»™å®šä¸€ä¸ªk=2ç°‡çš„èšç±»é—®é¢˜ï¼Œè®¾ï¼š <span class="math display">\[
\begin{equation}\label{indicate}
x_i=\left\{
\begin{array}{ll}
1, \text{ if }\pmb{x}\in\mathbb{C}_1\\
-1,\text{ if }\pmb{x}\in\mathbb{C}_2
\end{array}
\right.
\end{equation}
\]</span></p>
<p>â€‹ é‚£ä¹ˆ<span class="math inline">\(Lx\)</span>å®é™…ä¸Šå°±æ˜¯ä¸åŒèŠ‚ç‚¹ä¹‹é—´labelçš„å·®å¼‚ï¼Œæ¯”å¦‚ä¸¤ä¸ªç‚¹ä¸ºåŒä¸€ä¸ªç°‡ï¼Œåˆ™<span class="math inline">\(Lx\)</span>å¯¹åº”åˆ†é‡ä¸º0ï¼Œå¦åˆ™ä¸ºä¸€ä¸ªé0çš„å€¼ï¼ˆæ­£æ•°ï¼‰ã€‚ç°åœ¨è¦æ‰¾ä¸€ç§æ–¹å¼å‰²å¼€è¿™ä¸ªç‚¹é›†ï¼ˆä¹Ÿå°±æ˜¯æ‰¾ä¸€ä¸ªxï¼‰ï¼Œä½¿å¾—ä¸¤ä¸ªç±»ä¹‹é—´çš„è”ç³»æ˜¯æœ€å°çš„ã€‚é‚£ä¹ˆå®é™…ä¸Šï¼Œåˆ‡å¼€ä¸¤ç±»çš„å‰²å¯¹åº”çš„å€¼å°±æ˜¯ä¸¤ç±»ä¹‹é—´è¢«ä¸¢å¼ƒçš„ï¼ˆå‰²å¼€ï¼‰ç±»é—´è”ç³»ï¼Œå®é™…å¯ä»¥å¯¹åº”äº<span class="math inline">\(x^TLx\)</span>ã€‚åœ¨ä¸åŒçš„formulationä¸‹ï¼Œ<span class="math inline">\(x\)</span>å¯ä»¥æœ‰ä¸åŒå½¢å¼ï¼Œä½†æ˜¯å…¶æ„ä¹‰åŸºæœ¬ä¸€è‡´ï¼šå‰²ã€‚</p>
<p>â€‹ k=2æ—¶ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‘é‡è¿›è¡Œè¿ç®—ï¼ˆ<span class="math inline">\(\pm1\)</span>ï¼‰ï¼Œè€Œæ¶‰åŠåˆ°å¤šç±»æ—¶ï¼Œå¯èƒ½<span class="math inline">\(x\)</span>å°±ä¼šæ˜¯ä¸€ä¸ªçŸ©é˜µäº†ï¼ˆå› ä¸ºä¸å­˜åœ¨ä¸€ç§èµ‹å€¼æ–¹å¼ä½¿å¾—ä»»æ„ä¸¤ç±»ä¸åŒçš„ç»“ç‚¹çš„costç›¸å‡æ˜¯ç›¸åŒçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š0ä¸ºAï¼Œ1ä¸ºBï¼Œ2ä¸ºCï¼Œè™½ç„¶ABï¼ŒBCä¹‹é—´ç›¸å·®1ï¼Œä½†æ˜¯ACä¹‹é—´å·®2ï¼‰ã€‚</p>
<h4 id="äºŒç±»cut">äºŒç±»Cut</h4>
<p>â€‹ k=2èšç±»ç›´æ¥ä½¿ç”¨å¦‚<span class="math inline">\(\eqref{indicate}\)</span>æ‰€å®šä¹‰çš„å‘é‡xå³å¯ã€‚</p>
<div class="note info"><p><strong>è¯´äº†è¿™ä¹ˆä¹…çŸ©é˜µåˆ†æï¼Œè¿˜æ²¡æ­£ç»åœ°å¼€å§‹åˆ†æå‘¢ã€‚</strong></p>
<p>å¯ä»¥çœ‹ä¸€ä¸‹<span class="math inline">\(x^TLx\)</span>çš„å–å€¼èŒƒå›´åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿä¸çŸ©é˜µLçš„ç‰¹å¾å€¼æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
</div>
<p>â€‹ ç”±äºçŸ©é˜µçš„ç‰¹å¾å‘é‡æ˜¯ç›¸äº’æ­£äº¤çš„ï¼Œå®ƒä»¬å®é™…ä¸Šå¼ æˆäº†ä¸€ä¸ªä¸xæ‰€åœ¨çº¿æ€§ç©ºé—´ç­‰ä»·çš„ä¸€ä¸ªç©ºé—´ã€‚ä»è€Œå¯ä»¥çŸ¥é“ï¼Œç”±äºxå­˜åœ¨äºç‰¹å¾å‘é‡å¼ æˆçš„çº¿æ€§ç©ºé—´ä¸­ï¼Œxå¯åœ¨ä»¥ç‰¹å¾å‘é‡ä¸ºåŸºæ—¶è¢«ç‰¹å¾å‘é‡çš„çº¿æ€§ç»„åˆè¡¨ç¤ºï¼š <span class="math display">\[
\begin{equation}
x^TLx=(\sum_{i=1}^na_i\pmb{v}_i)^TL(\sum_{i=1}^na_i\pmb{v}_i),\text{ where }\pmb{v}_i\text{ is the eigen vec of }L
\end{equation}
\]</span></p>
<p>â€‹ ç”±äºç‰¹å¾å‘é‡çš„å®šä¹‰ï¼Œé‚£ä¹ˆä¸Šå¼å®é™…ä¸Šå°±ç­‰äºï¼š <span class="math display">\[
\begin{equation}
x^TLx=\sum_{i=1}^na_i^2\lambda_i,\text{ where }\lambda_i\text{ is the eigen value of }L
\end{equation}
\]</span></p>
<p>â€‹ <span class="math inline">\(x^TLx\)</span>ä¸­çš„xå¹¶éæ˜¯æ²¡æœ‰çº¦æŸçš„ï¼Œåœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œxæ˜¯æ­£è´Ÿ1çš„å‘é‡ï¼Œè€Œ<span class="math inline">\(\pmb{v}_i\)</span>ä¸ºå½’ä¸€åŒ–ä¹‹åçš„ç‰¹å¾å‘é‡ï¼Œæ•…<span class="math inline">\(a_i\)</span>çš„æœ€å¤§å€¼ä¸å¯èƒ½å°äº<span class="math inline">\(1/\sqrt{n}\)</span>ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œè®¾<span class="math inline">\(\max(a_i)=a_m\)</span>ï¼Œ<span class="math inline">\(a_m\)</span>å¿…ç„¶ä¼šä½œç”¨åˆ°å…¶ä¸­ä¸€ä¸ªç‰¹å¾å€¼ä¸Šã€‚é‚£ä¹ˆå¯ä»¥å‘ç°ï¼Œå¦‚æœè¦æ±‚æœ€å°çš„è¯ï¼Œæ˜¾ç„¶è®©<span class="math inline">\(a_m\)</span>ä½œç”¨åˆ°æœ€å°ç‰¹å¾å€¼ä¸Šå°±å¯ä»¥è®©<span class="math inline">\(x^TLx\)</span>ç­‰ä»·åœ°æœ€å°ã€‚é‚£ä¹ˆæ±‚ç¬¬jå°ä¹Ÿå°±ç›¸å½“äºä½¿ç”¨ç¬¬jå°ç‰¹å¾å€¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„è§£å‘é‡ä¹Ÿå°±æ˜¯<span class="math inline">\(v_{\text{min jth}}\)</span>ã€‚å…¶å®ç‰¹å¾å€¼æœ€å¤§æœ€å°æ€§åœ¨ä¹‹å‰å°±å·²ç»æè¿‡ï¼š</p>
<p>â€‹ æœ€å¤§åŒ–ç±»é—´æ–¹å·®æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°åæ–¹å·®çŸ©é˜µæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚è€Œæ±‚å¹³é¢ / çº¿æ®µçš„normalæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°æœ€å°ç‰¹å¾å€¼ï¼Œä¸è¿‡è¿™é‡Œçš„æœ€å°ç‰¹å¾å€¼å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•è§£é‡Šï¼Œä»¥æ±‚çº¿æ®µçš„æ³•çº¿ä¸ºä¾‹ï¼š</p>
<ul>
<li>æœ€å°äºŒä¹˜å¾—åˆ°çº¿æ®µçš„æœ€ä¼˜ä¼°è®¡è¿‡ç¨‹ä¹Ÿå°±ç­‰ä»·å¾—åˆ°äº†æ³•çº¿çš„æœ€ä¼˜ä¼°è®¡ï¼Œé‚£ä¹ˆæœ€å°äºŒä¹˜é—®é¢˜æœ¬èº«å¯¹åº”ç€æœ€å°ç‰¹å¾å€¼ ä»¥åŠå…¶å¯¹åº”çš„ç‰¹å¾å‘é‡</li>
<li>ä»¥çŸ©é˜µç‰¹å¾å‘é‡çš„æ–¹å‘æ€§æ¥è¯´ï¼Œçº¿æ®µå¯¹åº”çš„æ–¹å‘å‘é‡å°±æ˜¯æœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼ˆå…ƒç´ ä¸»æ–¹å‘ï¼‰ï¼Œè€Œä¸ä¹‹æ­£äº¤çš„ï¼ˆæ¬¡è¦æ–¹å‘ï¼Œç‰¹å¾å‘é‡ä¹Ÿæ˜¯ç›¸äº’æ­£äº¤çš„ï¼Œå°±è·Ÿæ–¹å‘å‘é‡ä¸æ³•çº¿å‘é‡æ­£äº¤ä¸€æ ·ï¼‰æ³•å‘é‡å°±æ˜¯æœ€å°ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚</li>
</ul>
<p>â€‹ é‚£ä¹ˆæ­¤å¤„éœ€è¦é€‰æ‹©æœ€å°çš„å‡ ä¸ªç‰¹å¾å‘é‡ä½œä¸ºâ€œå‰²â€ã€‚å–å¤šå°‘ä¸ªï¼ˆkï¼‰ç‰¹å¾å‘é‡ï¼Œç›¸å½“äºå‰²å‡ºå¤šå°‘ä¸ªç°‡ï¼Œç›¸å½“äºå‰²ä¸Šk-1æ¬¡ï¼Œæ¯ä¸€æ¬¡å¯ä»¥å¾—åˆ°æ–°çš„ç°‡ã€‚æ¯”å¦‚ï¼Œä¸¾ä¸ªä¾‹å­ï¼š <span class="math display">\[
\begin{equation}
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \sqrt{\frac{1}{2}} &amp; \sqrt{\frac{1}{2}} &amp; 0 \\
0 &amp; -\sqrt{\frac{1}{2}} &amp; \sqrt{\frac{1}{2}} &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}
\end{equation}
\]</span></p>
<p>â€‹ è¿™æ˜¯å››ä¸ªç‰¹å¾å‘é‡ï¼Œå·²ç»æŒ‰ç…§ä»å·¦åˆ°å³ç‰¹å¾å€¼é€æ¸å‡å°çš„é¡ºåºæ’åˆ—äº†ã€‚å‡è®¾æˆ‘ä»¬æœ€ç»ˆéœ€è¦å¾—åˆ°ç°‡k = 3ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“éœ€è¦é€‰æ‹©ä¸¤ä¸ªæœ€å°ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡è¿›è¡Œcutã€‚</p>
<ul>
<li>é¦–å…ˆè‡ªç„¶é€‰å–çš„æ˜¯æœ€åä¸€ä¸ªï¼Œè¿™è¯´çš„æ„ä¹‰æ˜¯ï¼šéœ€è¦æŠŠæœ€åä¸€ä¸ªç»“ç‚¹å•ç‹¬å‰²å¼€ï¼Œå…¶ä»–çš„ç»“ç‚¹æš‚æ—¶ä¸ç®¡ã€‚</li>
<li>å€’æ•°ç¬¬äºŒä¸ªç‰¹å¾å‘é‡ï¼Œä¸¤ä¸ªæ­£æ•°ï¼Œè¯´æ˜ç¬¬äºŒï¼Œç¬¬ä¸‰ä¸ªç‚¹æ˜¯åŒä¸€ç±»çš„ï¼Œå‰²ä¸ºä¸€ç±»ã€‚é‚£ä¹ˆæœ€åå¾—åˆ°ï¼š<span class="math inline">\(\{1,\{2,3\},4\}\)</span></li>
</ul>
<hr>
<h2 id="pcaçŸ©é˜µåˆ†æ">PCAçŸ©é˜µåˆ†æ</h2>
<h3 id="ç›´è§‚ç†è§£">ç›´è§‚ç†è§£</h3>
<p>â€‹ ä»¿ä½›åœ¨ä¹‹å‰ä»æ¥æ²¡æœ‰è®¤çœŸæƒ³è¿‡ï¼ŒPCAä¸ºä»€ä¹ˆè¦é€‰å–kä¸ªæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡è¿›è¡Œé™ç»´ï¼Ÿä¹‹å‰å¯¹äºPCAçš„ç†è§£åªæ˜¯åœç•™åœ¨ï¼š</p>
<div class="note warning"><p>â€‹ çŸ©é˜µåˆ†è§£å¯ä»¥å¾—åˆ°å…¶ä¸»æ–¹å‘ï¼Œä¸»æ–¹å‘çš„ä¿ç•™å¯ä»¥ä¿ç•™çŸ©é˜µçš„æ›´å¤šä¿¡æ¯ã€‚</p>
</div>
<p>â€‹ ä½†æ˜¯è¿™åªæ˜¯ç›´è§‚ä¸Šçš„ç†è§£ï¼Œâ€œä¿¡æ¯â€ä¿ç•™çš„å¤šå°‘å¹¶æ²¡æœ‰å¾—åˆ°æ•°å­¦ä¸Šçš„æ¨å¯¼ï¼Œåªèƒ½ç®—ä½œå¯¹PCAç†è®ºçš„é€šä¿—ç†è§£ã€‚æ‰€ä»¥PCAä¸ºä»€ä¹ˆè¦é€‰å–æœ€å¤§kä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Ÿ</p>
<p>â€‹ é¦–å…ˆï¼ŒPCAåˆ†è§£çš„æ˜¯ä»€ä¹ˆï¼Ÿç»è¿‡ã€å»ä¸­å¿ƒåŒ–ã€‘ã€æ ‡å‡†å·®å½’ä¸€åŒ–çš„ã€‘æ•°æ®ï¼Œæ•°æ®åœ¨ç»è¿‡å¦‚ä¸Šçš„ç™½åŒ–å¤„ç†ä¹‹åï¼Œéœ€è¦è¿›è¡Œ<span class="math inline">\(\pmb{x}\pmb{x}^T\)</span>æ“ä½œï¼Œå¾—åˆ°å…¶åæ–¹å·®çŸ©é˜µï¼Œç»´åº¦ d * dï¼Œdä¸ºç‰¹å¾ç©ºé—´çš„ç»´æ•°ï¼Œé™ç»´å®é™…ä¸Šå°±æ˜¯è¦ç»„åˆç‰¹å¾ã€‚é‚£ä¹ˆåæ–¹å·®çŸ©é˜µ<span class="math inline">\(\Sigma\)</span>æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Ÿ <span class="math display">\[
\begin{equation}\label{svd}
\text{SVD}(\Sigma)=USU^T
\end{equation}
\]</span></p>
<p>â€‹ ç›´æ¥è¿›è¡ŒSVDåˆ†è§£ï¼Œç”±äº<span class="math inline">\(\Sigma\)</span>çš„å¯¹ç§°æ€§ï¼Œå¯ä»¥å¾—åˆ°å¦‚å…¬å¼<span class="math inline">\(\eqref{svd}\)</span>æ‰€ç¤ºçš„åˆ†è§£å¼ï¼Œå…¶ä¸­Sæ˜¯å¯¹è§’çŸ©é˜µã€‚å¦‚æœè¯´å…¶ä»–çŸ©é˜µçš„åˆ†è§£ç»“æœæ²¡æœ‰é‚£ä¹ˆç›´è§‚çš„ç‰©ç†æ„ä¹‰çš„è¯ï¼ŒPCAåˆ™å®Œå…¨ä¸ä¸€æ ·ã€‚å¯¹åæ–¹å·®çš„çŸ©é˜µåˆ†è§£æœ‰éå¸¸æ¸…æ™°çš„ç‰©ç†æ„ä¹‰ï¼š<span class="math inline">\(S\)</span>æ˜¯â€œæ ‡å‡†â€çš„åæ–¹å·®ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰ç»è¿‡æ—‹è½¬çš„æ–¹å·®ã€‚å¯ä»¥ç»™ä¸€ä¸ªç®€å•çš„é«˜æ–¯å‡½æ•°çš„ä¾‹å­ã€‚</p>
<p><img src="/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/gauss.JPG"></p>
<center>
Figure 4. ç‹¬ç«‹æƒ…å†µä¸‹çš„åæ–¹å·®ä¸ä¸€èˆ¬åæ–¹å·® é«˜æ–¯
</center>
<p>â€‹ è€Œ<span class="math inline">\(U\)</span>çš„æ„ä¹‰åˆ™æ˜¯ï¼šå¯¹æ–¹å·®è¿›è¡Œæ—‹è½¬ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†è§£å¾—åˆ°äº†ï¼šç‹¬ç«‹æ—¶çš„åæ–¹å·®çŸ©é˜µ<span class="math inline">\(S\)</span>ä»¥åŠåæ–¹å·®çŸ©é˜µ<span class="math inline">\(S\)</span>å¦‚ä½•æ—‹è½¬å¾—åˆ°å½“å‰çš„<span class="math inline">\(\Sigma\)</span>ã€‚è€Œæ°å¥½ï¼Œ<span class="math inline">\(S\)</span>å¯¹è§’å…ƒç´ å¯¹åº”äº†ç‰¹å¾å€¼ã€‚ç‰¹å¾å€¼å¤§ç­‰ä»·äºç‹¬ç«‹æ—¶çš„æ–¹å·®å¤§ï¼Œè€Œ<span class="math inline">\(U\)</span>ç‰¹å¾å‘é‡åˆ™æ˜¯ï¼š<strong><u>å¯¹äºdä¸ªç‰¹å¾çš„çº¿æ€§ç»„åˆå‘é‡</u></strong>ï¼ˆæ¯”å¦‚<span class="math inline">\((1\;\;3\;-2)^T\)</span>ï¼Œå…¶æ„ä¹‰å°±æ˜¯æ–°çš„ç»„åˆç‰¹å¾ï¼šä¸€ä»½ç‰¹å¾ä¸€ åŠ  ä¸‰ä»½ç‰¹å¾äºŒå†å‡å»ä¸¤ä»½çš„ç‰¹å¾ä¸‰ï¼‰ï¼Œåœ¨å¯¹åº”ç‰¹å¾å‘é‡ä¹Ÿå°±æ˜¯ç‹¬ç«‹æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§ç‰¹å¾å‘é‡ç»„åˆçš„ç‰¹å¾åœ¨è¿™ä¸ªç©ºé—´ä¸‹çš„æ–¹å·®å°±æ˜¯ç‰¹å¾å€¼ã€‚</p>
<hr>
<h3 id="ç‰¹å¾åˆ†é‡å·®å¼‚æœŸæœ›æœ€å¤§">ç‰¹å¾åˆ†é‡å·®å¼‚æœŸæœ›æœ€å¤§</h3>
<p>â€‹ é‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›æŠ•å½±ä¹‹åï¼Œæ•°æ®ä¹‹é—´è¿˜èƒ½æœ‰æ¯”è¾ƒå¥½çš„åŒºåˆ†åº¦ï¼ˆå¦‚æœå…¨éƒ¨æŠ•å½±åˆ°ä¸€ä¸ªç‚¹ä¸Šäº†ï¼Œé‚£ä¹ˆå°±è¯´æ˜æŠ•å½±åçš„å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æŸå¤±äº†ï¼‰ï¼Œäºæ˜¯è¦é€‰æ‹©æ–¹å·®å¤§çš„æ–¹å‘æŠ•å½±ã€‚å¯ä»¥è¿™æ ·å…·ä½“åœ°çœ‹ï¼šå¯¹äºä¸€ä¸ªç‰¹å¾ï¼ˆç‰¹å¾ç©ºé—´çš„ä¸€ä¸ªåˆ†é‡ï¼‰ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ ·æœ¬<span class="math inline">\(\pmb{x}_1\)</span>ä¸<span class="math inline">\(\pmb{x}_2\)</span>ï¼Œæ ·æœ¬(1 * d)åœ¨ç»è¿‡ä¸€ä¸ªä¸€ç»´çš„çº¿æ€§å˜æ¢ä¹‹åå˜æˆäº†ä¸€ä¸ªæ ‡é‡ï¼ˆä¹Ÿå°±æ˜¯æ±‚æ–°ç‰¹å¾çš„ä¸€ä¸ªç»´åº¦ï¼Œç»¼åˆï¼ˆçº¿æ€§ç»„åˆï¼‰åŸæ¥æ‰€æœ‰ç»´åº¦çš„ä¿¡æ¯ï¼‰ï¼Œè®¾ä¸º<span class="math inline">\(z_1,z_2\)</span>ï¼Œé‚£ä¹ˆä¸ºäº†ä½¿å¾—ä»»æ„ä¸¤ä¸ªæ ·æœ¬äº§ç”Ÿçš„æ–°ç‰¹å¾å·®å¼‚æœŸæœ›å°½å¯èƒ½å¤§ <span class="math display">\[
\begin{align}
&amp;z_1=F^T\pmb{x}_1\\
&amp;z_2=F^T\pmb{x}_2\\
&amp;\text{max } \mathbb E((z_1-z_2)^2)=\mathbb E(F^T(\pmb{x}_1-\pmb{x}_2)(\pmb{x}_1-\pmb{x}_2)^TF)\label{obj}\\
&amp;\text{s.t. }\Vert F\Vert=1
\end{align}
\]</span></p>
<p>â€‹ ç”±äºFæ˜¯ç¡®å®šæ€§çš„å˜æ¢ï¼Œæ‰€ä»¥å®é™…åªéœ€è¦å¯¹å†…éƒ¨çš„<span class="math inline">\((\pmb{x}_1-\pmb{x}_2)((\pmb{x}_1-\pmb{x}_2))^T\)</span>è¿›è¡ŒæœŸæœ›æ±‚å–å³å¯ï¼Œå¯çŸ¥è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯åæ–¹å·®çŸ©é˜µ<span class="math inline">\(\Sigma\)</span>ã€‚é‚£ä¹ˆå…¬å¼<span class="math inline">\(\eqref{obj}\)</span>å®é™…ä¸Šå˜æˆäº†ä¸‹å¼ï¼ˆæ³¨æ„Fæœ‰çº¦æŸï¼‰ <span class="math display">\[
\begin{equation}
\text{max } \mathbb{E}(F^T\Sigma F)
\end{equation}
\]</span></p>
<p>â€‹ ä¹Ÿå°±æ˜¯æ±‚è¿™ä¸ªäºŒæ¬¡å‹ï¼ˆæ ‡é‡ç»“æœï¼‰çš„æœ€å¤§ã€‚ç”±ç‰¹å¾å‘é‡æ„æˆç­‰ä»·çº¿æ€§ç©ºé—´åŸºçš„æ€§è´¨ä»¥åŠç‰¹å¾å€¼å­˜åœ¨ä¸€å®šå–å€¼èŒƒå›´ï¼Œå¯çŸ¥å·®å¼‚æœ€å¤§å°±æ˜¯è¦é€‰å–æœ€å¤§çš„ç‰¹å¾å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€‰å–å‰kä¸ªæœ€å¤§çš„ç‰¹å¾å€¼æ˜¯å®Œå…¨èƒ½å¤Ÿä¿è¯æ–°ç‰¹å¾åœ¨ç‰¹å¾ç©ºé—´ä¸‹ï¼Œæ ·æœ¬é—´ä¸¤ä¸¤å·®å¼‚çš„æœŸæœ›æœ€å¤§ã€‚</p>
<p>â€‹ å•Šï¼Œå…¶å®è¿™ä¸ªè§£é‡Šå¤šä¹ˆæ¥è¿‘æ­£ç¡®ç­”æ¡ˆå•Šã€‚æˆ‘åœ¨4.17æ™šä¸Šå¤ä¹ LDAçš„æ—¶å€™ï¼Œçªç„¶æƒ³åˆ°äº†å¦‚ä½•æ­£ç¡®åœ°ä»æ•°å­¦è§’åº¦è€Œéç›´è§‚è§’åº¦è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦é€‰æ‹©æœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚LDAä¸­ï¼ˆå¯è§äºåšæ–‡<a href="https://enigmatisms.github.io/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/">[çº¿æ€§/æ ‘å‹åˆ†ç±»å™¨çš„çº¯ç†è®ºåˆ†æ]</a>ï¼‰ï¼ŒLDAå·§å¦™å˜æ¢äº†ç±»é—´æ–¹å·®å’Œç±»å†…æ–¹å·®çš„è¡¨ç¤ºå½¢å¼ã€‚è€ŒPCAä¸­ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç›¸æ±‚æ–¹å·®æœ€å¤§ï¼å¹¶ä¸”è¿˜æ˜¯<strong><u>ç±»å†…æ–¹å·®</u></strong>ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›é™ç»´åçš„æ•°æ®èƒ½å¤Ÿæœ‰æœ€å¥½çš„åŒºåˆ†åº¦ï¼Œä¿ç•™çš„ä¿¡æ¯é‡æœ€å¤§ï¼Œä¹Ÿå°±å¯¹åº”ç€æ–¹å·®æœ€å¤§ï¼Œä¸ªä½“å·®å¼‚å¤§ä»£è¡¨äº†ä¸°å¯Œæ€§ã€‚å‡è®¾é™ç»´åˆ°1ç»´ï¼Œä¹Ÿå³éœ€è¦å¯»æ‰¾ä¸€ä¸ªçº¿æ€§ç»„åˆå‘é‡<span class="math inline">\(w_{k\times 1}\)</span>ï¼Œä½¿å¾—æŠ•å½±åï¼ˆçº¿æ€§ç»„åˆåï¼‰çš„ç‰¹å¾å‘é‡<span class="math inline">\(y=w^T\pmb{x}_{k\times 1}\)</span>æ–¹å·®æœ€å¤§ï¼Œä¹Ÿå³ï¼š <span class="math display">\[
\begin{equation}\label{max2}
\text{max }\sum^{n}(y_i-\overline y)^2\rightarrow \text{max }\sum^{n}(w^T\pmb{x}_i-w^T\overline {\pmb{x}})^2
\end{equation}
\]</span></p>
<p>â€‹ é‚£ä¹ˆæŠŠééšæœºå˜é‡<span class="math inline">\(w\)</span>æå‡ºæ¥æœ‰ï¼š <span class="math display">\[
\begin{align}
\label{max3}
&amp;\text{max }\sum^{n}(y_i-\overline y)^2\rightarrow \text{max }\sum^{n}w^T(\pmb{x}_i-\overline {\pmb{x}})(\pmb{x}_i-\overline {\pmb{x}})^Tw\rightarrow \\
&amp;\text{max }w^T\sum^{n}(\pmb{x}_i-\overline {\pmb{x}})(\pmb{x}_i-\overline {\pmb{x}})^Tw
\end{align}
\]</span></p>
<p>â€‹ åƒLDAä¸€æ ·ï¼ŒæŠŠ<span class="math inline">\(\sum^{n}(\pmb{x}_i-\overline {\pmb{x}})(\pmb{x}_i-\overline {\pmb{x}})^T\)</span>è®¾ä¸ºç±»å†…æ•£åº¦çŸ©é˜µ<span class="math inline">\(S_w\)</span>ï¼Œå…¶æ„ä¹‰å°±æ˜¯å¯¹åŸç©ºé—´ä¸‹æ–¹å·®çš„ä¸€ç§åº¦é‡ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ±‚<span class="math inline">\(\eqref{max3}\)</span>å®šä¹‰çš„æœ€å¤§åŒ–é—®é¢˜äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªå°å°çš„é—®é¢˜ï¼š<span class="math inline">\(w\)</span>çš„æ¨¡é•¿å¯ä»¥æ— é™å¤§ï¼Œå¯¼è‡´<span class="math inline">\(\eqref{max3}\)</span>æ— é™å¤§ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦é™å®š<span class="math inline">\(w\)</span>æ˜¯å•ä½å‘é‡ï¼Œæ¨¡é•¿ä¸º1å³å¯ï¼ˆå®é™…ä¸Šï¼Œè¿™æ°å¥½ç¬¦åˆä¹‹åçŸ©é˜µåˆ†è§£<span class="math inline">\(w\)</span>ä¸ºç‰¹å¾å‘é‡çš„ç‰¹æ€§ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{max4}
\text{max }w^TS_bw\\
\text{s.t. } \Vert w\Vert=1
\end{equation}
\]</span></p>
<p>â€‹ åˆ™æ ¹æ®Lagrangeä¹˜å­ï¼Œå¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{lag}
\text{max }w^TS_bw - \lambda (w^Tw-1)\\
\end{equation}
\]</span></p>
<p>â€‹ KKTæ¡ä»¶ï¼Œå¯¹<span class="math inline">\(w\)</span>æ±‚å¯¼ï¼Œä½¿ç”¨åˆ†å­å¸ƒå±€ï¼ˆç»“æœè½¬ç½®ï¼Œé‚£åˆ†å­å¸ƒå±€å’Œåˆ†æ¯å¸ƒå±€æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{res}
S_bw=\lambda w
\end{equation}
\]</span></p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(w\)</span>ä¸ºä¸€ä¸ªç‰¹å¾å‘é‡ï¼ˆæˆ‘ä»¬çš„çº¿æ€§ç»„åˆæ˜¯ä¸ªç‰¹å¾å‘é‡ï¼Œ<span class="math inline">\(S_b\)</span>çš„ç‰¹å¾å‘é‡ï¼Œ<strong><u><span class="math inline">\(S_b\)</span>æ°å¥½æ˜¯åŸæ¥æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ</u></strong>ï¼‰ã€‚è€Œæ ¹æ®<span class="math inline">\(\eqref{res}\)</span>ï¼Œç­‰å¼å·¦å³å·¦ä¹˜ä»¥<span class="math inline">\(w^T\)</span>ï¼Œå¾—åˆ°ï¼š<span class="math inline">\(w^TS_bw=\lambda w^Tw\)</span>ï¼Œæ ¹æ®<span class="math inline">\(w^Tw=1\)</span>ï¼Œå¯çŸ¥ï¼Œ<span class="math inline">\(w^TS_bw=\lambda\)</span>ã€‚åˆç”±äºéœ€è¦è®©<span class="math inline">\(w^TS_bw\)</span>æœ€å¤§ï¼Œé‚£ä¹ˆ<span class="math inline">\(\lambda\)</span>ä½œä¸ºç‰¹å¾å€¼éœ€è¦é€‰æ‹©æœ€å¤§çš„ã€‚åœ¨å¤šç»´çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§çš„è¢«é€‰èµ°äº†ï¼Œå°±æŒ‰ç…§ç‰¹å¾å€¼å¤§å°æ’åºï¼Œä¾æ¬¡é€‰å–æ¬¡å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å³å¯ã€‚</p>
<p>â€‹ è¿™æ ·å°±å¯ä»¥æ˜ç™½ï¼Œä¸ºä»€ä¹ˆPCAè¦é€‰æ‹©æœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ä½œä¸ºé™ç»´ç»„åˆæ–¹å¼äº†ã€‚å¾ˆå¯æƒœçš„æ˜¯ï¼Œåœ¨<span class="math inline">\(\eqref{obj}\)</span>å¼åˆ†ææ—¶ï¼Œå¹¶æ²¡æœ‰è¿™æ ·å»æ€è€ƒï¼Œä½†æ˜¯åŸæ¥çš„æƒ³æ³•å·²ç»éå¸¸æ¥è¿‘è¿™ä¸ªæˆ‘è®¤ä¸ºæœ€æœ‰è§£é‡ŠåŠ›çš„ç­”æ¡ˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>çº¿æ€§ä»£æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½å§¿å˜æ¢ä¸å…­è½´ä»¿çœŸ</title>
    <url>/2021/10/31/%E4%BD%8D%E5%A7%BF%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%85%AD%E8%BD%B4%E4%BB%BF%E7%9C%9F/</url>
    <content><![CDATA[<h1 id="axis6">Axis6</h1>
<hr>
<p>â€‹ ç¨šæ™–å›ç‰›é€¼ã€‚çœ‹äº†ä»–çš„å…­è½´æœºå™¨äººä¹‹åï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±æ²¡å­¦è¿‡è‡ªåŠ¨åŒ–ã€‚ä¸ºäº†è¯æ˜è‡ªå·±æ˜¯è‡ªåŠ¨åŒ–ä¸“ä¸šçš„å­¦ç”Ÿï¼Œæˆ‘å°è¯•å­¦ä¹ ä»¥åŠæ‰‹æ¨äº†ä¸€ä¸‹æ­£é€†è¿åŠ¨å­¦å…¬å¼ï¼Œæ‰‹å†™äº†ä¸€ä¸ªå…­è½´æœºå™¨äººçš„æ§åˆ¶ã€ä»¿çœŸï¼ˆrvizä»¥åŠGazebo: for those who doesn't know how to pronounce: <code>É¡É™ËˆziËboÊŠ</code>ï¼Œé‡éŸ³åœ¨å‰ï¼‰ï¼Œä»£ç æ”¾åœ¨äº†<a href="https://github.com/Enigmatisms/Axis6">[GithubğŸ”—:Enigmatisms/Axis6]</a>ã€‚æœ¬æ–‡åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>ä½å§¿å˜æ¢/æ­£é€†è¿åŠ¨å­¦çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†</li>
<li>Gazeboçš„é…ç½®ä½¿ç”¨</li>
<li>ä»¿çœŸæ•ˆæœè§†é¢‘ï¼ˆ<del>é«˜æ¸…æ— ç </del>ï¼‰</li>
</ul>
<p>â€‹ è¿™é‡Œæ”¾ä¸¤å¼ å›¾ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/10/31/%E4%BD%8D%E5%A7%BF%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%85%AD%E8%BD%B4%E4%BB%BF%E7%9C%9F/rviz.png" style="zoom:85%;"></th>
<th style="text-align: center;"><img src="/2021/10/31/%E4%BD%8D%E5%A7%BF%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%85%AD%E8%BD%B4%E4%BB%BF%E7%9C%9F/gazebo.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">rvizä»¿çœŸç»“æœ</td>
<td style="text-align: center;">Gazeboä»¿çœŸç»“æœ</td>
</tr>
</tbody>
</table>
<center>
Figure 1. ä»¿çœŸæ•ˆæœå›¾
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-å‰ç½®çŸ¥è¯†">II. å‰ç½®çŸ¥è¯†</h2>
<h3 id="ä½å§¿å˜æ¢å·¦å³ä¹˜">2.1 ä½å§¿å˜æ¢å·¦å³ä¹˜</h3>
<p>â€‹ è¿™ä¸ªé—®é¢˜ä¸ªäººä¹‹å‰ä¸€ç›´æ²¡æœ‰ææ¸…æ¥šï¼Œä¹Ÿæ²¡æœ‰é™ä¸‹å¿ƒæ¥æ¨è¿‡ã€‚</p>
<p>â€‹ ç»™å®šç©ºé—´ä¸­ä¸€ä¸ªç‚¹pä»¥åŠä¸€ä¸ªä½å§¿å˜æ¢<span class="math inline">\(T=[R\quad t]\)</span>ï¼ˆéé½æ¬¡ï¼‰ï¼Œç‚¹pç»è¿‡ä½å§¿å˜æ¢çš„ç»“æœåº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{basic}
p&#39;=Rp+t
\end{equation}
\]</span> â€‹ é‚£ä¹ˆç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘æƒ³å¯¹ç‚¹pè¿›è¡Œå¤šæ¬¡å˜æ¢ï¼Ÿæˆ–è€…æ˜¯è¿›è¡Œä¸€æ¬¡<strong><u>ä¸¤ä¸ªä½å§¿å˜æ¢åˆæˆ</u></strong>å¯¹åº”çš„å˜æ¢ï¼Ÿåº”è¯¥æ€ä¹ˆåšï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªä½å§¿å˜æ¢ï¼š<span class="math inline">\(T_1 = [R_1\quad t_1]\)</span>ä»¥åŠ<span class="math inline">\(T_2 = [R_2\quad t_2]\)</span>ï¼Œä¹ä¸€çœ‹åº”è¯¥è¿™ä¹ˆåšï¼š <span class="math display">\[
\begin{equation}\label{composite}
p&#39;=R_2(R_1p+t_1)+t_2=R_2R_1p+R_2t_1+t_2
\end{equation}
\]</span> â€‹ ä¸Šé¢è¿™ä¸ªå…¬å¼ï¼Œæ€æƒ³éå¸¸ç›´ç™½ã€‚ä¸æ˜¯è¦å¤šæ¬¡å˜æ¢å—ï¼Ÿä¸æ˜¯è¦åˆæˆå—ï¼Ÿé‚£å°±ç›´æ¥å…ˆå˜æ¢ä¸€æ¬¡ï¼Œå†å¯¹ç»“æœå˜æ¢ä¸€æ¬¡å°±è¡Œäº†ã€‚ä½†æ˜¯<strong><u>å®é™…ä¸Šï¼Œå¯¹äºä½å§¿å˜æ¢åˆæˆé—®é¢˜è€Œè¨€ï¼Œè¿™æ˜¯é”™çš„ç»“æœ</u></strong>ã€‚é¦–å…ˆï¼Œæˆ‘åœ¨è¿™é‡Œç»™å‡ºç»“è®ºï¼š <span class="math display">\[
\begin{align}
&amp;p&#39;=R_1(R_2p+t_2)+t_1=R_1R_2p+(R_1t_2+t_1)\tag{åˆæˆå˜æ¢}\\
&amp;p&#39;=R_2(R_1p+t_1)+t_2=R_1R_2p+R_2t_1+t_2\tag{å˜æ¢çš„å¤åˆ}
\end{align}
\]</span> <div class="note danger"><center>
åˆæˆå˜æ¢ï¼Œä¸å˜æ¢çš„å¤åˆæ˜¯ä¸¤å›äº‹ã€‚
</center>
</div></p>
<p>â€‹ å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ¥è§¦çš„éƒ½ä¼šæ˜¯åˆæˆå˜æ¢ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼šç‚¹äº‘é…å‡†ã€‚å‡è®¾ç‚¹äº‘Aåˆ°ç‚¹äº‘Bçš„ä½å§¿å˜æ¢ä¸ºTï¼ˆç‚¹äº‘Aå¯¹åº”çš„æ¿€å…‰å™¨åæ ‡ç³» éœ€è¦ç»è¿‡å˜æ¢Tæ‰èƒ½å˜æ¢åˆ°ç‚¹äº‘Bå¯¹åº”çš„æ¿€å…‰å™¨åæ ‡ç³»ä½ç½®ï¼‰ï¼Œå·²ç»å­˜åœ¨ä¸€ä¸ªç²—ç³™çš„åˆå§‹ä½å§¿å˜æ¢ï¼š<span class="math inline">\(T_0\)</span>ï¼Œè¿™ä¸ªå˜æ¢å¯ä»¥æ˜¯é‡Œç¨‹è®¡æˆ–è€…ä¸€äº›ç®—æ³•ç»™å‡ºçš„ï¼Œéœ€è¦ <strong><u>ç²¾é…å‡†</u></strong> æ¥ä¿®æ­£è¿™ä¸ªä½å§¿å˜æ¢ï¼Œä½¿ä¹‹æ›´ç¬¦åˆå®é™…è§‚æµ‹ï¼Œé‚£ä¹ˆå‡è®¾è¿™ä¸ªç²¾é…å‡†æ¨¡å—æ±‚å‡ºï¼Œç‚¹äº‘åœ¨ä½å§¿<span class="math inline">\(T_0\)</span>ä¸‹ï¼Œè¿˜éœ€è¦è¿›è¡Œçš„å˜æ¢<span class="math inline">\(\Delta T\)</span>ï¼Œæœ€ååˆæˆ<span class="math inline">\(T_0\)</span>ä¸<span class="math inline">\(\Delta T\)</span>å¾—åˆ°æœ€ç»ˆçš„å˜æ¢ã€‚ â€‹ åˆæˆå˜æ¢ä¸å˜æ¢å¤åˆçš„æœ¬è´¨åŒºåˆ«æ˜¯ï¼š<strong>è®¨è®ºçš„åæ ‡ç³»ä¸åŒ</strong>ã€‚å˜æ¢çš„å¤åˆå…·æœ‰éå¸¸ç®€å•çš„æ€æƒ³ï¼Œæ­£å¦‚å‡½æ•°çš„å¤åˆï¼Œå¯¹è¾“å‡ºè¿›è¡Œä¸€æ¬¡æ–°çš„å˜æ¢ã€‚<strong><u>ä¸¤æ¬¡å˜æ¢éƒ½æ˜¯åœ¨åŒä¸€ä¸ªåæ ‡ç³»ä¸‹è®¨è®ºçš„</u></strong>ï¼Œå¯ä»¥è®¤ä¸ºï¼š</p>
<div class="note info"><p>å‚ä¸å˜æ¢å¤åˆçš„ä¸¤ä¸ªå˜æ¢ï¼Œæ˜¯ä¸¤ä¸ªäº’ä¸ç›¸å…³çš„ï¼Œåœ¨åŒä¸€ä¸ªåæ ‡ç³»ä¸‹è®¨è®ºçš„ç»å¯¹ä½å§¿å˜æ¢ï¼Œä¹‹é—´æ²¡æœ‰ç›¸å¯¹æ€§ã€‚</p>
</div>
<p>â€‹ è€Œåˆæˆå˜æ¢ï¼Œåˆ™å…·æœ‰ç›¸å¯¹æ€§ã€‚ä»ç„¶ä»¥ä¸Šé¢çš„ç‚¹äº‘é…å‡†ä¸ºä¾‹å­ï¼Œ<span class="math inline">\(\Delta T\)</span>å˜æ¢æ˜¯åœ¨<span class="math inline">\(T_0\)</span>å˜æ¢çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œæ˜¯åœ¨<span class="math inline">\(T_0\)</span>å¯¹åº”çš„åæ ‡ç³»ä¸‹çš„ä¸€ä¸ªå˜æ¢ï¼Œè€Œ<span class="math inline">\(T_0\)</span>æ˜¯ç›¸å¯¹äºå¦ä¸€ä¸ªåæ ‡ç³»ï¼ˆæ¯”å¦‚å…¨å±€åæ ‡ç³»æˆ–è€…å­åœ°å›¾åæ ‡ç³»è€Œè¨€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<div class="note info"><p>å‚ä¸åˆæˆå˜æ¢çš„ä¸¤ä¸ªå˜æ¢ï¼Œå…·æœ‰å…³è”å…³ç³»ï¼Œå…¶ä¸­çš„ä¸€ä¸ªå˜æ¢æ˜¯åŸºäºå¦ä¸€ä¸ªå˜æ¢ç¡®å®šçš„åæ ‡ç³»æ¥è®¨è®ºçš„ã€‚</p>
</div>
<p>â€‹ æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆåœ¨ä¸¤ç§æƒ…å†µä¸‹çš„ã€åˆæˆçš„ã€‘å˜æ¢åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ <span class="math display">\[
\begin{align}
&amp;T=T_1T_2\tag{åˆæˆå˜æ¢}\\
&amp;T=T_2T_1\tag{å˜æ¢çš„å¤åˆ}
\end{align}
\]</span> â€‹ åªç®€å•è¯´ä¸€ä¸‹åˆæˆå˜æ¢ä¸ºä»€ä¹ˆæ˜¯å³ä¹˜ï¼šæ˜¾ç„¶ï¼Œå› ä¸º<span class="math inline">\(T_2\)</span>æ˜¯åœ¨<span class="math inline">\(T_1\)</span>å˜æ¢åçš„åæ ‡ç³»ä¸‹çš„ä¸€ä¸ªç›¸å¯¹å˜æ¢ï¼Œå…¶ä¸­çš„å¹³ç§»é‡ç›¸å½“äºç›´æ¥è¢«<span class="math inline">\(T_1\)</span>é¢„å…ˆå˜æ¢äº†ä¸€æ¬¡ï¼ˆå¹³ç§»å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªç‚¹ï¼‰ã€‚æ•´ä¸ªå¼å­å¯ä»¥çœ‹æˆæ˜¯ï¼š<span class="math inline">\(T_2\)</span>å˜æ¢è¢«<span class="math inline">\(T_1\)</span>é¢„å…ˆå˜æ¢äº†ä¸€æ¬¡ï¼Œç”±äºæ˜¯<span class="math inline">\(T_1\)</span>æ¥å˜æ¢ï¼ˆåŠ¨è¯ï¼‰<span class="math inline">\(T_2\)</span>ï¼Œåˆ™æ˜¾ç„¶<span class="math inline">\(T_1\)</span>åº”è¯¥æ”¾åœ¨å·¦è¾¹ã€‚</p>
<p>â€‹ æ‰€ä»¥è¦å›ç­”å·¦å³ä¹˜é—®é¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªè§’åº¦åº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>å·¦ä¹˜å¯¹åº”äº†ç»å¯¹å˜æ¢ï¼Œå³ä¹˜å¯¹åº”äº†è¿½åŠ å˜æ¢ï¼Œæ˜¯åœ¨å‰ä¸€å˜æ¢å¯¹åº”åæ ‡ç³»ä¸‹è®¨è®ºçš„ã€‚</li>
</ul>
<h3 id="å·¦å³ä¹˜è®¨è®ºçš„è¡ç”Ÿ">2.2 å·¦å³ä¹˜è®¨è®ºçš„è¡ç”Ÿ</h3>
<p>â€‹ ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªå›¾ï¼š</p>
<p><img src="/2021/10/31/%E4%BD%8D%E5%A7%BF%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%85%AD%E8%BD%B4%E4%BB%BF%E7%9C%9F/transform.png"></p>
<center>
Figure 2. ä½å§¿å˜æ¢ç¤ºæ„å›¾
</center>
<p>â€‹ åæ ‡ç³»1ç»è¿‡ä½å§¿å˜æ¢Tå˜æ¢åˆ°åæ ‡ç³»2ï¼Œé‚£ä¹ˆå¯¹äºä¸¤ä¸ªç³»ä¸­å®šä¹‰çš„ä¸€äº›ç‚¹ï¼Œå…¶åæ ‡å˜æ¢å…¬å¼æ˜¯ä»€ä¹ˆï¼Ÿå‡è®¾ç‚¹påœ¨åæ ‡ç³»iä¸‹çš„åæ ‡æ˜¯<span class="math inline">\(p_i\)</span>ï¼šï¼ˆä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿™ä¸¤ä¸ªåæ ‡éƒ½æ˜¯é½æ¬¡åæ ‡ï¼‰ <span class="math display">\[
\begin{align}
&amp;p_1=Tp_2\label{p1}\\
&amp;p_2=T^{-1}p_1\label{p2}
\end{align}
\]</span> â€‹ ä»åæ ‡ç³»1å˜åˆ°åæ ‡ç³»2æ˜¯å˜æ¢Tï¼Œè€Œåæ ‡ç³»1ç‚¹å˜æ¢åˆ°åæ ‡ç³»2å°±æ˜¯<span class="math inline">\(T^{-1}\)</span>ã€‚è¿™ä¹Ÿå¯ä»¥ç”¨å·¦å³ä¹˜æ¨å‡ºçš„å…¬å¼æ¥è®¨è®ºï¼šå‡è®¾ä¸¤ä¸ªåæ ‡ç³»éƒ½æ˜¯ç›¸å¯¹äºä¸€ä¸ªç»å¯¹çš„åæ ‡ç³»ï¼Œä¸¤ä¸ªåæ ‡ç³»ç›¸å¯¹ç»å¯¹åæ ‡ç³»çš„å˜æ¢åˆ†åˆ«ä¸º<span class="math inline">\(T_1, T_2\)</span>ï¼Œé‚£ä¹ˆå¯¹äºç‚¹pï¼Œä¸¤ä¸ªåæ ‡ç³»å¯¹åº”çš„åæ ‡è½¬æ¢åˆ°ç»å¯¹åæ ‡ç³»ä¸‹åº”è¯¥æ˜¯ç›¸ç­‰çš„ï¼Œå› ä¸ºæè¿°çš„éƒ½æ˜¯ç»å¯¹åæ ‡ç³»ä¸‹çš„ç‚¹<span class="math inline">\(p^{*}\)</span> <span class="math display">\[
\begin{equation}
T_1T_{1-p}p^*=T_2T_{2-p}p^*
\end{equation}
\]</span> â€‹ å› ä¸º<span class="math inline">\(T_{1-p}p^*=p_1\)</span>ä¸”<span class="math inline">\(T_{2-p}p^*=p_2\)</span>ï¼Œè€Œä¸Šå¼æ˜¯ç”±å³ä¹˜ï¼ˆç›¸å¯¹å˜æ¢ï¼‰å¾—åˆ°çš„ï¼Œå¯ä»¥æ¨å‡ºå…¬å¼<span class="math inline">\(\eqref{p1}\)</span>ï¼Œ<span class="math inline">\(\eqref{p2}\)</span>æ¥ã€‚</p>
<h3 id="æ­£é€†è¿åŠ¨å­¦">2.3 æ­£é€†è¿åŠ¨å­¦</h3>
<p>â€‹ å…³äºD-Håæ ‡ä¸æ­£é€†è¿åŠ¨å­¦ï¼Œè¿™ä¸ªäººçš„åšå®¢è®²å¾—å¾ˆæ¸…æ¥šï¼ˆéå¸¸æ¨èï¼Œä»–çš„åšå®¢å†™å¾—ä¸é”™ï¼Œä¸Šä¸€ä¸ªæˆ‘è§‰å¾—å†™å¾—ä¸é”™çš„åšå®¢æ˜¯è‹å‰‘æ—çš„ï¼‰ï¼š</p>
<div class="note success"><center>
<a href="http://gaoyichao.com/Xiaotu/?book=math_physics_for_robotics&title=inverse_kinematics">æ— å¤„ä¸åœ¨çš„å°åœŸ</a>
</center>
</div>
<p>â€‹ å…³äºæ­£é€†è¿åŠ¨å­¦çš„åŸç†ä»¥åŠD-Håæ ‡è¡¨ç¤ºï¼Œæˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œä¸Šé¢é“¾æ¥çš„åšå®¢å·²ç»æœ‰äº†ã€‚æˆ‘å®ç°çš„å…­è½´æœºå™¨äººï¼Œæ­£é€†è¿åŠ¨å­¦çš„æ€æƒ³æ˜¯ä»ä»¥ä¸Šåšå®¢ä»¥åŠWikipediaä¸­å­¦æ¥çš„ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç±»ä¼¼PUMA 560çš„ç®€å•å¸¦çƒè…•å…­è½´æœºå™¨äººï¼Œä½†æ˜¯æ‰€æœ‰çš„å…³èŠ‚ä¸­ï¼Œlink twistéƒ½ä¸å¸¸è§æ¨¡å‹ç›¸åï¼Œæ‰€ä»¥è¿åŠ¨å­¦ä¸å¾—ä¸è‡ªå·±æ¨ã€‚</p>
<p>â€‹ åœ¨æ­¤æˆ‘åªç®€è¿°ä¸€ä¸‹æ­£é€†è¿åŠ¨å­¦çš„æ€æƒ³ï¼š</p>
<div class="tabs" id="class"><ul class="nav-tabs"><li class="tab active"><a href="#class-1">æ­£è¿åŠ¨å­¦</a></li><li class="tab"><a href="#class-2">é€†è¿åŠ¨å­¦</a></li></ul><div class="tab-content"><div class="tab-pane active" id="class-1"><p>å®é™…ä¸Šå°±æ˜¯ï¼Œç»™å®šå„ä¸ªå…³èŠ‚çš„ä½å§¿ï¼Œæ±‚è§£æœºå™¨äººæ‰‹è‡‚æœ«ç«¯çš„ä½å§¿ã€‚è¿™æ˜¯ä¸ªå¾ˆå®¹æ˜“çš„ä»»åŠ¡ï¼Œå°±æ˜¯ç–¯ç‹‚åœ°è¿›è¡Œä½å§¿å˜æ¢åˆæˆã€‚ç”±äºä½¿ç”¨D-Håæ ‡æè¿°ï¼Œä½¿å¾—æè¿°æœºå™¨äººçš„å‚æ•°æœ€ç®€ï¼Œå¹¶ä¸”ä¹Ÿæè¿°äº†ä¸¤ä¸ªå…³èŠ‚ç¡®å®šçš„åæ ‡ç³»ä¹‹é—´çš„ç›¸å¯¹å˜æ¢ï¼Œæ‰€ä»¥å¯ä»¥è½»æ˜“åœ°ä½¿ç”¨ä½å§¿å˜æ¢åˆæˆï¼š <span class="math display">\[
\begin{equation}
T_6^0=T_1^0T_2^1T_3^2T_4^3T_5^4T_6^5
\end{equation}
\]</span> æ¯ä¸ªå…³èŠ‚ç›¸å¯¹äºä¸‹ä¸€ä¸ªå…³èŠ‚çš„ä½å§¿å˜æ¢ï¼Œåœ¨æ­£è¿åŠ¨å­¦ç¯‡å·²ç»è¿›è¡Œäº†è¯¦ç»†çš„è®¨è®ºï¼Œåœ¨ç®€å•çš„é—®é¢˜ä¸­ï¼Œä¹Ÿä¸è¿‡å°±æ˜¯ä½¿ç”¨link length, link offset, link twist, link angleè®¡ç®—å˜æ¢çŸ©é˜µã€‚</p></div><div class="tab-pane" id="class-2"><p>å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜çœ‹ä½œæ˜¯è§£æ–¹ç¨‹ï¼šå·²çŸ¥æœŸæœ›çš„æœ«ç«¯ä½ç½®ï¼Œéœ€è¦æ±‚è§£å‡ºæ¯ä¸ªå…³èŠ‚çš„ä½å§¿ï¼ˆæ¯”å¦‚è§’åº¦ï¼Œå¹³ç§»ï¼‰ã€‚å¤æ‚é—®é¢˜ä¸‹ï¼Œæ˜¯éœ€è¦å¼•å…¥ä¼˜åŒ–çš„æ–¹å¼æ¥æ±‚è§£çš„ï¼ˆå¯èƒ½æ²¡æœ‰ç®€å•çš„é—­å¼è§£ï¼‰ï¼Œè€Œåœ¨ä¸€äº›ç®€å•çš„æƒ…å½¢ä¸‹ï¼Œå¯ä»¥è¿›è¡Œ <strong><u>è§£è€¦</u></strong>ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°å‰åä¸ç›¸å…³è”çš„ä½å§¿å˜æ¢ï¼Œåˆ†è§£é—®é¢˜ä¸ºå­é—®é¢˜ï¼Œå­é—®é¢˜ä¸‹å°±æœ‰å¯èƒ½æ±‚è§£å‡ºé—­å¼è§£ã€‚å¸¦æœ‰çƒè…•çš„é—®é¢˜å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç®€åŒ–æƒ…å½¢ã€‚</p></div></div></div>
<p>â€‹ æˆ‘æ‰€ä½¿ç”¨çš„å…­è½´æœºå™¨äººæ¨¡å‹ï¼Œå‚æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// link offset / link length / link twist / link angle</span></span><br><span class="line"><span class="type">const</span> std::vector&lt;LinkInfo&gt; init_links = &#123;</span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0.5</span>, <span class="number">0</span>, M_PI_2,  <span class="number">0.134140</span>), </span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0.1</span>, <span class="number">0.8</span>, <span class="number">0</span>, <span class="number">0.012189</span>), </span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0.1</span>, <span class="number">0</span>, M_PI_2, <span class="number">-0.036790</span>), </span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0.8</span>, <span class="number">0</span>, M_PI_2, <span class="number">1.596749</span>), </span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0</span>, <span class="number">0</span>, M_PI_2, <span class="number">-0.222030</span>),</span><br><span class="line">    <span class="built_in">LinkInfo</span>(<span class="number">0.4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1.459867</span>)  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â€‹ å°åœŸçš„åšå®¢ä¸­ï¼Œä½¿ç”¨çš„æ˜¯<span class="math inline">\(-\pi / 2\)</span>çš„link twistï¼Œè€Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<span class="math inline">\(\pi/2\)</span>ã€‚å¼€å§‹æˆ‘çš„åº•éƒ¨ä¸‰ä¸ªå…³èŠ‚çš„æ±‚è§£ï¼Œå®Œå…¨æŒ‰ç…§<span class="math inline">\(-\pi/2\)</span>å»æ¨çš„ï¼Œè¿™å½“ç„¶ä¼šæœ‰é—®é¢˜ï¼Œä¹‹åæ‰‹æ¨äº†ä¸€ä¸‹<span class="math inline">\(\pi/2\)</span>çš„æƒ…å†µã€‚</p>
<p>â€‹ é¡¶éƒ¨ä¸‰ä¸ªå…³èŠ‚å¦‚ä½•æ±‚è§£ï¼Œå°åœŸçš„åšå®¢å¹¶æ²¡æœ‰è¯´ï¼Œä½†æ˜¯æ€æƒ³å¤§è‡´è¿˜æ˜¯ä¸€æ ·çš„ï¼šå°†æœ«ç«¯ç‚¹å˜æ¢åˆ°ç¬¬å››ä¸ªå…³èŠ‚å¯¹åº”çš„åæ ‡ç³»ä¸‹ï¼Œä½¿ç”¨æŠ•å½±æ³•æ±‚è§£ã€‚</p>
<h3 id="å¤šè§£é—®é¢˜å¯è¡ŒåŸŸ">2.4 å¤šè§£é—®é¢˜&amp;å¯è¡ŒåŸŸ</h3>
<p>â€‹ ä»¥åº•éƒ¨çš„ä¸‰ä¸ªå…³èŠ‚ä»¥åŠå¯¹åº”æœºæ¢°è‡‚ä¸ºä¾‹ï¼š</p>
<p><img src="/2021/10/31/%E4%BD%8D%E5%A7%BF%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%85%AD%E8%BD%B4%E4%BB%BF%E7%9C%9F/two.png"></p>
<center>
Figure 3. ä½å§¿å˜æ¢ç¤ºæ„å›¾
</center>
<p>â€‹ é»‘è‰²å’Œè“è‰²åˆ†åˆ«è¡¨ç¤ºäº†ä¸¤ç§ä¸åŒè§£ä¸‹çš„æœºæ¢°è‡‚æƒ…å½¢ã€‚å¯¹äºåŒä¸€ä¸ªçƒè…•ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯å³ä¸Šè§’çš„äº¤æ±‡ç‚¹ï¼‰ï¼Œå¯èƒ½æœ‰ä¸¤ä¸ªè§£ï¼Œä¸¤ä¸ªè§£éƒ½æ˜¯éœ€è¦æ±‚å‡ºæ¥çš„ï¼Œä¸åŒçš„å…³èŠ‚ä¼šå½¢æˆè§£ç»„ã€‚æ¯”å¦‚<span class="math inline">\(\theta_1\)</span>ä»¥åŠ<span class="math inline">\(\theta_2\)</span>åˆ†åˆ«å¯¹åº”joint 2çš„ä¸¤ä¸ªç›¸å·®<span class="math inline">\(\pi\)</span>çš„è§£è§’åº¦ã€‚é€‰å–è°ï¼Ÿéœ€è¦æ ¹æ®â€œèƒ½è€—æœ€å°åŸåˆ™â€ï¼šå“ªä¸ªè§£ä¸ä¸Šä¸€æ—¶åˆ»å¯¹åº”çš„è§’åº¦æœ€æ¥è¿‘ï¼Œè¯´æ˜è¿åŠ¨åˆ°å¯¹åº”çš„çŠ¶æ€æ‰€éœ€èƒ½é‡æŸè€—æœ€å°ï¼Œæœºå™¨äººåº”è¯¥æ›´å€¾å‘äºé€‰å–è¿™ä¸ªè§£ã€‚å¤šè§£é—®é¢˜å­˜åœ¨äºçƒè…•ä¸åº•éƒ¨è§’åº¦ä¸Šã€‚</p>
<p>â€‹ ç»™å®šæœ«ç«¯å§¿æ€ä»¥åŠæœ«ç«¯çš„ä½ç½®ï¼Œæœºæ¢°è‡‚å„ä¸ªå…³èŠ‚ä¹Ÿä¸ä¸€å®šæœ‰è§£ï¼Œæ¯”å¦‚ï¼šè¶…å‡ºé•¿åº¦èŒƒå›´ï¼Œæˆ–æ˜¯æ²¡åŠæ³•åŒæ—¶æ»¡è¶³å§¿æ€å’Œä½ç½®ç­‰ç­‰ï¼Œè¿™äº›éƒ½å¯èƒ½ä¼šä½¿å¾—æ±‚è§£ç»“æœæˆNaNï¼Œåªéœ€è¦é™åˆ¶åœ¨è§£ä¸ºNaNæ—¶æ”¾å¼ƒæœ¬æ¬¡æ§åˆ¶ã€‚</p>
<hr>
<h2 id="iii.-gazeboä»¿çœŸ">III. Gazeboä»¿çœŸ</h2>
<p>â€‹ æˆ‘æƒ³å°è¯•ä¸€ä¸‹é™¤äº†rvizä¹‹å¤–çš„å¯è§†åŒ–æ–¹æ³•ï¼Œrvizç‰ˆæœ¬ä¹Ÿå·²ç»åœ¨Axis6è¿™ä¸ªåº“é‡Œå®ç°äº†ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„å¯è§†åŒ–æ ¸å¿ƒå°±åœ¨tfçš„ä½¿ç”¨ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå›°éš¾çš„ï¼Œå¯è§†åŒ–æ—¶ç¢°åˆ°çš„å¤§å¤šæ•°é—®é¢˜å®é™…ä¸Šéƒ½æ˜¯åæ ‡ç³»æˆ–è€…å˜æ¢æ±‚è§£é”™è¯¯çš„é—®é¢˜ã€‚é™¤äº†rvizä¹‹å¤–ï¼Œæˆ‘èƒ½æƒ³åˆ°ä¹Ÿå°±åªæœ‰å¯¥å¯¥å‡ ä¸ªå¯è§†åŒ–å·¥å…·ï¼šOpenGLä»¥åŠå…¶å°è£…çš„Pangolinï¼ŒGazeboã€‚ç”±äºæˆ‘ä»æ¥æ²¡æœ‰ç”¨è¿‡Gazeboï¼Œæ•…æƒ³å°è¯•ä¸€ä¸‹è¿™ä¸ªæ–°ä¸œè¥¿ã€‚</p>
<p>â€‹ æ„å»ºGazeboæœºæ¢°è‡‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<ul>
<li>ç¼–å†™urdfï¼ˆæˆ–è€…xacroï¼‰æè¿°æœºå™¨äººï¼Œä»¥åŠç›¸åº”çš„gazeboæ–‡ä»¶ï¼ˆ.sdfæˆ–è€….gazeboä»¥åŠ.worldï¼‰</li>
<li>æ„å»ºæœºå™¨äººæ§åˆ¶å™¨ï¼ˆtransmissionï¼‰ï¼Œä½¿ç”¨gazebo_rosä»¥åŠgazebo_ros_controlè¿›è¡Œæ§åˆ¶</li>
<li>è°ƒå‚ã€‚è¿™ä¸€æ­¥éƒ½èƒ½æ”¾è¿›æ¥ç¡®å®æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„ã€‚</li>
</ul>
<h3 id="æè¿°æœºå™¨äºº">3.1 æè¿°æœºå™¨äºº</h3>
<p>â€‹ ROS wikiä¸Šå¯¹äºæè¿°æœºå™¨äººä»¥åŠæ¨¡å‹çš„æ–‡ä»¶æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>Xacro (XML Macros) Xacro is an XML macro language. With xacro, you can construct shorter and more readable XML files by using macros that expand to larger XML expressions.[1]</p>
</blockquote>
<blockquote>
<p>Xacro is just a scripting mechanism that allows more modularity and code re-use when defining a URDF model. When using it, what is actually uploaded to the parameter servers (per default as the "robot_description" parameter) actually is a URDF, as that gets generated from the xacro file in the launch file (by expanding the xacro macros used).[2]</p>
</blockquote>
<p>â€‹ è¿™é‡Œä¸»è¦ç»™å‡ºå››ä¸ªéƒ¨åˆ†çš„ä¾‹å­ï¼Œä¸»è¦çœ‹æ³¨é‡Šï¼šä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†æ¥è‡ªäº<code>src/axis6/urdf/axis6.xacro</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        æ­¤å¤„å®šä¹‰çš„æ˜¯æœºæ¢°è‡‚          --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;world&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä¸Šé¢è¿™ä¸ªlinkï¼ˆæœºæ¢°è‡‚ï¼‰æ˜¯ä¸€ä¸ªå›ºå®šçš„è½´ï¼Œæ¯ä¸ªurdféƒ½éœ€è¦å¸¦ï¼Œç›¸å½“äºä¸–ç•Œåæ ‡ç³»--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å®šä¹‰ä¸€ä¸ªæœºæ¢°è‡‚ï¼Œè¿™é‡Œæ˜¯å…­è½´æœºå™¨äººçš„åº•åº§--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;base&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--collisionå±æ€§æ²¡æœ‰å†™ä¸Šæ¥ï¼Œå…¶å®šä¹‰æ–¹å¼ä¸visualç±»ä¼¼ï¼Œå®šä¹‰çš„æ˜¯ç¢°æ’ç®±--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">visual</span>&gt;</span> <span class="comment">&lt;!--è§†è§‰æ•ˆæœï¼Œå®šä¹‰çš„æ˜¯æˆ‘ä»¬èƒ½è§‚å¯Ÿåˆ°çš„æ ·å­--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 0.75&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span> <span class="comment">&lt;!--rpyå¯¹åº”è½´æ˜¯xyz--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">geometry</span>&gt;</span> <span class="comment">&lt;!--å®šä¹‰åŸºç¡€æ¨¡å‹ï¼šä¸€ä¸ªé•¿æ–¹ä½“ï¼Œwidth depth heightæ˜¯xyz--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;0.4 0.4 1.5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;grey&quot;</span>/&gt;</span> <span class="comment">&lt;!--è°ƒç”¨material.xacroä¸­å®šä¹‰çš„é¢œè‰²--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">inertial</span>&gt;</span>	<span class="comment">&lt;!--æƒ¯æ€§åŠ›å­¦ä¿¡æ¯--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--å¯ä»¥è®¤ä¸ºï¼Œæ­¤å¤„å®šä¹‰äº†ä¸€ä¸ªç­‰æ•ˆå‡ ä½•ä½“ï¼Œä½ç½®ä¸å§¿æ€éƒ½ç»™å‡ºäº†ï¼Œå¹¶ä¸”ç»™äº†å¤šè½´æ–¹å‘ä¸Šçš„è´¨é‡åˆ†å¸ƒ--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 0.75&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;mass&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--ä¸€ç§éµå¾ªshellç±»ä¼¼è¯­æ³•çš„å˜é‡è°ƒç”¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">inertia</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ixx</span>=<span class="string">&quot;1.0041666666666669&quot;</span> <span class="attr">ixy</span>=<span class="string">&quot;0.0&quot;</span> <span class="attr">ixz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">iyy</span>=<span class="string">&quot;1.0041666666666669&quot;</span> <span class="attr">iyz</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">izz</span>=<span class="string">&quot;0.13333333333333336&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ­¤å¤„å®šä¹‰çš„æ˜¯å…³èŠ‚ä¿¡æ¯ï¼Œå…³èŠ‚æ˜¯è¿æ¥æœºæ¢°è‡‚ï¼ˆä»¥åŠä¸¤ä¸ªä¸åŒåæ ‡ç³»ï¼‰çš„ç»“æ„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;joint0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;continuous&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jointæ˜¯æœºå™¨äººæœºæ¢°è‡‚ä½å§¿å˜æ¢çš„åŸºç¡€ï¼Œå¯ä»¥è®¤ä¸ºjointå®šä¹‰çš„æ˜¯child linkçš„åæ ‡ç³»--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;world&quot;</span>/&gt;</span>		<span class="comment">&lt;!--çˆ¶ç³»ï¼Œæˆ–è€…ä¸Šä¸€ä¸ªæœºæ¢°è‡‚--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;link1&quot;</span>/&gt;</span>		<span class="comment">&lt;!--å­ç³»ï¼Œè¿æ¥çš„ä¸‹ä¸€ä¸ªæœºæ¢°è‡‚--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å…³èŠ‚ç›¸å¯¹äºä¸Šä¸€ä¸ªåæ ‡ç³»ï¼Œå…¶åŸç‚¹å¹³ç§»åç½®ä»¥åŠzè½´çš„ç›¸å¯¹æ—‹è½¬--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 1.5&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span>/&gt;</span>  	</span><br><span class="line">    <span class="comment">&lt;!--ä½¿ç”¨child linkçš„å“ªä¸€ä¸ªè½´æˆ–è€…å“ªä¸€ä¸ªæ–¹å‘ä½œä¸ºå…³èŠ‚è½¬è½´--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç”µæœºçš„åŠ›çŸ©ä»¥åŠé€Ÿåº¦é™åˆ¶ï¼ˆä¸è¶…è¿‡ä»¥ä¸‹ä¸¤ä¸ªè®¾ç½®å€¼ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åœ¨ã€3.3è°ƒå‚ã€‘ä¸­å¾ˆé‡è¦ï¼‰--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">limit</span> <span class="attr">effort</span>=<span class="string">&quot;50&quot;</span> <span class="attr">velocity</span>=<span class="string">&quot;50&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ä»¥ä¸‹éƒ¨åˆ†æ¥è‡ªäº<code>src/axis6/urdf/axis6.sdf</code>:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- URDFéœ€è¦è½¬ä¸ºgazeboèƒ½ç†è§£çš„sdfç±»å‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">&quot;link1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è®¾ç½®é‡åŠ›ä¸º0ï¼Œæ³¨æ„æ­¤å¤„æœ‰Gazeboçš„bug[3]--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gravity</span>&gt;</span>0<span class="tag">&lt;/<span class="name">gravity</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å…³é—­å†…éƒ¨ç¢°æ’æ£€æµ‹ï¼Œä¹Ÿæœ‰bug[3]--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">self_collide</span>&gt;</span>0<span class="tag">&lt;/<span class="name">self_collide</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸¤ä¸ªæ‘©æ“¦ç³»æ•°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mu1</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">mu1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mu2</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">mu2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¿˜æœ‰kp,kdä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºå®šä¹‰æ¨¡å‹çš„ç¡¬åº¦ï¼Œä¹‹å‰å¥½åƒæ˜¯è¿™æ ·çš„</span></span><br><span class="line"><span class="comment">	å‡å¦‚kpä¸kdå¾ˆæ¥è¿‘ï¼Œé‚£ä¹ˆæ¨¡å‹ä¼šå˜è½¯ï¼Œå¯èƒ½é™·åˆ°åœ°é‡Œï¼Œkp&gt;&gt;kdæ—¶å¾ˆç¡¬ã€‚</span></span><br><span class="line"><span class="comment">	ä¸è¿‡æˆ‘ä¹Ÿæ²¡æœ‰æ·±ç©¶è¿‡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Black<span class="tag">&lt;/<span class="name">material</span>&gt;</span> <span class="comment">&lt;!--é¢œè‰²--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ å®šä¹‰æœºæ¢°è‡‚çš„é‡åŠ›ä¸º0ç»å¸¸å‡ºç°bugï¼Œä¸€ä¼šå„¿è¯´ä½ æœ‰ <code>multiple conflicting &lt;gravity&gt; tag</code> ç„¶åç»™ä½ å¼ºåˆ¶è®¾ä¸º<code>&lt;gravity&gt;true&lt;/gravity&gt;</code>ï¼Œåˆå­˜åœ¨è¿™ä¸ªbug[3]ï¼Œå¯¼è‡´gravityä»¥åŠself_collideä¸¤ä¸ªæ ‡ç­¾éƒ½ä¸èƒ½è¢«æ­£ç¡®è®¾ç½®ã€‚</p>
<p>â€‹ ä»¥ä¸‹éƒ¨åˆ†æ¥è‡ªäº<code>src/axis6/world/axis6.world</code>:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">world</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥å¤–éƒ¨çš„æ¨¡å‹ï¼ˆå¦‚æœæ‰¾ä¸åˆ°ï¼Œæœ‰äº›å¯èƒ½ä¼šåœ¨åŠ è½½æ—¶åœ¨ç½‘ä¸Šä¸‹è½½ï¼‰--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uri</span>&gt;</span>model://ground_plane<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--...çœç•¥éƒ¨åˆ†--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Global light source --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">uri</span>&gt;</span>model://sun<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æœ€åçš„æˆ‘çš„æ¶ˆé‡åŠ›æ–¹å¼ï¼šç›´æ¥è®©ä¸–ç•Œæ²¡æœ‰é‡åŠ›ï¼Œå—¯ï¼Œå¾ˆæš´åŠ›--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gravity</span>&gt;</span>0 0 0<span class="tag">&lt;/<span class="name">gravity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">world</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¼ è¾“æ§åˆ¶">3.2 ä¼ è¾“æ§åˆ¶</h3>
<p>â€‹ å®šä¹‰å¥½è¿™äº›æ–‡ä»¶åï¼Œå†™ä¸€ä¸ªlaunchæ–‡ä»¶ï¼Œå¦‚æœç¼–å†™æ­£ç¡®ï¼Œå°±èƒ½åœ¨Gazeboä¸­ç”Ÿæˆå‡ºå®šä¹‰çš„æœºå™¨äººã€‚ä½†æ­¤æ—¶æœºå™¨äººæ˜¯æ­»çš„ï¼Œæ²¡åŠæ³•æ§åˆ¶ã€‚ä½¿ç”¨gazebo_rosä»¥åŠç›¸å…³æ¨¡å—è¿›è¡Œæ§åˆ¶ï¼Œè¿™å‡ ä¸ªåŒ…éƒ½æ˜¯éœ€è¦è‡ªå·±ä¸‹çš„ï¼Œå»ºè®®ç›´æ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install ros-version-gazebo-ros*</span><br></pre></td></tr></table></figure>
<p>â€‹ transmissionå®šä¹‰çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸ªç”µæœºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">&quot;tran5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰åœ¨å…³èŠ‚5ä¸Šçš„ç”µæœº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;joint5&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/EffortJointInterface</span><br><span class="line">      <span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç”µæœº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">&quot;motor5&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/EffortJointInterface</span><br><span class="line">      <span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mechanicalReduction</span>&gt;</span>1<span class="tag">&lt;/<span class="name">mechanicalReduction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">actuator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ éœ€è¦é…ç½®ä¸€ä¸ªç›¸åº”çš„ç”µæœºconfigæ–‡ä»¶(<code>src/axis6/config/axis6_control.yaml</code>)ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">axis6:</span></span><br><span class="line">  <span class="comment"># Publish all joint states -----------------------------------</span></span><br><span class="line">  <span class="attr">joint_state_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">joint_state_controller/JointStateController</span></span><br><span class="line">    <span class="attr">publish_rate:</span> <span class="number">50</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Position Controllers ---------------------------------------</span></span><br><span class="line">  <span class="attr">joint0_position_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">effort_controllers/JointPositionController</span></span><br><span class="line">    <span class="attr">joint:</span> <span class="string">joint0</span></span><br><span class="line">    <span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">15.0</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">1.2</span>&#125;</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>â€‹ 2-5è¡Œæ˜¯ä¸å¯å°‘çš„ï¼Œæ­¤é¡¹é…ç½®äº†æ•´ä¸ªå…³èŠ‚çŠ¶æ€å‘å¸ƒå™¨ã€‚å‰©ä½™çš„å°±ä¸€ä¸ªä¸ªé…ç½®ï¼Œé…ç½®å…¶ç±»å‹ï¼ˆä½ç½®æ§åˆ¶ç”µæœºï¼Œé€Ÿåº¦æ§åˆ¶ç”µæœºï¼‰ä»¥åŠpidå‚æ•°ï¼ˆ<strong>å¾ˆéš¾è°ƒ</strong>ï¼‰ã€‚</p>
<p>â€‹ åœ¨åŠ å…¥è¿™äº›ä¿¡æ¯ä¹‹åï¼Œå†ç”ŸæˆGazeboä»¿çœŸï¼Œä½¿ç”¨rostopic listå‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸€äº›æ–°çš„topicï¼ˆå®é™…ä¸Šæ˜¯gazeboæ¨¡å‹subscribeçš„ï¼Œä½†å› ä¸ºæ²¡æœ‰é…ç½®rosç«¯ï¼Œæš‚æ—¶æ— publisherï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç®€å•æµ‹è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rostopic pub &lt;topic_nameï¼šæ¯”å¦‚/axis6/joint1_state_controllers/command&gt; &lt;topic_type:ä¸€èˆ¬æ˜¯std_msgs::Float64&gt; &quot;data: &lt;æ§åˆ¶é‡ï¼Œæ¯”å¦‚:1.0&gt;&quot; </span><br></pre></td></tr></table></figure>
<p>â€‹ å‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯å†™ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹ï¼Œå‘å¸ƒå¯¹åº”æ¶ˆæ¯å°±èƒ½è¿›è¡Œæ§åˆ¶äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<h3 id="è°ƒå‚">3.3 è°ƒå‚</h3>
<p>â€‹ ä»¿çœŸï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€å®šè¦çœŸã€‚å³ä½¿æˆ‘æŠŠæ‘©æ“¦å…³äº†ï¼Œç¢°æ’æ£€æµ‹å…³äº†ï¼Œé‡åŠ›å…³äº†ï¼Œæ§åˆ¶ä¹Ÿå¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆç®€å•ã€‚é—®é¢˜ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>æœºæ¢°è‡‚çš„è´¨é‡ä»¥åŠè´¨é‡åˆ†å¸ƒè®¾è®¡å¾—ä¸åˆç†ï¼ˆæ¯”å¦‚æœ«ç«¯å¾ˆé‡ï¼‰</li>
<li>PIDå‚æ•° + ç”µæœºlimitï¼ˆè§xacroæ–‡ä»¶æŒ‰ï¼‰è®¾ç½®çš„ä¸åˆç†ã€‚</li>
</ul>
<p>â€‹ å¯¼è‡´ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼ˆæŠ˜ç£¨äº†æˆ‘ä¸€ä¸‹åˆï¼‰ï¼š</p>
<ul>
<li>ç”µæœºé©±åŠ¨åŠ›ä¸å¤Ÿ + pidå‚æ•°è¿‡å°æ—¶ï¼Œåˆæ…¢åˆè¶…è°ƒ</li>
<li>ç”µæœºé©±åŠ¨åŠ›å……è¶³ + pidå‚æ•°è¾ƒå¤§æ—¶ï¼Œæœºæ¢°è‡‚æŠ–åŠ¨ä¸¥é‡ï¼ˆæœ«ç«¯å°¤ä¸ºä¸¥é‡ï¼‰</li>
<li>ç”µæœºé©±åŠ¨åŠ›å……è¶³ + pidå‚æ•°è¿‡å¤§æ—¶ï¼Œå¯èƒ½ä¼šç‚¸å¼€ã€‚ã€‚ã€‚æœºæ¢°è‡‚ç›´æ¥é£äº†ï¼Œè¿™ä¹Ÿå¤ªçœŸå®äº†</li>
</ul>
<p>â€‹ è§£å†³æ–¹æ¡ˆå½“ç„¶å°±æ˜¯ä¸€ä¸ªä¸ªç”µæœºè°ƒï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">joint0_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">15.0</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">1.2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">joint1_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">10.0</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">0.8</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">joint2_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">5.0</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">0.1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">joint3_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">1.5</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">0.04</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">joint4_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">1.1</span>, <span class="attr">i:</span> <span class="number">0.001</span>, <span class="attr">d:</span> <span class="number">0.08</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">joint5_position_controller:</span></span><br><span class="line">	<span class="attr">pid:</span> &#123;<span class="attr">p:</span> <span class="number">0.25</span>, <span class="attr">i:</span> <span class="number">0.0001</span>, <span class="attr">d:</span> <span class="number">0.0002</span>&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ä»æœ€åº•éƒ¨çš„å…³èŠ‚å¼€å§‹ï¼ˆå®ƒåº”æœ‰çš„é©±åŠ¨èƒ½åŠ›æœ€å¤§ï¼Œå› ä¸ºè´Ÿè½½æœ€å¤§ï¼‰ï¼Œå…³èŠ‚å·è¶Šé«˜ï¼Œå…¶åçš„æœºæ¢°è‡‚è¶Šå°‘ï¼ˆè½½è·è¶Šå°ï¼‰ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼Œlimitä¸­çš„effortä»¥åŠvelocityåº”è¯¥è¶Šå°ï¼ŒPIDå‚æ•°è¶Šå°ï¼Œæœºæ¢°è‡‚ä¹Ÿå°½å¯èƒ½åœ¨æœ«ç«¯å˜è½»ã€‚</p>
<hr>
<h2 id="iv.-æ•ˆæœå±•ç¤º">IV. æ•ˆæœå±•ç¤º</h2>
<p>â€‹ æœ€åçš„æ•ˆæœä¹Ÿå°±æ˜¯ï¼šæœ«ç«¯å¯ä»¥ä¸‰è½´æ–¹å‘å¹³ç§»ï¼Œä»¥åŠç»•æŸä¸€è½´æ—‹è½¬ã€‚æˆ‘å¤ç”¨äº†ä¹‹å‰å†™çš„é”®ç›˜æ§åˆ¶å‡½æ•°ï¼ˆåœ¨LiDARSim2Dåº“å†…ï¼‰ï¼ˆå¤šæŒ‰é”®è§¦å‘ï¼‰ï¼Œæ•…è¿åŠ¨æ˜¯å¯ä»¥åˆæˆçš„ï¼š</p>
<p>â€‹ rvizï¼šä½¿ç”¨tfä»¥åŠvisualization_msg::Markerè¿›è¡Œå¯è§†åŒ–ï¼š</p>
<video src="rviz.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 1. rvizä»¿çœŸç»“æœ
</center>
<p>â€‹ Gazeboï¼šèŠ±äº†å¥½å‡ ä¸ªç©¿æ¨¡çš„é•¿æ–¹ä½“ï¼ˆéšä¾¿ç”»çš„ï¼Œæ²¡å¿…è¦ææœºæ¢°è®¾è®¡äº†ï¼‰:</p>
<video src="gazebo.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Video 2. Gazeboä»¿çœŸç»“æœ
</center>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="http://wiki.ros.org/xacro">ROS wiki: xacro</a></p>
<p>[2] <a href="https://answers.ros.org/question/202162/urdf-or-xacro/">URDF or Xacro?</a></p>
<p>[3] <a href="https://github.com/ignitionrobotics/sdformat/issues/71">Incorrect URDF to SDF conversion of gravity and self_collide tags #71</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>è¿åŠ¨å­¦</tag>
        <tag>Gazebo</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå·ç§¯çš„ä¸€äº›æ€è€ƒ</title>
    <url>/2022/02/11/%E5%85%B3%E4%BA%8E%E5%8D%B7%E7%A7%AF%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
    <content><![CDATA[<iframe src="//www.slideshare.net/slideshow/embed_code/key/EeH6ZygZvj9G5m" width="750" height="420" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%; border-radius: 2px;" allowfullscreen>
</iframe>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå˜å½¢é‡‘åˆšçš„ä¸€äº›æ€è€ƒ</title>
    <url>/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
    <content><![CDATA[<h1 id="transformer">Transformer</h1>
<hr>
<h2 id="i.-å¼•å…¥">I. å¼•å…¥</h2>
<p>â€‹ åœ¨NLPï¼ˆNatural Language Processing è€Œä¸æ˜¯ Non-Linear Programmingï¼‰é—®é¢˜ä¸­ï¼Œç»å¸¸æ¶‰åŠåˆ°sequence to sequenceçš„é—®é¢˜ï¼Œåœ¨è¿™ç§é—®é¢˜ä¸Šæœ€å¹¿ä¸ºäººçŸ¥çš„åº”ç”¨å°±æ˜¯ã€æœºå™¨ç¿»è¯‘ã€‘ï¼š</p>
<blockquote>
<p>Watch out everybody, the potato is really hot. Nice.</p>
<p>å¤§å®¶å¿«çœ‹å¤–é¢æœ‰ä¸€ä¸ªç‰¹åˆ«æ€§æ„Ÿçš„åœŸè±†ã€‚å¥½æ£’å•Šã€‚</p>
</blockquote>
<p>â€‹ è€ŒRNNåŠå…¶å˜ä½“å¦‚GRU/LSTMï¼Œæ—¢ç„¶å±äºRNNèŒƒç•´ï¼Œé‚£å°±å…ä¸äº†<strong><u>ä¸²è¡Œ</u></strong>ä»¥åŠè‡ªé€’å½’ï¼ˆauto-regressionï¼‰ã€‚åœ¨æ•°å­—ä¿¡å·å¤„ç†è¯¾ç¨‹ä¸­å­¦çš„çŸ¥è¯†ï¼šè‡ªé€’å½’å¯¹åº”äº†IIRï¼Œæ—¶åŸŸä¸Šæ¯”FIRå¤æ‚ä¸€äº›ã€‚ç”±äºè¿™ä¸¤ä¸ªæ˜¾è‘—çš„å¼±ç‚¹ï¼Œå¯¼è‡´å…¶æ…¢å¹¶ä¸”é•¿è·ç¦»ä¸‹çš„è¯­ä¹‰è§£æèƒ½åŠ›å·®ï¼ŒVaswaniç­‰äººæå‡ºäº†ä¸€ç§æ–°çš„ åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„å¯å¹¶è¡Œå¤„ç†æ¡†æ¶ - the å˜å½¢é‡‘åˆšã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒJuho-Leeç­‰äººæ„å»ºäº†ä¸€ç§å¯¹é›†åˆæ•°æ®å…·æœ‰ç½®æ¢ä¸å˜æ€§çš„ç½‘ç»œï¼ˆé›†åˆæ— åºï¼Œè¾“å…¥é¡ºåºä¸å½±å“è¾“å‡ºï¼‰ã€‚å› ä¸ºä»å°å°±æ˜¯çœ‹å˜å½¢é‡‘åˆšç³»åˆ—ç”µå½±é•¿å¤§çš„ï¼ˆï¼Ÿï¼‰ï¼Œæˆ‘å®ç°äº†è¿™ä¸¤ç¯‡è®ºæ–‡ä¸­æåˆ°çš„ç¥ç»ç½‘ç»œç»“æ„ï¼Œç”¨åœ¨äº†Set Transformerè®ºæ–‡ä¸­çš„Toy Problem - Max regression ä¸Šã€‚ç»“æœå¦‚ä¸‹å›¾ï¼Œæœ¬æ–‡æ˜¯å¯¹Transformerç›¸å…³ç†è®ºä»¥åŠå®ç°çš„æ€»ç»“ï¼Œå®ç°å·²ç»æŒ‚åœ¨Githubä¸Šäº†ï¼Œè§<a href="https://github.com/Enigmatisms/Set-Transformer">GithubğŸ”—ï¼šEnigmatisms/Set-Transformer</a>ã€‚</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/1.png" style="zoom:75%;"></p>
<center>
Figure 1. Set Transformer Max Regression Problemå®éªŒç»“æœ
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-attentionæœºåˆ¶çš„ç†è§£">II. Attentionæœºåˆ¶çš„ç†è§£</h2>
<h3 id="ä¸rnnçš„å…³ç³»">2.1 ä¸RNNçš„å…³ç³»</h3>
<p>â€‹ RNNä¸­çš„å…¸å‹ç»“æ„ï¼ˆæˆ‘ä¹Ÿä¸è®°å¾—å«ä»€ä¹ˆäº†ï¼‰ï¼Œæ€»ä¹‹æ˜¯ä¸€ä¸ªæœ‰è®°å¿†èƒ½åŠ›çš„Gateã€‚ç¥ç»å…ƒçš„ä¸Šä¸€ä¸ªè¾“å‡ºï¼Œå¯ä»¥ä½œä¸ºæœ¬æ¬¡è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™å¯ä»¥è¢«ç®€å•åœ°è¡¨ç¤ºæˆï¼š <span class="math display">\[
\begin{equation}\label{rnn}
y[n]=a\times h[n]+b\times x[n],\text{ where }h[n]=y[n-1]
\end{equation}
\]</span> â€‹ æ˜¾ç„¶ï¼Œä¸€ä¸ªç®€å•çš„è®°å¿†å•å…ƒå¯ä»¥è¢«è¡¨ç¤ºæˆä¸€ä¸ª<strong><u>ç¦»æ•£ä¸€é˜¶ç³»ç»Ÿ</u></strong>ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªæƒ¯æ€§ç¯èŠ‚å˜›ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸€ä¸ªè‡ªé€’å½’å•å…ƒã€‚å¾ˆå¯æƒœï¼Œè¿™æ ·çš„ç³»ç»Ÿé˜¶æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºåŠ›æ‰è¶Šå¼ºï¼Œä½†ä½œä¸ºä»£ä»·çš„æ˜¯ï¼Œéœ€è¦ç³»ç»Ÿæä¾›å­˜å‚¨å•å…ƒï¼Œå¹¶ä¸”å¯¹äºä¸€ä¸ªké˜¶ç³»ç»Ÿï¼Œå‰kä¸ªå€¼å¦‚æœæ²¡æœ‰å®Œå…¨è®¡ç®—å®Œæˆï¼Œé‚£ä¹ˆç¬¬k+1ä¸ªå€¼æ˜¯æ— æ³•å¾—åˆ°çš„ï¼Œè¿™ä¹Ÿå°±é˜»æ­¢äº†å¹¶è¡Œï¼Œè¿™å¤ªä¸ä¼˜é›…äº†ï¼Œè™½ç„¶å¯èƒ½ ä¸€å®šç¨‹åº¦ä¸Šæ¨¡ä»¿äº†äººç±»çš„ç†è§£æ–¹å¼ï¼šé¡ºåºè¯»ï¼Œå†å¤„ç†é¡ºåºè¾“å…¥çš„ä¿¡æ¯ã€‚</p>
<p>â€‹ æˆ‘ä¸ªäººä¸æ˜¯å¾ˆäº†è§£RNNï¼Œå› ä¸ºä¸ªäººè§‰å¾—è¿™ä¸ªç½‘ç»œç»“æ„å°±æ˜¯ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…ï¼ˆè™½ç„¶çœ‹èµ·æ¥å¾ˆæœ‰é“ç†ï¼‰ï¼ŒåŠ ä¸Šæˆ‘åCVï¼Œä¸€èˆ¬ä¹Ÿç”¨ä¸åˆ°RNNã€‚æˆ‘åœ¨æƒ³ï¼ŒRNNèƒ½åšåˆ°ä»¥ä¸‹çš„äº‹æƒ…å—ï¼Ÿ</p>
<blockquote>
<p>å¦å¤–ï¼Œåœ¨å¸¸è§„æ¥å½“ç§ä¸­æˆ‘ä¹Ÿä»¬å‘ç°ï¼Œå…ç–«ç›¸å¯¹åŠŸèƒ½è¾ƒä½äººçš„ç¾¤ï¼Œä»¥åŠ60å²ä¸Šä»¥çš„äººç¾¤ï¼Œä»–ä»¬æ¥è¸µäº§ç”Ÿåçš„å…æ•ˆç–«æ²¡æœ‰æœ18-59å²çš„å¥½ï¼Œä½†æ˜¯è¿™ç±»äººç¾¤åˆæ˜¯æ°æ°æ„Ÿçš„æŸ“åé«˜å±äººç¾¤</p>
</blockquote>
<p>â€‹ ä¸Šé¢è¿™æ®µè¯çš„å†…å®¹ï¼Œå­˜åœ¨ä¸€äº›é¢ å€’çš„å­—è¯ï¼Œäººå¯èƒ½æ²¡æœ‰å¤ªå¤§çš„é˜…è¯»éšœç¢ï¼Œä½†æ˜¯ä¾èµ–é¡ºåºè¾“å…¥çš„ç½‘ç»œè¡¨ç°ä¼šå¦‚ä½•ï¼Ÿ</p>
<p>â€‹ ä¸ä¹‹ç›¸æ¯”ï¼ŒTransformeræ˜¯ä¸€ç§FIRï¼Œå®ƒæ— éœ€ä¾èµ–è®°å¿†å•å…ƒï¼Œåœ¨è¾“å…¥æ—¶ä¹Ÿæ²¡æœ‰é¡ºåºè¦æ±‚ï¼ˆAttention is All You Needä¸€æ–‡ä¸­ä½¿ç”¨ä¸‰è§’å‡½æ•°Position encodingï¼‰ï¼Œäºæ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œå¹¶è¡Œã€‚å¹¶ä¸”Transformerä½¿ç”¨çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œå°±æ˜¯æ¨¡ä»¿äººç±»ç†è§£ä¿¡æ¯æ—¶ï¼Œæœ‰æ‰€ä¾§é‡çš„ç‰¹æ€§ã€‚</p>
<h3 id="å•å¤´ç»†èŠ‚">2.2 å•å¤´ç»†èŠ‚</h3>
<p>â€‹ Queryï¼ŒKeyï¼ŒValueï¼ˆQ K Vï¼‰çš„ç‰©ç†å«ä¹‰åº”è¯¥å¦‚ä½•ç†è§£ï¼Ÿå‡è®¾é—®é¢˜çš„èƒŒæ™¯æ˜¯æœºå™¨ç¿»è¯‘ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>Qæ˜¯è¾“å…¥è¯­è¨€ï¼Œ(K,V)æ˜¯ç›®æ ‡è¯­è¨€å¯¹åº”çš„ä¿¡æ¯ã€‚è¾“å…¥çš„æ¯ä¸€ä¸ªtokenï¼Œå˜ä¸ºQä¹‹åæŸ¥åº”è¯¥å¯¹åº”ç›®æ ‡è¯­è¨€ä¸­çš„å“ªä¸€ä¸ªè¯ã€‚</li>
<li>Qæ˜¯ç›®æ ‡è¯­è¨€ï¼Œ(K,V)æ˜¯è¾“å…¥è¯­è¨€ä¿¡æ¯ã€‚ç›®æ ‡è¯­è¨€æŸ¥è‡ªå·±åº”è¯¥å¦‚ä½•é€‰æ‹©ç›®æ ‡tokenæ‰èƒ½ä½¿å¾—æœ€ç±»ä¼¼è¾“å…¥</li>
</ul>
<p>â€‹ ä¸ªäººè®¤ä¸ºåœ¨Transformerä¸­ï¼Œåº”è¯¥æ˜¯ç”¨ç¬¬ä¸€ç§æ–¹å¼æ¥å¤„ç†é—®é¢˜ã€‚é‚£ä¹ˆQï¼ŒKï¼ŒVåœ¨å…¶ä¸­çš„ä½œç”¨ä¸ªäººè®¤ä¸ºåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Qï¼šè¾“å…¥embeddingä¿¡æ¯ï¼Œç”¨äºä¸ç›®æ ‡è¯­è¨€çš„ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒ</li>
<li>Kï¼š<strong><u>ç›®æ ‡è¯­è¨€</u></strong>æ„å»ºçš„ï¼Œ<strong><u>æ–¹ä¾¿æºè¯­è¨€ï¼ˆQï¼‰è¿›è¡Œæ¯”è¾ƒ</u></strong>çš„ï¼ŒåŒ…å«ç›®æ ‡embeddingä¿¡æ¯çš„å¼ é‡</li>
<li>Vï¼šç”¨äºè¾“å‡ºçš„ç›®æ ‡embeddingä¿¡æ¯éƒ¨åˆ†</li>
</ul>
<p>â€‹ è€ƒè™‘batchçš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬çš„å¼ é‡shapeï¼ˆä»¥Qä¸ºä¾‹ï¼‰ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š<span class="math inline">\((N_{\text{batch}},M_{\text{seq-len}},K_{\text{embedding-dim}})\)</span>â€‹â€‹ã€‚ä¹Ÿå°±æ˜¯ï¼Œä¸‰ç»´å¼ é‡å·²ç»è¶³å¤Ÿè¡¨ç¤ºï¼šbatch sizeï¼Œåºåˆ—é•¿åº¦ï¼Œä»¥åŠembeddingç»´åº¦ã€‚æœ‰çš„æ—¶å€™ï¼ŒQä¸Kçš„shapeä¼šç›¸åŒï¼Œä»¥ä¸‹ä»¥QKå¤„äºåŒä¸€ä¸ªçº¿æ€§ç©ºé—´ä¸ºä¾‹ï¼Œé‚£ä¹ˆQ/Kæ‰€åœ¨çš„ç©ºé—´å†…å¯ä»¥å½¢æˆGramçŸ©é˜µï¼š</p>
<blockquote>
<p>åœ¨çº¿æ€§ä»£æ•°ä¸­ï¼Œå†…ç§¯ç©ºé—´ä¸­ä¸€æ—å‘é‡çš„æ ¼æ‹‰å§†çŸ©é˜µï¼ˆGramian matrix æˆ– Gram matrix, Gramianï¼‰æ˜¯<strong><u>å†…ç§¯çš„å¯¹ç§°çŸ©é˜µ</u></strong>ï¼Œå…¶å…ƒç´ ç”±<span class="math inline">\(G_{ij}=(v_j|v_i)\)</span>â€‹â€‹ç»™å‡ºã€‚</p>
</blockquote>
<p>â€‹ ä¹‹å‰åœ¨CNN style transferä¸­æ¥è§¦è¿‡ï¼Œè¿™ä¸ªçŸ©é˜µç”¨äºè¡¡é‡ä¸¤ç»„å‘é‡çš„ç›¸ä¼¼ç¨‹åº¦ã€‚å› ä¸ºå†…ç§¯å¯ä»¥ç”¨äºè¡¡é‡ç›¸ä¼¼åº¦ã€‚ä½¿ç”¨å†…ç§¯å°±ä¼šæœ‰ä¸€ç§ä½¿ç”¨agreementæ¦‚å¿µçš„æ„Ÿè§‰ã€‚æœ€åçš„è¾“å‡ºæ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{qkv}
Att(Q,K,V,\omega)=\omega(\frac{QK^T}{\sqrt{k}})V
\end{equation}
\]</span> â€‹ <span class="math inline">\(QK^T\)</span>å°±æ˜¯GramçŸ©é˜µï¼Œè¦æ³¨æ„KVçš„å¯¹åº”æ€§ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼šå‡å¦‚<span class="math inline">\(Q_i\)</span>ä¸<span class="math inline">\(K_j\)</span>çš„ç›¸ä¼¼åº¦é«˜ï¼Œé‚£ä¹ˆ<span class="math inline">\(V_j\)</span>â€‹åº”è¯¥æœ‰æ›´å¤§çš„æƒå€¼ã€‚<span class="math inline">\(\omega\)</span>â€‹æ˜¯éçº¿æ€§å‡½æ•°ï¼Œè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯softmaxï¼Œå˜æ¢ä¸ºå¤šå…ƒç´ çš„æ¦‚ç‡ï¼Œè¿›è¡Œæ¦‚ç‡åŠ æƒã€‚</p>
<p>Softmaxæ²¿ç€å“ªä¸€ä¸ªç»´åº¦åšï¼Ÿå·²çŸ¥QKçš„è®¡ç®—æ˜¯ï¼š<span class="math inline">\(QK^T\)</span>ä¹Ÿå°±æ˜¯<span class="math inline">\((n\times k)\times(k\times n)\)</span>ï¼Œæœ€åç”Ÿæˆ<span class="math inline">\((n\times n)\)</span>â€‹â€‹çŸ©é˜µ</p>
<details class="note primary"><summary><p>æ¯ä¸€ä¸ªQuery tokenä¸keyåŒ¹é…çš„å…³ç³»æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p>
</summary>
<ul>
<li>ä¸€ä¸ªqueryå¯ä»¥é€‰æ‹©å¤šä¸ªkeyï¼Œä¹Ÿå°±æ˜¯é€‰æ‹©ä¸åŒkeyçš„æ¦‚ç‡æ˜¯å½’ä¸€çš„ï¼Œé‚£ä¹ˆå°±æ˜¯è¡Œå’Œä¸ºä¸€ï¼ˆï¼‰</li>
<li>ä¸€ä¸ªkeyå¯¹åº”äº†å¤šä¸ªqueryï¼Œé‚£ä¹ˆå°±æ˜¯åˆ—å’Œä¸º1ï¼ˆåˆ—æ–¹å‘æ±‚å’Œï¼‰ï¼ˆè¿™ä¸ªåœ¨2.2èŠ‚å¼€å¤´å°±å·²ç»è¯´è¿‡äº†ï¼Œå±äºæ–¹å¼2ï¼Œåº”è¯¥æ˜¯ä¸å¯¹çš„ï¼‰ã€‚</li>
</ul>

</details>
<p>â€‹ ä¸ªäººæ›´åŠ å€¾å‘äºï¼Œä¸€ä¸ªqueryå¯ä»¥å¯¹åº”å¤šä¸ªkeyï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªqueryå¯ä»¥æ‰¾åˆ°å¤šä¸ªvalueï¼Ÿä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªqueryå­—ï¼Œä¸æ‰€æœ‰valueå­—çš„æ³¨æ„åŠ›ï¼Œå¯¹åº”çš„æ¦‚ç‡åº”è¯¥å’Œä¸º1ã€‚</p>
<h3 id="å•å¤´ç†è§£-å¤šå¤´åŒ–">2.3 å•å¤´ç†è§£ &amp; å¤šå¤´åŒ–</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/single.PNG" style="zoom:60%;"></th>
<th style="text-align: center;"><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/multi.PNG" style="zoom:50%;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">å•å¤´QKVæ³¨æ„åŠ›å—</td>
<td style="text-align: center;">å¤šå¤´QKVæ³¨æ„åŠ›å—</td>
</tr>
</tbody>
</table>
<p>â€‹ å•å¤´QKVå¯ä»¥ç†è§£æˆï¼šæºæ•°æ®ç»è¿‡ç‰¹å¾æå–å¾—åˆ°Qï¼Œç›®æ ‡ç©ºé—´ç”±Vå¯¹åº”çš„å…ƒç´ å±•æˆï¼ˆspanï¼‰ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªä¸Qä¸­å…ƒç´ ç›¸åŒç»´åº¦çš„æ¯”è¾ƒä¿¡æ¯ï¼ˆKï¼‰ã€‚æºä¿¡æ¯ï¼ˆQï¼‰ä¸éƒ¨åˆ†ç›®æ ‡ä¿¡æ¯ï¼ˆKï¼‰å…ƒç´ ä¸¤ä¸¤æ±‚ç›¸ä¼¼ï¼Œé€šè¿‡ç›¸ä¼¼åº¦è½¬åŒ–ä¸ºçš„æ¦‚ç‡å¯¹Vè¿›è¡ŒåŠ æƒè¾“å‡ºã€‚</p>
<p>â€‹ å¤šå¤´åˆ™æ˜¯æŒ‡ï¼šQ K Vå¹¶ä¸ç›´æ¥è¿›è¡Œå†…ç§¯è¿ç®—ã€‚ä¸€æ˜¯å› ä¸ºå¯èƒ½æ˜¯å¤§çŸ©é˜µï¼Œç›´æ¥å†…ç§¯è®¡ç®—æ—¶é—´é•¿ï¼ŒäºŒæ˜¯å› ä¸ºè¿™æ ·å­¦ä¹ å¾—å‡ºçš„å†…å®¹å¤ªå•ä¸€ã€‚å¤šå¤´æ³¨æ„åŠ›å°±æ˜¯å¸Œæœ›é€šè¿‡å¤šé‡ä½ç»´åº¦æ˜ å°„çš„æ–¹æ³•ï¼Œä½¿å¾—ä¸åŒçš„headèƒ½å¤Ÿå­¦ä¹ åˆ°ä¸åŒçš„æº / ç›®çš„æ•°æ®å…³ç³»ï¼Œ<strong><u>è¿™æ˜¯äº§ç”Ÿå¤šé‡è¯­ä¹‰ç†è§£çš„ä¸€æ­¥ã€‚</u></strong></p>
<hr>
<h2 id="iii.-set-transformer">III. Set Transformer</h2>
<h3 id="inducing-point-isab">3.1 Inducing Point &amp; ISAB</h3>
<p>â€‹ ISABä¸­çš„Inducing Pointsä¸PMAä¸­çš„seedså®é™…ä¸Šæ˜¯ä¸€å›äº‹ï¼Œå«æ³•ä¸åŒã€‚ä»è®ºæ–‡ä¸­æ‘˜å½•çš„æ¡†å›¾è¯´æ˜äº†ISABçš„å®ç°ç»“æ„ã€‚å®ƒçš„æå‡ºæ˜¯ä¸ºäº†è§£å†³SABå¹³æ–¹å¤æ‚åº¦å¯¼è‡´çš„é—®é¢˜ã€‚æ¯”å¦‚å½“é›†åˆç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œä¼šå› ä¸ºå¹³æ–¹çº§åˆ«çš„å¤æ‚åº¦è®¡ç®—å¾ˆé•¿æ—¶é—´ã€‚</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/isab.PNG"></p>
<center>
Figure 2. Attention Blocks
</center>
<p>â€‹ SABçš„æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯<span class="math inline">\(O(n^2)\)</span>ï¼ŸSABä½œä¸ºè‡ªæ³¨æ„åŠ›ç½‘ç»œå—ï¼ŒMulti-head attentionè¾“å…¥çš„Q K Véƒ½æ˜¯Xï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå¯¹äºä¸€ä¸ªè¾“å…¥Xï¼Œä¸è€ƒè™‘å…¶batchå¤§å°ï¼Œå‡è®¾å…¶ä¸ºï¼ˆ<span class="math inline">\(n\times k\)</span>ï¼‰ï¼Œnä¸ºé›†åˆå¤§å°ï¼ˆæˆ–è€…åœ¨NLPä¸­ï¼Œtokençš„æ•°é‡ï¼‰ï¼Œkä¸ºembeddingçš„å¤§å°ã€‚é‚£ä¹ˆæ ¹æ®å†…ç§¯ï¼š <span class="math display">\[
\begin{equation}\label{self_att}
Att(X,X,X,\omega)=\omega(\frac{XX^T}{\sqrt{k}})X
\end{equation}
\]</span> â€‹ è¿‡ç¨‹å¤§æ¦‚æ˜¯ï¼š<span class="math inline">\((n\times k)\times(k\times n)\times(n\times k)\)</span>â€‹ã€‚ç¬¬ä¸€ä¸ªQKé˜¶æ®µå°±å·²ç»éœ€è¦nå¹³æ–¹æ¬¡è®¡ç®—äº†ã€‚è¿™ä¸ªå°±æ˜¯<span class="math inline">\(O(n^2)\)</span>å¤æ‚åº¦çš„ã€‚æ‰€ä»¥ä½œè€…å¸Œæœ›ï¼Œå¯ä»¥å›ºå®šæŸä¸€ç»´åº¦çš„å¤§å°ï¼Œä»¥é™ä½å¤æ‚åº¦ã€‚</p>
<p>â€‹ MABæ˜¯<span class="math inline">\(Att(X,Y,Y,\omega)\)</span>å½¢å¼çš„ï¼Œé‚£ä¹ˆå½“MABçš„è¾“å…¥æ˜¯ï¼š<span class="math inline">\((I,X,X)\)</span>ï¼Œæœ€ç»ˆçš„è®¡ç®—ä¼šæˆä¸ºï¼š<span class="math inline">\((m\times k)\times(k\times n)\times(n\times k)\)</span>ã€‚åœ¨QKé˜¶æ®µï¼Œå†…ç§¯è¿ç®—åªè¿›è¡Œ<span class="math inline">\((mn)\)</span>æ¬¡ï¼Œå¤æ‚åº¦æ˜¯<span class="math inline">\(O(mn)\)</span>ï¼Œå½“è¾“å…¥ä¸ºå¤§é›†åˆæ—¶ï¼Œå¯èƒ½å¯ä»¥æ˜¾è‘—å‡å°è®¡ç®—è´Ÿæ‹…ã€‚æ‰€ä»¥ä¸¤å±‚MABçš„äº¤æ›¿è¾“å…¥ï¼Œç¬¬ä¸€å±‚è¾“å‡º<span class="math inline">\((m\times k)\)</span>ä½œä¸ºç¬¬äºŒå±‚MABçš„Yï¼ŒXæœ¬èº«ä½œä¸ºç¬¬äºŒå±‚çš„Xï¼Œå¯ä»¥æœ€åé‡æ–°æ˜ å°„å›åˆ°<span class="math inline">\((n\times k)\)</span>ç»´åº¦ã€‚</p>
<p>â€‹ ä½œè€…è‡ªå·±ä¹Ÿè¯´ï¼ˆæˆ‘è§‰å¾—ä½œè€…è¿™ä¸ªç±»æ¯”å¾ˆä¸é”™ï¼Œå¾ˆç›´è§‚ï¼‰ï¼ŒISABå°±åƒä¸€ä¸ªç¼–ç å™¨ï¼Œæˆ–è€…è¯´å¸¸è§çš„Detection / Segmentationçš„ä¸¤å¤´å¤§ä¸­é—´å°ç»“æ„ï¼š</p>
<blockquote>
<p>This is analogous to low-rank projection or autoencoder models, where inputs (X) are first projected onto a low-dimensional object (H) and then reconstructed to produce outputs.</p>
</blockquote>
<h3 id="å®ç°ç»†èŠ‚ç»´åº¦">3.2 å®ç°ç»†èŠ‚ï¼šç»´åº¦ï¼Ÿ</h3>
<p>â€‹ å¼€å§‹æ—¶ï¼Œæˆ‘å®ç°äº†ä¸€ç‰ˆè¿™ä¸€æ ·çš„MABï¼Œè¯·çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MAB</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, batch_size, head_num, dk_model, dv_model, use_layer_norm</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.att = Multihead(batch_size, head_num, dk_model, dv_model, use_layer_norm)</span><br><span class="line">        self.ff = nn.Sequential(</span><br><span class="line">            nn.Linear(dv_mode, dv_model),</span><br><span class="line">            nn.ReLU(<span class="literal">True</span>)</span><br><span class="line">        )</span><br><span class="line">        self.layer_norm = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> use_layer_norm == <span class="literal">True</span>:</span><br><span class="line">            self.layer_norm = nn.LayerNorm(dv_model)</span><br><span class="line">        self.remap = nn.Linear(dk_model, dv_model)</span><br></pre></td></tr></table></figure>
<p>â€‹ Multiheadè¿™ä¸ªæ¨¡å—å°±æ˜¯æ ¹æ®<em>Attention is All You Need</em>è¿™ç¯‡æ–‡ç« æ¥çš„ï¼ˆè‡³å°‘æˆ‘è§‰å¾—æˆ‘æ˜¯è¿™ä¹ˆå®ç°çš„ï¼‰ã€‚ä½†æ˜¯å‘ç°ï¼Œè¿™æ²¡åŠæ³•å®ç°ç»´åº¦å˜æ¢ã€‚ä¸ºä»€ä¹ˆï¼Ÿæˆ‘å‘ç°æˆ‘åœ¨è§£å†³ä¸­ä½æ•°é—®é¢˜æ—¶ï¼Œé‡åˆ°äº†è¿™æ ·çš„éš¾é¢˜ï¼š</p>
<ul>
<li>ä¸€ä¸ªè®­ç»ƒç”¨ä¾‹ï¼Œæ˜¾ç„¶æ˜¯<span class="math inline">\(\{x_1,x_2,...,x_n\}\)</span>â€‹â€‹ï¼Œxæ˜¯æ ‡é‡ï¼Œä½¿ç”¨SABæ—¶ï¼Œå†…ç§¯è¿˜æ˜¯æ ‡é‡ï¼Œç”¨å¤„ä¸å¤§ã€‚</li>
<li>ä½ç»´æ•°æ®èƒ½å‘é«˜ç»´è½¬ç§»å—ï¼Ÿè‡ªå·±å®ç°çš„è¿™ä¸€ç‰ˆSABï¼Œè¾“å‡ºå°±æ˜¯ï¼š(batch_size, token_num_Q, embedding_dim_V)ï¼Œå¦‚æœå†…éƒ¨ä¸å¯¹æ•°æ®åšå˜æ¢ï¼Œé‚£ä¹ˆè¾“å‡ºçš„embeddingç»´åº¦å°±æ˜¯1</li>
</ul>
<p>â€‹ ä¸ç®¡æ˜¯åœ¨Transformerè®ºæ–‡è¿˜æ˜¯åœ¨Set Transformerè®ºæ–‡ä¸­ï¼Œæåˆ°Multi-headä¸€å®šåšçš„æ˜¯è¿™ä¸ªäº‹æƒ…ï¼šé¦–å…ˆå°†Q K Vå˜æ¢åˆ°ä½ç»´åº¦ä¸Šï¼ˆä»¥Qä¸ºä¾‹ï¼‰ <span class="math display">\[
\begin{equation}
Q_i=QW_q^i,\text{ where } W_q^i\text{ has shape }(N_{batch},d_q,d_q/M)
\end{equation}
\]</span> â€‹ å°†å˜æ¢åçš„Q K Vè¾“å…¥åˆ°single-head attentionæ¨¡å—ä¸­ã€‚å·§äº†ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œåªä¸è¿‡æ„Ÿè§‰ä¼šå¼•èµ·ç»´åº¦é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>å¯ä»¥è®¾ç½®è¾“å…¥è¾“å‡ºç»´åº¦ï¼ˆè®¾ç½®è¾“å‡ºç»´åº¦æä¸ºé‡è¦ï¼Œå°±åƒæˆ‘ä»¬ç”¨CNNè¾“å‡ºå¤šå°‘ä¸ªChannelä¸€æ ·ï¼Œåº”è¯¥æ˜¯å¯è°ƒçš„ï¼‰</li>
<li>è¾“å…¥æ—¶å¯¹è¾ƒå°çš„ç»´åº¦è¿›è¡Œå‡ç»´ï¼Œä»¥ä¾¿è¿›è¡ŒMulti-headæ“ä½œã€</li>
</ul>
<div class="note warning"><p>â€‹ æ‰€ä»¥Transformeråœ¨å®ç°æ—¶ï¼Œåˆ°åº•åº”è¯¥å¦‚ä½•æ“ä½œï¼ŸQ K Vçœ‹èµ·æ¥å¾ˆç®€å•çš„ä¸‰ä¸ªç»´åº¦è®¾ç½®ï¼Œéœ€è¦ç»Ÿä¸€ç»´åº¦å—ï¼Ÿ</p>
</div>
<p>â€‹ ä¸ªäººè®¤ä¸ºï¼Œåœ¨Set transformerä¸­ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ¨¡å—åº”å½“å®Œå…¨ä¸éœ€è¦å¯¹è¾“å…¥è¿›è¡Œå˜æ¢ï¼Œç›´æ¥ä½¿ç”¨ã€‚è¿™æ ·æ‰å¯ä»¥æ¨¡å—ç‹¬ç«‹ã€‚è€Œä¸åŒçš„Blockä¹‹é—´çš„è¿æ¥ï¼Œæœ‰èµ–äºFeed forwardå±‚ï¼Œæˆ–è€…è¯´ï¼Œæœ‰äº›Blockçš„è¾“å‡ºï¼ˆæ¯”å¦‚MABï¼‰ï¼Œå°±ä¼šç»è¿‡FFNã€‚</p>
<p>â€‹ row-wise feed forward å±‚ï¼Œä¸€èˆ¬æ¥è¯´ä¹Ÿå°±æ˜¯ä¸€ä¸ªå•å±‚çš„çº¿æ€§ç½‘ç»œï¼ˆä¸è¿‡è¦è®°å¾—æ¿€æ´»ï¼Œ<strong><u>å¼€å§‹æ—¶å¿˜è®°</u></strong>åŠ ReLUäº†ï¼Œæ—¢ç„¶æ˜¯å±‚ï¼Œé‚£å°±è¦æœ‰æ¿€æ´»ï¼Œé™¤éæ˜¯è¾“å‡ºï¼‰ã€‚å¯ä»¥è®¤ä¸ºï¼Œæ­¤å¤„å°±æ˜¯ä¸€ä¸ªç±»ä¼¼æ®‹å·®å—çš„ä¸œè¥¿ã€‚è™½ç„¶åœ¨Attention is All You Needä¸­ï¼ŒFFNæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š <span class="math display">\[
\text{FFN}(x)=\max(0,xW_1+b_1)W_2+b_2
\]</span> â€‹ ç›¸å½“äºnn.Linear + nn.ReLU + nn.Linearã€‚ä½†æ˜¯åœ¨Set transformerä¸­ï¼Œå®ç°çš„è²Œä¼¼å«åš row-wiseï¼ˆall you needä¸­å«åšposition-wiseï¼‰ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿä½œè€…æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„ç­”æ¡ˆï¼Œè€Œæ˜¯è¯´ï¼š</p>
<blockquote>
<p>It could reduce to applying a residual block on X. In practice, it learns more complicated functions due to linear projections of X inside attention heads.</p>
</blockquote>
<p>â€‹ æ„Ÿè§‰æŒºæ— åŠ›çš„ï¼Œè¿™äº›æ·±åº¦å­¦ä¹ æ–°çš„ç½‘ç»œæ¶æ„çœ‹èµ·æ¥å¥½åƒç¡®å®æ²¡ä»€ä¹ˆå¯ä»¥è§£é‡Šçš„ï¼Œæ•°å­¦ä¸Šä¹Ÿä¸å¥½è¯´ã€‚æ®‹å·®è¿æ¥åœ¨è¿™ä¼¼ä¹ä¹Ÿä¸å…¶è¢«æå‡ºæ—¶æ‰€è¦è§£å†³çš„é—®é¢˜å¯¹åº”çš„ç›®çš„ä¸åŒï¼Œå› ä¸ºä¸ä¼šæœ‰ä»€ä¹ˆæ¢¯åº¦çˆ†ç‚¸ã€‚</p>
<h3 id="å¤šå¤´æ³¨æ„åŠ›çš„å®ç°">3.3 å¤šå¤´æ³¨æ„åŠ›çš„å®ç°</h3>
<p>â€‹ å¤šå¤´æ³¨æ„åŠ›æ˜¯æˆ‘åœ¨æœ¬æ–‡ä¸­æœ€è§‰å¾—å›°æƒ‘çš„éƒ¨åˆ†ã€‚å› ä¸ºå®˜æ–¹çš„å®ç°ä¸è‡ªå·±çš„è®ºæ–‡ / All you needæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸ç®¡æ˜¯åœ¨Transformer è¿˜æ˜¯ Set Transformerè®ºæ–‡ä¸­ï¼Œæåˆ°çš„å¤šå¤´çš„å®ç°æ–¹å¼æ—¶ï¼Œæ€»ä¼šå°†ä»¥ä¸‹å…¬å¼åˆ—å‡ºæ¥ï¼š <span class="math display">\[
\begin{align}
&amp;\text{output}=\text{cat}[O_1,O_2,...,O_h]\cdot W_o,\text{ where }O_i \label{out}\\
&amp;O_i=Att(Q_i,K_i,V_i,w)\\
&amp;Q_i=QW_Q^i,K_i=KW_K^i,V_i=VW_V^i,
\end{align}
\]</span> â€‹ ä¹Ÿå°±æ˜¯ï¼šå¯¹Q K V æ¯ä¸€é¡¹åˆ†åˆ«ä½¿ç”¨å¤šä¸ªæƒé‡<span class="math inline">\(W\)</span>â€‹â€‹ï¼Œä»åŸæ¥çš„embedding dimension kæ˜ å°„åˆ°ä¸€ä¸ªæ›´ä½çš„ç»´åº¦ï¼ˆå®ç°ä½ç»´å¤šè¾“å…¥ï¼Œä½ç»´ä¸Šçš„æ³¨æ„åŠ›ï¼‰ã€‚â€‹å…¬å¼<span class="math inline">\(\eqref{out}\)</span>â€‹â€‹â€‹â€‹æ˜¯ä¸¤ç¯‡è®ºæ–‡ä¸­éƒ½æœ‰çš„ï¼Œä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰è¿™æ ·å®ç°ã€‚ä½œè€…ç›´æ¥ä½¿ç”¨äº†splitï¼ˆfron Github juho-lee/set_transformerï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Q_ = torch.cat(Q.split(dim_split, <span class="number">2</span>), <span class="number">0</span>)</span><br><span class="line">K_ = torch.cat(K.split(dim_split, <span class="number">2</span>), <span class="number">0</span>)</span><br><span class="line">V_ = torch.cat(V.split(dim_split, <span class="number">2</span>), <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ ç›¸å½“äºï¼Œæœ¬æ¥åº”è¯¥ä½¿ç”¨çº¿æ€§æ˜ å°„åˆ°ä½ç»´çš„Q K Vï¼Œç›´æ¥åœ¨embedding dimensionç»´åº¦åˆ‡å¼€ï¼Œæˆä¸ºhead numberä»½ã€‚è¿™å’Œä½ çš„è®ºæ–‡é‡Œå†™çš„ä¹Ÿä¸ä¸€æ ·å•Šï¼Œä¸ºä»€ä¹ˆå‘€å¤§å“¥ã€‚æ­¤åï¼Œå®˜æ–¹å®ç°æœ‰äº›æ›´è¿·æƒ‘çš„æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">A = torch.softmax(Q_.bmm(K_.transpose(<span class="number">1</span>,<span class="number">2</span>))/math.sqrt(self.dim_V), <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>â€‹ è¿èµ·æ¥å°±æ˜¯ï¼šé¦–å…ˆembeddingç›´æ¥splitæˆå—ï¼Œæ‹¼æ¥åˆ°ç¬¬ä¸€ä¸ªç»´åº¦ä¸Šï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯batchç»´åº¦ï¼‰ï¼Œç›¸å½“äºåŸæ¥batch sizeä¸ºnç°åœ¨å˜æˆäº†<span class="math inline">\(h\times n\)</span>ï¼Œbatchä¹‹é—´ä¸ä¼šæœ‰ç›¸äº’ä½œç”¨ã€‚è®¡ç®—å†…ç§¯ä¹‹åï¼Œå†æ‹†åˆ†å›åˆ°åŸæ¥çš„shapeã€‚æ‰€ä»¥æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ä¸ºä»€ä¹ˆä¸æŒ‰éƒ¨å°±ç­å®ç°ã€‚ã€‚ã€‚å¯èƒ½è¿™å°±æ˜¯å¼ºè€…å§ã€‚æˆ‘çš„å®ç°ï¼Œåªèƒ½è¯´æŒ‰ç€è®ºæ–‡æ¥çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Qs = Q.split(self.dk, dim = -<span class="number">1</span>)</span><br><span class="line">Ks = K.split(self.dk, dim = -<span class="number">1</span>)</span><br><span class="line">Vs = V.split(self.dv, dim = -<span class="number">1</span>)</span><br><span class="line">heads = [self.singleHeadQKVAtt(Qs[i], Ks[i], Vs[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.head_num)]</span><br><span class="line"><span class="comment"># æˆ–è€…ä¸ä½¿ç”¨split</span></span><br><span class="line">Qs = [Q @ self.Wqs[i].repeat(batch_size, <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.head_num)]</span><br><span class="line">Ks = [K @ self.Wqs[i].repeat(batch_size, <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.head_num)]</span><br><span class="line">Vs = [V @ self.Wvs[i].repeat(batch_size, <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.head_num)]</span><br><span class="line"><span class="comment"># each head outputs (n, token_num, token_num) @ (n, token_num, dv_model / head)</span></span><br><span class="line">heads = [self.singleHeadQKVAtt(Qs[i], Ks[i], Vs[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.head_num)]</span><br></pre></td></tr></table></figure>
<p>â€‹ splitæœ¬è´¨ä¸Šä¸çº¿æ€§æ˜ å°„æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç”šè‡³splitå®ç°ä¼šç®€å•å¾ˆå¤šï¼Œå¹¶ä¸”å°‘ä¸€äº›å‚æ•°ã€‚</p>
<hr>
<h2 id="iv.-å¤ç°ç»“æœ">IV. å¤ç°ç»“æœ</h2>
<ul>
<li>å­¦ä¹ ç‡è®¾ç½®</li>
</ul>
<h3 id="å­¦ä¹ ç‡">4.1 å­¦ä¹ ç‡</h3>
<p>â€‹ æµ‹è¯•çš„é—®é¢˜æ˜¯Set Transformerä¸­çš„Max Regressioné—®é¢˜ï¼Œæ‰¾ä¸€ä¸ªé›†åˆçš„æœ€å¤§æ•°ï¼Œæœ¬æ¥æƒ³å®ç°ä¸­ä½æ•°çš„ï¼Œä½†æ˜¯å‘ç°ä¸­ä½æ•°ç®€ç›´æ²¡åŠæ³•ç›´æ¥è®­ç»ƒå‡ºä¸œè¥¿æ¥ã€‚è®­ç»ƒå‚æ•°ï¼šbatch size = 64ï¼Œä¸€ä¸ªé›†åˆ32ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡çš„Xæ˜¯<span class="math inline">\(64 \times 32\)</span>â€‹çŸ©é˜µã€‚æ¨¡å‹éå¸¸éš¾è®­ç»ƒï¼Œä¸»è¦ä½“ç°åœ¨ï¼š</p>
<ul>
<li><p>æˆ‘ä½¿ç”¨exponential learning rate schedulerï¼Œåˆå§‹å­¦ä¹ ç‡1e-3ï¼Œgammaå¤§æ¦‚ä¸º0.9999ï¼ˆè¡°å‡æ…¢ï¼‰ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨åˆå§‹çš„å‡ ç™¾ä¸ªæ ·æœ¬ï¼Œlossä¸‹é™éå¸¸å¿«ã€‚åˆ°lossçº¦ç­‰äº2æ—¶ï¼Œå¯èƒ½ä¸€ç›´å¡åœ¨è¿™ç›´åˆ°ç»“æŸï¼Œæœ€åçš„accä¹Ÿå°±20%ã€‚</p></li>
<li><p>æœ‰å¾ˆå°çš„æ¦‚ç‡ï¼Œå­¦ä¹ ç‡å‡åˆ°å¾ˆå°æ—¶ï¼Œè·³å‡ºå±€éƒ¨æœ€ä¼˜è§£ã€‚accç»§ç»­ä¸Šå‡ï¼Œä½†æ˜¯ç”±äºExpoLRè®©å­¦ä¹ ç‡å˜å¾—å¾ˆå°äº†ï¼Œè®­ç»ƒå¾ˆæ…¢ï¼Œè®­ç»ƒå®Œä¹Ÿåªèƒ½è®©æ¨¡å‹accåˆ°50%ã€‚</p></li>
<li><p>å®˜æ–¹å®ç°å¯ä»¥åœ¨è¾ƒå¤§å­¦ä¹ ç‡æ—¶è·³å‡ºå±€éƒ¨æœ€ä¼˜ã€‚æ‰€ä»¥æœ€åå­¦å¾—å¾ˆå¿«ï¼Œè®­ç»ƒç»“æŸæ—¶åˆ°äº†90%ã€‚</p></li>
</ul>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/2.png"></p>
<center>
Figure 3. æµ‹è¯•ç”¨ä¾‹accï¼ˆæ¯æ¬¡æµ‹è¯•10ä¸ªé›†åˆï¼‰
</center>
<p>â€‹ ä¸Šå›¾ä¸­ï¼Œåœ¨15kä¸ªepochçªç„¶é£™èµ·æ¥çš„æ©™è‰²æ›²çº¿æ˜¯å®˜æ–¹å®ç°æ€è·¯çš„MABï¼Œå¾ˆå¿«å°±æ”¶æ•›äº†ã€‚æ·±è“è‰²æ›²çº¿åˆ™æ˜¯æˆ‘è¯´çš„é‚£ä¸ªexponential LRè®­ç»ƒç»“æœã€‚</p>
<p>â€‹ ä¹‹åæˆ‘æ¢æˆMulti Step LRï¼Œå¼€å§‹200ä¸ªepochå­¦ä¹ ç‡å¾ˆå¤§ï¼Œlossä¸‹é™å¾ˆå¿«ï¼Œ[200,1000]å†…çš„å­¦ä¹ ç‡æ˜¯ä¸Šä¸€é˜¶æ®µçš„1/10ï¼Œæ­¤ååˆ™æ˜¯1/100ã€‚çœ‹èµ·æ¥çœŸçš„æ˜¯å­¦ä¹ ç‡è¿‡å¤§ã€‚æ­¤åå…¶ä»–çš„æ›²çº¿éƒ½æ˜¯å­¦ä¹ ç‡ç²¾è°ƒå¾—åˆ°çš„ç»“æœã€‚</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/4.png"></p>
<center>
Figure 4. æµ‹è¯•ç”¨ä¾‹lossï¼ˆæ¯æ¬¡æµ‹è¯•10ä¸ªé›†åˆï¼‰
</center>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/5.png"></p>
<center>
Figure 5. è®­ç»ƒç”¨ä¾‹loss
</center>
<p>â€‹ å¯ä»¥çœ‹åˆ°ï¼Œç°è‰²çš„æ›²çº¿æ˜¯æœ€åä¸€æ¬¡çš„è®­ç»ƒç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘çš„å®ç°æ¯”å®˜æ–¹å®ç°è®­ç»ƒæ¬¡æ•°å¤šäº†å¥½å‡ å€ï¼Œè¾¾åˆ°çš„accä¹‹æ¯”å®˜æ–¹é«˜äº†ä¸ª4%ã€‚</p>
<hr>
<h2 id="v.-funny-thing-about-transformer">V. Funny Thing about Transformer</h2>
<p>â€‹ è°è®©Vaswanièµ·äº†ä¸€ä¸ªå€å…·äº‰è®®çš„åå­—å‘¢ï¼Ÿ</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a1.PNG"></p>
<p>â€‹ å®åèµåŒæ¥¼ä¸Šï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a3.PNG"></p>
<p>â€‹ èµåŒï¼Œä½†æ˜¯æˆ‘è¦ææ–¹æ¡ˆï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a2.PNG"></p>
<p>â€‹ æˆ‘æœ‰äº›ç–‘é—®ï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a4.PNG"></p>
<p>â€‹ å®ååå¯¹æ¥¼ä¸»ï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a5.PNG"></p>
<p>â€‹ åå¯¹åå¯¹ï¼ˆnmå•Šï¼Œè¿™åå­—çœŸçš„å¾ˆè¸¢é¦†ï¼‰</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a6.PNG"></p>
<p>â€‹ æˆ‘æ¥æŠ˜è¡·ï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a7.PNG"></p>
<p>â€‹ æ³¨æ„åŠ›ï¼Ÿå°é©¬å®è‰ï¼ˆMy Little Ponyç®€ç§°MLPï¼‰æœ€å¼ºï¼š</p>
<p><img src="/2021/08/20/%E5%85%B3%E4%BA%8E%E5%8F%98%E5%BD%A2%E9%87%91%E5%88%9A%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/a8.PNG"></p>
<p>â€‹ ä½ ä»¬æNLPçš„è¿˜æŒºæœ‰æ„æ€çš„ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<ul>
<li><p><a href="https://proceedings.neurips.cc/paper/2017/file/3f5ee243547dee91fbd053c1c4a845aa-Paper.pdf">Vaswani A, Shazeer N, Parmar N, et al. Attention is all you need[C]//Advances in neural information processing systems. 2017: 5998-6008.</a></p></li>
<li><p><a href="http://proceedings.mlr.press/v97/lee19d.html">Lee J, Lee Y, Kim J, et al. Set transformer: A framework for attention-based permutation-invariant neural networks[C]//International Conference on Machine Learning. PMLR, 2019: 3744-3753.</a></p></li>
<li><p><a href="https://github.com/juho-lee/set_transformer">Github: juho-lee/set_transformer</a></p></li>
<li><p><a href="https://spaces.ac.cn/archives/4765/comment-page-1#Attention%E5%AE%9A%E4%B9%89">è‹å‰‘æ—çš„ç§‘å­¦ç©ºé—´:ã€ŠAttention is All You Needã€‹æµ…è¯»ï¼ˆç®€ä»‹+ä»£ç ï¼‰</a></p></li>
</ul>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯å°å­¦ä¹ </title>
    <url>/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="front-end">Front-End</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ æŸå¤©æˆ‘å›è¿‡å¤´æ¥çœ‹è‡ªå·±å¤§ä¸€å†™çš„æ¸¸æˆï¼Œè¶Šç©è¶Šè§‰å¾—åˆ¶ä½œå°½é‡ç»†èŠ‚æ‹‰æ»¡ï¼ˆç¡®å®ï¼Œä¸è¿‡ä¼°è®¡æ˜¯å› ä¸ºæˆ‘å¤§ä¸€éå¸¸é—²ï¼Œå¯ä»¥æ•´å¤©æ³¡åœ¨å†™æ¸¸æˆé‡Œï¼‰ã€‚è™½ç„¶å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—Pygameä¸é€‚åˆåšè¿™ä¸ªæ¸¸æˆï¼Œå¹¶ä¸”æˆ‘è§‰å¾—å¤§ä¸€æ—¶çš„ä»£ç è®¾è®¡æ€æƒ³è¿˜ä¸æˆç†Ÿï¼Œéå¸¸ä¹±ï¼Œæƒ³é‡æ„è¿™ä¸ªæ¸¸æˆã€‚æ€æ¥æƒ³å»ï¼Œç”¨Unityï¼ˆå†™äº†ä¸ªå¼¹ç æ‰“ç –å—æ¸¸æˆï¼‰è§‰å¾—ä¸çˆ½ï¼Œå¹¶ä¸”C#è¯­è¨€é£æ ¼ä¸C++ç±»ä¼¼ï¼Œä¸æƒ³é‡å¤ï¼Œé‚æƒ³ç”¨ä¸€äº›ï¼ˆæ„Ÿè§‰ä¸Šï¼‰å®Œå…¨ä¸ä¸€æ ·çš„è¯­è¨€å»åšè¿™ä»¶äº‹ï¼Œæœ€åç¡®å®šç”¨å‰ç«¯å†™ç½‘é¡µæ¸¸æˆã€‚å‰ç«¯è¯´æœ‰è¶£ï¼Œä¹Ÿè¿˜æŒºæœ‰è¶£çš„ï¼ˆæ¯•ç«Ÿæˆ‘ä¹‹å‰ä¸€ç›´æƒ³å½“å»ºç­‘è®¾è®¡å¸ˆï¼Œæè®¾è®¡çš„çƒ­æƒ…è¿˜æ˜¯æœ‰çš„ï¼‰ï¼Œä½†æ€»æ„Ÿè§‰å°‘äº†ç‚¹æ·±åº¦æ€è€ƒï¼ˆå¯èƒ½å› ä¸ºæˆ‘æ¥è§¦çš„å¤ªç®€å•ï¼‰ã€‚ä¸ºäº†åœ¨å®è·µä¸­å­¦ä¹ å‰ç«¯ï¼Œæˆ‘å°†ä¹‹å‰ç”¨Pygameå®ç°çš„ç”¨æˆ·ç™»å½•ç•Œé¢ç”¨JSå‡çº§äº†ä¸€ä¸‹ï¼ˆåªæ˜¯åŠŸèƒ½å‡çº§ï¼Œå¹¶æ²¡æœ‰æ›´å¥½çœ‹ï¼Œè§<a href="https://github.com/Enigmatisms/JSen">Github:Enigmatisms/JSen</a>ï¼‰ï¼Œæœ¬æ–‡è®°å½•åœ¨åšè¿™ä¸ªå°å°é¡¹ç›®è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/5.png" style="zoom: 40%;"></th>
<th style="text-align: center;"><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/home.png"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Ethians Alpha 1.0 ä¸»èœå•</td>
<td style="text-align: center;">ä¸€ä¸ªï¼ˆä¸ªäººè®¤ä¸ºçš„ï¼‰äººæ€§åŒ–çš„ç™»å½•/æ³¨å†Œç½‘é¡µ</td>
</tr>
</tbody>
</table>
<center>
Figure 1. ç›®æ ‡ ä¸ ç°é˜¶æ®µ å‘å±•ä¸å¹³è¡¡ä¹‹é—´çš„çŸ›ç›¾
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-htmlç¢ç‰‡çŸ¥è¯†">II. HTMLç¢ç‰‡çŸ¥è¯†</h2>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/joke.png"></p>
<center>
Figure 2. href="htmlæ˜¯ç¼–ç¨‹è¯­è¨€!!!.com"
</center>
<p>â€‹ ä¼—æ‰€å‘¨çŸ¥ï¼ŒHTMLæ˜¯ç¼–ç¨‹è¯­è¨€ï¼ˆè¯¯ï¼‰ã€‚ä½œä¸ºä¸€ç§æ ‡è®°è¯­è¨€ï¼Œå½“ç„¶è¦å»è®°å…¶ä¸­çš„æ ‡è®°ä»¥åŠjsä¸­å¦‚ä½•è°ƒç”¨è¿™äº›å…ƒç´ ã€‚è¿™é‡Œåªä¸¾ä¸€äº›ç®€å•çš„ä¾‹å­ï¼š</p>
<h3 id="æ§ä»¶å…ƒç´ ">2.1 æ§ä»¶å…ƒç´ </h3>
<p>â€‹ html5ä¸­æœ‰ä¸€äº›å¾ˆæœ‰è¶£çš„"æ§ä»¶"ï¼Œæ¯”å¦‚<code>button</code> ï¼ˆæŒ‰é”®ï¼‰ï¼Œ<code>input</code> æ–‡æœ¬è¾“å…¥æ¡†ï¼Œ<code>file</code>æ–‡ä»¶ä¸Šä¼ æ¡†ç­‰ç­‰ã€‚è¿™äº›å…ƒç´ æœ‰å…±æ€§ï¼Œä¹Ÿæœ‰ç‰¹æ®Šçš„ç”¨æ³•ã€‚æ¯”å¦‚buttonå’Œinputéƒ½å¯ä»¥ <code>focus</code> ä»¥åŠ <code>blur</code>ï¼š</p>
<ul>
<li>focusï¼šèšç„¦ã€‚å¯¹äºinputæ¥è¯´ï¼Œfocuså‡½æ•°ä¼šä½¿å¾—æ–‡æœ¬è¾“å…¥æ¡†åƒæ˜¯è¢«é€‰ä¸­äº†ä¸€æ ·ï¼ˆå¦‚æœç½‘é¡µä¸­å­˜åœ¨focusä¹‹åçš„textè¾“å…¥æ¡†ï¼Œé‚£ä¹ˆé”®ç›˜è¾“å…¥ä¼šç›´æ¥å‡ºç°åœ¨è¿™ä¸ªè¾“å…¥æ¡†ä¸­ï¼‰ã€‚buttonçš„focus... å¯èƒ½å°±æ˜¯å•çº¯çš„å®šä½å§ï¼ˆä½¿å¾—ç½‘é¡µç¿»é¡µåˆ°buttonæ‰€åœ¨ä½ç½®ï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¯ä»¥å†™ä¸€ä¸ªè¿™æ ·çš„åŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·è¾“å…¥ç”¨æˆ·ååæŒ‰<code>enter</code>é”®å¯ä»¥ç›´æ¥è·³è½¬åˆ°å¯†ç è¾“å…¥æ¡†ä¸Š ---&gt; å¯†ç è¾“å…¥æ¡†.focus()</li>
<li>blurï¼šfocusçš„åä¹‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼šç”¨æˆ·å¡«å†™ä¿¡æ¯ä¹‹åå¸Œæœ›æ”¾å¼ƒæœ¬æ¬¡å¡«å†™ï¼Œç¬¬ä¸€æ¬¡<code>ESC</code>ä½¿å¾—è¾“å…¥æ¡†ä¸å†è¢«é€‰ä¸­ï¼Œç¬¬äºŒæ¬¡ç›´æ¥è¿”å›ä¸Šä¸€çº§ã€‚</li>
</ul>
<p>â€‹ å¯¹åº”çš„ï¼Œæœ‰ä¸€äº›äº‹ä»¶é©±åŠ¨çš„å‡½æ•°ï¼Œæ¯”å¦‚<code>onkeyup</code>ï¼ˆç”¨æˆ·æŒ‰é”®æŠ¬èµ·æ—¶çš„è¡Œä¸ºï¼‰ï¼Œ<code>onclick</code>ï¼ˆç‚¹å‡»æ—¶çš„è¡Œä¸ºï¼‰ï¼Œ<code>onblur</code>ï¼ˆç”¨æˆ·å–æ¶ˆé€‰ä¸­æ—¶çš„è¡Œä¸ºï¼‰ã€‚å½“ç„¶è¿™å¾ˆå¤šéƒ½æ˜¯å’ŒJSç›¸å…³çš„ã€‚</p>
<p>â€‹ ä¸åŒä¹‹å¤„æ¯”å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ textå¯ä»¥æŒ‡å®šè‡ªå·±çš„ç±»å‹ï¼ŒæŒ‡å®šä¸ºpasswordå¯ä»¥è‡ªåŠ¨å›æ˜¾æˆ:black_circle:ï¼Œå¥½ï¼Œå¾ˆæœ‰ç²¾ç¥ã€‚</p>
<h3 id="name-class-id">2.2 name / class / id</h3>
<p>â€‹ æ€ä¹ˆè¯´å‘¢ï¼Œåªèƒ½ç®€å•åŒºåˆ†ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘è¿˜æ²¡æœ‰é‡åˆ°è¿™ä¸‰ä¸ªçš„å‘ï¼ˆè§¦åŠæœ¬è´¨çš„é‚£ç§ï¼‰ã€‚</p>
<ul>
<li>nameï¼šé‡åæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œä¸€ä¸ªhtmlä¸­å¯ä»¥æœ‰å¤šä¸ªnameå±æ€§ä¸ºåŒä¸€ä¸ªå€¼çš„å…ƒç´ ã€‚å¯ä»¥åœ¨jsä¸­ä½¿ç”¨ï¼š<code>getElementsByName</code>ï¼Œæ³¨æ„elementç”¨äº†å¤æ•°å½¢å¼ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªNodeListï¼ˆå¯ä»¥ä¸‹æ ‡ç´¢å¼•ï¼‰ã€‚nameæ–¹ä¾¿äº†åŒç§ç±»å‹å…ƒç´ çš„ç±»ä¼¼æ“ä½œã€‚æ¯”å¦‚æˆ‘å†™çš„é‚£ä¸ª <strong><u>è‡ªåŠ¨è¯„æ•™è„šæœ¬</u></strong>ã€‚</li>
<li>id: è¿™ç©æ„è²Œä¼¼æ˜¯æ¯ä¸ªhtmlæ–‡ä»¶å”¯ä¸€çš„ï¼Œæ¯•ç«Ÿjsæ–¹æ³•æ˜¯ï¼š<code>getElementById</code>ï¼šå”¯ä¸€è¡¨ç¤ºäº†ä¸€ä¸ªå…ƒç´ çš„å­˜åœ¨ï¼ˆç‰¹åŒ–å…ƒç´ çš„å¥½æ–¹æ³•ï¼‰ã€‚</li>
<li>class: ä¸ºä»€ä¹ˆè¦ç”¨classå‘¢ï¼Ÿæ„Ÿè§‰nameå¤„ç†äº†é‡å¤æ€§ï¼Œidå¤„ç†äº†å”¯ä¸€æ€§ï¼Œclasså¥½åƒæ²¡äº‹å¹²ã€‚åŒä¸€classå¯ä»¥æœ‰ä¸åŒçš„nameï¼ŒåŒä¸€nameä¹Ÿå¯ä»¥æœ‰ä¸åŒçš„classï¼Œclasså±æ€§ç›®å‰æˆ‘åœ¨cssä¸­é‡åˆ°è¿‡ï¼Œcssä¸æ–¹ä¾¿å®šä¹‰ä¸€ä¸ªnameçš„æ ·å¼ï¼Œä½†æ˜¯å¯ä»¥å®šä¹‰ä¸€ä¸ªidçš„æ ·å¼ï¼Œè€Œå¦‚æœéœ€è¦å¤šå…ƒç´ ç»Ÿä¸€æ ·å¼ï¼Œå¯ä»¥ä½¿ç”¨classã€‚</li>
</ul>
<h3 id="span-div">2.3 span &amp; div</h3>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">span</a></li><li class="tab"><a href="#span-unique-name-2">div</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ &lt;span&gt;æ˜¯å†…è”å…ƒç´ ï¼Œå†…éƒ¨å¯ä»¥å¡«å……æ–‡æœ¬ã€‚å†…è”å…ƒç´ çš„å¥½å¤„å°±æ˜¯ï¼šæˆ‘ä¸æ¢è¡Œæ˜¾ç¤ºã€‚è¿™æ ·å¯ä»¥åˆ›å»ºä¸€äº›æœ‰name/id/classçš„æ–‡æœ¬è€Œä¸æ¢è¡Œï¼ˆæ³¨æ„&lt;p&gt;ä¹Ÿæ˜¯æ¢è¡Œçš„å—çº§å…ƒç´ ï¼‰ã€‚æˆ‘æŠŠå®ƒç”¨åœ¨äº†ç”¨æˆ·åæˆ–å¯†ç è¾“å…¥ä¸ç¬¦åˆè¦æ±‚æ—¶çš„æç¤ºä¿¡æ¯æ˜¾ç¤ºä¸Šï¼š</p>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/log5.png"></p>
<center>
Figure 3. spançš„åº”ç”¨ï¼ˆçº¢è‰²å­—ä½“åªä¼šåœ¨è¾“å…¥ä¸ç¬¦è¦æ±‚æ—¶å‡ºç°ï¼‰
</center></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ &lt;div&gt;å…ƒç´ æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œéå¸¸å¸¸ç”¨ï¼Œå¸¸è§äºç½‘é¡µçš„ç»„ç»‡ï¼ˆç›¸åŒåŠŸèƒ½çš„æ”¾ä¸€èµ·ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯èŠ±æ‹¬å·äº†ï¼‰ã€‚å®ƒæ˜¯å—çº§å…ƒç´ ï¼ˆè¿™æ„å‘³ç€å®ƒé€šå¸¸éƒ½æ˜¯å¦èµ·ä¸€è¡Œï¼Œå¹¶ä¸”ç»“æŸåä¼šæ¢è¡Œçš„ï¼‰ï¼Œæ‰€ä»¥ä¸å¼•å…¥ä¸€äº›é­”æ³•ï¼ˆæ¯”å¦‚CSSç»„ç»‡ï¼‰å¯èƒ½æ²¡åŠæ³•è®©å…¶ä¸æ¢è¡Œæ˜¾ç¤ºï¼ˆå¯èƒ½åªæ˜¯æˆ‘ä¸çŸ¥é“è€Œå·²ï¼‰:</p>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/div.png"></p>
<center>
Figure 3. å¾ˆå¤šdiv
</center></div></div></div>
<h2 id="iii.-cssç¢ç‰‡çŸ¥è¯†">III. CSSç¢ç‰‡çŸ¥è¯†</h2>
<p>â€‹ æˆ‘ä»æ¥æ²¡æœ‰ç³»ç»Ÿå­¦è¿‡CSSï¼ˆæˆ–è€…æ˜¯HMTLï¼Œéƒ½æ˜¯è¦ç”¨çš„æ—¶å€™å­¦ä¸€ç‚¹ç®—ä¸€ç‚¹ï¼‰ã€‚è™½ç„¶å¦‚æ­¤ï¼Œæˆ‘è§‰å¾—å…¶ä¸­æœ‰äº›å†…å®¹è¿˜æ˜¯æœ‰å¿…è¦ææ¸…æ¥šçš„ï¼Œæ¯•ç«Ÿä¹Ÿä¸èƒ½åªä¼šè€Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p>
<center>
<img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/css.jpg" style="zoom:80%;">
</center>
<center>
Figure 4. Game of Front-end Thrones
</center>
<h3 id="å®šä½">3.1 å®šä½</h3>
<p>â€‹ cssæ¯ä¸ªå…ƒç´ å¯ä»¥æŒ‡å®š<code>position</code>ï¼Œæˆ‘æ¥è§¦è¿‡çš„åªæœ‰å…¶ä¸­ä¸‰ä¸ªï¼ˆå‡†ç¡®æ¥è¯´æ˜¯å››ä¸ªï¼Œç¬¬å››ä¸ª<code>static</code>æ²¡æœ‰æ˜¾å¼ç”¨è¿‡ï¼‰ï¼š</p>
<ul>
<li><code>relative</code>ï¼šrelativeä¼šä¿æŒæ­£å¸¸çš„æ–‡æ¡£flowï¼Œæ¯”å¦‚å†™å¦‚ä¸‹çš„ä»£ç ï¼š</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-class">.relative</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ æ ¹æ®ä»¥ä¸Šçš„CSSä»£ç åœ¨bodyä¸­æ”¾ç½®ä¸¤ä¸ªåŒçº§çš„spanï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;relative&quot;</span>&gt;</span>This div element has position: relative;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span>&gt;</span>This div element has position: relative;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/rel.png"></p>
<center>
Figure 5. åŒrelative
</center>
<p>â€‹ è¯´æ˜æ–‡æ¡£flowï¼ˆå…ƒç´ çš„å…ˆåä½ç½®å…³ç³»ï¼‰æ²¡æœ‰è¢«ç ´åã€‚</p>
<ul>
<li><code>absolute</code>åˆ™æ˜¯ç»å¯¹å®šä½ï¼šå®ƒä¼šå°†å…ƒç´ ä»æ–‡æ¡£flowä¸­å–å‡ºï¼Œæ¯”å¦‚å°†ä¸Šé¢<code>span.text</code>çš„positionå±æ€§æ”¹ä¸º<code>absolute</code>ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</li>
</ul>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/abs.png"></p>
<p>â€‹ æœ¬æ¥<code>span.test</code>è¿™ä¸ªinlineå…ƒç´ åº”è¯¥è·Ÿéšåœ¨<code>span.relative</code>çš„åé¢ï¼Œä½†æ˜¯ç”±äº<code>test</code>ä»flowä¸­å•ç‹¬æå–å‡ºæ¥äº†ï¼Œå®ƒç›¸å¯¹äºå…¶æœ€é‚»è¿‘çš„relativeçˆ¶çº§å…ƒç´ ï¼ˆæœ¬ä¾‹å­ä¸­å°±æ˜¯&lt;body&gt;ï¼‰å®šä½ã€‚</p>
<p>â€‹ æ³¨æ„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨absoluteå®šä½ï¼Œå…¶å®šä½æ–¹å¼æ˜¯ç›¸å¯¹äº <strong><u>æœ€é‚»è¿‘çš„relative çˆ¶çº§å…ƒç´ </u></strong>ã€‚</p>
<h3 id="æ˜¾ç¤º">3.2 æ˜¾ç¤º</h3>
<p>â€‹ <code>display</code>å¯ä»¥æœ‰è¿™æ ·å››ç§å¸¸ç”¨çš„é€‰é¡¹ï¼š<code>none</code>, <code>inline-block</code>ï¼Œ<code>inline</code>, <code>block</code></p>
<ul>
<li><code>none</code>ï¼šå…ƒç´ ä¸è¢«æ¸²æŸ“ï¼Œä¸å ç©ºé—´ã€‚ä¸åƒ<code>visibility: hidden</code>ä¸€æ ·ï¼Œ<code>hidden</code>çš„å…ƒç´ è™½ç„¶çœ‹ä¸è§ï¼Œä½†æ˜¯ä¹Ÿå ä½ç½®</li>
<li><code>inline-block</code>:
<ul>
<li>ä¸<code>inline</code>ä¸åŒä¹‹å¤„åœ¨äºï¼šå®ƒå¯ä»¥è®¾ç½®è¡Œå†…å…ƒç´ çš„width heightä»¥åŠmarginï¼ˆç›¸å½“äºä¸€ä¸ªä¸æ·»åŠ æ¢è¡Œç¬¦çš„å°blockï¼‰</li>
<li>ä¸<code>block</code>ä¸åŒä¹‹å¤„åœ¨äºï¼šå·²ç»è¯´äº†ï¼Œå®ƒä¸ä¼šæ¢è¡Œæ˜¾ç¤º</li>
</ul></li>
</ul>
<h3 id="å­å…ƒç´ é€‰æ‹©">3.3 å­å…ƒç´ é€‰æ‹©</h3>
<p>â€‹ è¿™é‡Œåªç®€å•è®°å½•ä½¿ç”¨åˆ°çš„ä¸€äº›è¯­æ³•ï¼ˆæˆ‘å…¶å®ä¹Ÿå¹¶æ²¡æœ‰ä»”ç»†å»å­¦çš„æ‰“ç®—ï¼Œå‰ç«¯å­¦ä¹ å·¥ä½œçš„ä¼˜å…ˆçº§å¾ˆä½ï¼‰</p>
<ul>
<li><code>#</code> å¯ä»¥ç›´æ¥æŒ‡å®šidï¼Œæ¯”å¦‚<code>#first</code> å°†ä¼šæŒ‡å®š<code>id = first</code>å…ƒç´ çš„æ ·å¼</li>
<li><code>.</code>æ˜¯class selectorï¼Œå¯ä»¥ä¸æŒ‡å®šå…ƒç´ ï¼šæ¯”å¦‚ä¸‹ä»£ç å—ç¬¬ä¸€è¡Œï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…ƒç´ ï¼šæ¯”å¦‚ç¬¬äºŒè¡Œ</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.classname</span> &#123;...&#125;		<span class="comment">/* è¡¨ç¤ºæ‰€æœ‰ class = &quot;classname&quot;çš„å…ƒç´ */</span></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.classname</span> &#123;...&#125;		<span class="comment">/* è¡¨ç¤º spançš„class = &quot;classname&quot;çš„å…ƒç´ */</span></span><br></pre></td></tr></table></figure>
<p>â€‹ æœ‰äº›æœ‰è¶£çš„ä¾‹å­å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« è¯´çš„: <a href="https://css-tricks.com/multiple-class-id-selectors/">Difference between "#header .class" &amp; "#header.class"</a></p>
<h2 id="iv.-jsç¢ç‰‡çŸ¥è¯†">IV. JSç¢ç‰‡çŸ¥è¯†</h2>
<h3 id="æµè§ˆå™¨ç«¯jsä¸æœåŠ¡å™¨ç«¯js">4.1 æµè§ˆå™¨ç«¯jsä¸æœåŠ¡å™¨ç«¯js</h3>
<p>â€‹ æœ¬äººè¿˜å¹¶æ²¡æœ‰å¼€å§‹Node.jsçš„å­¦ä¹ ï¼Œåªæ˜¯äº†è§£äº†ä»¥ä¸‹æµè§ˆå™¨ç«¯JSçš„å†™æ³•ã€‚å¼€å§‹æ—¶æˆ‘è¿˜ä¸çŸ¥é“è¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç›´åˆ°é‡ä¸Šäº†è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<ul>
<li>Log 5.0å¸Œæœ›å¯ä»¥ä»æœ¬åœ°åŠ è½½ç”¨æˆ·æ•°æ®ï¼Œä»¥ä¾¿sign inæ—¶å¯ä»¥æ¯”å¯¹ç”¨æˆ·ã€‚</li>
<li>Sign upæ—¶å¯ä»¥å†™å‡ºåˆ°æœ¬åœ°æ–‡ä»¶</li>
</ul>
</blockquote>
<p>â€‹ æŸ¥äº†å¥½ä¹…ï¼Œéƒ½æ²¡æœ‰å‘ç°æœ‰ä»€ä¹ˆæ¥å£å¯ä»¥å¸®æˆ‘è¯»å‡ºæˆ–è€…å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶çš„ã€‚æœ€åé¢å‘Googleï¼Œæœ‰äººè¯´ï¼šæµè§ˆå™¨ä¸Šè¿è¡Œçš„JSå‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œæ˜¯ä¸å…è®¸å†™å…¥å’Œè¯»å–æœ¬åœ°æ•°æ®çš„ï¼Œå¦‚æœéœ€è¦å®ç°æ–‡ä»¶æ“ä½œï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªæœåŠ¡å™¨hostçš„æ–‡ä»¶ã€‚å®é™…ä¸Šè¿™å°±ä¸æ˜¯å¾ˆå‰ç«¯äº†ã€‚</p>
<p>â€‹ è€ŒNode.js æœ¬è´¨ä¸Šæ˜¯åç«¯è¯­è¨€ï¼ˆåªä¸è¿‡å¯ä»¥ä½¿ç”¨JSè¿™ä¸ªå‰ç«¯è¯­è¨€ç¼–è¾‘ï¼‰ï¼ŒNode.jså¸¸ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œå®ƒæ²¡æœ‰ï¼š</p>
<ul>
<li>BOMï¼ˆBrowser Object Modelï¼‰ï¼šå¯¹æµè§ˆå™¨è¿›è¡Œè®¿é—®å’Œæ“ä½œçš„æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>window</code>è¿™ä¸ªæ²¡æœ‰äº†</li>
<li>DOM ï¼ˆDocument Object Modelï¼‰ï¼š <code>document</code>ä»¥åŠå…¶ä¸‹å±å…ƒç´ ä¹Ÿæ²¡æœ‰äº†</li>
</ul>
<p>â€‹ åŸæ¥æœ¬äººä¸Šæ‰‹ç”¨æµè§ˆå™¨ç«¯jsï¼Œä½†æƒ³åšä¸€äº›åç«¯çš„äº‹æƒ…ã€‚</p>
<div class="note danger"><p>å­¦ä¹ è¯­è¨€è¿™æ ·çš„ä¸œè¥¿æ—¶ï¼Œæˆ‘å»¶ç»­äº†Python/C++çš„å­¦ä¹ æ–¹å¼ï¼šä¸Šæ‰‹å°±æ˜¯è‡ªè¡Œè®¾è®¡é¡¹ç›®å¹¶é€šè¿‡å®è·µæ¥å­¦ä¹ ã€‚è¿™ç§å­¦ä¹ æ–¹å¼æœ‰çš„æ—¶å€™å¯èƒ½å¹¶ä¸å¥½ï¼Œç‰¹åˆ«æ˜¯åœ¨å…¶å‰é©±çŸ¥è¯†ä¸ç‰¢å›ºçš„æƒ…å†µä¸‹ã€‚ä¸çœ‹ç†è®ºã€æ•™ç¨‹ã€æ–‡æ¡£å¯èƒ½åªèƒ½è®©æˆ‘ä»¬æ˜ç™½ <strong><u>å¦‚ä½•è§£å†³é—®é¢˜</u></strong> è€Œä¸æ˜¯ <strong><u>å¦‚ä½•åˆ†æé—®é¢˜å¹¶è®¾è®¡æ–¹æ³•</u></strong>ã€‚</p>
</div>
<h3 id="æœ¬åœ°æœåŠ¡å™¨å°å‘">4.2 æœ¬åœ°æœåŠ¡å™¨å°å‘</h3>
<p>â€‹ æˆ‘ä»¬å·²çŸ¥æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸èƒ½éšä¾¿åŠ è½½æœ¬åœ°æ–‡ä»¶è¿™ä¸€äº‹å®ã€‚åŠ è½½æœ¬åœ°æ–‡ä»¶ä¸ä¸€å®šè¦æ˜¯è¿›è¡Œæ•°æ®çš„è¯»å…¥æˆ–è€…å†™å‡ºï¼Œæ¯”å¦‚æœ€åŸºæœ¬çš„ <strong><u>è·¨æ¨¡å—è°ƒï¼ˆå¼•ï¼‰ç”¨</u></strong> éƒ½å±äºä¸€ç§åŠ è½½æœ¬åœ°æ–‡ä»¶çš„è¡Œä¸ºã€‚æ¯”å¦‚æˆ‘æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>a.js</code> ä»¥åŠ<code>b.js</code>ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><code>a.js</code>ç›¸å½“äºä¸€ä¸ªutilityæ¨¡å—ï¼Œå®šä¹‰äº†å¾ˆå¤šæœ‰è¶£çš„å¸¸ç”¨å‡½æ•°</li>
<li><code>b.js</code>ç›¸å½“äºä¸€ä¸ªå®¢æˆ·æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨<code>a.js</code>çš„å‡½æ•°</li>
<li><code>c.html</code>è°ƒç”¨äº†<code>b.js</code>æ¨¡å—ï¼ˆä½œä¸ºç½‘é¡µçš„è¡Œä¸ºï¼‰</li>
</ul>
<p>â€‹ é‚£ä¹ˆè¿™æ¶‰åŠåˆ°importä¸exportã€‚ä½†æ˜¯ç”±äºåŸºäºæœ¬åœ°æ–‡ä»¶çš„import, exportæ˜¯ä¸å…è®¸çš„ï¼ˆæœ¬è´¨æ˜¯åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼‰ï¼Œå¦‚æœç›´æ¥åœ¨æœ¬åœ°ä½¿ç”¨æ–‡ä»¶æ‰“å¼€ï¼Œä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p>
<p><img src="/2021/12/26/%E5%89%8D%E7%AB%AF%E5%B0%8F%E5%AD%A6%E4%B9%A0/error.png"></p>
<center>
Figure x. CORSé”™è¯¯ æ— æ³•åŠ è½½ç‰¹å®šçš„æœ¬åœ°æ–‡ä»¶
</center>
<p>â€‹ ä½†æ˜¯å¦‚æœæˆ‘ä½¿ç”¨æœåŠ¡å™¨ï¼Œå°†<code>c.html</code>å®šä¹‰çš„ç½‘ç«™æŒ‚åœ¨ä¸Šé¢ï¼Œå†ä½¿ç”¨æœåŠ¡å™¨å¯¹åº”çš„urlè®¿é—®ç½‘é¡µæ—¶å¹¶ä¸ä¼šæœ‰æ–‡ä»¶è®¿é—®é™åˆ¶ã€‚è¿™å®é™…ä¸Šæ¶‰åŠåˆ°ä¸¤ä¸ªåè®®ä»¥åŠä¸€ä¸ªpolicyï¼š</p>
<div class="note info"><p>â€‹ åŒå‡»htmlæ–‡ä»¶å¯ä»¥ç›´æ¥æ‰“å¼€ä¸ºç½‘é¡µï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯file protocolï¼Œæ‰“å¼€ç½‘é¡µæ—¶æµè§ˆå™¨urlæ˜¾ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file:///&lt;path to your file&gt;</span><br></pre></td></tr></table></figure>
</div>
<div class="note success"><p>â€‹ ä½¿ç”¨æœåŠ¡å™¨ä¹Ÿå¯ä»¥åŠ è½½ç½‘é¡µï¼Œæ­¤æ—¶ä½¿ç”¨http(s)åè®®ï¼ŒæŒ‰ç…§ä¸ªäººçš„ç†è§£ï¼Œä¸€æ¬¡httpè¯·æ±‚è®¿é—®å¤§æ¦‚æ˜¯è¿™æ ·çš„æµç¨‹ï¼š</p>
<ul>
<li>åŸŸåè§£æï¼šç”¨æˆ·è¾“å…¥urlï¼Œurlç»è¿‡DNSæœåŠ¡è½¬ä¸ºIPè¿”å›ç»™ç”¨æˆ·</li>
<li>ä¸‰æ¬¡æ¡æ‰‹ï¼šç”±äºhttpï¼ˆæ˜¯åº”ç”¨å±‚çš„ï¼‰åœ¨ä¼ è¾“å±‚ä¸Šä½¿ç”¨TCP/IPåè®®ï¼Œæ•…éœ€è¦æ¡æ‰‹å»ºç«‹è¿æ¥</li>
<li>ç½‘ç«™æœåŠ¡å™¨é€šè¿‡httpåè®®å›ä¼ htmlã€cssã€javascriptç­‰æ–‡ä»¶åˆ°æœ¬åœ°</li>
<li>æœ¬åœ°æµè§ˆå™¨è§£æhtmlç­‰æ–‡ä»¶ï¼Œæ¸²æŸ“ç½‘é¡µ</li>
</ul>
</div>
<p>â€‹ è™½ç„¶ä¹ä¸€çœ‹ï¼Œä¸¤ç§æ–¹å¼å¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œéƒ½æ˜¯é€šè¿‡æŸç§æ–¹å¼è·å¾—ç½‘é¡µæ–‡ä»¶ï¼Œåœ¨æœ¬åœ°è¿›è¡Œæ¸²æŸ“ï¼Œé‚£ä¹ˆå¯¹äºæ–‡ä»¶è®¿é—®è¿™ç§äº‹æƒ…ï¼Œæœ¬æ¥ä¸åº”è¯¥æœ‰åŒºåˆ«çš„ã€‚ä½†æœ¬åœ°è®¿é—®å´å—åˆ°å¦‚ä¸Šå›¾æ‰€è¯´çš„ CORS policyé™åˆ¶ï¼š</p>
<blockquote>
<p><strong><u>C</u></strong>ross-<strong><u>O</u></strong>rigin <strong><u>R</u></strong>esource <strong><u>S</u></strong>haring (CORS) is an HTTP-header based mechanism that allows a server to indicate any origins (domain, scheme, or port) other than its own from which a browser should permit loading resources.[1]</p>
</blockquote>
<p>â€‹ ä¸ä¹‹ç›¸å¯¹çš„ä¸€ä¸ªæ¦‚å¿µå«åšï¼šSame-origin policyï¼Œå…³äºsame origin policyï¼Œè¿™ç¯‡æ–‡ç« è®²å¾—å¾ˆæ¸…æ¥š: <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">MDN Web Docs: Same Origin Policy</a>. è¿™ä¸ªpolicyçš„å¤§æ¦‚æ„æ€æ˜¯è¯´ï¼Œã€åè®®ï¼ˆæ¯”å¦‚åŒhttpæˆ–è€…åŒhttpsï¼‰ã€‘ã€ç«¯å£ã€‘ã€hostã€‘ä¸‰è€…å¿…é¡»ç›¸åŒã€‚è€Œæœ¬åœ°æ‰“å¼€çš„æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰hostï¼Œä¹Ÿæ²¡åŠæ³•åšåˆ°hostç›¸åŒã€‚å¹¶ä¸”æœ‰äººè¿™ä¹ˆè¯´ï¼š</p>
<blockquote>
<p>Chrome doesn't believe that there's any common relationship between any two local files.[2]</p>
</blockquote>
<p>â€‹ é™¤äº†åœ¨æµè§ˆå™¨ä¸­ç›´æ¥disableæ­¤å®‰å…¨è®¾ç½®ï¼Œå¦åˆ™æ²¡åŠæ³•ç›´æ¥ç»•å¼€ï¼ˆäº‹å®ä¸Šï¼Œæˆ‘è§‰å¾—ç»•å¼€ä¹Ÿéå¸¸ä¸ä¼˜é›…ï¼‰ã€‚å‡å¦‚ä¸ç»•å¼€ï¼Œé‚£å°±åªæœ‰ä¸€ä¸ªé€‰æ‹©äº†ï¼Œä½¿ç”¨æœåŠ¡å™¨hostæˆ‘ä»¬çš„ç½‘é¡µã€‚äºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªhttp serverï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Use to create local host</span></span><br><span class="line"><span class="keyword">import</span> http.server</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line">PORT = <span class="number">8080</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoCacheHTTPRequestHandler</span>(</span><br><span class="line">    http.server.SimpleHTTPRequestHandler</span><br><span class="line">):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_response_only</span>(<span class="params">self, code, message=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().send_response_only(code, message)</span><br><span class="line">        self.send_header(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;no-store, must-revalidate&#x27;</span>)</span><br><span class="line">        self.send_header(<span class="string">&#x27;Expires&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    NoCacheHTTPRequestHandler.extensions_map.update(&#123;<span class="string">&quot;.js&quot;</span>: <span class="string">&quot;application/javascript&quot;</span>,&#125;)</span><br><span class="line">    httpd = socketserver.TCPServer((<span class="string">&quot;&quot;</span>, PORT), NoCacheHTTPRequestHandler)</span><br><span class="line">    httpd.timeout = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            httpd.handle_request()</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            httpd.server_close()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>â€‹ å®é™…ä¸Šä»£ç å¹¶ä¸æ˜¯æˆ‘å†™çš„ï¼Œä»£ç æ˜¯æˆ‘ä»ä¸¤ä¸ªStackoverflowå›ç­”ä¸­æ•´ç†å‡ºæ¥çš„ï¼ˆéå¸¸æŠ±æ­‰ï¼Œè¿™ä¸¤ä¸ªå›ç­”æˆ‘ä¹Ÿä¸è®°å¾—æ¥æºäº†ï¼Œå¤ªä¹…è¿œäº†ï¼‰ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå›ç­”åªæ˜¯python3çš„http request serverï¼ˆstackoverflowä¸Šæœ‰äººå›ç­”äº†ç”¨python2è®¾ç½®çš„æœ¬åœ°httpæœåŠ¡å™¨ï¼Œä¸‹é¢å°±æœ‰ä¸ªå“¥ä»¬æŠŠä»–ä»£ç æ”¹æˆpython3äº†ï¼‰ã€‚ç„¶è€Œæˆ‘å‘ç°åˆç‰ˆä»£ç æœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼šè¿™tmæ‰“å¼€æœåŠ¡å™¨å°±å…³ä¸æ‰äº†ï¼Œæˆ‘è®°å¾—å½“æ—¶ä½œè€…è°ƒç”¨äº†ä¸ªè¿™ç©æ„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>Ctrl + C</code>æ ¹æœ¬å…³ä¸æ‰ï¼Œè€Œå¹³å°åˆæ˜¯windowsï¼Œæ²¡åŠæ³•<code>Ctrl + Z</code>å†<code>kill %1</code>ï¼Œéå¸¸çƒ¦ã€‚äºæ˜¯æˆ‘googleï¼ˆå¦‚ä½•æ‰èƒ½è®©http serverä¸é˜»å¡å‘¢ï¼Ÿï¼ˆå› ä¸ºæˆ‘å‘ç°serveræ¯æ¬¡<code>Ctrl + C</code>æ²¡æœ‰ååº”æ˜¯å› ä¸ºé˜»å¡åœ¨ä¸€ä¸ªå¥‡æ€ªçš„å¾ªç¯é‡Œï¼‰ï¼‰ï¼Œæœ€åæ‰¾åˆ°åˆ«äººå†™çš„<code>NoCacheHTTPRequestHandler</code>ï¼Œå†è®¾ç½®ä¸€ä¸‹timeoutå°±å¯ä»¥å¾ˆæ–¹ä¾¿å…³é—­äº†ã€‚</p>
<p>â€‹ ä¸ºä»€ä¹ˆè¦å…³é—­å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸ªæˆ‘æ²¡æ˜ç™½åŸç†çš„å‘ï¼šæ¯æ¬¡æˆ‘ä¸å…³é—­serverï¼Œæˆ–è€…æ²¡æœ‰å®Œå…¨å…³é—­ï¼ˆå¯èƒ½åªæ˜¯æŒ‚èµ·äº†ï¼‰ï¼Œåœ¨ä¿®æ”¹jsä»£ç ååˆ·æ–°ç½‘é¡µæˆ–è€…é‡æ–°è®¿é—®æ˜¯ä¸ä¼šæ›´æ–°è¡Œä¸ºçš„ã€‚æˆ‘æ€€ç–‘æ˜¯å®ƒç«¯å£ä¸€ç›´å¼€ç€ï¼Œä½¿ç”¨çš„æ˜¯cacheè¿‡çš„ç½‘é¡µï¼Œæ•…jsä»£ç æ›´æ–°å¹¶ä¸ä¼šå¼•èµ·ç½‘é¡µè¡Œä¸ºçš„æ›´æ–°ã€‚</p>
<h3 id="export-import">4.3 export &amp; import</h3>
<p>â€‹ æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºexportä»¥åŠimportçš„ä½¿ç”¨å°±ä¼šåƒæˆ‘æ¯å¤©æ—©ä¸Šèµ·åºŠä¸€æ ·ç®€å•ï¼ˆç¡®å®å¾ˆç®€å•ï¼‰ï¼Œä½†å®é™…ä¸Šexportä¸importåªåœ¨è§£å†³å®ŒhttpæœåŠ¡å™¨é—®é¢˜ä¹‹åæ‰å¼€å§‹ç”¨ï¼ˆæœ¬åœ°fileåè®®æ ¹æœ¬æ˜¯ä¸å…è®¸çš„ï¼Œä¸¤ä¸ªjsæ–‡ä»¶originéƒ½æ˜¯nullï¼Œæ²¡åŠæ³•äº’ç›¸è®¿é—®ï¼Œé™¤éåœ¨htmlä¸­ä½¿ç”¨ä¸‘é™‹çš„å…¨å±€å˜é‡ï¼‰ã€‚</p>
<p>â€‹ ä½†æ˜¯exportä¸importæˆ‘é‡åˆ°äº†default ä»¥åŠnon-default (name imports) é—®é¢˜ã€‚</p>
<p>â€‹ é¦–å…ˆï¼Œimport exportå¿…é¡»è¦åœ¨ <code>module</code>ä¸­ä½¿ç”¨ã€‚moduleä¸ä¸€èˆ¬çš„jsæ–‡ä»¶ä¸åŒï¼Œåœ¨å¼•å…¥htmlæ—¶ï¼Œéœ€è¦å®šä¹‰ï¼ˆ<strong><u>type=</u></strong>ï¼‰ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;xxx.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ æ¯”å¦‚åœ¨æˆ‘çš„ç»ƒæ‰‹å°é¡¹ç›®é‡Œï¼š<code>common.js</code>å®šä¹‰äº†ä¸€äº›å¤šä¸ªjsæ–‡ä»¶å¯ä»¥å…±ç”¨çš„å‡½æ•°ï¼Œå…¶ä¸­ä¸€ä¸ªjsæ–‡ä»¶å¦‚<code>signin_modules.js</code>è°ƒç”¨äº†<code>common.js</code>ä¸­çš„ä¸€äº›å‡½æ•°æˆ–ç±»ï¼Œhtmlæ–‡ä»¶ç›´æ¥åŠ è½½çš„æ˜¯<code>signin_modules.js</code>ï¼Œé‚£ä¹ˆ<code>signin_modules.js</code>å°±å¿…é¡»æ˜¯ä¸€ä¸ªmoduleã€‚æˆ‘å¼€å§‹è§‰å¾—å¾ˆç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆ<code>signin_modules.js</code>æ˜¯moduleï¼Ÿä¸åº”è¯¥æ˜¯<code>common.js</code>æ˜¯ä¸€ä¸ª <strong><u>æ¨¡å—</u></strong> æ‰å¯¹ä¹ˆï¼Ÿå®é™…ä¸Šï¼Œ<code>signin_modules.js</code>ï¼ˆä½¿ç”¨importçš„jsï¼‰æ˜¯top level moduleï¼Œå…¶ä»–çš„è¢«å¼•ç”¨æ–‡ä»¶éƒ½æ˜¯åº•å±‚moduleã€‚importå¤„å®šä¹‰äº†moduleï¼Œè¢«å¼•ç”¨çš„æ–‡ä»¶ä¼šè‡ªåŠ¨å˜ä¸ºlower level modulesã€‚å¦‚æœä¸åŠ <code>type=module</code>å°†ä¼šæŠ¥é”™ï¼š</p>
<blockquote>
<p>SyntaxError: import declarations may only appear at top level of a module.</p>
</blockquote>
<p>â€‹ å…¶æ¬¡ï¼Œæ˜¯namedä»¥åŠdefaultçš„åŒºåˆ«ã€‚</p>
<div class="tabs" id="onetab-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#onetab-unique-name-1">named import/export</a></li><li class="tab"><a href="#onetab-unique-name-2">default import/export</a></li></ul><div class="tab-content"><div class="tab-pane active" id="onetab-unique-name-1"><p>â€‹ named importå› ä¸ºå¸¦æœ‰å˜é‡ï¼ˆæˆ–è€…è‡ªå®šä¹‰ç±»å‹ï¼‰åï¼Œæ•…å¯ä»¥åŒæ—¶è°ƒå…¥/è°ƒå‡ºå¤šä¸ªå…ƒç´ ã€‚ä½†è¦è®°ä½ï¼Œnamedä¸€å®šéœ€è¦ä½¿ç”¨èŠ±æ‹¬å·åŒ…ä½ï¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;bar, fool&#125; <span class="keyword">from</span> <span class="string">&quot;module name&quot;</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸ç®¡æ˜¯å¼•å…¥ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªï¼Œéƒ½éœ€è¦ä½¿ç”¨èŠ±æ‹¬å·åŒ…ä½ã€‚</p></div><div class="tab-pane" id="onetab-unique-name-2"><p>â€‹ default import/export çš„å¥½å¤„å°±æ˜¯ä¸éœ€è¦æä¾›åå­—ï¼Œä½†è¿™ä¹Ÿå¯¼è‡´äº†æ¯ä¸ªmoduleåªèƒ½æœ‰ä¸€ä¸ªdefault import/exportã€‚defaultæƒ…å†µä¸‹ä¸è¦ä½¿ç”¨èŠ±æ‹¬å·ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠdefaultå†™å‡ºæ¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> some_value;			<span class="comment">// defaultå¯æœ‰å¯æ— ï¼Œä½†èŠ±æ‹¬å·ä¸€å®šæ— </span></span><br></pre></td></tr></table></figure></div></div></div>
<p>â€‹ æé”™äº†default/namedçš„ç»“æœï¼ˆå¹¶ä¸”è¿˜ä¸çŸ¥é“è¿™ä¸ªæœºåˆ¶ï¼‰ï¼Œå°±æ˜¯ä¼šæ‰¾ä¸åˆ°æ¨¡å—ä¸­çš„é”™è¯¯ï¼ˆä¹‹å‰æé”™äº†ä¸€ç›´ä»¥ä¸ºæ¨¡å—ä¸­å®šä¹‰æœ‰é—®é¢˜ï¼‰ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">MDN Web Docs: Cross-Origin Resource Sharing (CORS)</a></p>
<p>[2] <a href="https://coderedirect.com/questions/104753/origin-null-is-not-allowed-by-access-control-allow-origin-in-chrome-why">Code Redirect: "Origin null is not allowed by Access-Control-Allow-Origin" in Chrome. Why?</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>JavaScript</tag>
        <tag>å‰ç«¯å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>åæ–¹å·® &amp; ç‰¹å¾å€¼çš„äº¤é›†</title>
    <url>/2021/03/12/%E5%8D%8F%E6%96%B9%E5%B7%AE-%E7%89%B9%E5%BE%81%E5%80%BC%E7%9A%84%E4%BA%A4%E9%9B%86/</url>
    <content><![CDATA[<h1 id="eigens-covs">Eigens &amp; Covs</h1>
<hr>
<p>â€‹ çº¿æ€§ä»£æ•°ç¡®å®å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯å±•å¼€æˆ<span class="math inline">\(\sum\)</span>çš„å½¢å¼å°±æ²¡æœ‰è¶£äº†ã€‚æœ¬æ–‡æ„åœ¨åˆ†æçŸ©é˜µç‰¹å¾å€¼åœ¨æŸäº›åœºåˆä¸‹çš„åº”ç”¨ä»¥åŠä¸€äº›çº¿æ€§ä»£æ•°ç»“è®ºï¼ˆç‰¹åˆ«æ˜¯çŸ©é˜µ/å‘é‡æ±‚å¯¼ï¼‰ï¼ˆçƒ¦äººçš„åˆ†å­åˆ†æ¯å¸ƒå±€ï¼‰ã€‚</p>
<p><img src="/2021/03/12/%E5%8D%8F%E6%96%B9%E5%B7%AE-%E7%89%B9%E5%BE%81%E5%80%BC%E7%9A%84%E4%BA%A4%E9%9B%86/stitch.jpg"></p>
<center>
Figure 1. 2D-2Då•åº”åŒ¹é…
</center>
<span id="more"></span>
<hr>
<h2 id="çŸ©é˜µç‰¹å¾é‡ä¸æ³•å‘é‡ä¼°è®¡">çŸ©é˜µç‰¹å¾é‡ä¸æ³•å‘é‡ä¼°è®¡</h2>
<p>â€‹ å¯¹äºä¸€ä¸ªç»™å®šçŸ©é˜µAè€Œè¨€ï¼Œå…¶ç‰¹å¾æ–¹ç¨‹æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{eigen}
\begin{array}{l}
A\pmb{x}=\lambda\pmb{x}\\
(I-\lambda A)\pmb{x}=\pmb{0}
\end{array}
\end{equation}
\]</span> â€‹ ä»¥ä¸Šä¸¤ä¸ªå¼å­å®šä¹‰å®é™…æ˜¯åŒä¸€ä¸ªæ„æ€ï¼Œåªä¸è¿‡å†™æ³•ä¸åŒã€‚å¦‚ä½•ç†è§£ç‰¹å¾ï¼ˆeigenï¼‰é‡å‘¢ï¼Ÿå¯¹äºç‰¹å¾å‘é‡<span class="math inline">\(\pmb{x}\)</span>ï¼Œåœ¨çŸ©é˜µAçš„æ˜ å°„ä¸‹ï¼ˆçº¿æ€§å˜æ¢ï¼‰ï¼Œä¼šå¯¼è‡´<span class="math inline">\(\pmb{x}\)</span>çš„æ–¹å‘å®Œå…¨ä¸å˜ï¼ˆå¯èƒ½åå‘ï¼‰ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œç©ºé—´å˜æ¢ä¸çŸ©é˜µè¿ç®—çš„è”ç³»ä¹Ÿæœ‰ç€ç´§å¯†çš„è”ç³»ï¼Œæ¯”å¦‚3 * 3çŸ©é˜µå°±èƒ½å®Œå…¨è¡¨å¾äºŒç»´å¹³é¢ä¸Šçš„å¹³ç§»ä»¥åŠæ—‹è½¬ã€‚å®é™…ä¸Š 3 * 3çŸ©é˜µèƒ½è¡¨ç¤ºä»»ä½•çš„é€è§†ï¼ˆperspectiveï¼‰å˜æ¢ï¼š <span class="math display">\[
\begin{equation}
(x&#39;,y&#39;,z&#39;)^T=\begin{pmatrix}
a_{11} &amp; a_{12} &amp; a_{13} \\
a_{21} &amp; a_{22} &amp; a_{23} \\
a_{31} &amp; a_{32} &amp; a_{33}
\end{pmatrix}\begin{pmatrix}
x \\
y \\
z
\end{pmatrix}
=A\pmb{x}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå¯¹Aå¯ä»¥æ±‚å…¶ç‰¹å¾é‡ã€‚è¿™äº›ç‰¹å¾é‡è¡¨å¾çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†ç®€å•ä»¥åŠä¾¿äºäººç±»è¿›è¡Œç©ºé—´æƒ³è±¡ï¼Œä»¥ä¸‹è®¨è®ºä¸»è¦é›†ä¸­äºäºŒç»´çŸ©é˜µä¸ä¸‰ç»´çŸ©é˜µçš„è®¨è®ºã€‚</p>
<h3 id="äºŒç»´ç›´çº¿æ³•å‘é‡ä¼°è®¡">äºŒç»´ç›´çº¿æ³•å‘é‡ä¼°è®¡</h3>
<p>â€‹ å®é™…ä¸Šï¼Œåœ¨äºŒç»´çš„æƒ…å†µä¸‹ï¼Œä¼°è®¡æ³•å‘é‡ä¸ä¼°è®¡ç›´çº¿æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚å‡è®¾æœ‰ä¸€å †ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå­˜åœ¨å™ªå£°å¹¶ä¸”ç”±äºå®é™…è¡¨é¢æ˜¯ä¸ªæ›²é¢ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„èŒƒå›´ï¼Œåˆ©ç”¨èŒƒå›´å†…ç‚¹çš„ä¿¡æ¯è¿›è¡Œæ³•å‘é‡ä¼°è®¡ï¼š</p>
<p><img src="/2021/03/12/%E5%8D%8F%E6%96%B9%E5%B7%AE-%E7%89%B9%E5%BE%81%E5%80%BC%E7%9A%84%E4%BA%A4%E9%9B%86/normal.JPG"></p>
<center>
Figure 2. 2Dæ³•å‘é‡ä¼°è®¡
</center>
<p>â€‹ æˆ‘ä»¬éœ€è¦ä¼°è®¡ä¸€æ¡ç›´çº¿ï¼ˆæ³•å‘é‡å½¢å¼ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{normal}
a^T\pmb{x}-b=0
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå¯¹äºnä¸ªç¦»æ•£çš„ç‚¹<span class="math inline">\((x_i,y_i)\rightarrow\pmb{x}_i\)</span>ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å‚æ•°<span class="math inline">\(a,b\)</span>ä½¿å¾—ï¼š <span class="math display">\[
\begin{equation}\label{res1}
|b-a^T\pmb{x}|
\end{equation}
\]</span> â€‹ è¿™æ˜¯ç”±éœ€è¦ä¼°è®¡çš„å‚æ•°ç›´çº¿<span class="math inline">\(\eqref{normal}\)</span>å†³å®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥å°†<span class="math inline">\(\eqref{res1}\)</span>åŒ–ä¸ºæ¨¡å¹³æ–¹çš„å½¢å¼ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦ä¼˜åŒ–çš„ç›®æ ‡ï¼Œå®é™…ä¸Šç‚¹çš„ä¿¡æ¯å·²ç»åŒ…å«åœ¨ç›´çº¿ä¸­äº†ï¼Œè™½ç„¶æ²¡æœ‰å†™æˆå¸¸è§çš„ç›´çº¿æ‹Ÿåˆæœ€å°äºŒä¹˜è¡¨ç¤ºï¼š <span class="math display">\[
\begin{equation}\label{cost}
C=\sum_i(b-a^T\pmb{x})^T(b-a^T\pmb{x})
\end{equation}
\]</span> â€‹ åŠ ä¸Šçº¦æŸï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå¸¦çº¦æŸä¼˜åŒ–é—®é¢˜ã€‚çº¦æŸæ˜¯ï¼š<span class="math inline">\(a^Ta=1\)</span>ã€‚ä¹Ÿå°±æ˜¯è¯´å¸Œæœ›æ³•å‘é‡æ˜¯å•ä½å‘é‡ï¼š <span class="math display">\[
\begin{equation}
\left\{
\begin{array}{ll}\label{obj}
\text{min }\sum_i(b-a^T\pmb{x})^T(b-a^T\pmb{x}) \\
\text{s.t. } a^Ta=1
\end{array}
\right.\rightarrow
\text{min }\sum_i(b-a^T\pmb{x})^T(b-a^T\pmb{x}) + \lambda(a^Ta-1)\\
\end{equation}
\]</span> â€‹ ä¹Ÿå°±æ˜¯åˆç”¨Lagrangeä¹˜å­æ³•å°†æœ‰çº¦æŸé—®é¢˜è½¬åŒ–ä¸ºæ— çº¦æŸé—®é¢˜äº†ã€‚å¯¹KKTæ¡ä»¶è¿›è¡Œè®¨è®ºï¼Œç­‰å¼çº¦æŸçš„KKTæ¡ä»¶å°±ä¸ç”¨è¯´äº†ã€‚å¯¹<span class="math inline">\(a\)</span>æ±‚å¯¼ï¼Œæœ‰ï¼ˆè¿™é‡Œæœ‰å¿…è¦ç©¿æ’ä¸€ä¸‹çŸ©é˜µä¸å‘é‡çš„æ±‚å¯¼çŸ¥è¯†ï¼‰ã€‚å¦‚æœxæ˜¯ä¸€ä¸ª n * 1çš„åˆ—å‘é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå…³äºxçš„æ ‡é‡å‡½æ•°å…³äºxæ±‚å¯¼ï¼Œæ±‚å‡ºå°†ä¼šæ˜¯ä¸€ä¸ªè¡Œå‘é‡ã€‚è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥è¯æ˜ï¼ˆè§<a href="#app">ã€Appendixã€‘</a>ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{lemma}
\begin{array}{ll}
\text{if }\alpha=x^TAx,\text{where }A\text{ is }n \times n \\
\text{then } \frac{\partial\alpha}{\partial x}=x^T(A+A^T)
\end{array}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆæ ¹æ®å…¬å¼<span class="math inline">\(\eqref{lemma}\)</span>ï¼Œå¹¶ä¸”å¯¹<span class="math inline">\(\eqref{obj}\)</span>è¿›è¡Œå…³äºaï¼ˆ2 * 1åˆ—å‘é‡ï¼‰æ±‚å¯¼ï¼Œæ­¤å¤„æ±‚å¯¼çš„ç»“æœæ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{der}
2\lambda a^T-2bn\overline{x}^T+\sum_{i=1}^n2a^T(x_ix_i^T)
\end{equation}
\]</span> â€‹ è€Œå¯¹bæ±‚å¯¼å®é™…ä¸Šä¹Ÿèƒ½å¾—åˆ°é‡è¦çš„ç»“è®ºï¼šå³<span class="math inline">\(b=a^T\overline{x}\)</span>ï¼Œé‚£ä¹ˆå¸¦å…¥åˆ°å…¬å¼<span class="math inline">\(\eqref{der}\)</span>ä¸­å°±ä¼šæœ‰ï¼š <span class="math display">\[
\begin{equation}\label{der2}
2\lambda a^T+2a^T\sum_{i=1}^n(x_ix_i^T)-(\overline{x}\overline{x}^T)=2\lambda a^T+2a^T\sum_{i=1}^n(x_i-\overline{x})(x_i-\overline{x})^T
\end{equation}
\]</span> â€‹ è€Œ<span class="math inline">\(\eqref{der2}\)</span>çš„å³åŠéƒ¨åˆ†æ±‚å’Œå¼å®é™…ä¸Šæ˜¯ç‚¹é›†çš„åæ–¹å·®ï¼Œæœ€åä¹Ÿå°±å¾—åˆ°äº†ï¼ˆå¿½ç•¥è´Ÿå·ç»™<span class="math inline">\(\lambda\)</span>ä»£æ¥çš„å½±å“ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{eig}
\left(\sum_{i=1}^n(x_i-\overline{x})(x_i-\overline{x})^T\right)a=\lambda a
\end{equation}
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(\lambda\)</span>ä¸ºç‚¹é›†åæ–¹å·®çŸ©é˜µçš„ä¸€ä¸ªç‰¹å¾å€¼ï¼Œè€Œ<span class="math inline">\(a\)</span>åˆ™ä¸ºå¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(a\)</span>ï¼ˆæ³•å‘é‡ï¼‰çš„è§£å®é™…ä¸Šæ˜¯ç‚¹é›†åæ–¹å·®çš„ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œä½†æ˜¯å¯¹äºäºŒç»´é—®é¢˜è€Œè¨€ï¼Œç‰¹å¾å‘é‡æœ‰ä¸¤ä¸ªï¼ˆä¸€ä¸ªæœ€å¤§ç‰¹å¾å‘é‡ï¼Œä¸€ä¸ªæœ€å°ç‰¹å¾å‘é‡ï¼‰ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œæ ¹æ®<span class="math inline">\(\eqref{eig}\)</span>ä»¥åŠ<span class="math inline">\(b=a^T\overline{x}\)</span>ï¼Œå¸¦å…¥åˆ°ç›®æ ‡å‡½æ•°<span class="math inline">\(\eqref{obj}\)</span>ä¸­å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
L=0+\sum_{i=1}^n[a^T(x_i-\overline{x})][a^T(x_i-\overline{x})]^T=n\lambda
\end{equation}
\]</span> â€‹ å¯ä»¥çŸ¥é“ï¼Œ<span class="math inline">\(\lambda\)</span>åº”è¯¥é€‰æ‹©æœ€å°ç‰¹å¾å€¼ã€‚é‚£ä¹ˆ<span class="math inline">\(a\)</span>çš„è§£å°±æ˜¯æœ€å°ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚æ„Ÿè§‰è¿™ä¸ªè¿‡ç¨‹å°±ååˆ†çš„ç²¾å¦™ï¼Œä¸»è¦æ˜¯è¦å®Œå…¨åˆ©ç”¨KKTæ¡ä»¶ï¼Œä¸€ä¸ªéƒ½ä¸èƒ½æ¼ï¼Œå¹¶ä¸”æœ‰æ„è¯†åœ°æ„é€ åæ–¹å·® / å‡å€¼ä»¥åŠ<span class="math inline">\(x^Tx / xx^T\)</span>ä¸¤ç§å½¢å¼ã€‚<strong><u>ä¸éš¾å‘ç°</u></strong>ï¼Œè¿™ç§è¡¨ç¤ºå½¢å¼å¯ä»¥è‡ªç„¶æ¨å¹¿åˆ°ä¸‰ç»´ç©ºé—´ä¸­å»ï¼Œæ­¤æ—¶æ±‚å–çš„ä¸å†æ˜¯ç›´çº¿çš„æ³•å‘é‡ï¼Œè€Œæ˜¯å¹³é¢çš„æ³•å‘é‡ã€‚</p>
<hr>
<h2 id="då›¾åƒé…å‡†é—­å¼è§£">2Då›¾åƒé…å‡†é—­å¼è§£</h2>
<p>â€‹ è€ƒè™‘ä¸€ä¸ª2Dé—®é¢˜ï¼Œä¸¤å¹…å›¾åƒçš„é…å‡†ã€‚å‡è®¾æˆ‘ä»¬é€šè¿‡SIFTç®—å­ + RANSACä¼˜åŒ–ï¼Œå¾—åˆ°äº†å‡†ç¡®çš„ç‰¹å¾ç‚¹é…å¯¹å…³ç³»ï¼Œé‚£ä¹ˆå¦‚ä½•æ±‚è¿™ä¸ªå•åº”çŸ©é˜µå‘¢ï¼Ÿ</p>
<div class="note warning"><p>â€‹ å®é™…ä¸Šï¼Œçº¯2D-2DåŒ¹é…å¹¶ä¸èƒ½ç§°ä¸ºå•åº”çŸ©é˜µï¼ˆå•åº”çŸ©é˜µæ˜¯åŒä¸€ç‰©ä½“3D-3DæŠ•å½±å˜æ¢çš„è¡¨å¾ï¼‰</p>
</div>
<p>â€‹ è€ƒè™‘ç®€å•çš„ä»¿å°„å˜æ¢ï¼Œå‡è®¾ä»¿å°„å˜æ¢çŸ©é˜µä¸º<span class="math inline">\(H\)</span>ï¼Œç»™å®šsourceç‚¹é›†ä¸targetç‚¹é›†ï¼š <span class="math display">\[
\begin{equation}
P=(p_1,p_2,...p_n),Q=(q_1,q_2,...,q_2),P,Q\in \mathbb{R}^{3\times n}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå‡è®¾<span class="math inline">\(HP=Q\)</span>,ä¹Ÿå³ç‚¹é›†<span class="math inline">\(P\)</span>ç»è¿‡å˜æ¢<span class="math inline">\(H\)</span>åç›´æ¥æˆäº†<span class="math inline">\(Q\)</span>ï¼Œé‚£ä¹ˆä¸ºäº†ä½¿å˜æ¢åçš„æŠ•å½±è¯¯å·®æœ€å°ï¼Œè€ƒè™‘æœ€å°äºŒä¹˜é—®é¢˜ï¼š <span class="math display">\[
\begin{equation}
L=\Vert HP-Q\Vert^2=tr[(HP-Q)^T(HP-Q)]\Longleftrightarrow tr[(HP-Q)(HP-Q)^T]
\end{equation}
\]</span> â€‹ é‚£ä¹ˆæ ¹æ®çŸ©é˜µè¿¹çš„æ±‚å¯¼ï¼ˆä»¥ä¸‹æ€§è´¨å°†åœ¨<a href="#app">ã€Appendixã€‘</a>ä¸­è¿›è¡Œç®€è¦çš„åˆ†æï¼‰</p>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 45%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">æ€§è´¨</th>
<th>ç»“è®ºï¼ˆåˆ†æ¯å¸ƒå±€ï¼‰</th>
<th>åˆ†å­å¸ƒå±€</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">è½®æ¢æ€§</td>
<td><span class="math inline">\(tr(ABC)=tr(BCA)\)</span></td>
<td><span class="math inline">\(tr(ABC)=tr(BCA)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">çº¿æ€§1</td>
<td><span class="math inline">\(\frac{\partial tr(A^TB)}{\partial A}=B\)</span></td>
<td><span class="math inline">\(\frac{\partial tr(A^TB)}{\partial A}=B^T\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">çº¿æ€§2</td>
<td><span class="math inline">\(\frac{\partial tr(AB)}{\partial A}=B^T\)</span></td>
<td><span class="math inline">\(\frac{\partial tr(AB)}{\partial A}=B\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">äºŒæ¬¡å‹1</td>
<td><span class="math inline">\(\frac{\partial tr(ABA^T)}{\partial A}=A(B+B^T)\)</span></td>
<td><span class="math inline">\(\frac{\partial tr(ABA^T)}{\partial A}=(B+B^T)A^T\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">äºŒæ¬¡å‹2</td>
<td><span class="math inline">\(\frac{\partial tr(A^TBA)}{\partial A}=(B+B^T)A\)</span></td>
<td><span class="math inline">\(\frac{\partial tr(A^TBA)}{\partial A}=(B+B^T)A^T\)</span></td>
</tr>
</tbody>
</table>
<p>â€‹ å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{H}
\frac{\partial \text{ tr}[(HP-Q)(HP-Q)^T]}{\partial H}=2HPP^T-2QP^T=0
\end{equation}
\]</span> â€‹ åˆ™å¯ä»¥å¾—åˆ°ï¼š<span class="math inline">\(H=QP^T(PP^T)^{-1}\)</span>æ˜¯è§£ã€‚å…¶ä¸­<span class="math inline">\((PP^T)^{-1}\)</span>æ˜¯ä¼ªé€†ï¼Œç”±äºå…¶è¡Œåˆ—å¼å¯èƒ½ä¸º0ã€‚å¯ä»¥ç”¨SVDåˆ†è§£å¾—åˆ°ï¼Œæ­£å¸¸æƒ…å†µåˆ™ä½¿ç”¨LDLTè¿›è¡Œåˆ†è§£å³å¯ã€‚</p>
<hr>
<h2 id="appendix">Appendix</h2>
<p><span id="app"></span></p>
<h3 id="å‘é‡çŸ©é˜µæ±‚å¯¼æ³•åˆ™ä»¥åŠåŸºæœ¬ç»“è®ºè¯æ˜">å‘é‡çŸ©é˜µæ±‚å¯¼æ³•åˆ™ä»¥åŠåŸºæœ¬ç»“è®ºè¯æ˜</h3>
<p>â€‹ è¿™é‡Œæ¶‰åŠçš„éƒ½æ˜¯åŸºæœ¬çš„çº¿æ€§ä»£æ•°ï¼ˆä»¥åŠé«˜æ•°ä¸­çš„å¤šå…ƒå‡½æ•°Jacobianæ±‚è§£ï¼‰ï¼Œä½†æ˜¯è‡ªå·±ä»æ¥è®¤çœŸæ¨è¿‡ã€‚å‘é‡çŸ©é˜µæ±‚å¯¼ä¸»è¦åˆ†æå…¶ä¸­å‡ ä¸ªå…¬å¼ï¼š</p>
<h4 id="åŸºæœ¬æ³•åˆ™">åŸºæœ¬æ³•åˆ™</h4>
<ul>
<li>æ ‡é‡å¯¹è¡Œå‘é‡æ±‚å¯¼ï¼Œç»“æœæ˜¯è¡Œå‘é‡ï¼ˆæœ´ç´ ç»“è®ºï¼‰</li>
<li>æ ‡é‡å¯¹åˆ—å‘é‡æ±‚å¯¼ï¼Œç»“æœæ˜¯åˆ—å‘é‡ï¼ˆæœ´ç´ ç»“è®ºï¼‰</li>
<li>æ ‡é‡å¯¹çŸ©é˜µï¼Œç»“æœæ˜¯åŒæ ·å¤§å°çš„çŸ©é˜µï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ ä¸æ±‚å¯¼çŸ©é˜µå¯¹åº”ï¼ˆæœ´ç´ ç»“è®ºï¼‰</li>
</ul>
<h4 id="è¡Œåˆ—æ±‚å¯¼">è¡Œåˆ—æ±‚å¯¼</h4>
<p>â€‹ è¡Œå‘é‡å¯¹åˆ—å‘é‡æ±‚å¯¼ï¼Œç»“æœæ˜¾ç„¶æ˜¯ä¸ªé›…å¯æ¯”ï¼Œç”±äºæ±‚å¯¼å…ƒç´ æ˜¯åˆ—å‘é‡ï¼Œé‚£ä¹ˆé›…å¯æ¯”çŸ©é˜µæ˜¯æŒ‰åˆ—ç»„ç»‡çš„ï¼š <span class="math display">\[
\begin{equation}
d(y_1,y_2,...,y_n)/d
\begin{pmatrix}
x_1\\
x_2\\
\vdots \\
x_m
\end{pmatrix}=
\begin{pmatrix}
\frac{\partial y_1}{\partial x_1} &amp; \frac{\partial y_2}{\partial x_1} &amp; ... &amp; \frac{\partial y_1}{\partial x_1}\\
\frac{\partial y_1}{\partial x_2} &amp; \frac{\partial y_2}{\partial x_2} &amp; ... &amp; \frac{\partial y_1}{\partial x_2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
\frac{\partial y_1}{\partial x_m} &amp; \frac{\partial y_2}{\partial x_m} &amp; ... &amp; \frac{\partial y_1}{\partial x_m}
\end{pmatrix}
\end{equation}
\]</span> â€‹ åˆ™åä¹‹ï¼Œå¦‚æœæ˜¯åˆ—å‘é‡å¯¹è¡Œå‘é‡æ±‚å¯¼ï¼Œé‚£ä¹ˆå°†ä¼šæ˜¯ä¸ŠçŸ©é˜µçš„è½¬ç½®ã€‚æ³¨æ„ï¼Œä¸Šå¼æˆ‘å†™çš„æ˜¯åˆ†æ¯å¸ƒå±€ï¼Œä¹‹åæˆ‘å°†å®Œå…¨ä½¿ç”¨åˆ†å­å¸ƒå±€ï¼Œå› ä¸ºæ¯”è¾ƒè‡ªç„¶ã€‚åˆ†å­å¸ƒå±€ä¸åˆ†æ¯å¸ƒå±€çš„åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li>åˆ†å­å¸ƒå±€ï¼šå¦‚æœfæ˜¯ä¸ªåˆ—å‘é‡ï¼Œxæ˜¯ä¸ªæ ‡é‡ï¼Œé‚£ä¹ˆ<span class="math inline">\(\frac{\partial f}{\partial x}\)</span>ä¸ºåˆ—å‘é‡ï¼ˆè‡ªç„¶è¡¨è¾¾ï¼‰</li>
<li>åˆ†æ¯å¸ƒå±€ï¼šå¦‚æœfæ˜¯ä¸ªæ ‡é‡ï¼Œxæ˜¯ä¸ªåˆ—å‘é‡ï¼Œé‚£ä¹ˆ<span class="math inline">\(\frac{\partial f}{\partial x}\)</span>æ˜¯ä¸ªåˆ—å‘é‡ï¼ˆæ„Ÿè§‰ä¸å¤ªè‡ªç„¶å—·ï¼‰</li>
</ul>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ—å‘é‡å¯¹æ ‡é‡æ±‚å¯¼æ˜¯ä¸å˜å½¢çš„ï¼ŒçŸ©é˜µå¯¹æ ‡é‡æ±‚å¯¼ä¹Ÿæ˜¯ä¸å˜å½¢çš„ï¼ˆé‚£ä¹ˆè‡ªç„¶ï¼Œè¡Œå‘é‡å¯¹æ ‡é‡æ±‚å¯¼ä¹Ÿä¸å˜å½¢ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„è¡¨è¾¾ï¼‰ã€‚æ¥ä¸‹æ¥è®¨è®ºçš„å…¬å¼éƒ½åŸºäºå‡ ä¸ªå…±åŒç‚¹ï¼š</p>
<ul>
<li>å‘é‡<span class="math inline">\(\pmb{x}\)</span>æ˜¯åˆ—å‘é‡ï¼ˆn * 1ï¼‰
<ul>
<li>çŸ©é˜µAæ˜¯m * nçŸ©é˜µæˆ–æ˜¯n * nçŸ©é˜µ79</li>
</ul></li>
</ul>
<p><span class="math display">\[
\begin{equation}
\frac{\partial A\pmb{x}}{\partial \pmb{x}}=A\tag{prop 1}
\end{equation}
\]</span></p>
<p>â€‹ è¿™ä¸ªå¾ˆæ˜¾ç„¶ï¼Œè®¨è®º<span class="math inline">\(A\pmb{x}\)</span>æ—¶åªéœ€è¦å°†AæŒ‰è¡Œåˆ†å—ï¼Œ<span class="math inline">\(A\pmb{x}\)</span>æ¯ä¸ªå…ƒç´ éƒ½æ˜¯<span class="math inline">\(\pmb{a}_j\pmb{x}\)</span>ï¼ˆæ ‡é‡ï¼‰ï¼Œé‚£ä¹ˆä¸€ä¸ªåˆ—å‘é‡<span class="math inline">\(A\pmb{x}\)</span>ä¸­çš„æ¯ä¸ªæ ‡é‡å…ƒç´ å¯¹åˆ—å‘é‡æ±‚å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªè¡Œå‘é‡ï¼š <span class="math display">\[
\begin{equation}
\pmb{a}_j\pmb{x}=\sum_{i=1}^na_{ji}x_i
\end{equation}
\]</span> â€‹ æ˜¾ç„¶ï¼Œå¯¹è¿™ä¸ªæ ‡é‡æ±‚å¯¼å¾—åˆ°<span class="math inline">\(\pmb{a}_j\)</span>æœ¬èº«ã€‚ <span class="math display">\[
\begin{equation}
\frac{\partial \pmb{x}^TA\pmb{x}}{\partial \pmb{x}}=\pmb{x}^T(A+A^T)\tag{prop 2}
\end{equation}
\]</span> â€‹ å±•å¼€ä¹‹åæ˜“äºè¯æ˜ï¼Œç”±äº<span class="math inline">\(\pmb{x}^TA\pmb{x}\)</span>æ˜¯æ ‡é‡ï¼Œæ ‡é‡å¯¹åˆ—å‘é‡æ±‚å¯¼æ˜¯è¡Œå‘é‡ï¼Œå¯ä»¥å¾—åˆ°ï¼Œè¡Œå†…çš„ç¬¬jä¸ªå…ƒç´ ä¸ºï¼š <span class="math display">\[
\begin{equation}
\sum_{i=1}^na_{ji}x_i+\sum_{j=1}^na_{ji}x_j
\end{equation}
\]</span> â€‹ ä¸Šå¼å‰åŠéƒ¨åˆ†æ˜¯è¡Œå‘é‡<span class="math inline">\(\pmb{x}^T\)</span>ä¸çŸ©é˜µ<span class="math inline">\(A^T\)</span>çš„æŸä¸€åˆ—è¿›è¡Œç›¸ä¹˜ï¼ŒååŠéƒ¨åˆ†åˆ™ä¸<span class="math inline">\(A\)</span>çš„æŸä¸€åˆ—ç›¸ä¹˜ã€‚<span class="math inline">\(\text{prop 2}\)</span>çš„è¯æ˜åˆæ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå¯ä»¥æ ¹æ®åŸºæœ¬çš„æ±‚å’Œå¼ä¸çŸ©é˜µè¿ç®—æ€§è´¨å¾—åˆ°ï¼Œå…³äºçŸ©é˜µè¡Œåˆ—æ±‚å¯¼æ“ä½œï¼Œå°±åªæè¿™ä¸¤ä¸ªã€‚</p>
<h3 id="çŸ©é˜µè¿¹çš„æ±‚å¯¼æ³•åˆ™">çŸ©é˜µè¿¹çš„æ±‚å¯¼æ³•åˆ™</h3>
<p>â€‹ è¿¹æ˜¯é’ˆå¯¹n * nçŸ©é˜µè€Œè¨€çš„ï¼ˆå¯¹è§’çº¿ä¹‹å’Œï¼‰ï¼Œå‡è®¾<span class="math inline">\(A_{n\times k},B_{k\times n}\)</span>ï¼Œåˆ™<span class="math inline">\(\text{tr}(AB)\)</span>æœ‰ï¼š <span class="math display">\[
\begin{equation}\label{tr}
\text{tr}(AB)=\sum_{i=1}^n\sum_{j=1}^ka_{ij}b_{ji}
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå‡è®¾<span class="math inline">\(\text{tr}(AB)\)</span>å¯¹Aæ±‚å¯¼ï¼Œç”±åˆ†å­å¸ƒå±€ï¼Œå°†Açœ‹æˆä¸€ä¸ªè¡Œå‘é‡ï¼Œæ¯ä¸ªè¡Œå…ƒç´ ä¸ºä¸€ä¸ªåˆ—å‘é‡ã€‚å¯ä»¥çŸ¥é“ï¼Œåˆ†å­å¸ƒå±€ä¸‹ï¼Œæ ‡é‡å¯¹è¡Œæ±‚å¯¼ï¼Œå¾—åˆ°åˆ—å‘é‡ï¼Œåˆ—å‘é‡çš„å…ƒç´ å°†ç”±åŸæ¥è¡Œå‘é‡å†…çš„å…ƒç´ å†³å®šã€‚é‚£ä¹ˆç”±äºåŸæ¥è¡Œå‘é‡ï¼ˆ1 * kï¼‰å…ƒç´ æ˜¯ä¸€ä¸ªä¸ªçš„åˆ—å‘é‡ï¼ˆn * 1ï¼‰ï¼Œé‚£ä¹ˆæ±‚å¯¼åçš„æ¯ä¸ªåˆ†é‡æ˜¯ä¸ªè¡Œå‘é‡ï¼ˆ1 * nï¼‰ï¼Œä¹Ÿå³æœ€åçš„ç»“æœæ˜¯ï¼ˆk * nï¼‰çš„ï¼Œä¸‹é¢è¯æ˜è¿™å°±æ˜¯çŸ©é˜µBã€‚</p>
<p>â€‹ æˆ‘ä»¬å‡è®¾å½“å‰æ­£åœ¨å¯¹è¡Œå‘é‡<span class="math inline">\(A\)</span>çš„å…ƒç´ <span class="math inline">\(\pmb{a}_p\)</span>è¿›è¡Œæ±‚å¯¼ï¼Œ<span class="math inline">\(\pmb{a}_p=(a_{1p},a_{2p},...,a_{np})^T\)</span>æ˜¯AçŸ©é˜µçš„ç¬¬påˆ—ã€‚é‚£ä¹ˆç”±å…¬å¼<span class="math inline">\(\eqref{tr}\)</span>ï¼Œè¿¹ä¸­ä¸<span class="math inline">\(a_{ip}\)</span>æœ‰å…³çš„åªæœ‰ï¼š <span class="math display">\[
\begin{equation}
\sum_{i=1}^na_{ip}b_{pi}
\end{equation}
\]</span> â€‹ å¯¹å…¶æ±‚å¯¼ï¼Œç”±äºä¸Šå¼æ˜¯ä¸€ä¸ªæ ‡é‡è€Œ<span class="math inline">\(\pmb{a}_p\)</span>æ˜¯ä¸€ä¸ªåˆ—å‘é‡ï¼Œåº”è¯¥å¾—åˆ°ä¸€ä¸ªè¡Œå‘é‡ç»“æœ <span class="math display">\[
\begin{equation}
\sum_{i=1}^na_{ip}b_{pi}\mathop{\Longrightarrow}^{d\pmb{a}_p}(b_{p1},b_{p2},...,b_{pn})
\end{equation}
\]</span> â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŸ©é˜µè¿¹å¯¹<span class="math inline">\(A\)</span>çŸ©é˜µçš„ç¬¬pä¸ªåˆ—æ±‚å¯¼ï¼Œå¾—åˆ°Bçš„ç¬¬pè¡Œã€‚é‚£ä¹ˆç”±æ­¤å¯ä»¥å¾—åˆ°<span class="math inline">\(d\text{ tr}(AB)/dA=B\)</span>ã€‚ï¼ˆæ³¨æ„ï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢æ‰€åˆ—è¡¨æ ¼ä¸ä¸€è‡´ï¼Œè¡¨æ ¼æ˜¯åˆ†æ¯å¸ƒå±€çš„ï¼Œåˆ†æ¯å¸ƒå±€ä¸‹è¿™é‡Œç¡®å®æ˜¯<span class="math inline">\(B^T\)</span>ï¼‰ã€‚åˆ†æ¯å¸ƒå±€å’Œåˆ†å­å¸ƒå±€æ°æ˜¯è½¬ç½®å…³ç³»ï¼Œé‚£ä¹ˆå…¬å¼<span class="math inline">\(\eqref{H}\)</span>åœ¨åˆ†å­å¸ƒå±€ä¸‹åº”è¯¥æ˜¯ä¸å˜çš„ï¼ˆå› ä¸ºå‡å·å‰åéƒ½è¿›è¡Œäº†è½¬ç½®ï¼‰ã€‚</p>
<p></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>çº¿æ€§ä»£æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘è´«ç˜ çš„æ•°å­¦ä¸–ç•Œã€1ã€‘- SAMä¸ä¼˜åŒ–æ–¹æ³•</title>
    <url>/2022/01/30/%E6%88%91%E8%B4%AB%E7%98%A0%E7%9A%84%E6%95%B0%E5%AD%A6%E4%B8%96%E7%95%8C%E3%80%901%E3%80%91-SAM%E4%B8%8E%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h1 id="bfgsam">BFGSAM</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰é™ä¸‹å¿ƒæ¥çœ‹è¿‡æœ‰å¾ˆå¼ºç†è®ºæ€§çš„å†…å®¹äº†ï¼Œæˆ‘ååˆ†æ‹…å¿ƒè‡ªå·±ä¼šä¸§å¤±ç†è®ºä¸Šçš„æ€è€ƒèƒ½åŠ›ä»¥åŠæ•°å­¦è®¡ç®—èƒ½åŠ›ã€‚æ­£å¥½ä¹‹å‰åœ¨çœ‹æŸç¯‡è®ºæ–‡æ—¶ï¼Œçœ‹åˆ°å…¶ä¸­æåˆ°ä¸€ç§å«åšSAMï¼ˆsharpness aware minimizationï¼‰çš„æ–¹æ³•ï¼Œè¯´æ˜¯æ•ˆæœè¿˜è¡Œï¼Œæ­¤å‰ä¿å­˜äº†SAMè®ºæ–‡ï¼Œä½†æ²¡å»ç»†è¯»ã€‚æœ€è¿‘å¯’å‡ç”±äºç”µè„‘æ•…éšœæ²¡åŠæ³•å·¥ä½œï¼Œå¾ˆé—²ï¼Œä¾¿é‡æ–°äº†è§£äº†ä¸€äº›æ•°å€¼ä¼˜åŒ–æ–¹é¢çš„çŸ¥è¯†ï¼ˆæ¯”å¦‚æ‹Ÿç‰›é¡¿æ—ï¼‰ï¼Œå¹¶è¯»äº†è¯»SAMï¼ˆè™½ç„¶è¯»å®Œæ„Ÿè§‰ï¼Ÿï¼Ÿï¼Ÿè¿™æ€ä¹ˆè¿™ä¹ˆé­”æ³•ï¼‰</p>
<ul>
<li><a href="https://arxiv.org/pdf/2010.01412.pdf">ICLR 2021: Foret, Pierre, et al. "Sharpness-aware minimization for efficiently improving generalization." <em>arXiv preprint arXiv:2010.01412</em> (2020).</a></li>
<li><strong><u>ã€Šæˆ‘è¿™ç§èœé¸¡å“ªæœ‰èµ„æ ¼è§‰å¾—DLé¡¶ä¼šè®ºæ–‡é­”æ³•ã€‹ç³»åˆ—</u></strong>ï¼ˆä¸‹å›¾å›¾æºè®ºæ–‡ï¼‰</li>
</ul>
<p><img src="/2022/01/30/%E6%88%91%E8%B4%AB%E7%98%A0%E7%9A%84%E6%95%B0%E5%AD%A6%E4%B8%96%E7%95%8C%E3%80%901%E3%80%91-SAM%E4%B8%8E%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/sam.png"></p>
<span id="more"></span>
<hr>
<h2 id="ii.-æ¡ä»¶æ•°ä¸quasi-newton">II. æ¡ä»¶æ•°ä¸quasi-Newton</h2>
<h3 id="æ¡ä»¶æ•°ä¸ç¨³å®šæ€§">2.1 æ¡ä»¶æ•°ä¸ç¨³å®šæ€§</h3>
<p>â€‹ æ¡ä»¶æ•°ï¼ˆcondition numberï¼‰ï¼š</p>
<blockquote>
<p>The <strong>condition number</strong> of a <a href="https://en.wikipedia.org/wiki/Function_(mathematics)">function</a> measures how much the output value of the function can change for a small change in the input argument.</p>
</blockquote>
<p>â€‹ è¿™ä¸ªæ¦‚å¿µä¹Ÿå°±æ˜¯ä¸€ä¸ªè¡¡é‡è¾“å…¥è¾“å‡ºå…³ç³»çš„æŒ‡æ ‡ï¼šè¾“å…¥å‘ç”Ÿå°çš„æ”¹å˜æ˜¯å¦ä¼šä½¿å¾—è¾“å‡ºå‘ç”Ÿå¤§çš„æ”¹å˜ï¼Ÿå¦‚æœä¼šï¼Œé‚£ä¹ˆä¼˜åŒ–ç»“æœå°†æœ‰å¾ˆå¤§çš„æŠ–åŠ¨ã€‚æ¯”å¦‚åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œè§‚å¯Ÿlossæ›²çº¿ï¼Œlossæ³¢åŠ¨éå¸¸å¤§ï¼Œå¯èƒ½å› ä¸ºæ¡ä»¶æ•°å¤ªå¤§ï¼Œéœ€è¦ä½¿å¾—è¾“å…¥çš„å˜åŒ–åœ¨åˆç†èŒƒå›´å†…å‡å°ï¼ˆæ§åˆ¶å­¦ä¹ ç‡ï¼‰ã€‚</p>
<p>â€‹ è¿™é‡Œæˆ‘ä»¬ä¸å¯¹ä¸€èˆ¬çš„ä¼˜åŒ–é—®é¢˜è¿›è¡Œè®¨è®ºï¼Œåªè®¨è®ºçŸ©é˜µæƒ…å†µã€‚çŸ©é˜µä¸­ï¼Œæ¡ä»¶æ•°æ˜¯ï¼š <span class="math display">\[
\begin{equation}
\kappa(A)=\frac {\sigma_{\max}(A)}{\sigma_{\min}(A)}
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\sigma_{\max}\)</span>ä»£è¡¨çŸ©é˜µAçš„æœ€å¤§å¥‡å¼‚å€¼ï¼ˆå¦‚æœæ˜¯éå¥‡å¼‚çŸ©é˜µï¼Œå°±æ˜¯æœ€å¤§ç‰¹å¾å€¼ï¼‰ï¼Œ<span class="math inline">\(\sigma_{\min}\)</span>æ˜¯æœ€å°ç‰¹å¾å€¼ã€‚ç»å¸¸æˆ‘ä»¬åœ¨å¥‡å¼‚å€¼åˆ†è§£æ—¶ï¼Œå–å‡ºå…¶å¯¹è§’å€¼ï¼Œåˆ¤å®šæœ€å¤§ç‰¹å¾å€¼ä¸æœ€å°ç‰¹å¾å€¼ä¹‹æ¯”ï¼Œå¦‚æœè¿‡å¤§å°±è¿›è¡Œä¸€äº›ä¿æŠ¤æ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä¿æŠ¤å¤§æ¡ä»¶æ•°æ—¶çš„è§£æƒ…å†µã€‚</p>
<p>â€‹ æ¡ä»¶æ•°ç¡®å®šäº†ä¸€ä¸ªé—®é¢˜çš„å‰åå‘ç¨³å®šæ€§ï¼š</p>
<blockquote>
<p>ç®—æ³•çš„â€œå‰å‘è¯¯å·®â€æ˜¯ç»“æœä¸çœŸè§£ä¹‹é—´çš„å·®åˆ«ï¼Œå³<span class="math inline">\(\Delta y=y^{*}-y\)</span>ã€‚â€œåå‘è¯¯å·®â€æ˜¯æ»¡è¶³<span class="math inline">\(f(x+\Delta x)=y^{*}\)</span>çš„æœ€å°<span class="math inline">\(\Delta x\)</span>ï¼Œä¹Ÿå°±æ˜¯è¯´åå‘è¯¯å·®è¯´æ˜ç®—æ³•çš„æ‰€è§£å†³çš„é—®é¢˜ã€‚å‰å‘è¯¯å·®å’Œåå‘è¯¯å·®é€šè¿‡æ¡ä»¶æ•°å‘ç”Ÿå…³ç³»ï¼šå‰å‘è¯¯å·®çš„å¹…åº¦æœ€å¤šæ˜¯æ¡ä»¶æ•°ä¹˜ä»¥åå‘è¯¯å·®çš„å¹…åº¦ã€‚[2]</p>
</blockquote>
<h3 id="preconditioning">2.2 Preconditioning</h3>
<p>â€‹ å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒæŸä¸ªé—®é¢˜çš„æ¡ä»¶æ•°å¾ˆå¤§ï¼ˆill-conditionedï¼‰ï¼Œä½†æˆ‘ä»¬åˆä¸å¾—ä¸è§£è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿä½¿ç”¨preconditionerï¼ˆæ€ä¹ˆç¿»è¯‘ï¼Œä¸çŸ¥é“ï¼Œæ—¥è¯­ç¿»è¯‘æ˜¯â€œå‰å‡¦ç†è¡Œåˆ—â€ï¼Œå¥½å§äººå®¶éƒ½æ˜¯ä¸­æ–‡ï¼‰</p>
<blockquote>
<p>In mathematics, <strong><u>preconditioning</u></strong> is the application of a transformation, called the <strong><u>preconditioner</u></strong>, that conditions a given problem into a form that is more suitable for numerical solving methods.[3]</p>
</blockquote>
<p>â€‹ æ­¤å¤„ç®€å•ç¿»è¯‘ä¸€ä¸‹è‹±æ–‡ç»´åŸºï¼ˆå› ä¸ºæ²¡æœ‰ä¸­æ–‡ï¼Œè€Œè‹±æ–‡è®²å¾—æŒºæ¸…æ¥šçš„ï¼‰ï¼š</p>
<ul>
<li>é¦–å…ˆå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç—…æ€çº¿æ€§é—®é¢˜ï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}
Ax=b
\end{equation}
\]</span></p>
<ul>
<li>å¯ä»¥ç”¨ä¸€ä¸ª <strong><u>preconditionerçŸ©é˜µ</u></strong> <span class="math inline">\(P\)</span> ä½¿å¾—<span class="math inline">\(P^{-1}A\)</span>ä½¿å¾—æ¡ä»¶æ•°å°äºAï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}
AP^{-1}(Px)=b
\end{equation}
\]</span></p>
<ul>
<li>æˆ‘ä»¬è®¤ä¸ºï¼š<span class="math inline">\(AP^{-1}\)</span>æ˜¯ä¸€ä¸ªæ–°çš„çŸ©é˜µ<span class="math inline">\(Q\)</span>ï¼Œä¹Ÿå°±å¾—åˆ°ï¼š<span class="math inline">\(Qy=b\)</span>è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè§£è¿™ä¸ªé—®é¢˜å¾—åˆ°<span class="math inline">\(y\)</span>åå†æ ¹æ®<span class="math inline">\(Px=y\)</span>è§£å‡º<span class="math inline">\(x\)</span></li>
</ul>
<p>â€‹ å¾ˆå·§å¦™çš„æ–¹æ³•ã€‚è¿›ä¸€æ­¥äº†è§£è¿™ç§æ–¹æ³•çš„åº”ç”¨ä»¥åŠå…¶workçš„æœºåˆ¶ï¼Œå‚è§referenceã€‚</p>
<h3 id="quasi-newtonæ³•ç®€ä»‹">2.3 Quasi-Newtonæ³•ç®€ä»‹</h3>
<p>â€‹ æ‹Ÿç‰›é¡¿ï¼ˆquasi-Newtonï¼‰æ³•ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç‰›é¡¿æ³•çš„è¿‘ä¼¼ã€‚ç‰›é¡¿æ³•éœ€è¦ç”¨åˆ°äºŒé˜¶å¯¼ï¼Œåœ¨æ›´åŠ ä¸€èˆ¬çš„æƒ…å†µä¸‹---æµ·æ£®ï¼ˆHessianï¼‰é˜µã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½å®¹æ˜“æ±‚äºŒé˜¶å¯¼ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºå…¶è§£æè¡¨è¾¾å¼å¤ªå¤æ‚ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºç»´åº¦å¤ªé«˜ï¼ŒäºŒé˜¶å¯¼çš„æ—¶ç©ºå¼€é”€éƒ½æ˜¯è‡³å°‘<span class="math inline">\(O(n^2)\)</span>çš„ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ–¹æ³•æ¥è¿‘ä¼¼æµ·æ£®çŸ©é˜µï¼Œç”¨è¿‘ä¼¼çš„æµ·æ£®çŸ©é˜µè®¡ç®—æ›´æ–°æ–¹å‘ã€‚åœ¨æ­¤æˆ‘å°†ç®€ä»‹ä¸€äº›æ›´ä¸ºç†ŸçŸ¥çš„æ‹Ÿç‰›é¡¿è¿­ä»£æ–¹æ³•ï¼ˆçš„å¥½å¤„ï¼‰ï¼šBFGSï¼ˆæ—ï¼‰ï¼ŒDFPï¼ŒSR1ã€‚</p>
<p>â€‹ BFGSï¼ˆå››ä¸ªäººåå­—è²Œä¼¼ï¼‰æ˜¯ä¸€ç§å¾ˆå¥½ç”¨çš„æ‹Ÿç‰›é¡¿è¿­ä»£ç®—æ³•ï¼Œç›¸æ¯”äºDFPä»¥åŠSR1ï¼Œè¿™ä¸ªç®—æ³•å¯èƒ½æœ‰ä¸€å®šä¼˜åŠ¿ï¼ˆè¦ä¸ç„¶ä¸ºä»€ä¹ˆGoogle ceres solveré‡Œçš„çº¿æœç´¢åªæä¾›LBFGSä»¥åŠBFGSï¼Ÿéš¾ä¸æˆå› ä¸ºå†™èµ·æ¥ç®€å•ï¼Ÿï¼‰ï¼Œå¹¶ä¸”å…¶å­˜åœ¨ä¸€ç§å¯¹å†…å­˜ä»¥åŠç®—åŠ›æ›´åŠ å‹å¥½çš„å®ç°ï¼ˆLimited-BFGSï¼‰ï¼Œè¿™ä¸ªæ›´å‹å¥½çš„å®ç°å¯ä»¥æ‘†è„±æ™®é€šBFGSçš„<span class="math inline">\(O(n^2)\)</span>æ—¶é—´å¤æ‚åº¦ï¼Œä½¿å¾—æ—¶é—´å¤æ‚åº¦å˜ä¸º<span class="math inline">\(O(mn)\)</span>ï¼Œä¸€èˆ¬æ¥è¯´méƒ½å°äºnã€‚</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">BFGS</a></li><li class="tab"><a href="#span-unique-name-2">DFP</a></li><li class="tab"><a href="#span-unique-name-3">SR1</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><ol type="1">
<li>ç»´æŒå¯¹ç§°æ­£å®šæ€§ã€‚(2) ä¸€ç§å¥‡å¦™çš„è‡ªæˆ‘çŸ«æ­£èƒ½åŠ›ã€‚(3) å¯¹äºå¤§å‹ç¨€ç–é—®é¢˜éå¸¸æœ‰æ•ˆ</li>
</ol>
<blockquote>
<p>BFGS is the most effective quasi-Newton correction... Also, BFGS has self-correcting properties: if <span class="math inline">\(H_k\)</span> incorrectly approximates the curvature of the objective function and this estimate slows down the iteration, then the (inverse) Hessian approximation will tend to correct itself in the next few steps. [4]</p>
</blockquote></div><div class="tab-pane" id="span-unique-name-2"><ol type="1">
<li>ç¬¬ä¸€ä¸ªæå‡ºçš„quasi-Newtonæ–¹æ³•ï¼Œæ˜¯BFGS updateçš„å¯¹å¶ã€‚ï¼ˆ2ï¼‰åœ¨è§£å†³äºŒæ¬¡é—®é¢˜æ—¶ï¼Œè¿­ä»£äº§ç”Ÿå…±è½­æ–¹å‘ï¼ˆä¸å…±è½­æ¢¯åº¦æ³•é‡åˆï¼‰ã€‚(3) å¯¹äºå¤§å‹é—®é¢˜ï¼Œæ•ˆç‡éå¸¸ä½ã€‚</li>
</ol>
<blockquote>
<p>This formula, like BFGS, is a rank 2 formula update and it has nice properties as well, however it is not as fast. It is less effective than BFGS at self-correcting of the Hessians. Likewise, DFP could fail for general nonlinear problems, it can stop at a saddle point, it is sensitive to inaccurate line searches and itâ€™s Hessian updates are sensitive to round-off errors and other inaccuracies. [4]</p>
</blockquote></div><div class="tab-pane" id="span-unique-name-3"><p>â€‹ SR1å¦‚å…¶åï¼ˆSymmetric Rank-1ï¼‰ï¼ŒDFPä¸BFGSéƒ½æ˜¯ç§©-2ç®—æ³•ã€‚</p>
<blockquote>
<ul>
<li>The matrices generated are very good approximations to the (inverse) Hessian matrices, often better than BFGS.</li>
<li>The drawback of the method is that sometimes <span class="math inline">\((s_k âˆ’ H_ky_k)^Ty_k\approx0\)</span> and there may not be a symmetric rank one formula that satisfies the secant condition. Hence instabilities and breakdown may occur.</li>
</ul>
</blockquote></div></div></div>
<p>â€‹ ç§©-1ç®—æ³•ï¼ˆSR-1ï¼‰å¾—åˆ°çš„æµ·æ£®çŸ©é˜µå¯èƒ½æ¯”ç§©-2ç®—æ³•çš„æµ·æ£®çŸ©é˜µæ›´å¥½ï¼Œä½†æ˜¯å®ƒæ— æ³•ä¿è¯æ›´æ–°çŸ©é˜µçš„æ­£å®šæ€§ï¼Œçº¿æœç´¢å°†æ˜¯éç²¾ç¡®çº¿æœç´¢[5]ï¼ˆæ¥è‡ªå°æ¹¾ä¸€ä¸ªå«åšï¼Œå›½ç«‹ä¸­æ­£å¤§å­¦çš„è¯¾ä»¶ï¼Œè¿™å¤§å­¦åå­—æ„Ÿè§‰ä¸€çœ‹å°±çŸ¥é“åœ¨çºªå¿µè°ï¼‰ã€‚</p>
<h4 id="bfgsæ³•æ¨å¯¼">2.4 BFGSæ³•æ¨å¯¼</h4>
<p>â€‹ ä¸­æ–‡ç»´åŸºçš„è¯å‘¢ï¼Œå°±æ˜¯ç®€å•å‘Šè¯‰ä½ ï¼šç®—æ³•å°±æ˜¯è¿™æ ·ï¼Œè‡³äºæ¨å¯¼ï¼Œè‡ªå·±æ¨å»å§ã€‚è‹±æ–‡ç»´åŸºåˆ™æ²¡æœ‰è¿‡ç¨‹ã€‚æ¨å¯¼å¹¶ä¸éš¾ï¼ˆåˆ«åœ¨å¼€å§‹æ—¶æŠ„é”™å…¬å¼å°±è¡Œï¼Œæˆ‘å› ä¸ºæŠ„é”™å…¬å¼è€ŒèŠ±äº†ä¸€ä¸ªåŠå°æ—¶ç”¨å„ç§æ–¹æ³•æ¨è€Œæ²¡æœ‰ç»“æœï¼Œæœç„¶åŠªåŠ›æ˜¯ä¸å€¼é’±çš„ï¼Œæ–¹å‘é”™äº†ä¸€ç‚¹ç”¨éƒ½æ²¡æœ‰ï¼‰ã€‚</p>
<p>â€‹ é¦–å…ˆï¼Œæ‹Ÿç‰›é¡¿æ³•éƒ½åŸºäºè¿™ä¸€ä¸ªå‡è®¾ï¼šæ›´æ–°æ–¹å‘<span class="math inline">\(\pmb{p}_k\)</span>ä¸æµ·æ£®è¿‘ä¼¼é˜µ<span class="math inline">\(B_k\)</span>ï¼Œæ¢¯åº¦çš„å…³ç³»æ­£å¦‚ç‰›é¡¿æ³•ä¸­æµ·æ£®æ¢¯åº¦ä¸æ›´æ–°æ–¹å‘çš„å…³ç³»å¦‚ä¸‹ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™é‡Œè§†ä¸ºå¯¹æ¢¯åº¦çš„preconditioningï¼š <span class="math display">\[
\begin{equation}
B_k\pmb{p}_k=-\nabla f(x_k)
\end{equation}
\]</span> â€‹ ç”±äº<span class="math inline">\(\pmb{p}_k\)</span>åªæ˜¯ä¸€ä¸ªæ–¹å‘ï¼Œå¯å°†å…¶å†™ä¸º<span class="math inline">\(\pmb{p}_k=\alpha(x_{k+1}-x_k)\)</span>ã€‚æ³¨æ„æ‹Ÿç‰›é¡¿æ¡ä»¶ï¼š <span class="math display">\[
\begin{align}\label{quasi}
&amp;f(x_k+\Delta x)\approx f(x_k)+\nabla f(x_k)\Delta x + \frac 12\Delta x^TB\Delta x\rightarrow\\
&amp;\text{Approx linearity: }\nabla f(x_k+\Delta x) \approx \nabla f(x_k)+ B\Delta x\rightarrow\\
&amp;B_{k+1}(x_{k+1}-x_k)=\nabla f(x_{k+1})-\nabla{f(x_k)}\\
&amp;\text{let: } y_k=\nabla f(x_{k+1})-\nabla{f(x_k)}, s_k=x_{k+1}-x_k\\
&amp;\text{thus, }B_{k+1}s_k=y_k\label{update}
\end{align}
\]</span> â€‹ åˆ™æ›´æ–°<span class="math inline">\(B_k\)</span>ï¼ˆæˆ–è€…ç§°ä¸ºcorrectionï¼‰ï¼Œ<strong><u>å¿…é¡»è¦ä½¿å¾—<span class="math inline">\(B_{k+1}\)</span>æ»¡è¶³å…¬å¼<span class="math inline">\(\eqref{update}\)</span></u></strong>ã€‚åœ¨BFGSä¸­ï¼Œä¸ºäº†æ»¡è¶³å¯¹ç§°ä¸”æ­£å®šï¼ˆpositive definitenessï¼‰ï¼Œäººä¸ºä½¿å¾—æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{new}
B_{k+1}=B_k+\alpha u_ku_k^T+\beta v_kv_k^T
\end{equation}
\]</span> â€‹ æ³¨æ„å…¶ä¸­<span class="math inline">\(u,v\)</span>å‡æ˜¯åˆ—å‘é‡ã€‚åªè¦å…¬å¼<span class="math inline">\(\eqref{new}\)</span>æ»¡è¶³æ›´æ–°å…¬å¼<span class="math inline">\(\eqref{update}\)</span>å³å¯ã€‚æ³¨æ„å…¬å¼<span class="math inline">\(\eqref{new}\)</span>åæœ‰ä¸¤ä¸ªæ›´æ–°é¡¹ï¼Œåªæœ‰ä¸€ä¸ªæ—¶å°†æ˜¯ç§©1ç®—æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±åœ°å–æï¼Œä½¿å¾—<span class="math inline">\(u_k=y_k,v_k=B_ks_k\)</span>ã€‚æ±‚<span class="math inline">\(\alpha,\beta\)</span>ã€‚</p>
<p>â€‹ åˆ™å¸¦å…¥å…¬å¼<span class="math inline">\(\eqref{update}\)</span>ï¼Œæ•´ç†åå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{align}
&amp;(B_k+\alpha u_ku_k^T+\beta v_kv_k^T)s_k=y_k\rightarrow\\
&amp;(\alpha u_ku_k^T+\beta v_kv_k^T)s_k=y_k-B_ks_k\rightarrow\\
&amp;(\alpha u_k^Ts_k)u_k+(\beta v_k^Ts_k)v_k=y_k-B_ks_k\rightarrow\\
&amp;\text{for: }u_k=y_k,v_k=B_ks_k\\
&amp;\text{let: }\alpha u_k^Ts_k=1,\beta v_k^Ts_k=-1\\
&amp;\alpha=\frac 1{y_k^Ts_k},\beta=-\frac{1}{s^T_kB_k^Ts_k}=-\frac{1}{s^T_kB_ks_k}
\end{align}
\]</span> â€‹ åˆ™å¯ä»¥å¾—åˆ°æ›´æ–°å…¬å¼ã€‚</p>
<hr>
<h2 id="iii.sam">III.SAM</h2>
<p>â€‹ è¿™ç¯‡è®ºæ–‡æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæƒ³ç»†è®²ï¼Œä¸çŸ¥é“æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰æ·±å…¥ç†è§£è¿˜æ˜¯è¿™ç¯‡è®ºæ–‡æœ¬èº«å°±æœ‰é‚£ä¹ˆä¸€ç‚¹é­”æ³•ï¼Œä¸ªäººæ„Ÿè§‰æ­¤æ–‡æœ€åå¾—å‡ºçš„ç®—æ³•è²Œä¼¼å¾ˆtrivialã€‚SAMï¼ˆsharpness aware minimizationï¼‰æ˜¯ä¸€ç§æ–°çš„è¯¯å·®å‡½æ•°ï¼Œæ­¤è¯¯å·®å‡½æ•°å¯ä»¥æå‡ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›ï¼ˆ<strong><u>ä½¿å¾—æœ€ä¼˜å€¼é™„è¿‘è¾ƒä¸ºå¹³æ»‘</u></strong>ï¼‰ã€‚</p>
<p>â€‹ ä¸€èˆ¬çš„æå‡æ³›åŒ–èƒ½åŠ›æ–¹æ³•å¯ä»¥åˆ†ä¸ºè¿™ä¹ˆå‡ ç§ï¼š</p>
<ul>
<li><p>é™åˆ¶æ´»åŠ¨å‚æ•°æ•°é‡ï¼šweight decayï¼ˆé™åˆ¶éƒ¨åˆ†å‚æ•°çš„å­˜åœ¨ï¼‰ã€Dropoutï¼ˆå‚æ•°éšæœºå­˜åœ¨ï¼‰ä»¥åŠæ¯”è¾ƒæ–°çš„stochastic depthï¼ˆéšæœºæ‰”å±‚ï¼Œå¤šç”¨åœ¨attentionç»“æ„ä¸­ï¼‰</p></li>
<li><p>lossæ–¹é¢ï¼šæ¯”å¦‚åˆ†ç±»é—®é¢˜ä¸­çš„label smoothing lossï¼Œä½¿å¾—one-hotå˜æˆäº† 0.9æˆ–è€…0.8 hotï¼Œlabelä¸å†æ˜¯ç¡¬çš„ï¼Œæˆ–è€…è¯´æ˜¯ä»åˆ†ç±»é—®é¢˜è½¬åŒ–ä¸ºå›å½’é—®é¢˜ï¼Œä»â€œæ•°å­—ä¿¡å·å­¦ä¹ â€å˜ä¸ºâ€œæ¨¡æ‹Ÿä¿¡å·å­¦ä¹ â€ã€‚</p></li>
<li><p>æ•°æ®å¤„ç†æ–¹é¢ï¼šæ•°æ®å¢å¼ºï¼ˆä¼ ç»Ÿï¼‰ï¼ŒRandom Eraseï¼Œmixup/cutmixï¼ˆç°ä»£æ•°æ®å¢å¼ºï¼‰ã€‚</p></li>
</ul>
<p>â€‹ åœ¨lossæ–¹é¢ï¼Œå¦‚æœè¯´label smoothç®—æ˜¯æ°å‡ºçš„ä¸€ä¸ªæ³›åŒ–èƒ½åŠ›å¢å¼ºå°è¯•çš„è¯ï¼Œä¸ªäººè§‰å¾—è¿™è¿˜æ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿè¿™å°±ä¸ä¼˜é›…ã€‚æœ¬æ¥äººå®¶çŒ«å°±æ˜¯çŒ«ï¼Œæˆ‘èƒ½å¾ˆæ˜ç¡®å‘Šè¯‰ä½ è¿™å°±æ˜¯çŒ«ï¼Œ100%æ¦‚ç‡ï¼Œä½†label smoothåè¦è¯´è¿™æ˜¯90%çš„ç½®ä¿¡åº¦ï¼Œå¼ºè¡Œè½¯åŒ–ã€‚</p>
<p>â€‹ SAMåˆ™ç€é‡äºä¼˜åŒ–ç½‘ç»œå­¦ä¹ ç»“æœè®¡ç®—çš„losså½¢çŠ¶ã€‚å‡è®¾æˆ‘ä»¬æŠŠlosså€¼å‡½æ•°çœ‹ä½œæ˜¯ï¼š <span class="math display">\[
\begin{equation}
l=L(x;\theta)
\end{equation}
\]</span> â€‹ å…¶ä¸­xæ˜¯è¾“å…¥æ•°æ®ï¼Œ<span class="math inline">\(\theta\)</span>æ˜¯ç½‘ç»œå‚æ•°ã€‚æˆ‘ä»¬å¤§å¯ä»¥å°†ä¸Šå¼çœ‹ä½œæ˜¯å…³äº<span class="math inline">\(\theta\)</span>çš„å‡½æ•°ï¼ˆå¯ä»¥è®¤ä¸ºè¾“å…¥ç»™å®šï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›å¯¹äºä»»æ„ç»™å®šè¾“å…¥ï¼Œlosséƒ½èƒ½ä¿æŒä¸€å®šçš„å¹³æ»‘æ€§ï¼Œæ­£å¦‚æˆ‘ä»¬å¸Œæœ› <strong><u>è¶…å¹³é¢æ˜¯å­˜åœ¨å¹³æ»‘æ€§çš„</u></strong>ï¼Œä»¥å…å‘ç”Ÿè¿‡æ‹Ÿåˆã€‚é‚£ä¹ˆå¦‚ä½•ä¿è¯æ­¤â€œå¹³æ»‘æ€§â€ï¼Ÿ</p>
<p>â€‹ <del>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ ¹æ®æŸä¸ªxxç†è®º æ˜¾ç„¶ ä¸éš¾å¾—åˆ° æ˜“äºè¯æ˜ QED</del>ã€‚é¦–å…ˆï¼Œä½œè€…å°†é—®é¢˜å†™æˆäº†è¿™æ ·ï¼ˆè¿™é‡Œæˆ‘è·³è¿‡äº†ä½œè€…æŠ›å‡ºçš„ä¸€ä¸ªtheoremï¼‰ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªå‚æ•°<span class="math inline">\(w\)</span>ï¼ˆè¿™æ˜¯ä¸ªå‘é‡ä½†æˆ‘ä¸æƒ³æ‰“<code>\pmb&#123;&#125;</code>ï¼Œä¸ºäº†æ–¹ä¾¿ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªæœ‰æ›´å¼ºæ³›åŒ–èƒ½åŠ›çš„å‚æ•°<span class="math inline">\(w^*\)</span>ï¼Œé‚£ä¹ˆ<span class="math inline">\(w\)</span>å±€éƒ¨æœ€å¤§losså¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{align}
&amp;[\mathop{\max}_{|\epsilon|_2\leq\rho}L_s(w+\epsilon)-L_s(w)]+L_s(w)+\lambda\Vert w\Vert^2\label{div}\\
&amp; L_s^{SAM}:=\mathop{\max}_{|\epsilon|_2\leq\rho}L_s(w+\epsilon)
\end{align}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\rho\)</span>æ˜¯ä¸ªè¶…å‚æ•°ã€‚ä½œè€…å°†å±€éƒ¨æœ€å¤§lossæ‹†åˆ†ä¸º<span class="math inline">\(\eqref{div}\)</span>å°±æ˜¯ä¸ºäº†è¯´æ˜ï¼šæ–¹æ‹¬å·é‡Œçš„é¡¹å®é™…ä¸ŠåŒ…å«äº†å±€éƒ¨å˜åŒ–ç‡ä¿¡æ¯ï¼ˆè¶Šå¤§è¯´æ˜sharpnessè¶Šé«˜ï¼‰ï¼Œå‰©ä½™éƒ¨åˆ†å°±æ˜¯plain loss with regularizerã€‚</p>
<p>â€‹ ä½œè€…è¿›ä¸€æ­¥è®¤ä¸ºï¼š <span class="math display">\[
\begin{align}
\epsilon^*(w)=\mathop{\arg\max\;}_{|\epsilon|_2\leq\rho}L_s(w+\epsilon)\mathop{\approx}^{Taylor}\mathop{\arg\max\;}_{|\epsilon|_2\leq\rho}L_s(w)+\epsilon^T\nabla_wL_s(w)=\mathop{\arg\max\;}_{|\epsilon|_2\leq\rho}\epsilon^T(w)\nabla_wL_s(w)
\end{align}
\]</span></p>
<p>â€‹ æ„Ÿè§‰å¦‚æœç›´æ¥æ±‚è§£<span class="math inline">\(\arg\max\epsilon^T(w)\nabla_wL_s(w)\)</span> åªæ˜¯æ±‚è§£åœ¨å¯¹åº”å‚æ•°ç‚¹<span class="math inline">\(w\)</span>ï¼Œä¸<span class="math inline">\(L_s\)</span>æ¢¯åº¦å†…ç§¯æœ€å¤§çš„å‚æ•°åç§»å€¼ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œè²Œä¼¼<span class="math inline">\(\epsilon\)</span>çš„æ–¹å‘ä¸<span class="math inline">\(\nabla L_s(w)\)</span>ä¸€è‡´ï¼ŒèŒƒæ•°å–æœ€å¤§å€¼ï¼ˆ<span class="math inline">\(\rho\)</span>ï¼‰å³å¯ï¼Ÿä½œè€…æœ€åç¡®å®ä¹Ÿæ˜¯è¿™ä¹ˆè§£çš„ï¼š <span class="math display">\[
\begin{equation}\label{max}
\epsilon^*(w)=\rho\text{ sign}(\nabla_wL_s(w))|\nabla_wL_s(w)|^{q-1}/\left(\Vert\nabla_wL_s(w) \Vert^q_q\right)^{1/p}
\end{equation}
\]</span> â€‹ ä½œè€…è¯´p=q=2æ˜¯æœ€ä¼˜å‚æ•°ã€‚ä½†... ä¸ºä»€ä¹ˆè¦ç”¨ sgnå‡½æ•°ï¼Ÿè¿™é‡Œ... ä½œè€…å†™å¤æ‚äº†ã€‚<span class="math inline">\(|...|\)</span>æ˜¯ element-wise absoluteæ“ä½œï¼Œsgn + |...| ç›¸å½“äºæ˜¯å…ˆå–æ¯ä¸ªå…ƒç´ çš„å€¼ï¼Œå½’ä¸€åŒ–åå†å°†åŸæ¥çš„æ–¹å‘åŠ ä¸Šã€‚</p>
<p>â€‹ ç”±äºå…¬å¼<span class="math inline">\(\eqref{max}\)</span>æ±‚å‡ºäº†æœ€ç»ˆçš„<span class="math inline">\(\epsilon\)</span>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<span class="math inline">\(L_s^{SAM}(w)\)</span>æ¢¯åº¦å¯ä»¥æ±‚å‡ºå¦‚ä¸‹ï¼Œç”±äº<span class="math inline">\(L_s^{SAM}(w)\approx L_s(w+\epsilon^*(w))\)</span>: <span class="math display">\[
\begin{align}
&amp;\nabla_wL_s^{SAM}(w)\approx \nabla_wL_s(w+\epsilon^*(w))=\frac{d(w+\epsilon^*(w))}{dw}\nabla_w{L_s(w)}|_{w=w+\epsilon^*(w)}\rightarrow\\
=&amp;\nabla_w{L_s(w)}|_{w=w+\epsilon^*(w)}+\left[\frac{d(\epsilon^*(w))}{dw}\nabla_w{L_s(w)}|_{w=w+\epsilon^*(w)}\right]
\end{align}
\]</span> â€‹ æœ€åï¼Œä½œè€…ç”šè‡³å°†ä¸Šå¼æ–¹æ‹¬å·å†…çš„é¡¹çœç•¥æ‰ï¼Œç›´æ¥ä¸€æ­¥ï¼š <span class="math display">\[
\begin{equation}
\nabla_wL_s^{SAM}(w)\approx \nabla_w{L_s(w)}|_{w=w+\epsilon^*(w)}
\end{equation}
\]</span> â€‹ ä¸ªäººæ„Ÿè§‰å¾ˆæš´åŠ›ã€‚å› ä¸ºå‡è®¾è¿™æ ·ï¼Œå‡è®¾åœ¨SGDèƒŒæ™¯ä¸‹è¿›è¡Œè¿­ä»£ï¼Œæ¯ä¸€æ¬¡å°†ç›´æ¥å–è´Ÿæ¢¯åº¦æ–¹å‘ä¼˜åŒ–ï¼Œè€ŒSAMåˆ™æ˜¯é¦–å…ˆè®¡ç®—æœ¬å‚æ•°æ‰€åœ¨ä½ç½®çš„æ¢¯åº¦ï¼Œä¹‹åè®¾ç½®ä¸€ä¸´æ—¶å‘é‡ï¼Œå…¶å€¼æ˜¯æ¢¯åº¦å½’ä¸€åŒ–ç»“æœä¹˜ä»¥Ïï¼Œè®¡ç®—å®é™…æ›´æ–°æ–¹å‘æ—¶ï¼Œå½“å‰å‚æ•°åŠ ä¸´æ—¶å‘é‡ä½ç½®evaluateå¾—åˆ°æ¢¯åº¦åå½“ä½œæ–¹å‘ã€‚è€ŒÏæ˜¯ä¸ªé­”æ³•å‚æ•°ï¼Œä¹Ÿä¸è‡ªé€‚åº”ï¼Œç”šè‡³æˆ‘éƒ½ä¸çŸ¥é“Ïæ˜¯å¦é²æ£’ï¼Œæ˜¯å¦ä¼šå‡ºç°Ïâ€œæ¡ä»¶æ•°å¤§â€çš„æƒ…å†µã€‚ä½œè€…ç›¸å½“äºåœ¨æ­¤å¤„ï¼š</p>
<div class="note warning"><p>â€‹ æ¯æ¬¡ä¸åœ¨å‚æ•°ä½ç½®è·å¾—æ¢¯åº¦ï¼Œè€Œåœ¨å‚æ•°é™„è¿‘çš„ä¸€ä¸ªé­”æ³•ä½ç½®è·å¾—æ¢¯åº¦ã€‚ä½œè€…çš„ç†è®ºä¹Ÿå¾ˆé­”æ³•ï¼Œæ ¸å¿ƒéƒ¨åˆ†ç«Ÿç„¶æ˜¯ä¸€ä¸ªä¸€é˜¶æ³°å‹’å±•å¼€çš„æå€¼ï¼ˆå†…ç§¯æœ€å¤§å€¼ç»“æœï¼‰ï¼Œä½œè€…å°†å…¶è¯´æˆæ˜¯ <strong><u>dual norm problem</u></strong>ï¼Œå¥½å®¶ä¼™ï¼Œä¸€ä¸‹æˆäº†æ³›å‡½åˆ†æé—®é¢˜äº†ï¼Œé€¼æ ¼++ã€‚</p>
</div>
<p>â€‹ è™½ç„¶æœ¬æ–‡å¼•ç”¨é‡100+ï¼Œä½†ä¸ªäººå§‹ç»ˆæ„Ÿè§‰<strong><u>ä¸å¤ªå¯¹åŠ²</u></strong>ï¼ˆå¾ˆé­”æ³•ï¼‰ï¼Œæœ‰æœºä¼šå°†å°è¯•ä¸€ä¸‹æœ¬ç®—æ³•ã€‚ä¸è¿‡æŒ‰é“ç†æ¥è¯´ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•å¾ˆæˆåŠŸï¼Œå°±åƒAdamW &gt; Adamè¿™æ ·ï¼ŒSAMä¸€å®šä¼šè¢«Pytorchè¿›è¡Œå®˜æ–¹å®ç°çš„ï¼Œå¼•ç”¨é‡æ¯”è‚©ResNetã€transformerä¹Ÿè¯´ä¸å®šï¼Œ<strong><u>å¯æƒœå¹¶æ²¡æœ‰</u></strong>ã€‚</p>
<p>â€‹ ä¸ªäººæ°´å¹³å®åœ¨æœ‰é™ï¼Œæ²¡åŠæ³•è¯»å‡ºæœ¬æ–‡çš„æ·±æ„ï¼Œä¹Ÿæ²¡åŠæ³•ä»ä¸­è·å¾—å¯å‘ï¼Œå¦‚æœæœ‰è¯»è€…å¯¹æ­¤æ–‡äº§ç”Ÿå…´è¶£å¹¶æœ‰è‡ªå·±çš„æ·±å…¥ç†è§£ï¼Œç¬”è€…æ„¿æ„æ·±å…¥æ¢è®¨ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://en.wikipedia.org/wiki/Condition_number">Wikipedia: Condition number</a></p>
<p>[2] <a href="https://en.wikipedia.org/wiki/Numerical_stability">Wikipedia: Numerical stability</a></p>
<p>[3] <a href="https://en.wikipedia.org/wiki/Preconditioner">Wikipedia: Preconditioner</a></p>
<p>[4] <a href="http://people.math.sfu.ca/~elushi/project_833.pdf">Yang D., Enkeleida L., Qingguo L., Investigation of quasi-Newton methods for unconstrained optimization</a></p>
<p>[5] <a href="https://www.cs.ccu.edu.tw/~wtchu/courses/2012s_OPT/Lectures/Chapter%2011%20Quasi-Newton%20Methods.pdf">Chapter 11 Quasi-Newton Methods</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>ä¼˜åŒ–ç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¦‚ç‡å›¾æ¨¡å‹</title>
    <url>/2021/11/10/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="crf-mrf">CRF &amp; MRF</h1>
<hr>
<h2 id="i.-introduction">I. Introduction</h2>
<p>â€‹ æœ¬æ–‡æ˜¯æ—©æœŸè¢«æŒ‚åœ¨<a href="https://github.com/Enigmatisms/Algorithms-Plus">GithubğŸ”—: Enigmatisms/Algorithm Plus</a>ä¸Šçš„ä¸€ç¯‡å­¦ä¹ æ€»ç»“ã€‚å†™è¿™ç¯‡å­¦ä¹ ç¬”è®°çš„æ—¶å€™åšå®¢è¿˜æ²¡æœ‰è¯ç”Ÿï¼Œä¹Ÿåˆšåˆšç†Ÿç»ƒæŒæ¡Typoraã€‚æœ¬æ–‡ç›¸å½“äºæ˜¯è€ƒå¤postï¼Œè™½ç„¶å¤è€ï¼Œä½†æˆ‘å‘ç°å½“å¹´çš„æˆ‘å­¦ä¹ çƒ­æƒ…ä¹Ÿè¿˜æ˜¯æŒºé«˜çš„ï¼Œè¿™ç¯‡ç¬”è®°å¯ä»¥è¯´æ˜¯å†™å¾—ä¸é”™çš„ä¸€ä¸ªæ¦‚ç‡å›¾æ¨¡å‹å…¥é—¨æ–‡ç« äº†ï¼ˆå¼€å§‹è‡ªå¤¸ï¼Œå°½ç®¡UGMéƒ¨åˆ†æ²¡å†™å®Œï¼‰ã€‚</p>
<p>â€‹ å¯èƒ½æˆ‘æœ€è¿‘è¿˜æ˜¯è¦é‡æ–°å­¦ä¸€ä¸‹æ¦‚ç‡å›¾æ¨¡å‹:</p>
<blockquote>
<p>ä¸€ä¸ªæ¦‚ç‡å›¾æ¨¡å‹ï¼Œä¸Šé¢çš„æ‰€æœ‰ç»“ç‚¹æ„æˆäº†æ‰€æœ‰éšæœºå˜é‡çš„è”åˆåˆ†å¸ƒã€‚éœ€è¦è¡¨è¾¾çš„å°±æ˜¯è”åˆåˆ†å¸ƒã€‚--æ—©æœŸHQYçš„ç†è§£</p>
</blockquote>
<p>â€‹ ä¹‹å‰åº”è¯¥åªæ˜¯æ¸…æ¥šäº†å…¶ä¸­çš„ä¸€äº›æ¦‚å¿µï¼Œä½†æ˜¯å¹¶æ²¡æœ‰äº§ç”Ÿæ·±å…¥çš„ç†è§£ï¼Œæ¯”å¦‚MRFä¸ç½®ä¿¡ä¼ æ’­çš„åŸç†ä»¥åŠå…·ä½“çš„åº”ç”¨æ–¹å¼ç­‰ç­‰ï¼ˆè™½ç„¶å·²ç»æ˜¯å¾ˆè€çš„ä¼ ç»Ÿæ–¹æ³•äº†ï¼‰ã€‚æ–¹æ³•è€å½’è€ï¼Œæ€æƒ³æœ¬è´¨æœ‰å¯å‘æ„ä¹‰å°±æ˜¯å¥½çš„ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-dgm">II. DGM</h2>
<h3 id="dgm-ä¸­ä¸‰ç§å…¸å‹ç»“æ„çš„ç†è§£">2.1 DGM ä¸­ä¸‰ç§å…¸å‹ç»“æ„çš„ç†è§£</h3>
<p>â€‹ DGM(Directed Graph Model)ã€‚åˆå«è´å¶æ–¯ç½‘ç»œã€‚</p>
<pre class="mermaid">
graph LR

A[A Intelligence]--&gt;B[B GPA]
A--&gt;C[C Innovative prop.]

</pre>
<h4 id="ç»“æ„ä¸€-tail-to-tail-å•çˆ¶å¤šå­">2.1.1 ç»“æ„ä¸€ Tail to Tail (å•çˆ¶ï¼Œå¤šå­)</h4>
<ul>
<li>å½“è§‚æµ‹åˆ°Aï¼ŒBä¸Cä¹‹é—´ç‹¬ç«‹ï¼ˆä¸å­˜åœ¨å…³ç³»ï¼Œ<strong><u>æ²¡æœ‰å¯ä»¥æœ‰ä¿¡æ¯æ¨æ–­</u></strong>ï¼‰</li>
<li>æ²¡æœ‰è§‚æµ‹åˆ°Aï¼ŒBï¼ŒCä¹‹å‰å¯ä»¥æœ‰éšå«çš„å…³ç³»ï¼Œä¸ç‹¬ç«‹</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>Aæ™ºåŠ›ï¼ŒBæˆç»©ï¼ŒCåˆ›æ–°åŠ›ã€‚å½“ä¸çŸ¥é“Aæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥éšå«åœ°æ¨å®šï¼Œå½“ä¸€ä¸ªäººæˆç»©é«˜ï¼Œè¯´æ˜ä»–åˆ›æ–°èƒ½åŠ›é«˜çš„æ¦‚ç‡å¾ˆå¤§ï¼ˆæ¦‚ç‡æ¨æ–­ï¼‰ï¼Œåä¹‹äº¦ç„¶</li>
<li>è€Œå¦‚æœGPAï¼Œåˆ›æ–°åŠ›åªå—åˆ°æ™ºåŠ›ä¸€ä¸ªå› ç´ çš„å½±å“æ—¶ï¼Œå·²çŸ¥Aï¼Œé‚£ä¹ˆGPAå’Œåˆ›æ–°åŠ›å°±æ¯«æ— å…³ç³»äº†ã€‚å› ä¸ºè¿™ä¸¤ä¸ªå› ç´ B,Cå·²ç»ç¡®å®šäº†ï¼Œå†è¿›è¡Œæ¦‚ç‡æ¨æ–­å·²ç»æ²¡æœ‰æ„ä¹‰äº†ï¼ˆä¿¡æ¯é‡ä¸º0ï¼‰.<strong><u>å¦‚æœè¿™ä¸ªä¾‹å­ä¸å¥½ç†è§£ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªä¾‹å­ï¼š</u></strong></li>
<li>A ä»Šå¤©ä¸‹é›¨ï¼ŒBæ˜å¤©ä¸‹é›¨ï¼ŒCä»Šå¤©åœ°é¢æ¹¿ã€‚å…¶ä¸­ï¼ŒAï¼ˆä¸‹é›¨ï¼‰æœ‰80%å¯èƒ½å¯¼è‡´ç§¯æ°´ï¼ˆCï¼‰ï¼Œ20%å¯èƒ½å¯¼è‡´ä¸ç§¯æ°´ï¼ˆ<span class="math inline">\(\overline C\)</span>ï¼‰ï¼Œ50%ä¸‹é›¨ï¼ˆBï¼‰ã€‚é‚£ä¹ˆAæœªçŸ¥æ—¶ï¼Œåœ°é¢æ¹¿æ—¶ï¼ˆå‡è®¾Cå‘ç”Ÿï¼‰ï¼Œå¯ä»¥åæ¨Aæ˜¯å¦å‘ç”Ÿï¼Œå†åæ¨Bæ˜¯å¦å‘ç”Ÿï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ã€‚</li>
<li>ä½†æ˜¯å¦‚æœAå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆCä¸Båªä¸Aå½“å‰äº‹å®æœ‰å…³ï¼Œ<strong><u>å·²ç»ä¸ä¼šå—åˆ°æ¥è‡ªBæˆ–è€…Cçš„æ¨æ–­å½±å“äº†ï¼ï¼ˆå½±å“æ¶ˆé™¤ï¼‰</u></strong>ã€‚</li>
<li>Açš„è§‚æµ‹ä¼šå¯¼è‡´B,Cçš„ç›¸äº’ç‹¬ç«‹ï¼ˆä¿¡æ¯çš„äº’ä¸å½±å“æ€§ï¼‰</li>
</ul>
<h4 id="ç»“æ„äºŒ-head-to-tail-å…¸å‹çš„å› æœå…³ç³»">2.1.2 ç»“æ„äºŒ Head to Tail ï¼ˆå…¸å‹çš„å› æœå…³ç³»ï¼‰</h4>
<pre class="mermaid">
graph LR

A[A Diffculty]--&gt;B[B Grade]
B--&gt;C[C Recommendation]

</pre>
<p>Bä¸ºå…³é”®ç»“ç‚¹ã€‚å½“ï¼š</p>
<ul>
<li>Bæ²¡æœ‰è¢«è§‚æµ‹ï¼ŒAå’ŒCæ˜¯å¯ä»¥æœ‰æ¨æ–­å…³ç³»ï¼ˆä¿¡æ¯å…³è”æ€§ï¼‰çš„ï¼Œä¸ç‹¬ç«‹</li>
<li>Bè¢«è§‚æµ‹ï¼šAä¸Cç‹¬ç«‹ï¼ŒAå·²ç»ä¸å½±å“Cçš„å‘ç”Ÿäº†</li>
</ul>
<p><strong><u>å¯ä»¥ç”¨é©¬å°”å¯å¤«é“¾çš„æƒ³æ³•æ¥ç†è§£ï¼</u></strong>å†å²äº‹ä»¶çš„æ— åæ•ˆæ€§ï¼å½“ å½“å‰ä¸ç¡®å®šæ—¶ï¼Œ<strong>ç”±äºå†å²çŠ¶æ€å¯ä»¥ç¡®å®šå½“å‰çŠ¶æ€</strong>ï¼Œé‚£ä¹ˆç›¸å½“äºå†å²å¯ä»¥å½±å“æœªæ¥ï¼ˆä¸‹ä¸€çŠ¶æ€ï¼‰ã€‚è€Œå½“å‰çŠ¶æ€å·²çŸ¥çš„è¯ï¼Œå†å²ä¿¡æ¯å·²ç»ä¸èµ·ä½œç”¨åŠ›ï¼Œä¸‹ä¸€çŠ¶æ€å®Œå…¨ç”±å½“å‰çŠ¶æ€å†³å®šã€‚</p>
<p>ä¾‹å­ï¼š</p>
<ul>
<li>ä¸çŸ¥é“æˆç»©çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè€ƒè¯•çš„éš¾åº¦å¤§ï¼Œé‚£ä¹ˆæ¯ä¸ªäººåœ¨è€ƒå¥½çš„æƒ…å†µä¸‹è·å¾—æ¨èçš„æ¦‚ç‡éƒ½å¤§ã€‚</li>
<li>ä½†æ˜¯çŸ¥é“äº†æˆç»©çš„è¯ï¼Œæ”¶ç›Šå°±å’Œé£é™©æ²¡å…³ç³»äº†ã€‚ä½ è€ƒå¾—å¥½å°±èƒ½è·å¾—æ¨èï¼Œè€ƒä¸å¥½å°±ä¸è¡Œã€‚</li>
</ul>
<h4 id="ç»“æ„ä¸‰-head-to-head-æ±‡ç‚¹">2.1.3 ç»“æ„ä¸‰ Head to Head ï¼ˆæ±‡ç‚¹ï¼‰</h4>
<pre class="mermaid">
graph LR

A[A Difficulty]--&gt;C[C Grade]
B[B Intelligence]--&gt;C

</pre>
<p>Cä¸ºå…³é”®èŠ‚ç‚¹ã€‚å½“ï¼š</p>
<ul>
<li>Cæ²¡æœ‰è¢«è§‚æµ‹ï¼šé‚£ä¹ˆAå’ŒBäº’ç›¸ä¸å½±å“ï¼ˆå› ä¸ºç¼ºå°‘ä¿¡æ¯åˆ¤æ–­Aä¸Bçš„ç›¸äº’å½±å“æ€§ï¼‰ï¼Œç»“æœæœªçŸ¥ï¼ŒåŸå› äº’ç›¸äº§ç”Ÿçš„å½±å“ä¸å¯çŸ¥ã€‚<strong><u>æ¡ä»¶ç‹¬ç«‹</u></strong></li>
<li>Cè¢«è§‚æµ‹åˆ°ï¼šAä¸Bå­˜åœ¨è”ç³»çš„ç»“æœï¼Œå¯ä»¥A-&gt;Bæ¨æ–­æˆ–è€…åä¹‹ã€‚</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<ul>
<li>è€ƒè¯•æˆç»©ä¸æ¸…æ¥šçš„æ—¶å€™ï¼Œæ¯ä¸ªäººçš„æ™ºåŠ› / è€ƒè¯•éš¾åº¦ä¸¤è€…ä¹‹é—´å¦‚æœä¹ŸæœªçŸ¥ï¼ŒçŸ¥é“å…¶ä¸­ä¸€ä¸ªä¹Ÿæ¨ä¸å‡ºå¦ä¸€ä¸ªæ¥ã€‚</li>
<li>ä½†æ˜¯å¦‚æœå·²çŸ¥æˆç»©ï¼Œæ¯”å¦‚ï¼šæˆç»©æ™®éå¾ˆå¥½ã€‚é‚£ä¹ˆç”±Bï¼Œæ¯”å¦‚æŸä¸ªäººçš„æ™ºåŠ›ä¸è¡Œï¼Œä½†æ˜¯æˆç»©å¥½ï¼Œå¯ä»¥æ¨å®šAï¼ˆéš¾åº¦ä½ï¼‰ï¼Œåä¹‹ï¼Œå¦‚æœæˆç»©æ™®éå¾ˆå·®ï¼Œç”±Bï¼ˆé«˜æ™ºåŠ›ï¼‰ï¼Œå¯ä»¥æ¨çŸ¥Aï¼ˆéš¾åº¦é«˜ï¼‰ã€‚</li>
</ul>
<p><strong><u>ä»¥ä¸Šè¿™ä¸‰ç§æœ‰å‘å›¾ç»“æ„ï¼Œå¯ä»¥æ–¹ä¾¿è¿›è¡Œæ¡ä»¶ç‹¬ç«‹åˆ¤å®šä»¥åŠä¿¡æ¯å…³è”æ€§çš„å¿«é€ŸåŒºåˆ†ï¼Œåˆ¤å®šä¸¤ä¸ªéšæœºå˜é‡ä¹‹é—´æ˜¯å¦å­˜åœ¨å…³è”æ—¶å¯ä»¥åº”ç”¨ã€‚</u></strong>è”ç³»ä¾‹å­å³å¯ã€‚</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹ï¼šéƒ½æ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼Œä¸€èˆ¬æœªçŸ¥ï¼Œéœ€è¦ä»ä¿¡æ¯ä¸­æ¨æ–­</li>
<li>æ¯ä¸ªæœ‰å‘å¼§ï¼šéƒ½æ˜¯æ¡ä»¶æ¦‚ç‡ã€‚Aå‘ç”Ÿæ—¶ï¼ŒCå­˜åœ¨æ¦‚ç‡å‘ç”Ÿï¼Œåˆ™A-&gt;Cæœ‰å¼§ã€‚</li>
</ul>
<h3 id="æ¡ä»¶ç‹¬ç«‹ä¸é©¬å°”å¯å¤«é“¾">2.2 æ¡ä»¶ç‹¬ç«‹ä¸é©¬å°”å¯å¤«é“¾</h3>
<p>æ¡ä»¶ç‹¬ç«‹ï¼š <span class="math display">\[
\begin{equation}
P(X,Y|Z)=P(X|Z)P(Y|Z)
\end{equation}
\]</span> â€‹ åœ¨Zå‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒXï¼ŒYåŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡ä¸ºåˆ†åˆ«æ¦‚ç‡çš„ç§¯ã€‚å¯ä»¥å†™æˆå¦ä¸€ç§å½¢å¼ï¼š <span class="math display">\[
\begin{equation}
P(X|Y,Z)=\frac{P(X,Y,Z)}{P(Y,Z)}=\frac{P(X,Y|Z)P(Z)}{P(Y|Z)P(Z)}=\frac{P(X,Y|Z)}{P(Y|Z)}=P(X|Z)
\end{equation}
\]</span> â€‹ è¿™æœ€èƒ½ç›´æ¥è¯´æ˜æ¡ä»¶ç‹¬ç«‹çš„æ„ä¹‰ï¼šç»™å®šæ¡ä»¶Y,Zï¼Œè‹¥X,Yæ¡ä»¶ç‹¬ç«‹ï¼ŒYæ¡ä»¶ä¸å½±å“Xäº‹ä»¶ï¼Œå¯ä»¥ç›´æ¥ä»æ¡ä»¶ä¸­åˆ é™¤ã€‚è€ŒCRFä¸­çš„æœ‰å‘è¾¹è¡¨å¾äº†æ¡ä»¶æ¦‚ç‡ï¼Œå¯¹åº”åœ°ï¼Œç»“ç‚¹é—´å…³ç³»ï¼ˆä»¥ä¸Šä¸‰ç§æ¨¡å¼ï¼‰è¡¨å¾äº†æ¡ä»¶ç‹¬ç«‹æ€§ã€‚</p>
<p>â€‹ å¦‚æœä¸¤ä¸ªç»“ç‚¹ä¹‹é—´çš„ä¸­é—´ç»“ç‚¹å·²ç»å®Œå…¨ç¡®å®šï¼Œå·²ç»æ²¡æœ‰ <strong><u>ä¸é€šè¿‡ä¸­é—´å·²ç»è§‚æµ‹ç»“ç‚¹</u></strong> çš„ç›´è¿è·¯å¾„æˆ–è€…é—´æ¥è·¯å¾„äº†ï¼Œæ­¤æ—¶ä¸¤ä¸ªç»“ç‚¹æ¡ä»¶ç‹¬ç«‹ã€‚è€Œæ¡ä»¶ç‹¬ç«‹å¯ä»¥ç”¨äºç†è§£Markové“¾ï¼š <span class="math display">\[
\begin{equation}
P(x_t)=P(x_1)P(x_2|x_1)P(x_3|x_1,x_2)...P(x_t|x_1,x_2,...x_{t-1})
\end{equation}
\]</span> â€‹ è¿™ä¸ªæ˜¯æ™®é€šçš„é“¾å¼æ³•åˆ™ã€‚è€Œç”±äºä¸€é˜¶é©¬å°”å¯å¤«å‡è®¾ï¼šå†å²ä¸å½±å“æœªæ¥ï¼Œè¿‡å»çš„çŠ¶æ€ä¸æœªæ¥æ¡ä»¶ç‹¬ç«‹ã€‚é‚£ä¹ˆå¯ä»¥ç®€åŒ–é“¾å¼æ³•åˆ™ä¸ºï¼š <span class="math display">\[
\begin{equation}
P(x_t)=P(x_1)P(x_2|x_1)P(x_3|x_2)...P(x_t|x_{t-1})=P(x_1)\prod_{i=1}^tP(x_{i}|x_{i-1})
\end{equation}
\]</span> â€‹ è¿™å¯ä»¥å¤§å¤§ç®€åŒ–è¿ç®—ä»¥åŠå‚¨å­˜éš¾åº¦ã€‚</p>
<h3 id="ä½¿ç”¨ä¾‹å­ç†è§£dgm-é©¬å°”å¯å¤«æ¯¯">2.3 ä½¿ç”¨ä¾‹å­ç†è§£DGM / é©¬å°”å¯å¤«æ¯¯</h3>
<p>æœ´ç´ è´å¶æ–¯å°±æ˜¯ä¸ªå¾ˆå…¸å‹çš„DGMä¾‹å­ã€‚æœ´ç´ ï¼ˆnaiveï¼‰å°±naiveåœ¨ï¼š</p>
<blockquote>
<p>åŸºäºç‰¹å¾æ¡ä»¶ç‹¬ç«‹å‡è®¾çš„åˆ†ç±»å™¨ã€‚</p>
</blockquote>
<p>â€‹ ç‰¹å¾æ¡ä»¶ç‹¬ç«‹è¿™ä¸ªå‡è®¾å¾ˆå¼ºäº†ï¼Œä¸€èˆ¬åšä¸åˆ°ã€‚ä½†æ˜¯åœ¨DGMä¸­å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<pre class="mermaid">
graph TB

A[Label]--&gt;B[Feature 1]
A--&gt;C[Feature 2]
A--&gt;D[Feature 3]
A--&gt;E[...]

</pre>
<p>â€‹ ç»™å®šLabelåï¼Œæ‰€æœ‰çš„Featuresæ¯«æ— å…³è”ï¼ˆTail to Tail ç»“æ„ï¼‰ã€‚</p>
<h4 id="é©¬å°”å¯å¤«æ¯¯">2.3.1 é©¬å°”å¯å¤«æ¯¯</h4>
<p>â€‹ é©¬å°”å¯å¤«æ¯¯è¯´çš„æ˜¯è¿™æ ·ä¸€ä¸ªé›†åˆï¼šé›†åˆ<span class="math inline">\(\Pi(t)\)</span>è¡¨å¾äº†ï¼Œå½“æˆ‘ä»¬å¯¹é›†åˆ<span class="math inline">\(\Pi(t)\)</span>å†…çš„æ‰€æœ‰éšæœºå˜é‡è¿›è¡Œè§‚æµ‹ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç»“ç‚¹tä¸å‰©ä¸‹çš„ç»“ç‚¹ä¹‹é—´å®Œå…¨æ¡ä»¶ç‹¬ç«‹ï¼ˆ<strong>å•Šï¼Œè¢«å­¤ç«‹äº†ï¼Œç›¸å½“äº<span class="math inline">\(\Pi(t)\)</span></strong>æŠŠtå¢™äº†ï¼‰ã€‚ä¾‹å­ï¼š</p>
<pre class="mermaid">
graph LR

A(1)--&gt;B(2)
A--&gt;C(3)
B--&gt;D(5)
C--&gt;D
B--&gt;E(4)
C--&gt;F(6)
E--&gt;G(7)
D--&gt;F
D--&gt;G
F--&gt;G

</pre>
<p>â€‹ é‚£ä¹ˆå¯¹äºç»“ç‚¹5ï¼Œå…¶é©¬å°”å¯å¤«æ¯¯ä¸ºï¼Ÿ</p>
<ul>
<li>é¦–å…ˆ2ï¼Œ3ç»™å®šä¹‹åï¼Œç”±äº2ï¼Œ3ä¸º5çš„çˆ¶ç»“ç‚¹ï¼Œ2ï¼Œ3çš„è§‚æµ‹å¯¼è‡´5ä¸1çš„ç‹¬ç«‹</li>
<li>æ­¤åæ˜¯5ä¸4çš„ç‹¬ç«‹ï¼šæœ‰èµ–äº2çš„ç»™å®šã€‚</li>
<li><strong><u>è§‚æµ‹æœ¬èº«ä¼šå¯¼è‡´è¢«è§‚æµ‹å˜é‡ä¸å…¶çˆ¶èŠ‚ç‚¹æˆ–è€…å­ç»“ç‚¹ç‹¬ç«‹ï¼</u></strong>ä¸ç¡®å®šæ€§æ¶ˆé™¤ã€‚æ•…5å»ºç«‹6ï¼Œ7çš„è§‚æµ‹ï¼Œ6ï¼Œ7è¦ç»™å®šã€‚</li>
<li>ä½†æ˜¯ç»™å®šäº†7ï¼Œåœ¨5ï¼Œ7ï¼Œ4å½¢æˆäº†ä¸€ä¸ªHead to Head ç»“æ„ã€‚ä¼šå¯¼è‡´5å’Œ4çš„ä¸ç‹¬ç«‹ï¼Œé‚£ä¹ˆéœ€è¦ç»™å®š4ä»¥æ¶ˆé™¤ä¸ç¡®å®šæ€§çš„æ–¹å¼ç»ˆç»“ã€‚</li>
<li>æœ€åçš„æ¯¯å­æ˜¯ï¼š<span class="math inline">\({\{2,3,4,6,7\}}\)</span></li>
</ul>
<h4 id="dgmåˆ°åº•èƒ½å¹²ä»€ä¹ˆ">2.3.2 DGMåˆ°åº•èƒ½å¹²ä»€ä¹ˆ</h4>
<p>â€‹ å¤šä¸ªå˜é‡é”™ç»¼å¤æ‚çš„å› æœå…³ç³»ï¼Œç›¸äº’æœ‰å½±å“ã€‚ä¸€ä¸ªå˜é‡çš„æ”¹å˜å¯èƒ½å¯¼è‡´æ•´ä¸ªç½‘ç»œï¼ˆè¯´åˆ°ç½‘ç»œå°±ä¼šå½¢æˆä¸€ä¸ªé«˜ç»´ç»“æ„äº†ï¼Œä¹‹æ‰€ä»¥æ˜¯é«˜ç»´ï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ªå›¾å¯èƒ½ä¸æ˜¯å¹³é¢å›¾ï¼Œä¸ä¸€å®šè¡¨è¾¾çš„å°±æ˜¯äºŒç»´å…³ç³»ï¼‰å†…éƒ¨çš„å˜é‡å‘ç”Ÿè¿é”å˜åŒ–ã€‚é‚£ä¹ˆä¸ºäº†è§£å†³æœ‰æ¡ä»¶ç‹¬ç«‹ / æ¡ä»¶æ¦‚ç‡è”ç³»èµ·æ¥çš„å¤šä¸ªç½‘ç»œå˜é‡ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="æœ‰å‘å›¾çš„æ¦‚ç‡è¡¨ç¤º">2.3.3 æœ‰å‘å›¾çš„æ¦‚ç‡è¡¨ç¤º</h4>
<p>ç”±æ¡ä»¶æ¦‚ç‡çš„å®šä¹‰ï¼Œè”åˆæ¦‚ç‡å¯ä»¥ç”±è¾¹ç¼˜ / æ¡ä»¶è¡¨ç¤ºã€‚åœ¨æœ‰å‘å›¾ä¸­ï¼Œç”±äºæœ‰å‘å›¾å¯¹æ¡ä»¶æ¦‚ç‡è¿›è¡Œå»ºæ¨¡ï¼ˆæ¯ä¸€æ¡è¾¹å°±æ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡å…³ç³»ï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨æœ‰å‘å›¾å¦‚ä½•è¡¨ç¤ºæ¦‚ç‡ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre class="mermaid">
graph LR

A((X1))--&gt;B((X2))
B--&gt;C((X3))
B--&gt;D((X4))
C--&gt;E((X5))
D--&gt;E

</pre>
<p>â€‹ å¦‚æœéœ€è¦ä½¿ç”¨æœ‰å‘å›¾å…³ç³»è¡¨ç¤º<span class="math inline">\(\{x_1,x_2,x_3,x_4,x_5\}\)</span>çš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œå¦‚ä½•å†™å‡ºè¿™ä¸ªè¡¨è¾¾å¼ï¼Ÿï¼ˆç»™å®šé¡¶å±‚ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯èµ·æºç»“ç‚¹<span class="math inline">\(x_1\)</span>çš„åˆå§‹åˆ†å¸ƒ<span class="math inline">\(P(x_1)\)</span>ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸ºï¼š <span class="math display">\[
\begin{equation}
P(x_1,x_2,x_3,x_4,x_5)=P(x_1)P(x_2|x_1)\rightarrow?
\end{equation}
\]</span> â€‹ ä¹‹åï¼Œ<span class="math inline">\(x_3\)</span> <span class="math inline">\(x_4\)</span>æ˜¯ä¹˜æ³•å…³ç³»è¿˜æ˜¯åŠ æ³•å…³ç³»ï¼Ÿé¦–å…ˆå¯ä»¥è‚¯å®šï¼Œæ¥ä¸‹æ¥çš„æ¦‚ç‡è¡¨è¾¾å¼æ˜¯<span class="math inline">\(P(x_4|x_2)\)</span>ä¸<span class="math inline">\(P(x_3|x_2)\)</span>ï¼ˆç”±äº<span class="math inline">\(x_2\)</span>çš„å­˜åœ¨ï¼Œå¯¼è‡´<span class="math inline">\(x_1\)</span>ï¼Œ<span class="math inline">\(\{x_3,x_4\}\)</span>æ¡ä»¶ç‹¬ç«‹ï¼‰ï¼Œä¸ªäººè®¤ä¸ºï¼Œæ­¤å¤„<span class="math inline">\(x_5\)</span>çš„äº§ç”Ÿæ˜¯<span class="math inline">\(\{x_3,x_4\}\)</span>å…±åŒä½œç”¨çš„ç»“æœã€‚æ¯”å¦‚è¯´ï¼Œè€ƒè¯•ï¼š<span class="math inline">\(\{x_3,x_4\}\)</span>åˆ†åˆ«è¡¨ç¤ºéš¾åº¦ä»¥åŠå­¦ç”Ÿæ™ºåŠ›ï¼Œ<span class="math inline">\(x_5\)</span>ä¸ºåˆ†æ•°ã€‚äº§ç”Ÿåˆ†æ•°å¿…é¡»è¦æœ‰å‰ä¸¤ä¸ªå› ç´ ï¼Œæ•…æ­¤å¤„è™½ç„¶æ˜¯ä¸¤ä¸ªé€šè·¯ï¼Œä½†æ˜¯ä»ç„¶æ˜¯ä¹˜æ³•åŸåˆ™èµ·ä½œç”¨ï¼ˆä¸äº‹ä»¶ï¼‰ï¼ˆ<strong><u>å¯èƒ½éšå«è¡¨è¾¾äº†ï¼ŒDGMä¸­å­ç»“ç‚¹éœ€è¦æ‰€æœ‰çˆ¶ç»“ç‚¹æˆç«‹è€Œäº§ç”Ÿ</u></strong>ï¼‰ <span class="math display">\[
\begin{equation}
P(x_1,x_2,x_3,x_4,x_5)=P(x_1)P(x_2|x_1)P(x_3|x_2)P(x_4|x_2)P(x5|x_3,x_4)
\end{equation}
\]</span> â€‹ ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­ï¼š</p>
<pre class="mermaid">
graph LR

A((X1))
B((X2))
C((X3))
D((X4))
E((X5))
F((X6))
G((X7))
A--&gt;D
A--&gt;E
B--&gt;D
C--&gt;D
C--&gt;E
D--&gt;F
D--&gt;G
E--&gt;G

</pre>
<p>â€‹ å¯ä»¥ç«‹å³å¾—åˆ°è”åˆåˆ†å¸ƒï¼šï¼ˆä¸ä»”ç»†æ¨äº†ï¼‰ <span class="math display">\[
\begin{equation}
P(x_1,...x_7)=P(x_1)P(x_2)P(x_3)P(x_4|x_1,x_2,x_3)P(x_5|x_1,x_3)P(x_6|x_4)P(x_7|x_4,x_5)
\end{equation}
\]</span></p>
<p>â€‹ è¿™æ ·çš„è”åˆæ¦‚ç‡æ±‚è§£è§„å¾‹æ˜¯å¯ä»¥æ¨å¹¿çš„ã€‚</p>
<hr>
<h2 id="iii.-æ— å‘å›¾æ¨¡å‹ugm">III. æ— å‘å›¾æ¨¡å‹ï¼ˆUGMï¼‰</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ">3.1 åŸºæœ¬æ¦‚å¿µ</h3>
<p>â€‹ åŒºåˆ«äºæœ‰å‘å›¾æ¨¡å‹ï¼ˆDGMï¼‰ï¼Œæ— å‘å›¾æ¨¡å‹ä¸æ˜¯å¯¹å› æœå…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>â€‹ æ— å‘å›¾å’Œæœ‰å‘å›¾çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å‘å›¾è¡¨å¾äº†å› æœå…³ç³»ï¼Œå¹¶ä¸”è¿æ¥æœ‰æ–¹å‘æ€§ï¼Œå¯¼è‡´äº†å¤„ç†å›¾åƒè¿™æ ·çš„é—®é¢˜æ—¶ï¼Œ<strong><u>ä¸æ–¹ä¾¿è¿›è¡Œå»ºæ¨¡</u></strong>ã€‚</p>
<pre class="mermaid">
graph LR

1--&gt;4
2--&gt;5
3--&gt;6
1--&gt;2
2--&gt;3

4--&gt;5

5--&gt;6

4--&gt;7
5--&gt;8
6--&gt;9
7--&gt;8
8--&gt;9

</pre>
<p>â€‹ å¯ä»¥çœ‹å‡ºï¼Œåœ¨å¯¹æœ‰å‘å›¾è¿›è¡Œå»ºæ¨¡æ—¶ï¼Œå¦‚æœè¦è¿›è¡Œæ¡ä»¶ç‹¬ç«‹åˆ†æï¼ˆæ¯”å¦‚æˆ‘ä»¬è¦å•ç‹¬åˆ†æ5ä¸å…¶ä»–çš„ç»“ç‚¹çš„æ¡ä»¶ç‹¬ç«‹æ€§ï¼‰ã€‚éœ€è¦å¯»æ‰¾é©¬å°”å¯å¤«æ¯¯ï¼Œé‚£ä¹ˆåœ¨æœ‰å‘å›¾ä¸­ï¼Œé™¤äº†<span class="math inline">\(\{2,4,6,8\}\)</span>ä¹‹å¤–ï¼Œå®é™…ä¸Šè¿˜æœ‰åˆ«çš„ç»“ç‚¹ï¼Œè€Œ<span class="math inline">\(\{2,4,6,8\}\)</span>æ˜¯1é˜¶é‚»åŸŸï¼Œåœ¨å›¾åƒå¤„ç†ä¸­æ¯”è¾ƒå¸¸è§æ±‚ä¸€é˜¶é‚»åŸŸä¸ä¸­å¿ƒç‚¹é—´çš„å…³ç³»ã€‚è€Œæ­¤å¤„ï¼Œè¦åŠ å…¥<span class="math inline">\(\{3,7\}\)</span>ç»“ç‚¹ï¼ˆHead to Headï¼Œç”±äºç»™å®šäº†8ï¼Œ5ä¸7ä¸å†æ¡ä»¶ç‹¬ç«‹ï¼Œéœ€è¦ç»™å®š7ï¼Œ3çš„è¯åŒç†ï¼‰ã€‚é‚£ä¹ˆæ˜¾ç„¶æˆ‘ä»¬åŠ å…¥äº†å¥‡æ€ªçš„ç‚¹ï¼Œå¯¼è‡´åˆ†æå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¹¶ä¸”ä¸æœ‰å‘å›¾ç½‘ç»œçš„ç”Ÿæˆæ–¹å‘è¿˜å­˜åœ¨å…³ç³»ã€‚</p>
<p>â€‹ è€Œä½¿ç”¨æ— å‘å›¾çš„è¯ï¼Œç”±äºç»“ç‚¹ä¹‹é—´æ˜¯å¹³ç­‰çš„ï¼Œåœ¨æ— å‘å›¾ä¸­çš„é©¬å°”å¯å¤«æ¯¯ç›´æ¥å°±æ˜¯<span class="math inline">\(\{2,4,6,8\}\)</span>ã€‚</p>
<p>â€‹ æ— å‘å›¾ä¸­ï¼Œå­˜åœ¨ä¸‰ç§ç‹¬ç«‹æ€§ï¼š</p>
<ol type="1">
<li>å…¨å±€ç‹¬ç«‹æ€§ï¼ˆå…¨å±€é©¬å°”å¯å¤«æ€§ï¼‰</li>
</ol>
<pre class="mermaid">
graph LR

A((1))---B((2))
B---D((4))
A---C((3))
C---D
E((5))---A
D---F((6))

</pre>
<p>â€‹ å½“æˆ‘ä»¬åˆ é™¤ç»“ç‚¹<span class="math inline">\(\{2,3\}\)</span>æ—¶ï¼Œå¯çŸ¥é›†åˆ<span class="math inline">\(\{1,5\}\)</span>ä»¥åŠ<span class="math inline">\(\{4,6\}\)</span>ä¹‹é—´å®Œå…¨æ²¡æœ‰è”ç³»äº†ã€‚åˆ é™¤ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´çš„è¿é€šæ€§ç»“ç‚¹ï¼Œäº§ç”Ÿä¸¤ä¸ªè¿é€šæ”¯ï¼Œåˆ™è¿™ä¸¤ä¸ªè¿é€šæ”¯ <strong>ç‹¬ç«‹</strong>ã€‚</p>
<ol start="2" type="1">
<li>å±€éƒ¨ç‹¬ç«‹æ€§ï¼ˆå±€éƒ¨é©¬å°”å¯å¤«æ€§ï¼‰</li>
</ol>
<pre class="mermaid">
graph TB

a((1))
b((2))
c((3))
d((4))
e((5))
f((6))
g((7))
a---b
a---c
a---d
a---e
c---f
e---g
b---f
d---g

</pre>
<p>â€‹ å¯çŸ¥ï¼Œå½“æˆ‘ä»¬æŠŠ2ï¼Œ3ï¼Œ4ï¼Œ5åˆ å»ä¹‹åï¼Œ1ç»“ç‚¹ä¸æ‰€æœ‰å…¶ä»–ç»“ç‚¹å®Œå…¨æ²¡æœ‰è”ç³»äº†ã€‚<strong><u>1è¢«å­¤ç«‹äº†ï¼Œå› ä¸ºå…¶é©¬å°”å¯å¤«æ¯¯å·²ç»è¢«åˆ é™¤äº†ã€‚</u></strong>é‚£ä¹ˆï¼Œ1ä¸å…¶ä»–ç»“ç‚¹æ¡ä»¶ç‹¬ç«‹ã€‚å†™ä¸ºè¡¨è¾¾å¼å¯ä»¥å¦‚ä¸‹ï¼š</p>
<p>â€‹ è®¾<span class="math inline">\(V_k\)</span>ä¸ºæˆ‘ä»¬æ¢ç´¢çš„ç»“ç‚¹ï¼Œ<span class="math inline">\(V_M\)</span>ä¸º<span class="math inline">\(V_k\)</span>çš„é©¬å°”å¯å¤«æ¯¯çš„èŠ‚ç‚¹é›†åˆï¼Œè€Œ<span class="math inline">\(V_S\)</span>ä¸º<span class="math inline">\(V_i\in \{V\}/\{V_M\cup V_k\}\)</span>ï¼Œåˆ™å¯çŸ¥ï¼š <span class="math display">\[
\begin{equation}
V_k\perp V_S|V_M
\end{equation}
\]</span> â€‹ å³ç»™å®šé©¬å°”å¯å¤«æ¯¯ï¼Œåˆ™å¯¹åº”ç»“ç‚¹å’Œé™¤å…¶æœ¬èº«ä»¥åŠé©¬å°”å¯å¤«æ¯¯ç»“ç‚¹ä¹‹å¤–çš„æ‰€æœ‰ç»“ç‚¹æ¡ä»¶ç‹¬ç«‹ã€‚</p>
<ol start="3" type="1">
<li>æˆå¯¹ç‹¬ç«‹æ€§ï¼ˆæˆå¯¹é©¬å°”å¯å¤«æ€§ï¼‰</li>
</ol>
<p>â€‹ uï¼Œvä¸ºä¸¤ä¸ªæ²¡æœ‰ç›´è¿è¾¹çš„ç»“ç‚¹ã€‚å»æ‰uï¼Œvä¹‹å¤–çš„å…¶ä»–ç‚¹ï¼Œ<strong><u>uï¼Œvæ¡ä»¶ç‹¬ç«‹ã€‚</u></strong></p>
<h3 id="å›¢å—cliqueçš„æ¦‚å¿µ">3.2 å›¢å—ï¼ˆCliqueï¼‰çš„æ¦‚å¿µ</h3>
<p>â€‹ å¦‚æœä¸€ä¸ªç»“ç‚¹é›†åˆå†…ï¼Œä»»æ„ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´å­˜åœ¨è¿è¾¹ï¼Œé‚£ä¹ˆç§°è¿™æ˜¯ä¸€ä¸ªå›¢ï¼ˆCliqueï¼‰ã€‚</p>
<p>â€‹ æœ€å¤§å›¢ï¼šåœ¨ä¸€ä¸ªå›¢Cå¤–éƒ¨ä»»æ„æ‰¾ä¸€ä¸ªç»“ç‚¹ï¼ŒåŠ å…¥æ­¤å›¢åéƒ½ä¼šç ´åå›¢çš„æ€§è´¨ï¼ˆæ­¤ç»“ç‚¹ä¸è‡³å°‘ä¸€ä¸ªç»“ç‚¹ä¹‹é—´ä¸å­˜åœ¨è¿è¾¹ï¼‰ã€‚ä¹Ÿå³å¤–éƒ¨å·²ç»ä¸èƒ½å†åŠ å…¥ç»“ç‚¹ä½¿å›¢å˜å¤§äº†ã€‚</p>
<p>â€‹ æ— å‘å›¾æ¨¡å‹ä¸­ä¸€èˆ¬ä¼šæ¶‰åŠåˆ°å¤§é‡ç»“ç‚¹ï¼Œé‚£ä¹ˆè¦è¡¨ç¤ºè¿™äº›ç»“ç‚¹çš„è”åˆæ¦‚ç‡å°±ååˆ†éº»çƒ¦ã€‚å¯ä»¥ä½¿ç”¨æœ€å¤§å›¢æ¥è¿›è¡Œæè¿°ï¼Œå°† <strong><u>æ— å‘å›¾ä¸­çš„è”åˆæ¦‚ç‡åˆ†å¸ƒè¡¨ç¤ºä¸ºæå¤§å›¢çš„åŠ¿å‡½æ•°ï¼ˆPotential Functionï¼‰</u></strong>çš„ç§¯ã€‚ä¹Ÿå³ï¼š <span class="math display">\[
\begin{equation}
P(x)=\frac{1}{Z}\prod_{i=1}^n\psi_i(x_i)
\end{equation}
\]</span> â€‹ ä¸Šå¼ä¸­ï¼Œ<span class="math inline">\(\psi_i(x)\)</span>è¡¨ç¤ºæå¤§å›¢<span class="math inline">\(x_i\)</span>çš„åŠ¿å‡½æ•°ï¼Œè€ŒZåˆ™æ˜¯å½’ä¸€åŒ–å› å­ï¼Œä¸ºäº†ä½¿<span class="math inline">\(P(x)\)</span>æ»¡è¶³æ¦‚ç‡çš„å½’ä¸€åŒ–æ€§è´¨ã€‚å½’ä¸€åŒ–å› å­åˆå«åšï¼šé…åˆ†å‡½æ•°ï¼ˆPartition Functionï¼‰ï¼Œä½†æ˜¯å¦‚ä½•è¿›è¡Œè®¡ç®—å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼ˆä¾‹å­æ¥è‡ªCSDNï¼Œä½†æ˜¯æ„Ÿè§‰è®²çš„ä¸å¤ªæ¸…æ¥šï¼Œæˆ‘è‡ªå·±ç†è§£ä¸€ä¸‹ï¼šï¼‰</p>
<div class="note info"><p>2021.11.15è¡¥å……ï¼šå½“æ—¶è¿˜ä¼šçœ‹ç²ªå‘CSDNå‘¢ã€‚PSï¼šå‚è€ƒçš„æ–‡çŒ®éƒ½æ²¡æœ‰è®°å½•ã€‚</p>
</div>
<pre class="mermaid">
graph TB

A((x1))
B((x2))
C((x3))
D((x4))
E((x5))
A---B
A---C
B---C
C---D
C---E

</pre>
<p>â€‹ å¯çŸ¥ï¼Œå›¾ä¸­å­˜åœ¨ä¸‰ä¸ªæå¤§å›¢ï¼š<span class="math inline">\(\{x_1, x_2, x_3\}\)</span>ï¼Œ<span class="math inline">\(\{x_3,x_5\}\)</span>ï¼Œ<span class="math inline">\(\{x_3, x_4\}\)</span> (æ³¨æ„ä¸€ä¸ªç»“ç‚¹å¯ä»¥å­˜åœ¨äºå¤šä¸ªæå¤§å›¢ä¸­ï¼)ã€‚é‚£ä¹ˆæ•´ä¸ªè”åˆæ¦‚ç‡åˆ†å¸ƒå¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}
P(x_1, x_2, x_3,x_4,x_5)=\frac 1Z\psi_1(x_1,x_2,x_3)\psi_2(x_3,x_5)\psi_3(x_3,x_4)
\end{equation}
\]</span> â€‹ é‚£ä¹ˆZåº”å¦‚ä½•è®¡ç®—ï¼Ÿéœ€è¦å¯¹æ¯ä¸ªç»“ç‚¹è¿›è¡Œéå†ã€‚ä¸‹å¼ä¸ºæ¯ä¸ªç»“ç‚¹æ‰€åœ¨æå¤§å›¢çš„åŠ¿å‡½æ•°ï¼š <span class="math display">\[
\begin{align}
    &amp; x_1:\psi_1(x_1,x_2,x_3)\\
    &amp; x_2:\psi_1(x_1,x_2,x_3)\\
    &amp; x_3:\psi_1(x_1,x_2,x_3)\psi_2(x_3,x_5)\psi_3(x_3,x_4)\\
    &amp; x_4:\psi_3(x_3,x_4)\\
    &amp; x_5:\psi_2(x_3,x_5)
\end{align}
\]</span> â€‹ å¯¹æ¯ä¸ªç»“ç‚¹è¿›è¡Œæ±‚å’Œå½’ä¸€åŒ–ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿä¸ºä»€ä¹ˆæ˜¯å¯¹æ¯ä¸€ä¸ªç»“ç‚¹ç»“ç‚¹æ‰€åœ¨å›¢çš„åŠ¿å‡½æ•°ï¼Ÿè€Œä¸æ˜¯æ±‚æ¯ä¸€ä¸ªç»“ç‚¹å¯¹åº”çš„æŸä¸€ä¸ªå…¶ä»–å‡½æ•°è¿›è¡Œç´¯åŠ æ±‚å’Œï¼Ÿ</p>
<div class="note danger"><p>2021.11.15 è¡¥å……ï¼šè¯¶ï¼Ÿæˆ‘æœ€ååœ¨è¿™é‡Œå†™äº†ä¸€ä¸ªå¼€æ”¾æ€§æ€è€ƒé¢˜ï¼Ÿåº”è¯¥æ˜¯åŸæ¥æˆ‘æ²¡æƒ³æ¸…æ¥šï¼Œä½†æ˜¯æœ€åä¹Ÿæ²¡å»æƒ³ã€‚</p>
</div>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>æ¦‚ç‡è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>æ»¤æ³¢ï¼†å¡å°”æ›¼</title>
    <url>/2021/05/31/%E6%BB%A4%E6%B3%A2%EF%BC%86%E5%8D%A1%E5%B0%94%E6%9B%BC/</url>
    <content><![CDATA[<h1 id="filtering-kalman">Filtering &amp; Kalman</h1>
<hr>
<h2 id="i.-å¼•å…¥">I. å¼•å…¥</h2>
<p>â€‹ 2021èµ›å­£å……åˆ†è®¤è¯†åˆ°æ»¤æ³¢çš„ç¾å¦™ä¹‹å¤„ã€‚è™½ç„¶åªå‰å­¦äº†DSPï¼Œä½†æ˜¯åœ¨è¿›è¡Œå®é™…ç³»ç»Ÿæ§åˆ¶çš„æ—¶å€™ï¼Œå¾ˆå°‘æœ‰æ„è¯†åœ°è¿›è¡Œæ»¤æ³¢æˆ–è€…å¹³æ»‘ã€‚2020èµ›å­£ä¸­è®¾ç½®è¿‡ä¸€ä¸ªé™æ­¢ç›®æ ‡æ»‘åŠ¨å¹³å‡ï¼Œåœ¨æ­¤å‰æ²¡æœ‰åšè¿‡éå¸¸å¤§é‡çš„æ»¤æ³¢ã€‚</p>
<p><img src="/2021/05/31/%E6%BB%A4%E6%B3%A2%EF%BC%86%E5%8D%A1%E5%B0%94%E6%9B%BC/disp-1622393689154.png"></p>
<center>
Figure 1. å•æ–¹å‘ARKFæ»¤æ³¢é¢„æµ‹
</center>
<p>â€‹ æœ¬æ–‡æ˜¯å¯¹è¿‘æ®µæ—¶é—´ä½¿ç”¨çš„æ»¤æ³¢æ–¹æ³•è¿›è¡Œçš„ä¸€ä¸ªæ¯”è¾ƒè‚¤æµ…çš„æ€»ç»“ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ARKFï¼ˆè‡ªé€‚åº”æŠ—å·®KFï¼‰</li>
<li>MEE &amp; CMEEï¼ˆçº¦æŸæœ€å°è¯¯å·®ç†µKFï¼‰</li>
<li>ESKFï¼ˆError State KFï¼‰</li>
</ul>
<span id="more"></span>
<hr>
<h2 id="ii.-arkf">II. ARKF</h2>
<h3 id="ç†è®ºåˆ†æ">2.1 ç†è®ºåˆ†æ</h3>
<h4 id="æŠ—å·®">2.1.1 æŠ—å·®</h4>
<p>â€‹ ARKF[1]æ˜¯å¾ˆè€çš„å·¥ä½œäº†ï¼Œå¤§åˆ›ç­”è¾©çš„æ—¶å€™è€å¸ˆè¿˜ç‰¹åœ°é—®æˆ‘ä¸ºä»€ä¹ˆè¦å¼•é‚£ä¹ˆè€çš„æ–‡çŒ®ï¼ˆ1999ï¼Œæ¯”æˆ‘è¿˜å¤§ï¼‰ï¼ˆå°å£°ï¼šä½†äººå®¶ç®€å•æœ‰æ•ˆå•Šï¼‰ã€‚æˆ‘å·²ç»åœ¨<a href="https://enigmatisms.github.io/2021/04/03/%E4%BC%98%E9%9B%85%E7%BA%BF%E4%BB%A3%E4%B8%8E%E7%BE%8E%E5%A6%99%E4%BC%98%E5%8C%96/">[ä¼˜é›…çº¿ä»£ä¸ç¾å¦™ä¼˜åŒ–]</a>ä¸€æ–‡ä¸­è¯´äº†ï¼Œå¡å°”æ›¼æ»¤æ³¢æ˜¯æ€ä¹ˆä¸æœ€å°äºŒä¹˜è”ç³»èµ·æ¥çš„ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{lsp}
W(k){x}(k)+\xi(k)=Y(k)
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(W(k)\)</span>ï¼ˆå®é™…æ˜¯ä¸Šé¢é‚£ç¯‡åšå®¢ä¸­æåˆ°çš„<span class="math inline">\(X(k)\)</span>ï¼Œä½†æ˜¯<span class="math inline">\(X\)</span>ç”¨äºè¡¨ç¤ºéçŠ¶æ€çŸ©é˜µï¼Œå®¹æ˜“ä¸<span class="math inline">\(x\)</span>å‘ç”Ÿå†²çªï¼‰ä»¥åŠ<span class="math inline">\(Y(k)\)</span>çš„æ„ä¹‰ç›´æ¥çœ‹ä¸Šé¢æåˆ°çš„åšæ–‡å§ã€‚<span class="math inline">\(\xi(k)\)</span>åˆ™æ˜¯çŠ¶æ€è½¬ç§»å™ªå£° / è§‚æµ‹å™ªå£°concatenationçš„ç™½åŒ–å˜æ¢ã€‚æˆ‘ä»¬æåˆ°ï¼ŒKFå®é™…ä¸Šæ˜¯æ ¹æ®<span class="math inline">\(\eqref{lsp}\)</span>è¿›è¡ŒMSEæœ€å°åŒ–çš„è¿‡ç¨‹ã€‚</p>
<p>â€‹ ä½†æ˜¯MSEåœ¨å¾ˆå¤šé—®é¢˜ä¸‹çš„è¡¨ç°å¹¶ä¸å¥½ï¼Œç‰¹åˆ«æ˜¯å¤–ç‚¹å¾ˆå¤šçš„æ—¶å€™ã€‚æƒ³æƒ³åœ¨æœ€å°äºŒä¹˜ç›´çº¿æ‹Ÿåˆçš„æ—¶å€™ï¼Œä¸€ä¸ªå¤–ç‚¹å°±èƒ½è®©ç›´çº¿æ‹Ÿåˆå‡ºæ¥çš„å‚æ•°å˜å¾—æ¯”åŸæ¥ç¦»è°±å¾ˆå¤šï¼Œè¿™æ˜¯ç”±äºè¯¯å·®å‡½æ•°çš„æ€§è´¨å†³å®šçš„ï¼šMSEå¯¹åå·®å¤§çš„æ•°æ®äº§ç”Ÿçš„costæ˜¯å¹³æ–¹çº§åˆ«çš„costï¼Œè€ŒHuberåˆ™æ˜¯çº¿æ€§çš„costã€‚</p>
<center>
<img src="/2021/05/31/%E6%BB%A4%E6%B3%A2%EF%BC%86%E5%8D%A1%E5%B0%94%E6%9B%BC/huber.png" style="zoom:72%;">
</center>
<center>
Figure 2. Huberå‡½æ•°å’ŒMSE
</center>
<p>â€‹ è¿™å°±å†³å®šäº†Huberå‡½æ•°å­˜åœ¨ä¸€å®šçš„å¤–ç‚¹é²æ£’æ€§ï¼Œå¯¹äºå¤–ç‚¹å¤šçš„æ•°æ®ï¼ŒHuberå‡½æ•°çš„KFå°†ä¼šæ›´åŠ ç¨³å®šã€‚ä½†æ˜¯å¾ˆå¯æƒœï¼Œç”±äºHuberå‡½æ•°çš„è¡¨è¾¾å¼æ¯”MSEå¤æ‚ï¼Œå¹¶ä¸”åŸå§‹Huberå‡½æ•°æ˜¯å­˜åœ¨éçº¿æ€§çš„ï¼ˆifåˆ¤å®šï¼Œè™½ç„¶å¯¼æ•°ä»¥åŠåŸå‡½æ•°æ˜¯è¿ç»­çš„ï¼‰ï¼Œæˆ‘ä¸ªäººæ²¡æœ‰æ¨å‡ºå…¶è§£æè§£ï¼ˆæˆ‘ä¹Ÿæ²¡æ¨ï¼Œæˆ‘ä¹Ÿä¸ä¼šMathematicaï¼‰ï¼Œæ‰€ä»¥å¯¹äºå…¬å¼<span class="math inline">\(\eqref{lsp}\)</span>å®šä¹‰çš„â€œçŠ¶æ€è½¬ç§»â€ï¼Œç”±äºå…¬å¼<span class="math inline">\(\eqref{lsp}\)</span>å±•å¼€æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{optim}
\begin{pmatrix}
I\\
H
\end{pmatrix}\breve{x}(k)=
\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} +
\begin{pmatrix}
w(k)\\
v(k)
\end{pmatrix}=
\begin{pmatrix}
A\hat{x}(k-1)\\
z(k)
\end{pmatrix} + E(k)
\end{equation}
\]</span> â€‹ å…¶ä¸­'<span class="math inline">\(\breve{}\)</span>'è¡¨ç¤ºå…ˆéªŒï¼Œ'<span class="math inline">\(\hat{}\)</span>'è¡¨ç¤ºåéªŒï¼Œæˆ‘ä»¬éœ€è¦ä¼°è®¡çš„æ˜¯å…¬å¼<span class="math inline">\(\eqref{optim}\)</span>ä¸­çš„<span class="math inline">\(\breve{x}(k)\)</span>ï¼ˆä¹Ÿå°±æ˜¯KFéœ€è¦ä¼°è®¡çš„å½“å‰çŠ¶æ€ï¼Œå®é™…å°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{lsp}\)</span>çš„<span class="math inline">\(x(k)\)</span>ï¼‰ï¼Œé‚£ä¹ˆ<span class="math inline">\(x(k)\)</span>å¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{optim2}
x(k)^*=\mathop{\arg \min}_{x(k)}\sum \Phi(y_i-w_i^Tx(k))
\end{equation}
\]</span></p>
<p>â€‹ æ­¤å¤„ï¼Œ<span class="math inline">\(w_i^T\)</span>æ˜¯å…¬å¼<span class="math inline">\(\eqref{lsp}\)</span>ä¸­æåˆ°çš„çŸ©é˜µ<span class="math inline">\(W(k)\)</span>çš„ç¬¬iè¡Œã€‚<span class="math inline">\(\Phi(Â·)\)</span>æ˜¯é²æ£’æ ¸å‡½æ•°ï¼Œæ­¤å¤„å¯ä»¥ä¸ºHuberã€‚æ™®é€šå¡å°”æ›¼æ»¤æ³¢åˆ™æ­¤å¤„ä¸º<span class="math inline">\((Â·)^2\)</span>å‡½æ•°ï¼Œå¹³æ–¹åˆ™æ˜¯å­˜åœ¨é—­å¼è§£çš„ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨åŒ–ä¸ºæ±‚å’Œå¼ï¼Œåªéœ€è¦ç®€å•ç”¨pseudoé€†å°±å¯æ±‚å‡ºã€‚</p>
<p>â€‹ è€Œç”±äº<span class="math inline">\(y_i,w_i\)</span>éƒ½æ˜¯å·²çŸ¥çš„ï¼Œå…·æœ‰å…·ä½“çš„æ„ä¹‰ï¼Œåªå‰©ä¸‹æœªçŸ¥çš„å¾…ä¼°è®¡ä½å§¿<span class="math inline">\(x(k)\)</span>ï¼Œé‚£ä¹ˆåªéœ€è¦æ±‚è§£å…¬å¼<span class="math inline">\(\eqref{optim2}\)</span>å®šä¹‰çš„ä¼˜åŒ–é—®é¢˜å³å¯ã€‚è¿™æ­¥åœ¨Kalmanæ»¤æ³¢ä¸­ç§°ä¸ºï¼šæŠ—å·®ï¼ˆRobustï¼‰åŒ–ï¼Œå› ä¸ºè§£æŠ—å·®æœ€å°äºŒä¹˜é—®é¢˜å¾—åˆ°çš„è§£å°†æ›´åŠ ç¨³å®šã€‚</p>
<h4 id="è‡ªé€‚åº”">2.1.2 è‡ªé€‚åº”</h4>
<p>â€‹ æœ´ç´ KFçš„å™ªå£°åæ–¹å·®ä¸æ˜¯è‡ªé€‚åº”çš„ï¼Œè€Œæ˜¯å¼€å§‹å°±è®¾ç½®å¥½çš„ã€‚Qå’ŒRä¸¤ä¸ªçŸ©é˜µï¼Œä¸€ä¸ªä»£è¡¨çŠ¶æ€è½¬ç§»å™ªå£°åæ–¹å·®ï¼Œå¦ä¸€ä¸ªä»£è¡¨è§‚æµ‹å™ªå£°åæ–¹å·®ï¼Œéƒ½æ˜¯å›ºå®šçš„ï¼ˆéè‡ªé€‚åº”ï¼Œå›ºå®šå°±æ„å‘³ç€é«˜æ–¯å™ªå£°å‡è®¾ï¼‰ã€‚è¿™ä¸¤ä¸ªçŸ©é˜µçš„æ„ä¹‰æ¯”è¾ƒæ˜ç¡®ï¼šåæ˜ äº†ä¸åŒçš„ç‰©ç†è¿‡ç¨‹çš„å™ªå£°å¤§å°ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>è‹¥è¦è®©ç»“æœå€¾å‘äºæ•°å­¦æ¨¡å‹ï¼ˆçŠ¶æ€è½¬ç§»æ¨¡å‹ï¼‰ï¼Œé‚£ä¹ˆçŠ¶æ€è½¬ç§»å™ªå£°åº”è¯¥æ˜¾è‘—å°äºè§‚æµ‹å™ªå£°ã€‚</li>
<li>å¦‚æœè¦è®©ç»“æœå€¾å‘äºè§‚æµ‹ï¼ˆè§‚æµ‹æ¨¡å‹ï¼‰ï¼Œé‚£ä¹ˆè§‚æµ‹å™ªå£°åº”è¯¥æ˜¾è‘—å°äºçŠ¶æ€è½¬ç§»å™ªå£°ã€‚</li>
</ul>
<p>â€‹ ä½†æ˜¯å®é™…ä½¿ç”¨ä¸­ï¼Œå…³äºã€çŠ¶æ€è½¬ç§» / è§‚æµ‹ä¸¤è€…è°æ›´å¯é ã€‘çš„é—®é¢˜æ˜¯éå¸¸ä¸å¥½å›ç­”çš„ã€‚æˆ‘å¯ä»¥å‡­å€Ÿå…ˆéªŒçŸ¥è¯†æ¥åˆ¤å®šï¼ŒçŠ¶æ€è½¬ç§»æ›´å¥½è¿˜æ˜¯è§‚æµ‹æ›´å¥½ï¼Œä½†æ˜¯è¿™ä¹Ÿä»…é™äºâ€œå®šæ€§åˆ¤å®šâ€ï¼Œæ­¤åçš„KFç”šè‡³è¿˜éœ€è¦è¿›è¡Œè°ƒå‚ï¼Œæ‰èƒ½å¾—åˆ°è¾ƒå¥½çš„æ”¶æ•›ç»“æœã€‚æ­¤å¤–ï¼Œä¸¤ä¸ªå™ªå£°åæ–¹å·®çš„å›ºå®šæ€§é™åˆ¶äº†æˆ‘ä»¬å¯ä»¥å¤„ç†çš„å™ªå£°ç§ç±»ï¼ˆåªèƒ½æ˜¯é«˜æ–¯å™ªå£°ï¼‰ï¼Œæ˜¾ç„¶é™åˆ¶äº†KFåœ¨æŸäº›é—®é¢˜ä¸‹çš„æ³›åŒ–ã€‚è‡ªé€‚åº”çš„è¿‡ç¨‹å¯ä»¥è®¤ä¸ºæ˜¯ï¼š</p>
<div class="note info"><p>ä½¿å¾—KFå¯ä»¥å¤„ç†çš„å™ªå£°ç±»å‹æ‘†è„±é«˜æ–¯å™ªå£°é™åˆ¶</p>
</div>
<p>â€‹ ä½œè€…ä½¿ç”¨çš„æ˜¯ä¸­å€¼åå·®ï¼ˆmedian deviationï¼‰ã€‚è¯´å®åœ¨çš„ï¼Œè¿™ä¸ªmedian deviationå…¬å¼å¯ä»¥è¯´æ˜¯å¾ˆå¥‡æ€ªäº†ï¼š <span class="math display">\[
\begin{equation}\label{med}
\hat{d}(k)=\text{median}\vert \frac{r(i)-\text{median}(r(i))}{0.6745}\vert
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(r(i)\)</span>æ˜¯æ»‘åŠ¨çª—å£å†…çš„ä¸€ä¸ªæ–°æ¯ï¼ˆinnovationï¼‰ï¼Œå…¶å®å°±æ˜¯åå·®ï¼š<span class="math inline">\(z(i)-Hx(i)\)</span>ã€‚æ‰€ä»¥è¿™åšçš„æ˜¯ä»€ä¹ˆï¼Ÿç›¸å½“äºæ˜¯ï¼šè®¡ç®—è¯¯å·®åæ–¹å·®æ—¶ï¼ˆå°¤å…¶æ˜¯æ–¹å·®è®¡ç®—ï¼‰ï¼Œæœ¬èº«æ˜¯å¯ä»¥é€šè¿‡æ ‡å‡†å·®ï¼ˆstandard deviationï¼‰è®¡ç®—å‡ºæ¥çš„ï¼Œä½†æ˜¯å¯ä»¥è®¡ç®—æ ‡å‡†å·®çš„æ›¿ä»£å“ï¼ˆåˆ«çš„deviationï¼‰ã€‚è€Œæ­¤å¤„ï¼Œæ–°æ¯çš„æœ€ä¼˜ä¼°è®¡ä¹Ÿä½¿ç”¨äº†é²æ£’æ ¸å‡½æ•°ï¼š <span class="math display">\[
\begin{equation}\label{innov}
r^*(k)=\mathop{\arg\min}_{\hat{r}(k)}\sum^{k}_{i=k-N+1}\Psi\left(\frac{r(i)-\hat{r}(k)}{\hat d(k)}\right)
\end{equation}
\]</span> â€‹ å³ï¼Œå·²çŸ¥ä¸€ä¸ªæ»‘åŠ¨çª—å£å†…çš„æ‰€æœ‰æ–°æ¯çš„ä¿¡æ¯<span class="math inline">\(r(i)\)</span>ï¼Œæ ¹æ®ä¸­å€¼åå·®è¿›è¡Œçš„re-scaleæ“ä½œåŠ æƒ + Huberé²æ£’æ ¸å‡½æ•°ï¼Œä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼Œå¾—åˆ°æ–°æ¯çš„æœ€ä¼˜ä¼°è®¡ï¼Œæ ¹æ®æ–°æ¯è®¡ç®—å™ªå£°æ°´å¹³ã€‚</p>
<h3 id="ä»£ç ">2.2 ä»£ç </h3>
<p>â€‹ ä»£ç å¯è§<a href="https://github.com/Enigmatisms/Algorithms-Plus/tree/master/cpp/KF">[GithubğŸ”—:Algorithm-Plus/KF]</a>ã€‚å…¶ä¸­<code>KFTest.cc</code>æ˜¯å¯¹ä¸€ä¸ªå¸¦æœ‰è¿åŠ¨å™ªå£°çš„å°çƒè¿›è¡Œçš„ä»¿çœŸï¼Œä½¿ç”¨çš„å°±æ˜¯ARKFã€‚å½“å‰æ•ˆæœå·²ç»æ¯”ä¼ ç»ŸKFç¨³å®šäº†å¾ˆå¤šï¼ˆä¸è¿‡åŒæ—¶ä¹Ÿç»“åˆäº†å¾ˆå¤šç®€å•æ»¤æ³¢å™¨ï¼‰ã€‚</p>
<video src="arkf_simulation.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<hr>
<h2 id="iii.-mee-cmee">III. MEE &amp; CMEE</h2>
<p>â€‹ [2]ã€‚è¿™æ˜¯KFæœ€è¿‘çš„å·¥ä½œï¼Œä½¿ç”¨EEï¼ˆError Entropyï¼‰æ›¿æ¢åŸæ¥çš„MSE / Robust MSEå‡†åˆ™ã€‚å®é™…ä¸Šï¼Œè¿™äº›äººå…³äºKFçš„æƒ³æ³•å°±æ˜¯ï¼š</p>
<ul>
<li>ç²’å­æ»¤æ³¢å¤ªæ…¢äº†ï¼Œä½†æ˜¯å®ƒå¾ˆæ£’ï¼Œå¯ä»¥å¤„ç†ä»»æ„çš„åˆ†å¸ƒ</li>
<li>KFä¸å¤ªè¡Œï¼Œå› ä¸ºå…¶å™ªå£°è¦æ±‚æ˜¯é«˜æ–¯çš„ï¼Œè€Œä¸”ä¸è‡ªé€‚åº”</li>
</ul>
<p>â€‹ ç†è§£æ­¤è®ºæ–‡çš„å†…å®¹éœ€è¦æœ‰ä¸€å®šçš„ç†è®ºå‚¨å¤‡ã€‚</p>
<h3 id="error-entropy-kernel">3.1 Error Entropy &amp; Kernel</h3>
<h4 id="ç®€å•ä»‹ç»">3.1.1 ç®€å•ä»‹ç»</h4>
<p>â€‹ è¿™ç¯‡è®ºæ–‡[3]è¯¦ç»†åœ°ä»‹ç»äº†MEEçš„æ€æƒ³ä»¥åŠå…¶ä¸M-estimationçš„å…³ç³»ï¼Œæˆ‘ç»“åˆè¿™ç¯‡è®ºæ–‡ç®€å•è¯´ä¸€ä¸‹å§ï¼ˆè¿™ç¯‡è®ºæ–‡åšçš„modificationå°±ä¸è¯´äº†ï¼‰ã€‚</p>
<p>â€‹ æ­¤å¤„ä½¿ç”¨çš„Entropyæœ‰åˆ«äºé€šå¸¸è¯´çš„é¦™å†œç†µï¼ˆShannonï¼‰ï¼Œè¿™ä¸ªç†µè¢«ç§°ä¸ºRenyi entropyï¼Œä¸é¦™å†œç†µçš„åŒºåˆ«å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{align}
&amp; H_s(X)=-\sum\log(P_i(x))P_i(x)\label{shannon} \\ 
&amp; H_a(X)=\frac{1}{1-a}\log(\sum P^a(x))\label{renyi}
\end{align}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{shannon}\)</span>æ˜¯é¦™å†œç†µï¼Œè€Œå…¬å¼<span class="math inline">\(\eqref{renyi}\)</span>æ˜¯Renyiç†µã€‚è¿™ä¸¤ä¸ªå¼å­è®©æˆ‘æƒ³åˆ°äº†åœ¨DIPè¯¾ä¸Šå­¦åˆ°çš„ä¸¤ä¸ªæ»¤æ³¢å™¨ï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„å‡å€¼æ»¤æ³¢å™¨ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯é€†è°æ³¢å‡å€¼æ»¤æ³¢å™¨ï¼ˆé˜¶æ•°å¯å˜é‚£ç§ï¼‰ã€‚é¦™å†œç†µå°±æ˜¯Renyiç†µåœ¨aè¶‹è¿‘äº1çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚MEEä¸­å¸¸ç”¨çš„æ˜¯a=2ï¼ˆç§°ä¸ºquadratic Renyi entropyï¼‰ã€‚è®ºæ–‡[3]åšä½œè€…æåˆ°çš„EEåšçš„äº‹å®é™…ä¸Šæ˜¯ï¼š</p>
<blockquote class="blockquote-center">
<p>The concept of â€˜closeâ€™, implicitly or explicitly employs a distance function or similarity measure.</p>

</blockquote>
<p>â€‹ ä¹Ÿå³ï¼ŒEEå®šä¹‰çš„æ˜¯ä¸€ç§ç›¸ä¼¼ / æ¥è¿‘çš„åº¦é‡ã€‚è€Œç”±äºEEåœ¨è®¡ç®—æ—¶å¼•å…¥äº†æ¦‚ç‡ï¼Œæ™®é€šçš„<strong><u>è¯¯å·®ï¼ˆæˆ–è€…è¯´æ˜¯åå·®ï¼‰</u></strong>æ˜¯æ²¡æœ‰æ¦‚ç‡çš„å½’ä¸€ã€èŒƒå›´æ€§è´¨çš„ï¼Œä¸èƒ½ç›´æ¥å‚ä¸è¿ç®—ã€‚æ ¸å‡½æ•°å°±èµ·åˆ°äº†ä¸€ä¸ªæ˜ å°„ä¸ºæ¦‚ç‡çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ä¸ªsigmoid / softmaxï¼š <span class="math display">\[
\begin{align}
&amp; H_2(e)=-\log V(e) \label{h2}\\
&amp; V(e)=\frac 1 {L^2} \sum_{j=1}^N\sum_{i=1}^Nk_{\sigma}(e_i-e_j) \label{kernel}\\
&amp; k_{\sigma}(x)=\frac{1}{\sqrt{2\pi}\sigma}\exp\left(-\frac{x^2}{2\sigma^2}\right)
\end{align}
\]</span> â€‹ æœ€åçš„Renyi EEå°±å¦‚å…¬å¼<span class="math inline">\(\eqref{h2}\)</span>æ‰€å®šä¹‰ã€‚æœ€å°åŒ–Renyi EEå°±æ˜¯è¦æœ€å¤§åŒ–å…¬å¼<span class="math inline">\(\eqref{kernel}\)</span>å®šä¹‰çš„<span class="math inline">\(V(e)\)</span>ï¼Œä¹Ÿå³è¯¯å·®çš„QIPï¼ˆquadratic information potentialï¼‰ã€‚KFæœ¬è´¨æ±‚è§£çš„åŠ æƒæœ€å°äºŒä¹˜é—®é¢˜ï¼ŒARKFä¸ºè‡ªé€‚åº”åŠ æƒé²æ£’æœ€å°äºŒä¹˜é—®é¢˜ã€‚è€Œå…¶ä¸­çš„eï¼Œä»¥æˆ‘ä¸ªäººå¯¹è®ºæ–‡çš„ç†è§£ï¼Œåº”è¯¥è¡¨ç¤ºçš„æ˜¯æ–°æ¯ã€‚ä½†æ˜¯è®ºæ–‡[2]é‡Œé¢å®é™…è¯´çš„æ˜¯ï¼Œ<span class="math inline">\(e\)</span>æ˜¯æ»¤æ³¢å™¨è¾“å‡ºä¸â€œæœŸæœ›è¾“å‡ºâ€çš„åå·®ã€‚å—¯ï¼ŸæœŸæœ›è¾“å‡ºæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿå…¶å®æ˜¯æœ€ä¼˜æ»¤æ³¢å™¨çš„è¾“å‡ºï¼Œ<span class="math inline">\(e\)</span>æ˜¯æœ€ä¼˜æ»¤æ³¢å™¨ä¸å½“å‰å‚æ•°æ»¤æ³¢å™¨è¾“å‡ºçš„å·®å¼‚ã€‚</p>
<p>â€‹ æ‰€ä»¥å¯ä»¥çŸ¥é“ï¼š</p>
<div class="note info"><p>â€‹ MEEå‡†åˆ™æ˜¯åœ¨ä¼˜åŒ–æœ€ä¼˜æ»¤æ³¢å™¨å’Œå½“å‰å‚æ•°æ»¤æ³¢å™¨è¾“å‡ºä¹‹é—´è¯¯å·®çš„è¯¯å·®ç†µã€‚</p>
</div>
<p>â€‹ ç„¶åæˆ‘å‘ç°äº†æœ‰è¶£çš„ä¸œè¥¿ï¼šè®ºæ–‡[4]æ˜¯äººæœºæ‰€è€å¸ˆä»¬çš„æ–‡ç« ï¼Œå®Œå…¨ä»‹ç»äº†MEE-KFã€‚è€Œè®ºæ–‡[2]å¯¹MEE-KFçš„ä»‹ç»å¹¶ä¸é€å½»ï¼Œç”šè‡³çœ‹å®Œä¹‹åæˆ‘è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šå¦‚ä½•å®ç°ã€‚è®ºæ–‡[4]åˆ™è¯´å¾—å°†ä¸€äº›ç»†èŠ‚è¯´çš„æ›´åŠ æ¸…æ¥šã€‚</p>
<h4 id="parzençª—ä¸renyi-entropy">3.1.2 Parzençª—ä¸Renyi Entropy</h4>
<p>â€‹ æ²¡æƒ³åˆ°è¿˜èƒ½å’ŒParzençª—è”ç³»èµ·æ¥ï¼Œå½“æ—¶æ²¡å¾€è¿™æ–¹é¢æƒ³ã€‚Parzençª—æ˜¯ä¸€ç§æ ¸å¯†åº¦ä¼°è®¡æ–¹æ³•ï¼ˆéå‚æ•°åœ°ä¼°è®¡æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œåœ¨æˆ‘å¤§ä¸‰ä¸‹å­¦æœŸçš„ã€Šæ¨¡å¼è¯†åˆ«ä¸æœºå™¨å­¦ä¹ ã€‹è¯¾ç¨‹ä¸­å­¦äº†ï¼‰ã€‚å®é™…ä¸Šå…¬å¼<span class="math inline">\(\eqref{kernel}\)</span>å®šä¹‰çš„å°±æ˜¯ä¸€ä¸ªParzençª—æ“ä½œï¼Œæ€ä¹ˆç†è§£ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆï¼Œè¿›è¡ŒRenyi entropyè®¡ç®—éœ€è¦è®¡ç®—IPï¼ˆinformation potentialï¼‰</li>
<li>IPçš„è®¡ç®—éœ€è¦ä¾èµ–æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œè¿™å¯ä»¥ç”¨Parzençª—ä¼°è®¡å‡ºæ¥</li>
</ul>
<p>â€‹ é¦–å…ˆï¼ŒParzençª—æ³•æ˜¯è¿™æ ·çš„ï¼š <span class="math display">\[
\begin{equation}\label{parzen}
\hat{p}(x)=\frac 1N \sum_{i=1}^N G_{\sigma}(x-e_i)
\end{equation}
\]</span> â€‹ ç›¸å½“äºåœ¨ä¸€å †<span class="math inline">\(\{e_i\}\)</span>ï¼ˆå·²ç»é‡‡æ ·å¾—åˆ°çš„errorï¼‰ä¸Šæ”¾ä¸€ä¸ªGaussåˆ†å¸ƒå‡½æ•°ï¼Œå†è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾—åˆ°å¯†åº¦ä¼°è®¡ã€‚é€šè¿‡é‡‡æ ·å¾—åˆ°çš„<span class="math inline">\(\{e_i\}\)</span>å¯ä»¥ä¼°è®¡å‡ºerrorçš„åˆ†å¸ƒï¼Œä»è€Œè®¡ç®—ä¿¡æ¯åŠ¿<span class="math inline">\(V_a(e)\)</span>ã€‚äºŒé˜¶ç¦»æ•£æƒ…å†µä¸‹è®¡ç®—ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{potential}
\hat{V}_2(e)=\frac 1N \sum_{i=1}^N\hat{p}(e_i)=\frac 1{N^2} \sum_{i=1}^N \sum_{j=1}^N G_{\sigma}(e_i-e_j)
\end{equation}
\]</span> â€‹ ä½†ä¸Šè¿°å…¬å¼è¿˜å­˜åœ¨ä¸€äº›å¥‡æ€ªçš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´<span class="math inline">\(\hat{V}_2(e)=\frac 1N \sum_{i=1}^N\hat{p}(e_i)\)</span>ã€‚æ˜æ˜æ­£å¸¸æƒ…å†µä¸‹ï¼ŒäºŒé˜¶ä¿¡æ¯åŠ¿åº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{v2}
V_2(x)=\int p^2(x)dx\rightarrow\sum_{i=1}^N p^2(x)
\end{equation}
\]</span> â€‹ æ­¤å¤„ç›´æ¥æŠŠäºŒæ¬¡é¡¹å»æ‰äº†ï¼Œç›¸å½“äºå¯¹<span class="math inline">\(p(x)\)</span>æŒ‰å…¶è‡ªèº«çš„åŠ æƒå¹³å‡å˜æˆäº†ç›´æ¥å¹³å‡ã€‚å¯èƒ½æ˜¯ä¸€ç§è¿‘ä¼¼è®¡ç®—æ–¹æ³•å§ï¼Œå› ä¸ºå¹³æ–¹ç¡®å®ä¼šéº»çƒ¦ä¸€äº›ï¼Œå°†ä¼šå†™æˆä»¥ä¸‹å½¢å¼ï¼š <span class="math display">\[
\begin{equation}\label{right}
V_2(x)=\sum_{i=1}^N p^2(x)=\frac 1{N^2}\sum_{i=1}^N
\left(\sum_{j=1}^NG_{\sigma}(e_i-e_j)\right)
\left(\sum_{j=1}^NG_{\sigma}(e_i-e_j)\right)
\end{equation}
\]</span> â€‹ è¿™æ˜¾ç„¶æ˜¯ä¸å…¬å¼<span class="math inline">\(\eqref{potential}\)</span>æœ‰ä¸€å®šå·®åˆ«çš„ã€‚ç›¸å½“äºå…¬å¼<span class="math inline">\(\eqref{right}\)</span>æ˜¯å°†å…¶ä¸­ä¸€ä¸ªå†…æ±‚å’Œå¼è¿‘ä¼¼ä¸ºäº†1ï¼ˆè¿™åˆç†å—ï¼Ÿè™½ç„¶è®ºæ–‡è¯´çš„å°±æ˜¯ï¼š<code>one can obtain an estimate of the second order (Î± = 2) information potential</code>ï¼‰ï¼Œæ„Ÿè§‰Parzençª—ï¼ˆä¸€æ¬¡è¿‘ä¼¼ï¼‰+ å‡åŒ€åˆ†å¸ƒï¼ˆç¬¬äºŒæ¬¡è¿‘ä¼¼ï¼‰æ˜¯ä¸¤æ¬¡è¿‘ä¼¼å•Šï¼Ÿè¿˜æ˜¯æˆ‘ç†è§£é”™äº†ï¼Ÿä½†æ˜¯ç¡®å®è¿™æ ·çš„è¿‘ä¼¼ä¼šè®©Renyi Entropyæ›´æ–¹ä¾¿è®¡ç®—ã€‚ä¹‹åçš„æ¨å¯¼å°±<strong><u>éå¸¸å¤æ‚</u></strong>äº†ã€‚ä¹‹åå¼€å•ç‹¬çš„ä¸€ç¯‡è¿›è¡Œåˆ†æï¼Œæˆ‘å¯èƒ½è‡ªå·±ä¹Ÿä¼šå°è¯•å®ç°ä¸€ä¸‹ï¼Œæ—¢ç„¶æœ‰é—­å¼è§£é‚£ä¹ˆå¯èƒ½å®ç°èµ·æ¥å¹¶ä¸ä¼šå¤ªå¤æ‚å§ï¼ˆï¼Ÿé£˜äº†ï¼‰ã€‚</p>
<h3 id="çº¦æŸä¸é—­å¼è§£">3.2 çº¦æŸä¸é—­å¼è§£</h3>
<p>â€‹ è¯´å®åœ¨çš„ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç•¥æœ‰ç‚¹â€œå¼ºè¡Œåˆ›æ–°â€çš„æ„Ÿè§‰ã€‚ä¸çŸ¥é“æ€ä¹ˆè¯´è¿™ä¸ªæ¯”è¾ƒå¥½ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†æ²¡çœ‹æ˜ç™½ã€‚è®ºæ–‡[2]åšçš„äº‹æƒ…æ˜¯å¢åŠ äº†ä¸€ä¸ªçº¦æŸï¼ˆè¿˜æ˜¯ç­‰å¼çº¦æŸï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{const}
\mathop{\arg\max}_{\pmb{w}}\hat{V}_2(e_n)\text{ subject to }\mathbf{C}^T\pmb{w}_n=\mathbf{f}
\end{equation}
\]</span> â€‹ åé¢è¿™ä¸ªçº¦æŸæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿä»€ä¹ˆå®é™…é—®é¢˜ä¸‹ä¼šæœ‰è¿™æ ·çš„çº¦æŸå‘¢ï¼Ÿå°±æŠ“ä½è¿™æ ·ä¸€ç‚¹å°çš„æ”¹åŠ¨å°±å¯ä»¥æœ‰ä¸€ç¯‡è®ºæ–‡å˜›ï¼Ÿè™½ç„¶ååºçš„æ¨å¯¼è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œä½œè€…é€šè¿‡çº¦æŸ + å˜æ¢æ±‚å‡ºäº†å¯¹åº”çš„æ‹‰æ ¼æœ—æ—¥ä¹˜å­çš„å–å€¼ã€‚å…¶ä¸­éœ€è¦è®¾ç½®çš„æ˜¯çº¦æŸå‚æ•°<span class="math inline">\(\mathbf{C}\)</span>ä»¥åŠ<span class="math inline">\(\mathbf{f}\)</span>ã€‚</p>
<p>â€‹ ä»”ç»†ä¸€çœ‹ï¼Œè¿˜æ˜¯æˆ‘ä»¬å­¦æ ¡çš„è€å¸ˆï¼ˆé™ˆéœ¸ä¸œæ•™æˆï¼‰ä½œä¸ºå…¶ä¸­ä¸€ä½ä½œè€…ã€‚å½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºï¼Œè®ºæ–‡é•¿åº¦åªæœ‰5é¡µï¼ˆå› ä¸ºæ˜¯ç¯‡briefï¼‰ï¼Œæœ‰äº›æ¨å¯¼ä¸æ˜¯ç‰¹åˆ«çš„è¯¦ç»†ã€‚ä½†å¯èƒ½æˆ‘è¿˜æ˜¯è§‰å¾—ï¼Œå°±å¤šè®¨è®ºäº†ä¸€ä¸ªçº¦æŸçš„æƒ…å†µï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§çš„æ„æ€å§ã€‚</p>
<hr>
<h2 id="iv.-eskf">IV. ESKF</h2>
<p>â€‹ æˆ‘åœ¨åšæœºé˜Ÿçš„æŸé¡¹å®šä½ä»»åŠ¡çš„æ—¶å€™ç”¨åˆ°äº†ESKFï¼ˆError-State KFï¼‰[5]ï¼Œå¯¹æœºå™¨äººçš„è½®é€Ÿ / IMU / UWBï¼ˆå®šä½ä¿¡å·ï¼‰è¿›è¡Œèåˆã€‚ESKFä¸æ™®é€šKFæœ€æ ¹æœ¬çš„åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>æ™®é€šKFçš„çŠ¶æ€å°±æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œå…·æœ‰æ˜ç¡®ç‰©ç†å«ä¹‰çš„çŠ¶æ€ï¼Œæ¯”å¦‚é€Ÿåº¦ / ä½ç½® / è§’åº¦ã€‚</li>
<li>ESKFçš„çŠ¶æ€æ˜¯è¯¯å·®ï¼ŒçŠ¶æ€è½¬ç§» / è§‚æµ‹éƒ½æ˜¯æœ‰å…³è¯¯å·®çš„ï¼ˆæ¯”å¦‚ä½ç½®è¯¯å·® / é€Ÿåº¦è¯¯å·®ï¼‰ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªå¯¹è¯¯å·®è¿›è¡Œæ»¤æ³¢å¾—åˆ°ç»“æœï¼Œæ¯æ¬¡ä½¿ç”¨æ»¤æ³¢ä¼°è®¡å‡ºçš„ç³»ç»Ÿè¯¯å·®è¿›è¡ŒåŸçŠ¶æ€çš„è®¡ç®—ã€‚</li>
<li>å¯ä»¥ç†è§£ä¸ºï¼šKFæ˜¯ä½ç½®å¼çš„æ§åˆ¶ï¼ˆæ¯æ¬¡æ»¤æ³¢å¾—åˆ°çš„éƒ½æ˜¯æœ€ç»ˆç»“æœï¼‰ï¼Œè€ŒESKFéƒ½æ˜¯å¢é‡å¼çš„æ§åˆ¶ï¼ˆæ¯æ¬¡æ»¤æ³¢å¾—åˆ°çš„æ˜¯çŠ¶æ€åº”æœ‰çš„å˜åŒ–å€¼ï¼‰ã€‚</li>
</ul>
<div class="note primary"><p>â€‹ çŠ¶æ€æ€»æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šå®é™…çŠ¶æ€ï¼ˆtrue stateï¼‰= <strong>ç†æƒ³çŠ¶æ€ï¼ˆnominal stateï¼‰</strong>+ <strong>å™ªå£°çŠ¶æ€ï¼ˆerror stateï¼‰</strong></p>
</div>
<p>â€‹ KFå¯¹å®é™…çŠ¶æ€è¿›è¡Œæ»¤æ³¢ï¼ŒESKFå¯¹å™ªå£°çŠ¶æ€è¿›è¡Œæ»¤æ³¢ï¼Œè€Œç†æƒ³çŠ¶æ€è¿›è¡Œæ— è¯¯å·®å‡è®¾ï¼Œç›´æ¥æ›´æ–°ã€‚å…³äºESKFçš„ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå› ä¸ºæˆ‘ä¹Ÿèµ˜è¿°ä¸å‡ºæ¥ï¼š</p>
<p><img src="/2021/05/31/%E6%BB%A4%E6%B3%A2%EF%BC%86%E5%8D%A1%E5%B0%94%E6%9B%BC/eskf.jpg"></p>
<center>
Figure 3. ESKF 95é¡µè®ºæ–‡ä¸­çš„ çŠ¶æ€å˜é‡æˆªå›¾
</center>
<p>â€‹ æ¶‰åŠåˆ°å¤§é‡çš„å››å…ƒæ•° / è¿åŠ¨å­¦ / æœºå™¨äººå­¦çŸ¥è¯†ï¼Œå¸¸ç”¨äºå®šä½ï¼Œå› ä¸ºå®ƒæœ‰å¾ˆæ˜¾è‘—çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>error-stateå¾ˆå°ï¼ˆå› ä¸ºæ˜¯è¯¯å·®ï¼‰ï¼Œç›¸å½“äºä½¿ç”¨ç›¸å¯¹é‡è¿›è¡Œè®¡ç®—ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°å¥‡å¼‚ / ä¸‡å‘é”ä¹‹ç±»çš„é—®é¢˜ã€‚</li>
<li>å¦ä¸€æ–¹é¢ï¼Œç”±äºå…¶å¾ˆå°ï¼ˆä¸€èˆ¬éƒ½åœ¨0é™„è¿‘ï¼Œå¹¶ä¸”èŒƒå›´ä¸å¤ªå¤§ï¼‰ï¼Œå¯¹äºå¤æ‚çš„è¿åŠ¨å­¦é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯éçº¿æ€§ç³»ç»Ÿï¼‰ï¼ŒTaylorå±•å¼€åé«˜é˜¶é¡¹ä¸€èˆ¬éƒ½æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œæ€§è´¨å¾ˆå¥½ã€‚</li>
</ul>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] Durovic Z M, Kovacevic B D. Robust estimation with unknown noise statistics[J]. IEEE Transactions on Automatic Control, 1999, 44(6): 1292-1296.</p>
<p>[2] Peng S, Ser W, Chen B, et al. Robust constrained adaptive filtering under minimum error entropy criterion[J]. IEEE Transactions on Circuits and Systems II: Express Briefs, 2018, 65(8): 1119-1123.</p>
<p>[3] Liu W, Pokharel P P, Principe J C. Error entropy, correntropy and m-estimation[C]//2006 16th IEEE Signal Processing Society Workshop on Machine Learning for Signal Processing. IEEE, 2006: 179-184.</p>
<p>[4] Chen B, Dang L, Gu Y, et al. Minimum error entropy Kalman filter[J]. IEEE Transactions on Systems, Man, and Cybernetics: Systems, 2019.</p>
<p>[5] Sola J. Quaternion kinematics for the error-state Kalman filter[J]. arXiv preprint arXiv:1711.02508, 2017.</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>çº¿æ€§ä»£æ•°</tag>
        <tag>æ§åˆ¶ç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>ç‰¹é¾™æ™ºæ…§-GMapping</title>
    <url>/2021/10/22/%E7%89%B9%E9%BE%99%E6%99%BA%E6%85%A7-GMapping/</url>
    <content><![CDATA[<h1 id="ç‰¹é¾™æ™ºæ…§">ç‰¹é¾™æ™ºæ…§</h1>
<hr>
<p>â€‹ æˆ‘åœ¨å¤§äºŒä¸Šå­¦æœŸè´­ä¹°äº†ã€Šæ¦‚ç‡æœºå™¨äººã€‹ä¸€ä¹¦ï¼Œå½“æ—¶è¿˜æ²¡æœ‰å­¦æ¦‚ç‡è®ºï¼Œæ‰€ä»¥æˆ‘çœ‹ä¸æ‡‚ï¼ˆä½†æ˜¯æˆ‘å¤§å—éœ‡æ’¼ï¼‰ã€‚å¤§äºŒä¸‹çš„æš‘å‡æ›¾ç»å­¦äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯æ²¡æœ‰æ·±å…¥ï¼Œåˆ°ç¬¬äº”ç« å°±ç»“æŸäº†ã€‚ç›´åˆ°ç°åœ¨ï¼Œå¤§å››äº†ï¼Œé¡¹ç›®æœ‰è¿™æ–¹é¢çš„éœ€æ±‚äº†ï¼Œæ‰é‡æ–°å¼€å§‹çœ‹ç‰¹é¾™(Sebstian Thrun)è¿™æœ¬å£ç¢‘å¾ˆå¥½çš„ä¹¦ã€‚å°½ç®¡è¿™æœ¬ä¹¦æ˜¯2006å¹´å‡ºç‰ˆçš„ï¼Œå…¶ä¸­çš„å¾ˆå¤šæ€æƒ³åœ¨ç°åœ¨çš„æˆ‘çœ‹æ¥ï¼Œéƒ½è¿˜å¾ˆæœ‰æŒ‡å¯¼æ„ä¹‰ã€‚éå¸¸åæ‚”ï¼Œè‡ªå·±æ²¡èƒ½åœ¨ä¹‹å‰èŠ±ç²¾åŠ›å•ƒä¸‹è¿™æœ¬SLAMä»¥åŠç§»åŠ¨æœºå™¨äººè‘—ä½œã€‚</p>
<p>â€‹ GMappingï¼ˆä»¥åŠç›¸å…³çš„ç²’å­æ»¤æ³¢SLAMæ–¹æ³•ï¼‰æˆ–å¤šæˆ–å°‘éƒ½æœ‰ä»–çš„å‚ä¸ï¼Œæœ€è¿‘ä¹Ÿåˆšå¥½è¯»äº†ç›¸å…³çš„è®ºæ–‡ï¼Œå¹¶ä¸”ä»”ç»†ç ”è¯»äº†å…¶ä»£ç ï¼ˆOpenSLAMä¸Šçš„ğŸ’©å±±ï¼Œliterallyï¼‰ï¼Œæ•…æˆ‘æŠŠè¿™äº›ç¬”è®°æ•´ç†æˆäº†ä¸€ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li>æœ¬æ–‡ä½œè€…å¹¶æ²¡æœ‰ç‰¹é¾™ï¼Œä½†æ˜¯ä¼°è®¡æ˜¯ç›¸å…³å›¢é˜Ÿçš„æ–‡ç« ï¼š<a href="https://ieeexplore.ieee.org/abstract/document/4084563/">Improved Techniques for Grid Mapping with Rao-Blackwellized Particle Filters</a></li>
<li>ä¸Šé¢è¿™ç¯‡è®ºæ–‡å¯ä»¥è¯´æ˜¯ï¼š<a href="https://ieeexplore.ieee.org/abstract/document/1250629/">IROS2003:An Efficient FastSLAM Algorithm for Generating Maps of Large-Scale Cyclic Environments from Raw Laser Range Measurements</a>çš„å‡çº§ç‰ˆï¼ˆè¿™ç¯‡è®ºæ–‡çš„å»ºè®®åˆ†å¸ƒæ˜¯â€œå­¦â€å‡ºæ¥çš„ï¼‰ã€‚</li>
</ul>
<p><img src="/2021/10/22/%E7%89%B9%E9%BE%99%E6%99%BA%E6%85%A7-GMapping/Screenshot%202021-10-22%20194809.png"></p>
<center>
Figure 1. è¿™äººæœ‰ä¸€ä¸ªä»¥è‡ªå·±åå­—å‘½åçš„å®éªŒå®¤ï¼Œè¿˜æ›¾æ‹’ç»è¿‡å‡ºä»»Googleå‰¯æ€»è£...
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-gmapping-è®ºæ–‡åˆ†æ">II. GMapping è®ºæ–‡åˆ†æ</h2>
<h3 id="å¤§è‡´æ€æƒ³">2.1 å¤§è‡´æ€æƒ³</h3>
<p>â€‹ gmappingæ˜¯ä¸€ç¯‡åŸºäºç²’å­æ»¤æ³¢çš„é…å‡†å·¥ä½œï¼Œå…¶ä¸»è¦åˆ›æ–°ç‚¹åªæœ‰ä¸€ç‚¹ï¼šå°±æ˜¯å¾—åˆ°äº†ä¸€ä¸ªæ”¹è¿›çš„ç²’å­æ»¤æ³¢å»ºè®®åˆ†å¸ƒï¼ˆimproved proposal distributionï¼‰ï¼Œè¿™ç¯‡æ–‡ç« æ—¢æ²¡æœ‰æ¶‰åŠåˆ°å›ç¯æ£€æµ‹ã€åç«¯ä¼˜åŒ–ï¼Œä¹Ÿæ²¡æœ‰æ·±å…¥åˆ†æå‰ç«¯çš„é…å‡†ç®—æ³•ã€‚å…¶ä¸»è¦è´¡çŒ®å°±æ˜¯ï¼šæ”¹è¿›ç²’å­æ»¤æ³¢åœ¨æŸäº›ä¼ æ„Ÿå™¨ä¸Šçš„è¡¨ç°ã€‚</p>
<p>â€‹ æˆ‘ä»¬è€ƒè™‘æ¿€å…‰é›·è¾¾ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¿€å…‰é›·è¾¾çš„æµ‹è·ç²¾åº¦å¾ˆé«˜ï¼Œåœ¨é…å‡†ç®—æ³•å…·æœ‰å¾ˆå¥½çš„è¡¨ç°æƒ…å†µä¸‹æ—¶ï¼Œå¯ä»¥è®¤ä¸ºé…å‡†ä¹Ÿæœ‰æ¯”è¾ƒå¥½ï¼Œé…å‡†ç»“æœå™ªå£°è¾ƒå°ã€‚å› ä¸ºç²’å­æ»¤æ³¢çš„ä¸»è¦æ€æƒ³æ˜¯ï¼š</p>
<div class="note info"><ul>
<li>æˆ‘å…ˆå»ºæ¨¡ä¸€ä¸ªæ˜“äºè·å–çš„å»ºè®®åˆ†å¸ƒï¼ˆproposalï¼‰</li>
<li>å†å»ºæ¨¡ä¸€ä¸ªã€è¿‘ä¼¼çš„ã€‘å»ºè®®åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒä¹‹é—´çš„å·®åˆ«wï¼ˆæƒé‡ï¼‰ï¼ˆæ ¹æ®è´å¶æ–¯ç†è®ºï¼Œä¸€èˆ¬æ˜¯ä¹˜æ€§çš„å› å­ï¼‰</li>
</ul>
</div>
<p>â€‹ å¯è§ï¼Œå¦‚æœç›®æ ‡åˆ†å¸ƒï¼ˆè´å¶æ–¯åéªŒï¼‰å¾ˆå¥½è·å¾—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ç›®æ ‡åˆ†å¸ƒå½“ä½œå»ºè®®åˆ†å¸ƒï¼Œå¹¶ä¸”ä½¿å¾—è¿™å·®åˆ«æƒé‡éƒ½ç›¸ç­‰ï¼Œä¸º1ã€‚ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦ç²’å­æ»¤æ³¢è§£å†³çš„é—®é¢˜éƒ½ä¸ä¼šæœ‰ç®€å•çš„ç›®æ ‡åéªŒï¼Œæ•…å»ºæ¨¡ä¸€ä¸ªå¥½çš„å»ºè®®åˆ†å¸ƒæ˜¯éå¸¸å¿…è¦çš„ï¼š</p>
<div class="note primary"><ul>
<li>ä¸€ä¸ªå¥½çš„å»ºè®®åˆ†å¸ƒå¯ä»¥ä½¿å¾—ã€è¿‘ä¼¼çš„ã€‘å·®åˆ«æƒé‡å¯¹äºå…¶è¿‘ä¼¼æ€§çš„è¦æ±‚é™ä½</li>
<li>å¥½çš„å»ºè®®åˆ†å¸ƒå¯ä»¥æé«˜é‡‡æ ·çš„è´¨é‡</li>
</ul>
</div>
<p>â€‹ ä¼ ç»Ÿæ„ä¹‰ä¸Šï¼Œå»ºè®®åˆ†å¸ƒä¸€èˆ¬ä¼šä½¿ç”¨odometryçš„è¿åŠ¨æ¨¡å‹åˆ†å¸ƒï¼Œæ¯”å¦‚æ²¿ç€è¿åŠ¨æ–¹å‘çš„ä¸å‚ç›´è¿åŠ¨æ–¹å‘ä¸¤ä¸ªæ–¹å‘ä¸ºä¸»è½´çš„é«˜æ–¯åˆ†å¸ƒã€‚åœ¨ç²’å­çš„æ›´æ–°é˜¶æ®µï¼ˆä¹Ÿå³ä»å»ºè®®åˆ†å¸ƒé‡‡æ ·é˜¶æ®µï¼‰ï¼Œæˆ‘ä»¬æ ¹æ®æ§åˆ¶<span class="math inline">\(u_t\)</span>ï¼Œç¡®å®š<span class="math inline">\(x_t^{(i)}=u_t *x_{t-1}^{(i)}\)</span>ï¼Œå¹¶ä¸”æ ¹æ®<span class="math inline">\(u_t\)</span>ï¼Œç¡®å®šä¸€ä¸ªå¸¦å™ªå£°çš„<span class="math inline">\(x_t^{(i)}\)</span>ï¼Œäººå·¥åŠ å™ªç›¸å½“äºæ˜¯ä»è¿åŠ¨æ¨¡å‹åˆ†å¸ƒä¸­é‡‡æ ·äº†ã€‚ä½†æ˜¯ï¼Œgmappingè¿™ç¯‡è®ºæ–‡è¯´ï¼šodometryè¾ƒä¹‹äºLiDARé…å‡†æ¥è¯´ï¼Œä¸€èˆ¬éƒ½å¤§äº†ä¸€äº›ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨å»ºè®®åˆ†å¸ƒä¸­ä¹Ÿç”¨ä¸Šè§‚æµ‹çš„å€¼ï¼Œè¯´ä¸å®šå¯ä»¥å¾—åˆ°æ›´åŠ ç¬¦åˆç›®æ ‡åˆ†å¸ƒçš„å»ºè®®åˆ†å¸ƒã€‚</p>
<blockquote>
<p>When using the odometry model as the proposal distribution in such a case, the importance weights of the individual samples can differ signifificantly from each other since only a fraction of the drawn samples cover the regions of state space that have a high likelihood under the observation model</p>
</blockquote>
<p>â€‹ ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸€æ¡é•¿èµ°å»Šï¼Œé•¿èµ°å»Šè¾ƒä¸ºç†æƒ³ã€‚é‚£ä¹ˆå¯¹äºé…å‡†æ¥è¯´ï¼Œé•¿èµ°å»Šæƒ…å†µä¸‹çš„é…å‡†åæ–¹å·®æ²¿ç€èµ°å»Šæ–¹å‘çš„åˆ†é‡æ›´å¤§ï¼Œä½†æ˜¯å‚ç›´èµ°å»Šæ–¹å‘å¾ˆå°ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œodometryåœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šå¯èƒ½éƒ½æœ‰è¾ƒå¤§çš„åæ–¹å·®ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨odometryçš„åæ–¹å·®ï¼Œåœ¨æ›´æ–°é‡‡æ ·ç¯èŠ‚å¯èƒ½ä¼šé‡‡åˆ°æ¬¡ä¼˜çš„ä½ç½®ï¼Œä½†å¦‚æœæ­¤æ—¶ç»“åˆé…å‡†è¯¯å·®ã€é‡Œç¨‹è®¡åæ–¹å·®ï¼Œå¯ä»¥å°†ï¼š</p>
<ul>
<li>å‚ç›´é•¿èµ°å»Šæ–¹å‘çš„åæ–¹å·®é™ä¸‹æ¥ï¼Œæ²¿ç€é•¿èµ°å»Šæ–¹å‘çš„åæ–¹å·®åˆ™å¯ä»¥ç”±odometryä¸»å¯¼ã€‚</li>
</ul>
<p>â€‹ ä»è¿™æ ·çš„åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½çš„ç»“æœã€‚</p>
<p>â€‹ æ­¤å¤–ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚ä¸ºä»€ä¹ˆä½ åœ¨å®ç°PFæ—¶ï¼Œä½¿ç”¨å®Œå…¨éšæœºçš„é‡‡æ ·ç­–ç•¥æ•ˆæœå¹¶ä¸å¥½ï¼Ÿè¿™ç¯‡è®ºæ–‡ä¸­çš„ä¸€ä¸ªè§£é‡Šæˆ‘è§‰å¾—éå¸¸æœ‰é“ç†ï¼š</p>
<blockquote>
<p>However, if the observation likelihood is <strong><u>peaked</u></strong> the number of pose samples <span class="math inline">\(x_j\)</span> that has to be sampled from the motion model is high, since a dense sampling is needed for sufficiently capturing the <strong><u>typically small areas of high likelihood</u></strong>. This results in a similar problem than using the motion model as the proposal: a high number of samples is needed to s<strong><u>ufficiently cover the meaningful region of the distribution</u></strong>.</p>
</blockquote>
<p>â€‹ ä¹‹å‰ä¹Ÿæ²¡æœ‰æƒ³å¾—å¤ªæ·±ï¼Œåªæ˜¯è§‰å¾—è§’åº¦ä¸Šçš„é‡‡æ ·ä¸è¶³ï¼Œäºæ˜¯å¢å¤§äº†è§’åº¦é‡‡æ ·ã€‚ç°åœ¨æƒ³æƒ³ï¼Œæ•´ä¸ªåéªŒåˆ†å¸ƒç¡®å®å°±æ˜¯ä¸€ä¸ªå…·æœ‰çªå‡ºå³°å€¼çš„åˆ†å¸ƒï¼Œåœ¨å®éªŒè¿‡ç¨‹ä¸­ä¹Ÿå‘ç°äº†è¿™ä¸€ç‚¹ï¼ˆå®éªŒæ˜¯<a href="https://enigmatisms.github.io/2021/10/15/CUDA%E8%B8%A9%E5%9D%91%E5%AE%9E%E5%BD%95%E3%80%902%E3%80%91/">ä¸Šä¸€ç¯‡åšå®¢</a>ä¸­çš„ç²’å­æ»¤æ³¢ï¼Œæ›´æ–°è¿‡ç¨‹ä¸­å‘ç°ï¼Œæ”¶æ•›æ—¶çš„ç²’å­åˆ†å¸ƒçš„ç¡®å‘ˆå°–å³°å½¢çŠ¶ï¼‰ã€‚</p>
<h3 id="å¦‚ä½•ç»“åˆè§‚æµ‹">2.2 å¦‚ä½•ç»“åˆè§‚æµ‹</h3>
<p>â€‹ PFæ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}
w_t=w_{t-1}\frac{
\eta p(z_t|x_{1:t}, z_{1:t-1})p(x_t|x_{t-1},u_{t-1})
}{
\pi(x_t|x_{1:t-1},z_{1:t},u_{1:t-1})
}
\end{equation}
\]</span> â€‹ æœ´ç´ æƒ…å†µä¸‹ï¼Œå»ºè®®åˆ†å¸ƒå°±æ˜¯è¿åŠ¨çŠ¶æ€è½¬ç§»åˆ†å¸ƒï¼š<span class="math inline">\(p(x_t|x_{t-1},u_{t-1})\)</span>ï¼Œæˆ‘ä»¬å°†å…¶æ›¿æ¢ï¼šè€ƒè™‘åˆ°é…å‡†ä¿¡æ¯ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆgmappingä½¿ç”¨äº†ä¸€ä¸ªè¿™æ ·çš„ç­–ç•¥ï¼š</p>
<ul>
<li>é¦–å…ˆæˆ‘æ ¹æ®scan-matcherç¡®å®šä¸€ä¸ªROMï¼ˆregion of meaningï¼Œæœ‰æ„ä¹‰çš„åŒºåŸŸï¼‰ï¼Œä¹Ÿå³æ˜¯é…å‡†è®¤ä¸ºå¯èƒ½çš„åˆ†å¸ƒä½ç½®</li>
<li>åœ¨è¿™ä¸ªæœ‰æ„ä¹‰çš„åŒºåŸŸå†…è¿›è¡Œ<strong><u>å¤šæ¬¡é‡‡æ ·</u></strong>ã€‚å¤šæ¬¡é‡‡æ ·çš„ç»“æœï¼Œä½¿ç”¨scan-matcherå¾—åˆ°<span class="math inline">\(p(x_t|x_{1:t},z_{1:t-1})\)</span>ï¼ˆä¼¼ç„¶ï¼‰ï¼Œè€Œç”±äºæ§åˆ¶å·²çŸ¥ï¼ˆå‡å€¼å·²çŸ¥ï¼‰ï¼Œå‚æ•°ä¸€èˆ¬ä¹Ÿå·²çŸ¥ï¼Œé‚£ä¹ˆåˆ†å¸ƒå°±å·²çŸ¥ï¼Œåˆ™åœ¨é€‰å–çš„ç‚¹å¯ä»¥è®¡ç®—<span class="math inline">\(p(x_t^{(j)}|x_{t-1},u_{t-1})\)</span></li>
<li>æˆ‘ä»¬éœ€è¦è®¡ç®—çš„improved proposalæ˜¯ï¼š<span class="math inline">\(p(x_t|m^{(i)}_{t-1},x_{t-1},z_t,u_{t-1})\)</span>ã€‚è¿™ä¸ªçš„ç‰©ç†æ„ä¹‰æ˜¯ï¼šåœ¨ç¬¬iä¸ªç²’å­å¯¹åº”çš„map <span class="math inline">\(m^{(i)}_{t-1}\)</span>ä¸‹ï¼Œç”±<span class="math inline">\(x_{t-1}\)</span>ç”±æ§åˆ¶é‡<span class="math inline">\(u_{t-1}\)</span>è½¬ç§»ï¼Œè§‚æµ‹åˆ°<span class="math inline">\(z_t\)</span>çš„æ¡ä»¶ä¸‹ï¼Œåœ¨<span class="math inline">\(x_t\)</span>ä½ç½®çš„æ¦‚ç‡ã€‚çœ‹èµ·æ¥è¿™ä¸ªéå¸¸åƒåéªŒï¼Œä½†æ˜¯å…¶è®¡ç®—æ˜¯è¿‘ä¼¼çš„ã€‚</li>
</ul>
<p>â€‹ ä½†æ˜¯å®é™…ä¸Šï¼Œåœ¨RBPFä¸­ï¼Œæ›´æ–°å…¬å¼æœ‰æ‰€ä¸åŒã€‚å› ä¸ºRBPFæ˜¯ä¸“é—¨é’ˆå¯¹SLAMè®¾è®¡çš„ä¸€ç§ç²’å­æ»¤æ³¢ï¼Œåœ¨æ»¤æ³¢è¿‡ç¨‹ä¸­ï¼Œå„ç§æ¦‚ç‡åˆ†å¸ƒéœ€è¦åŒ…å«åœ°å›¾ä¿¡æ¯ã€‚é’ˆå¯¹RBPFçš„æƒé‡æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{rbpf}
w_t=w_{t-1}\frac{
\eta p(z_t|x_{t}, m_{t-1})p(x_t|x_{t-1},u_{t-1})
}{
p(x_t|x_{t-1},z_t,u_{t-1},m_{t-1})
}
\end{equation}
\]</span> â€‹ ä¸Šå¼çš„åˆ†æ¯å¯ä»¥ä½¿ç”¨è´å¶æ–¯ç†è®ºå±•å¼€ï¼š <span class="math display">\[
\begin{align}
&amp;p(x_t|x_{t-1},z_t,u_{t-1},m_{t-1})=\frac{p(z_t|x_t,x_{t-1},u_{t-1},m_{t-1})p(x_t,x_{t-1},u_{t-1},m_{t-1})}
{p(z_t,x_{t-1},u_{t-1},m_{t-1})}\\
&amp;p(x_t,x_{t-1},u_{t-1},m_{t-1})=p(x_t|u_{t-1},m_{t-1},x_{t-1})p(u_{t-1},m_{t-1},x_{t-1})=p(u_{t-1},m_{t-1},x_{t-1})p(x_t|x_{t-1},u_{t-1})\tag{æ¡ä»¶ç‹¬ç«‹æ€§-1}\\
&amp;p(z_t|x_t,x_{t-1},u_{t-1},m_{t-1})=p(z_t|x_{t},m_{t-1})\tag{æ¡ä»¶ç‹¬ç«‹æ€§-2}
\end{align}
\]</span> â€‹ æ•…ï¼Œåˆ†æ¯å¯ä»¥å±•å¼€æˆä¸ºï¼š <span class="math display">\[
\begin{equation}
\frac{p(z_t|x_t,m_{t-1})p(x_t|x_{t-1},u_{t-1})}
{p(z_t|x_{t-1},u_{t-1},m_{t-1})}
\end{equation}
\]</span> â€‹ å¸¦å…¥å…¬å¼<span class="math inline">\(\eqref{rbpf}\)</span>ä¸­å¯ä»¥å¾—åˆ°<span class="math inline">\(w_t=w_{t-1}p(z_t|x_{t-1},u_{t-1},m_{t-1})\)</span>ã€‚åˆ™è¿›ä¸€æ­¥å¯ä»¥å†™ä¸ºï¼ˆåˆ«çœ‹å…¬å¼å¾ˆé•¿ï¼Œå…¶å®å®Œå…¨å°±æ˜¯è´å¶æ–¯ï¼Œâ€œå¾ˆå¥½â€æ¨çš„ï¼ï¼‰ï¼š <span class="math display">\[
\begin{align}
&amp;p(z_t|x_{t-1},u_{t-1},m_{t-1})=\int p(z_t,x&#39;|x_{t-1},m_{t-1},u_{t-1})dx&#39;=\\
&amp;\int \frac {p(x&#39;,z_t,x_{t-1},m_{t-1},u_{t-1})}{p(x&#39;|x_{t-1},m_{t-1},u_{t-1})p(x_{t-1},u_{t-1},m_{t-1})}p(x&#39;|x_{t-1},m_{t-1},u_{t-1})dx&#39;=\\
&amp;\int p(z_t|m_{t-1},x&#39;,x_{t-1},u_{t-1})p(x&#39;|x_{t-1},m_{t-1},u_{t-1})dx&#39;\stackrel{\text{ç‹¬ç«‹æ€§}}{\longrightarrow}\\
&amp;\int p(z_t|x&#39;,m_{t-1})p(x&#39;|x_{t-1},u_{t-1})dx&#39;\propto\\
&amp;\sum_{j=1}^Kp(z_t|m_{t-1}^{(i)},x_j)p(x_j|x_{t-1}^{(i)},u_{t-1})\label{approx}
\end{align}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{approx}\)</span>å°†æœ€åçš„è½¬æ¢å®Œæˆäº†ï¼Œè¿™ä¸ªå…¬å¼ä½¿å¾—æˆ‘ä»¬ä¸å¿…è®¡ç®—å¤æ‚çš„æ¡ä»¶æ¦‚ç‡ï¼Œè€Œå¯ä»¥ä½¿ç”¨ï¼šæœºå™¨äººè¿åŠ¨å­¦æ¨¡å‹åˆ†å¸ƒä¸è§‚æµ‹æ¨¡å‹åˆ†å¸ƒçš„åŠ æƒç»„åˆï¼Œæ›´æ–°æ¯ä¸€ä¸ªç²’å­ï¼ˆ<strong><u>è¿ç”¨å¥½ç‹¬ç«‹æ€§å‡è®¾ä»¥åŠè¾¹ç¼˜åŒ–ï¼Œå¯ä»¥æ¨å‡ºå¾ˆå¤šæœ‰æ„æ€çš„å…¬å¼</u></strong>ï¼‰ã€‚</p>
<p>â€‹ è®ºæ–‡ä¸­çš„æ›´æ–°è¿­ä»£ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>æ ¹æ®é‡Œç¨‹è®¡ä¿¡æ¯ï¼Œä½œä¸ºåˆå€¼ï¼Œè¿›è¡Œé…å‡†ï¼Œå¾—åˆ°å¸¦æœ‰è§‚æµ‹ä¿¡æ¯çš„<span class="math inline">\(u_{t-1}^*\)</span></li>
<li><span class="math inline">\(x_{t-1}+u_{t-1}^*\)</span>å‘¨å›´ï¼ˆä¸€ä¸ªçƒå†…ï¼‰é‡‡æ ·ï¼Œæ¯ä¸ªé‡‡æ ·ç‚¹<span class="math inline">\(x_s\)</span>éƒ½å¯ä»¥æ ¹æ®é‡Œç¨‹è®¡çš„é«˜æ–¯åˆ†å¸ƒä»¥åŠé…å‡†çš„ä¼¼ç„¶åŸŸè®¡ç®—ç‚¹æƒï¼ˆ<span class="math inline">\(p(z|x)p(x|x&#39;,u)\)</span>ï¼‰ï¼Œæ³¨æ„ï¼Œæ‰€æœ‰ç‚¹çš„ç‚¹æƒä¹‹å’Œï¼Œå°±æ˜¯æ›´æ–°å…¬å¼çš„<span class="math inline">\(p(z_t|x_{t-1},u_{t-1},m_{t-1})\)</span>ã€‚</li>
<li>æ ¹æ®é‡‡æ ·çš„ç‚¹å¯ä»¥è®¡ç®—é«˜æ–¯åˆ†å¸ƒï¼Œæœ€åå¾—åˆ°çš„ç²’å­ä»è¿™ä¸ªé«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ã€‚</li>
</ul>
<div class="note danger"><p>â€‹ éå¸¸å¥‡æ€ªçš„æ˜¯ï¼Œ<strong><u>ç½‘ä¸Šæ‰€æœ‰GMappingçš„å®ç°</u></strong>ï¼Œéƒ½æ²¡æœ‰å®ç°å¤šç‚¹é‡‡æ ·ç”Ÿæˆé«˜æ–¯åˆ†å¸ƒå†è¿›è¡Œé‡æ–°é‡‡æ ·çš„æ­¥éª¤ã€‚</p>
</div>
<hr>
<h2 id="iii.-gmapping-ä»£ç æµç¨‹">III. GMapping ä»£ç æµç¨‹</h2>
<h3 id="processscan">3.1 processScan</h3>
<p>â€‹ processScanæ˜¯æ ¸å¿ƒå‡½æ•°ï¼š</p>
<h5 id="è¿åŠ¨æ¨¡å‹">3.1.1 è¿åŠ¨æ¨¡å‹</h5>
<p>â€‹ é¦–å…ˆä»è¿åŠ¨æ¨¡å‹ä¸­é‡‡æ ·ï¼ˆ<code>drawFromMotion</code>å‡½æ•°ï¼Œæ­¤å‡½æ•°çš„åŸç†åœ¨ã€Šæ¦‚ç‡æœºå™¨äººä¸Šã€‹ï¼‰</p>
<h5 id="è®¡ç®—ç§»åŠ¨è·ç¦»">3.1.2 è®¡ç®—ç§»åŠ¨è·ç¦»</h5>
<p>â€‹ è®¡ç®—ç§»åŠ¨è·ç¦»ï¼š<code>m_linearDistance</code>, <code>m_angularDistance</code></p>
<ul>
<li>ä¿è¯å¹³ç§»è·ç¦»ä¸è¿‡å¤§ï¼Œè¿‡å¤§åˆ™è®¤ä¸ºä½ç½®å‘ç”Ÿäº†çªå˜</li>
<li>å½“ç§»åŠ¨è·ç¦»è¿‡å¤§ï¼Œæˆ–æ˜¯é•¿æ—¶é—´æ²¡æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œä¸€æ¬¡é…å‡†</li>
</ul>
<h5 id="scanmatch">3.1.3 scanMatch</h5>
<p>â€‹ scanMatché¦–å…ˆæ ¹æ®plainReadingï¼ˆä¹Ÿå°±æ˜¯ç‚¹äº‘åŸå§‹æ•°æ®ï¼‰è¿›è¡Œé…å‡†ï¼Œé…å‡†ä½¿ç”¨æœç´¢ç®—æ³•ï¼Œåœ¨<code>optimize</code>å‡½æ•°ä¸­ã€‚æ³¨æ„ä»£ç é‡Œæœ‰bugï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (bestScore&gt;=currentScore)</span><br></pre></td></tr></table></figure>
<p>â€‹ å…­ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§åˆ†æ•°æˆ–è€…è¿­ä»£æ¬¡æ•°ï¼Œæ¯æ¬¡å‡å°æ­¥é•¿</p>
<p>â€‹ scoreçš„è®¡ç®—,åœ¨ä¹‹åçš„å‡½æ•°ä¸­è¯´. é…å‡†å‡½æ•°é’ˆå¯¹äº†æ¯ä¸€ä¸ªç²’å­,æ¯ä¸ªç²’å­éƒ½è¿›è¡Œäº†ä¸€æ¬¡ä¼˜åŒ–</p>
<p>â€‹ <code>likelihoodAndAScore</code>å‡½æ•° è¿›è¡Œä¼¼ç„¶è®¡ç®—ï¼šå¤§æ¦‚åšäº†è¿™æ ·çš„äº‹æƒ…ï¼š</p>
<ul>
<li>skipæ˜¯è·³è¿‡å¤„ç†çš„ä¸€ç§å®ç°ï¼ŒæŒ‡çš„æ˜¯ï¼šæ¿€å…‰çº¿å¤ªå¤šï¼Œä¿¡æ¯å†—ä½™ï¼Œå¯ä»¥è·³è¿‡ä¸€ä¸ªæ¿€å…‰çº¿è®¡ç®—ä¼¼ç„¶åŸŸ</li>
<li>é¦–å…ˆæŠŠæ¿€å…‰å™¨çš„ä½å§¿æŠ•å½±åˆ°ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œæ­¤åå¯¹äºæ¯ä¸€æ¡éœ€è¦å¤„ç†çš„æ¿€å…‰çº¿ï¼Œä¹Ÿè½¬åˆ°ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œå¹¶ä¸”ç¡®å®šä¸€ä¸ªä½äºç©ºåŸŸçš„ç‚¹ä½ç½®ï¼ˆæ¿€å…‰çº¿æˆªçŸ­ä¸€æˆªï¼‰</li>
<li>åœ¨ä¸€ä¸ªé¢†åŸŸå†…ï¼ŒæŸ¥æ‰¾æœ€é€‚åˆçš„éšœç¢ç‰©ç‚¹ï¼ˆå› ä¸ºæ¿€å…‰æµ‹è·ä¼šå­˜åœ¨å™ªå£°ï¼‰ï¼Œéšœç¢ç‰©ç‚¹éœ€è¦æ»¡è¶³ï¼šè¯¥ç‚¹å ç”¨æ¦‚ç‡å¤§äºé˜ˆå€¼ï¼Œå¯¹åº”ç©ºåŸŸç‚¹å ç”¨æ¦‚ç‡å°äºé˜ˆå€¼</li>
<li>æ±‚å‡å€¼ï¼Œå¹¶æ±‚æ¿€å…‰ç‚¹ä¸–ç•Œåæ ‡ä½ç½®ä¸è¯¥å‡å€¼çš„è·ç¦»ï¼ˆè¶Šå°è¯´æ˜è¶Šåº”è¯¥æ˜¯è¿™ä¸ªéšœç¢ç‚¹ï¼‰</li>
<li>æ±‚ä¼¼ç„¶ã€‚è¿™æ ·æ±‚å‡ºçš„ä¼¼ç„¶åŸŸæ˜¯è¾ƒä¸ºå¹³æ»‘çš„ï¼Œæ•…åœ¨scanMatchçš„optimizeä¸­ï¼Œè®¡ç®—scoreä¹Ÿæ˜¯ç”¨äº†ç±»ä¼¼çš„å¹³æ»‘å‡½æ•°</li>
</ul>
<p>â€‹ <code>computeActiveArea</code>ï¼šæ˜¯ä¸€ä¸ªæ›´æ–°åœ°å›¾æ“ä½œï¼Œå› ä¸ºåœ°å›¾æ˜¯åŸºäºå ç”¨æ …æ ¼çš„ï¼ŒæœªçŸ¥åŒºåŸŸä¹Ÿæ˜¯éœ€è¦è¡¨å¾çš„ï¼Œé™åˆ¶èŒƒå›´å¯ä»¥èŠ‚çº¦å†…å­˜èµ„æºã€‚computeActiveAreaæ›´æ–°äº†åœ°å›¾å¤§å°ï¼ˆæ¯ä¸ªç²’å­ï¼‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//this allocates the unallocated cells in the active area of the map</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; &quot;activeArea::size() &quot; &lt;&lt; activeArea.size() &lt;&lt; endl;</span></span><br><span class="line">map.<span class="built_in">storage</span>().<span class="built_in">setActiveArea</span>(activeArea, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>â€‹ åœ¨æ­¤å‰ï¼Œå…ˆæ ¹æ®scanMatchè®¡ç®—çš„ä½å§¿ï¼Œè®¡ç®—äº†å ç”¨æ …æ ¼ï¼ˆæ¯æ¡æ¿€å…‰çº¿ç»è¿‡çš„æ¯ä¸ªç‚¹ï¼‰ï¼Œå°†å ç”¨æ …æ ¼åŠ å…¥åˆ°mapä¸­ï¼Œç­‰å¾…å¯¹åœ°å›¾è¿›è¡Œæ›´æ–°ã€‚</p>
<h3 id="updatetreeweights">3.2 updateTreeWeights</h3>
<p>â€‹ updateTreeWeightsåªåšäº†ä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>å½’ä¸€åŒ–æƒé‡</li>
<li>è½¨è¿¹æ ‘é‡ç½®</li>
<li>æƒé‡æ²¿ç€æ ‘ä¼ æ’­</li>
</ul>
<p>â€‹ è½¨è¿¹æ ‘ä¼šä¸ä¼šåšçš„æ˜¯è¿™æ ·ä¸€ä»¶äº‹æƒ…å‘¢ï¼Ÿåˆå§‹æ—¶ç²’å­éƒ½åœ¨åŒä¸€ä½ç½®ï¼Œåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯èƒ½å‡ºç°ä¸¤ä¸ªç²’å­ä½å§¿ä¸€è‡´çš„æƒ…å†µå—ï¼Ÿä¼šæœ‰ä¸€ä¸ªparentå¯¹åº”äº†å¾ˆå¤šchildçš„æƒ…å†µå—ï¼Œè½¨è¿¹æ ‘çš„childä¼šæ€ä¹ˆæ¥ï¼Ÿ</p>
<p>â€‹ propagateWeightså°±æ˜¯ä¸€å±‚ä¸€å±‚å°†å¶å­èŠ‚ç‚¹çš„weightå‘ä¸Šä¼ æ’­ï¼ˆå› ä¸ºåœ¨scanMatchä¸­ä¼šé‡æ–°è¡¡é‡å¶å­èŠ‚ç‚¹çš„weightï¼Œè€Œä¸Šå±‚weightï¼ˆç›¸å½“äºä¹‹å‰çš„ä½å§¿ï¼‰æ˜¯é€å±‚ç´¯åŠ çš„ï¼‰ã€‚</p>
<p>â€‹ ä½†æ˜¯resampleè®¡ç®—ä½¿ç”¨çš„æ˜¯å½“å‰å¶å­èŠ‚ç‚¹çš„æƒé‡ï¼Œä¸ä¸Šå±‚çš„æƒé‡æ— å…³ã€‚é‚£ä¹ˆè¿™æ ·é€å±‚ç´¯åŠ çš„weightï¼Œå…¶ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<code>weightSum</code>åœ¨å¦ä¸€ä¸ªç±»ä¸­è¢«ä½¿ç”¨äº†ã€‚çœ‹ä»£ç æ—¶æ²¡æœ‰æ³¨æ„ç»§æ‰¿å…³ç³»ï¼Œä»¥ä¸ºåªæœ‰<code>GridSlamProcessor</code>æ˜¯ä¸»è¦æ¨¡å—ï¼Œæœ€åå‘ç°openslamç‰ˆæœ¬ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç±»å«åšï¼š<code>GridSlamProcessorThread</code>ï¼Œå†…éƒ¨å®ç°äº†ä¸€äº›çˆ¶ç±»æ²¡æœ‰å®ç°çš„å›è°ƒå‡½æ•°ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰çš„<code>onScanmatchUpdate</code>å‡½æ•°ä¸­ï¼Œç”¨åˆ°äº†weightSumï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(part-&gt;weightSum&gt;bestWeight)&#123;</span><br><span class="line">    bestIdx=idx;</span><br><span class="line">    bestWeight=part-&gt;weightSum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ç®—æ³•é€‰æ‹©æƒé‡ç»¼åˆæœ€å¤§çš„ä¸€ä¸ªç²’å­ï¼ˆæ•…ä¸å†å²ä¿¡æ¯ç›¸å…³äº†ï¼‰ï¼Œå–è¯¥ç²’å­å¯¹åº”çš„mapä½œä¸ºå½“å‰åœ°å›¾ï¼Œæ ¹æ®æœ€å¤§æƒé‡çš„ç²’å­æ›´æ–°åœ°å›¾ï¼Œå¹¶ä¸”é€‰æ‹©æœ€ä¼˜ç²’å­çš„ä½å§¿å½“ä½œè‡ªèº«å½“å‰ä½å§¿ã€‚</p>
<p>â€‹ ä¸è¿‡æ ¹æ®ç®—æ³•çš„é€»è¾‘ï¼Œæ¯æ¬¡è®¡ç®—äº†åº•å±‚å¶å­èŠ‚ç‚¹çš„weightä¹‹åï¼Œä¸Šå±‚éœ€è¦æ ¹æ®åº•å±‚æ¥çš„å€¼ä¿®æ”¹æƒé‡ç´¯åŠ ï¼Œä½†æ˜¯éå¶å­èŠ‚ç‚¹çš„weightSumå¹¶æ²¡æœ‰ç”¨ï¼ˆweightSumæœ¬èº«å°±æ²¡æœ‰è¢«ç”¨è¿‡å¤šå°‘æ¬¡ï¼‰ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹ï¼ˆå½“å‰æœ€æ–°çš„particlesï¼‰å¯¹åº”çš„weightSumæ‰æœ‰ä»·å€¼ï¼Œæ•…propagateWeightsä»¥åŠç›¸åº”å‡½æ•°å…¶å®æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚</p>
<h3 id="é‡é‡‡æ ·">3.3 é‡é‡‡æ ·</h3>
<p>â€‹ resmapleIndexeså‡½æ•°ï¼šè¿™é‡Œçš„é‡é‡‡æ ·ç­–ç•¥ä½¿ç”¨çš„ä¹Ÿæ˜¯ã€Šæ¦‚ç‡æœºå™¨äººã€‹ä¸Šçš„ä½æ–¹å·®é‡é‡‡æ ·ã€‚æ•…å¯èƒ½å‡ºç°ï¼šä¸¤ä¸ªç²’å­é‡å¤çš„æƒ…å†µã€‚è¿”å›çš„æ˜¯è¢«é‡‡æ ·åˆ°çš„ç²’å­çš„ä¸‹æ ‡ã€‚åœ¨è¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ï¼Œç”±äºä½¿ç”¨çš„ç­–ç•¥æ˜¯ä½æ–¹å·®é‡‡æ ·ï¼Œä¸‹æ ‡æ˜¯æœ‰é¡ºåºçš„ï¼Œæ•…é‡‡æ ·çš„ç»“æœä¹Ÿæ˜¯æœ‰é¡ºåºçš„ã€‚ â€‹ è€Œ<code>new TNode</code>åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å‡ºç°åœ¨ï¼š</p>
<ul>
<li><code>gridslamprocessor_tree.cpp</code> çš„<code>integrateScanSequence</code>ä¸­ï¼Œæ²¡æœ‰å®é™…è°ƒç”¨</li>
<li><code>gridslamprocessor_tree.cpp</code> çš„ <code>getTrajectory</code>ä¸­ï¼Œåœ¨GSPæ„é€ æ—¶ä½¿ç”¨ï¼Œæ‰€ä»¥å¯¹ä»£ç é€»è¾‘çš„å½±å“åº”è¯¥ä¸å¤§</li>
<li><code>gridslamprocessor.hxx</code> çš„<code>resample</code>å‡½æ•°ä¸­ç”¨åˆ°è¿‡ï¼Œæ­¤å¤„çš„ä½¿ç”¨å¯¹ä»£ç é€»è¾‘æœ‰å®é™…çš„å½±å“</li>
</ul>
<p>â€‹ å»ºç«‹ä»¥åŠæ›´æ–°æƒé‡è½¨è¿¹æ ‘çš„æµç¨‹ä¸ä½œç”¨ï¼š</p>
<ul>
<li>æ ¹æ®æƒé‡è¿›è¡Œä½æ–¹å·®é‡‡æ ·ï¼Œç»“æœè¢«ä¿å­˜åœ¨<code>m_indexes</code>ä¹‹ä¸­ï¼Œæ³¨æ„<code>m_indexes</code>æ˜¯é¡ºåºåŒ–çš„ï¼Œæ¯”å¦‚ï¼šåŸæ¥æœ‰8ä¸ªç²’å­ï¼Œidä»0-7ï¼Œé‡é‡‡æ ·ä¹‹åæˆä¸ºï¼š1 1 1 4 4 4 7 7ï¼Œé‚£ä¹ˆåœ¨è½¨è¿¹æ ‘ä¸­ï¼Œ0ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ6å‡ä¼šè¢«åˆ é™¤ï¼ˆå‡è®¾æ²¡æœ‰å…¶ä»–å…³è”ï¼Œæ•´æ¡ä¸è¿™å‡ ä¸ªèŠ‚ç‚¹æœ‰å…³çš„æ ‘æå‡ä¼šè¢«åˆ‡é™¤ï¼‰</li>
<li>è½¨è¿¹æ ‘å®é™…ä¸Šå°±æ˜¯é‡é‡‡æ ·æ ‘ï¼Œ0 1 2 3 4 5 6 7 è¿™8ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‰ç…§ä¸Šé¢çš„é‡é‡‡æ ·ä¾‹å­ä¼šç”Ÿæˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ ‘ï¼š</li>
</ul>
<pre class="mermaid">
graph TD

A(root)
A1(0)
A2(1)
A3(2)
A4(3)
A5(4)
A6(5)
A7(6)
A8(7)
B(1-1)
C(1-2)
D(1-3)
E(4-1)
F(4-2)
G(4-3)
H(7-1)
I(7-2)
A---A1
A---A2
A---A3
A---A4
A---A5
A---A6
A---A7
A---A8
A2---B
A2---C
A2---D
A5---E
A5---F
A5---G
A8---H
A8---I

</pre>
<center>
Figure 2. GMappingæƒé‡æ ‘ç»“æ„ç¤ºä¾‹
</center>
<p>â€‹ é‡é‡‡æ ·å¾—åˆ°ç‚¹å°±ç›¸å½“äºå­èŠ‚ç‚¹ï¼Œé‡é‡‡æ ·å‰çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹ã€‚</p>
<ul>
<li>åˆ é™¤æ‰€æœ‰é‡é‡‡æ ·åæ²¡æœ‰ç»“æœçš„ç‚¹ï¼Œæ¯”å¦‚å‡è®¾ä¸Šè¿°ä¾‹å­åˆå‘ç”Ÿäº†ä¸€æ¬¡é‡é‡‡æ ·ï¼Œ(7-1)(7-2)æƒé‡è¿‡å°ï¼Œé‚£ä¹ˆ(7-1)(7-2)(7)éƒ½ä¼šè¢«åˆ é™¤</li>
<li>å¯¹é‡é‡‡æ ·åçš„æ–°particlesï¼Œæ ¹æ®å½“å‰çš„ç‚¹äº‘ä¿¡æ¯ï¼Œæ›´æ–°åœ°å›¾ï¼ˆactiveAreaé‡æ–°è®¡ç®—ï¼‰ï¼Œä½†æ˜¯æƒé‡ä¼šè¢«é‡ç½®ä¸º0ã€‚é‚£ä¹ˆè¿™ä¸ªä¸º0çš„æƒé‡ï¼Œå°†ä¼šåœ¨scanMatchå‡½æ•°ä¸­è¢«ä¿®æ”¹ï¼ˆè®¡ç®—å®Œlikelihoodä¹‹åï¼Œæƒé‡ä¼šè¢«è®¾ç½®ä¸ºlikelihoodï¼‰ï¼Œå¹¶ä¸”åœ¨weightSumä¸­ä¹Ÿç´¯åŠ ä¸€ä»½ã€‚</li>
</ul>
<hr>
<h2 id="iv.-æµç¨‹æ€»ç»“">IV. æµç¨‹æ€»ç»“</h2>
<p>â€‹ æˆ‘å·²ç»å‘ç°äº†ï¼šopenslamçš„ä»£ç åˆè‡­åˆé•¿ï¼Œè¿˜ä¸èƒ½ç¼–è¯‘ï¼Œä»¤äººæ ¹æœ¬ä¸çŸ¥é“processScanè¿™ä¸ªå‡½æ•°ç©¶ç«Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼Œè²Œä¼¼å› ä¸ºä¸‹è½½çš„æ˜¯æœ€åŸå§‹çš„ç‰ˆæœ¬ã€‚</p>
<div class="note danger no-icon"><p>â€‹ addScanå‡½æ•°ï¼ˆè²Œä¼¼æ˜¯ROSå°è£…ï¼‰ï¼Œåœ¨è½¬æ¢scanä¿¡æ¯ä¹‹åï¼Œè°ƒç”¨processScanå‡½æ•°ã€‚æ­¤å‡½æ•°é¦–å…ˆä»motion modelä¸­é‡‡æ ·ï¼Œæ­¤ååˆ¤å®šæ˜¯å¦éœ€è¦è¿›è¡Œé…å‡†ã€‚</p>
</div>
<div class="note warning no-icon"><p>â€‹ å¦‚æœéœ€è¦é…å‡†ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯è¶…æ—¶æˆ–è€…è¶…å‡ºè·ç¦»é˜ˆå€¼ï¼Œåˆ™éœ€è¦è°ƒç”¨scanMatchå‡½æ•°ï¼Œæ­¤å‡½æ•°å†…éƒ¨ä½¿ç”¨è¢«ç§°ä¹‹ä¸ºã€çˆ¬å±±æ³•ã€‘çš„æœç´¢æ–¹æ³•è¿›è¡ŒåŒ¹é…ï¼Œå¾—åˆ°ä¿®æ­£åçš„ä½å§¿ï¼ˆ<strong><u>ä½†æ˜¯è²Œä¼¼æ²¡æœ‰å®ç°GMappingä¸­çš„ç”Ÿæˆé«˜æ–¯åˆ†å¸ƒ</u></strong>ï¼‰ã€‚</p>
</div>
<div class="note info no-icon"><p>â€‹ æ­¤åéœ€è¦è®¡ç®—ä¼¼ç„¶ï¼Œä½¿ç”¨ä¼¼ç„¶åŸŸæ³•ï¼Œåœ¨é¢†åŸŸå†…æœç‚¹è·å¾—ä¸€ä¸ªå¹³æ»‘ä¼¼ç„¶ã€‚è®¡ç®—å¾—åˆ°çš„ä¼¼ç„¶ä½œä¸ºæ–°çš„æƒé‡ï¼Œå¹¶ä¸”å°†æ­¤æƒé‡ç´¯åŠ åˆ°weightSumä¸Šå»ã€‚</p>
</div>
<div class="note success no-icon"><p>â€‹ è®¡ç®—åœ°å›¾æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯é‡æ–°è®¡ç®—activeAreaï¼Œéœ€è¦å‘æ …æ ¼å›¾åŸå§‹æ•°æ®ï¼ˆPointAccumulatorï¼‰çš„å®¹å™¨ä¸­å¢åŠ æ–°çš„æ …æ ¼ï¼ˆæˆ–è€…å¯¹åŸæœ‰æ …æ ¼è¿›è¡Œè®¿é—®ï¼‰ã€‚</p>
</div>
<div class="note primary no-icon"><p>â€‹ é‡é‡‡æ ·æ­¥éª¤ï¼Œé‡é‡‡æ ·çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹è½¨è¿¹æ ‘è¿›è¡Œé‡å»ºã€‚æ–¹æ³•åœ¨ä¸Šæ–‡å·²ç»é˜è¿°è¿‡äº†ï¼Œæ³¨æ„propagateWeightsæ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„æ“ä½œï¼Œæˆ‘ç›´æ¥å¿½ç•¥äº†ã€‚</p>
</div>
<hr>
<h2 id="v.-æ•ˆæœ">V. æ•ˆæœ</h2>
<p>â€‹ 2007å•Šï¼ä»–ä»¬å¤ªå¼ºäº†ã€‚ä¸è¿‡ä¹Ÿä¸èƒ½è¯´å®Œç¾ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>5cm grid ç²¾åº¦å¯ä»¥é€‚åº”å¤§å¤šæ•°çš„éœ€æ±‚ï¼Œæ‰€ä»¥2D SLAMæ–¹å‘åšçš„äººè¶Šæ¥è¶Šå°‘äº†ï¼ˆåŸºæœ¬æ»¡è¶³éœ€æ±‚äº†ï¼‰ï¼Œè€Œæˆ‘å°è¯•ä½¿ç”¨æ›´é«˜ç²¾åº¦gridçš„æ—¶å€™ï¼ˆæ¯”å¦‚2.5cmï¼‰ï¼Œé…å‡†å°†å‘ç”Ÿé”™è¯¯ï¼ˆæˆ‘çŒœæ˜¯gridå¤ªå°äº†ï¼Œå¯¼è‡´äº†æ¿€å…‰å™¨æ¨¡å‹çš„ç¨€ç–æ€§é—®é¢˜ï¼‰</li>
<li>åŒæ—¶ï¼Œgridå˜å°å°†ä¼šå ç”¨è¿‡å¤šçš„å†…å­˜ï¼ˆ1cmå¤§å°çš„æ ¼å­è·‘Intelæ•°æ®é›†è²Œä¼¼å¯ä»¥è·‘åˆ°10GBå†…å­˜å ç”¨ï¼ŒçœŸçš„æ— æ³•æƒ³è±¡å½“å¹´ä»–ä»¬é‚£ä¸ªæ¡ä»¶æ€ä¹ˆåšå®éªŒçš„ï¼‰</li>
<li>ä¸¢å¸§å°†ä¼šå¯¼è‡´éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œå½“ç‚¹äº‘é¢‘ç‡å¾ˆé«˜çš„æ—¶å€™ï¼Œä¸¢å¸§å°†ç›´æ¥å¯¼è‡´é…é£ï¼ˆå¾ˆå¥‡æ€ªï¼Œé‡Œç¨‹è®¡ä¸æ˜¯ç”¨ä¸Šäº†å—ï¼Ÿï¼‰</li>
<li><strong><u>è²Œä¼¼æ²¡æœ‰å®ç°2007å¹´è®ºæ–‡çš„improved proposalæ€æƒ³</u></strong>ã€‚</li>
</ul>
<p>â€‹ ä»¥ä¸‹æµ‹è¯•çš„åœ°å›¾å‡ä¸º5cmå¤§å°gridï¼Œintelæ•°æ®åŒ…ç”±äºç‚¹äº‘å¸§ç‡ä½ï¼Œæˆ‘çš„i5ä¸Šå¯ä»¥å¼€8å€é€Ÿæ’­æ”¾åŒ…ï¼Œè€Œæˆ‘è‡ªå·±åšçš„ä»¿çœŸæ•°æ®é›†åªèƒ½2å€é€Ÿï¼ˆå¦åˆ™ä¸¢å¸§ç›´æ¥æ­»æ‰ï¼‰ï¼Œç²’å­ä¸ªæ•°å‡ä¸º15ä¸ªï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯é»˜è®¤å‚æ•°ã€‚</p>
<p><img src="/2021/10/22/%E7%89%B9%E9%BE%99%E6%99%BA%E6%85%A7-GMapping/Screenshot%20from%202021-10-22%2017-55-33.png"></p>
<center>
Figure 3. Intel å®éªŒå®¤æ•°æ®é›†
</center>
<p><img src="/2021/10/22/%E7%89%B9%E9%BE%99%E6%99%BA%E6%85%A7-GMapping/Screenshot%20from%202021-10-22%2017-57-36.png"></p>
<center>
Figure 4. hqyä»¿çœŸæ•°æ®é›†ã€1ã€‘
</center>
<p><img src="/2021/10/22/%E7%89%B9%E9%BE%99%E6%99%BA%E6%85%A7-GMapping/Screenshot%20from%202021-10-22%2017-59-28.png"></p>
<center>
Figure 5. hqyä»¿çœŸæ•°æ®é›†ã€2ã€‘
</center>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>SLAM</tag>
        <tag>æ¦‚ç‡è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€å•çš„ROSè·¨è®¾å¤‡æ§åˆ¶</title>
    <url>/2022/02/22/%E7%AE%80%E5%8D%95%E7%9A%84ROS%E8%B7%A8%E8%AE%BE%E5%A4%87%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<h1 id="rrrros">RRRROS</h1>
<hr>
<p>â€‹ ROSå¸¸ç”¨çš„è¿›ç¨‹é€šä¿¡æœºåˆ¶æ˜¯æ¶ˆæ¯ä¼ é€’ï¼Œæ˜¯åŸºäºå„ä¸ªnodeä¸masterçš„XML-RPCå®ç°ï¼Œå¹¶ä¸”å¯èƒ½ç”¨åˆ°TCP/UDPç­‰ä¼ è¾“å±‚åè®®ï¼Œéå¸¸åœ°ç½‘ç»œã€‚è¿™æ ·çœ‹æ¥ï¼ŒROSè¿›è¡Œè·¨è®¾å¤‡é€šä¿¡åº”è¯¥æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æœ¬ç¯‡ä¸»è¦è®°å½•ä¸€ä¸ªç®€å•çš„ROSè·¨è®¾å¤‡åº”ç”¨åœºæ™¯ï¼Œå¹¶ç®€ä»‹å…¶ä¸­çš„åŸç†ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ä½¿ç”¨rosè·¨è®¾å¤‡rvizå¯è§†åŒ–">ä½¿ç”¨ROSè·¨è®¾å¤‡rvizå¯è§†åŒ–</h2>
<p>â€‹ ä½ æœ‰ä¸€ä¸ªå·¥æ§è®¾å¤‡ï¼Œåœ¨ä¸€ä¸ªè½»é‡çº§æœºå™¨äººä¸Šã€‚æœºå™¨äººæ²¡åŠæ³•ç»™ä½ ä¸¾ç€ä¸€ä¸ªå±å¹•ï¼Œæ–¹ä¾¿ä½ æ§åˆ¶ä»–çš„æ–¹å¼åªæœ‰sshã€‚è¿™æ—¶å€™ï¼Œä½ æ‰“å¼€äº†æœºå™¨äººèº«ä¸Šçš„ä¸€ä¸ªæ¿€å…‰é›·è¾¾ï¼Œä½†çªç„¶è®°èµ·æ¥ï¼Œè‡ªå·±æ²¡åŠæ³•å¯è§†åŒ–æœºå™¨äººçœ‹åˆ°çš„ä¸œè¥¿ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå½“ç„¶ï¼Œä½ å¤§å¯ä»¥åƒæˆ‘ä¸€æ ·æ˜¾å¾—è›‹ç–¼å»å†™ä¸€ä¸ªç”¨ç»ˆç«¯å¯è§†åŒ–ç‚¹äº‘çš„å·¥å…·...ï¼Œå°±åƒè¿™æ · <a href="https://github.com/Enigmatisms/tviz">Github: Enigmatisms/tviz</a>ï¼š</p>
<center>
<img src="/2022/02/22/%E7%AE%80%E5%8D%95%E7%9A%84ROS%E8%B7%A8%E8%AE%BE%E5%A4%87%E6%8E%A7%E5%88%B6/tviz.gif" style="zoom:80%;">
</center>
<center>
Figure 1. é—²å¾—è›‹ç–¼
</center>
<p>â€‹ åæ­£å†™å®Œæˆ‘ä¹Ÿæ²¡ç”¨è¿‡ï¼Œè¿˜æ˜¯ä¸Šæ­£ç»æ–¹æ³•å§ã€‚é¦–å…ˆï¼Œå¦‚æœè¦è·¨è®¾å¤‡ä½¿ç”¨ROSï¼Œä¸¤ä¸ªè®¾å¤‡å¿…é¡»èƒ½å¤Ÿäº’ç›¸è®¿é—®ï¼Œæ¯”å¦‚ï¼šåœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹ã€‚å¯èƒ½å‡ºç°å•å‘èƒ½pingé€šçš„æƒ…å†µï¼ˆæ¯”å¦‚å¢™ï¼Œæˆ–è€…æ— å†…ç½‘ç©¿é€ï¼‰ã€‚äº’ç›¸å¯ä»¥pingé€šåº”è¯¥å°±æ²¡æœ‰é—®é¢˜ã€‚</p>
<p>â€‹ ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘è®¾å®šå¦‚ä¸‹çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ä¸»æœºAï¼Œæ˜¯ç”¨äºå¯è§†åŒ–çš„è®¾å¤‡ï¼Œè¿è¡Œrviz</li>
<li>ä»æœºBï¼Œæ˜¯æœºå™¨äººï¼ˆæˆ–è€…ç›¸åº”å·¥æ§è®¾å¤‡ï¼‰ï¼Œç›´æ¥è¿æ¥äº†ä¼ æ„Ÿå™¨ä½†æ˜¯ä¸æ–¹ä¾¿æ˜¾ç¤º</li>
</ul>
<p>â€‹ é¦–å…ˆï¼Œåœ¨ä¸»æœºAä¸Šsshåˆ°ä»æœºBã€‚å¹¶ä¸”ä¿®æ”¹ä»æœº<code>/etc/hosts</code>ï¼Œé¦–å…ˆæŸ¥çœ‹Aï¼ŒBè®¾å¤‡çš„ipï¼Œè®¾ä¸ºaï¼Œbï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure>
<p>â€‹ ç»™ä¸»æœºä»¥åŠä»æœºå‘½åï¼ˆéšä¾¿å«ï¼‰ï¼Œæ¯”å¦‚æˆ‘å«ä¸»æœº masterï¼Œä»æœºslaveï¼Œ<code>/etc/hosts</code>ä¸­å°±å¡«å†™å¹¶ä¿å­˜ï¼Œç›¸åº”åœ°ï¼Œä¸»æœºçš„<code>/etc/hosts</code>ä¹Ÿè¿™ä¹ˆä¿®æ”¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.xx.a master</span><br><span class="line">192.168.xx.b slave</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¿®æ”¹å®Œä¹‹åï¼Œä»æœºéœ€è¦ä¿®æ”¹ROSå®šä¹‰çš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export ROS_HOSTNAME=slave</span><br><span class="line">export ROS_MASTER_URI=http://msater:11311</span><br></pre></td></tr></table></figure>
<p>â€‹ æ³¨æ„ï¼Œä»æœºçš„host nameè¿˜æ˜¯è‡ªå·±çš„nameï¼Œä½†æ˜¯master URIåˆ™æ˜¯ï¼š<strong><u>ä¸»æœºip + ç«¯å£ï¼ˆä¸€èˆ¬éƒ½æ˜¯11311ï¼‰</u></strong>ã€‚è¿™é‡Œå®é™…ä¸Šæ˜¯ï¼šROSçš„masterä»¥åŠnodeéƒ½çœ‹ipè¿›è¡Œé€šä¿¡ï¼Œåªæœ‰ä¸€ä¸ªå”¯ä¸€çš„masterï¼ˆç¡®å®å¯ä»¥å¼€å¤šä¸ªroscoreï¼Œä½†æ˜¯æ¶ˆæ¯ä¸æ˜¯å…±äº«çš„ï¼‰ï¼Œmaster URIå°±ç¡®å®šäº†masteræ‰€åœ¨çš„ç½‘ç»œä½ç½®ã€‚å¦‚æœä¸exportä¿®æ”¹ROS Master URIï¼Œä¸€èˆ¬æ¥è¯´:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $ROS_MASTER_URI			# è¾“å‡ºéƒ½æ˜¯ http://localhost:11311</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¿®æ”¹ROS master URIå°±æ˜¯å‘Šè¯‰æœ¬æœºï¼Œmasterï¼ˆroscoreï¼‰åœ¨ä½äºmaster URIçš„æœºå™¨ä¸Šã€‚</p>
<p>â€‹ å·²ç»è¯´äº†ï¼ŒæŒ‰ç…§åŒæ ·çš„æ–¹æ³•ä¿®æ”¹ä¸»æœº<code>/etc/hosts</code>ï¼Œä¹‹åéœ€è¦ä¿®æ”¹ä¸»æœºç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export ROS_HOSTNAME=master</span><br><span class="line">export ROS_MASTER_URI=http://master:11311</span><br></pre></td></tr></table></figure>
<p>â€‹ <strong><u>æ³¨æ„è¿™é‡Œï¼Œmaster URI</u></strong>å°±æ˜¯ä¸»æœºè‡ªå·±çš„ipã€‚ä¹‹åï¼Œä¸»æœºå¼€<code>roscore &amp;</code>ï¼ˆä¸€å®šè¦åœ¨ä¸»æœºä¸Šå¼€ï¼Œå› ä¸ºè¿™æ˜¯è®¾å®šå˜›ï¼Œmaster URIéƒ½è¯´äº†roscoreåœ¨è¿™é‡Œï¼‰ï¼Œå†æ‰“å¼€rvizï¼Œé…ç½®å¥½ã€‚ä»æœºåªéœ€è¦èƒ½å¤Ÿè¾“å‡ºrosæ¶ˆæ¯å³å¯ï¼Œåœ¨ä¸»æœºä¸Šç”¨<code>rostopic list</code>å°±èƒ½çœ‹åˆ°æ¶ˆæ¯äº†ã€‚</p>
<ul>
<li>P.Sï¼š2Dæ¿€å…‰é›·è¾¾æ•°æ®ä¼ è¾“å®Œå…¨æ²¡é—®é¢˜ï¼Œå°±ç®—æ˜¯å¸§ç‡é«˜ï¼Œç‚¹æ•°å¤šï¼Œä¹Ÿä¸ä¼šæœ‰å¤ªå¤§å»¶è¿Ÿï¼Œä½†æ˜¯å›¾åƒæ¶ˆæ¯å°±ä¸ä¸€æ ·äº†ã€‚<strong><u>å¦‚æœéœ€è¦è·¨è®¾å¤‡å›¾ä¼ </u></strong>ï¼Œä¸è¦ä½¿ç”¨åŸå§‹çš„<code>sensor_msgs/Image</code>æ¶ˆæ¯ï¼Œä¼šéå¸¸æ…¢ï¼Œpptçº§ä¼ è¾“ã€‚å¯ä»¥ä½¿ç”¨<code>sensor_msgs/CompressedImage</code>ï¼Œäº²æµ‹å¾ˆå¿«ã€‚ä½†æ˜¯è¿™å–å†³äºä½ æƒ³çœ‹æµç•…é«˜åˆ·è¿˜æ˜¯é«˜æ¸…æ— ç ï¼Œä¸è¿‡ä¸ªäººè§‰å¾—ï¼Œcompressed imageæ¶ˆæ¯å¹¶æ²¡æœ‰ä½¿å¾—ç”»é¢è´¨é‡æœ‰å¤ªå¤šçš„ä¸‹é™ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>ROS</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿æ€§/æ ‘å‹åˆ†ç±»å™¨çš„çº¯ç†è®ºåˆ†æ</title>
    <url>/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h1 id="çº¯ç†è®ºåˆ†æ">çº¯ç†è®ºåˆ†æ</h1>
<hr>
<h2 id="preface">Preface</h2>
<p>â€‹ å‘¨å¿—åè€å¸ˆçš„ã€Šæœºå™¨å­¦ä¹ ã€‹çœ‹åˆ°äº†ç¬¬äº”ç« ï¼Œå¯æ€»æ„Ÿè§‰çœ‹å¾—å¤ªå¿«äº†ï¼ˆå¯æƒœèµ·æ­¥å¤ªæ™šäº†ï¼Œå¤§ä¸‰ä¸‹æ‰ç³»ç»Ÿåœ°å­¦MLï¼‰ã€‚ä¸ªäººè®¤ä¸ºèµ°é©¬è§‚èŠ±åœ°çœ‹å®Œå…¨æ²¡æœ‰ç”¨å¤„ï¼Œæœ€å¥½æ˜¯èƒ½è‡ªå·±å°†æ‰€æœ‰ç¢°åˆ°çš„è½®å­éƒ½å†™ä¸€éï¼ˆç†æƒ³æƒ…å†µï¼‰ï¼Œä½†äººçš„ç²¾åŠ›æ¯•ç«Ÿæœ‰é™ï¼Œå¼€å­¦äº†æ—¶é—´ä¹Ÿæ¯”è¾ƒç´§å¼ ï¼Œå®ç°è¿™ä¸€æ­¥å°±å…ˆè·³è¿‡å§ï¼Œè€Œç»†è‡´çš„ç†è®ºåˆ†æä¸ç†è§£æ˜¯å®Œå…¨å¿…è¦çš„ã€‚LDAä¹‹å‰å®ç°è¿‡<a href="https://github.com/Enigmatisms/Algorithms-Plus/blob/master/py/LDA/lda_learn.py">Github Algorithm-PlusğŸ”—</a>ï¼Œå†³ç­–æ ‘å€’æ˜¯è¿ç†è®ºéƒ½æ²¡æ€ä¹ˆç»†çœ‹ï¼Œåªè°ƒè¿‡åº“ã€‚ä¸ºäº†ä¸å½“è°ƒåº“ä¾ ï¼Œæœ‰å†™è½®å­çš„èƒ½åŠ›ï¼Œä¸ªäººå°†å¯¹è¿™ä¸¤ç« è¿›è¡Œä¸€ä¸‹æ¢³ç†ï¼Œå†™ä¸€ä¸‹è‡ªå·±çš„ç†è§£ã€‚</p>
<p><img src="/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/melon.jpg"></p>
<center>
Figure 1. è¥¿ç“œ
</center>
<p>â€‹ LDAï¼ˆæ¶ˆæ­§ä¹‰ï¼šLinear Discriminant Analysisï¼Œä¸æ˜¯Latent Dirichlet Allocationï¼‰å’Œå†³ç­–æ ‘éƒ½æ˜¯ä¸¤ä¸ªéå¸¸ç®€å•ä½†æ˜¯åˆå¾ˆä¼˜é›…çš„åˆ†ç±»å™¨ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ldaçš„æ•°å­¦æ¨å¯¼">LDAçš„æ•°å­¦æ¨å¯¼</h2>
<p>â€‹ <blockquote class="blockquote-center">
<p>åŒç±»æ ·æœ¬çš„ç±»å†…æ–¹å·®æœ€å°ï¼Œè€Œä¸åŒç±»æ ·æœ¬çš„ç±»é—´æ–¹å·®æœ€å¤§</p>

</blockquote></p>
<p>â€‹ LDAæ˜¯ç»™å®šæ ‡ç­¾ä¸‹çš„æœ‰ç›‘ç£é™ç»´æ–¹å¼ï¼Œå¸Œæœ›æ‰¾åˆ°æ›´ä½ç»´åº¦ä¸Šçš„æŠ•å½±ï¼Œå¯ä»¥æ»¡è¶³ä¸Šè¿°å±æ€§ã€‚è€Œå¯¹äºé«˜ç»´è€Œè¨€ï¼Œåæ–¹å·®æ˜¯æè¿°æ ·æœ¬å…³ç³»çš„æŒ‡æ ‡ã€‚åæ–¹å·®çš„å®šä¹‰å¦‚ä¸‹ï¼ˆå¤§äºŒä¸‹å­¦çš„ï¼Œå›å¿†ä¸€ä¸‹ï¼‰ï¼šæè¿°nç»´éšæœºå˜é‡<span class="math inline">\(X=(X_1,X_2,...X_n)\)</span>æ¯ä¸ªåˆ†é‡ä¹‹é—´å­˜åœ¨çš„å…³ç³»ï¼Œåæ–¹å·®å¯ä»¥å®šä¹‰ä¸ºï¼š <span class="math display">\[
\begin{equation}
C = \begin{pmatrix}
c_{11} &amp; c_{12} &amp; ... &amp; c_{1n} \\
c_{11} &amp; c_{12} &amp; ... &amp; c_{1n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
c_{n1} &amp; c_{n2} &amp; ... &amp; c_{nn} \\
\end{pmatrix}
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(c_{ij}\)</span>æ˜¯ä¸¤ä¸ªåˆ†é‡<span class="math inline">\(X_i,X_j\)</span>çš„åæ–¹å·®<span class="math inline">\(Cov(X_i, X_j) = E[(X_i-E_i)(X_j-E_j)]\)</span>ã€‚åæ–¹å·®å­˜åœ¨ä¸€äº›æ€§è´¨ï¼Œæ¯”å¦‚è¯´ï¼š <span class="math display">\[
\text{let }Cov(X)=\Sigma\\
Cov(AX+b)=A\Sigma A^T
\]</span> â€‹ è¯æ˜å°±çœç•¥äº†ï¼Œæ ¹æ®æœŸæœ›çš„æ€§è´¨ï¼Œæ¨å¯¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<h3 id="äºŒåˆ†ç±»">äºŒåˆ†ç±»</h3>
<p>â€‹ å‡è®¾æœ‰ä¸¤ç±»æ ·æœ¬ï¼Œ<span class="math inline">\(D_1\)</span>ä»¥åŠ<span class="math inline">\(D_2\)</span>ï¼Œ<span class="math inline">\(D_1\)</span>çš„æ ·æœ¬ä¸­å¿ƒï¼ˆæ ¹æ®çŸ©æ³•å¯ä»¥æ±‚å‡ºæ¥ï¼‰ä¸º<span class="math inline">\(\mu_1\)</span>ï¼Œå¯¹åº”åœ°<span class="math inline">\(D_2\)</span>æœ‰<span class="math inline">\(\mu_2\)</span>ï¼Œé‚£ä¹ˆå‡è®¾å­˜åœ¨ä¸€ä¸ªä½ç»´è¿‡åŸç‚¹çš„è¶…å¹³é¢ï¼ˆç”±äºæ˜¯å¹³è¡ŒæŠ•å½±ï¼Œæ˜¯å¦è¿‡åŸç‚¹ä¸å½±å“ç»“æœï¼Œä½†åŸç‚¹è¾ƒå¥½è®¨è®ºï¼‰ï¼Œè¿™ä¸ªè¶…å¹³é¢æ–¹ç¨‹ä¸ºï¼š<span class="math inline">\(w^Tx=0\)</span>ï¼Œé‚£ä¹ˆæŠ•å½±åœ¨è¿™ä¸ªè¶…å¹³é¢ä¸Šçš„æ•°æ®ç‚¹åº”è¯¥æœ‰ä»€ä¹ˆå½¢å¼ï¼Ÿä¸­å¿ƒç‚¹åº”è¯¥æœ‰ä»€ä¹ˆå½¢å¼ï¼Ÿåæ–¹å·®æ˜¯å¦æ”¹å˜ï¼Ÿ<span class="math inline">\(w^Tx=0\)</span>ç¡®å®æ˜¯é™äº†1ç»´ï¼ˆå› ä¸ºæœ‰ä¸€ä¸ªçº¦æŸæ–¹ç¨‹ï¼‰ï¼Œä½†å¦‚ä½•ä½¿ç”¨<span class="math inline">\(w\)</span>è¿›è¡ŒæŠ•å½±ï¼Ÿ</p>
<p>â€‹ å®é™…ä¸Šï¼Œæ¯ä¸ªæ ·æœ¬ç‚¹<span class="math inline">\(x_i\)</span>éƒ½åœ¨ï¼š<span class="math inline">\(w^Tx+b_i=0\)</span> è¿™ä¸ªè¶…å¹³é¢ä¸Šï¼Œå»æ‰è¿™ä¸ªç›¸å¯¹åŸç‚¹çš„åç§»ï¼Œå°±å¯ä»¥å¾—åˆ°æ¯ä¸€ä¸ªæ ·æœ¬ç‚¹åœ¨ä½ç»´ä¸Šçš„æŠ•å½±ã€‚å®é™…æ˜¯è¿™æ ·æ“ä½œçš„ï¼šè®¾<span class="math inline">\(x_i\)</span>æ˜¯è¶…å¹³é¢<span class="math inline">\(w^Tx = 0\)</span>å¤–ä¸€ç‚¹ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼Œ<span class="math inline">\(x_i\)</span>å¯ä»¥è¡¨ç¤ºä¸ºè¶…å¹³é¢ä¸Šçš„æŠ•å½±ç‚¹<span class="math inline">\(x_i&#39;\)</span>ä¸æ³•å‘é‡<span class="math inline">\(w\)</span>çš„åŠ æƒç»„åˆï¼ˆå› ä¸ºå·²ç»æ„æˆåŸºäº†ï¼‰ï¼Œæ¯”å¦‚ï¼š <span class="math display">\[
\begin{equation}
x_i=x_i&#39;+\lambda_iw
\end{equation}
\]</span> â€‹ é‚£ä¹ˆ<span class="math inline">\(\lambda_i\)</span>æ˜¾ç„¶å°±æ˜¯<span class="math inline">\(x_i\)</span>åœ¨å•ä½æ³•å‘é‡<span class="math inline">\(w_e\)</span>ä¸Šçš„æŠ•å½±ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼š <span class="math display">\[
x_i&#39;=x_i-\frac{w^Tx_iw}{\Vert w\Vert^2}
\]</span> â€‹ ä½†è¿™æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿæ ·æœ¬ä¸­å¿ƒé—´çš„è·ç¦»åˆæ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥æ±‚å‡ºæ ·æœ¬ä¸­å¿ƒåº”è¯¥åœ¨ï¼š <span class="math display">\[
\begin{equation}\label{proj}
x_c&#39;=\frac 1N\sum_{i=1}^N\left(x_i-\frac{w^Tx_iw}{\Vert w\Vert^2}\right)
\end{equation}
\]</span> â€‹ æ˜¾ç„¶å…¬å¼<span class="math inline">\(\eqref{proj}\)</span>æ˜¯å¯ä»¥è¿›è¡ŒåŒ–ç®€çš„ï¼Œå¯¹äºå†…ç§¯éƒ¨åˆ†ï¼ˆååŠéƒ¨åˆ†ï¼‰ï¼Œéœ€è¦å°†å†…ç§¯å±•å¼€ä¸ºç´¯åŠ ï¼Œè¿›è¡Œç´¯åŠ æ¬¡åºäº¤æ¢ï¼š <span class="math display">\[
\begin{array}{l}
\frac 1N\sum_{i=1}^N\frac{w^Tx_iw}{\Vert w\Vert^2}=
\frac 1{N{\Vert w\Vert^2}}\sum_{i=1}^N \left(\sum_{j=1}^nw_jx_{ij} \right)w\\
=\frac 1{\Vert w\Vert^2}\sum_{j=1}^n\frac 1n\sum_{i=1}^N w_jx_{ij}w\\
=\frac w{\Vert w\Vert^2}\sum_{j=1}^nw_j\mu_i
=\frac{w^T\mu w}{\Vert w\Vert^2}
\end{array}
\]</span> â€‹ å‰åŠéƒ¨åˆ†çš„åŒ–ç®€ååˆ†ç®€å•ã€‚é‚£ä¹ˆæŠ•å½±åçš„ä¸¤ä¸ªé›†åˆä¸­å¿ƒçš„å·®å‘é‡åº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{diff}
\pmb{d}=\mu_1-\mu_2-\frac{w^T(\mu_1-\mu_2)w}{\Vert w\Vert^2}
\end{equation}
\]</span> â€‹ å®é™…ä¸Šï¼ŒFisherçš„å¤„ç†æ–¹æ³•ä¸æˆ‘çš„å¤„ç†æ–¹æ³•å®Œå…¨ä¸åŒï¼Œæˆ‘æ˜¯çœŸçš„æ±‚äº†ä¸€ä¸ªè¿™æ ·çš„æŠ•å½±ï¼Œä½†ä¸ç®¡æ˜¯Fisherè¿˜æ˜¯è¥¿ç“œä¹¦ä¸Šçš„æ¨å¯¼ï¼Œå‡å€¼å…¨éƒ¨éƒ½æ˜¯ï¼š<span class="math inline">\(w^T\mu\)</span>ï¼Œè¿™è®©æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå‡å€¼çš„ç»´åº¦ä¸å°±æ˜¯1äº†å—ï¼Ÿä½†å®é™…ä¸Šç»´åº¦åªåº”è¯¥å‡1å•Šï¼Ÿä»¥ä¸Šéƒ½æ˜¯æˆ‘çœ‹äº†ç¬¬ä¸€éƒ¨åˆ†äº§ç”Ÿçš„æƒ³æ³•ï¼Œä½†å®é™…ä¸ŠäºŒåˆ†ç±»LDAå¹¶ä¸æ˜¯æŠ•å½±åˆ°n-1ç»´ç©ºé—´ä¸­ï¼ˆç‰¹å¾åˆ†é‡æ•°ä¸ºnï¼‰ï¼ŒäºŒåˆ†ç±»çš„LDAç›´æ¥æŠ•å½±åˆ°ä¸€ç»´ç©ºé—´ä¸Šã€‚äºŒåˆ†ç±»åªéœ€è¦åœ¨ä¸€æ¡ç›´çº¿ä¸Šæ‰¾åˆ°æ•°æ®çš„æŠ•å½±å³å¯ï¼Œåœ¨è¿™æ¡ç›´çº¿ä¸Šåˆ¤å®šæŠ•å½±åçš„æ–°æ•°æ®ç¦»å“ªä¸€ç±»æ•°æ®ä¸­å¿ƒæœ€è¿‘ã€‚</p>
<p>â€‹ ç”±äºè¿™æ˜¯ä¸€ä¸‹ä»nç»´é™åˆ°1ç»´ï¼Œæ‰€ä»¥å‡ ä½•ç›´è§‚ä¸Šå¹¶ä¸å¥½ç†è§£ã€‚ä¸ªäººè§‰å¾—è¿™æ ·çš„é™ç»´è·¨åº¦å¤ªå¤§äº†ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦æŠ•å½±åˆ°ä¸€æ¡ç›´çº¿ä¸Š">ä¸ºä»€ä¹ˆè¦æŠ•å½±åˆ°ä¸€æ¡ç›´çº¿ä¸Šï¼Ÿ</h4>
<p>â€‹ ç”±äºäºŒåˆ†ç±»è¾“å‡ºçš„æŒ‡ç¤ºç»“æœä¸º <span class="math inline">\(p_1,p_2,\text{ where } p_1+p_2=1\)</span>ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ†ä¸ºä¸¤ä¸ªç±»ï¼Œè½åœ¨ä¸¤ä¸ªç±»å†…çš„æ¦‚ç‡æ»¡è¶³ä¸€ä¸ªå½’ä¸€çº¦æŸï¼Œé‚£ä¹ˆè¾“å‡ºå°±ç›¸å½“æ˜¯åœ¨ä¸€æ¡ç›´çº¿ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒLDAè®¤ä¸ºï¼š<strong><u>è¾“å‡ºåœ¨ä¸åŒç±»ä¸Šçš„æ¦‚ç‡å®é™…ä¸Šæ˜¯æ‰€æœ‰è¾“å…¥ç‰¹å¾ç»è¿‡<span class="math inline">\(w\)</span>æ˜ å°„çš„çº¿æ€§ç»„åˆ</u></strong>ï¼ŒäºŒåˆ†ç±»é—®é¢˜åªéœ€è¦å¾—åˆ°ç›´çº¿ä¸Šçš„ä¸€ä¸ªå€¼ï¼Œå°±èƒ½æ ¹æ®å½’ä¸€çº¦æŸæ±‚å‡ºåˆ†å±äºä¸¤ä¸ªç±»çš„æ¦‚ç‡ã€‚é‚£ä¹ˆï¼š</p>
<ul>
<li>ä¸‰åˆ†ç±»é—®é¢˜åªéœ€è¦æ±‚å¾—åœ¨äºŒç»´ç©ºé—´ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œå°±èƒ½æ±‚å‡ºä¸€ä¸ªæ ·æœ¬åˆ†å±äºä¸‰ä¸ªç±»çš„æ¦‚ç‡ã€‚ä¹Ÿå³çº¿æ€§ç»„åˆè¾“å‡ºäº†ä¸€ä¸ªäºŒç»´çš„ç‚¹</li>
<li>å››åˆ†ç±»é—®é¢˜åªéœ€æ±‚å‡ºä¸‰ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œå°±èƒ½æ±‚å‡ºä¸€ä¸ªæ ·æœ¬åˆ†å±äºå››ä¸ªç±»çš„æ¦‚ç‡...</li>
<li>Måˆ†ç±»é—®é¢˜åªéœ€è¦æ±‚å‡ºM-1ä¸ºç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œå°±èƒ½æ±‚å‡ºä¸€ä¸ªæ ·æœ¬åˆ†å±äºMä¸ªç±»çš„æ¦‚ç‡ã€‚</li>
</ul>
<p>â€‹ è¦æ³¨æ„ç‰¹å¾ç©ºé—´ï¼ˆnç»´ï¼‰å’Œæ¦‚ç‡ç©ºé—´ï¼ˆMç»´ï¼‰çš„ä¸åŒã€‚LDAå®é™…ä¸Šå°±æ˜¯åœ¨æ­£æ€åˆ†å¸ƒä»¥åŠåŒæ–¹å·®çš„å‡è®¾ä¸‹ï¼Œè®¤ä¸ºåªè¦çº¿æ€§ç»„åˆnä¸ªç‰¹å¾ï¼Œå°±èƒ½æ±‚å‡ºMç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªæ¦‚ç‡è§£ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸€å¼€å§‹çš„ç†è§£æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜çš„å…³é”®å°±åœ¨äºï¼šè¾“å‡ºåˆ†ç±»çš„æ¦‚ç‡æ˜¯è¾“å…¥ç‰¹å¾çš„çº¿æ€§ç»„åˆã€‚<strong><u>ä¸èƒ½ç®€å•åœ°æƒ³ç€æŠ•å½±ï¼Œè€Œè¦æƒ³ä¸ºä»€ä¹ˆè¦è¿™æ ·æŠ•å½±ï¼Œè¿™æ ·æŠ•å½±å¦‚ä½•å¸®åŠ©æ±‚å¾—åˆ†ç±»æ¦‚ç‡ã€‚</u></strong></p>
<p>â€‹ é‚£ä¹ˆæ•°å­¦ä¸Šå°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼šç»™å®šä¸€æ¡ç›´çº¿<span class="math inline">\(y=w^Tx\)</span>ï¼Œè¯´æ˜¯è¦æŠ•å½±åˆ°ç›´çº¿ä¸Šï¼Œå®é™…ä¸Šè¦åšçš„æ˜¯æ ¹æ®<span class="math inline">\(w\)</span>å¯¹æ ·æœ¬çš„ä¸åŒå±æ€§è¿›è¡Œçº¿æ€§ç»„åˆï¼š<span class="math inline">\(w^Tx\)</span>ã€‚é‚£ä¹ˆä¹Ÿå°±æœ‰ï¼š <span class="math display">\[
\begin{align}\label{class2}
&amp; \mu_1&#39;=w^T\mu_1 \tag{center of projected class 1} \\
&amp; \mu_2&#39;=w^T\mu_2 \tag{center of projected class 2} \\
&amp; \sigma_1=w^T\Sigma_1 w \tag{projected within-class cov 1}\\
&amp; \sigma_2=w^T\Sigma_2 w \tag{projected within-class cov 2}
\end{align}
\]</span> â€‹ é‚£ä¹ˆæ ¹æ®ç±»å†…æ–¹å·®æœ€å°ï¼Œç±»é—´æ–¹å·®æœ€å¤§çš„æ€æƒ³ï¼š <span class="math display">\[
\begin{equation}\label{obj1}
\text{max } \frac{\Vert {w^T\mu_1 - w^T\mu_2} \Vert^2}{w^T(\Sigma_1+\Sigma_2)w}
\end{equation}
\]</span> â€‹ åˆ†å­å±•å¼€ç»´è½¬ç½®ä¹˜ç§¯ä¹‹åï¼Œå¯ä»¥å®šä¹‰ä¸¤ä¸ªæ•£åº¦çŸ©é˜µï¼š <span class="math display">\[
\begin{align}
&amp; S_b=(\mu_1-\mu_2)(\mu_1-\mu_2)^T &amp; \tag{within-class scatter matrix} \\
&amp; S_w=\Sigma_1+\Sigma_2 &amp; \tag{between scatter matrix}
\end{align}
\]</span> â€‹ ä½¿ç”¨è¿™ä¸¤ä¸ªæ•£åº¦çŸ©é˜µï¼Œå®šä¹‰é—®é¢˜<span class="math inline">\(\eqref{obj1}\)</span>å¸¦æœ‰å¹¿ä¹‰ç‘åˆ©å•†çš„å½¢å¼ã€‚è§£é—®é¢˜<span class="math inline">\(\eqref{obj1}\)</span>å°±å¯ä»¥å¾—åˆ°æœ€ä¼˜çš„<span class="math inline">\(w\)</span>ã€‚ç”±äº<span class="math inline">\(w\)</span>çš„é•¿åº¦æ˜¯ä¸å½±å“ç»“æœçš„ï¼ˆçœ‹çš„å°±æ˜¯æ–¹å‘ï¼‰ï¼Œä¸å¦¨ä»¤åˆ†æ¯ä¸º1ï¼Œæœ€å¤§åŒ–åˆ†å­ï¼Œè¿›ä¸€æ­¥åŒ–ç®€ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{obj2}
\begin{array}{ll}
\text{min } -w^TS_bw \\
\text{s.t. } w^TS_ww=1
\end{array}
\end{equation}
\]</span> â€‹ è¯·Lagrangeååˆ°ä¸»å¸­å°ä¸Šæ¥ã€‚æ ¹æ®å¢åŠ äº†ä¸€é¡¹ä¹˜å­é¡¹çš„ä¼˜åŒ–é—®é¢˜<span class="math inline">\(\eqref{obj2}\)</span>ï¼ŒKKTæ¡ä»¶æ¢¯åº¦ä¸º0ï¼Œå¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{kkt1}
S_bw=\lambda S_ww \rightarrow(\mu_1-\mu_2)=S_ww
\end{equation}
\]</span> â€‹ ç­‰å¼<span class="math inline">\(\eqref{kkt1}\)</span>å¯ä»¥åŒ–ç®€å¾—åŸå› æ˜¯ï¼š<span class="math inline">\(S_b=(\mu_1-\mu_2)(\mu_1-\mu_2)^T\)</span>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(S_bw\)</span>å®é™…æ–¹å‘å°±æ˜¯<span class="math inline">\(\mu_1-\mu_2\)</span>ï¼Œæ ¹æ®<span class="math inline">\(w\)</span>å°ºåº¦ä»»æ„æ€§ï¼Œç›´æ¥ä»¤<span class="math inline">\(S_bw=\lambda(\mu_1-\mu_2)\)</span>çœäº‹ã€‚æ ¹æ®<span class="math inline">\(\eqref{kkt1}\)</span>ï¼Œè¿›è¡ŒSVDåˆ†è§£ï¼ˆæ•°å€¼ä¸Šä¼šæ¯”è¾ƒç¨³å®šï¼‰å°±å¯ä»¥å¾—åˆ°<span class="math inline">\(w\)</span></p>
<h3 id="å¤šåˆ†ç±»">å¤šåˆ†ç±»</h3>
<p>â€‹ ä»ä¸Šè¿°ç†è§£ä¸­å·²ç»å¯ä»¥çŸ¥é“LDAçš„â€œé™ç»´åˆ†ç±»â€æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡åŸç‰¹å¾çš„çº¿æ€§ç»„åˆï¼Œå°†ç‰¹å¾ç©ºé—´ç›´æ¥å˜æ¢åˆ°â€œæ¦‚ç‡ç©ºé—´â€ï¼ˆæˆ–è€…æ˜¯å¯ä»¥è¢«å˜æ¢ä¸ºæ¦‚ç‡çš„ç©ºé—´ï¼‰ã€‚å½“åˆ†ç±»æ•°é‡ä¸ºMæ—¶ï¼Œåªéœ€è¦çŸ¥é“M-1ä¸ªç±»ä¸Šçš„æ¦‚ç‡æˆ–è€…ç­‰ä»·æ¦‚ç‡å€¼å°±å¯ä»¥æ±‚å‡ºæ‰€æœ‰ç±»ä¸Šçš„â€œæ¦‚ç‡è¾“å‡ºâ€å€¼ã€‚</p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼šLDAçš„é™ç»´è¿‡ç¨‹å®é™…ä¸Šæ˜¯ç”±nç»´ç‰¹å¾ç©ºé—´å˜æ¢ä¸ºM-1ç»´åˆ†ç±»ç©ºé—´çš„è¿‡ç¨‹ã€‚å›é¡¾äºŒåˆ†ç±»çš„æƒ…å†µï¼ŒM = 2ï¼Œä¹Ÿå°±æ˜¯å°†æ‰€æœ‰æ ·æœ¬æŠ•å½±åˆ°ä¸€ç»´ï¼ˆç›´çº¿ï¼‰ä¸Šï¼š<span class="math inline">\(y=w^Tx\)</span>ï¼Œç›´çº¿ä¸Šçš„å€¼æ˜¾ç„¶æ˜¯ä¸€ç»´çš„ã€‚è¿™æ˜¯ç”±äºå‚ä¸çº¿æ€§ç»„åˆçš„å‡½æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‡é‡å€¼å‡½æ•°ï¼ˆ<span class="math inline">\(w^Tx\)</span>æ˜ å°„ï¼‰ï¼Œè¦æƒ³è¾“å‡ºé«˜ç»´çš„å‘é‡ï¼Œåªéœ€è¦æ›´æ”¹<span class="math inline">\(w\)</span>ä¸ºä¸€ä¸ªçŸ©é˜µ<span class="math inline">\(W\)</span>å³å¯ã€‚å¯¹äºéœ€è¦ä¼˜åŒ–å¾—åˆ°çš„ç»“æœï¼Œæ¨å¯¼æœ‰äº›ä¸åŒï¼š <span class="math display">\[
\begin{equation}\label{div1}
S_t=\sum_{i=1}^m(x_i-\mu_t)(x_i-\mu_t)^T
\end{equation}
\]</span> â€‹ å®šä¹‰å…¬å¼<span class="math inline">\(\eqref{div1}\)</span>ä¸ºå…¨å±€æ•£åº¦ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªæ ·æœ¬ç‚¹åˆ°æ‰€æœ‰æ ·æœ¬çš„å¹³å‡ç‚¹çš„æ•£åº¦å’Œã€‚ä¸ªäººè®¤ä¸ºï¼Œç”±äºç±»é—´å·®å¼‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¼šå¤§äºç±»å†…å·®å¼‚ï¼Œæ‰€ä»¥<span class="math inline">\(S_t\)</span>ç›¸å½“äºå°±æ˜¯ä¸€ä¸ªç±»é—´æ–¹å·®çš„è¡¨å¾ï¼ˆä¸åŒç±»çš„å‡å€¼ç‚¹åˆ°æ•´ä½“å‡å€¼ç‚¹çš„æ•£åº¦ï¼‰ã€‚ç”±äºä¸åŒäºäºŒåˆ†ç±»é—®é¢˜ï¼Œç±»å†…æ•£åº¦éœ€è¦é‡æ–°å®šä¹‰äº†ã€‚æ˜¾ç„¶ç±»å†…çš„æ•£åº¦å¯ä»¥ç”¨ç±»å†…æ ·æœ¬ä¸æœ¬ç±»å‡å€¼çš„å·®å¼‚æ¥è¡¡é‡ï¼š <span class="math display">\[
\begin{equation}\label{div2}
S_w=\sum_{j=1}^N(x_{ij}-\mu_i)(x_{ij}-\mu_i)^T
\end{equation}
\]</span> â€‹ ä½†æ˜¯è‡³äºä¸ºä»€ä¹ˆè¥¿ç“œä¹¦ä¸Šè¦ä½¿ç”¨<span class="math inline">\(\eqref{div2}-\eqref{div1}\)</span>ä½œä¸ºæœ€åçš„ç±»é—´æ•£åº¦çŸ©é˜µï¼Œæˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ç”šè‡³æˆ‘è§‰å¾—ï¼Œ<span class="math inline">\(\eqref{div2}\)</span>çš„å®šä¹‰æ˜¯å¤šä½™çš„ã€‚ç±»é—´æ•£åº¦å®é™…ä¸Šå¯ä»¥æ ¹æ®ï¼š</p>
<div class="note info"><p>â€‹ ç±»å†…æ•£åº¦é€šå¸¸å°äºç±»é—´æ•£åº¦ï¼Œåœ¨æœ€ä¼˜æŠ•å½±å–å¾—çš„æƒ…å†µä¸‹å°±æ›´æ˜¯è¿™æ ·äº†ã€‚æ‰€ä»¥æ¯ä¸ªæ ·æœ¬ï¼Œåœ¨ç±»é—´æ•£åº¦å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªååˆ†æ¥è¿‘ç±»å†…å‡å€¼çš„ç‚¹ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚é‚£ä¹ˆæ¯ä¸ªæ ·æœ¬ç‚¹éƒ½å¯ä»¥è¿‘ä¼¼åœ°è¢«ç±»å†…å‡å€¼å–ä»£ã€‚</p>
</div>
<p><img src="/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/lda.JPG"></p>
<center>
Figure 2. æ ·æœ¬ä¸å‡å€¼çš„è¿‘ä¼¼æ€§
</center>
<p>â€‹ é‚£ä¹ˆå¾ˆè‡ªç„¶ï¼Œç±»é—´æ•£åº¦å¯ä»¥å®šä¹‰ä¸ºï¼ˆæ¯ä¸ªæ ·æœ¬ï¼ˆè¿‘ä¼¼ï¼‰ä¸å…¨å±€å‡å€¼çš„æ•£åº¦å’Œï¼‰ <span class="math display">\[
\begin{equation}\label{div3}
S_b=\sum_{i=1}^Mm_i(\mu_i-\mu)(\mu_i-\mu)^T
\end{equation}
\]</span> â€‹ ä¼˜åŒ–ç›®æ ‡ä¹Ÿéœ€è¦æ›´æ”¹ï¼Œå› ä¸ºå®é™…çš„è¾“å‡ºå¼å·²ç»å˜æˆäº†å¦‚ä¸‹å¼æ‰€ç¤ºçš„å¤šç»´çº¿æ€§ç»„åˆçŸ©é˜µ<span class="math inline">\(W\)</span>ï¼Œè¾“å‡ºæ˜¯å¤šç»´çš„ï¼Œé‚£ä¹ˆå¯ä»¥ç®€å•åœ°ä½¿ç”¨è¿¹è¿›è¡Œå®ç°ã€‚ <span class="math display">\[
\begin{equation}\label{obj3}
\frac{W^TS_bW}{W^TS_bW}\rightarrow\text{ max }\frac{tr(W^TS_bW)}{tr(W^TS_bW)}
\end{equation}
\]</span> â€‹ å¯¹äºä¸Šå¼ï¼Œç»§ç»­æ ¹æ®æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{solve}
S_bW=\lambda S_wW\rightarrow {S_w}^{-1}S_bW=\lambda W
\end{equation}
\]</span> â€‹ å¯çŸ¥ï¼Œ<span class="math inline">\(W\)</span>æ˜¯ä¸€ä¸ª(n * M-1)ç»´çŸ©é˜µï¼Œè€Œæ˜¾ç„¶<span class="math inline">\(\eqref{solve}\)</span>ä¸­<span class="math inline">\(W\)</span>çš„æ¯ä¸ªåˆ—å‘é‡åˆ†é‡éƒ½æ˜¯çŸ©é˜µ<span class="math inline">\({S_w}^{-1}S_b\)</span>çš„ä¸€ä¸ªç‰¹å¾å‘é‡ï¼ˆç¬¦åˆç‰¹å¾å‘é‡å®šä¹‰ï¼Œå½“ç„¶å¯èƒ½æ˜¯å¹¿ä¹‰ç‰¹å¾å‘é‡ï¼‰ï¼Œé‚£ä¹ˆ<span class="math inline">\(\begin{pmatrix}N-1\\n\end{pmatrix}\)</span>ç§ä¸åŒçš„æƒ…å†µï¼Œç©¶ç«Ÿæ˜¯å“ªN-1ä¸ªç‰¹å¾å‘é‡ç»„åˆæˆäº†æœ€ç»ˆçš„è§£<span class="math inline">\(W\)</span>ï¼Ÿä»å…¬å¼<span class="math inline">\(\eqref{solve}\)</span>ç§å¯ä»¥çœ‹å‡ºï¼Œ<span class="math inline">\(\lambda\)</span>è¶Šå¤§è¶Šå¥½ï¼ˆå¯¹åº”æœ€å¤§åŒ–<span class="math inline">\(\eqref{obj3}\)</span>ï¼‰ã€‚é‚£ä¹ˆåªéœ€è¦é€‰æ‹©<span class="math inline">\({S_w}^{-1}S_b\)</span>æœ€å¤§çš„N-1ä¸ªç‰¹å¾å€¼ï¼ˆæˆ–è€…å¹¿ä¹‰ç‰¹å¾å€¼ï¼‰çš„ç‰¹å¾å‘é‡ç»„æˆè§£å³å¯ã€‚</p>
<hr>
<h2 id="æ ‘å‹---å†³ç­–æ ‘">æ ‘å‹ - å†³ç­–æ ‘</h2>
<blockquote class="blockquote-center">
<p>æ ‘è¶Šæ˜¯å‘å¾€é«˜å¤„çš„å…‰äº®,å®ƒçš„æ ¹å°±è¶Šè¦å‘ä¸‹,å‘æ³¥åœŸ,å‘é»‘æš—çš„æ·±å¤„ã€‚â€”å°¼é‡‡</p>

</blockquote>
<p>â€‹ emmmã€‚è¿™å¥è¯åªå› ä¸ºæœ‰ä¸ªâ€œæ ‘â€å­—å°±è¢«æˆ‘æ‹¿å‡ºæ¥é•‡ä¸€é•‡æ–‡ç« äº†ã€‚å†³ç­–æ ‘ï¼Œåˆ©ç”¨ä¸€ä¸ªä¸ªä¸ç›¸äº’å½±å“çš„ç‰¹å¾ï¼ˆæˆ–è€…æˆ‘ä»¬è®¤ä¸ºå½±å“ä¸å¤ªå¤§çš„ç‰¹å¾ï¼Œå®é™…ä¸Šæœ‰å½±å“ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡æŸäº›æ“ä½œè¿›è¡Œè½¬åŒ–çš„ï¼‰è¿›è¡Œå±‚å±‚åˆ†ç±»ã€‚æ­£å¦‚çŒœç‰©æ¸¸æˆï¼Œæ¯æ¬¡åªèƒ½é—®ä¸€ä¸ªç­”æ¡ˆåªæœ‰â€œæ˜¯â€å’Œâ€œå¦â€çš„é—®é¢˜ï¼Œé€šè¿‡ç­”æ¡ˆäº§ç”Ÿçš„åˆ†æ”¯è¿›è¡Œæ¨æµ‹ã€‚é€šè¿‡å¯¹å¾…åˆ†ç±»æ ·æœ¬çš„å±‚å±‚åˆ†è§£å¯ä»¥è·å¾—æœ€ç»ˆçš„åˆ†ç±»æ¨æµ‹ã€‚æœ¬èŠ‚åªè®¨è®ºå…¶ç›¸å…³çš„æ•°å­¦åŸç†ï¼Œå¯¹äºå…·ä½“çš„ç”Ÿæˆ / å‰ªæç®—æ³•å°†ä¸ä¼šæ¶‰åŠï¼ˆå› ä¸ºè¿™æ²¡æœ‰å¸å¼•åˆ°æˆ‘ï¼‰ã€‚</p>
<h3 id="ä¿¡æ¯è®ºç›¸å…³">ä¿¡æ¯è®ºç›¸å…³</h3>
<p>â€‹ å›é¡¾ä¸€ä¸‹ä¿¡æ¯ç†µçš„ä¸¤ä¸ªå®šä¹‰ï¼š <span class="math display">\[
\begin{equation}\label{ent}
Ent(x)=-\sum_{i=1}^np_ilog(p_i)\text{ or }Ent(x)=-\int p(x)log(p(x))dx
\end{equation}
\]</span> â€‹ å·¦è¾¹ä¸ºå¸¸è§çš„ç¦»æ•£å‹éšæœºå˜é‡ç†µçš„å®šä¹‰ï¼Œè€Œå³è¾¹åˆ™ä¸ºè¿ç»­å˜é‡åœ¨å…¶PDFæ„ä¹‰ä¸‹çš„ç†µã€‚åœ¨è®²KLæ•£åº¦çš„æ—¶å€™å·²ç»è¯´è¿‡äº†ï¼Œç†µæ˜¯ç”¨äºè¡¡é‡ä¿¡æ¯ç¼–ç çš„ä¸€ä¸ªæ¦‚å¿µã€‚ä¸€ä¸ªéšæœºäº‹ä»¶çš„ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œä»£è¡¨ä¿¡æ¯é‡è¶Šå¤§ï¼Œç¼–ç è¿™ä¸ªäº‹ä»¶æ‰€éœ€è¦çš„äºŒè¿›åˆ¶ä½æ•°ä¹Ÿç›¸åº”è¶Šå¤§ã€‚</p>
<p>â€‹ åœ¨å†³ç­–æ ‘ä¸€ç« ä¸­ï¼Œã€Šè¥¿ç“œä¹¦ã€‹æåˆ°ï¼š</p>
<blockquote class="blockquote-center">
<p>"ä¿¡æ¯ç†µ" (information entropy) æ˜¯åº¦é‡æ ·æœ¬é›†åˆçº¯åº¦æœ€å¸¸ç”¨çš„ä¸€ç§æŒ‡æ ‡ã€‚</p>

</blockquote>
<p>â€‹ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿé›†åˆæ ·æœ¬çº¯åº¦åˆæ˜¯æŒ‡ä»€ä¹ˆï¼Ÿçº¯åº¦åœ¨æ­¤å¤„æŒ‡ï¼šåŒä¸€ä¸ªåˆ’åˆ†ä¸­ï¼Œç”±äºåˆ’åˆ†é›†åˆå†…çš„å…ƒç´ éƒ½å­˜åœ¨ç›¸åº”çš„labelï¼Œå¦‚æœé›†åˆå†…çš„labelè¶Šè¶‹äºä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆçš„çº¯åº¦ä¹Ÿå°±è¶Šé«˜ã€‚å¦‚æœç”¨æ¯”ä¾‹<span class="math inline">\(p_k\)</span>è¡¨ç¤ºåˆ’åˆ†é›†åˆä¸­ï¼Œç¬¬kç±»æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆçš„ä¿¡æ¯ç†µï¼ˆçº¯åº¦ï¼‰è¡¨ç¤ºå¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{purity}
Ent(D) = -\sum_{i=1}^np_ilog(p_i)
\end{equation}
\]</span> â€‹ å¯ä»¥çœ‹å‡ºï¼Œå…¬å¼<span class="math inline">\(\eqref{purity}\)</span>å®šä¹‰çš„çº¯åº¦ï¼Œå½“æŸä¸€ç±»å®Œå…¨å æ®æ•´ä¸ªé›†åˆæ—¶ç†µå–å¾—æœ€å°å€¼0ã€‚ä¸ºä»€ä¹ˆè¦è®¨è®ºä¿¡æ¯ç†µæˆ–è€…æ˜¯çº¯åº¦ï¼Ÿå¤„äºå†³ç­–æ ‘çš„ç”Ÿæˆè€ƒè™‘ï¼Œæˆ‘ä»¬ä½¿ç”¨å¾ˆå¤šç‰¹å¾ç”Ÿæˆä¸€æ£µå†³ç­–æ ‘ï¼Œä½†åœ¨å†³ç­–æ ‘ä¸­ï¼Œä¸åŒçš„ç‰¹å¾åœ°ä½ä¹Ÿæ˜¯ä¸ç›¸åŒçš„ï¼Œnaiveçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡åˆ†æ”¯åªé€‰æ‹©å…¶ä¸­ä¸€ä¸ªç‰¹å¾ï¼Œé‚£ä¹ˆè¦é€‰å“ªä¸€ä¸ªç‰¹å¾ä½œä¸ºæœ¬ç»“ç‚¹å‘ä¸‹åˆ†æ”¯çš„ç‰¹å¾ï¼Ÿéœ€è¦è¿›è¡Œä¼˜é€‰ï¼Œä¼˜é€‰çš„æŒ‡æ ‡å°±æ˜¯çº¯åº¦ã€‚</p>
<p>â€‹ æ˜¾ç„¶ï¼Œå¦‚æœä¸€ç§åˆ’åˆ†æ¨¡å¼å¯ä»¥åˆ’åˆ†å‡ºçº¯åº¦è¾ƒé«˜çš„å­ç»“ç‚¹ï¼ˆæ ·æœ¬å­é›†åˆï¼‰ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>å…¨çº¯ç»“ç‚¹ï¼ˆåªæœ‰ä¸€ç±»ï¼‰å¯ä»¥é¿å…è¿›ä¸€æ­¥åˆ†æ”¯ï¼Œå‡å°æ ‘ç»“æ„å¤æ‚åº¦</li>
<li>å­é›†åˆè¶Šçº¯ï¼Œè¯´æ˜åˆ†ç±»æ•ˆæœè¶Šå¥½ï¼ˆå› ä¸ºåŸé›†åˆæ˜¯æ— åºçš„ï¼Œç†µå¤§ï¼Œåˆ†ç±»å¯ä»¥çœ‹ä½œç†µå‡è¿‡ç¨‹ï¼‰</li>
</ul>
<p>â€‹ ç”±æ­¤æˆ‘ä»¬å®šä¹‰ä¿¡æ¯å¢ç›Šï¼šå¯¹äºå…¬å¼<span class="math inline">\(\eqref{purity}\)</span>å®šä¹‰çš„â€œçº¯åº¦â€ï¼Œä¸ªäººè®¤ä¸ºåº”è¯¥å«åšâ€œæ‚åº¦â€æ›´å¥½ï¼Œå®é™…ä¸Šæˆ‘çœ‹Wikipediaç§°è¿™ä¸ªä¸ºâ€œimpurityâ€ï¼Œå¾ˆæ˜¾ç„¶å˜›ï¼Œå€¼è¶Šå¤§æ‚åº¦è¶Šé«˜ã€‚é‚£ä¹ˆåŸé›†åˆçš„æ‚åº¦ä¸º<span class="math inline">\(Ent(D)\)</span>ï¼Œå¦‚ä½•é€‰å–åˆ’åˆ†æ‰èƒ½ä½¿å¾—ç³»ç»Ÿçš„æ‚åº¦ä¸‹é™æœ€å¤§å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬é€‰å–çš„å±æ€§<span class="math inline">\(a\)</span>å­˜åœ¨<span class="math inline">\(v\)</span>ä¸ªä¸åŒçš„å€¼ï¼ˆä¹Ÿå°±æ˜¯<span class="math inline">\(v\)</span>åˆ†æ”¯ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªåˆ†æ”¯ï¼ˆaå±æ€§çš„æ¯ç§å¯èƒ½å–å€¼ï¼‰éƒ½ä¼šæœ‰ä¸€å®šæ ·æœ¬ï¼ˆå¯ä»¥ä¸º0ï¼‰ï¼Œè®°ä¸º<span class="math inline">\(D^v\)</span>ã€‚å¯¹åº”åœ°ï¼Œ<span class="math inline">\(Ent(D^v)\)</span>æŒ‡çš„æ˜¯æ€»ä½“ä¸º<span class="math inline">\(D^v\)</span>æ—¶ï¼Œåˆ†ç±»çš„æ‚åº¦ã€‚é‚£ä¹ˆæ ¹æ®<span class="math inline">\(\vert D^v\vert / \vert D\vert\)</span> ä¹Ÿå³æ¯ä¸ªå±æ€§æ ·æœ¬çš„å æ¯”å¯¹æ‚åº¦è¿›è¡ŒåŠ æƒï¼Œåˆ’åˆ†åçš„ç³»ç»Ÿæ‚åº¦ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{impurity}
G(D,a)=Ent(D)-\sum_{j = 1}^v\frac{|D^j|}{|D|}Ent(D^j)
\end{equation}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{impurity}\)</span>æ˜¯åŸç³»ç»Ÿçš„æ‚åº¦ å‡å» åˆ’åˆ†åçš„ç³»ç»Ÿæ‚åº¦ã€‚è¿™ä¹Ÿå°±æ˜¯<strong><u>åˆ†ç±»ï¼Œè¿™ä¸ªç†µå‡è¿‡ç¨‹åˆ°åº•è®©ç³»ç»Ÿçš„ç†µå‡äº†å¤šå°‘</u></strong>ã€‚è¿™è¢«ç§°ä¸º<strong><u>ä¿¡æ¯å¢ç›Š</u></strong>ï¼ˆinformation gainï¼‰ï¼Œå®é™…ä¸Šè¡¡é‡çš„å°±æ˜¯åˆ†ç±»ä½¿ç³»ç»Ÿç†µå‡å°‘çš„é‡ã€‚æ˜¾ç„¶æˆ‘ä»¬å¸Œæœ›ï¼Œç†µå‡è¶Šå¤§è¶Šå¥½ã€‚é‚£ä¹ˆæ¯æ¬¡ä»å±æ€§é›†åˆä¸­è®¡ç®— / é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§è¿›è¡Œåˆ†æ”¯å³å¯ã€‚</p>
<h4 id="äº’ä¿¡æ¯">äº’ä¿¡æ¯</h4>
<p>â€‹ ä¿¡æ¯è®ºä¸­ï¼Œå¦‚æœéœ€è¦è¡¡é‡ä¸¤ä¸ªéšæœºå˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥è®¡ç®— ä¸€ä¸ªéšæœºå˜é‡æºå¸¦çš„ä¿¡æ¯åŒ…å«å¦ä¸€ä¸ªéšæœºå˜é‡ä¿¡æ¯çš„é‡å¤§å°ï¼Œè¿™è¢«å®šä¹‰ä¸ºäº’ä¿¡æ¯ï¼ˆmutual informationï¼‰ã€‚å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šä¸¤ä¸ªæœ‰å…³è”çš„å˜é‡ï¼Œç»™å®šå…¶ä¸­ä¸€ä¸ªå˜é‡çš„ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªå˜é‡çš„ä¸ç¡®å®šæ€§éšä¹‹å‡å°ï¼š <span class="math display">\[
\begin{equation}\label{mut}
I(X;Y)=D_{KL}(P_{XY}||P_X \otimes P_Y),\text{ where } x\in\mathcal{X},y\in\mathcal{Y}
\end{equation}
\]</span> â€‹ ä¸Šå¼è¯´çš„æ˜¯ï¼šxæ˜¯ç©ºé—´<span class="math inline">\(\mathcal{X}\)</span>ä¸­çš„éšæœºå˜é‡ï¼Œyæ˜¯ç©ºé—´<span class="math inline">\(\mathcal{Y}\)</span>ä¸­çš„éšæœºå˜é‡ï¼Œé‚£ä¹ˆäº’ä¿¡æ¯æ˜¯è”åˆåˆ†å¸ƒ<span class="math inline">\(P_{XY}\)</span>ä¸è¾¹ç¼˜åˆ†å¸ƒ<span class="math inline">\(P_X\text{ and }P_Y\)</span>çš„å¤–ç§¯çš„KLæ•£åº¦ã€‚å¤šç»´ç©ºé—´ä¸å¥½ç†è§£çš„è¯ï¼Œè®¨è®ºä¸€ç»´å˜é‡ï¼š <span class="math display">\[
\begin{equation}\label{mut1}
I(X;Y)=\int_y\int_xp(x, y)log\left(\frac{p(x, y)}{p(x)p(y)}\right)dxdy
\end{equation}
\]</span> â€‹ ä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥æè¿°ç›¸å…³ç¨‹åº¦å‘¢ï¼Ÿå› ä¸ºæ˜¾ç„¶ï¼ŒXä¸Yç‹¬ç«‹æ—¶çš„è”åˆåˆ†å¸ƒä¸º<span class="math inline">\(p(x)p(y)\)</span>ï¼Œæ­¤å¤„è¡¡é‡çš„å³æ˜¯çœŸå®è”åˆåˆ†å¸ƒ<span class="math inline">\(p(x, y)\)</span>ä¸ç‹¬ç«‹æ—¶çš„è”åˆåˆ†å¸ƒçš„å·®åˆ«ã€‚</p>
<p>â€‹ äº’ä¿¡æ¯å’Œä¿¡æ¯å¢ç›Šæ˜¯å­˜åœ¨å…³ç³»çš„[1]ã€‚åœ¨åˆ’åˆ†æ—¶ï¼Œå¦‚æœå¯¹å±æ€§é›†åˆAï¼ˆä¹Ÿå°±æ˜¯<span class="math inline">\(a\)</span>æ‰€åœ¨çš„é›†åˆï¼‰å–ä¸Šä¸€ä¸ªæœŸæœ›ï¼Œé‚£ä¹ˆä¼šæœ‰ä»€ä¹ˆå‘ç°ï¼Ÿä¹Ÿå³å¯¹å…¬å¼<span class="math inline">\(\eqref{impurity}\)</span>å®šä¹‰çš„ä¿¡æ¯å¢ç›Šå–Açš„æœŸæœ›ï¼Œä¸ºäº†æ–¹ä¾¿æ•°å­¦å˜æ¢ï¼Œæˆ‘ä»¬å°†<span class="math inline">\(\eqref{impurity}\)</span>å±•å¼€ï¼š <span class="math display">\[
\begin{equation}\label{expand}
G(D,a)=-\sum_{k=1}^Jp_klog_2p_k-\sum_{v=1}^V\frac{|D^v|}{|D|}\left(-\sum_{k=1}^Jp_{D^v,k}log_2p_{D^v,k}\right)
\end{equation}
\]</span> â€‹ æ˜¾ç„¶å…¬å¼<span class="math inline">\(\eqref{expand}\)</span>å¯ä»¥è¢«è¡¨ç¤ºä¸ºï¼ˆåŸç³»ç»Ÿç†µ - ç»™å®šåˆ’åˆ†ä¸‹çš„æ–°é›†åˆç†µï¼‰ <span class="math display">\[
\begin{equation}\label{ent1}
G(D,a)=Ent(D)-Ent(D|a)
\end{equation}
\]</span> â€‹ è¿›è¡ŒæœŸæœ›çš„æ±‚å–å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
E_A(G(D,a))=Ent(D)-Ent(D|A)
\]</span> â€‹ ä¸‹é¢è¯æ˜ä¸€ä¸ªæœ‰å…³äº’ä¿¡æ¯çš„ç®€å•ç»“è®ºï¼š <span class="math display">\[
\begin{equation}\label{lemma}
I(X;Y)=Ent(X)-Ent(X|Y)
\end{equation}
\]</span> â€‹ æ€ä¹ˆè¯´å‘¢ã€‚æ¨äº†å¥½é•¿æ—¶é—´æ²¡æœ‰æ¨å‡ºæ¥çš„åŸå› å°±æ˜¯ï¼š<strong><u>æ²¡æœ‰å­¦è¿‡ä¿¡æ¯è®ºï¼Œæ¦‚å¿µä¸æ¸…æ¥šã€‚</u></strong>æ¯”å¦‚<span class="math inline">\(\eqref{lemma}\)</span>å³è¾¹çš„ç¬¬äºŒé¡¹ï¼Œæ¡ä»¶ä¿¡æ¯ç†µï¼Œå®šä¹‰ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{cond}
Ent(X|Y)=\sum_{x\in\mathcal{X},y\in\mathcal{Y}}p(x,y)log(p(x|y)),\text{ but not }\sum_{x\in\mathcal{X}}p(x|y)log(p(x|y))
\end{equation}
\]</span> â€‹ é‚£ä¹ˆ<span class="math inline">\(\eqref{lemma}\)</span>å¯ä»¥å±•å¼€ä¸ºï¼š <span class="math display">\[
I(X;Y)=-\sum_{y\in\mathcal{Y}}\sum_{x\in\mathcal{X}}p(x,y)log(p(x))+\sum_{y\in\mathcal{Y}}\sum_{x\in\mathcal{X}}p(x,y)log\left( \frac{p(x,y)}{p(y)}\right)
\]</span> â€‹ åŒ–ç®€å¯ä»¥å¾—åˆ°å…¬å¼<span class="math inline">\(\eqref{lemma}\)</span>æˆç«‹ã€‚é‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼Œå¢ç›Šç‡å¯¹äºAçš„æœŸæœ›ï¼ˆä¹Ÿå°±æ˜¯å¯¹äºå±æ€§é›†çš„æ¦‚ç‡å¹³å‡ï¼‰å°±æ˜¯å†³ç­–æ ‘ç»“ç‚¹ä¸å±æ€§é›†çš„äº’ä¿¡æ¯ã€‚</p>
<h4 id="å¢ç›Šç‡">å¢ç›Šç‡</h4>
<p>â€‹ å®é™…ä¸Šï¼Œçº¯ä½¿ç”¨ä¿¡æ¯å¢ç›Šå¹¶ä¸å¤ªå¥½ã€‚å‡è®¾æŸä¸ªåˆ†æ”¯ç»“ç‚¹åªæœ‰ä¸€ä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆæ˜¾ç„¶åˆ†æ”¯çº¯åº¦æœ€å¤§ï¼ˆæ‚åº¦æœ€å°ï¼‰ï¼Œé‚£ä¹ˆå‡å¦‚æœ‰ä¸€ä¸ªå±æ€§åˆ†æ”¯æå¤šï¼Œå¯èƒ½ä¸€ä¸‹å°±å°†æ‰€æœ‰çš„æ ·æœ¬åˆ†åˆ°ä¸åŒç»“ç‚¹ä¸Šäº†ï¼ˆæ¯”å¦‚ã€Šè¥¿ç“œä¹¦ã€‹ä¸Šæåˆ°çš„ï¼Œæ ·æœ¬åºå·ï¼‰ï¼Œè¿™æ ·å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆçš„åˆ†æ”¯å±æ€§æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä½†æ˜¯åªç”¨ä¿¡æ¯å¢ç›Šçš„è¯å®é™…å°±ä¼šé€‰æ‹©è¿™ä¸ªåˆ†æ”¯æ–¹æ³•ã€‚æ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªå› å­æ¥é™å®šåˆ†æ”¯æ•°çš„å½±å“ï¼š <span class="math display">\[
\begin{equation}\label{int}
IV(a)=-\sum_{v=1}^V\frac{|D^v|}{|D|}log\left( \frac{|D^v|}{|D|}\right)
\end{equation}
\]</span> â€‹ å¯ä»¥å‘ç°ï¼Œå½“åˆ†æ”¯æ•°è¶Šå¤šï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼ˆä¸ä¼šå‡ºç°å•åˆ†æ”¯ï¼‰ã€‚è¿™ä¸ªå€¼ç§°ä¸ºï¼šå›ºæœ‰å€¼ï¼ˆintrinsic valueï¼‰ï¼Œåªéœ€è¦ä½¿ç”¨è¿™ä¸ªå€¼å¯¹å¢ç›Šè¿›è¡Œæƒ©ç½šå³å¯ï¼ˆé™¤ä»¥æ­¤å€¼ï¼‰ã€‚</p>
<h4 id="åŸºå°¼æŒ‡æ•°">åŸºå°¼æŒ‡æ•°</h4>
<p>â€‹ é’ˆå¯¹CARTå†³ç­–æ ‘çš„ï¼Œè€Œä»¥ä¸Šæ‰€è¯´çš„å†³ç­–æ ‘ä½¿ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºåˆ’åˆ†å±æ€§é€‰æ‹©çš„åº¦é‡ã€‚åŸºå°¼æŒ‡æ•°ï¼ˆGini impurityï¼‰æŒ‡çš„æ˜¯ï¼š</p>
<blockquote class="blockquote-center">
<p>Gini impurity is a measure of how often a randomly chosen element from the set would be incorrectly labeled if it was randomly labeled according to the distribution of labels in the subset.[1]</p>

</blockquote>
<p>â€‹ ç¿»è¯‘å¾ˆç®€å•ï¼šä»é›†åˆä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œå†æ ¹æ®è¿™ä¸ªé›†åˆä¸­çš„ç±»åˆ«æ¦‚ç‡åˆ†å¸ƒéšæœºç»™è¿™ä¸ªå…ƒç´ è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ç±»çš„é”™è¯¯æ¦‚ç‡å°±æ˜¯åŸºå°¼æŒ‡æ•°ã€‚ <span class="math display">\[
\begin{equation}\label{gini}
Gini(D)=\sum_{i=1}^{|\mathcal Y|}p_i\sum_{k\neq i}p_k=1-\sum_{k=1}^{|\mathcal Y|}p_k^2
\end{equation}
\]</span> â€‹ æ˜¾ç„¶ï¼Œçº¯åº¦è¶Šé«˜çš„é›†åˆï¼Œå†…éƒ¨éšæœºå–å…ƒç´ éšæœºåˆ†ç±»é”™è¯¯çš„æ¦‚ç‡ï¼ˆæœŸæœ›ï¼‰è¶Šå°ã€‚</p>
<h3 id="å˜é‡ç¼ºå¤±å¤„ç†çš„ç†è§£">å˜é‡ç¼ºå¤±å¤„ç†çš„ç†è§£</h3>
<p>â€‹ åœ¨è´å¶æ–¯å†³ç­–è®ºä¸­æåˆ°ï¼š</p>
<ul>
<li>æŸä¸€å±æ€§ç»„åˆçš„å˜é‡å¯èƒ½æ ¹æœ¬ä¸åœ¨æ ·æœ¬ä¸­å‡ºç°ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è®¤ä¸ºè¿™æ ·çš„æ ·æœ¬ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>â€‹ è€Œåœ¨å†³ç­–æ ‘ä¸­ï¼Œæˆ‘ä»¬æ›´å¤šé’ˆå¯¹çš„é—®é¢˜æ˜¯ï¼šå½“æŸä¸€ä¸ªæ ·æœ¬æŸä¸ªå±æ€§å€¼æ˜¯æœªçŸ¥çš„ï¼Œå¦‚ä½•å¤„ç†è¿™æ ·çš„æ ·æœ¬ï¼Ÿä¸¢å¼ƒæ˜¯æ˜¾ç„¶ä¸å¯å–çš„ï¼Œè¿™æ ·å¯èƒ½æŸå¤±å¤ªå¤šçš„æœ‰æ•ˆä¿¡æ¯ã€‚è€Œç›´æ¥ä½¿ç”¨ç¡®å®ä¹Ÿä¸æ˜¯åŠæ³•ï¼Œå°‘æ‰ä¸€ä¸ªå±æ€§è¦å¦‚ä½•ç»§ç»­åˆ†æ”¯ï¼Ÿã€Šè¥¿ç“œä¹¦ã€‹ä¸Šå°†é—®é¢˜æ€»ç»“åœ°å¾ˆä¸é”™ï¼š</p>
<blockquote class="blockquote-center">
<p>æˆ‘ä»¬éœ€è§£å†³ä¸¤ä¸ªé—®é¢˜: (1) å¦‚ä½•åœ¨å±æ€§å€¼ç¼ºå¤±çš„æƒ…å†µè¿›è¡Œåˆ’åˆ†å±æ€§é€‰æ‹© ? (2) ç»™å®šåˆ’åˆ†å±æ€§ï¼Œè‹¥æ ·æœ¬åœ¨è¯¥å±æ€§ä¸Šçš„å€¼ç¼ºå¤±ï¼Œå¦‚ä½•å¯¹æ ·æœ¬è¿›è¡Œåˆ’åˆ† ?</p>

</blockquote>
<p>â€‹ ç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘å¼€å§‹å¹¶æ²¡æœ‰ä»€ä¹ˆå¾ˆå¥½çš„æƒ³æ³•ã€‚è€Œå¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ªäººå¼€å§‹è®¤ä¸ºï¼Œå‡è®¾å·²ç»çŸ¥é“äº†åˆ’åˆ†å±æ€§ï¼Œå¯ä»¥æ ¹æ®å…¶ä»–å®Œå¥½æ ·æœ¬æ¥ä¼°è®¡æœ¬æ ·æœ¬åœ¨è¿™ä¸ªç¼ºå¤±å±æ€§ä¸Šçš„åˆ†å¸ƒï¼Œè¿›è¡Œåˆ†å¸ƒåŠ æƒï¼ˆäº‹å®ä¸Šï¼Œè¿™ä¸ªæƒ³æ³•ç±»ä¼¼ã€Šè¥¿ç“œä¹¦ã€‹ä¸Šæä¾›çš„æ–¹æ³•ï¼‰ã€‚</p>
<p>â€‹ é—®é¢˜ä¸€å®é™…ä¸Šæ¯”è¾ƒå®¹æ˜“ï¼Œæˆ‘æƒ³å¾—å¤ªå¤æ‚äº†ã€‚ç”±äºåˆ’åˆ†å±æ€§åªè€ƒè™‘<strong><u>ä¸€ä¸ªå±æ€§ä¸åˆ†ç±»ç»“æœçš„å…³ç³»</u></strong>ï¼Œé‚£ä¹ˆå®Œå…¨ç”¨ä¸ç€è€ƒè™‘å¤šå±æ€§å…³ç³»ï¼Œåªéœ€è¦å–å‡ºè¿™ä¸ªå±æ€§ä¸‹å¯¹åº”æ²¡æœ‰ç¼ºå¤±çš„æ ·æœ¬ï¼Œåˆ©ç”¨è¿™äº›æ ·æœ¬ä¼°è®¡ã€å±æ€§ã€‘å¯¹ã€åˆ†ç±»ç»“æœã€‘çš„å½±å“å³å¯ã€‚ä»¥ä¿¡æ¯å¢ç›Šæ³•ä¸ºä¾‹ï¼Œè€ƒè™‘<span class="math inline">\(\eqref{impurity}\)</span>å®šä¹‰çš„ä¿¡æ¯å¢ç›Šã€‚å‡è®¾æˆ‘ä»¬è®¨è®ºå±æ€§<span class="math inline">\(a\)</span>ï¼Œç”±äºæœ‰äº›æ ·æœ¬å±æ€§æ˜¯ç¼ºå¤±çš„ï¼Œåœ¨è®¡ç®—æ—¶å°†è¿™äº›æ ·æœ¬å‰”é™¤å†è®¡ç®—æ–°é›†åˆ<span class="math inline">\(\tilde{D}\)</span>çš„ä¿¡æ¯å¢ç›Š<span class="math inline">\(\tilde{G}(\tilde{D},a)\)</span>ã€‚æ³¨æ„ï¼Œæ­¤ä¿¡æ¯å¢ç›Šè®¡ç®—å‡ºæ¥åéœ€è¦åŠ æƒï¼š <span class="math display">\[
\begin{equation}\label{weigh}
\tilde{G}(\tilde{D},a)\times\rho,\text{ what is Ï?}
\end{equation}
\]</span> â€‹ å…¶ä¸­çš„<span class="math inline">\(\rho\)</span>æ˜¯åŠ æƒå› å­ï¼Œæ˜¯ä»€ä¹ˆæƒé‡å‘¢ï¼Ÿå‡è®¾å±æ€§aåœ¨é›†åˆä¸­æœ‰<span class="math inline">\(|\tilde{D}|\)</span>ä¸ªæœªç¼ºå¤±æ ·æœ¬ï¼Œé‚£ä¹ˆ<span class="math inline">\(\rho=|\tilde D|/|D|\)</span>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ ·æœ¬ç¼ºå¤±è¶Šå°‘ï¼Œä¿¡æ¯å¢ç›Šè®¡ç®—è¶Šå¯ä¿¡ã€‚</p>
<p>â€‹ é—®é¢˜2å®é™…ä¸Šæ˜¯å°†â€œè®©åŒä¸€ä¸ªæ ·æœ¬ä»¥ä¸åŒçš„æ¦‚ç‡åˆ’å…¥åˆ°ä¸åŒçš„å­ç»“ç‚¹ä¸­å»â€ï¼ˆã€Šè¥¿ç“œä¹¦ã€‹è¨€ï¼‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ²¡æœ‰ç¼ºå¤±å±æ€§açš„æ ·æœ¬ä¿¡æ¯ï¼Œå‡è®¾æŸä¸€åˆ†æ”¯åˆ†åˆ°å±æ€§açš„vå–å€¼<span class="math inline">\(a^v\)</span>ä¸Šï¼š <span class="math display">\[
\tilde{r_v}=\frac{\sum_{x\in\tilde{D}_v}w_x}{\sum_{x\in {\tilde{D}}}w_x}
\]</span> â€‹ ä¹Ÿå°±æ˜¯æ²¡æœ‰ç¼ºå¤±å±æ€§açš„æ ·æœ¬ä¸­ï¼Œæœ‰<span class="math inline">\(\tilde{r_v}\)</span>æ¯”ä¾‹æ ·æœ¬åœ¨æœ¬å±æ€§ä¸Šå–å€¼ä¸ºvï¼Œé‚£ä¹ˆå½“æ¯ä¸ªæ ·æœ¬æƒé‡ä¸º<span class="math inline">\(w_x\)</span>æ—¶ï¼Œå¯ä»¥æŒ‰ç…§æ¯”ä¾‹å°†ç¼ºå¤±æ ·æœ¬åˆ†é…ç»™ä¸åŒåˆ†æ”¯ï¼ˆç›¸å½“äºæŒ‰ç…§æ¦‚ç‡ï¼ˆæ¯”ä¾‹ï¼‰å‰²è£‚ä¸€ä¸ªç¼ºå¤±æ ·æœ¬ï¼‰ã€‚</p>
<h3 id="kernelization">Kernelization</h3>
<p>â€‹ æ™®é€šå†³ç­–æ ‘çš„åˆ†ç±»è¾¹ç•Œéƒ½æ˜¯å‚ç›´äºæŸä¸ªè½´çš„ï¼ˆå› ä¸ºå†³ç­–æ ‘æ˜¯ä¸€ç§â€œéé»‘å³ç™½â€çš„åˆ†ç±»æ–¹æ³•ï¼‰ã€‚åœ¨æŸä¸ªå±æ€§ï¼ˆæŸä¸ªç»´åº¦ï¼‰ä¸Šï¼Œåªæœ‰å›ºå®šçš„å‡ ç§åˆ†æ³•ï¼š</p>
<p><img src="/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/tree.jpg"></p>
<center>
<p>Figure 3. å†³ç­–æ ‘åœ¨å•ä¸€ç»´åº¦ä¸Šçš„åˆ†ç±»è¾¹ç•Œæ€»æ˜¯å‚ç›´äºè½´çš„</p>
<p>â€‹ å•Šè¿™ï¼Ÿå¤ªè¿‡äºâ€œä¸€ç»´â€äº†ï¼Œç”šè‡³è¿ç®€å•çš„çº¿æ€§å¯åˆ†åˆ†ç±»éƒ½éœ€è¦ç»è¿‡å¦‚ä¸‹çš„è‰°éš¾æ“ä½œï¼š</p>
<p><img src="/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/clf.JPG"></p>
<center>
<p>Figure 4. å†³ç­–æ ‘æ‰­æ¥æ‰­å»</p>
<p>â€‹ ä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯ï¼šä¸é€‚ç”¨åŸå±æ€§è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åƒPCAé‚£æ ·ï¼Œä½¿ç”¨å±æ€§çš„çº¿æ€§ç»„åˆå½¢æˆæŠ½è±¡å±æ€§ï¼Œåœ¨è¿™ä¸ªæŠ½è±¡å±æ€§å¯¹åº”çš„æ–°ç©ºé—´ä¸­ï¼Œè™½ç„¶åˆ†ç±»è¾¹ç•Œä»ç„¶å‚ç›´äºæ–°çš„ç©ºé—´è½´ï¼Œä½†åœ¨åŸç©ºé—´çœ‹èµ·æ¥ï¼Œå°±æˆä¸ºä¸€èˆ¬çº¿æ€§åˆ†ç±»å™¨äº†ã€‚è€Œè¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœä½¿ç”¨å…¶ä»–çš„éçº¿æ€§ç‰¹å¾ç»„åˆæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¼•å…¥æŸäº› <strong><u>kernel</u></strong>ï¼Œç”šè‡³å¯ä»¥é€šè¿‡å†³ç­–æ ‘è¾¾åˆ°ä»»æ„åˆ†ç±»è¾¹ç•Œç”Ÿæˆçš„æ•ˆæœã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] Wikipedia, <a href="https://en.wikipedia.org/wiki/Decision_tree_learning#Gini_impurity">Decision tree learning</a></p>
</center></center>]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>æ¦‚ç‡è®º</tag>
        <tag>ML</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼–è¯‘åŸç†å°çŸ¥è¯†</title>
    <url>/2021/07/16/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%B0%8F%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h1 id="ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½ä¹±é“¾æ¥">ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½ä¹±é“¾æ¥</h1>
<h2 id="i.-ç¼˜ä»ä½•èµ·">I. ç¼˜ä»ä½•èµ·ï¼Ÿ</h2>
<p>â€‹ æœºé˜Ÿçš„å°ä¼™ä¼´é—®äº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œè¯´æ˜¯åœ¨ä¸€ä¸ª<code>.hpp</code>æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªnamespaceï¼Œ<code>.hpp</code>ä¹Ÿæœ‰å¤´æ–‡ä»¶ä¿æŠ¤ï¼Œåœ¨namespaceä¸‹ä¹Ÿ<strong><u>å®šä¹‰ï¼ˆå£°æ˜ / å®šä¹‰éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼‰</u></strong>äº†å‡ ä¸ªå‡½æ•°ï¼ˆéç±»å‡½æ•°ï¼‰ï¼Œ<code>.hpp</code>æ–‡ä»¶ä¸­åŒæ—¶è¿˜æœ‰ä¸€ä¸ªç±»çš„å®šä¹‰ã€‚é‚£ä¹ˆè‡ªç„¶è¿™ä¸ªæ–‡ä»¶ä¼šè¢«è‡³å°‘ä¸¤ä¸ª<code>.cc</code>æ–‡ä»¶ç»™includeï¼š</p>
<ul>
<li>ç±»å®šä¹‰æ–‡ä»¶ / mainå‡½æ•°æ‰€åœ¨çš„å¯æ‰§è¡Œæ–‡ä»¶</li>
</ul>
<p>â€‹ ç»“æœç¼–è¯‘çš„æ—¶å€™æŠ¥äº†redefinedçš„é”™è¯¯ï¼Œè¯´æ˜¯namespaceä¸‹é¢çš„å‡½æ•°é‡å¤å®šä¹‰äº†ã€‚å°ä¼™ä¼´å¾ˆç–‘æƒ‘ã€‚æˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ï¼Œå¼€å§‹æˆ‘è§‰å¾—æ˜¯ä¸åº”è¯¥æŠŠå®šä¹‰å†™åœ¨<code>.hpp</code>ä¸­ï¼Œä½†æƒ³åˆ°ç±»å‡½æ•°å¥½åƒå¯ä»¥è¿™ä¹ˆåšå•Šï¼Ÿä½œä¸ºä¸€ä¸ªæ²¡æœ‰å­¦è¿‡ç¼–è¯‘åŸç†çš„è‡ªåŠ¨åŒ–å­¦ç”Ÿï¼ˆè¯·é—®è‡ªåŠ¨åŒ–å­¦ç”Ÿéƒ½åœ¨å­¦äº›å•¥å•Šï¼Ÿï¼‰ï¼Œæ„Ÿåˆ°ç–‘æƒ‘ï¼Œäºæ˜¯æŸ¥äº†ç‚¹èµ„æ–™ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="ii.-ç¼–è¯‘å•å…ƒ">II. ç¼–è¯‘å•å…ƒ</h2>
<p>â€‹ é¦–å…ˆï¼Œä¸€ä¸ªåè¯ï¼štranslation unit</p>
<blockquote>
<p>A translation unit is the basic unit of compilation in C++. It consists of the contents of a single <strong><u>source file</u></strong>, <strong><u>plus</u></strong> the contents of any <strong><u>header files</u></strong> directly or indirectly included by it, <strong><u>minus</u></strong> those lines that were ignored using <strong><u>conditional preprocessing statements</u></strong>.</p>
</blockquote>
<p>â€‹ ä¹Ÿå³ï¼Œä¸€ä¸ªtranslation unitåŒ…å«æºæ–‡ä»¶ï¼Œç›´æ¥æˆ–è€…é—´æ¥includeçš„å¤´æ–‡ä»¶ä»¥åŠæ’é™¤é€šè¿‡å¤´æ–‡ä»¶ä¿æŠ¤æ’é™¤çš„æ–‡ä»¶ã€‚</p>
<p>â€‹ è€Œç¼–è¯‘å½¢æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦é€šè¿‡ï¼š</p>
<ul>
<li>ç¼–è¯‘+æ±‡ç¼–ï¼ˆåˆ†åˆ«ç¼–è¯‘ï¼Œæ±‡ç¼–å½¢æˆå„è‡ªçš„æœºå™¨æŒ‡ä»¤æ–‡ä»¶ï¼‰</li>
<li><strong><u>é“¾æ¥</u></strong>ï¼šå¤šé‡ç¬¦å·ï¼Œè·¨æ–‡ä»¶ç¬¦å·é—®é¢˜</li>
</ul>
<p>â€‹ è€Œä½ ç°åœ¨çš„æƒ…å†µæ˜¯ï¼š</p>
<ul>
<li>main.cc æ–‡ä»¶ï¼ˆä¸»å‡½æ•°ï¼Œå°†ä¼šäº§ç”Ÿä¸€ä¸ªtranslation unitï¼‰</li>
<li>xxx.cc æ–‡ä»¶ï¼ˆç±»å®šä¹‰ï¼Œå°†ä¼šäº§ç”Ÿä¸€ä¸ªtranslation unitï¼‰</li>
</ul>
<p>â€‹ æœ€ç»ˆåœ¨é“¾æ¥é˜¶æ®µä¼šå°†ä¸¤ä¸ªtranslation unit<strong><u>å†…å®¹åˆå¹¶</u></strong>ï¼ˆé“¾æ¥è¿‡ç¨‹å·¥ä½œçš„é€šä¿—è¯´æ³•ï¼‰ã€‚ä½†æ˜¯å¾ˆä¸å·§ï¼Œä½ çš„namespaceä¸‹çš„å‡½æ•°<strong><u>åŒæ—¶è¿›å…¥äº†ä¸¤ä¸ª</u></strong>translation unitä¸­ã€‚</p>
<p>â€‹ ä¹Ÿå°±æ˜¯åœ¨ä¸¤ä¸ªtranslation unitä¸­ï¼Œå„è¢«ç¼–è¯‘ä¸€æ¬¡ã€‚å¦‚æœä¸¤ä¸ªtranslation unitåˆ†å±ä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¸è¢«é“¾æ¥åˆ°ä¸€å—å„¿å»ï¼‰ï¼Œé‚£è¿˜å¥½è¯´ã€‚ä½†æ˜¯ç°åœ¨ä»–ä»¬è¢«é“¾æ¥åˆ°ä¸€èµ·å»äº†ï¼Œä¹Ÿå°±å½¢æˆäº†é‡å®šä¹‰ï¼Œä¸¤ä¸ªtranslation unitä¸­å„æœ‰ä¸€ä»½å®šä¹‰ã€‚</p>
<p>â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š<strong><u>åªåœ¨hppä¸­å£°æ˜å‡½æ•°ï¼Œåœ¨ccä¸­å®šä¹‰å‡½æ•°ï¼Œè¿™æ ·ä¸ä¼šé”™ã€‚</u></strong></p>
<hr>
<h2 id="iii.-å¤´æ–‡ä»¶ä¿æŠ¤">III. å¤´æ–‡ä»¶ä¿æŠ¤ï¼Ÿ</h2>
<p>â€‹ å¤´æ–‡ä»¶ä¿æŠ¤ä½œç”¨ä¸å•ä¸€çš„translation unitä¸­ã€‚ä¹Ÿå³ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>b.h</code> ä¸­</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;a.h&quot;</span></span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li><code>test.c</code> ä¸­</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;a.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;b.h&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>â€‹ é‚£ä¹ˆä¸¤æ¬¡includeå¯¼è‡´<code>a.h</code>ä¸¤æ¬¡ä»£ç å¤åˆ¶åˆ°<code>test.c</code>ï¼Œå°†ç”±å¤´æ–‡ä»¶ä¿æŠ¤çš„å­˜åœ¨è€Œä¸è¢«ç¼–è¯‘ä¸¤æ¬¡ã€‚å¤´æ–‡ä»¶ä¿æŠ¤å’Œè·¨translation unitçš„é“¾æ¥æ²¡æœ‰å…³ç³»ï¼Œå®ƒåªæ˜¯é˜²æ­¢ä¸€ä¸ªtranslation unitå†…éƒ¨ï¼Œä¸å› ä¸ºå¤šé‡é—´æ¥includeå¯¼è‡´é‡å®šä¹‰ã€‚</p>
<p>â€‹ ä¸ä»…æ˜¯namespaceä¸è¡Œï¼Œç›´æ¥è£¸å‡½æ•°å®šä¹‰åœ¨ <code>.hpp</code> ä¸­ï¼Œä¹‹ååˆè¢«å¤šé‡å¼•ç”¨ + é“¾æ¥åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘è¯•äº†è¯•ï¼š</p>
<ul>
<li><code>name.hpp</code> å†…å®¹å¦‚ä¸‹</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __NAME_HPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __NAME_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">//__NAME_HPP</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¤ååœ¨<code>test.cc</code> , <code>main.cc</code>ä¸¤ä¸ªæ–‡ä»¶éƒ½ include<code>name.hpp</code>ï¼Œè¿›è¡Œç¼–è¯‘ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="language-bash">&gt;&gt; g++ ./main.cc ./test.cc -o main.exe</span></span><br><span class="line"></span><br><span class="line">~\ccMq7p5P.o:test.cc:(.text+0x0): multiple definition of `sub(int, int)&#x27;</span><br><span class="line">~\cces7mzx.o:main.cc:(.text+0x0): first defined here</span><br><span class="line">collect2.exe: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¹Ÿç›´æ¥æŠ¥é”™äº†ã€‚</p>
<hr>
<h2 id="iv.-classå¯ä»¥åœ¨hppå†…å®šä¹‰">IV. classå¯ä»¥åœ¨hppå†…å®šä¹‰</h2>
<p>â€‹ classå¯ä»¥åœ¨ hpp å†…å®šä¹‰å‡½æ•°ï¼ŒåŒæ ·éƒ½æ˜¯è¢«<code>å®šä¹‰.cc</code>ï¼Œ <code>ä¸»å‡½æ•°.cc</code>includeï¼Œä¸ºä»€ä¹ˆç±»å‡½æ•°å¯ä»¥è¿‡ç¼–è¯‘ï¼Ÿ</p>
<p>â€‹ å› ä¸ºç±»å‡½æ•°æœ‰<strong><u>ç‰¹æ®Šæ€§</u></strong>ï¼šå£°æ˜ å’Œ å®šä¹‰æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œå‡½æ•°<strong><u>è‡ªåŠ¨å†…è”</u></strong>ï¼ˆinlineï¼‰ã€‚inlineå‡½æ•°åœ¨å¤šé‡å®šä¹‰å­˜åœ¨æ—¶ï¼Œåªä¼šå¤„ç†inlineå£°æ˜ä½ç½®çš„å®šä¹‰ã€‚</p>
<p>â€‹ æ‰€ä»¥ï¼Œå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼šåœ¨namespaceä¸‹çš„å‡½æ•°å‰é¢åŠ ä¸Š <strong><u>inline</u></strong>ã€‚ä½†æ˜¯æˆ‘ä¸ªäººéå¸¸ä¸å»ºè®®è¿™ä¹ˆåšã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
        <category>debugs</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>ç¼–è¯‘åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>è¢«SCAEæŠ˜ç£¨çš„ä¸€å¤©</title>
    <url>/2021/07/18/%E8%A2%ABSCAE%E6%8A%98%E7%A3%A8%E7%9A%84%E4%B8%80%E5%A4%A9/</url>
    <content><![CDATA[<h1 id="scae">SCAE</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ åœ¨å¤ç°å®ŒCapsNetç¬¬ä¸€ç‰ˆä¹‹åï¼Œæƒ³å¤ç°è¿™ç¯‡è®ºæ–‡ï¼ˆç¬¬ä¸‰ç‰ˆCapsNetï¼š<a href="https://arxiv.org/abs/1906.06818"><em>Stacked Capsule Autoencoders, Adam R. Kosiorek, et al.</em></a>ï¼‰ã€‚å¤ç°çš„åŸºç¡€æ˜¯çœ‹æ‡‚ï¼Œç†è§£å…¶æ„ä¹‰ã€‚æœ¬ç¯‡åšå®¢ä¸ºæˆ‘è¯»è¿™ç¯‡è®ºæ–‡æ—¶çš„ä¸€äº›æ€è€ƒï¼Œå…¶ä¸­å½“ç„¶è¿˜æœ‰äº›(å¾ˆå¤š)ä¸å¤Ÿé€å½»çš„åœ°æ–¹ã€‚è¦æ˜¯å®Œå…¨é€å½»äº†æˆ‘ä¼°è®¡å°±å¯ä»¥ç›´æ¥åŠ¨æ‰‹å¤ç°äº†ã€‚</p>
<p><img src="/2021/07/18/%E8%A2%ABSCAE%E6%8A%98%E7%A3%A8%E7%9A%84%E4%B8%80%E5%A4%A9/2.PNG"></p>
<center>
Figure 1.Stacked Capsule Autoencodersç½‘ç»œç»“æ„å›¾
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-ccae">II. CCAE</h2>
<h3 id="ccaeç»“æ„">2.1 CCAEç»“æ„</h3>
<p>â€‹ å¾ˆé¡¶å•Šï¼ŒCCAEä¸Šæ¥å°±ä½¿ç”¨Set Transformerè¿›è¡Œäº†ç‰¹å¾å­¦ä¹ ï¼Œå˜å½¢é‡‘åˆšç‰›é€¼ï¼š</p>
<ul>
<li>è¾“å…¥ä¸€å †nç»´å‘é‡ï¼Œè¾“å‡ºæ˜¯ä¸€å †object capsulesï¼ˆkä¸ªï¼‰ã€‚è¿™ä¸ªcapsulesåŒ…å«ï¼š
<ul>
<li>objectâ€”viewer 3 * 3å›¾åƒä»¿å°„å˜æ¢ï¼ˆ9ï¼‰</li>
<li>featureå‘é‡ï¼ˆæœªçŸ¥ï¼‰</li>
<li>æ­¤capsuleè¡¨ç¤ºçš„ç‰©ä½“æ˜¯å¦å­˜åœ¨çš„æ¦‚ç‡ï¼ˆ1ï¼‰</li>
<li><strong><u>æ­¤éƒ¨åˆ†ä¸ºTransformerè¾“å…¥è¾“å‡ºï¼Œnè¾“å…¥-&gt;kèƒ¶å›Šè¾“å‡º</u></strong></li>
</ul></li>
<li>æ¯ä¸ªèƒ¶å›Šéƒ½ä¼šè¿›è¡Œå†…éƒ¨çš„MLPï¼Œè¿™ä¸ªMLPå°†åˆ©ç”¨è‡ªå·±çš„ç‰¹å¾å‘é‡ï¼ˆæ¯”å¦‚è‡ªå·±æ˜¯<span class="math inline">\(\pmb{c}_k\)</span>ï¼‰å»æ¨æµ‹ï¼ŒNä¸ªå€™é€‰çš„partï¼ˆè¿™ä¸ªpartå°±æ˜¯ç‰©ä½“éƒ¨ä»¶ï¼‰çš„ç›¸å…³ä¿¡æ¯:
<ul>
<li>æ­¤åçš„MLPå­¦ä¹ çš„æ˜¯ï¼šéƒ¨ä»¶ / ç‰©ä½“çš„å˜æ¢ï¼Œè€Œå·²ç»å­¦åˆ°çš„æœ‰ï¼šç‰©ä½“ / è§‚æµ‹è€…ï¼ˆä¹Ÿå°±æ˜¯éƒ¨ä»¶åœ¨å›¾åƒä¸Šçš„poseï¼‰ï¼Œé‚£ä¹ˆéƒ¨ä»¶ / è§‚æµ‹è€…çš„ä½å§¿å˜æ¢ä¹Ÿå°±æœ‰äº†ã€‚</li>
<li>å­¦ä¹ æ¡ä»¶æ¦‚ç‡ï¼ˆ<strong><u>è¿™ä¸ªæ¶‰åŠåˆ°CCAEé«˜æ–¯æ··åˆä½“çš„ç†è§£</u></strong>ï¼‰ï¼Œ<span class="math inline">\(a_{k, n}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[
\begin{equation}
a_{k, n}=P(p_n|cap_k)
\end{equation}
\]</span></p>
<p>â€‹ ä¹Ÿå³ï¼Œä¸€ä¸ªobject capsule kå­˜åœ¨æ—¶ï¼Œéƒ¨ä»¶nå­˜åœ¨çš„æ¦‚ç‡ã€‚è€Œä¹‹å‰åœ¨Set transformerå®é™…ä¸Šå­¦ä¹ äº†ï¼Œcap kå­˜åœ¨çš„æ¦‚ç‡ï¼Œé‚£ä¹ˆå®é™…ä¸Šç»“åˆèµ·æ¥å°±å¯ä»¥å¾—åˆ°è”åˆæ¦‚ç‡ã€‚</p>
<p>â€‹ æˆ‘æ„Ÿè§‰è¿™é‡Œåšäº†ä¸€ä¸ªå¾ˆå¦™çš„æœ€å¤§åéªŒä¼°è®¡æ“ä½œï¼Œç†è§£ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨é«˜æ–¯æ··åˆæ¨¡å‹ï¼Œé‚£ä¹ˆå…¶ä¸­çš„é«˜æ–¯åˆ†å¸ƒå‚æ•°ï¼šå‡å€¼æ˜¯åŸæœ‰é«˜æ–¯åˆ†å¸ƒå‡å€¼ç»è¿‡OV,OPä½å§¿å˜æ¢å¾—åˆ°çš„ï¼Œè€Œåæ–¹å·®å·²ç»ç»è¿‡MLPå­¦ä¹ åˆ°äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡å€¼å’Œåæ–¹å·®å†™å‡ºï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}
p(\pmb{x}_m|k,n)=N(\pmb{x}_m|\mu_{k,n},\lambda_{k,n})
\end{equation}
\]</span></p>
<p>â€‹ ç»“åˆè¿™ä¸ªé«˜æ–¯æ··åˆ + æå¤§ä¼¼ç„¶çš„æ„ä¹‰ï¼Œæˆ‘ä»¬å†æ¥ç†è§£ä¸€ä¸‹å‡å€¼å’Œæ–¹å·®ä»¥åŠå…¶å¯¹åº”ä¸‹æ ‡çš„æ„ä¹‰ã€‚</p>
<h3 id="ccae-mle">2.2 CCAE &amp; MLE</h3>
<p>â€‹ å¯¹äºè®ºæ–‡ä¸­çš„å…¬å¼(5): <span class="math display">\[
\begin{equation}
p(\mathbf{x}_{1:M})=\prod_{m=1}^M\sum_{k=1}^K \sum_{n=1}^{N} \frac{a_ka_{k,n}} {\sum_i\left(a_i\sum_ja_{i,j}\right)} p(\mathbf{x}_m|k,n)
\end{equation}
\]</span> â€‹ ä¸ªäººçš„ç†è§£æ˜¯ï¼Œå¯¹äºç»™å®šçš„ä¸€å¼ å›¾åƒï¼š</p>
<ul>
<li>ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Set Transformer æ±‚å‡ºkä¸ªobject capsulesï¼Œå†ç”±è¿™å­¦ä¹ åˆ°çš„kä¸ªcapsuleç»„æˆnä¸ªç‰©ä½“éƒ¨ä»¶ï¼Œä¹Ÿå°±æ˜¯å­¦ä¹ ä¸€äº›éšå«ä¿¡æ¯</li>
<li>å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éšå«ä¿¡æ¯é‡æ„ç‰©ä½“ï¼Œæˆ‘ä»¬è®¤ä¸ºç‰©ä½“æ˜¯ç”±æŠ½è±¡çš„å‡ ä¸ªéƒ¨ä»¶ç»„æˆçš„ï¼Œéƒ¨ä»¶çš„ç”Ÿæˆä¸object capsulesä¹Ÿæœ‰ä¸€å®šå…³ç³»ã€‚é‚£ä¹ˆéƒ¨ä»¶ä»¥åŠobject capsulesäº§ç”Ÿçš„è´¡çŒ®å¯ä»¥è¢«å†™ä¸º <span class="math inline">\(p(\pmb{x}_m|k,n)\)</span>ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ï¼šæˆ‘ä»å›¾åƒï¼ˆè®­ç»ƒé›†ï¼‰ä¸Šå­¦ä¹ å‡ºobject capsuleç»™å®šä¸ºkä¸”å­˜åœ¨éƒ¨ä»¶ä¸ºnçš„æƒ…å†µä¸‹ï¼Œä¸ºç›®æ ‡<span class="math inline">\(\pmb{x}_m\)</span>çš„æ¦‚ç‡ã€‚</li>
</ul>
<p>â€‹ è®­ç»ƒé›†å¯ä»¥çœ‹ä½œæ˜¯æ ·æœ¬æ€»ä½“åˆ†å¸ƒçš„æŠ½æ ·ï¼Œé‚£ä¹ˆåœ¨æ ¹æ®æ ·æœ¬è¿›è¡Œå­¦ä¹ æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•ï¼š<strong><u>ä½¿å¾—æŠ½æ ·ï¼ˆè®­ç»ƒé›†ï¼‰å‡ºç°çš„æ¦‚ç‡æœ€å¤§</u></strong>ï¼Œä¹Ÿå°±æ˜¯ï¼š <span class="math display">\[
\begin{equation}
\max P(X)=\max\prod_{i=1}^nP(\pmb{x}_i)
\end{equation}
\]</span> â€‹ åœ¨è¿™é‡Œ<span class="math inline">\(p(\pmb{x}_m|k,n)\)</span>åªæ˜¯æ¡ä»¶æ¦‚ç‡ï¼Œæˆ‘ä»¬éœ€è¦å»æ‰æ¡ä»¶éƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®ä¹‹å‰Set Transformerä»¥åŠMLPçš„è¾“å‡ºï¼Œå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}
\frac{a_ka_{k,n}}{\sum_i\left(a_i\sum_ja_{i,j}\right)}=\frac{p(k,n)}{\sum_i\sum_jp(i,j)}=p(k,n)
\end{equation}
\]</span> â€‹ é‚£ä¹ˆå…¬å¼5å¾ˆå®¹æ˜“ä»å·¦è¾¹è½¬åŒ–ä¸ºå³è¾¹ã€‚è€Œå·¦è¾¹å’Œå³è¾¹ç›¸ç­‰çš„æ„ä¹‰æ˜¯ï¼Ÿ</p>
<ul>
<li>å·¦å¼æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°ï¼ˆæå¤§ä¼¼ç„¶ä¼°è®¡éœ€è¦æœ€å¤§åŒ–çš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œç”±äºè®­ç»ƒé›†æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„ï¼‰</li>
<li>å³å¼æ˜¯ç”±ç‰¹å¾æå– / è®­ç»ƒ çš„è¾“å‡ºæ„æˆçš„ï¼š
<ul>
<li><span class="math inline">\(p(\pmb{x}_m|k,n)\)</span>æ˜¯é«˜æ–¯æ··åˆä½“ï¼Œé«˜æ–¯åˆ†å¸ƒçš„å‚æ•°ä¸€æ–¹é¢ç”±Set Transformerçš„OV / MLPçš„OPå¯¹åŸå‡å€¼è¿›è¡Œçº¿æ€§å˜æ¢ç»„æˆï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯MLPç›´æ¥è¾“å‡ºçš„æ–¹å·®å€¼ã€‚GMæ¨¡å‹å¯ä»¥æ˜¯å¤šä¸ªé«˜æ–¯æ··åˆåœ¨ä¸€èµ·å½¢æˆçš„ï¼Œæ‰€ä»¥å…¶å‚æ•°å¾ˆå¤šã€‚</li>
<li><span class="math inline">\(a_k,a_{k,n}\)</span>æ˜¯ç”±Set Transformer / MLPåˆ†åˆ«è¾“å‡ºçš„ã€‚</li>
</ul></li>
<li>é‚£ä¹ˆå³å¼ç”±äºæ˜¯ç½‘ç»œè¾“å‡ºçš„ç»“æœï¼Œæ˜¯å­˜åœ¨ç½‘ç»œå‚æ•°çš„ï¼Œå¯ä»¥å¯¹è¾“å‡ºè¿›è¡Œä¸€å®šçš„losså˜æ¢ä¹‹åï¼Œå¯¹å…¶æ±‚å¯¼ä»¥è°ƒæ•´ç½‘ç»œå‚æ•°ã€‚</li>
</ul>
<p>â€‹ part capsulesæ˜¯ä»€ä¹ˆï¼Ÿè¾“å…¥çš„åŸå§‹æ•°æ®å‘é‡å°±æ˜¯part capsuleï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå«part capsuleï¼Ÿå¯èƒ½åœ¨åç»­çš„è®ºæ–‡ä¸­ä¼šæåˆ°ï¼Œä¸‹é¢ç¬¬ä¸€æ¬¡æåˆ° part capsulesï¼Œä½†æ˜¯è²Œä¼¼æ˜¯ç”±åˆ«çš„ä¸œè¥¿æ¥â€œæ›¿ä»£â€çœŸæ­£çš„ part capsules æ¥è¿›è¡Œè¯´æ˜ï¼š</p>
<div class="note info"><p>All input points (which take the role of part capsules).</p>
</div>
<hr>
<h2 id="iii-pcae">III PCAE</h2>
<p>â€‹ PCAEç”¨äºè·å¾—part templatesï¼Œä¹Ÿå°±æ˜¯å­¦ä¹ æ¨¡æ¿ã€‚æ¯”å¦‚è¯´ï¼š</p>
<ul>
<li>æˆ‘ä»¬å…ˆé€šè¿‡encoderï¼ˆç»“æ„æ˜¯CNNç‰¹å¾æå– + Attention Poolingï¼Œæ‰€ä»¥Attentionæ€æƒ³ä½ è¿˜æ˜¯å¾—ç‹æƒææ˜ç™½å•Šï¼‰ä»å›¾åƒä¸­å­¦ä¹ ä¸€äº›è¡¨å¾ï¼ˆpart capsuleï¼‰å‡ºæ¥ï¼š
<ul>
<li>poseï¼Œæ¯”å¦‚æ—‹è½¬ / ç¼©æ”¾ / æ–œåˆ‡ / å¹³ç§»ï¼Œå‡ºç°çš„æ¦‚ç‡ï¼Œç‰¹å¾å‘é‡ï¼ˆ<strong><u>ç‹¬ç‰¹å±æ€§</u></strong>ï¼‰</li>
<li>ç‰¹å¾å‘é‡å¯ä»¥ç”¨äºæ¨æµ‹æ¨¡æ¿çš„é¢œè‰²ç­‰ç­‰æŠ½è±¡ä¿¡æ¯ï¼ˆMLPï¼‰ï¼Œæ¯”å¦‚ä»ç‰¹å¾å‘é‡ä¸­ï¼Œç›´æ¥è·å¾—æ¨¡æ¿è¾“å‡ºçš„ä¸‰é€šé“å¼ºåº¦ï¼ˆä¹Ÿå°±æ˜¯æ¨¡æ¿å›¾åƒæœ¬èº«çš„å€¼ï¼‰</li>
<li>å¾—åˆ°æ¨¡æ¿ä¹‹åï¼Œé€šè¿‡poseè¿›è¡Œä»¿å°„å˜æ¢</li>
<li>æ³¨æ„æ¨¡æ¿æœ¬èº«ä¼šæºå¸¦ä¸€ä¸ªalphaé€šé“ï¼Œç›¸å½“äºæˆ‘ä»¬æPSçš„æ—¶å€™ï¼Œä¸ºäº†ä½¿å›¾æŠ¹æ›´åŠ çœŸå®ï¼Œè°ƒæ•´ç”»ç¬”é€æ˜åº¦ï¼Œå…è®¸ä¸åŒçš„templateså åœ¨ä¸€èµ·ã€‚</li>
<li>å›¾åƒä¸Šæ¯ä¸€ç‚¹çš„è¾“å‡ºï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸åŒçš„partæŒ‰ç…§æ¦‚ç‡ + alphaé€šé“ç»“åˆå¾—åˆ°çš„ï¼ˆç›¸å½“äºä¸€ä¸ªdecoderæ“ä½œï¼‰ï¼Œä½¿ä¹‹ä¸åŸå›¾æ¥è¿‘ï¼Œæˆ–è€…å¯ä»¥è¯´æˆæ˜¯ï¼šå¯¹åŸå›¾çš„æå¤§ä¼¼ç„¶ä¼°è®¡ã€‚</li>
</ul></li>
</ul>
<p>â€‹ é‚£ä¹ˆä¸€å¥—æµç¨‹ä¸‹æ¥ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¦å¾—åˆ°æ˜¯ä¸€ä¸ªå¯ä»¥ç”Ÿæˆpart capsuleçš„auto encoderï¼Œä¹‹åçš„decoderå±‚ä¸ªäººè®¤ä¸ºï¼šåªæ˜¯ç”¨äºè®¡ç®—lossæˆ–è€…äº§ç”Ÿä¸€ä¸ªpart capsuleç”Ÿæˆå¥½åçš„evaluationæ–¹æ³•ã€‚ä»¥ä¸Šçš„æ–‡å­—å™è¿°éƒ¨åˆ†å·²ç»æŠŠPCAEçš„æ€æƒ³æ¦‚æ‹¬äº†ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸ªäººå¼€å§‹çš„ç†è§£ï¼Œå…¶ä¸­å­˜åœ¨ä¸€äº›åå·®ï¼š</p>
<div class="note warning"><p>æ­¤è®ºæ–‡ä¸­çš„Templateä¸æ˜¯å­¦å‡ºæ¥çš„ï¼Ÿä½¿ç”¨çš„æ˜¯Fixed templatesï¼Ÿï¼ˆ4é€šé“ï¼‰</p>
</div>
<p>â€‹ å°±æ˜¯è¯´æˆ‘å¯¹ç°æœ‰çš„part templatesï¼Œå­¦ä¹ å˜æ¢ï¼ˆposeï¼‰ï¼Œç‹¬æœ‰ç‰¹å¾ï¼ˆæ¯”å¦‚MLPè¾“å‡ºé¢œè‰²ï¼‰ï¼Œå‡ºç°æ¦‚ç‡ã€‚è™½ç„¶æˆ‘æ„Ÿè§‰è®ºæ–‡çš„è¿™ä¸‰å¥è¯æœ‰ç‚¹å†²çªï¼š</p>
<blockquote>
<p>I. while the decoder <strong><u>learns an image template</u></strong> <span class="math inline">\(T_m\)</span> for each part</p>
<ol start="2" type="I">
<li><p>SCAE under-performs on CIFAR10, which could be because of using <strong><u>fixed templates</u></strong>, which are not expressive enough to model real data</p></li>
<li><p>Training the PCAE results in <strong><u>learning templates</u></strong> for object parts</p></li>
</ol>
</blockquote>
<p>â€‹ æ‰€ä»¥å¼€å§‹æ—¶<strong><u>æ™•äº†</u></strong>ï¼Œåˆ°åº•æ˜¯å­¦å‡ºæ¥çš„è¿˜æ˜¯ç»™å®šçš„ï¼Ÿä¸ªäººæ„Ÿè§‰å­¦å‡ºæ¥çš„templatesè‚¯å®šæ˜¯æ›´åŠ ä¸é”™çš„ï¼ˆåªè¦å­¦å¾—å¥½å°±è¡Œï¼Œä½œè€…è‡ªå·±ä¹Ÿæ‰¿è®¤ï¼‰ã€‚</p>
<hr>
<h2 id="iv.-ocae">IV. OCAE</h2>
<h3 id="ocaeä½œç”¨">4.1 OCAEä½œç”¨</h3>
<p>â€‹ OCAEï¼šé€šè¿‡å·²ç»å­¦ä¹ åˆ°çš„part capsuleå»ç»„æˆobjectï¼ˆè¿™ä¸ªå’ŒPCAEçš„decoderåŒºåˆ«åœ¨å“ªï¼Ÿï¼‰ã€‚OCAEä¸ä¹‹å‰çš„CCAEå¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå—åˆ°äº†æ¥è‡ªpart capsuleçš„æ¦‚ç‡å½±å“ï¼š</p>
<p>â€‹ OCAEä¸CCAEç»“æ„ç±»ä¼¼ï¼Œä¹Ÿå­˜åœ¨Set Transformerçš„encoderï¼Œé‚£ä¹ˆpart capsulesè¾“å‡ºçš„æ¦‚ç‡ä¼šå½±å“encoderï¼Œä½¿å¾—Transformerå¿½ç•¥ä¸€äº›æ²¡æœ‰å‡ºç°çš„è¾“å…¥ï¼ˆæˆ–è€…è¯´partï¼‰ã€‚part capsulesè¾“å‡ºçš„æ¦‚ç‡ä¼šä½¿å¾—log likelihoodï¼ˆåœ¨MLEè¿‡ç¨‹ä¸­ï¼‰è¿›è¡Œå¹‚åŠ æƒï¼Œä½¿å¾—æ¦‚ç‡å°è€…é€ æˆçš„å½±å“å°</p>
<p>â€‹ ä¸ªäººæ„Ÿè§‰ï¼Œç”±äºOCAEç»“æ„ä¸Šå¾ˆç±»ä¼¼CCAEï¼ŒCCAEçš„è¾“å…¥æ˜¯ç®€å•çš„æ˜Ÿæ˜Ÿç‚¹ï¼Œé‚£ä¹ˆOCAEåº”è¯¥æ˜¯CCAEçš„ä¸€èˆ¬åŒ–ï¼š</p>
<blockquote>
<p>We first encode all input points (which take the role of part capsules)</p>
</blockquote>
<p>â€‹ æ‰€ä»¥è¿™é‡Œè¯´çš„å°±æ˜¯è¿™ä¸ªæ„æ€ï¼ŒCCAEæ˜¯ï¼š</p>
<ul>
<li>è¾“å…¥æ˜¯ç®€å•ç‚¹è€Œépart capsulesçš„OCAE</li>
<li>ä¸€äº›part capsule æ¦‚ç‡åŠ æƒä¸å­˜åœ¨çš„OCAE</li>
</ul>
<p>â€‹ CCAEæœ€åæ±‚å‡ºäº†part capsuleçš„ä¼¼ç„¶ï¼ˆä½œä¸ºMLEçš„ä¼˜åŒ–ç›®æ ‡ï¼‰ï¼Œè€ŒPCAEè‡ªå·±ä¹Ÿæœ‰å…³äºè‡ªå·±ç”Ÿæˆçš„part capsuleçš„ä¼¼ç„¶ã€‚</p>
<h3 id="ocae-ccae-è”ç³»è°ˆ">4.2 OCAE / CCAE è”ç³»è°ˆ</h3>
<p>â€‹ CCAEéƒ¨åˆ†ï¼Œä½œè€…å·²ç»è¯´äº†ï¼ŒCCAEçš„è¾“å…¥æ˜¯ç®€å•çš„æ˜Ÿåº§ç‚¹ã€‚è€Œä¸€èˆ¬åŒ–çš„OCAEï¼Œè¾“å…¥æ˜¯ä¸Šå±‚PCAEçš„part capsuleè¾“å‡ºï¼š</p>
<blockquote>
<p>In the <strong><u>first stage</u></strong>, the model predicts presences and poses of part templates directly from the image and tries to reconstruct the image by appropriately arranging the templates. In the <strong><u>second stage</u></strong>, SCAE predicts parameters of a few object capsules, which are then used to reconstruct part poses. ---<em>From Abstract</em></p>
</blockquote>
<p>â€‹ ä¸ªäººçš„ç†è§£å°±æ˜¯ï¼šPCAEä¸ºfirst stageï¼Œå…¶ç›®çš„æ˜¯å¾—åˆ°templatesï¼Œå­¦ä¹ templatesçš„ç›®æ ‡å‡½æ•°é€šè¿‡<em>"reconstruct the image"</em>æ¥å®Œæˆã€‚OCAEå°±æ˜¯æ¥æ”¶stage Iè¾“å‡ºçš„second stageï¼Œé€šè¿‡å­¦ä¹ objectåˆæ¥åæ¨part poseï¼Ÿ</p>
<p>â€‹ <strong><u>æ‰€ä»¥æ˜ç¡®ç›®çš„æ˜¯å¤šä¹ˆé‡è¦ï¼</u></strong>PCAEå¹¶æ²¡æœ‰å¾—åˆ°ç”¨äºMLEçš„log likelihoodï¼Œè®ºæ–‡ä¸­çš„å…¬å¼(9),(10)éƒ½æ˜¯ä¸ºäº†æ„å»ºPCAEçš„lossï¼ˆé‡æ„å›¾åƒçš„é‡æ„lossï¼‰ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ™®é€šçš„CNNåˆ†ç±»ç½‘ç»œï¼Œå…¶è¾“å‡ºç»“æ„å¯ä»¥ç”¨äºç›´æ¥è®¡ç®—lossï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ä¹Ÿå°±æ˜¯å…¶è¾“å‡ºç»“æœ</li>
<li>è€ŒPCAEï¼Œè¾“å‡ºç»“æœéœ€è¦ç»è¿‡ä¸€å®šå˜æ¢ï¼ˆreconstructed imageï¼‰ï¼Œæ‰èƒ½ç”¨äºæ„å»ºlossï¼Œè€Œç”¨äºæ„å»ºlossçš„éƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„é‚£éƒ¨åˆ†ã€‚PCAEçš„ç›®çš„æ˜¯è·å¾—ä¸€ä¸ªå¥½çš„image templateã€‚</li>
<li>ä¹‹å‰çš„éƒ¨åˆ†å·²ç»è¯´è¿‡äº†ï¼ŒCCAEï¼ˆç‰¹æ®ŠåŒ–çš„OCAEï¼‰ï¼š
<ul>
<li>é¦–å…ˆç»è¿‡Set Transformerå­¦ä¹ Kä¸ªobject capsulesã€‚</li>
<li>æ¯ä¸ªobject capsuleéƒ½ä¼šä½¿ç”¨MLPï¼ˆMä¸ªMLPï¼‰ï¼Œå­¦å‡ºç»„æˆè¿™ä¸ªobjectçš„Mä¸ªpartï¼Œä½†è¿™ä¸ªå­¦ä¹ è¿‡ç¨‹ä¸æ¶‰åŠåˆ°å…·ä½“çš„part capsuleè¾“å‡ºï¼Œè¾“å‡ºçš„æ˜¯ï¼šOPï¼Œæ¡ä»¶æ¦‚ç‡ä»¥åŠåæ–¹å·®ï¼Œç”¨äºè·å¾—GMMçš„åˆ†å¸ƒ</li>
</ul></li>
</ul>
<h3 id="ocaeçš„ä½œç”¨">4.3 OCAEçš„ä½œç”¨</h3>
<p>â€‹ ä¸ºä»€ä¹ˆOCAEåˆè¦é‡æ„partï¼Ÿå®ƒå…·ä½“é‡æ„äº†partçš„ä»€ä¹ˆéƒ¨åˆ†ï¼Ÿè¾¾åˆ°äº†ä»€ä¹ˆæ•ˆæœï¼Ÿè¿™æ˜¯æœ¬ç¯‡è®ºæ–‡çš„ä¸€ä¸ªé‡ç‚¹é—®é¢˜ï¼Œä½œè€…åœ¨ä¸€è¡Œè„šæ³¨é‡Œè¿™ä¹ˆè¯´ï¼š</p>
<blockquote>
<p>Discovered objects are <em>not</em> used top-down to refine the presences or poses of the parts during inference. However, the derivatives backpropagated via OCAE <strong><u>refine the lower-level encoder</u></strong> network that infers the parts.</p>
</blockquote>
<p>â€‹ å¯èƒ½å¯ä»¥è¿™ä¹ˆç†è§£ï¼š</p>
<ul>
<li>PCAEå­¦å‡ºæ¥çš„part capsulesï¼Œéœ€è¦ç»è¿‡æ£€éªŒã€‚è¿™æ ·çš„partç»„æˆobjectåˆ°åº•åˆä¸åˆé€‚ï¼Ÿè¿™ç§åˆé€‚åº¦é€šè¿‡likelihoodæ¥è¡¡é‡ã€‚</li>
<li>å¦‚æœè¯´ï¼Œpart capsulesç›´æ¥é‡å»ºå›¾åƒï¼Œæ˜¯ä¸€ç§ç›´æ¥çš„å…·ä½“çš„metricsï¼ŒOCAEå¯¹åº”çš„likelihoodå°±æ˜¯æŠ½è±¡çš„metricsã€‚å¦‚æœè¦ç”¨æå¤§ä¼¼ç„¶çš„æ€æƒ³æ¥è§£é‡Šï¼š</li>
</ul>
<blockquote>
<p>It learns to discover <strong><u>further structure</u></strong> in previously identified parts.</p>
</blockquote>
<p>â€‹ æ­¤å¤„çš„è¡¡é‡metricsæ˜¯part likelihoodï¼Œæ˜¯é€šè¿‡ï¼š</p>
<ul>
<li>ä¸object capsulesæœ‰å…³çš„ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒï¼ˆæ¯”å¦‚CCAEä¸­çš„é«˜æ–¯æ··åˆåˆ†å¸ƒï¼‰ï¼Œä¸objectå­¦ä¹ è¿‡ç¨‹ä¸­çš„å…¶ä»–æ¦‚ç‡ç»„æˆï¼Œç›¸å½“äºæ˜¯ï¼šMLEåœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåªä¼˜åŒ–<span class="math inline">\(p(x|\theta)\)</span>çš„å‚æ•°<span class="math inline">\(\theta\)</span>éƒ¨åˆ†ï¼Œè€Œæ­¤å¤„ç”±BPï¼Œä¼šå°†MLEçš„â€œæŠ½æ ·â€<span class="math inline">\(x\)</span>ä¸€èµ·è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å¾—<span class="math inline">\(p(x|\theta)\)</span>æœ€å¤§ã€‚</li>
<li>è™½ç„¶æˆ‘æ„Ÿè§‰è¿™æ ·å°±ä¸æ˜¯MLEäº†ï¼Œä½†å¯èƒ½å¯ä»¥è¿™ä¹ˆç†è§£å§ï¼šæˆ‘å­¦ä¹ çš„åˆ†å¸ƒï¼Œå‚æ•°æ˜¯<span class="math inline">\(\theta\)</span>ï¼Œå·²ç»èƒ½å¾ˆå¥½åœ°è¡¨ç¤ºçœŸå®æƒ…å†µï¼ˆæ€»ä½“åˆ†å¸ƒï¼‰äº†ï¼Œè€ƒè™‘åˆ°æˆ‘å¦‚æ­¤å¼ºè€Œè¾“å…¥æœ‰ä¸€å®šå™ªå£°ï¼Œé‚£è¾“å…¥ä¹Ÿè¿›è¡Œä¸€å®šçš„ä¿®æ”¹å§ï¼Œå› ä¸ºå­¦åˆ°çš„åˆ†å¸ƒè§‰å¾—ä½ çš„è¾“å…¥æœ‰äº›é—®é¢˜ã€‚è¿™MLEå¯ä»¥è¯´æ˜¯å¾ˆå¦ç±»çš„äº†ã€‚</li>
<li>æ‰€ä»¥æ€»ç»“èµ·æ¥å°±æ˜¯ï¼šé€šè¿‡ä¸€å±‚æŠ½è±¡çš„å­¦ä¹ ï¼ŒMLEåŒæ—¶ä¼˜åŒ–object capsuleç”Ÿæˆç½‘ç»œå‚æ•°ï¼ˆ<span class="math inline">\(\theta\)</span>ï¼‰ä¹Ÿåè¿‡æ¥ä¼˜åŒ–è¾“å…¥ï¼ˆè¾“å…¥å°±æ˜¯part capsulesï¼‰</li>
</ul>
<hr>
<h2 id="v.-sparse-regularization">V. Sparse Regularization</h2>
<p>â€‹ è®ºæ–‡ä¸­è¯´ï¼Œç›´æ¥ä½¿ç”¨Capsulesç»“æ„ï¼Œå®¹æ˜“å¯¼è‡´ï¼š</p>
<ul>
<li>object capsulesæ»¥ç”¨ï¼Œå¯¼è‡´éš¾ä»¥è®­ç»ƒ + æ¨¡å‹æè¿°åŠ›ä¸‹é™ï¼ˆæ˜¾ç„¶ï¼Œæœ‰äº›objectä¸å­˜åœ¨äºä¸€äº›å›¾ç‰‡ä¸­ï¼Œä½†æ˜¯è¿˜è¦ç”¨å¯¹åº”objectå¼ºè¡Œè§£é‡Šï¼Œè¿™æ˜¯ä¸è¡Œçš„ï¼‰
<ul>
<li>ä¸ä¹‹ç›¸å¯¹çš„ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªå›¾åƒèƒ½æœ‰ç‰¹å®šçš„å°‘é‡object capsulesï¼ˆä»¥åŠç›¸åº”çš„part capsulesï¼‰æ¥æè¿°</li>
</ul></li>
<li>mode collapseï¼Œåªä½¿ç”¨ç‰¹å®šçš„ä¸€äº›objectï¼Œå‘ç”Ÿè¿‡æ‹Ÿåˆã€‚
<ul>
<li>ä¸ä¹‹ç›¸å¯¹çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹äºæ•´ä¸ªè®­ç»ƒé›†ï¼Œobject capsuleså°½é‡éƒ½èƒ½ç”¨ä¸Šï¼ˆå¦åˆ™ç›¸å½“äºæ˜¯å‡ºç°äº†è®­ç»ƒé›†labelåˆ†å¸ƒä¸å‡çš„æƒ…å†µï¼‰</li>
</ul></li>
</ul>
<p>â€‹ é‚£ä¹ˆï¼Œä½œè€…è®¾è®¡äº†ä¸¤ä¸ªæ­£åˆ™åŒ–é¡¹ï¼Œç”¨<strong><u>æœŸæœ›</u></strong>çš„æ€æƒ³å¾ˆå¥½ç†è§£äº†ï¼š</p>
<ul>
<li><span class="math inline">\(\bar{u}_k\)</span>æ˜¯ç¬¬kä¸ªobject capsuleçš„å‡ºç°æ¦‚ç‡æ€»å’Œï¼ˆå¯¹ä¸åŒçš„æ ·æœ¬ï¼‰ï¼š</li>
</ul>
<p><span class="math display">\[
\begin{align}
&amp; \bar{u}_k=\sum_{b=1}^M a_{b,k}^{\text{prior}} \label{uni_b}\\
&amp; \bar{u}_b=\sum_{k=1}^K a_{b,k}^{\text{prior}} \label{uni_k}\\
\end{align}
\]</span></p>
<p>â€‹ åˆ™æˆ‘ä»¬å¸Œæœ›ï¼Œä¸åŒçš„ç±»åˆ«èƒ½ç”¨ä¸Šå°½å¯èƒ½ä¸€æ ·æ•°é‡çš„object capsulesï¼Œå‡è®¾æœ‰Cç±»ï¼ŒKä¸ªobject capsulesï¼Œé‚£ä¹ˆæ¯ä¸€ç±»å¯ä»¥ç”¨ï¼š<span class="math inline">\(K/C\)</span>ä¸ªcapsulesæ¥æè¿°ã€‚è€Œç”±äºå¯¹äºKä¸ªcapsulesï¼Œæ¯ä¸ªå‡ºç°çš„æ¦‚ç‡æ˜¯<span class="math inline">\(a_k^{\text{prior}}\)</span>ï¼Œæ¯ä¸€ä¸ªcapsuleå‡ºç°çš„æœŸæœ›ï¼ˆå› ä¸ºæ˜¯ä¸¤ç‚¹åˆ†å¸ƒï¼‰å°±æ˜¯æ¦‚ç‡æœ¬èº«ï¼Œé‚£ä¹ˆæ ¹æ®æœŸæœ›çš„è¿ç®—ï¼Œä¸€ä¸ªminibatchå†…Bä¸ªè®­ç»ƒç”¨ä¾‹ï¼ŒæœŸæœ›capsuleæ•°é‡åº”è¯¥æ˜¯å…¬å¼<span class="math inline">\(\eqref{uni_b}\)</span>ã€‚åˆ™æˆ‘ä»¬ä»¤<span class="math inline">\(\bar{u}_k\leftrightarrow K/C\)</span>ä¸¤è€…è¶³å¤Ÿæ¥è¿‘å³å¯ã€‚</p>
<p>â€‹ å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼šæ¯ä¸ªç”¨ä¾‹èƒ½ä»…ç”¨éƒ¨åˆ†object capsulesæ¥æè¿°ã€‚å‡è®¾æ€»ä½“ä¸åŒclasså‡åŒ€åˆ†å¸ƒï¼Œé‚£ä¹ˆä¸€ä¸ªminibatchå†…éƒ¨ï¼Œæ¯ä¸ªç±»åˆ«æœ‰<span class="math inline">\(B/C\)</span>ç±»ï¼Œé‚£ä¹ˆæ¯ä¸ªç”¨ä¾‹object capsulesçš„æœŸæœ›å®é™…ä¸Šå°±æ˜¯å…¬å¼<span class="math inline">\(\eqref{uni_k}\)</span>å®šä¹‰çš„æ¦‚ç‡å’Œï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°è®ºæ–‡ä¸­çš„ç¬¬ä¸€ä¸ªç¨€ç–æ€§å…ˆéªŒã€‚</p>
<p>â€‹ åéªŒç¨€ç–æ€§å¾ˆå¥½ç†è§£ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯LDAæ€æƒ³ï¼šç±»å†…ç†µæœ€å°åŒ–ï¼Œç±»é—´ç†µæœ€å¤§åŒ–ï¼ˆä¹Ÿå³ç±»å†…çš„åéªŒåˆ†å¸ƒè¶‹äºä¸€è‡´ï¼Œç±»é—´è¶‹äºä¸åŒï¼‰ã€‚</p>
<hr>
<h2 id="todos">TODOs</h2>
<p>â€‹ æœ¬è®ºæ–‡çœ‹ç¬¬ä¸€éä¹‹åï¼Œæ„Ÿè§‰å®ç°éƒ¨åˆ†å¾ˆæ¨¡ç³Šï¼Œè®ºæ–‡å›¾6æ„Ÿè§‰å¥½åƒä¹Ÿéå¸¸ç²—ç•¥ï¼Œå‰é¢çš„Attentionæœºåˆ¶ä¹Ÿæ²¡æœ‰ç‰¹åˆ«ä½“ç°ï¼ˆåªåœ¨Part Capsulesåˆ°Object Capsuleæ—¶æœ‰ï¼‰ï¼Œä½†æ˜¯å‰é¢æ‰€è¯´çš„ Part Capsulesç‰¹å¾æå–éƒ¨åˆ†åº”è¯¥ä¹ŸåŒ…æ‹¬äº†Attention-based poolingã€‚æ¢¯åº¦é˜»æ–­æœºåˆ¶ä¹Ÿè®©æˆ‘è§‰å¾—æœ‰ç‚¹å¥‡æ€ªï¼Œtemplatesæ–¹é¢ä¹Ÿæœ‰ç›¸å…³é—®é¢˜æ²¡ç†è§£ã€‚é‚£ä¹ˆåœ¨è¿‡æ®µæ—¶é—´é‡è¯»è¿™ç¯‡è®ºæ–‡æ—¶ï¼Œå¸Œæœ›èƒ½å¤Ÿåœ¨è¿™å‡ ä¸ªé—®é¢˜ä¸Šå¾—åˆ°æ›´å¥½çš„ç†è§£ï¼š</p>
<details class="note primary"><summary><p>éœ€è¦è¿›ä¸€æ­¥ç†è§£çš„é—®é¢˜ä»¬ï¼š</p>
</summary>
<ul>
<li><p>Attentionéƒ½åœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨åˆ°äº†ï¼Ÿä¸ºä»€ä¹ˆschematicå›¾ä¸­çœ‹èµ·æ¥åªæœ‰ä¸€å¤„ï¼Ÿ</p>
<ul>
<li>ä¸ªäººè®¤ä¸ºåªæ˜¯æ²¡å†™å‡ºæ¥ç½¢äº†ï¼Œåªè¦æ˜¯capsule autoencoderså°±é€ƒä¸å¼€attentionæœºåˆ¶ï¼Œå†…éƒ¨ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼CCAEçš„ï¼ˆattention + MLPï¼‰å®ç°ï¼Œå½“ç„¶å¯¹äºpart capsulesæ¥è¯´ï¼Œå¯èƒ½æ›´åŠ å¤æ‚ã€‚</li>
</ul></li>
<li><p>Capsuleåœ¨schematicå›¾é‡Œé¢æ˜¯è¾“å‡ºè¿˜æ˜¯ç½‘ç»œå±‚ï¼Ÿä¸ªäººçš„æ„Ÿè§‰åº”è¯¥æ˜¯ç½‘ç»œå±‚ï¼ŒPart Capsuleä¹‹ä¸Šè¿˜stackäº†å¾ˆå¤šä¸ªObject Capsulesï¼Œä½†æ˜¯å…·ä½“ç»“æ„ä¸ºä½•ï¼Ÿ</p></li>
<li><p>Templatesä¸ºä»€ä¹ˆæ²¡æœ‰æ¥è‡ªCNNæˆ–è€…Part Capsulesçš„æ¢¯åº¦æµï¼Ÿ</p>
<ul>
<li>ä¸ªäººæ„Ÿè§‰ï¼šTransformed templateså¯ä»¥ç»„æˆå›¾åƒï¼Œè€Œç”±äºcapsulesæºå¸¦transformationä¿¡æ¯ï¼Œtemplatesåº”è¯¥å¯ä»¥ç›´æ¥å»transformå¾—åˆ°ï¼Œä½†æ˜¯ä¸ºä½•templatesåˆ° tf templatesä¹Ÿæœ‰æ¢¯åº¦ï¼Ÿ</li>
<li>æ—¢ç„¶Templatesè¢«æ ‡æ³¨ä¸ºTrainable variablesï¼Œä¸ºä»€ä¹ˆè¯´templatesæ˜¯fixedçš„ï¼Ÿ</li>
<li>Templateçš„coloræ˜¯å­¦å‡ºæ¥çš„ï¼Œè€Œcolorå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸‰é€šé“çš„å›¾åƒï¼Œé‚£ä¹ˆtemplatesåœ¨å›¾åƒä¸Šçš„å€¼ä¸ä¹Ÿå°±æ˜¯å­¦å‡ºæ¥çš„äº†å—ï¼Ÿ</li>
</ul></li>
<li><p>Fixed Object-Part Relationsæ˜¯ä»€ä¹ˆï¼Ÿåœ¨å“ªé‡Œèµ·ä½œç”¨ï¼Ÿ</p></li>
<li><p>PCAE / OCAEçš„ä½œç”¨ï¼Œè™½ç„¶ç°åœ¨æ„Ÿè§‰è‡ªå·±æ‡‚äº†ï¼Œä½†æ˜¯æ€»æœ‰ç§è¯´ä¸ä¸Šæ¥çš„â€œä¸é€å½»æ„Ÿâ€ã€‚</p></li>
</ul>

</details>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯¡å¼‚bugèƒŒåçš„ä¸€äº›çŸ¥è¯†</title>
    <url>/2021/08/28/%E8%AF%A1%E5%BC%82bug%E8%83%8C%E5%90%8E%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h1 id="untitled-no.1">Untitled-NO.1</h1>
<hr>
<p>â€‹ åœ¨æ„å»º2Dæ¿€å…‰é›·è¾¾æ¨¡æ‹Ÿå™¨çš„æ—¶å€™ï¼Œåœ¨æŸä¸ªè‡ªå®šä¹‰åœ°å›¾ä¸­ç¢°ä¸Šä¸€ä¸ªå¥‡æ€ªçš„bugã€‚å½“ç„¶ï¼Œæˆ‘ä»ç°åœ¨å®Œå…¨å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜çš„è§’åº¦å‡ºå‘ï¼Œè¿™ä¸ªbugä¸€ç‚¹ä¹Ÿä¸å¥‡æ€ªï¼Œåå€’æ˜¯è­¦ç¤ºæˆ‘è¦å¤šæŸ¥cppreferenceï¼Œä½¿ç”¨ä¸€ä¸ªSTLæä¾›çš„å·¥å…·å°±è¦çœ‹ä¸€ä»½æ–‡æ¡£ã€‚</p>
<center>
<a class="btn" href="https://en.cppreference.com/w/"><i class="fa fa-circle-notch"></i>CPP Reference</a>
</center>
<span id="more"></span>
<hr>
<h2 id="bug-è¡¨ç°">Bug è¡¨ç°</h2>
<p>â€‹ é¦–å…ˆæˆ‘ä»¬å£°æ˜ä¸€äº›è®°å·ï¼š</p>
<ul>
<li><code>A</code> æ˜¯ä¸€ä¸ªclassï¼Œä¸ä¹‹å¯¹åº”çš„å®¹å™¨æ˜¯std::vector&lt;A&gt;</li>
<li>func æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¤§æ¦‚é•¿è¿™æ ·ï¼š<code>void func(const A&amp; a, std::vector&lt;A&gt;&amp; arr)</code>ã€‚ä¹Ÿå°±æ˜¯ï¼Œä¼ å…¥ä¸€ä¸ªAçš„å¸¸å¼•ç”¨ï¼Œå¹¶ä¸”ä¼ å…¥ä¸€ä¸ªAçš„å®¹å™¨çš„å¼•ç”¨ã€‚</li>
</ul>
<p>â€‹ funcçš„è¡Œä¸ºæ˜¯ï¼šæ ¹æ®aï¼Œè¿›è¡Œè®¡ç®—ï¼Œæœ‰å¯èƒ½å¾€arrå°¾éƒ¨pushæ–°çš„Aå®ä¾‹ã€‚açš„æ¥æºæ˜¯ï¼šaæ˜¯ä¸€ä¸ªå¸¸å¼•ç”¨ï¼Œä½†æ˜¯æ˜¯è¿™æ ·åœ¨å¤–éƒ¨å®šä¹‰çš„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">A&amp; a_ref = arr[id];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; arr.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">func</span>(a, arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ forå¾ªç¯å¤–éƒ¨çš„ï¼Œå¯¹arrè¿™ä¸ªvectorå†…æŸä¸€å·²ç»å­˜åœ¨å…ƒç´ çš„å¼•ç”¨ã€‚ä¹‹åï¼Œå°†å…¶ä¼ å…¥funcä¸­ï¼Œéšå¼è½¬æ¢ä¸ºå¸¸å¼•ç”¨ã€‚è¿™å®é™…ä¸Šå¯¹åº”äº†æˆ‘ä»£ç ä¸­çš„ï¼šé˜´å½±åœ¨ç‰©ä½“å†…éƒ¨çš„æŠ•å½±ã€‚æ¯”å¦‚ä¸€ä¸ªobjectï¼Œéœ€è¦å…ˆè®¡ç®—å†…éƒ¨çš„æœ‰æ•ˆé®æŒ¡è¾¹å¦‚ä½•è¢«å†…éƒ¨å…¶ä»–è¾¹é®æŒ¡ã€‚äºæ˜¯Aå°±ç›¸å½“äºæ˜¯ é®æŒ¡è¾¹classç±»å‹ï¼Œä»¥ä¸Šçš„ä»£ç å°±å¯ä»¥è®¤ä¸ºæ˜¯ï¼ša_refæ˜¯å½“å‰è¿›è¡ŒæŠ•å½±çš„è¾¹ï¼Œarrä¸­ä¿å­˜äº†è¿™ä¸ªobjectçš„æ‰€æœ‰é®æŒ¡è¾¹ï¼Œä½¿ç”¨funcæ¥åˆ¤å®šaæ˜¯å¦é®æŒ¡æˆ–è€…å¦‚ä½•é®æŒ¡å…¶ä»–é®æŒ¡è¾¹ã€‚è§<a href="https://github.com/Enigmatisms/LiDARSim2D/blob/master/src/lidar_sim/src/Object.cc">Enigmatisms/LiDAR2DSimğŸ”—</a>å®šä¹‰çš„å‡½æ•°<code>internalOcclusion</code>ã€‚</p>
<p>â€‹ äºæ˜¯æˆ‘å¾—åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„ç»“æœï¼š</p>
<p><img src="/2021/08/28/%E8%AF%A1%E5%BC%82bug%E8%83%8C%E5%90%8E%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86/2.png"></p>
<center>
Figure 1. GDBè°ƒè¯•ï¼ŒprojectEdge2Edgeçš„è¾“å…¥æœ‰é—®é¢˜
</center>
<p>â€‹ å…¶ä¸­projectEdge2Edgeå‡½æ•°å°±æ˜¯funcï¼Œå…¶ä¸­å‚æ•°srcï¼ˆæ˜¯ä¸€ä¸ªç»§æ‰¿äº†<code>std::vector&lt;Eigen::Vector2d&gt;</code>çš„classï¼‰å°±æ˜¯ç±»å‹Aã€‚srcçš„å†…å®¹å‡ºé”™äº†ã€‚</p>
<p>â€‹ å½“ç„¶è¿™ä¸ªé—®é¢˜çš„å®šä½è´¹äº†å¥½é˜µå­gdbï¼Œæ‰“conditional breakpointæ‰æŸ¥åˆ°ï¼ˆä¸å¾—ä¸å¹ä¸€æ³¢vscodeçš„å†…ç½®è°ƒè¯•ï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œsrcï¼ˆä¸€æ¡æŠ•å½±è¾¹ï¼‰çš„ç¬¬ä¸€ä¸ªç‚¹ï¼ˆ<code>Eigen::Vector2d</code>ï¼‰å€¼å˜å¾—å¥‡æ€ªï¼ˆå¾ˆå°ï¼Œä¸åº”è¯¥æœ‰ï¼‰ã€‚æˆ‘é¦–å…ˆå°±çŒœæµ‹æ˜¯å¼•ç”¨å¤±æ•ˆäº†ï¼ˆåºŸè¯ï¼‰ï¼Œæ­¤åçŒœæµ‹ å¯èƒ½æ˜¯push_backï¼ˆåœ¨breakEdgeä¸­è¿›è¡Œäº†push_backï¼Œå¯ä»¥è¯´å¾ˆéšè”½äº†ï¼ŒbreakEdgeæ²¡æœ‰ç›´æ¥ä¼ å…¥srcï¼Œå¹¶ä¸”srcæ˜¯ä¸ªconstï¼Œè¦æ˜¯ä¹‹å‰æˆ‘æ˜¯ä¸ä¼šæƒ³åˆ°å¼•ç”¨å¤±æ•ˆçš„ï¼‰å¯¼è‡´äº†å¼•ç”¨å¤±æ•ˆã€‚äºæ˜¯æˆ‘åšäº†ä¸ªè¿™æ ·çš„äº‹æƒ…ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (heap.<span class="built_in">empty</span>() == <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="type">size_t</span> top = heap.<span class="built_in">top</span>();</span><br><span class="line">    heap.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="comment">// Edge&amp; this_edge = edges[top] 	  (åˆ é™¤è¿™ä¸€è¡Œ)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; edges.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        Edge&amp; eg = edges[i];</span><br><span class="line">        Edge&amp; this_edge = edges[top] 	<span class="comment">//(åŠ å…¥è¿™ä¸€è¡Œ)</span></span><br><span class="line">        <span class="keyword">if</span> (eg.valid == <span class="literal">false</span> || &amp;eg == &amp;this_edge)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">projectEdge2Edge</span>(this_edge, obs, eg, heap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹ ç”±äºprojectEdge2Edgeï¼ˆfuncï¼‰åœ¨æ‰§è¡Œå®Œpush_backä¹‹åæ²¡æœ‰å¯¹srcï¼ˆaï¼‰æœ‰ä»»ä½•åç»­æ“ä½œï¼Œæ‰€ä»¥æˆ‘è®©å¼•ç”¨çš„è®¾ç½®åœ¨forå¾ªç¯ä¸­æ‰§è¡Œï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯æœ€æ–°çš„å¼•ç”¨ã€‚è¿™æ ·æ“ä½œä¹‹åæœç„¶å¥½äº†ã€‚ä½†æ˜¯ä¸æ¸…æ¥šåŸå› ã€‚</p>
<hr>
<h2 id="åŸå› ">åŸå› </h2>
<p>â€‹ æˆ‘å…ˆæ˜¯é—®äº†æˆ‘ä½¬å“¥ã€‚å¾—åˆ°çš„å›å¤æ˜¯ï¼š</p>
<blockquote>
<p>å¾€vector pushbackç¡®å®šå¯èƒ½å¯¼è‡´å®ƒçš„å¼•ç”¨å¤±æ•ˆï¼Œå› ä¸ºå®ƒå¯èƒ½resize é‚£å°±æ¢äº†å—å†…å­˜äº†</p>
</blockquote>
<p>â€‹ emmmã€‚å¾ˆæœ‰é“ç†ï¼Œæˆ‘åˆå»æŸ¥äº†ä¸€æ³¢èµ„æ–™[1]ï¼š</p>
<blockquote>
<p>If the new <a href="https://en.cppreference.com/w/cpp/container/vector/size">size()</a> is greater than <a href="https://en.cppreference.com/w/cpp/container/vector/capacity">capacity()</a> then all iterators and references (including the past-the-end iterator) are invalidated. Otherwise only the past-the-end iterator is invalidated.</p>
</blockquote>
<p>â€‹ è¿™ä¸ªcapacityæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿvectoræ˜¯åŠ¨æ€åˆ†é…å¤§å°çš„ï¼Œä¹‹å‰å­¦æ•°æ®ç»“æ„ä¸ç®—æ³•çš„æ—¶å€™ï¼Œå®šä¹‰åŠ¨æ€æ•°ç»„ï¼Œå½“æ—¶å°±éœ€è¦reallocæ“ä½œï¼Œæˆ‘å½“æ—¶çš„å®ç°æ˜¯æ¯æ¬¡å¾€èƒŒåå¤šåŠ 4ä¸ªç©ºä½™ä½ç½®ã€‚vectorä¹Ÿæ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œä»å®ƒçš„ç±»å‡½æ•°shrink_to_fit()å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ®è¯´æ˜¯ï¼šæ¯ä¸€æ¬¡reallocåˆ°å¤§äºå½“å‰å…ƒç´ ä¸ªæ•°çš„æœ€å°äºŒçš„å¹‚æ¬¡ã€‚é‚£ä¹ˆï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“vectoråŸæ¥çš„sizeæ˜¯4æ—¶ï¼Œpush_backä¼šå¯¼è‡´é‡æ–°åˆ†é…å†…å­˜ï¼ˆåº”è¯¥ä¹Ÿä¼´éšå†…å­˜çš„ç§»åŠ¨ï¼‰ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæ¯•ç«ŸåŠ å…¥åŸæ¥åˆ†é…çš„å†…å­˜å—æ˜¯ç»è¿‡äº†è¡¨æ˜ å°„çš„ï¼Œå¦‚æœè¿ç»­çš„ç©ºé—´ä¸è¶³ï¼Œæ ¹æ®vectorçš„åˆä¸€ç‰¹æ€§ï¼š</p>
<blockquote>
<p>The elements are stored contiguously, which means that elements can be accessed not only through iterators, but also <strong><u>using offsets to regular pointers to elements</u></strong>.</p>
</blockquote>
<p>â€‹ è¦ä¿è¯è¿ç»­çš„è¯ï¼Œåªèƒ½æ•´ä¸ªæŒªåŠ¨åŸæ¥å­˜å‚¨çš„ä¸œè¥¿ã€‚è€Œå¼•ç”¨ï¼Ÿè™½ç„¶æˆ‘ä¸€ç›´ä»¥ä¸ºï¼Œå¦‚æœæ˜¯æŒ‡é’ˆçš„è¯ï¼ŒæŒ‡å‘çš„åœ°å€å¯èƒ½æ²¡ä¸œè¥¿äº†å¯¼è‡´å‡ºé”™ï¼Œå¼•ç”¨åº”è¯¥å®‰å…¨çš„å¤šï¼Œåº”è¯¥å°±èƒ½å®Œå…¨æŒ‡å‘vectorä¸­çš„å…ƒç´ å§ã€‚å¯æƒœå¹¶ä¸æ˜¯ï¼Œstackoverflowä¸Šçš„ä½¬å“¥è¿™ä¹ˆè§£é‡Šï¼š</p>
<blockquote>
<ul>
<li>Reference, internally is <em>implemented</em> as a constant pointer which is automatically de-referenced.</li>
<li>The natural implementation of a reference is indeed a pointer.</li>
<li>Though a reference is in reality a pointer, but it shouldn't be used like a pointer but as an alias.</li>
</ul>
</blockquote>
<p>â€‹ å¸¸æŒ‡é’ˆæˆ–è€…æŒ‡é’ˆï¼Œç¼–è¯‘å™¨ä¸ºäº†ä½¿å¾—referenceçš„è®¾è®¡æ›´å®‰å…¨ï¼Œè¦æ±‚å¿…é¡»åˆå§‹åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘äº†ä¸€å—å…·ä½“çš„åœ°å€ï¼Œä½†æ˜¯ç”±äºreallocationï¼Œå¤±æ•ˆäº†ã€‚Nice.</p>
<hr>
<h2 id="æ„å¤–æ”¶è·">æ„å¤–æ”¶è·</h2>
<h3 id="è¿­ä»£å™¨å¤±æ•ˆ">1. è¿­ä»£å™¨å¤±æ•ˆ</h3>
<p><img src="/2021/08/28/%E8%AF%A1%E5%BC%82bug%E8%83%8C%E5%90%8E%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86/3.PNG"></p>
<center>
Figure 2. è¿­ä»£å™¨å¤±æ•ˆæƒ…å†µ
</center>
<p>â€‹ æˆ‘ä¹‹å‰è¿˜å†™å¸¦ä»£ç è¿˜æŠŠè¿­ä»£å™¨è£…åœ¨ä¸€ä¸ªå®¹å™¨é‡Œï¼ŒçŸ¥é“å¾ˆä¸ä¼˜é›…ï¼Œä½†ç°åœ¨çŸ¥é“é™¤äº†ä¸ä¼˜é›…ï¼Œè¿˜å¾ˆå±é™©ï¼ˆå¯Œè´µé™©ä¸­æ±‚ï¼ï¼ï¼‰ã€‚</p>
<h3 id="stdvectorbool">2. std::vector&lt;bool&gt;</h3>
<blockquote>
<p>std::vector&lt;bool&gt; is a possibly space-efficient specialization of std::vector for the type bool.</p>
</blockquote>
<p>â€‹ æœ€æœ‰æ„æ€çš„æ˜¯ï¼Œcppreferenceè¯´ï¼Œç©ºé—´èŠ‚çº¦çš„ç›®çš„å¯¼è‡´bool vectoråœ¨å†…å­˜ä¸­å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚</p>
<p>â€‹ å¹¶ä¸”std::vector&lt;bool&gt;æœ‰ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼ˆæœ‰åˆ«äºå…¶ä»–çš„vectorï¼‰ï¼Œå«åšflipï¼Œå¯ä»¥å–åå†…éƒ¨æ‰€æœ‰å…ƒç´ ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] https://en.cppreference.com/w/cpp/container/vector/push_back</p>
<p>[2] <a href="https://stackoverflow.com/questions/3954764/how-are-references-implemented-internally">How are references implemented internally?</a></p>
]]></content>
      <categories>
        <category>learning</category>
        <category>debugs</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>è´å¶æ–¯å­¦ä¹ çš„ç†è§£</title>
    <url>/2021/03/10/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AD%A6%E4%B9%A0%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="bayesian">Bayesian</h1>
<hr>
<h2 id="è´å¶æ–¯åˆ†ç±»å™¨">è´å¶æ–¯åˆ†ç±»å™¨</h2>
<p>â€‹ ä¸ªäººå¾ˆå–œæ¬¢è´å¶æ–¯å­¦æ´¾çš„ç†è®ºï¼Œæ„Ÿè§‰è´å¶æ–¯ç†è®ºéå¸¸å…·æœ‰ç¾æ„Ÿã€‚</p>
<p>â€‹ è´å¶æ–¯åˆ†ç±»å™¨æ˜¯å…¸å‹çš„ç”Ÿæˆå¼æ¨¡å‹ã€‚å¯¹äºåˆ†ç±»é—®é¢˜çš„æ¦‚ç‡å½¢å¼ï¼Œæœ‰<span class="math inline">\(P(c|x)\)</span>æ˜¯ç»™å®šç‰¹å¾æƒ…å†µä¸‹ï¼Œåˆ†ç±»ç»“æœä¸ºcçš„æ¦‚ç‡ï¼Œæ˜¾ç„¶è¿™æ˜¯æˆ‘ä»¬æƒ³çŸ¥é“çš„ï¼ˆè€Œåè¿‡æ¥<span class="math inline">\(P(x|c)\)</span>å¯èƒ½æ˜¯Encoderæ¨¡å‹æ‰€è®¨è®ºçš„ï¼‰ã€‚åˆ¤åˆ«å¼æ¨¡å‹ç›´æ¥å¯¹<span class="math inline">\(P(c|x)\)</span>è¿›è¡Œå»ºæ¨¡ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå†³ç­–æ ‘å§ã€‚å†³ç­–æ ‘æ ¹æ®xçš„ä¸åŒåˆ†é‡è¿›è¡Œåˆ’åˆ†ï¼Œæ¯å±‚é€‰å–ä¿¡æ¯å¢ç›Šæˆ–è€…åŸºå°¼æŒ‡æ•°æœ€å¤§çš„å±æ€§è¿›è¡Œåˆ†æ”¯ã€‚é‚£ä¹ˆå†³ç­–æ ‘è¿™ä¸ªåˆ¤åˆ«å¼æ¨¡å‹ï¼Œå…·ä½“æ˜¯å¦‚ä½•å¯¹<span class="math inline">\(P(c|x)\)</span>è¿›è¡Œå»ºæ¨¡çš„ï¼Ÿ</p>
<span id="more"></span>
<p>â€‹ ä¸ªäººçš„ç†è§£æ˜¯ï¼šå‡è®¾æ ·æœ¬ç‰¹å¾<span class="math inline">\(x=\{x_1,x_2,x_3,...,x_n\}\)</span>ï¼Œå…¶ä¸­ï¼Œ<span class="math inline">\(x_i\)</span>çš„ä¸‹æ ‡è¡¨ç¤ºåˆ†æ”¯é¡ºåºã€‚åœ¨æ ¹èŠ‚ç‚¹å¤„ï¼Œå‡è®¾åˆ†æ”¯åŸºäºç‰¹å¾åˆ†é‡<span class="math inline">\(x_1\)</span>ï¼Œé‚£ä¹ˆåœ¨æ ¹å‘ä¸‹ä¸€å±‚ï¼Œæ¦‚ç‡ä¼šæœ‰å¦‚ä¸‹å½¢å¼ï¼š <span class="math display">\[
P(c|x/\{x_1\},x_1=...)
\]</span> â€‹ ä¹Ÿå°±æ˜¯åŸºäº<span class="math inline">\(x_1\)</span>ç¡®å®šåçš„ç»“æœè¿›ä¸€æ­¥åˆ†æ”¯ï¼Œç›´åˆ°æ— æ³•åˆ†æ”¯ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´<span class="math inline">\(P(c|x)\)</span>ä¸­ï¼Œxçš„æ¯ä¸ªåˆ†é‡é€æ­¥ç¡®å®šï¼Œå¯¹åº”åˆ°å¶èŠ‚ç‚¹ä¸Šçš„<span class="math inline">\(P(c|x)\)</span>ä¹Ÿå°±ç¡®å®šäº†ã€‚</p>
<p>â€‹ è€Œç”Ÿæˆå¼æ¨¡å‹ï¼ˆæ¯”å¦‚è´å¶æ–¯ï¼‰ï¼Œå»ºæ¨¡çš„æ˜¯è”åˆåˆ†å¸ƒæˆ–è€…æ˜¯ä¼¼ç„¶ï¼š <span class="math display">\[
\begin{equation}\label{bayes}
P(c|x)=\frac{P(x,c)}{P(x)}=\frac{P(x|c)P(c)}{P(x)}
\end{equation}
\]</span> â€‹ P(c)å¯ç›´æ¥æ ¹æ®æ ·æœ¬ä¼°è®¡ï¼ˆæ ·æœ¬ä¸­åˆ†ç±»ä¸º<span class="math inline">\(c_i\)</span>çš„å æ¯”ï¼Œè¿‘ä¼¼ä¸ºå…ˆéªŒæ¦‚ç‡ï¼Œå•Šè´å¶æ–¯å­¦æ´¾ä¹Ÿç”¨é¢‘ç‡å­¦æ´¾çš„ç»“è®ºäº†ï¼Ÿï¼‰<span class="math inline">\(P(x)\)</span>ä¸ºå½’ä¸€åŒ–å¸¸æ•°ï¼Œæ— éœ€è®¨è®ºã€‚</p>
<p>â€‹ å…³äº<span class="math inline">\(P(c|x)\)</span>æˆ‘ä»¬è¦åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬åªå¸Œæœ›å°†å…¶è®¡ç®—å‡ºæ¥ï¼ˆä¼°è®¡å‡ºæ¥ï¼‰ï¼Œå°±å¯ä»¥æ ¹æ®ç‰¹å¾è®¡ç®—åˆ†ç±»æ¦‚ç‡äº†ã€‚é‚£ä¹ˆ<span class="math inline">\(P(c|x)\)</span>åˆ†å¸ƒçš„å‚æ•°å¯ä»¥é€šè¿‡ä¼˜åŒ–ä¼°è®¡<span class="math inline">\(P(x|c)\)</span>æ¥å®Œæˆï¼Œç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯è¿›è¡Œæå¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆå› ä¸º<span class="math inline">\(P(x|c)\)</span>æ˜¯ä¼¼ç„¶ï¼Œæ˜¯å¯ä»¥ä»æ ·æœ¬ä¸­ä¼°è®¡çš„ï¼‰</p>
<hr>
<h2 id="æœ´ç´ è´å¶æ–¯">æœ´ç´ è´å¶æ–¯</h2>
<h3 id="æœ€æœ´ç´ çš„ç‰ˆæœ¬">æœ€æœ´ç´ çš„ç‰ˆæœ¬</h3>
<p>â€‹ <span class="math inline">\(P(x|c)\)</span>å¥½æ±‚å—ï¼Ÿä¸å¥½æ±‚ï¼Œ<span class="math inline">\(P(x|c)\)</span>çš„æ„ä¹‰æ˜¯ï¼šç»™å®šåˆ†ç±»ä¸‹ï¼Œç‰¹å¾å–å€¼ä¸ºxçš„æ¦‚ç‡ã€‚é¦–å…ˆï¼Œæœ‰å¯èƒ½å¯¹åº”xæ ¹æœ¬æ²¡æœ‰åœ¨è®­ç»ƒé›†æ ·æœ¬ä¸­å‡ºç°ï¼Œå…¶æ¬¡ï¼Œå³ä½¿å‡ºç°ä¹Ÿå¯èƒ½å› ä¸ºç»„åˆçˆ†ç‚¸å¯¼è‡´å¯ç”¨æ ·æœ¬æ•°é‡å°‘åˆ°æ— æ³•æ­£ç¡®ç”¨äºä¼°è®¡ï¼Œå¦å¤–ä¹Ÿå¯èƒ½äº§ç”Ÿæ ·æœ¬æŸä¸ªå±æ€§å€¼ç¼ºå¤±çš„æƒ…å†µã€‚</p>
<div class="note info"><p><strong>æœ´ç´ è´å¶æ–¯è®¤ä¸º</strong></p>
<p>å‡è®¾æ ·æœ¬æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆ<span class="math inline">\(P(x|c)\)</span>å°±å¯ä»¥ç”±ç‹¬ç«‹æ¡ä»¶æ‹†å¼€</p>
</div>
<p><span class="math display">\[
\begin{equation}\label{naive}
P(x|c)=\prod_{i=1}^nP(x_i|c)P(c)
\end{equation}
\]</span> â€‹ è¿™å¥½å—ï¼Ÿå¾ˆå¥½ï¼Œå¯¹æŸä¸ªå±æ€§çš„åˆ†å¸ƒä¼°è®¡æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¹¶ä¸”æ ·æœ¬æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å……è¶³çš„ã€‚ä½†æ˜¯è¿™åˆä¸å¥½ï¼Œå› ä¸º <strong><u>é€šå¸¸å±æ€§ä¹‹é—´éƒ½ä¸ä¼šæœ‰å¤ªå¥½çš„ç‹¬ç«‹æ€§</u></strong>ï¼ˆä½†æ˜¯PCAä¹‹åå¯ä»¥ç”¨è´å¶æ–¯ï¼Œç”±äºPCAä¹‹åçš„ç‰¹å¾ä¸ç›¸å…³ï¼‰ã€‚ç”±äºè¿™ä¸ªå¼ºç‹¬ç«‹æ€§å‡è®¾ï¼Œæ‰€ä»¥è¿™ç§è´å¶æ–¯ç§°ä¸ºâ€œæœ´ç´ çš„ï¼ˆä½ ä»¬å•Šï¼Œnaiveï¼‰â€ã€‚</p>
<h3 id="ç‹¬ä¾èµ–ç‰ˆæœ¬">ç‹¬ä¾èµ–ç‰ˆæœ¬</h3>
<p>â€‹ ç”±äºæœ´ç´ è´å¶æ–¯ sometimes naiveï¼Œå¯¼è‡´ä½¿ç”¨è€…angryã€‚ä¸ºäº†å‡è½»è¿™ç§æ•ˆåº”ï¼Œé¦–å…ˆè¿›è¡Œåæ–¹å·®åˆ†æï¼Œæ‰¾åˆ°ä¸æ¯ä¸€ä¸ªå±æ€§å…³è”æ€§æœ€å¼ºçš„å¦ä¸€ä¸ªå±æ€§ï¼Œè®¨è®ºè”åˆåˆ†å¸ƒï¼š <span class="math display">\[
\begin{equation}\label{ode}
P(x|c) \propto P(c)\prod_{i=1}^nP(x_i|c,x_{i,k})=P(c)\prod_{i=1}^n \frac{P(x_i,x_{i,k}|c)}{P(x_{i,k}|c)}
\end{equation}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{ode}\)</span>æœ€å³éƒ¨åˆ†ä¸ªäººæ„Ÿè§‰å¥½åƒå¯ä»¥ç›´æ¥ä»æ ·æœ¬ä¸­æ¨å‡ºæ¥ï¼Œå¹¶ä¸”ä¸ä¼šé‡åˆ°ç»„åˆçˆ†ç‚¸æ•ˆåº”ï¼Œå¯¹ç‹¬ç«‹æ€§å‡è®¾æœ‰æ”¾æ¾ä½œç”¨ã€‚</p>
<h4 id="æ¡ä»¶äº’ä¿¡æ¯">æ¡ä»¶äº’ä¿¡æ¯</h4>
<p>â€‹ åœ¨<a href="https://enigmatisms.github.io/2021/03/02/%E7%BA%BF%E6%80%A7-%E6%A0%91%E5%9E%8B%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E7%BA%AF%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90/">[çº¿æ€§-æ ‘å‹åˆ†ç±»å™¨çš„çº¯ç†è®ºåˆ†æ]</a>ä¸­ï¼Œæåˆ°äº†äº’ä¿¡æ¯ï¼Œæ˜¯æŒ‡è”åˆåˆ†å¸ƒ<span class="math inline">\(P_{X,Y}\)</span>ä¸ç‹¬ç«‹å‡è®¾ä¸‹è¾¹ç¼˜åˆ†å¸ƒä¹˜ç§¯<span class="math inline">\(P_XP_Y\)</span>çš„KLæ•£åº¦ã€‚é‚£ä¹ˆæ¡ä»¶äº’ä¿¡æ¯å°±æ˜¯å¢åŠ äº†ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼š <span class="math display">\[
\begin{equation}\label{cmi}
I(x,y|c)=\int_y\int_x p(x,y|c)\log\frac{p(x,y|c)}{p(x|c)p(y|c)}
\end{equation}
\]</span> â€‹ æ¡ä»¶äº’ä¿¡æ¯å°±åˆ»ç”»äº†ç»™å®šæ¡ä»¶ï¼ˆåˆ†ç±»ä¸ºcï¼‰ä¸‹ï¼Œä¸¤ä¸ªå±æ€§ä¹‹é—´çš„å…³è”å…³ç³»ã€‚é‚£ä¹ˆç”ŸæˆODEç»“æ„å¯ä»¥ä»¥æ­¤ä¸ºæŒ‡å¯¼ã€‚</p>
<hr>
<h2 id="æœ€å°é£é™©è´å¶æ–¯å†³ç­–">æœ€å°é£é™©è´å¶æ–¯å†³ç­–</h2>
<p>â€‹ å®šä¹‰é£é™©çŸ©é˜µ<span class="math inline">\(\Lambda\)</span>: <span class="math display">\[
\begin{pmatrix}
\lambda_{11} &amp; \lambda_{12} &amp; ... &amp;\lambda_{1n} \\
\lambda_{21} &amp; \lambda_{22} &amp; ... &amp;\lambda_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\lambda_{n1} &amp; \lambda_{n2} &amp; ... &amp;\lambda_{nn} \\
\end{pmatrix}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(\lambda_{i,j}\)</span>è¡¨ç¤ºæœ¬èº«æ˜¯ç¬¬jç±»ï¼Œä½†æ˜¯åˆ†ç±»ç»“æœæ˜¯ç¬¬iç±»çš„é£é™©ã€‚ï¼ˆæ³¨æ„é¡ºåºå•Šï¼Œå› ä¸ºå†³ç­–è¡¨çš„æ¨ªè½´ä¸€èˆ¬å®šä¹‰ä¸ºå®é™…æƒ…å†µï¼Œè€Œçºµè½´ä¸ºå†³ç­–ï¼‰ã€‚é‚£ä¹ˆç»™å®šä¸€ä¸ªæ ·æœ¬xï¼Œè¿›è¡Œåˆ†ç±»å¾—åˆ°cï¼Œæ ¹æ®cè¿›è¡Œå†³ç­–<span class="math inline">\(\alpha\)</span>ï¼Œç”±æ­¤äº§ç”Ÿçš„æŸå¤±æ˜¯rï¼Œé‚£ä¹ˆï¼š <span class="math display">\[
\begin{align}
&amp; P(c_i|x)=\frac{P(x|c_i)P(c_i)}{\sum_{i=1}^nP(x|c_i)}\\
&amp; R(\alpha_i|x)=\sum_{j=1}^n\lambda_{i, j}P(c_i|x) \label{rsingle}\\
&amp; R_{total} = \sum_{x}R(\alpha(x)|x)    \label{rtotal} \\
&amp; E(R) =\sum_x R(\alpha(x)|x)P(x)
\end{align}
\]</span> â€‹ æˆ‘ä»¬å®é™…ä¸Šè¦æœ€å°åŒ–<span class="math inline">\(\eqref{rtotal}\)</span>ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬xï¼Œå…¶åˆ†ç±»å‡½æ•°<span class="math inline">\(\alpha(x)\)</span>éœ€è¦è®©çš„æ€»ä½“å†³ç­–é£é™©çš„æœŸæœ›æœ€ä½ï¼Œå› ä¸ºå®é™…ä¸Š<span class="math inline">\(R_{total}\)</span>çš„æŒ‡å¯¼æ„ä¹‰å¹¶ä¸å¤§ï¼Œå®ƒæ˜¯å±€é™äºè®­ç»ƒæ ·æœ¬çš„ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½ç‹¬ç«‹äºæ ·æœ¬å¾—åˆ°æ³›åŒ–èƒ½åŠ›ï¼Œé€šè¿‡ç»™ä¸åŒç‰¹å¾çš„æ ·æœ¬è¿›è¡ŒåŠ æƒï¼Œæ±‚å¾—æœŸæœ›ï¼ˆäº‹å®ä¸Šä¸å˜æˆæœŸæœ›ä¹Ÿæ²¡åŠæ³•è¿›è¡Œæ•°å€¼ä¸Šçš„ä¼°è®¡ï¼‰ã€‚ <span class="math display">\[
\begin{equation}\label{arg}
\alpha^*=\mathop{\text{argmin}}_\alpha E(R)\leftarrow\mathop{\text{argmin}}_{i=1,2...n}R(\alpha_i|x)
\end{equation}
\]</span> â€‹ æ¯ä¸ªæ ·æœ¬éƒ½èƒ½å¾—åˆ°æœ€ä¼˜çš„å†³ç­–æ—¶ï¼Œæ€»ä½“çœ‹èµ·æ¥å†³ç­–ç»“æœä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œåˆ™éœ€è¦é€‰æ‹©å†³ç­–é£é™©æœ€å°çš„åˆ†ç±»ç»“æœã€‚é‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼šä¼šä¸ä¼šå‡ºç°é€‰æ‹©çš„å†³ç­–å‡½æ•°<span class="math inline">\(\alpha(x)\)</span>å¯¹æŸäº›x'è€Œè¨€æ˜¯<span class="math inline">\(R(a(x&#39;)|x&#39;)\)</span>æœ€å°ï¼Œè€Œå¦ä¸€äº›å¹¶ä¸æ˜¯æœ€å°ï¼Œä½†æ€»çš„æœŸæœ›å´æ˜¯æœ€å°çš„æƒ…å†µï¼Ÿ<strong><u>å…¶å®ä¸ªäººè®¤ä¸ºè¿™æ˜¯æœ‰å¯èƒ½çš„</u></strong>ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯è§‰å¾—éœ€è¦ç¡®å®šä¸€ä¸‹ï¼Œä¹‹åé—®è€å¸ˆå§ã€‚æˆ‘çš„æƒ³æ³•æ˜¯ï¼šå¦‚æœå›ºå®šè®­ç»ƒé›†ï¼Œåªåœ¨è®­ç»ƒé›†ä¸Šè®¨è®ºï¼Œé‚£ä¹ˆç¡®å®æ˜¯æœ‰åŠæ³•è®©æ‰€æœ‰xçš„é£é™©æœ€å°çš„ï¼ˆ<strong><u>ç–¯ç‹‚è¿‡æ‹Ÿåˆï¼Œäº§ç”Ÿå¥‡å¼‚çš„åˆ†ç±»è¾¹ç•Œ</u></strong>ï¼‰ï¼Œä½†æ˜¯è¿™æœªå¿…æ˜¯å¯¹å…¨å±€éƒ½æœ€ä¼˜çš„ï¼Œåªæ˜¯åœ¨è®­ç»ƒé›†ä¸Šçš„é£é™©è¡¨ç°æœ€å°ã€‚</p>
<hr>
<h2 id="å‰å¸ƒæ–¯é‡‡æ ·">å‰å¸ƒæ–¯é‡‡æ ·</h2>
<p>â€‹ å‰å¸ƒæ–¯é‡‡æ ·ï¼ˆGibbs samplingï¼‰ä½œä¸ºä¸€ç§MCMCå»¶ä¼¸çš„éšæœºé‡‡æ ·æ–¹å¼ï¼ŒåŸºäºçš„ç†è®ºæ˜¯Markové“¾é€æ¸æ”¶æ•›åˆ°å¹³ç¨³åˆ†å¸ƒï¼ˆstationary distributionï¼‰æ—¶çš„æ€§è´¨ã€‚é’ˆå¯¹çš„é—®é¢˜æ˜¯ï¼š</p>
<div class="note info"><p>â€‹ å¯¹äºä¸€ä¸ªå¤šå…ƒåˆ†å¸ƒï¼Œè”åˆæ¦‚ç‡ä¸€èˆ¬éš¾ä»¥è·å¾—ï¼Œä½†å·²çŸ¥ä¸€äº›å˜é‡çš„æ¡ä»¶åˆ†å¸ƒæƒ…å†µä¸‹ï¼Œå¦‚ä½•é€šè¿‡é‡‡æ ·æ¥ä¼°è®¡è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Ÿ</p>
</div>
<p>â€‹ ä»è”åˆåˆ†å¸ƒé‡‡æ ·ç¡®å®æ˜¯å¾ˆéš¾çš„äº‹æƒ…ï¼Œå› ä¸ºè”åˆåˆ†å¸ƒç»¼åˆçš„ä¿¡æ¯æœ€å¤šã€‚é€šè¿‡è¾¹ç¼˜åŒ–æ“ä½œï¼Œå¯ä»¥å¾—åˆ°è¾¹ç¼˜åˆ†å¸ƒï¼Œé€šè¿‡è”åˆåˆ†å¸ƒå’Œè¾¹ç¼˜åˆ†å¸ƒå¯ä»¥å¾—åˆ°æ¡ä»¶åˆ†å¸ƒã€‚ä¹Ÿå³è”åˆåˆ†å¸ƒå·²ç»åŒ…å«äº†ä¸€ä¸ªå¤šå…ƒåˆ†å¸ƒçš„æ‰€æœ‰ä¿¡æ¯äº†ã€‚æ—¢ç„¶åŒ…å«çš„ä¿¡æ¯è¶Šå¤šï¼Œè·å–å¿…ç„¶ä¹Ÿå°±è¶Šå›°éš¾ã€‚å¯¹æ­¤ï¼ŒWikipedia[1]ä¹Ÿè¯´ï¼š</p>
<blockquote class="blockquote-center">
<p>The point of Gibbs sampling is that given a multivariate distribution it is simpler to sample from a conditional distribution than to marginalize by integrating over a joint distribution.</p>

</blockquote>
<h3 id="ç®€å•ç†è§£">ç®€å•ç†è§£</h3>
<p>â€‹ å‡è®¾å¯æ€œçš„å·æ€ªæœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€ï¼š</p>
<ul>
<li>å­¦ä¹ ç©ºé—´ï¼š<span class="math inline">\(X=\)</span> æ¦‚ç‡ï¼Œçº¿ä»£ï¼Œç¦»æ•£</li>
<li>è§‚æµ‹æ—¶é—´ï¼š$Y = $ ä¸Šåˆï¼Œä¸­åˆï¼Œä¸‹åˆ</li>
<li>çŠ¶æ€ç©ºé—´ï¼š<span class="math inline">\(Z=\)</span> é«˜æ•ˆï¼Œä¸€èˆ¬ï¼Œä¸æƒ³å­¦</li>
</ul>
<p>â€‹ å¯¹äºè”åˆåˆ†å¸ƒ<span class="math inline">\(P(X,Y,Z)\)</span>ï¼Œç›´æ¥è®¨è®ºæ˜¯æå…¶å¤æ‚çš„ã€‚ä½†æ˜¯æœ‰ä¸€äº›å…ˆéªŒçŸ¥è¯†å´æ¯”è¾ƒå¥½è·å¾—ï¼š</p>
<ul>
<li>å­¦ä¹ çš„å¯èƒ½ï¼š<span class="math inline">\(P(X|Y,Z)\)</span>ï¼šåœ¨ç»™å®šå­¦ä¹ çŠ¶æ€ä»¥åŠå½“å‰è§‚æµ‹æ—¶é—´æ—¶ï¼Œå·æ€ªå¯èƒ½å­¦ä»€ä¹ˆçš„åˆ†å¸ƒã€‚</li>
<li>è§‚æµ‹æ—¶é—´ï¼š<span class="math inline">\(P(Y|X,Z)\)</span>ï¼šå·²çŸ¥å½“å‰å·æ€ªçš„çŠ¶æ€ä»¥åŠtaåœ¨å­¦ä»€ä¹ˆï¼Œå¾—åˆ°å½“å‰æ—¶é—´çš„åˆ†å¸ƒã€‚</li>
<li>çŠ¶æ€æ¨æµ‹ï¼š<span class="math inline">\(P(Z|X,Y)\)</span>ï¼šå·²çŸ¥å½“å‰æ—¶é—´ä»¥åŠç§‘ç›®ï¼Œæ±‚å·æ€ªçš„å­¦ä¹ çŠ¶æ€ã€‚</li>
</ul>
<p>â€‹ ä»¥ä¸Šä¸‰ç§æ¡ä»¶æ¦‚ç‡éƒ½æ¯”è¾ƒå¥½è®¨è®ºï¼Œæ¯”å¦‚è§‚å¯ŸåŠå­¦æœŸè¯¥å·æ€ªçš„å­¦ä¹ ä¹ æƒ¯ï¼Œä¹Ÿå°±èƒ½æ€»ç»“å‡ºæ¥è§„å¾‹ï¼Œä½œä¸ºå…ˆéªŒçŸ¥è¯†ã€‚Gibbs samplingå°±æ˜¯åˆ©ç”¨Markové“¾ä»¥åŠè¿™å‡ ç§æ¡ä»¶åˆ†å¸ƒçš„å…³è”æ€§ï¼Œé€¼è¿‘è”åˆåˆ†å¸ƒçš„ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>è·å–ä¸€ä¸ªåˆå§‹çš„å˜é‡ï¼Œæ¯”å¦‚X = æ¦‚ç‡ï¼ŒY = ä¸­åˆï¼ŒZ = ä¸æƒ³å­¦ã€‚è¿™ä¸ªå˜é‡ä¸ä¸€å®šéœ€è¦æœ‰æ¥æºçš„ç†ç”±ã€‚å°†è¿™ä¸ªéšæœºåˆå§‹ç”Ÿæˆçš„çŠ¶æ€å˜é‡è®¾ä¸º<span class="math inline">\(S^0\)</span>ï¼ˆ0æ—¶åˆ»çš„çŠ¶æ€ï¼‰</li>
<li>ä»<span class="math inline">\(S^0\)</span>å‡ºå‘ï¼Œæ ¹æ®å®šä¹‰çš„æ¡ä»¶åˆ†å¸ƒï¼Œ<strong><u>æ¯æ¬¡é€‰æ‹©ä¸€ä¸ªå˜é‡è¿›è¡Œæ”¹å˜</u></strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<span class="math inline">\(S^0\rightarrow S^1\)</span>çš„çŠ¶æ€è½¬ç§»æ—¶ï¼Œå›ºå®šä¸­åˆä»¥åŠä¸æƒ³å­¦ä¸¤ä¸ªçŠ¶æ€ï¼ˆå¯¹åº”Y,Zï¼‰ï¼Œæ ¹æ®æ¡ä»¶æ¦‚ç‡<span class="math inline">\(P(X|Y,Z)\)</span>ï¼Œä»è¿™ä¸ªæ¡ä»¶åˆ†å¸ƒé‡Œé‡‡æ ·ä¸€ä¸ªå¯èƒ½çš„<span class="math inline">\(X\)</span>çŠ¶æ€ã€‚ä¿®æ”¹æ­¤Xã€‚</li>
<li><span class="math inline">\(S^t\rightarrow S^{t+1}\)</span>ä¹Ÿæ˜¯è¿™æ ·åšï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªå˜é‡è¿›è¡Œä¿®æ”¹ï¼ˆä¸ºäº†ä¿è¯å‡åŒ€æ€§ï¼Œå¯ä»¥é¡ºåºéå†æ‰€æœ‰å­˜åœ¨æ¡ä»¶åˆ†å¸ƒçš„å˜é‡ï¼‰ã€‚</li>
<li>Markové“¾æ”¶æ•›åï¼ˆé‡‡æ ·æ¬¡æ•°æ¯”è¾ƒå¤§ï¼‰ï¼Œç”Ÿæˆçš„æ ·æœ¬å®é™…æ˜¯æŒ‰ç…§è¿‘ä¼¼è”åˆåˆ†å¸ƒç”Ÿæˆçš„ã€‚ä»è¿™äº›æ ·æœ¬ä¸­ï¼Œå¯ä»¥æ±‚å‡ºæ‰€æœ‰è¾¹ç¼˜åˆ†å¸ƒï¼ˆå‡è®¾é‡‡æ ·è¶³å¤Ÿï¼‰ï¼Œé‚£ä¹ˆè”åˆåˆ†å¸ƒå¯ä»¥é¡ºåŠ¿æ¨å¯¼å‡ºæ¥ã€‚</li>
</ol>
<p>â€‹ æœ‰å…³Markovä»¥åŠå¹³ç¨³åˆ†å¸ƒçš„æ•°å­¦åŸç†ï¼Œè§<a href>ã€Post:æ— å‘å›¾æ¨¡å‹ &amp; Markovçš„â€œå®¶å…·â€ã€‘</a>ã€‚</p>
<hr>
<h2 id="emç®—æ³•">EMç®—æ³•</h2>
<p>â€‹ è¿™ä¸ªç®—æ³•ä¹‹å‰ä¸€ç›´æ²¡æœ‰ææ‡‚å…¶æ•°å­¦æ„ä¹‰ï¼Œå› ä¸ºä¸ç®¡æ˜¯ã€Šè¥¿ç“œä¹¦ã€‹è¿˜æ˜¯Wikipediaï¼Œå¯¹äºå…¶æ•°å­¦æ€§è§£é‡Šéƒ½æå…¶ç®€ç•¥ã€‚åœ¨æŸ¥æ‰¾èµ„æ–™çš„è¿‡ç¨‹ä¸­å¶ç„¶çœ‹åˆ°ä¸€ç¯‡CSDNåšå®¢[2]ï¼ˆå¯èƒ½ä¸æ˜¯[2]å¯¹åº”çš„ç½‘å€ï¼Œç”±äºåŸç½‘é¡µæ²¡æœ‰è¢«æˆ‘ä¿å­˜ï¼‰ï¼Œè§‰å¾—è¯´å¾—å¾ˆå¯¹ã€‚ä½†æ˜¯æ¯•ç«Ÿè¿™æ˜¯åˆ«äººçš„æ¨å¯¼ï¼ŒåŠ ä¸ŠCSDNç­‰ç­‰ç½‘ç«™çš„åšä¸»éƒ½æ˜¯ä½ æŠ„æˆ‘æˆ‘æŠ„ä½ çš„ï¼Œä¸ªäººè§‰å¾—æœ‰å¿…è¦è‡ªå·±æ¨ä¸€éï¼ŒåŠ æ·±ç†è§£ã€‚</p>
<h3 id="åŸºæœ¬æµç¨‹çš„è§£é‡Š">åŸºæœ¬æµç¨‹çš„è§£é‡Š</h3>
<p>â€‹ EMç®—æ³•è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ<strong><u>æ¦‚ç‡æ¨ç†é—®é¢˜</u></strong>ï¼Œå¹¶ä¸”è¿˜æ˜¯æ— ç›‘ç£çš„ã€‚ç»™å®šä¸€ä¸ªéšæœºçŠ¶æ€<span class="math inline">\(X&#39;\)</span>ï¼Œä½†<span class="math inline">\(X&#39;\)</span>å®é™…åŒ…å«äº†å·²ç»è¢«è§‚æµ‹åˆ°çš„çŠ¶æ€<span class="math inline">\(X\)</span>ä»¥åŠæœªè¢«è§‚æµ‹çš„çŠ¶æ€<span class="math inline">\(Z\)</span>ï¼Œè¿™ä¸ªZååˆ†çƒ¦äººï¼ˆç§°ä¸ºéšå˜é‡ï¼Œlatent vectorï¼‰ï¼Œå­˜åœ¨è¿™ç§æœªçŸ¥ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œè¦è¿›è¡Œæ¨¡å‹å‚æ•°<span class="math inline">\(\pmb{\theta}\)</span>çš„ä¼°è®¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨MLEæ¥ä¼°è®¡çš„ï¼Œé¦–å…ˆéœ€è¦æ„é€ ä¼¼ç„¶ï¼š <span class="math display">\[
\begin{equation}\label{likely}
L(\pmb{\theta}|X)=P(X|\pmb{\theta})\rightarrow L(\pmb{\theta}|X,Z)=P(X,Z|\pmb{\theta})
\end{equation}
\]</span> â€‹ å…³äºZçš„ä¿¡æ¯æ˜¯ç¼ºå¤±çš„ï¼Œå³ä½¿æˆ‘ä»¬ç»™å®šå‚æ•°ï¼ˆæ¯”å¦‚<span class="math inline">\(\pmb{\theta}\)</span>æ˜¯é™å®šæŸä¸ªåˆ†å¸ƒçš„å‚æ•°ï¼‰ä¹Ÿæ— æ³•ç›´æ¥ä¼°è®¡<span class="math inline">\(P(X,Z|\pmb{\theta})\)</span>ã€‚å½“ç„¶ï¼Œå¯¹äºå…¬å¼<span class="math inline">\(\eqref{likely}\)</span>å®šä¹‰çš„ä¼¼ç„¶ï¼Œå¤„ç†Zçš„ä¸€ä¸ªæ–¹æ³•æ˜¯è®©ä»–ä¸å­˜åœ¨ã€‚æ€ä¹ˆæå‘¢ï¼Ÿè¾¹ç¼˜åŒ–å°±å¥½äº†ï¼š <span class="math display">\[
\begin{equation}\label{margin}
L(\pmb{\theta}|X)=\int_ZL(\pmb{\theta}|X,Z)dZ=\int_ZP(X,Z|\pmb{\theta})dZ
\end{equation}
\]</span> â€‹ ä½†Wikipediaè¿™ä¹ˆè¯´ï¼š</p>
<blockquote class="blockquote-center">
<p>However, this quantity is often <strong><u>intractable</u></strong> (e.g. if <span class="math inline">\(\mathbf {Z}\)</span> is a sequence of events, so that the number of values grows <strong><u>exponentially</u></strong> with the sequence length, the exact calculation of the sum will be <strong><u>extremely difficult</u></strong>).</p>

</blockquote>
<p>â€‹ ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿçœ‹å…¬å¼<span class="math inline">\(\eqref{margin}\)</span>ï¼Œæˆ‘ä»¬æ˜¯å¯¹Zè¿›è¡Œç§¯åˆ†ï¼Œè€ŒZå¯èƒ½æ˜¯å¤šå…ƒå˜é‡ï¼Œæ­£å¦‚ä¸Šè¿°å¼•ç”¨æ‰€è¯´ï¼Œè¦æ˜¯æœ‰<span class="math inline">\(Z = \{X_{n-k},...X_{n-1},X_n\}\)</span>ï¼Œé‚£åœ¨è¾¹ç¼˜åŒ–çš„æ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸è¿™æ ·ï¼š <span class="math display">\[
\begin{equation}\label{awful}
L(\pmb{\theta}|X)=\int_ZP(X,Z|\pmb{\theta})dZ=\int_{X_n}\int_{X_{n-1}}...\int_{X_{n-k}}P(X,Z|\pmb{\theta})dZ
\end{equation}
\]</span> â€‹ è¿™å¥½å—ï¼Ÿè¿™ä¸å¥½ã€‚å¤ªä¸‘é™‹äº†ï¼Œè€Œä¸”éš¾ä»¥è®¡ç®—ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…¶ä»–ç®—æ³•ï¼é‚£ä¹ˆEM(Expectation Maximization)ç®—æ³•å°±æ˜¯æ¥å¹²è¿™ä¸ªçš„ã€‚å¥½ï¼Œæˆ‘æ¥æ‘˜æŠ„ä¸€ä¸‹ä»¤äººç–‘æƒ‘çš„åŸºæœ¬ä¼˜åŒ–è¿‡ç¨‹ï¼Œè™½ç„¶åŸºæœ¬ä¼˜åŒ–è¿‡ç¨‹çš„æ•°å­¦è¡¨è¾¾ä¹ä¸€çœ‹éš¾ä»¥ç†è§£ï¼Œä½†æ˜¯æ„æ€è¿˜æ˜¯æ¯”è¾ƒæ˜ç¡®çš„ï¼š</p>
<ol type="1">
<li>æ„é€ ä¼¼ç„¶ï¼š<span class="math inline">\(Q(\pmb{\theta}|\pmb{\theta}^{(t)})\)</span>ï¼Œè¿™ä¸ªä¼¼ç„¶æ˜¯åœ¨ï¼š<strong><u>ä¼°è®¡å¾—åˆ°å½“å‰æœ€ä¼˜çš„æ¡ä»¶åˆ†å¸ƒ<span class="math inline">\(P(Z|X,\pmb{\theta})\)</span></u></strong>ä¸‹å®šä¹‰çš„ï¼Œä¹Ÿå³æ˜¯ï¼š</li>
</ol>
<p><span class="math display">\[
\begin{equation}\label{estep}
Q(\pmb{\theta}|\pmb{\theta}^{(t)})=E_{P_{Z|X,\pmb{\theta}^{(t)}}}[\text{log} L(\pmb{\theta}|X,Z)]
\end{equation}
\]</span></p>
<ol start="2" type="1">
<li>ä¼˜åŒ–ä¼¼ç„¶ï¼šä½¿å¾—<span class="math inline">\(\pmb{\theta}\)</span>æœ€å¤§åŒ–ï¼š</li>
</ol>
<p><span class="math display">\[
\begin{equation}\label{mstep}
\pmb{\theta}^{(t+1)}=\mathop{\text{arg max}}_{\pmb{\theta}}Q(\pmb{\theta}|\pmb{\theta}^{(t)})
\end{equation}
\]</span></p>
<p>â€‹ ä¸ªäººçš„åˆæ­¥ç†è§£å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šç±»ä¼¼äºæœºé˜Ÿé¢„åˆ¤æ•Œæ–¹ä½ç½®ä½¿ç”¨çš„åŒè¿­ä»£ç®—æ³•ï¼š</p>
<ul>
<li>æ„é€ ä¼¼ç„¶çš„è¿‡ç¨‹ï¼ˆç§°ä¸ºE-stepï¼‰ï¼šæ ¹æ®æœ€ä¼˜<span class="math inline">\(\pmb{\theta}\)</span>æ›´æ–°æ¡ä»¶åˆ†å¸ƒ<span class="math inline">\(P(Z|X,\pmb{\theta})\)</span>å¹¶ä¸”ç”Ÿæˆç›®æ ‡çš„è¿‡ç¨‹ã€‚</li>
<li>ä¼˜åŒ–ä¼¼ç„¶çš„è¿‡ç¨‹ï¼ˆç§°ä¸ºM-stepï¼‰ï¼šæ ¹æ®<span class="math inline">\(P(Z|X,\pmb{\theta})\)</span>ä¼˜åŒ–<span class="math inline">\(\pmb{\theta}\)</span>çš„è¿‡ç¨‹</li>
</ul>
<p>â€‹ å®é™…ä¸Šï¼Œåœ¨ä¸‹é¢ä¸€å°èŠ‚ï¼ˆã€æ•°å­¦ç†è®ºã€‘ï¼‰ä¸­ï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹çš„æ„ä¹‰å°†æ›´åŠ æ¸…æ™°ã€‚ä¸ªäººæ¯”è¾ƒç¬¨ï¼Œè§‰å¾—ä¸Šé¢<span class="math inline">\(\eqref{estep}\)</span>ä»¥åŠ<span class="math inline">\(\eqref{mstep}\)</span>å®šä¹‰çš„å…¬å¼ï¼ˆ<span class="math inline">\(\eqref{mstep}\)</span>è¿˜å¥½äº›ï¼‰ï¼Œç›´æ¥çœ‹æ ¹æœ¬ä¸çŸ¥é“EMç®—æ³•åˆ°åº•åœ¨æä»€ä¹ˆï¼Œå–ä»€ä¹ˆæœŸæœ›ï¼Œç®—ä»€ä¹ˆåˆ†å¸ƒï¼Œæ€ä¹ˆç®—ã€‚</p>
<h3 id="ä¼˜åŒ–ç›®æ ‡çš„æ•°å­¦ç†è®º">ä¼˜åŒ–ç›®æ ‡çš„æ•°å­¦ç†è®º</h3>
<h4 id="jensenä¸ç­‰å¼">Jensenä¸ç­‰å¼</h4>
<p>â€‹ æ•°å­¦ç«èµ›ï¼Œå•Šç†Ÿæ‚‰çš„ä¸ç­‰å¼ã€‚åœ¨å‡½æ•°æˆ–è€…å¤šå…ƒå‡½æ•°é‡Œçš„ç´ç”Ÿä¸ç­‰å¼è¯´çš„æ˜¯ï¼šå¯¹äºå‡¸å‡½æ•°è€Œè¨€ï¼Œå‡½æ•°å€¼çš„åŠ æƒå¹³å‡ä¼šå¤§äºåŠ æƒå¹³å‡çš„å‡½æ•°å€¼ã€‚è¿™ä¸ªä¸å†å¤šæï¼Œå¾ˆç®€å•ã€‚è€Œåœ¨æ¦‚ç‡ï¼ˆä¿¡æ¯è®ºï¼‰ä¸­ï¼Œç´ç”Ÿä¸ç­‰å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{jensen}
\begin{array}{ll}
\psi\left( E(X)\right) \leq E(\psi(X)),\\
\text{where }\psi \text{ is convex function}
\end{array}
\end{equation}
\]</span> â€‹ è€Œç´ç”Ÿä¸ç­‰å¼å¹¶ä¸æ˜¯æˆ‘çš„è®¨è®ºé‡ç‚¹ï¼Œè¿™æ˜¾ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç»“è®ºï¼šå‡¸å‡½æ•°æ˜ å°„åçš„éšæœºå˜é‡å–å€¼å­˜åœ¨çš„æ€§è´¨ã€‚ä½†æ˜¯è¿™ä¸ªç»“è®ºå¾ˆé‡è¦ï¼Œä¸€ä¼šå„¿è¦ç”¨åˆ°ã€‚</p>
<h4 id="é‡è¦æ€§é‡‡æ ·">é‡è¦æ€§é‡‡æ ·</h4>
<p>â€‹ ç”±å…¬å¼<span class="math inline">\(\eqref{margin}\)</span>çš„ç¦»æ•£åŒ–å½¢å¼ï¼Œå±•å¼€ä¼¼ç„¶å‡½æ•°å¼å­ï¼Œå¹¶ä¸”æ³¨æ„ï¼Œæ­¤å¤„è¦ç¬¦åˆæˆ‘ä»¬åœ¨E-stepä¸­æ„å»ºçš„ä¼¼ç„¶ï¼ˆä¹Ÿå°±æ˜¯å–å¯¹æ•°ï¼Œå°†è¿ä¹˜å˜æˆè¿åŠ ï¼Œä¸‹å¼å±•ç¤ºçš„æ˜¯ï¼šå–å¯¹æ•°ä¼¼ç„¶ä¹‹å‰çš„Zè¾¹ç¼˜åŒ–æ“ä½œ <span class="math display">\[
L(\pmb{\theta}|x_i)=\text{log}P(x_i|\pmb{\theta})=\text{log}\sum_ZP(x_i,Z|\pmb{\theta})
\]</span> â€‹ é‚£ä¹ˆï¼Œä¼¼ç„¶å¯ä»¥å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{like}
L(\pmb{\theta}|X)=\sum_i\text{log}P(x_i|\pmb{\theta})=\sum_i\text{log}\sum_ZP(x_i,Z|\pmb{\theta})
\end{equation}
\]</span> â€‹ é¦–å…ˆéœ€è¦çŸ¥é“ï¼Œlogæ˜¯ä¸ªå‡¹å‡½æ•°ï¼Œé‚£ä¹ˆå‡¹å‡½æ•°ç´ç”Ÿä¸ç­‰å¼æœ‰<span class="math inline">\(\eqref{jensen}\)</span>ç›¸åçš„ç»“è®ºï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æƒ³åŠæ³•è®©logæ¢ä¸ªä½ç½®ï¼Œæˆ‘ä»¬è€ƒè™‘å°†<span class="math inline">\(P(x_i,Z|\pmb{\theta})\)</span>æ‹†å¼€ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{trans1}
P(x_i,z_i|\pmb{\theta})=Q(z_i)\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)}
\end{equation}
\]</span> â€‹ æ ¹æ®å…¬å¼<span class="math inline">\(\eqref{trans1}\)</span>ï¼Œå¯ä»¥å°†å…¬å¼<span class="math inline">\(\eqref{like}\)</span>åŒ–æˆå¦‚ä¸‹å½¢å¼ï¼Œæ³¨æ„ï¼Œå¯¹Zè¿›è¡Œè¾¹ç¼˜åŒ–æ“ä½œå®é™…ä¸Šä¸å–æœŸæœ›å­˜åœ¨ç­‰ä»·ä¹‹å¤„ï¼Œéƒ½æ˜¯æ¶ˆé™¤Zçš„å½±å“ï¼ˆæ¶ˆé™¤Zçš„éšæœºå˜é‡æ€§ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{equ1}
L(\pmb{\theta}|X)=\sum_i\text{log}\sum_ZP(x_i,Z|\pmb{\theta})=\sum_iQ(z_i)\text{log}\sum_Z\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)}
\end{equation}
\]</span> â€‹ <span class="math inline">\(Q(z_i)\)</span>æ˜¯éšå˜é‡çš„ä¸€ç§åˆ†å¸ƒï¼Œä½†æ˜¯å½¢å¼æš‚æ—¶æœªçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¬å¼<span class="math inline">\(\eqref{equ1}\)</span>çš„logå†…éƒ¨çœ‹æˆæ˜¯å¯¹Zçš„æœŸæœ›ï¼ˆå®é™…ä¸Šï¼ŒæŠŠ<span class="math inline">\(Q(z_i)\)</span>ç§»åŠ¨åˆ°zç´¯åŠ å¼å†…éƒ¨ï¼Œå°±èƒ½çœ‹å‡ºæ¥ï¼Œæ¦‚ç‡<span class="math inline">\(Q(z_i)\)</span>ä¹˜ä»¥æŸä¸€ä¸ªå€¼çš„æœŸæœ›å½¢å¼ï¼‰ã€‚è¿™éƒ¨åˆ†å¾ˆåƒã€Šæ¦‚ç‡æœºå™¨äººã€‹[3]ä¸­ï¼Œè¯´ç²’å­æ»¤æ³¢æ—¶çš„é‡è¦æ€§é‡‡æ ·ï¼š <span class="math display">\[
\begin{equation}\label{imp}
E(X)=\int_xxp(x)\text{d}x=\int_xx\frac{p(x)}{q(x)}q(x)\text{d}x
\end{equation}
\]</span> â€‹ ä¹Ÿå°±ç›¸å½“äºï¼Œå°†ä¸€ä¸ªéš¾ä»¥æ±‚å–çš„æœŸæœ›ï¼Œè½¬åŒ–ä¸ºå¦ä¸€ä¸ªåˆ†å¸ƒä¸‹ï¼Œå¦ä¸€ä¸ªéšæœºå˜é‡å‡½æ•°çš„æœŸæœ›ã€‚è€Œå®é™…ä¸Šï¼Œåœ¨é‡è¦æ€§é‡‡æ ·ä¸­ï¼Œ<span class="math inline">\(p(x)/q(x)\)</span>æ˜¯ä¸€ä¸ªç»è¿‡ä¼°è®¡çš„æƒå€¼ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘å°†ä¼šåœ¨<a href="https://enigmatisms.github.io/2021/03/07/%E5%8D%A1%E5%B0%94%E6%9B%BC%E8%BF%9B%E9%98%B6%E4%B8%8E%E7%B2%92%E5%AD%90%E6%BB%A4%E6%B3%A2%E5%AE%9E%E7%8E%B0/">ã€Post: å¡å°”æ›¼è¿›é˜¶ä¸ç²’å­æ»¤æ³¢å®ç° ã€‘</a>ä¸­æåˆ°ã€‚</p>
<p>â€‹ ç”±logçš„æ€§è´¨ï¼ˆlogæ˜¯å‡¹å‡½æ•°ï¼‰ä¸ç´ç”Ÿä¸ç­‰å¼ï¼Œæœ‰ï¼š <span class="math display">\[
\text{log}\sum_Z\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} \geq \sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} 
\]</span> â€‹ é‚£ä¹ˆä¼¼ç„¶<span class="math inline">\(\eqref{equ1}\)</span>çš„ä¸€ä¸ªä¸‹ç•Œå·²ç»æ‰¾åˆ°äº†ï¼š <span class="math display">\[
\begin{align}
L(\pmb{\theta}|X)=\sum_iQ(z_i)\text{log}\sum_Z\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} \geq \\
L_{lb}(\pmb{\theta}|X)=\sum_iQ(z_i)\sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} \label{lb}
\end{align}
\]</span> â€‹ å¦‚ä½•ä¼˜åŒ–ï¼ŸEMç®—æ³•çš„æƒ³æ³•å®é™…ä¸Šæ˜¯ï¼š</p>
<ul>
<li>E-stepï¼šç¡®å®šä¼¼ç„¶å‡½æ•°ï¼Œæ±‚å¾—å½“å‰Zçš„åˆ†å¸ƒï¼Œè®¡ç®—å¾—åˆ°çš„æ˜¯<strong><u>ä¼¼ç„¶å‡½æ•°çš„ä¸‹ç•Œ</u></strong>ã€‚</li>
<li>M-stepï¼šæ ¹æ®ä¸‹ç•Œï¼Œä¼˜åŒ–è¿™ä¸ªä¸‹ç•Œã€‚ä½¿ä¸‹ç•Œæ›´å¤§ï¼Œæ ¹æ®å¤¹é€¼å‡†åˆ™ï¼Œæœ€å¤§å€¼çš„æœŸæœ›ä¹Ÿå°†æ›´å¤§ã€‚</li>
</ul>
<p>â€‹ é‚£å¦‚ä½•æœ€å¤§åŒ–è¿™ä¸ªä¸‹ç•Œï¼Ÿ</p>
<h4 id="ä¼¼ç„¶è½¬åŒ–">ä¼¼ç„¶è½¬åŒ–</h4>
<p>â€‹ ç´ç”Ÿä¸ç­‰å¼å‘Šè¯‰æˆ‘ä»¬ï¼Œ<span class="math inline">\(\eqref{equ1}\)</span>æ˜¯æ°¸è¿œå¤§äºç­‰äº<span class="math inline">\(\eqref{lb}\)</span>çš„ï¼Œæˆç«‹çš„æ¡ä»¶æ˜¯ï¼šXæ˜¯ç¡®å®šå˜é‡ã€‚å“¦ï¼Ÿé‚£ä¹ˆæ­¤å¤„Xå°±æ˜¯<span class="math inline">\(\eqref{lb}\)</span>logé‡Œé¢çš„éƒ¨åˆ†ã€‚å¦‚æœè¿™æ˜¯ä¸ªå¸¸æ•°ï¼Œä¹Ÿå³ï¼š <span class="math display">\[
\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} =C\rightarrow P(x_i,z_i|\pmb{\theta})=CQ(z_i)
\]</span> â€‹ ç”±äº<span class="math inline">\(\sum Q(z_i)=1\)</span>ï¼ˆæ¦‚ç‡å½’ä¸€åŒ–æ€§è´¨ï¼‰ï¼Œåˆ™<span class="math inline">\(P(x_i|\pmb{\theta})=C\)</span>ï¼Œä¹Ÿå°±å¾—åˆ°äº†è¿™æ ·çš„ç»“è®ºï¼š <span class="math display">\[
\begin{equation}\label{qres}
Q(z_i)=\frac{P(x_i,z_i|\pmb{\theta})}{P(x_i|\pmb{\theta})}=\frac{P(x_i,z_i,\pmb{\theta})}{P(x_i,\pmb{\theta})}=P(z_i|x_i,\pmb{\theta})
\end{equation}
\]</span> â€‹ wowã€‚è¿™è¯´æ˜äº†ä»€ä¹ˆï¼Ÿè¿™è¯´æ˜ï¼Œä½¿å¾—ä¸‹ç•Œæœ€å¤§çš„ï¼ŒZåˆ†å¸ƒçš„ä¼°è®¡åº”è¯¥æ˜¯<span class="math inline">\(P(Z|X,\pmb{\theta})\)</span>ã€‚é‚£ä¹ˆè¿™æ ·ä¸€æ“ä½œï¼Œæˆ‘ä»¬æŠŠä¼¼ç„¶objectiveå†™äº†å‡ºæ¥ï¼Œå¹¶ä¸”æœ€å¤§åŒ–äº†ä¸‹ç•Œï¼Œå¾—åˆ°äº†æ­¤æ—¶å…³äºZåˆ†å¸ƒçš„ä¼°è®¡ã€‚å› ä¸ºæˆ‘ä»¬å®é™…ä¸Šä¸çŸ¥é“Zçš„åˆ†å¸ƒï¼Œä½†æ˜¯ä¸ºäº†è¿›è¡Œè¿™ä¸ªMLEï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªæœ€å¤§åŒ–ä¸‹ç•Œæ“ä½œï¼Œä¹Ÿå°±ä¼°è®¡å‡ºäº†éšå˜é‡Zçš„åˆ†å¸ƒã€‚</p>
<p>â€‹ ä¸‹ä¸€æ­¥å½“ç„¶æ˜¯M-stepï¼Œå›ºå®šå·²ç»é€‰æ‹©ä¼˜åŒ–å®Œçš„<span class="math inline">\(Q(Z)\)</span>ï¼Œå¼€å§‹argmax <span class="math inline">\(\pmb{\theta}\)</span>ã€‚è¿™é‡Œå°±æœ‰ç‚¹åƒcoordinate descentäº†ï¼Œè·Ÿæˆ‘å†™çš„ç¯æ¡ä¼˜åŒ–ç®—æ³•æ˜¯ç±»ä¼¼çš„ï¼Œå›ºå®šæŸå‡ ä¸ªåˆ†é‡ï¼Œä¼˜åŒ–å‰©ä½™çš„ä¸€ä¸ªåˆ†é‡ã€‚E-stepå°±æ˜¯å›ºå®š<span class="math inline">\(\pmb{\theta}\)</span>ï¼Œè€ŒM-stepå°±æ˜¯å›ºå®šQã€‚M-stepçš„å·¥ä½œæ˜¯è¿›ä¸€æ­¥ä¼˜åŒ–ä¸‹ç•Œã€‚</p>
<p>â€‹ æˆ‘ä»¬ä¼˜åŒ–çš„æ˜¯å“ªä¸ªå¼å­ï¼Ÿä¼˜åŒ–çš„æ˜¯ä¸‹ç•Œå¼<span class="math inline">\(\eqref{lb}\)</span>ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒæ•´<span class="math inline">\(\pmb{\theta}\)</span>ã€‚ç”±äº<span class="math inline">\(\eqref{lb}\)</span>å®é™…ä¸Šå·²ç»å®Œå…¨ç¡®å®šäº†ï¼Œæ‰€ä»¥M-stepå®é™…ä¸Šåœ¨ä¼˜åŒ–ä¸€ä¸ªä»…å…³äº<span class="math inline">\(\theta\)</span>çš„è¡¨è¾¾å¼ï¼š <span class="math display">\[
\begin{equation}\label{obj}
Q^{*}_{lb}=\sum_iQ(z_i)\sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta})}{Q(z_i)} =\sum_iP(Z|x_i,\pmb{\theta})\sum_zP(X|\pmb{\theta})
\end{equation}
\]</span> â€‹ å®é™…ä¸Šè¿™æˆäº†ä¸€ä¸ªä¼˜åŒ–é—®é¢˜ã€‚Wikipediaä¸Šä¸¾äº†å…³äºé«˜æ–¯åˆ†å¸ƒ<span class="math inline">\(\theta\)</span>å‚æ•°çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚è¿™é‡Œå°±çœç•¥äº†ã€‚</p>
<h4 id="æ”¶æ•›åˆ†æ">æ”¶æ•›åˆ†æ</h4>
<p>â€‹ è¯æ˜æ”¶æ•›ï¼Ÿä¹Ÿå°±æ˜¯éœ€è¦è¯æ˜ï¼Œæ¯ä¸€æ¬¡çš„ç»“æœï¼ˆä¼¼ç„¶å‡½æ•°ï¼‰ä¸ä¼šæ¯”å‰ä¸€æ¬¡ä½å³å¯ã€‚æ¨å¯¼è¿‡ç¨‹å€’æ˜¯æ¯”è¾ƒç›´æ¥ï¼š</p>
<ul>
<li>ç”±äºM-stepæ‰æ›´æ–°<span class="math inline">\(\pmb{\theta}^t \rightarrow \pmb{\theta}^{t+1}\)</span>ï¼Œè€Œæ›´æ–°è¿‡ç¨‹ä¿è¯äº†ï¼ˆå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¼˜åŒ–ä¸‹ç•Œï¼Œä½¿å¾—ä¼¼ç„¶å˜å¤§ï¼‰</li>
</ul>
<p><span class="math display">\[
Q_{lb}(\pmb{\theta}|\pmb{\theta}^{t+1}) \geq Q_{lb}(\pmb{\theta}|\pmb{\theta}^{t})\rightarrow \sum_iQ(z_i)\sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta}^{t+1})}{Q(z_i)} \geq
\sum_iQ(z_i)\sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta}^{t})}{Q(z_i)}
\]</span></p>
<ul>
<li>è€Œæˆ‘ä»¬çŸ¥é“<span class="math inline">\(Q_{lb}(\pmb{\theta}|\pmb{\theta}^{t+1})\)</span>åªæ˜¯ä¼¼ç„¶<span class="math inline">\(L(\pmb{\theta}^{t+1}|X)\)</span>çš„ä¸‹ç•Œï¼Œæ‰€ä»¥t+1è¿­ä»£çš„ä¼¼ç„¶å¿…ç„¶å¤§äºç­‰äºä¸‹ç•Œã€‚</li>
<li>è€Œç”±äºï¼Œç´ç”Ÿä¸ç­‰å¼æˆ‘ä»¬å–äº†ç­‰å·æˆç«‹ï¼Œé‚£ä¹ˆä¸‹å¼æˆç«‹ï¼š</li>
</ul>
<p><span class="math display">\[
\sum_iQ(z_i)\sum_Z\text{log}\frac{P(x_i,z_i|\pmb{\theta}^{t})}{Q(z_i)}=L(\pmb{\theta}^{t}|X)
\]</span></p>
<ul>
<li>æ•…ç»¼ä¸Šï¼Œæ¯æ¬¡æ›´æ–°ä¹‹åï¼Œä¼¼ç„¶å‡½æ•°ä¸ä¼šæ¯”åŸæ¥å°ã€‚EMç®—æ³•æ˜¯æ”¶æ•›çš„ã€‚</li>
</ul>
<hr>
<h2 id="neyman-pearsonå†³ç­–">Neyman-Pearsonå†³ç­–</h2>
<p>â€‹ è¯´å®è¯ï¼Œå†³ç­–è¿™éƒ¨åˆ†å®Œå…¨å¯ä»¥å•ç‹¬å¼€ä¸€ç¯‡è®²ã€‚å†³ç­–æ˜¯è¦åšä»€ä¹ˆï¼Ÿä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–°å† ã€‚</p>
<ul>
<li>åŒ»é™¢å°†é˜´æ€§æ‚£è€…è¯†åˆ«ä¸ºé˜³æ€§ï¼ˆTN-&gt;FPï¼‰ï¼Œç§°ä¹‹ä¸ºç¬¬ä¸€ç±»é”™è¯¯ï¼ˆæ‹’çœŸï¼Œè™šè­¦ï¼Œå‡é˜³æ€§ç‡ï¼Œä¹Ÿå°±æ˜¯å®é™…é˜´æ€§çš„äººä¸­ï¼Œæ£€æµ‹ç»“æœä¸ºé˜³æ€§äººçš„æ¯”ä¾‹ï¼‰</li>
<li>åŒ»é™¢å°†é˜³æ€§æ‚£è€…è¯†åˆ«ä¸ºé˜´æ€§ï¼ˆTP-&gt;FNï¼‰ï¼Œç§°ä¹‹ä¸ºç¬¬äºŒç±»é”™è¯¯ï¼ˆå­˜ä¼ªï¼Œæ¼æŠ¥ï¼Œå‡é˜´æ€§ç‡ï¼‰ï¼ˆæ³¨æ„æ­¤å¤„å­˜ä¼ªï¼Œæ‹’çœŸä¸¤ä¸ªå®šä¹‰å…¶å®æ„æ€ä¸Šäº’æ¢æ²¡ä»€ä¹ˆå¤§é—®é¢˜ï¼‰</li>
</ul>
<p>â€‹ é‚£ä¹ˆä½œä¸ºåŒ»é™¢ï¼Œè¿™ä¸¤ç§åˆ¤å®šå¿…ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å“ªä¸€ç§æ›´ä¸¥é‡ï¼Ÿæ˜¾ç„¶æ˜¯ç¬¬äºŒç±»é”™è¯¯ï¼ŒæŠŠé˜³æ€§å­˜ä¸‹æ¥äº†ã€‚åŒ»é™¢éœ€è¦å¯¹æ£€æµ‹ç»“æœå­˜åœ¨çš„æƒ…å†µè¿›è¡ŒåŠ æƒï¼Œå°½é‡å‡å°‘ä¸¤ç±»ï¼Œä½†æ˜¯ä¸¤ç±»ä¸­åˆå„æœ‰ä¾§é‡ï¼ŒåŠ æƒåœ°ç»™å‡ºé£é™©ã€‚Neyman-Pearsonå†³ç­–æ˜¯è´å¶æ–¯å†³ç­–çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä½†æ˜¯å¾ˆå¸¸è§ï¼šä¸¤ç±»é”™è¯¯å„æœ‰æ¦‚ç‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ul>
<li>çŠ¯å…¶ä¸­ä¸€ç±»é”™è¯¯çš„æ¦‚ç‡èƒ½è¾¾åˆ°æŸä¸ªæ ‡å‡†å€¼ï¼ˆæ¯”å¦‚<span class="math inline">\(\epsilon_0\)</span>ï¼‰</li>
<li>ä¸æ­¤åŒæ—¶ï¼ŒçŠ¯å¦ä¸€ç§é”™è¯¯çš„æ¦‚ç‡è¶Šå°è¶Šå¥½</li>
</ul>
<p>â€‹ è¿™å°±æ˜¯Neyman-Pearsonå†³ç­–è®¨è®ºçš„é—®é¢˜ï¼Œå…¶è¡¨è¾¾å¼å¯ä»¥å†™ä¸ºï¼ˆä»¥å…¶ä¸­ä¸€ç§æƒ…å†µä¸ºä¾‹ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{np}
\begin{array}{ll}
\text{min }P_1\\
\text{s.t. } P_2=\epsilon_0
\end{array}
\end{equation}
\]</span> â€‹ æ­¤å¤„è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šå½“çŠ¯ç¬¬äºŒç±»é”™è¯¯çš„æ¦‚ç‡ä¸º<span class="math inline">\(\epsilon_0\)</span>æ—¶ï¼ˆè¾¾åˆ°ç¬¬äºŒç±»é”™è¯¯è§„å®šçš„æ ‡å‡†ï¼‰ï¼ŒçŠ¯ç¬¬ä¸€ç±»é”™è¯¯æ¦‚ç‡å°½å¯èƒ½å°ã€‚</p>
<h3 id="å½¢å¼å˜æ¢">å½¢å¼å˜æ¢</h3>
<p>â€‹ é¦–å…ˆæˆ‘ä»¬å…ˆå†™å‡º<span class="math inline">\(P_1,P_2\)</span>çš„è¡¨è¾¾å¼ï¼Œå‡è®¾ç±»1å¯¹åº”äº†é˜´æ€§ï¼Œç±»2å¯¹åº”äº†é˜³æ€§ã€‚é‚£ä¹ˆé˜³æ€§åˆ¤åˆ«èŒƒå›´æ˜¯<span class="math inline">\(R_2\)</span>ï¼Œé˜´æ€§åˆ¤åˆ«èŒƒå›´æ˜¯<span class="math inline">\(R_1\)</span>ã€‚ <span class="math display">\[
\begin{align}
&amp;P_1=\int_{R_2}p(x|w_1)dx\label{p1}\\
&amp;P_2=\int_{R_1}p(x|w_2)dx\label{p2}
\end{align}
\]</span> â€‹ å…¶æ„ä¹‰æ˜¯ä»€ä¹ˆï¼ŸP1æ˜¯ç¬¬ä¸€ç±»é”™è¯¯çŠ¯é”™æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯å‡é˜³æ€§ç‡ï¼ˆå®é™…ä¸ºé˜´æ€§<span class="math inline">\(w_1\)</span>çš„æ ·æœ¬ï¼Œå´åœ¨é˜³æ€§åˆ¤åˆ«èŒƒå›´å†…å½“ä½œé˜³æ€§æ£€æµ‹å‡ºï¼‰ã€‚P2æ˜¯ç¬¬äºŒç±»é”™è¯¯çŠ¯é”™æ¦‚ç‡ï¼Œæ„ä¹‰ç±»ä¼¼ã€‚é‚£ä¹ˆç”±å…¬å¼<span class="math inline">\(\eqref{np}\)</span>å¯ä»¥çŸ¥é“ï¼Œé—®é¢˜æ˜¯çº¦æŸæå°å€¼æ±‚è§£é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨Lagrangeæ³•å¤„ç†ï¼Œé‚£ä¹ˆä¹˜å­åŒ–åçš„objectiveå¸¦å…¥å…¬å¼<span class="math inline">\(\eqref{p1}\)</span>ä»¥åŠ<span class="math inline">\(\eqref{p2}\)</span>æœ‰ï¼š <span class="math display">\[
\begin{equation}\label{obj2}
L=\int_{R_2}p(x|w_1)dx+\lambda\left( \int_{R_1}p(x|w_2)dx-\epsilon_0 \right)
\end{equation}
\]</span> â€‹ è€Œå®é™…ä¸Šï¼Œ<span class="math inline">\(\eqref{obj2}\)</span>æ˜¯å¯ä»¥æ‹†è§£çš„ï¼ˆæœ‰å…³å‡é˜³æ€§ç‡éƒ¨åˆ†ï¼‰ï¼Œæ ¹æ®æ¦‚ç‡å…¬å¼æ‹†è§£ï¼š <span class="math display">\[
\begin{equation}\label{obj3}
L=1-\int_{R_1}p(x|w_1)dx+\lambda\left( \int_{R_1}p(x|w_2)dx-\epsilon_0 \right) =
1-\lambda\epsilon_0+\int_{R_1}\lambda p(x|w_2)-p(x|w_1)dx 
\end{equation}
\]</span> â€‹ å¥½ï¼Œå›é¡¾ç†Ÿæ‚‰çš„KKTæ¡ä»¶ï¼Œ<span class="math inline">\(L\)</span>ç›¸å¯¹äº<span class="math inline">\(\lambda\)</span>çš„åå¯¼æ•°æ˜¯è¦ä¸º0çš„ï¼Œå®é™…ä¸Šå°±æ˜¯ç­‰å¼çº¦æŸè¦æˆç«‹ï¼Œè¿™é‡Œå°±ä¸å†™äº†ã€‚è€Œè¿˜æœ‰ä»€ä¹ˆå¯ä»¥æ±‚å¯¼çš„å—ï¼Ÿåƒä¸‡ä¸è¦å¿˜è®°è‡ªå·±è¦å¹²ä»€ä¹ˆã€‚è®¨è®ºè¿™ä¸ªå†³ç­–objectiveï¼Œæœ€å°åŒ–å®ƒæ˜¯ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ªæœ€å¥½çš„å†³ç­–æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å‹å‚æ•°æ˜¯æˆ‘ä»¬æƒ³çŸ¥é“çš„ï¼æ­¤å¤„æˆ‘ä»¬åƒä¹¦[4]ä¸Šä¸€æ ·ï¼Œåªç®€å•è®¨è®ºæ¨¡å‹å‚æ•°ã€å†³ç­–è¾¹ç•Œã€‘çš„åˆ’å®šï¼Œä¹Ÿå³å‚æ•°tã€‚å¯¹tæ±‚åå¯¼ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ <span class="math display">\[
\frac{\partial}{\partial t}\int_{R_1}\lambda p(x|w_2)-p(x|w_1)dx =\frac{\partial R_1}{\partial t}\times[\lambda p(x|w_2)-p(x|w_1)]
\]</span> â€‹ ä¹¦ä¸Šæ²¡å†™æ¸…æ¥šï¼Œä½†ä¸ªäººè®¤ä¸ºæ˜¯è¿™æ ·çš„ã€‚è¿™æ˜¯ç”±å˜é™ç§¯åˆ†çš„æ€§è´¨å†³å®šçš„ã€‚é‚£ä¹ˆè¾¹ç•Œå¯¹tçš„åå¯¼ä¸å¥½æ±‚ï¼Œå¯ä»¥æ˜¯0ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯0ã€‚ç”±KKTåå¯¼ä¸º0è¦æ±‚ï¼Œæ˜¾ç„¶ä¸‹å¼æˆç«‹æ˜¯è¾ƒä¼˜çš„é€‰æ‹©ï¼š <span class="math display">\[
\begin{equation}\label{cond}
\lambda = \frac{p(x|w_1)}{p(x|w_2)}
\end{equation}
\]</span> â€‹ æ³¨æ„KKTæ¡ä»¶äº§ç”Ÿäº†ä¸¤ä¸ªçº¦æŸã€‚è€Œå¯¹äºå…¬å¼<span class="math inline">\(\eqref{obj3}\)</span>çš„ç§¯åˆ†ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœå¯ä»¥è®©ç§¯åˆ†ç¬¦å·é‡Œé¢çš„é¡¹å°äº0ï¼Œé‚£ä¹ˆç§¯åˆ†ç»“æœå¿…ç„¶è´Ÿçš„ç¨‹åº¦æœ€å¤§ï¼ŒLæœ€å°ï¼Œè¿™æ˜¯æœ€æœŸæœ›çš„æƒ…å†µã€‚äºæ˜¯å®é™…ä¸Šæˆ‘ä»¬æœ‰<span class="math inline">\(\eqref{cond}\)</span>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹çš„è¦æ±‚ï¼šå·¦è¾¹åº”è¯¥å°äºå³è¾¹ã€‚ä¹Ÿå°±æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{cond2}
\lambda &lt; \frac{p(x|w_1)}{p(x|w_2)}
\end{equation}
\]</span> â€‹ å…¬å¼<span class="math inline">\(\eqref{obj3}\)</span>å®šä¹‰çš„ç§¯åˆ†é¡¹æ˜¯åœ¨<span class="math inline">\(R_1\)</span>ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<span class="math inline">\(R_1\)</span>ä¸Šæ—¶ï¼Œæ¡ä»¶<span class="math inline">\(\eqref{cond2}\)</span>æˆç«‹ï¼Œå°±å¯ä»¥è®©Lå˜å°ã€‚é‚£ä¹ˆï¼Œå°±è‡ªç„¶å¯ä»¥ç»¼ä¸Šæ‰€è¿°ï¼š <span class="math display">\[
\begin{align}
&amp; \int_{R_1}p(x|w_2)dx = \epsilon_0 \tag{KKT condition 1}\\
&amp; \lambda = \frac{p(x|w_1)}{p(x|w_2)} (\large{\text{è¯´æ˜å†³ç­–è¾¹ç•Œ}}) \tag{KKT condition 2} \\
&amp; \lambda &lt; \frac{p(x|w_1)}{p(x|w_2)} (R_1\large{\text{å†…éƒ¨è¦æ±‚}})  \tag{int op}
\end{align}
\]</span> â€‹ ç†è§£èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://en.wikipedia.org/wiki/Gibbs_sampling">[Wikipedia, Gibbs sampling]</a></p>
<p>[2] <a href="https://blog.csdn.net/yzheately/article/details/51164441">CSDN-EMç®—æ³•-æ•°å­¦åŸç†åŠå…¶è¯æ˜</a></p>
<p>[3] Sebastian Thrun, Wolfram Burgard, Dieter Fox <strong><em>Probabilistic Robotics</em></strong>.</p>
<p>[4] å¼ å­¦å·¥ï¼ˆç¼–è‘—ï¼‰ï¼Œæ¨¡å¼è¯†åˆ«ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ï¼Œæ¸…åå¤§å­¦å‡ºç‰ˆç¤¾</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>æ¦‚ç‡è®º</tag>
        <tag>ML</tag>
      </tags>
  </entry>
  <entry>
    <title>éª·é«…èåˆè€…-CVPR2021</title>
    <url>/2021/10/24/%E9%AA%B7%E9%AB%85%E8%9E%8D%E5%90%88%E8%80%85-CVPR2021/</url>
    <content><![CDATA[<h1 id="éª·é«…èåˆè€…">éª·é«…èåˆè€…</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ æƒ³çœ‹çœ‹CVPR2021ä¸Šéƒ½æœ‰å…³äºç‚¹äº‘é…å‡†æˆ–è€…ç‚¹äº‘å¤„ç†éƒ½æœ‰ä»€ä¹ˆæ ·çš„æ–‡ç« ï¼Œç½‘ä¸Šæœåˆ®äº†å‡ ç¯‡ï¼Œéª·é«…èåˆè€…å°±æ˜¯å…¶ä¸­ä¸€ç¯‡ã€‚è¿™ç¯‡è®ºæ–‡çš„ä½œè€…è²Œä¼¼æ˜¯ä¸Šæµ·äº¤å¤§çš„æœ¬ç§‘ç”Ÿï¼Œå—¯ æœ¬ç§‘CVPRä¸€ä½œï¼Œå¢ç­–å¾è€å¸ˆå›¢é˜Ÿï¼Œå¯ä»¥è¯´æ˜¯å¾ˆnbäº†ã€‚æœ¬è®ºæ–‡æå‡ºçš„æ€æƒ³ï¼Œä¸ªäººè®¤ä¸ºæ¯”è¾ƒç®€å•ï¼ˆå¯èƒ½æ˜¯å› ä¸ºæ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†è¢«PointNet++æ©ç›–äº†ï¼Œæ–‡ä¸­ä¹Ÿæ²¡æœ‰ä½¿ç”¨æ—¶ä¸‹æœ€ä¸ºæµè¡Œçš„ã€å˜å½¢é‡‘åˆšã€‘ï¼‰ã€‚å¹¶ä¸”çœ‹å®ŒIntroductionä¹‹åï¼Œæˆ‘å°±è§‰å¾—è¿™ä¸ªæ€æƒ³å¥½åƒåœ¨å“ªé‡Œè§è¿‡ï¼šå—·ï¼ŒåŸæ¥æ˜¯æˆ‘çš„ç¯æ¡æ£€æµ‹ä¸­å«æœ‰è¿™ä¸ªæ–¹æ³•çš„å¼±å¼±åŒ–ç‰ˆã€‚</p>
<p>â€‹ æœ¬çŸ­ç¯‡åšå®¢åªåšè¯¥è®ºæ–‡çš„ä¸€ä¸ªç®€å•åˆ†æï¼Œå¹¶ä¸é™„å¸¦å¤ç°ï¼ˆå¦‚æœè¦å¸¦å¤ç°çš„è¯ï¼Œä¸€æ˜¯éœ€è¦æ—¶é—´ï¼ŒäºŒæ˜¯éœ€è¦äº†è§£PointNet++ï¼‰ã€‚è®ºæ–‡çš„åœ°å€æ˜¯ï¼š<a href="https://arxiv.org/abs/2103.10814">arXiv: Skeleton Merger: an Unsupervised Aligned Keypoint Detector</a></p>
<p><img src="/2021/10/24/%E9%AA%B7%E9%AB%85%E8%9E%8D%E5%90%88%E8%80%85-CVPR2021/Screenshot%20from%202021-10-24%2001-40-07-16350111328661.png"></p>
<center>
Figure 1. Skeleton Merger è®ºæ–‡æ•ˆæœ
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-è®ºæ–‡æ€æƒ³">II. è®ºæ–‡æ€æƒ³</h2>
<h3 id="æ€æƒ³æ¦‚è¿°">2.1 æ€æƒ³æ¦‚è¿°</h3>
<p><img src="/2021/10/24/%E9%AA%B7%E9%AB%85%E8%9E%8D%E5%90%88%E8%80%85-CVPR2021/Screenshot%20from%202021-10-23%2023-45-48-16350111328672.png"></p>
<center>
Figure 2. Skeleton Merger è®ºæ–‡æ€æƒ³æ¡†æ¶
</center>
<p>â€‹ ä½œè€…ä½¿ç”¨äº†ä¸€ç§â€œé‡æ„è¯¯å·®â€çš„æ€æƒ³ï¼Œä½¿ç”¨ä¸€ä¸ªæ›´ç®€å•çš„è¡¨å¾ï¼Œæ¥é‡æ„ä¸€ä¸ªç‚¹äº‘ï¼Œä½¿å¾—åŸå§‹ç‚¹äº‘ä¸ç”Ÿæˆçš„ç‚¹äº‘åœ¨æŸä¸ªmetricä¸‹æœ€ä¸ºç›¸ä¼¼ã€‚è€Œæˆ‘åœ¨RMæ—¶åšçš„å·¥ä½œï¼šæ— ç›‘ç£ä¼˜åŒ–ç®—æ³•çš„ç¯æ¡æ£€æµ‹ï¼Œä¹Ÿæ˜¯ç±»ä¼¼ï¼š</p>
<ul>
<li>æ‰¾ä¸¤ä¸ªkey pointsï¼ˆç¯æ¡çš„ç«¯ç‚¹ï¼‰ï¼Œä½¿ç”¨ç¯æ¡çš„ç«¯ç‚¹æ ¹æ®hand-craftedé‡æ„æ–¹æ³•ï¼Œé‡æ„å‡ºç¯æ¡ï¼Œä½¿å¾—ç”Ÿæˆçš„ç¯æ¡ä¸åŸå§‹ç¯æ¡å›¾åƒçš„L2å·®è·æœ€å°ã€‚ï¼ˆæ‰€ä»¥å¯ä»¥è¯´ï¼Œæˆ‘å¤§äºŒä¸‹å­¦æœŸå†™çš„è¿™ä¸ªç®—æ³•æ˜¯æœ¬è®ºæ–‡çš„å¼±å¼±åŒ–ï¼‰</li>
</ul>
<p>â€‹ æœ¬æ–‡çš„æ€æƒ³å¤§æ¦‚å¯ä»¥è¢«æ€»ç»“å¦‚ä¸‹ï¼š</p>
<div class="note danger no-icon"><p>ä½¿ç”¨PointNet++ï¼Œç”Ÿæˆä¸€ä¸ªåŠ æƒçŸ©é˜µï¼ŒåŠ æƒåå¯ä»¥ç”Ÿæˆkä¸ªkey pointsï¼ŒåŒæ—¶ï¼ŒPointNet++ä¹Ÿä¼šè¾“å‡ºä¸€äº›å…¨å±€ä¿¡æ¯ã€‚ç”Ÿæˆçš„key pointsè‡ªç„¶å½¢æˆä¸€ä¸ªå®Œå…¨å›¾ã€‚</p>
</div>
<div class="note warning no-icon"><p>ä½¿ç”¨PointNet++è¾“å‡ºçš„å…¨å±€ä¿¡æ¯ï¼Œè¿‡3å±‚MLPï¼Œç”Ÿæˆã€activation strengthã€‘ï¼Œæ­¤åæˆ‘ä»¬ä¼šçŸ¥é“ï¼Œè¿™å®é™…å°±æ˜¯skeletonå®Œå…¨å›¾ä¸­ï¼Œæ¯æ¡è¾¹å­˜åœ¨çš„æ¦‚ç‡ã€‚</p>
</div>
<div class="note info no-icon"><p>å®Œå…¨å›¾ä¸Šï¼Œæ¯æ¡è¾¹éƒ½å¯ä»¥äº§ç”Ÿä¸€ä¸ªsub-cloudï¼ˆå‡åŒ€é‡‡æ ·å¾—åˆ°ï¼Œç‚¹æ•°ä¸é•¿åº¦æˆæ­£æ¯”ï¼‰ã€‚ä¹‹åé€šè¿‡ä¸€ä¸ªç½‘ç»œï¼ˆdecoderï¼‰ï¼Œå­¦ä¹ æ¯ä¸€ä¸ªç‚¹çš„offsetï¼ˆç›¸å¯¹äºéª¨æ¶çš„ç§»åŠ¨ï¼‰ï¼Œä½¿å¾—ç”Ÿæˆçš„ç‚¹äº‘å¯ä»¥è¡¨å¾æ›´åŠ å¤æ‚çš„å½¢çŠ¶ã€‚</p>
</div>
<div class="note success no-icon"><p>ä½¿ç”¨Composite Chamfer Distanceï¼ˆCCDï¼Œä¸€ç§æ”¹è¿›çš„Chamfer Distanceæ–¹æ³•ï¼‰ä½œä¸ºlosså‡½æ•°ï¼Œä½¿å¾—åŸå§‹ç‚¹äº‘ä¸ç”Ÿæˆç‚¹äº‘çš„CCDæœ€å°ã€<a href="#unsup">æ— ç›‘ç£æ¨¡å‹çš„ç”Ÿæˆå¼loss</a>ã€‘ã€‚</p>
</div>
<p>â€‹ æœ¬æ–‡ä¸æ¶‰åŠä»»ä½•ç½‘ç»œç»“æ„ä»¥åŠç½‘ç»œè®¾è®¡ï¼Œåªæ˜¯åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>å…¶æ–¹æ³•æœ‰å“ªäº›äº®ç‚¹</li>
<li>ä¸ªäººè®¤ä¸ºå…¶æ–¹æ³•å¯èƒ½å­˜åœ¨å“ªäº›ä¸è¶³</li>
</ul>
<h3 id="äº®ç‚¹">2.2 äº®ç‚¹</h3>
<p>â€‹ æœ¬äººè®¤ä¸ºï¼Œæ­¤è®ºæ–‡çªå‡ºçš„ä¸¤ä¸ªäº®ç‚¹å°±æ˜¯ï¼š</p>
<ul>
<li>skeletoné‡æ„è¯¯å·®</li>
<li>CCDè¯¯å·®å‡½æ•°çš„è®¾è®¡</li>
</ul>
<p>â€‹ é¦–å…ˆï¼Œé€šè¿‡skeletoné‡å»ºç‚¹äº‘ï¼Œæ¥è¾…åŠ©åˆ¤å®škey pointsçš„é€‰å–æ•ˆæœï¼Œå¯ä»¥ä½¿å¾—å…¶è¾¾åˆ°æ— ç›‘ç£çš„ç›®çš„ã€‚åœ¨MoCoè®ºæ–‡åˆ†æä¸­ï¼Œå®é™…ä¸Šå·²ç»è¯´è¿‡ï¼Œæ— ç›‘ç£çš„lossä¹Ÿå°±ä¸»è¦æ˜¯é‚£ä¹ˆä¸¤ç§ï¼ˆæ®æˆ‘ç›®å‰æ‰€çŸ¥çš„â€œä¸»è¦â€ï¼‰ï¼š</p>
<ul>
<li>å¯¹æ¯”lossï¼ˆä»¥MoCoä¸ºä»£è¡¨çš„ï¼‰ï¼Œä¸»åŠ¨ç”ŸæˆåŒ¹é…ä¸ä¸åŒ¹é…çš„æ ·æœ¬ï¼Œæœ€å¤§åŒ–ä¸åŒç±»åˆ«ç‰¹å¾ä¹‹é—´çš„å·®åˆ«</li>
<li>ç”Ÿæˆå¼lossï¼ˆautoencoderæ€æƒ³ï¼‰ï¼Œä¸»è¦æ€æƒ³æ˜¯ï¼šå­¦å‡ºæ¥çš„ç‰¹å¾èƒ½å¤Ÿç»è¿‡æŸç§æ–¹å¼é‡æ„è¾“å…¥ï¼Œç‰¹å¾å­¦å¾—è¶Šå¥½ï¼Œä»ç›´è§‰ä¸Šæ¥è¯´ï¼Œé‡æ„æ•ˆæœè¶Šå¥½ã€‚</li>
</ul>
<p>â€‹ ç¬¬äºŒç§æ–¹æ³•çš„æ˜¾è‘—é—®é¢˜å°±æ˜¯ï¼šä¸€èˆ¬ä¼šæœ‰æ¯”è¾ƒå¤§çš„è®¡ç®—å¼€é”€ï¼ˆç‰¹åˆ«æ˜¯é‡æ„å›¾åƒæ—¶ï¼Œé•¿é‡‡æ ·ã€åå·ç§¯ç»“æ„ç­‰ç­‰ï¼‰ã€‚ä¸ªäººæ„Ÿè§‰ï¼Œæœ¬æ–‡æ˜¯ä¸€ç§ç”Ÿæˆå¼çš„lossï¼Œä½†æ˜¯ç”±äºï¼šï¼ˆ1ï¼‰key pointsï¼ˆå¯¹åº”çš„è¾¹ï¼‰å…·æœ‰ç¨€ç–æ€§ï¼ˆ2ï¼‰å‡åŒ€é‡‡æ ·å¯†åº¦å¯æ§æ€§ï¼Œè®¡ç®—å¼€é”€å¯èƒ½ä¸ä¼šå¤ªéš¾ä»¥æ¥å—ã€‚</p>
<p>â€‹ æœ¬æ–‡ç›´æ¥å¯¹key pointså½¢æˆçš„å®Œå…¨å›¾è¿›è¡Œé‡æ„ï¼Œç”Ÿæˆä¸€ä¸ªä¸ªçš„sub-cloudï¼Œä½†æ˜¯ç”±äºæœ‰äº›è¾¹é‡‡æ ·å‡ºçš„ç‚¹ï¼Œå®é™…æ˜¯ä¸å­˜åœ¨çš„ï¼Œåº”è¯¥åœ¨å…¶å­˜åœ¨æ€§ä¸Šå°±äºˆä»¥æŠ¹æ€ï¼ˆè€Œéåœ¨offsetå­¦ä¹ é˜¶æ®µï¼Œå¼ºè¡Œå°†å…¶æ‹‰å›åˆ°æŸä¸ªä½ç½®ï¼‰ï¼Œæ•…ä½œè€…å¼•å…¥äº†activation strengthï¼Œæ¯æ¡è¾¹éƒ½å°†æœ‰ä¸€ä¸ªå¯¹åº”çš„activation strengthï¼Œç›¸å½“äºæ˜¯è¾¹æƒï¼Œè¾¹æƒå°çš„è¾¹å¯¹åº”çš„ç”Ÿæˆç‚¹åœ¨reconstructionè¿‡ç¨‹ä¸­å¯èƒ½è¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”åœ¨lossè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šå‚ä¸ã€‚</p>
<p>â€‹ æ­¤å¤–å°±æ˜¯CCDè¯¯å·®å‡½æ•°çš„è®¾è®¡ã€‚CCDæ˜¯Chamfer distanceçš„ä¸€ä¸ªæ‰©å±•ï¼ŒChamfer distanceå¯ä»¥ç®€å•åœ°å°†å…¶ç†è§£æˆï¼šæœ€é‚»è¿‘ç‚¹è·ç¦»ã€‚åœ¨ä¸€ä¸ªnç»´metric spaceä¸­ç»™å®šä¸¤ä¸ªé›†åˆAï¼ŒBï¼Œï¼ˆæ¯”å¦‚ï¼‰Aä¸­çš„æŸä¸ªç‚¹<span class="math inline">\(p_i\)</span>åˆ°Bä¸­çš„æœ€è¿‘ç‚¹çš„è·ç¦»ï¼Œå°±æ˜¯Chamfer distanceã€‚</p>
<p>â€‹ åœ¨æœ¬é—®é¢˜ä¸­ï¼Œé›†åˆAã€Båˆ†åˆ«æ˜¯ç”Ÿæˆç‚¹äº‘ä¸åŸå§‹ç‚¹äº‘ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼ŒChamfer distanceæ˜¯å•å‘çš„ï¼Œé‚£ä¹ˆéœ€ä¸éœ€è¦æ„å»ºæˆåŒå‘å¯¹ç§°çš„losså‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæœ¬é—®é¢˜æœ¬èº«å°±ä¸æ˜¯ä¸€ä¸ªå¯¹ç§°çš„é—®é¢˜ã€‚ä½œè€…åšäº†ä¸€ä¸ªåˆ†ç±»ï¼š</p>
<div class="tabs" id="class"><ul class="nav-tabs"><li class="tab active"><a href="#class-1">æ­£å‘loss</a></li><li class="tab"><a href="#class-2">åå‘loss</a></li></ul><div class="tab-content"><div class="tab-pane active" id="class-1"><p>å¯¹æ¯ä¸€ä¸ªç”Ÿæˆç‚¹äº‘ä¸­çš„ç‚¹<span class="math inline">\(p_i\)</span>ï¼Œè®¡ç®—<span class="math inline">\(p_i\)</span>åœ¨åŸå§‹ç‚¹äº‘ä¸­çš„æœ€è¿‘ç‚¹<span class="math inline">\(q_i\)</span>ï¼Œå¹¶ä¸”è®¡ç®—å¯¹åº”çš„Chamfer distanceï¼Œä½¿ä¹‹æœ€å°åŒ–ï¼Œè¿™æ˜¯åœ¨æå‡ç”Ÿæˆç‚¹äº‘çš„fidelityï¼ˆå‡†ç¡®æ€§ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šç”Ÿæˆç‚¹äº‘çš„â€œå¤§è‡´å½¢çŠ¶â€åº”è¯¥ä¸åŸå§‹ç‚¹äº‘ç±»ä¼¼ã€‚</p></div><div class="tab-pane" id="class-2"><p>å¯¹æ¯ä¸€ä¸ªåŸå§‹ç‚¹äº‘ä¸­çš„ç‚¹<span class="math inline">\(q_j\)</span>ï¼Œè®¡ç®—<span class="math inline">\(q_j\)</span>åœ¨ç”Ÿæˆç‚¹äº‘ä¸­çš„æœ€è¿‘ç‚¹<span class="math inline">\(p_j\)</span>ã€‚è¿™å°±æ˜¯ä¸å¯¹ç§°æ€§çš„ä½“ç°ï¼šå³ä¾¿ç”Ÿæˆç‚¹äº‘æ¯ä¸ªç‚¹åœ¨åŸå§‹ç‚¹äº‘ä¸Šéƒ½æœ‰å¾ˆå¥½çš„å¯¹åº”ç‚¹ï¼Œ<strong><u>ç”±äºç”Ÿæˆç‚¹äº‘å¯èƒ½å…·æœ‰ç¨€ç–æ€§</u></strong>ï¼Œåè¿‡æ¥ï¼ŒåŸå§‹ç‚¹äº‘çš„æŸäº›ç‚¹å¯èƒ½æ²¡æœ‰åŠæ³•åœ¨ç”Ÿæˆç‚¹äº‘ä¸Šæ‰¾åˆ°å¾ˆå¥½çš„å¯¹åº”ç‚¹ã€‚æ•°å­¦ä¸Šæ¥è¯´ï¼Œè¿™å°±æ˜¯ï¼šå•å°„å’Œæ»¡å°„ã€‚æ­£å‘losså¦‚æœå¾ˆå°ï¼Œåªèƒ½ä¿è¯ç”Ÿæˆç‚¹äº‘çš„<strong><u>fidelity</u></strong>é—®é¢˜ï¼Œèƒ½å»ºç«‹ä¸€ä¸ªå¾ˆå¥½çš„ ç”Ÿæˆç‚¹äº‘<span class="math inline">\(\rightarrow\)</span>åŸå§‹ç‚¹äº‘çš„å•å°„ï¼Œä½†æ˜¯åè¿‡æ¥ï¼Œå¦‚æœåŸå§‹ç‚¹äº‘çš„æ¯ä¸ªç‚¹ä¹Ÿèƒ½åœ¨ç”Ÿæˆç‚¹äº‘ä¸Šæœ‰å¾ˆå¥½çš„å¯¹åº”ï¼Œé‚£ä¹ˆå¯èƒ½å¯ä»¥å»ºç«‹ä¸€ä¸ªåŸå§‹ç‚¹äº‘<span class="math inline">\(\rightarrow\)</span>ç”Ÿæˆç‚¹äº‘çš„å•å°„ï¼Œä½¿å¾— <strong><u>coverage</u></strong>é—®é¢˜å¾—åˆ°è§£å†³ã€‚</p></div></div></div>
<p>â€‹ æ­£å‘fidelity losså¾ˆç®€å•ï¼Œå°±æ˜¯è¿™æ ·ï¼š <span class="math display">\[
\begin{equation}\label{fid}
L_f=\sum_k a_k\sum_i\Vert p_i-q_i\Vert^2,q_i=\mathop{\arg\min}_{q}\Vert p_i-q_i\Vert
\end{equation}
\]</span> â€‹ è€Œåå‘coverage losså°±æ²¡æœ‰é‚£ä¹ˆç®€å•äº†ã€‚é¦–å…ˆï¼ŒåŠ å…¥åå‘lossä¹Ÿå¦‚ä¸Šå¼ä¸€æ ·ï¼Œå®šä¹‰æˆå¯¹ç§°çš„ï¼Œé‚£ä¹ˆæœ€ç»ˆç»“æœå°†ä¼šæ˜¯ï¼šæˆ‘ç›´æ¥è®©æ‰€æœ‰<span class="math inline">\(a_i\)</span>è®­ç»ƒæˆ0å¾—äº†ï¼Œæ²¡æœ‰ç‚¹å­˜åœ¨ï¼Œå°±æ²¡æœ‰lossï¼æ˜¾ç„¶è¿™æ˜¯å¾ˆæœ‰é—®é¢˜çš„ã€‚</p>
<p>â€‹ ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¸Œæœ›<span class="math inline">\(a_i\)</span> (activation strength)å¯ä»¥èµ·åˆ°ä½œç”¨ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä»¬åˆå¸Œæœ›é¿å…ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›ä¸ä¼šå› ä¸ºå…¬å¼<span class="math inline">\(\eqref{fid}\)</span>å†…éƒ¨çš„<span class="math inline">\(a_i\)</span>å­˜åœ¨ï¼Œä½¿å¾—<span class="math inline">\(a_i\)</span>å€¾å‘äºå˜å°ã€‚ä½œè€…æå‡ºäº†ä¸¤ä¸ªç­–ç•¥ï¼š</p>
<ul>
<li>ä¸ºäº†ä½“ç°â€œcoverageâ€ï¼Œä½œè€…å°†ä¼šã€ä¸€é…å¤šã€‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å†å¯»æ‰¾è·ç¦»æœ€å°çš„ä¸€ä¸ªç‚¹ï¼Œè€Œæ˜¯ï¼šæŸ¥åˆ°ç‚¹<span class="math inline">\(q_i\)</span>åï¼Œåˆ é™¤<span class="math inline">\(q_i\)</span>æ¥æºçš„é‚£æ¡è¾¹ï¼ˆä»¥åŠæ‰€æœ‰ç‚¹ï¼‰ï¼Œå¹¶ä¸”ç´¯åŠ æœ¬è¾¹å¯¹åº”çš„activation strengthåˆ°ä¸€ä¸ªæœ¬åœ°çš„ï¼ˆåˆå§‹åŒ–ä¸º0çš„ç´¯åŠ å™¨ï¼‰å˜é‡wä¸Šã€‚å¦‚æœwå°äº1ï¼Œé‚£å°±ç»§ç»­åœ¨å‰©ä½™ç‚¹ä¸­æŸ¥æ‰¾æœ€å°è·ç¦»ç‚¹ï¼Œé‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°w&gt;1æˆ–è€…æ²¡æœ‰å®¢ç”¨è¾¹ã€‚</li>
<li>å‡è®¾å·²ç»æ²¡æœ‰å¯ç”¨è¾¹äº†ï¼Œè€Œw&lt;1ï¼Œåˆ™è¿›è¡Œæƒ©ç½šï¼ˆ<strong><u>è¯´æ˜æˆ‘ä»¬è®©<span class="math inline">\(a_i\)</span>å­¦å¾—å¤ªå°äº†</u></strong>ï¼‰ï¼Œåœ¨lossä¸Šå¢åŠ <span class="math inline">\(\gamma (1-w)\)</span>ï¼Œè®ºæ–‡ä¸­<span class="math inline">\(\gamma\)</span>é€‰å–20.0ï¼Œæ¯”è¾ƒå¤§ã€‚</li>
</ul>
<p>â€‹ ä¸Šè¿°æ“ä½œå¯ä»¥ä¿è¯ï¼š<span class="math inline">\(a_i\)</span>ä¸ä¼šå› ä¸ºä¼˜åŒ–CCDè€Œå˜å¾—å¾ˆå°ã€‚</p>
<h3 id="ä¸ªäººè§‰å¾—å­˜åœ¨çš„é—®é¢˜">2.3 ä¸ªäººè§‰å¾—å­˜åœ¨çš„é—®é¢˜</h3>
<h4 id="ç¨€ç–æ€§é—®é¢˜">2.3.1 ç¨€ç–æ€§é—®é¢˜</h4>
<p>â€‹ ä½œè€…å¦‚ä½•é‡å»ºå…¶ç”Ÿæˆç‚¹äº‘çš„å‘¢ï¼Ÿé¦–å…ˆï¼šæ ¹æ®å›¾ç»“æ„ï¼Œæ¯æ¡è¾¹è¿›è¡Œå‡åŒ€é‡‡æ ·ã€‚æ¯æ¡çº¿æ®µä¸Šæœ‰è‹¥å¹²ä¸ªç‚¹ã€‚æ­¤åä½¿ç”¨ä¸€ä¸ªç½‘ç»œè¿›è¡Œoffsetå­¦ä¹ ã€‚è¿™æ ·ä¼šå­˜åœ¨ä¸€å®šé—®é¢˜ï¼šé‡å»ºçš„ç‚¹äº‘å¯èƒ½å°±æ˜¯å¾ˆç¨€ç–ï¼Œå¯¼è‡´CCD coverage lossè®¡ç®—æ€»æ˜¯æ¯”è¾ƒå¤§ã€‚æ¯”å¦‚ï¼šä¸€ä¸ªåœ†æŸ±å‹çš„ç‰©ä½“ï¼Œåœ¨åŒä¸€é«˜åº¦ä¸Šï¼Œç»•è½´ä¸åŒè§’åº¦å¯èƒ½å­˜åœ¨å¾ˆå¤šä¸ªç‚¹ï¼Œä½†å¯¹äºæœ¬è®ºæ–‡çš„æ–¹æ³•ï¼Œä¸€ä¸ªé«˜åº¦ä¸Šå°±ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆå¯¹äºåœ†æŸ±å‹ç‰©ä½“ï¼Œåªèƒ½ä½¿ç”¨èºæ—‹å¼çš„offsetï¼Œè¿™ä¼šä½¿å¾—æŸäº›ä½ç½®ä¸Šæ¯”è¾ƒç¨€ç–ã€‚</p>
<p>â€‹ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½å¯ä»¥åœ¨åˆå§‹æ—¶åŒä¸€ä¸ªä½ç½®é‡‡æ ·å¾ˆå¤šä¸ªç‚¹ï¼Œä¹‹åä½¿å¾—è¿™äº›ç‚¹ï¼Œåœ¨è¿‡æœ¬ç‚¹ï¼Œå‚ç›´å›¾ç»“æ„è¾¹çš„å¹³é¢ä¸Šæ‰©æ•£å¼€æ¥ã€‚<strong><u>æˆ‘è®¤ä¸ºè¿™æ ·çš„è¯ï¼Œå­¦ä¹ çš„å‚æ•°å¯ä»¥å‡å°‘ï¼ˆæ¯ä¸ªç‚¹åªéœ€è¦å­¦ä¹ ä¸€ä¸ªå‚æ•°è€Œä¸æ˜¯ä¸‰ä¸ªï¼‰ï¼Œä¹Ÿå¯ä»¥è§£å†³ç¨€ç–é—®é¢˜ã€‚</u></strong></p>
<h4 id="æœ€é‚»è¿‘æœç´¢">2.3.2 æœ€é‚»è¿‘æœç´¢</h4>
<p>â€‹ è¿™åªè¯´ä¸‹æˆ‘çš„æ‹…å¿§ï¼šæœ€é‚»è¿‘æœç´¢å¿«é€Ÿå—ï¼Ÿå½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›åŠ é€Ÿçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚8å‰æ ‘ï¼ŒKDæ ‘ç­‰ç­‰ï¼Œä½†æ˜¯èƒ½æœ‰å¤šå¿«å‘¢ï¼Ÿä¸å¥½è¯´ï¼Œæˆ‘æ²¡æœ‰åšè¿‡å®éªŒï¼Œä½†æ˜¯è¿™ä¹Ÿå°±æ˜¯éå®Œå…¨çš„ç”Ÿæˆå¼lossé‡åˆ°çš„é—®é¢˜ï¼Œlossæ„å»ºæ—¶çš„ç¨€ç–æ€§é—®é¢˜ã€‚æ‰€ä»¥ä¸ªäººè®¤ä¸ºï¼Œæ­¤å¤„å¯ä»¥å°†æœ€é‚»è¿‘lossæ¢ä¸ºåˆ«çš„lossã€‚</p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>DL</tag>
        <tag>ç‚¹äº‘</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿œå¤SDFæ–‡æ¡£</title>
    <url>/2022/02/22/%E8%BF%9C%E5%8F%A4SDF%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<iframe src="//www.slideshare.net/slideshow/embed_code/key/dUI2s72z0jLiEq" width="750" height="420" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%; border-radius: 2px;;" allowfullscreen>
</iframe>
]]></content>
      <categories>
        <category>snippet</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>Taichi-Learning-II</title>
    <url>/2023/01/15/Taichi-Learning-II/</url>
    <content><![CDATA[<h1 id="taichi-lang-ii">Taichi Lang II</h1>
<hr>
<h2 id="i.-intros">I. Intros</h2>
<p>â€‹ æ·±å…¥äº†è§£Taichiè¯­è¨€ï¼Œç®€å•çš„å¹¶è¡Œç®—æ³•è®¾è®¡æ— æ³•æ»¡è¶³æˆ‘ï¼ˆæ¯•ç«ŸçœŸè¦è¯´å¹¶è¡Œç®—æ³•è®¾è®¡ï¼ŒTaichiæ‰€éœ€çš„å·¥ä½œé‡ä¸CUDAæš‚æ—¶æ²¡åŠæ³•æ¯”ï¼‰ã€‚Taichiä¸­é‡è¦çš„ä¸¤ä¸ªfeaturesï¼šç¨€ç–æ•°æ®ç»“æ„ï¼ˆSSDSï¼‰ï¼Œå¯å¾®ç¼–ç¨‹ï¼ˆdifferentiable programmingï¼‰ç›®å‰å¯¹æˆ‘è€Œè¨€æ¯”è¾ƒé‡è¦çš„å°±æ˜¯SSDSï¼Œå¯å¾®ç¼–ç¨‹... å¯å¾®æ¸²æŸ“å¯èƒ½å¯ä»¥ç”¨åˆ°ï¼Œä½†æ˜¯æœ¬èº«å®åœ¨æ˜¯å¤ªå¤æ‚äº†... æˆ‘ä¸€ç›´è§‰å¾—ï¼Œä¸åŠ¨æ‰‹å°±å­¦ä¸åˆ°çœŸæ­£çš„çŸ¥è¯†ï¼Œæ‰€ä»¥è¿˜æ˜¯ç»™è‡ªå·±å¸ƒç½®äº†ä¸€é“é¢˜ï¼Œå¹¶ä¸”è¦æ±‚å°†SSDSä»¥åŠåœ¨ç¬¬ä¸€ç¯‡åšå®¢å®Œæˆåå­¦åˆ°çš„å†…å®¹æ•´åˆåˆ°æ­¤é¢˜çš„è§£ç­”ä¸­ã€‚æœ¬æ–‡æ˜¯æœ€åä¸€ç¯‡Taichi å…¥é—¨åšå®¢ï¼Œå…³äºä¸€äº›è¿›é˜¶çš„ç”¨æ³•ä»¥åŠç‰¹æ€§ï¼Œä»¥åŠåœ¨å®ç°é¢˜ç›®ï¼šflocking simulationï¼ˆé¸Ÿç¾¤æ¨¡æ‹Ÿï¼‰ä¸­æ‰€å­¦åˆ°çš„ä¸€äº›çŸ¥è¯†ã€‚æ–‡æœ«é™„æœ‰flocking simçš„è§†é¢‘ã€‚</p>
<p>â€‹ é¢„è®¡æˆ‘ä¸‹ä¸€æ­¥å°†ä¼šä½¿ç”¨Taichiå†™ä¸€ä¸ªå¸¦æœ‰participating mediaåŠŸèƒ½çš„path tracerï¼ˆ3Dï¼Œä¹‹å‰Rust + CUDAå†™äº†ä¸€ä¸ªæ²¡å¼€æºçš„2D tracerï¼Œåªèƒ½çœ‹å…‰è·¯ï¼Œä¸èƒ½çœ‹æ¸²æŸ“ç»“æœï¼ˆæ¯•ç«Ÿæ˜¯2Dï¼‰ï¼‰ï¼Œä»¥åŠ æ·±æˆ‘å¯¹å…‰çº¿è¿½è¸ªç®—æ³•çš„ç†è§£ã€‚ä¸è¿‡è¿™æ˜¯ä¸ªå¤§é¡¹ç›®ï¼Œç®€å•ç‰ˆæœ¬çš„ä¹Ÿè‡³å°‘æ¶‰åŠåˆ°meshçš„è¯»å–ã€åŠ è½½ã€å…‰çº¿å¼¹å°„ã€é‡‡æ ·ã€ä»‹è´¨å®ç°ã€è’™ç‰¹å¡æ´›ç§¯åˆ†ç­‰ç­‰... æƒ³æƒ³å°±åˆºæ¿€ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">frame 52 (çº¢è‰²ä¸ºæ é£Ÿè€…ï¼Œç™½è‰²ä¸ºæ™®é€šé¸Ÿ)</th>
<th style="text-align: center;">frame 58 (çº¢è‰²ä¸ºæ é£Ÿè€…ï¼Œç™½è‰²ä¸ºæ™®é€šé¸Ÿ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2023/01/15/Taichi-Learning-II/000052.png" alt="000052"></td>
<td style="text-align: center;"><img src="/2023/01/15/Taichi-Learning-II/000058.png" alt="000058"></td>
</tr>
</tbody>
</table>
<center>
Figure 1. Flocking simulation with predators (64 regular boids (this is not a typo) and 4 predators)
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-type-system">II. Type System</h2>
<h3 id="type-system">2.1 Type System</h3>
<h4 id="prerequisites-casting">2.1.1 Prerequisites &amp; Casting</h4>
<p>â€‹ å…¶å®è¿™éƒ¨åˆ†å¹¶æ²¡æœ‰å¤ªå¤šå¯ä»¥è¯´çš„ï¼Œåªæœ‰äº›é›¶é›¶ç¢ç¢çš„ç‚¹éœ€è¦æé†’ï¼Œæˆ‘åœ¨å®ç°çš„æ—¶å€™æ²¡æœ‰é‡åˆ°å¤ªå¤šæœ‰å…³ç±»å‹çš„é—®é¢˜ã€‚é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒTaichiæ˜¯é™æ€å¼ºç±»å‹è¯­è¨€ï¼Œæ‰€ä»¥ç±»å‹ä¸èƒ½ä¹±æ¥ã€‚è™½ç„¶å…¶æ’°å†™æ—¶çš„è¯­æ³•å°±æ˜¯Pythonï¼Œä½†ç”±äºæ²¡æœ‰æ˜¾å¼ç±»å‹å£°æ˜ï¼Œç±»å‹æ¨æ–­ä»¥åŠéšå¼ç±»å‹è½¬æ¢å¯èƒ½å¯¼è‡´éå¸¸å¤šçš„é—®é¢˜ã€‚é¦–å…ˆè¯´ä¸€ä¸‹ type alias ä»¥åŠä¸€äº›å…¥é—¨çº§å‰ç½®çŸ¥è¯†ï¼š</p>
<ul>
<li>Type aliaså®é™…ä¸Šæ˜¯Taichi default typeså¯ä»¥ä½¿ç”¨çš„åˆ«åï¼Œä¾‹å¦‚ä¸è¿›è¡Œç‰¹æ®Šè®¾ç½®ï¼ˆ<code>ti.init</code>æ—¶ï¼‰ï¼Œ<code>float = ti.f32</code>ï¼Œ<code>int = ti.i32</code>ï¼Œ<code>float, int</code>åˆ†åˆ«ä¸º<code>ti.f32, ti.i32</code>çš„ type aliases</li>
<li>Taichiæœ‰ä¸¤å¤§ç±»ç±»å‹ï¼šprimitive typesï¼Œå°±æ˜¯åŸºç¡€ç±»å‹ï¼Œè¯¸å¦‚<code>f32, i32, u8</code>ç­‰ç­‰ï¼Œæ²¡æœ‰boolean typeï¼ˆç”¨<code>i32</code>ä»£æ›¿ï¼‰ã€‚å¦ä¸€ç±»æ˜¯ compound typesï¼Œä¹Ÿå³å¤æ‚çš„æ•°æ®ç»“æ„ï¼švectorï¼Œmatrixï¼ˆvectorå°±æ˜¯matrixï¼‰ï¼Œ<code>ndarray</code>ä»¥åŠstructï¼ˆå…¶å®æˆ‘ç°åœ¨éƒ½è¿˜æ²¡æ€ä¹ˆç”¨åˆ°<code>ndarray</code>ï¼‰ã€‚ä¸Šä¸€ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ç®€è¦åˆ†æäº†ä¸€ä¸‹fieldä¸<code>ndarray</code>çš„åŒºåˆ«ï¼š<code>ndarray</code>ä¸å…è®¸åœ¨kernelå†…è¿›è¡Œécompile-time-knownçš„indexingæ“ä½œã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼Œ<code>ndarray</code>æ˜¯compound typeï¼ˆå…·æœ‰æ˜ç¡®çš„ç±»å‹ï¼‰ï¼Œè€Œfieldä¸å…·æœ‰æ˜ç¡®çš„ç±»å‹ï¼ˆæ˜¯ä¸€ä¸ªå¤æ‚containerï¼‰ã€‚</li>
</ul>
<p>â€‹ æ­¤å¤–ï¼Œåœ¨ä¸Šç¯‡åšå®¢ä¸­å¿˜è®°è¯´äº†ï¼Œæˆ‘åœ¨å¼€å§‹å­¦Taichiæ—¶æ›¾ç»ç¢°åˆ°è¿™æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>æ•™ç¨‹ä¸­ç®€å•çš„exampleså…¨éƒ½å°†fieldè®¾ä¸ºå…¨å±€å˜é‡ã€‚ä½¿ç”¨å…¨å±€å˜é‡å¹¶ä¸æ˜¯å¥½ä¹ æƒ¯ï¼Œå¹¶ä¸”å¾ˆä¸‘ï¼ˆå°è£…æ€§å¾ˆå·®ï¼‰</li>
<li>å¼€å§‹æ—¶æˆ‘æƒ³<strong><u>å°†fieldä½œä¸ºå‚æ•°ä¼ å…¥kernelå‡½æ•°</u></strong>ã€‚ä½†æ˜¯é‡åˆ°äº†type annotationçš„é—®é¢˜ï¼šæˆ‘æ— æ³•æ‰¾åˆ°fieldçš„typeå®šä¹‰ï¼šä»æˆ‘ç°åœ¨æ‰€å­¦çš„çŸ¥è¯†æ¥çœ‹ï¼Œå¯èƒ½ç¡®å®æ‰¾ä¸åˆ°ï¼Œæ¯•ç«Ÿfieldä¸æ˜¯ä¸¤å¤§ç±»å‹ä¸­çš„ä»»æ„ä¸€ç§ã€‚</li>
</ul>
<p>â€‹ äºæ˜¯æˆ‘è§‰å¾—ï¼šè¯´ä¸å®šä½œè€…å¹¶ä¸æƒ³è®©fieldä¼ æ¥ä¼ å»å‘¢ï¼Ÿäºæ˜¯ä¹‹åçš„ä¸‰ä¸ªå°demoå…¨éƒ¨æ”¹æˆäº†ä½¿ç”¨<code>@ti.data_oriented</code>çš„classã€‚<strong><u>ä½†fieldæ— æ³•å½“å‚æ•°ä¼ é€’æ˜¯ä¸ªé”™è¯¯çš„æƒ³æ³•</u></strong>ï¼Œæˆ‘çŠ¯è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºä¸¤å¤©çš„å…¥é—¨å­¦å¾—å¤ªæµ…ã€‚æ­¤æ¦‚å¿µå®é™…ä¸Taichi metaprogrammingå…³ç³»éå¸¸å¯†åˆ‡ï¼Œè¿™é‡Œè¯´åˆ°fieldçš„ç±»å‹å°±å¿ä¸ä½è·‘äº†ä¸ªé¢˜...ï¼Œä¸‹é¢è¯´è¯´castingã€‚</p>
<p>â€‹ <code>ti.cast</code>å¯ä»¥æ‰§è¡Œç±»å‹è½¬æ¢ï¼ˆåœ¨compile timeå¯¹æŸä¸ªå˜é‡å¼ºåˆ¶èµ‹äºˆæŸä¸ªç±»å‹ï¼Œä»¥å…implicit casting / type inferenceé€ æˆçš„ç±»å‹é”™è¯¯ï¼‰</p>
<div class="note danger"><p>â€‹ ä½†æ˜¯æ³¨æ„ï¼Œæ­¤å‡½æ•°åªèƒ½åœ¨<code>ti.init</code>ä¹‹åä½¿ç”¨ï¼Œå¹¶ä¸”è¿”å›å€¼å¹¶ä¸æ˜¯primitive typesï¼š</p>
<ul>
<li>è¿”å›å€¼ç±»å‹æ˜¯<code>ti.Expr</code>ï¼ˆä¸ªäººå¯¹Exprçš„ç†è§£ç±»ä¼¼Eigenåº“ï¼Œè¡¨è¾¾å¼æ¨¡æ¿è¿ç®—ï¼Œæƒ°æ€§è®¡ç®—ï¼Œcompileï¼‰ï¼Œä¸ä¸‹é¢æ‰€è¡¨è¾¾çš„æ„æ€æ¯”è¾ƒä¸€è‡´ï¼šå…ˆç”Ÿæˆç±»ä¼¼è¡¨è¾¾å¼æ¨¡æ¿çš„ä¸œè¥¿ï¼ˆç›¸å½“äºçŸ¥æ™“æ¥ä¸‹æ¥è¦è¿›è¡Œä»€ä¹ˆæ“ä½œï¼‰ï¼Œå¹¶ä¸”ç”±äºTaichiå¯¹äºplatformæ•æ„Ÿï¼Œä¹˜æ³•æ“ä½œåœ¨ä¸åŒçš„backendä¸‹å®ç°å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥æ€»æ˜¯å…ˆç”Ÿæˆä¸€ä¸ªExprï¼ŒExprä¸­çš„ä¹˜æ³•æ“ä½œä¼šæ ¹æ®backendè¿›è¡Œä¸åŒçš„è°ƒç”¨ã€‚</li>
</ul>
<blockquote>
<p><a href="https://forum.taichi-lang.cn/t/what-does-expr-stands-for/78">æ¥è‡ªè¿™é‡Œ</a>: In fact, when you type <code>x * 2</code>, itâ€™s not evaluated immediately. Thatâ€™s why we need x to be <code>Expr</code>. What <code>Expr</code> express is not a value, but an instruction.</p>
</blockquote>
</div>
<p>â€‹ åœ¨ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä¹Ÿæåˆ°äº†<code>Expr</code>å¯¼è‡´çš„ä¸€äº›è¯¯è§£ï¼ˆä¾‹å¦‚ç›´æ¥ä½¿ç”¨çœ‹ä¼¼ä¸ºintegerçš„å˜é‡ä¸ºä»€ä¹ˆæ— æ³•ç›´æ¥indexingï¼‰ï¼Œä¸ªäººè§‰å¾—åº”è¯¥ä¸æƒ°æ€§è®¡ç®—æœ‰ä¸€å®šçš„å…³ç³»ã€‚æ•…åœ¨<code>kernel</code>å‡½æ•°ä¸­ï¼Œä¸€èˆ¬æ— æ³•è°ƒç”¨<code>numpy</code>ç­‰å‡½æ•°ï¼ˆè®¡ç®—å¼ é‡ã€æ•°å€¼è€Œéè¡¨è¾¾å¼è¿ç®—ï¼‰ï¼Œè€ŒTaichiå‡½æ•°æœ‰å¤„ç†è¡¨è¾¾å¼ä»¥åŠç«‹å³æ•°ï¼ˆå¯ä»¥ç†è§£ä¸º<code>constexpr</code>è¿ç®—ä¹ˆï¼‰çš„èƒ½åŠ›ã€‚</p>
<ul>
<li><code>ti.i32, ti.f64</code>è¿™æ ·çš„æ“ä½œä¹Ÿå¯ä»¥è¿›è¡Œcastingï¼Œå¹¶ä¸”ç”±äº<code>int, float</code>æ˜¯å¯¹åº”çš„default typesï¼Œæ•…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ä½œä¸ºcastingæ–¹æ³•ï¼Œä¾‹å¦‚<code>ti.f32(1)</code></li>
</ul>
<div class="note info"><p>â€‹ Taichiä¸­èƒ½type annotationçš„åœ°æ–¹å°½é‡type annotationï¼Œå¹¶ä¸”ä¸è¦å†™å¾—å¤ªåƒpythonï¼ˆä¾‹å¦‚è®©è§£é‡Šå™¨è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼‰ï¼Œè¯¥æ‰‹åŠ¨å¼ºåˆ¶ç±»å‹è½¬æ¢çš„åœ°æ–¹å°½é‡æ‰‹åŠ¨è½¬ï¼šï¼ˆ1ï¼‰éšå¼ç±»å‹è½¬æ¢ç»å¸¸å‡ºé—®é¢˜ï¼ˆ2ï¼‰ä¸å‡ºé—®é¢˜ä¹Ÿæœ‰å¯èƒ½å› ä¸ºæŸå¤±ç²¾åº¦è€Œåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥ä¸€å †çƒ¦äººçš„warnings</p>
</div>
<h4 id="compound-types">2.1.2 Compound Types</h4>
<p>â€‹ vectorä»¥åŠmatrixå°±ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œåªæä¸€ä¸ªä¸æ€§èƒ½ç›¸å…³çš„ç‚¹ï¼Œä¸ªäººè§‰å¾—æœ‰ç‚¹å‘ï¼ˆä¸çœ‹æ–‡æ¡£æ˜¯ä¸çŸ¥é“çš„ï¼‰ï¼š</p>
<div class="note "><p>â€‹ Matrixä»¥åŠvectoræ“ä½œåœ¨compileæ—¶ä¼šè¿›è¡Œunrollingï¼š<code>a = [[1, 2, 3], [4, 5, 6]]</code>ä¼šæˆä¸ºå¯¹åº”indexçš„èµ‹å€¼ï¼ˆåˆšå­¦åˆ°è¿™é‡Œçš„æ—¶å€™æˆ‘è§‰å¾—éå¸¸æ€ªï¼šæ˜æ˜æ˜¯spatially neighboringçš„æ•°æ®ï¼Œè¿™æ ·ä¸ä¼šå½±å“æ•ˆç‡å—ï¼Ÿå¯ä»¥SIMDå—ï¼Ÿç­”æ¡ˆæ˜¯ï¼šç¡®å®ä¼šå½±å“æ•ˆç‡ï¼‰</p>
<blockquote>
<p>Operating on larger matrices (for example <code>32x128</code>) can lead to <strong>longer compilation time</strong> and <strong>poorer performance</strong>. For performance reasons, it is recommended that you keep your matrices small. (So bad)</p>
</blockquote>
</div>
<p>â€‹ Structè¿™ç©æ„ï¼Œç†Ÿæ‚‰Cçš„åŒå¿—ä»¬åº”è¯¥å¹¶ä¸é™Œç”Ÿï¼ˆï¼Ÿå¥‡å¦™çš„é€»è¾‘ï¼‰ã€‚ä½†å°±æˆ‘å½“å‰å¯¹structçš„ç†è§£ï¼ˆæ¶‰åŠåˆ°advanced containerçš„éƒ¨åˆ†å†…å®¹ï¼Œå¦‚SoAä»¥åŠAoSï¼‰ï¼Œæƒ³è¦è¿½æ±‚æ€§èƒ½æœºåˆ¶æ—¶å¯¹äºstructçš„ä½¿ç”¨éœ€è¦æ…ä¹‹åˆæ…ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œstructå­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®©æ•°æ®æ›´æœ‰ç»„ç»‡ï¼Œæ¯ä¸ªå…·ååŸŸè¡¨è¾¾ä¸€ä¸ªæ¸…æ™°çš„å«ä¹‰ï¼Œå¦‚ï¼š<code>name</code>, <code>age</code>ç­‰ç­‰ã€‚ä½†ç”±äºstructåœ¨ç‰©ç†å®ç°ä¸Šæ˜¯ç©ºé—´è¿ç»­çš„ç»“æ„ï¼Œç©ºé—´è¿ç»­æ€§ä»¥åŠå†…å­˜çš„åˆ†é¡µæœºåˆ¶å°†äº§ç”Ÿä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œå…·ä½“çš„è®¨è®ºç•™åˆ°<a href="#3-1">ã€ç¬¬ä¸‰èŠ‚3.1 SoA vs. AoSã€‘</a>ã€‚æˆ‘åœ¨è¿™é‡Œè¯´è¿™ä¸ªæ˜¯æƒ³å¼ºè°ƒï¼šæŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæˆ‘å¹¶ä¸æ¨èæ— è„‘ç…§æ¬C/C++é‚£ä¸€å¥—å°è£…æ•°æ®ä¸€å®šå°±å¾—ä¸Šstructç”šè‡³classçš„æ€æƒ³ã€‚</p>
<p>â€‹ é¦–å…ˆï¼Œå¦‚ä½•åˆ›å»ºä¸€ä¸ªhigh level compound type structæï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ti.types.struct(a = type_1, b = type_2, ...)</span><br></pre></td></tr></table></figure>
<p>â€‹ å…¶ä¸­ï¼Œ<code>type_1</code>ä»¥åŠ<code>type_2</code>å¯ä»¥æ˜¯primitive typesæˆ–è€…compound typesï¼Œæ³¨æ„ä¸Šè¿°ä»£ç è¿”å›äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼ˆä¸€ä¸ªstructç±»å‹ï¼Œè€Œéstructå®ä¾‹ï¼‰ã€‚ç”±äºstructä¹Ÿæ˜¯compound typeï¼Œstructçš„å¤åˆæ˜¯å¯ä»¥çš„ï¼Œä½†è²Œä¼¼structçš„æ„é€ å¿…é¡»ä½¿ç”¨keyword argumentsï¼ˆå³ä¾¿æŒ‰é¡ºåºï¼Œä¸ä½¿ç”¨keyword argumentsï¼Œåˆ™éœ€è¦å°†å†…éƒ¨structå±•å¼€ï¼Œæ¯”å¦‚çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vec2 = ti.types.vector(<span class="number">2</span>, <span class="built_in">float</span>)</span><br><span class="line">inner_type = ti.types.struct(weight = <span class="built_in">int</span>, center = vec2)</span><br><span class="line">ball_type = ti.types.struct(desc = inner_type, radii = vec2)</span><br></pre></td></tr></table></figure>
<p>â€‹ ä»¥ä¸Šä¾‹å­å®šä¹‰äº†ä¸€ä¸ªæ¤­çƒï¼ˆç”±äºradiiæ˜¯äºŒç»´å‘é‡ï¼Œæ„å‘³ç€å¯ä»¥é•¿çŸ­è½´å¯ä»¥ä¸åŒé•¿åº¦ï¼‰ã€‚å¦‚æœè¦è¿›è¡Œæ„é€ ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ball_1 = ball_type(desc = inner_type(<span class="number">2</span>, vec2([<span class="number">1</span>, <span class="number">3</span>])), radii = vec2([<span class="number">0.5</span>, <span class="number">0.5</span>]))</span><br><span class="line">ball_2 = ball_type(<span class="number">2</span>, vec2([<span class="number">1</span>, <span class="number">3</span>]), vec2([<span class="number">0.5</span>, <span class="number">0.5</span>]))</span><br></pre></td></tr></table></figure>
<p>â€‹ ç¬¬ä¸€ç§æ„é€ æ–¹æ³•éœ€è¦é™å®škeyword argumentsï¼Œç›´æ¥è¿™æ ·æ„é€ æ˜¯ä¸è¡Œçš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ball_1 = ball_type(inner_type(<span class="number">2</span>, vec2([<span class="number">1</span>, <span class="number">3</span>])), vec2([<span class="number">0.5</span>, <span class="number">0.5</span>]))</span><br></pre></td></tr></table></figure>
<p>â€‹ ä¼šæŠ¥å¦‚ä¸‹é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TypeError: int() argument must be a string, a bytes-like object or a number, not &#x27;Struct&#x27;</span><br></pre></td></tr></table></figure>
<p>â€‹ åªèƒ½è¯´å¾ˆå¥‡å¦™ï¼Œä¸C++ç¡®å®æ¯”è¾ƒä¸åŒï¼ŒC++å°±æ²¡æœ‰explicit keyword argumentè¿™ä¸€è¯´ã€‚è€Œ<code>ti.dataclass</code>åˆ™æä¾›äº†å¦‚åŒrustä¸€èˆ¬çš„structå®šä¹‰æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ti.dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ball</span>:</span><br><span class="line"><span class="meta">	@ti.dataclass</span></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">Inner</span>:</span><br><span class="line">		center: vec2</span><br><span class="line">		radius: <span class="built_in">float</span></span><br><span class="line">	inner: Inner</span><br><span class="line">	weight: <span class="built_in">int</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ä½¿ç”¨å†’å·è¿›è¡Œtype annotateï¼ˆå½“åštype definitionï¼‰ï¼Œè¿™ä¸€ç‚¹ä¸Rustå¾ˆåƒï¼Œæ­¤åä¸ç”¨ä»»ä½•å…¶ä»–æ–¹æ³•ï¼ˆå½“åšstructç”¨å°±å¥½äº†ï¼Œå®é™…ä¸Šå…¶ç±»å‹ä¹Ÿæ˜¯<code>Struct</code>ï¼‰ã€‚åŸå§‹Pythonåˆ™ä¸æ”¯æŒè¿™ä¹ˆåšï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    	a: <span class="built_in">int</span></span><br><span class="line"><span class="comment"># test = Test(1)		 å½“ç„¶æ˜¯ä¼šæŠ¥é”™çš„</span></span><br><span class="line">test = Test()</span><br><span class="line">test.a							<span class="comment"># åªç•™type hintçš„è¯ï¼Œaå½“ç„¶æ˜¯NoneTypeï¼ˆæ²¡æœ‰å®šä¹‰ï¼Œåªæœ‰â€œå£°æ˜â€å½“ç„¶æ²¡æœ‰ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ä½†å¾ˆå¯æƒœçš„æ˜¯ï¼Œ<code>dataclass</code>å®šä¹‰çš„structï¼ˆåœ¨Pythonä¸­æ˜¯å¸¦æœ‰<code>@ti.dataclass</code>ä¿®é¥°çš„classï¼‰å¹¶ä¸æ”¯æŒç»§æ‰¿ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†åº”ç”¨å§ï¼Ÿï¼ˆè‡³å°‘åœ¨æˆ‘çš„flocking simulationä¸­ï¼Œæˆ‘æ›¾ç»æƒ³ä½¿ç”¨<code>dataclass</code>ä¿®é¥°ç±»ä½œä¸ºåŸºç±»ï¼Œä½†å‘ç°è¿™ç©æ„å·²ç»æ˜¯<code>final</code>äº†ï¼‰ï¼Œè¿™ä¸ªä¾‹å­æˆ‘åœ¨ç¬¬ä¸‰èŠ‚ä¼šç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<hr>
<h2 id="iii.-spatially-sparse-data-structure-å®ä¾‹åˆ†æ">III. Spatially Sparse Data Structure å®ä¾‹åˆ†æ</h2>
<h3 id="background">3.0 Background</h3>
<p>â€‹ æœ¬èŠ‚æ‰€ä»‹ç»çš„å†…å®¹ä¸º Taichi ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ï¼ŒåŸºç¡€çŸ¥è¯†éƒ¨åˆ†å‚è§ <a href="https://docs.taichi-lang.org/docs/field">Taichi Lang Docs: Data Containers</a>ã€‚Taichi åšè¿™æ ·çš„è®¾è®¡æœ‰å……åˆ†çš„ç†ç”±ï¼šç¨€ç–çš„æ•°æ®ç»“æ„ï¼ˆSpatially Sparse Data Structure - SSDSï¼‰éœ€è¦æœ‰æ›´åŠ æœ‰æ•ˆçš„å¹¶è¡Œæ“ä½œå®ç°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç¬”è€…åœ¨ç ”ä¸€ä¸Šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªå­¦æœŸï¼‰æ—¶é™·åœ¨CUDAä¸­ï¼Œå› ä¸ºå†™CUDAå°±åƒç‚’æœŸè´§ï¼šé£é™©å·¨å¤§ï¼ˆè°ƒå‚å›°éš¾ï¼Œå¹¶ä¸”éœ€è¦å……åˆ†çš„å†…å­˜ã€é€»è¾‘è®¾è®¡æ‰èƒ½å¿«ï¼‰ä½†å¯ä»¥ç»™äººä¸€ç§å·¨å¤§çš„æˆå°±æ„Ÿï¼ˆå‰ææ˜¯å†™å‡ºæ¥èƒ½è·‘ã€ç»“æœå¯¹ã€é€Ÿåº¦å¿«ã€èƒ½æ­£ç¡®é“¾æ¥åˆ°Rustä¸Šè¿›è¡Œå¯è§†åŒ–ï¼‰ã€‚CUDAä¸­å°±æœ‰ä¸¤ä¸ªé‡è¦çš„featureé™åˆ¶äº†ç¨€ç–æ•°æ®ç»“æ„çš„ä½¿ç”¨ï¼š</p>
<ul>
<li>CUDAä¸­çš„å†…å­˜æ“ä½œï¼ˆè¿™ä¸€ç‚¹éå¸¸æ·±ï¼Œæˆ‘ä¹Ÿåªèƒ½ç®—é—¨å¤–æ±‰ï¼‰ï¼šæ¯”å¦‚memory coalescing (â€œhave consecutive threads access consecutive memory addressesâ€[1]) ä»¥åŠå†…å­˜å¸¦å®½ä¼˜åŒ–ç­‰ã€‚è¦å¥½ç†è§£çš„è¯ï¼Œå‡è®¾æœ‰ä¸€ä¸ªC++ vectorä»¥åŠC++ dequeå­˜åœ¨GPUä¸Šï¼Œç”±äºvectoræ˜¯è¿ç»­å†…å­˜ï¼Œè¯»å–å¯¹å†…å­˜æ“ä½œæ˜¯å‹å¥½çš„ï¼ˆåœ¨CPUä¸Šä¹Ÿæ˜¯ï¼Œç‰¹åˆ«æ˜¯æœ‰åˆ†é¡µæœºåˆ¶æ—¶ï¼‰è¦åŸºäºvectoråšç¨€ç–å­˜å‚¨ç»“æ„ï¼Œåˆ™éœ€è¦ä¸€å®šçš„è¾…åŠ©ç»“æ„ï¼ˆå¦‚boolean flagsï¼‰ã€‚è€Œdequeå¯ä»¥åšåˆ°ç¨€ç–ï¼ˆç”±äºå…¶éè¿ç»­è¯»å–ï¼Œè™½ç„¶iteratorçš„ä½¿ç”¨éšè—äº†è¿™ä¸€ç‚¹ï¼‰ï¼Œä½†åˆ†æ•£çš„å†…å­˜ä¸ä¾¿äºå†…å­˜æ“ä½œçš„ä¼˜åŒ–ã€‚</li>
<li>warp divergenceï¼šåŸºäºflagã€bitmaskç­‰çš„æ•°æ®ç»“æ„å¯ä»¥é€šè¿‡åˆ¤å®šæŸå—åŒºåŸŸæ˜¯å¦validè¾¾åˆ°å¯¹äºinvalidå—ä¸è¿›è¡Œå†…å­˜åˆ†é…çš„ç›®çš„ã€‚ä½†åœ¨GPUä»£ç ä¸­ï¼Œåˆ¤æ–­åº”å½“å°½å¯èƒ½é¿å…ï¼ˆé™¤éå¦ä¸€ä¸ªbranchæ˜¯NOPï¼‰ï¼Œå¦åˆ™å°±ä¼šäº§ç”Ÿdivergence serializationé—®é¢˜ã€‚</li>
</ul>
<p>â€‹ å¼ºå¦‚Nvidiaï¼Œè®¾è®¡å‡ºæ¥çš„CUDAï¼Œä¹Ÿä¸æ˜¯ç‰¹åˆ«é€‚åˆSSDS... æ‰€ä»¥Taichiå‡ºæ‰‹äº†ã€‚SSDSçš„åº”ç”¨å¹¿æ³›æ€§ä¸ç”¨å¤šè¯´ï¼Œä¾‹å¦‚åŸºäºvoxelsçš„NeRFï¼Œå¼ºä¸€ç‚¹å¯ä»¥ä½¿ç”¨coarse-to-fine resolutionsçš„å±‚çº§voxelsï¼Œå¼±ä¸€ç‚¹çš„åšä¸€ä¸ªempty voxel cullingæ€»æ˜¯å¯ä»¥çš„å§ï¼Ÿè¿™äº›éƒ½æ¶‰åŠåˆ°å°†ä¸€ä¸ªdenseçš„å†…å­˜å—å˜ä¸ºsparseçš„æ“ä½œï¼ˆæˆ–è€…æ˜¯å†…å­˜çš„åˆ†çº§ç®¡ç†ï¼‰ï¼ŒTaichiåˆ™æœ‰è¿™æ ·çš„APIï¼ˆæˆ–è€…å†…éƒ¨ç‰¹æ€§ï¼‰ã€‚</p>
<p><img src="/2023/01/15/Taichi-Learning-II/sparse_grids_3d.jpg"></p>
<center>
Figure 2. SSDS Taichi official examples: fluid particle / multi-res grid mixture representation simulation[2]
</center>
<p>â€‹ å…‰çœ‹æ–‡æ¡£æ˜¯æ²¡ç”¨çš„ï¼ˆå†æ¬¡quoteè¥¿äº¤åˆ˜é¾™å†›è€å¸ˆçš„è¯ï¼šâ€è¯»è®ºæ–‡ä¸å¤ç°ç­‰äºç™½è¯»â€œï¼‰ã€‚ç¡®å®ï¼Œè¯»ä¹¦ä¸ä¸Šè¯¾ä¼šç»™äººä¸€ç§ä½ å·²ç»å­¦ä¼šäº†çš„é”™è§‰ï¼Œä½†åœç•™äºâ€çŸ¥é“äº†ã€äº†è§£äº†â€œç­‰çº§çš„â€å­¦ä¼šâ€œæ˜¯æ²¡ç”¨çš„ï¼Œåªèƒ½ç”¨äºå¹é€¼ï¼›æˆ‘ä»¬åº”å½“æ—¶åˆ»è¿½æ±‚â€ä¼šç”¨ï¼Œæ·±å…¥å®éªŒäº†â€œç­‰çº§çš„â€å­¦ä¼šâ€œã€‚æ‰€ä»¥æˆ‘ç»™è‡ªå·±Taichiå…¥é—¨çº§åˆ«å­¦ä¹ å®šçš„æœ€åä¸€ä¸ªä½œä¸šæ˜¯ï¼šFlocking simulation (<a href="http://www.red3d.com/cwr/boids/">Craig Reynolds' Boid Algorithm</a>)ã€‚æˆ‘å¾ˆæ—©ä¹‹å‰å°±æ³¨æ„åˆ°è¿™ä¸ªç®—æ³•äº†ï¼ˆå½“æ—¶æ‰å¤§å››ï¼Œåœ¨å­¦Rustï¼Œè‹¦äºä¸çŸ¥é“ç”¨ä»€ä¹ˆå¯è§†åŒ–åº“çš„æ—¶å€™ï¼‰ï¼Œé—®é¢˜å‚è€ƒã€<a href="First%20rust%20program%20%7C%20flocking%20simulation.">Reddit: First rust program | flocking simulation.</a>ã€‘ï¼Œä½†æˆ‘å¹¶ä¸æƒ³å»å¤ç°å®ƒã€‚å¯¹äºç®€å•çš„ç®—æ³•ï¼Œå¤ç°åˆ«äººçš„å¤ç°ï¼ˆå¤ç°<span class="math inline">\(^2\)</span>ï¼‰å¹¶æ²¡æœ‰å¤ªå¤§çš„æ„æ€ï¼Œå°è¯•ç”¨è‡ªå·±çš„ç†è§£å†™å‡ºç®—æ³•æ‰æ˜¯æœ‰è¶£çš„äº‹æƒ…ã€‚äºæ˜¯æˆ‘åªå‚è€ƒäº†å…¶ç¾æœ¯è®¾è®¡ï¼ˆç¡®å®ï¼Œnannouçœ‹èµ·æ¥æŒºé«˜å¤§ä¸Šçš„ï¼‰ï¼Œç”¨Taichiå†™äº†ä¸€ä¸ªflocking simulationï¼ˆå¯èƒ½ä¸Craig Reynolds' Boid Algorithmä¸å¤ªåƒï¼Œæ¯•ç«Ÿæˆ‘åªç”¨äº†å…¶æœ€æŠ½è±¡çš„æ€æƒ³ï¼Œä»€ä¹ˆseparation, alignmentä»¥åŠcohesionï¼Œå…·ä½“è¿™å‡ ä¸ªé¸Ÿç¾¤æ€§è´¨æ€ä¹ˆå®ç°éƒ½å¾—è‡ªå·±è®¾è®¡ï¼‰ã€‚æˆ‘åœ¨æœ¬å°é¡¹ç›®ä¸­å°è¯•ä½¿ç”¨SSDSåŠ é€Ÿé‚»è¿‘æœç´¢ï¼ˆneighbor searchï¼‰ï¼Œé“ç†æ˜¯æŒºæœ‰é“ç†çš„ï¼Œä½†æ²¡æœ‰åšè¿‡profilingçœ‹å…·ä½“çš„åŠ é€Ÿæ•ˆæœã€‚</p>
<blockquote>
<p>Boid: Bird-roids æˆ–æ˜¯birdçš„ä¸€ç§å¸¦æœ‰å£éŸ³çš„è¯»æ³•ã€‚</p>
</blockquote>
<center>
<img src="/2023/01/15/Taichi-Learning-II/flocking.png" style="zoom:50%;">
</center>
<center>
Figure 3. Flocking simulation with multiple predators
</center>
<h3 id="soa-vs.-aos">3.1 SoA vs. AoS</h3>
<p><span id="3-1"></span></p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">SoA</a></li><li class="tab"><a href="#span-unique-name-2">AoS</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ Struct of Arraysï¼ˆSoAï¼‰: æ„æ€æ˜¯ä¸€ä¸ªstructä¸­çš„å˜é‡æ˜¯arrayï¼ˆæ¯”å¦‚ä¸€ä¸ªstructä¸­æœ‰å¥½å‡ ä¸ªæ•°ç»„ï¼‰ï¼Œå¾ˆæ˜¾ç„¶å¯¹äºstructä¸­çš„æ¯ä¸€ä¸ªArrayï¼Œå†…éƒ¨å…ƒç´ éƒ½æ˜¯ç©ºé—´ä¸´è¿‘çš„ï¼ˆç›´æ¥é‚»è¿‘ï¼‰ã€‚è€Œä¸åŒarrayçš„å†…å­˜å¯ä»¥åˆ†é…åœ¨ä¸åŒçš„ä½ç½®ï¼Œæ²¡æœ‰ç©ºé—´é‚»è¿‘æ€§ã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ Array of Structï¼ˆAoSï¼‰çš„æ„æ€æ˜¯ï¼šæŸä¸ªarrayçš„å…ƒç´ æ˜¯ä¸€ä¸ªstructã€‚å¾ˆæ˜æ˜¾ï¼ŒArray of structä¸­ï¼Œå•ä¸ªstructå†…éƒ¨çš„å…ƒç´ ä¹‹é—´æ˜¯ç©ºé—´é‚»è¿‘çš„ï¼ˆç”±äºstructéœ€è¦è¿ç»­çš„å†…å­˜åŒºï¼‰ï¼Œè€Œä¸åŒçš„struct elementä¹‹é—´åªæœ‰æœ‰é™çš„é‚»è¿‘æ€§ï¼Œä¸¾ä¸ªä¾‹å­ï¼šä¸€ä¸ªstructä¸­å«æœ‰<code>double a</code>, <code>double b</code> , <code>std::shared_ptr&lt;xxx&gt; c</code>ï¼Œé‚£ä¹ˆå³ä½¿æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªstructä¸­çš„å˜é‡<code>a</code>éƒ½å¯èƒ½ç›¸è·å‡ åä¸ªå­—èŠ‚ã€‚</p></div></div></div>
<p>â€‹ æ­£å¦‚æˆ‘åœ¨ç¬¬äºŒèŠ‚æ—¶æ‰€è¯´çš„ï¼šSoAä¸AoSéœ€è°¨æ…é€‰æ‹©ï¼ŒGPUèƒŒåçš„intuitionå·²ç»æäº†ï¼Œè€Œç°ä»£CPUå†…å­˜ä¹Ÿå­˜åœ¨é€‰æ‹©é—®é¢˜ã€‚å½“æœ‰å†…å­˜åˆ†é¡µæœºåˆ¶ï¼ˆæˆ–è€…ä»€ä¹ˆåˆ†æ®µã€æ®µé¡µï¼‰æ—¶ï¼Œå¯¹äºæŸå—å†…å­˜çš„å–å‡ºæ˜¯å°†å…¶æ‰€åœ¨çš„é¡µæ•´ä¸ªå–å‡ºï¼ˆå¦‚æœæˆ‘å¾®æœºåŸç†æ²¡è®°é”™çš„è¯ï¼‰ã€‚å¦‚æœæ‰€éœ€çš„æ•°æ®ç©ºé—´è¾ƒä¸ºåˆ†æ•£ï¼Œé¢‘ç¹åœ°è°ƒé¡µå°†ä¼šæµªè´¹memory bandwidthï¼šè¯•æƒ³ä½ ä¸ºäº†SIMå¡å¡é’ˆå»ä¹°äº†ä¸€éƒ¨åˆä¸€éƒ¨çš„æ‰‹æœº... å°±ä¸ºäº†é‡Œé¢èµ é€çš„å¡é’ˆï¼Œé¡¶çº§ä¹°æ¤Ÿè¿˜ç è¡Œä¸º --- è°ƒä¸€æ•´é¡µåªä¸ºäº†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†å†…å®¹ã€‚æ­¤å¤–ï¼Œcache coherenceä¹Ÿæ˜¯ä¸€å¤§è€ƒè™‘ã€‚é¢‘ç¹åœ°æ›´æ¢åœ¨cacheä¸­çš„é¡µå°†ä¼šå¯¼è‡´å¤§é‡cache missï¼Œé‚£å°±æ…¢äº†å•Šã€‚</p>
<p>â€‹ å‡è®¾structå­˜å‚¨äº†æŸä¸ªä¸ªä½“ä¸­æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œå¦‚æœè¦è¿½æ±‚æè‡´é€Ÿåº¦ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®è®¡ç®—æ‰€éœ€ä¿¡æ¯çš„å†…å­˜åˆ†å¸ƒé€‰æ‹©SoA/AoSã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>structä¸­å­˜å‚¨äº†ä½ç½®ï¼Œé€Ÿåº¦ï¼ŒåŠ é€Ÿåº¦ä¿¡æ¯ï¼Œæˆ‘éœ€è¦æ ¹æ®åŒ€åŠ é€Ÿæ¨¡å‹æ›´æ–°æ¯ä¸€ä¸ªä¸ªä½“çš„ä½ç½®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æƒ…å†µä½¿ç”¨AoSæ¯”è¾ƒå¥½ï¼Œ<strong><u>å› ä¸ºè®¡ç®—ä½¿ç”¨çš„æ˜¯structçš„å†…éƒ¨ä¿¡æ¯</u></strong> --- æ„å‘³ç€æˆ‘ä»¬éœ€è¦structçš„å†…éƒ¨ä¿¡æ¯é‚»è¿‘æ€§</li>
<li>æˆ‘çš„Flocking simulationï¼šéœ€è¦å­˜å‚¨æ‰€æœ‰boidsçš„è§’åº¦ã€ä½ç½®ã€‚ä¾‹å¦‚å½“æˆ‘å¸Œæœ›é‚»è¿‘boidsä¹‹é—´æœ‰ç›¸è¿‘çš„è§’åº¦æ—¶ï¼Œæˆ‘éœ€è¦è®¿é—®å…¶ä»–boidsçš„è§’åº¦ä»¥åŠä½ç½®ï¼Œæ­¤æ—¶ä½¿ç”¨SoAä¼šæ¯”è¾ƒå¥½ï¼šåˆ©ç”¨åŒç§ç±»å‹çš„æ•°æ®ä¹‹é—´çš„é‚»è¿‘æ€§ï¼Œç”±äºä¸åŒç§ç±»æ•°æ®ä¹‹é—´å¯èƒ½æ— æ³•è¿›è¡Œç›´æ¥è¿ç®—ã€‚</li>
</ul>
<p>â€‹ æˆ‘å½“æ—¶å°±æ²¡æœ‰æŠŠboidå†™æˆstructï¼Œè€Œæ˜¯è¿›è¡Œäº†ä»¥ä¸‹å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.ang_vel 		= ti.field(ti.f32, self.boid_num)</span><br><span class="line">self.angles 		= ti.field(ti.f32, self.boid_num)</span><br><span class="line">self.pos 			= ti.Vector.field(<span class="number">2</span>, ti.f32, self.boid_num)</span><br><span class="line">self.dirs 			= ti.Vector.field(<span class="number">2</span>, ti.f32, self.boid_num)</span><br></pre></td></tr></table></figure>
<p>â€‹ è§’é€Ÿåº¦ã€è§’åº¦ã€ä½ç½®ä»¥åŠ2Dæœå‘ï¼ˆ2Dæœå‘ç”¨äºç»“æœç»˜åˆ¶ï¼‰éƒ½æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œè™½ç„¶åœ¨è®¡ç®—è§’åº¦æ—¶å¸¸å¸¸éœ€è¦<code>angles</code>ä»¥åŠ<code>ang_vel</code>ï¼Œä½†å…¶å®è¿™ç§ä¸åŒç±»å‹çš„æ•°æ®è®¡ç®—è¿˜æ˜¯æŒºæœ‰ç‹¬ç«‹æ€§çš„ã€‚ä¸è¿‡ï¼ŒAoSå¯èƒ½å¯¼è‡´ä»£ç å¯è¯»æ€§å˜å·®ï¼ˆstructç¡®å®å¾ˆæœ‰ç»„ç»‡ï¼Œæ­£å¦‚æˆ‘ä»¬å­˜å‚¨äººçš„èº«ä»½ä¿¡æ¯æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯æŠŠæ¯ä¸ªäººä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å®ä¾‹ï¼Œå†…éƒ¨æœ‰å®Œæ•´çš„å„ä¿¡æ¯æ¡ç›®ï¼Œè€Œä¸ä¼šä»€ä¹ˆâ€å¹´é¾„å­˜ä¸€èµ·ï¼Œå§“ååˆ†å¼€å¹¶ä¸€èµ·å­˜åœ¨å¦å¤–ä¸€ä¸ªåœ°æ–¹â€œï¼‰ã€‚</p>
<h3 id="ssds">3.2 SSDS</h3>
<p>â€‹ æœ‰å››ç§nodeï¼ˆå››ç§SSDSæ”¯æŒçš„æ•°æ®ç»“æ„ï¼‰ï¼šï¼ˆ1ï¼‰Dynamicï¼ˆæœ¬æ–‡ä¸è®²ï¼ŒåŸå› è§åï¼‰ï¼ˆ2ï¼‰Pointerï¼šæŒ‡é’ˆç±»å‹ï¼Œæ¯ä¸ªåŒºéƒ½å¯ä»¥æŒ‡å‘å®Œå…¨æ²¡æœ‰ç©ºé—´è§„å¾‹æ€§çš„åœ°å€ï¼ˆ3ï¼‰bitmaskedï¼šæ¯ä¸ªå­˜å‚¨åŒºå­˜åœ¨ä¸€ä¸ª1bitçš„flagï¼Œä»¥æŒ‡ç¤ºå½“å‰å­˜å‚¨åŒºæ˜¯å¦activeï¼ˆinactiveçš„å­˜å‚¨åŒºå°†ä¸ä¼šè€—è´¹é™¤bit flagä¹‹å¤–çš„å†…å­˜ï¼‰ï¼ˆ4ï¼‰denseï¼šå¯ä»¥ç†è§£ä¸ºfieldï¼Œæ— æ¡ä»¶activeçš„å­˜å‚¨åŒºï¼Œä»…æœ‰denseçš„ç»“æ„ä¸æ˜¯ç¨€ç–çš„ã€‚ä¸‹é¢ï¼Œç»™å‡ºå®˜æ–¹æ•™ç¨‹çš„ä¸€ä¸ªä¾‹å­ï¼Œå…³äºå…·ä½“çš„è¯­æ³•ä»¥åŠAPIçš„ä½¿ç”¨æˆ‘å°±ä¸è¯´äº†ï¼Œæœ¬åšå®¢ä¹Ÿä¸æ˜¯é‚£ç§æŠ„åˆ«äººæ–‡æ¡£ï¼Œä»£æ›¿è¯»è€…paraphraseä¸€ä¸‹ä¹‹åè¿˜ç»™è¯»è€…çš„é‚£ç§ç­”è¾©åšå®¢ï¼ˆè™½ç„¶æˆ‘åšå®¢å†…å®¹è´¨é‡ä¹Ÿä¸è¡Œï¼Œä½†ä¸è‡³äºå¼€å§‹å°±æ˜¯ç­”è¾©ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = ti.field(ti.i32)</span><br><span class="line">y = ti.field(ti.i32)</span><br><span class="line">z = ti.field(ti.i32)</span><br><span class="line">S0 = ti.root</span><br><span class="line">S1 = S0.pointer(ti.i, <span class="number">4</span>)</span><br><span class="line">S2 = S1.dense(ti.i, <span class="number">2</span>)</span><br><span class="line">S2.place(x, y) <span class="comment"># S3: x; S4: y</span></span><br><span class="line">S5 = S1.dense(ti.i, <span class="number">2</span>)</span><br><span class="line">S5.place(z) <span class="comment"># S6: z</span></span><br></pre></td></tr></table></figure>
<p>â€‹ æ–‡æ¡£ç»™å‡ºäº†å­˜å‚¨ç»“æ„å›¾ï¼ˆæ³¨æ„ï¼Œæˆ‘è§‰å¾—å®˜æ–¹æ–‡æ¡£çš„å›¾æœ‰é—®é¢˜ï¼Œè§ä¸‹å›¾çš„çº¢æ¡†ï¼‰ã€‚å®˜æ–¹æ–‡æ¡£çš„çº¢æ¡†åŒºåŸŸä¸­ï¼Œé ä¸Šæ–¹çš„ä¸¤ä¸ªcellæ˜¯2ï¼Œä¸‹æ–¹ä¸¤ä¸ªä¸º3ï¼Œæˆ‘æ„Ÿè§‰è¿™æ˜¯ä¸å¯¹çš„ï¼Œæ¯•ç«Ÿè¿™è¿åäº†placeçš„å«ä¹‰ã€‚</p>
<center>
<img src="/2023/01/15/Taichi-Learning-II/structure.png" style="zoom:67%;">
</center>
<center>
Figure 4. å±‚çº§ç»“æ„å›¾ï¼ˆç°è‰²çš„containeréƒ¨åˆ†ï¼Œè¢«çº¢æ¡†æ¡†ä½çš„åŒºåŸŸä¸ºå®˜æ–¹æ–‡æ¡£ç”»é”™çš„åŒºåŸŸï¼‰
</center>
<p>â€‹ å¦‚æœçœŸæƒ³è¦æ·±å…¥å­¦ä¹ Taichiï¼Œè¿™å¼ å›¾çš„å«ä¹‰å¿…é¡»è¦å®Œå…¨çœ‹æ˜ç™½å¹¶ä¸”èƒ½ä¸ä»£ç å¯¹ä¸Šã€‚æŒ‰ç…§å›¾è®ºä¸­å¯¹æ ‘çš„ç†è§£å¼€å§‹å³å¯ï¼ŒS0ä¸ºæ ¹ç»“ç‚¹ï¼Œæ ¹èŠ‚ç‚¹å¤„æœ‰å››ä¸ªå­æ ‘ï¼Œæ¯ä¸ªå­æ ‘éƒ½æ˜¯ä¸€ä¸ªpointerï¼Œæ‰€æœ‰å­æ ‘å½’ä¸ºS1å±‚ã€‚S1å±‚ä¸Šæ¯ä¸ªå­æ ‘ä¸Šï¼ŒæŒ‚ä¸¤ä¸ªå­æ ‘ï¼Œæ¯ä¸ªå­æ ‘æ˜¯ä¸€ä¸ªdenseå­˜å‚¨åŒºã€‚å¯¹S2å±‚è€Œè¨€ï¼Œè¿™ä¸€å±‚æ˜¯å¶ç»“ç‚¹äº†ï¼Œå¶èŠ‚ç‚¹å¯ä»¥ç›´æ¥ä¸æŸä¸ªfieldæŒ‚é’© --- ç¡®å®šæ¯ä¸ªå¶å­å…ƒç´ æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯<code>i32</code>ã€‚æ³¨æ„ï¼š<code>x.place(y)</code>å‡½æ•°å¯ä»¥ç†è§£ä¸ºï¼šå°†xæ‰€å«æœ‰çš„å±‚çº§ç»“æ„ï¼Œåº”ç”¨åœ¨å˜é‡yç¡®å®šçš„å­˜å‚¨åŒºåŸŸä¸Šï¼Œå­˜å‚¨åŒºåŸŸçš„ç±»å‹ä¸yæœ¬èº«æœ‰å…³ã€‚ä¸‹é¢æˆ‘ç€é‡è¯´ä¸€ä¸‹flocking simulationä¸­æ‰€éœ€è¦çš„SSDSã€‚</p>
<p>â€‹ æˆ‘ä»¬çŸ¥é“ï¼ˆä½ çŸ¥é“å—ï¼‰ï¼Œé‚»è¿‘æœç´¢æ˜¯ä¸€ä»¶å¾ˆçƒ¦äººçš„äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯åœ¨å…ƒç´ è¾ƒå¤šçš„æ—¶å€™ï¼Œå› ä¸ºå¯¹äºäººç±»æ¥è¯´é‚»è¿‘æœç´¢ç®€å•ç›´è§‚ï¼šæˆ‘è¦æ‰¾å‡ºæˆ‘é™„è¿‘çš„äººå¹¶ä¸è¦æ±‚æˆ‘æŠŠæˆ‘åˆ°æ‰€æœ‰ä¸­å›½å¢ƒå†…çš„äººçš„è·ç¦»å…¨éƒ¨æµ‹ä¸€éã€‚è€Œè®¡ç®—æœºæ¯”è¾ƒæš´åŠ›ï¼Œç®€å•åœ°æŸ¥æ‰¾é‚»å±…éœ€è¦åŸºäºè·ç¦»åº¦é‡ã€‚é‚£ç”¨ç¨€ç–æ•°æ®ç»“æ„å°±æ˜¯ä¸€ç§å¯è¡Œçš„åŠ é€Ÿæ‰‹æ®µï¼Œä»¥æœç´¢é™„è¿‘çš„äººä¸ºä¾‹ï¼Œæˆ‘åªè¦æ‰¾å‡ºæˆ‘å½“å‰æ‰€åœ¨å¿å¸‚å‘¨å›´å¿å¸‚äººè¿›è¡Œè®¡ç®—å³å¯ã€‚Flocking simulationä¸­æˆ‘ä½¿ç”¨SSDSå®ç°äº†ç¨€ç–gridï¼ˆä¸¤å±‚ï¼‰ï¼š</p>
<ul>
<li>ç¬¬ä¸€å±‚ï¼Œæ˜¯2D pointer gridï¼šä»£è¡¨äº†æˆ‘å¯¹2Dç©ºé—´çš„åˆ’åˆ† --- åˆ’åˆ†ä¸º<span class="math inline">\((W/D) \times (H/D)\)</span>ä¸ª2Dgridï¼Œæ¯ä¸ªgridå¤§å°ä¸º<span class="math inline">\(D\times D\)</span>ã€‚é‚£ä¹ˆå¯¹äºä¸€ä¸ªboidï¼Œå®ƒåªéœ€è¦æœç´¢è‡ªå·±æ‰€åœ¨çš„ + é‚»è¿‘çš„ï¼ˆæˆ‘ä»£ç å†…å–8-é‚»åŸŸï¼‰gridå³å¯</li>
<li>ç¬¬äºŒå±‚ï¼Œ1D bitmaskedï¼šç”±äºæˆ‘ä¸çŸ¥é“ä¼šæœ‰å¤šå°‘åªboidè½åœ¨åŒä¸€ä¸ªgridä¸­ï¼Œæ‰€ä»¥æˆ‘åªèƒ½åœ¨å¼€å§‹æ—¶è®¾ç½®ä¸€ä¸ªå¤§çš„å­˜å‚¨åŒºï¼ˆæ¯”å¦‚64 boidså¯¹åº”æ¯ä¸ªgridä¸­éœ€è¦æœ‰64ä¸ªå­˜å‚¨åŒºï¼‰ã€‚ä½¿ç”¨denseæ˜¾ç„¶... ä¸å¥½ï¼Œæˆ‘å¯èƒ½æ ¹æœ¬ç”¨ä¸åˆ°è¿™ä¹ˆå¤šå­˜å‚¨åŒºåŸŸï¼Œé™¤éæˆ‘ä»£ç å†™å¾—æœ‰é—®é¢˜ï¼Œé¸Ÿå–œæ¬¢èšåœ¨åŒä¸€ä¸ªåœ°æ–¹ã€‚bitmaskedåˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œç›¸å½“äºæœ‰æ¡ä»¶çš„denseç»“æ„</li>
</ul>
<p>â€‹ ç¬¬ä¸€å±‚ç”¨pointeræˆ–è€…bitmaskedéƒ½è¡Œï¼Œbitmaskedæ˜¯ç©ºé—´é‚»è¿‘çš„ç»“æ„ï¼Œpointeræ˜¯ç¦»æ•£å­˜å‚¨çš„ç»“æ„ï¼Œåœ¨æœ¬ç”¨ä¾‹ä¸­å¹¶æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ã€‚ç”¨denseåˆ™ä¸è¡Œï¼šæœ‰äº›gridä¸­å¯èƒ½ä¸€åªboidéƒ½æ²¡æœ‰ï¼Œæ²¡å¿…è¦æµªè´¹è¿™ä¸ªå†…å­˜ã€‚ç¬¬äºŒå±‚çš„è®¾è®¡ç¨å¾®æœ‰ç‚¹trickyï¼ˆå¯èƒ½æ˜¯æˆ‘æƒ³å¤æ‚äº†ï¼‰ï¼Œç†ç”±å¦‚ä¸‹ï¼š</p>
<ul>
<li>boidåœ¨gridä¸­çš„ä½ç½®ä¹Ÿæ˜¯2Dçš„ï¼Œé‚£ä¹ˆ2Då­˜å‚¨åœ¨1Dçš„ç»“æ„ä¸Šè‡ªç„¶è¦èµ‹äºˆä¸€ä¸ªåœ°å€å€¼ï¼ˆæˆ–è€…ä¸‹æ ‡ç´¢å¼•ï¼‰</li>
<li>Taichiå–œæ¬¢lock-freeæ“ä½œï¼ˆè²Œä¼¼åœ¨Taichiä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°mutexï¼‰</li>
</ul>
<p>â€‹ äºæ˜¯æˆ‘çš„ç¬¬ä¸€ç‰ˆå®ç°æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.mask_grids = ti.field(ti.u8)      <span class="comment"># storing indices (atomic_add will return the original index, which is thread-safe)</span></span><br><span class="line">self.sn_handle  = ti.root.pointer(ti.ij, (grid_x + <span class="number">2</span>, grid_y + <span class="number">2</span>))</span><br><span class="line">self.atom_ptr   = ti.field(ti.u8, (grid_x, grid_y))     <span class="comment"># atomic dynamic indices for bitmask (no offset needed)</span></span><br><span class="line">self.sn_handle.bitmasked(ti.k, <span class="number">128</span>).place(self.mask_grids, offset = (-<span class="number">1</span>, -<span class="number">1</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<p>â€‹ <code>mask_grids</code>æœ€ç»ˆæ˜¯<span class="math inline">\((W/D,H/D,C)\)</span>å¤§å°çš„ï¼Œå…¶ä¸­Cæ˜¯æ¯ä¸ªgridèƒ½å­˜å‚¨çš„boidæ•°é‡ä¸Šé™ï¼Œè¿™ä¸ªå˜é‡æ˜¯æˆ‘ä»¬ç”¨äºé‚»è¿‘æŸ¥æ‰¾æ‰€éœ€çš„å˜é‡ã€‚<code>atom_ptr</code>æ˜¯ä¸€ä¸ªåŸå­æ“ä½œæ•°æ®ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªgridå½“å‰è®°å½•çš„boidæ•°é‡ã€‚<code>atom_ptr</code>ä¸ä»…æœ‰è®°å½•æ•°é‡çš„èƒ½åŠ›ï¼Œåœ¨å¹¶è¡Œè®¡ç®—æ—¶å¯ä»¥ç”¨äºè·å–å­˜å‚¨ä½ç½®çš„æ•°ç»„ä¸‹æ ‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id_x, id_y = <span class="built_in">int</span>(new_pos[<span class="number">0</span>] / self.radius), <span class="built_in">int</span>(new_pos[<span class="number">1</span>] / self.radius)</span><br><span class="line">index = ti.atomic_add(self.atom_ptr[id_x, id_y], <span class="number">0x01</span>)</span><br><span class="line">self.mask_grids[id_x, id_y, <span class="built_in">int</span>(index)] = ti.u8(idx)          <span class="comment"># store the index of the boid</span></span><br></pre></td></tr></table></figure>
<p>â€‹ ä¸Šé¢ä¸‰è¡Œä¸­ï¼Œç¬¬ä¸€è¡Œå…ˆè®¡ç®—äº†gridåæ ‡ï¼Œæ­¤å<code>ti.atomic_add</code>å°†å¯¹åº”ä½ç½®çš„è®¡æ•°+1ï¼Œæ³¨æ„ <strong><u>å…¶è¿”å›äº†+1ä¹‹å‰çš„æ•°ç»„å¤§å°</u></strong>ï¼Œå¯ä»¥ç›´æ¥å½“æˆæˆ‘ä»¬çš„indexä½¿ç”¨ã€‚ç”±äº+1 / è¿”å›åŸå§‹å€¼è¿™ä¸ªç±»ä¼¼replaceçš„æ“ä½œæ˜¯åŸå­çš„ï¼Œæ‰€ä»¥ç›¸å½“äºæˆ‘ä»¬å¯ä»¥è¿›è¡Œlock freeçš„åŠ¨æ€å¤§å°å­˜å‚¨ã€‚</p>
<p>â€‹ æˆ–è®¸æœ‰äººä¼šè¯´ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤æ‚ï¼Œæˆ‘ä¸èƒ½è¿™æ ·å¤„ç†å—ï¼Ÿæ—¢ç„¶æ˜¯bitmaskedï¼Œå‡è®¾å½“å‰boidçš„idæ˜¯kï¼Œé‚£æˆ‘åªéœ€è¦åœ¨<code>masked_grid[i, j, k]</code>å¤„å­˜å‚¨ï¼ˆæˆ–è€…activateï¼‰å°±å¯ä»¥äº†ï¼Œæ ¹æœ¬ä¸éœ€è¦çŸ¥é“æœ‰å¤šå°‘boidã€ä¸éœ€è¦<code>atom_ptr</code>ä»¥åŠåŸå­æ“ä½œå•Šï¼Ÿåæ­£Taichiçš„ struct-for loopä¼šè‡ªåŠ¨éå†ç¨€ç–çš„activeåŒºåŸŸã€‚</p>
<div class="note warning"><p>â€‹ <strong>ä¸è¡Œï¼</strong>æˆ‘ä»¬è¦å®ç°çš„æ˜¯æ‰‹åŠ¨forå¾ªç¯ï¼ˆä¸‰å±‚ï¼‰ï¼Œæœ€å¤–é¢çš„ä¸¤å±‚æ˜¯åœ¨éå†å½“å‰gridä»¥åŠå…¶å‘¨å›´8-é‚»åŸŸgridsï¼Œè€Œæœ€å†…å±‚æ˜¯åœ¨éå†å­˜å‚¨åœ¨å¯¹åº”gridä¸­çš„æ‰€æœ‰boidï¼ˆè®°å½•çš„indicesï¼‰ã€‚ struct-for loop æ®æˆ‘æ‰€çŸ¥ï¼Œä¸æ”¯æŒæ‰‹åŠ¨ä»¥åŠåˆ†æ­¥indexingï¼ˆä½ å†™rangeé™å®šèŒƒå›´æ˜¯ä¸è¡Œçš„ï¼Œ<code>[i,j][k]</code>è¿™æ ·çš„åˆ†æ­¥indexingæ–¹å¼ä¹Ÿæ˜¯ä¸æ”¯æŒçš„ï¼‰ã€‚</p>
</div>
<p>â€‹ æ­¤å¤–ï¼Œè¿™é‡Œç®€å•æä¸€ä¸‹ä¸meta-programmingæœ‰å…³çš„å†…å®¹ã€‚Taichiçš„meta-programmingè²Œä¼¼å¹¶æ²¡æœ‰C++/Rusté‚£ä¹ˆå¤æ‚ï¼Œå¹¶ä¸æ¶‰åŠåˆ°éå¸¸åº•å±‚çš„ç±»å‹æ¨æ–­ã€æ³›å‹ç­‰é—®é¢˜ã€‚Taichiä¸­çš„<code>ti.template()</code>ä¸fieldä½œä¸ºå‡½æ•°å‚æ•°è¾“å…¥æœ‰å…³ï¼Œç”±äºfieldæ˜¯å¤æ‚çš„data containerï¼Œå…¶å¯ä»¥æ˜¯scalar containerï¼Œä¹Ÿå¯ä»¥æ˜¯vector / matrix containerï¼Œå†…éƒ¨çš„ç±»å‹ä¹Ÿæ˜¯å¯å˜çš„ï¼Œä½œä¸ºmatrix containeræ—¶ç»´åº¦ä¹Ÿæ˜¯å¯å˜çš„ã€‚å¦‚æœæ²¡æœ‰<code>ti.template()</code>è€Œæ˜¯è¦æ¸…æ¥šåœ° type annotate è¾“å…¥ç±»å‹ï¼Œä¼šå¾ˆç¹çï¼Œå¹¶ä¸”ä¹Ÿä¸æ–¹ä¾¿ä»£ç å¤ç”¨ã€‚ä½¿ç”¨<code>ti.template()</code>ä½œä¸º type hint å¯ä»¥æ–¹ä¾¿è¾“å…¥ä¸åŒç±»å‹çš„fieldã€‚æ­¤å¤–ï¼Œå¦‚æœéœ€è¦è¾¾åˆ° shape agnosticï¼Œå¯ä»¥ä½¿ç”¨<code>grouped</code>æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> I <span class="keyword">in</span> ti.grouped(y):</span><br><span class="line">    x[I] = y[I]</span><br></pre></td></tr></table></figure>
<p>â€‹ å¯ä»¥é¿å…ï¼šä¸€ç»´æ—¶<code>x[i]</code>ï¼ŒäºŒç»´æ—¶<code>x[i, j]</code>ï¼Œä¸‰ç»´æ—¶<code>x[i, j, k]</code>è¿™æ ·ä¸shapeæœ‰å…³çš„å†™æ³•ã€‚</p>
<p>â€‹ æœ€åæ³¨æ„ï¼š</p>
<ul>
<li>dynamic nodeåœ¨å½“ä»Šçš„1.3.0ç‰ˆæœ¬å·²ç»deprecatedï¼Œæ‰€ä»¥ä¸ç”¨ç‰¹åˆ«å…³æ³¨ã€‚å³å°†åˆ°æ¥çš„1.4.0ç‰ˆæœ¬ä¸­ï¼Œpointerä»¥åŠbitmaskedä¹Ÿå°†ä¸å†æ”¯æŒã€‚æˆ‘å¾ˆå¥½å¥‡å®˜æ–¹ä¼šæ¨å‡ºä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆã€‚</li>
<li><code>@ti.pyfunc</code>æ˜¯å·²ç»deprecatedçš„ä¿®é¥°ç¬¦ï¼Œè™½ç„¶åšæ–‡Iä¸­æåˆ°äº†ï¼Œä½†æˆ‘è‡ªå·±ç”¨äº†ä¹‹åæ€»æ˜¯æœ‰warningsã€‚</li>
<li>offsetæ˜¯å¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œåœ¨fieldä¸­ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºåˆå§‹åŒ–å‚æ•°è®¾ç½®offsetï¼Œè€Œå¯¹äºSSDSï¼Œåˆ™åœ¨placeé˜¶æ®µè¿›è¡Œè®¾ç½®ã€‚offsetå¯ä»¥å®ç°paddingï¼Œä½¿å¾—å®ç°è€…æ— éœ€è€ƒè™‘paddingä¹‹åindexçš„æ”¹å˜é—®é¢˜ï¼ˆè¿™ä¸ªå­¦æœŸå†™è§†é¢‘å¤„ç†å’Œå®½å¸¦é€šä¿¡è¯¾çš„patch matchingçš„æ—¶å€™è€æŠ˜ç£¨äº†ï¼Œpaddingä¹‹åçš„indexå¾—è®¤çœŸæ¨ï¼‰</li>
<li>è™½ç„¶æˆ‘ä»¬åªéœ€SSDSæœ€ç»ˆçš„å¶èŠ‚ç‚¹æœ‰æƒ³è¦çš„å±‚çº§ç»“æ„ï¼Œé€‚å½“åœ°ä¿å­˜ä¸€äº›éå¶èŠ‚ç‚¹ä½œä¸ºhandleï¼Œå¯¹äºæ¯æ¬¡è¿­ä»£éœ€è¦æ¸…é›¶çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨handleç›´æ¥æ‰§è¡Œï¼š<code>deactivate_all()</code>æ–¹æ³•ä»¥é€’å½’åœ°deactivateå½“å‰ä»¥åŠæ‰€æœ‰å­ç»“ç‚¹ã€‚</li>
</ul>
<h3 id="å…³äºé€»è¾‘">3.3 å…³äºé€»è¾‘</h3>
<p>â€‹ è‡ªå·±çœ‹ä»£ç å§ï¼Œä¸»è¦é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>è§’é€Ÿåº¦æ§åˆ¶ï¼šç›´æ¥æ§åˆ¶çš„æ˜¯è§’é€Ÿåº¦ï¼Œè§’åº¦æ›´æ–°æ ¹æ®è§’é€Ÿåº¦ä¹˜ä»¥ç³»æ•°ã€‚å¹³æ»‘éšæœºæ–¹å‘ï¼šæ­£å¸¸æƒ…å†µä¸‹boidçš„è½¨è¿¹æ˜¯éšæœºçš„ï¼Œä½†ç”±äºéšæœºæ€§ä½“ç°åœ¨è§’é€Ÿåº¦ä¸Šå¹¶ä¸”ç»è¿‡äº†å¾ˆå¼ºçš„æŒ‡æ•°å¹³æ»‘ï¼Œè§’åº¦å°†ä¼šè¾ƒä¸ºå¹³æ»‘åœ°å˜åŒ–ï¼Œè½¨è¿¹æ˜¯è¿ç»­å¹³æ»‘çš„ã€‚æœ‰å…³éšæœºæ€§çš„å®ç°ï¼Œè§åŸºç±»<code>boid_random_vel</code>å‡½æ•°</li>
<li>è¶…ç•Œè½¬å‘ï¼šå‚è€ƒ<code>oob_angular_acc</code>ï¼Œå³è¶…ç•Œåå°†ä¼šè®¡ç®—ä¸€ä¸ªç›®æ ‡è§’åº¦ï¼ˆå½“å‰ä½ç½®åˆ°å›¾åƒä¸­å¿ƒçš„æ–¹å‘è§’ï¼‰ï¼Œéšåä½¿ç”¨Pæ§åˆ¶æ‰­è½¬æ–¹å‘</li>
<li>Alignmentï¼šæœç´¢é‚»è¿‘boidï¼Œæ ¹æ®è·ç¦»åŠ æƒè§’åº¦ï¼ˆç”±äºè§’åº¦åŠ æƒå­˜åœ¨å¥‡å¼‚æ€§é—®é¢˜ï¼Œæ•…åŠ æƒæ–¹å‘å‘é‡åatan2å‡½æ•°è½¬ä¸ºè§’åº¦ï¼‰</li>
<li>Separation &amp; Cohesionï¼šä¸¤è€…å®ç°åœ¨ä¸€èµ·ï¼Œéƒ½éœ€è¦è®¡ç®—å½“å‰ä½ç½®åˆ°å±€éƒ¨è´¨å¿ƒçš„æ–¹å‘å‘é‡ã€‚Separationå€¾å‘äºåŸç†å±€éƒ¨è´¨å¿ƒï¼Œè€Œcohesionå€¾å‘äºé è¿‘å±€éƒ¨è´¨å¿ƒã€‚æ¥è¿‘ä¸è¿œç¦»ä¾é ç›®æ ‡è§’çš„æ–¹å‘å®ç°ï¼šæ¥è¿‘å³ç›®æ ‡è§’æŒ‡å‘å±€éƒ¨è´¨å¿ƒï¼Œè¿œç¦»å³ç›®æ ‡è§’æŒ‡å‘å±€éƒ¨è´¨å¿ƒæ–¹å‘æ—‹è½¬180Â°åçš„ç»“æœã€‚å½“å‰åº”å½“æ¥è¿‘ã€è¿œç¦»æŒ‰å½“å‰ä½ç½®è·ç¦»è´¨å¿ƒçš„è·ç¦»ç¡®å®šï¼Œå‚è€ƒç²’å­é—´ä½œç”¨åŠ›æ¨¡å‹ï¼Œå®ç°æ˜¯ä¸€ä¸ªä¸å¯¹ç§°æˆªæ–­ï¼ˆclampï¼‰çš„å¹³ç§»åtanhå‡½æ•°ã€‚</li>
<li>æ™®é€šé¸Ÿä¸æ é£Ÿè€…ï¼ˆæ™®é€šé¸Ÿå°±æ˜¯é¸½å­ï¼Œ<code>Pigeon</code>ç±»ï¼‰ï¼Œæ é£Ÿè€…ä¹‹é—´ä¸ä¼šç›¸äº’ä½œç”¨æˆ–è€…é…åˆã€‚æ™®é€šé¸Ÿå­˜åœ¨è­¦æˆ’èŒƒå›´ï¼Œå€¾å‘äºè¿œç¦»è­¦æˆ’èŒƒå›´å†…çš„æ é£Ÿè€…ï¼ˆçš„è´¨å¿ƒï¼‰ï¼Œè€Œæ é£Ÿè€…å°†åœ¨æ é£ŸèŒƒå›´å†…è¿½è¸ªè·ç¦»æœ€è¿‘çš„æ™®é€šé¸Ÿã€‚</li>
<li>æ é£Ÿè€…å¯ä»¥è¿›è¡Œè‡ªåŠ¨æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥é€‰å…¶ä¸€è¿›è¡Œé¼ æ ‡æ§åˆ¶ï¼ˆè·Ÿè¸ªé¼ æ ‡æ–¹å‘ï¼‰</li>
</ul>
<hr>
<h2 id="iv.-ä¼ ç»Ÿè‰ºèƒ½-ç»“æœ">IV. ä¼ ç»Ÿè‰ºèƒ½-ç»“æœ</h2>
<p>â€‹ ç»“æœå¦‚ä¸‹ï¼Œ45FPSçš„æ ·å­ï¼ˆæ³¨æ„ï¼Œå¦‚æœä½¿ç”¨<code>arch = ti.gpu</code>ï¼Œéœ€è¦æŠŠä»£ç ä¸­çš„<code>atom_ptr</code>ç±»å‹ä»u8æ¢ä¸ºi32ï¼Œè²Œä¼¼GPUä¸æ”¯æŒu8 <code>atomic_add</code>ï¼Œæˆ‘è®°å¾—ä¹Ÿæ˜¯è¿™æ ·ï¼Œæœ‰äº›æ•°æ®ç±»å‹ï¼Œæœ‰ç¬¦å·çš„åŸå­æ“ä½œå­˜åœ¨ï¼Œæ— ç¬¦å·åˆ™ä¸å­˜åœ¨ï¼‰ã€‚</p>
<video src="video.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster>
</video>
<center>
Figure 5. ä»€ä¹ˆé¸Ÿè§†é¢‘
</center>
<p>â€‹ å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå®‰è£…Taichiä¹‹åå¯ä»¥è‡ªå·±cloneæˆ‘çš„ <a href="https://github.com/Enigmatisms/learn_taichi">learn_taichi</a> åº“ï¼Œåœ¨learning_examplesä¸­ï¼Œ<code>flocking_sim.py</code>å¯ä»¥ç›´æ¥è¿è¡Œã€‚å‚æ•°åœ¨<code>if __name__ == "__main__"</code>åã€‚å¦‚æœéœ€è¦å¼€å¯é¼ æ ‡æ§åˆ¶å…¶ä¸­ä¸€åªæ é£Ÿè€…ï¼Œè¯·å°†<code>line 262</code>çš„<code>last_one_human</code>æ”¹ä¸ºTrueã€‚æ³¨æ„ï¼Œå½“å‰ä»£ç æš‚ä¸æ”¯æŒæ— æ é£Ÿè€…ï¼ˆåœ¨æˆ‘å‰å‡ ä¸ªcommitä¸­åº”è¯¥æ˜¯æœ‰æ— æ é£Ÿè€…çš„ï¼Œç°åœ¨çš„ä»£ç ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼‰ã€‚</p>
<p>â€‹ æœ€åæä¸€å¥ï¼Œå¦‚æœ‰æœ‰å…´è¶£ï¼Œçœ‹<a href="https://docs.taichi-lang.org/docs/overview">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå®˜æ–¹æ–‡æ¡£è´¨é‡éå¸¸é«˜ã€‚çœ‹å®Œå°±è‡ªå·±å†™å†™ï¼Œæ–‡æ¡£ä¸æ˜¯çœ‹ä¼šçš„ï¼Œæ˜¯ç”¨ä¼šçš„ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://stackoverflow.com/questions/5041328/in-cuda-what-is-memory-coalescing-and-how-is-it-achieved">In CUDA, what is memory coalescing, and how is it achieved?</a></p>
<p>[2] <a href="https://docs.taichi-lang.org/docs/sparse">Taichi Lang Docs v1.3.0: Spatially Sparse Data Structures</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>CUDA</tag>
        <tag>LLVM</tag>
        <tag>Taichi lang</tag>
      </tags>
  </entry>
  <entry>
    <title>AdaPT - Monte Carlo Path Tracer I</title>
    <url>/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/</url>
    <content><![CDATA[<h1 id="ada-path-tracer-i">Ada Path Tracer I</h1>
<p>â€‹ Path tracingèƒŒåçš„æ¦‚ç‡ä¸æ•°å­¦ç†è®ºè¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä¸æ·±å…¥ç†è§£åˆ™å¾ˆéš¾è¿›è¡Œæ­£ç¡®çš„å®ç°ï¼Œæ›´å‹¿è®ºåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œåˆ›æ–°äº†ã€‚ç»“åˆç¬”è€…åœ¨å®ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›ä½“ä¼šï¼Œç¬”è€…è®¤ä¸ºéWhittedå…‰çº¿è¿½è¸ªæ¸²æŸ“å™¨æœ‰ä¸€ä¸ªè¿™æ ·çš„ç‰¹ç‚¹ï¼šå³ä½¿æ˜¯å¾ˆå¤§çš„é€»è¾‘é”™è¯¯å¯èƒ½ä¹Ÿå¾ˆéš¾ä½¿ç”¨å®šæ€§çš„æ–¹æ³•è§‚å¯Ÿå‡ºæ¥ï¼Œæœ€åçš„é”™è¯¯è¾“å‡ºå¯èƒ½ä¸æ­£ç¡®è¾“å‡ºä»…æœ‰å¾ˆå°çš„å·®åˆ«ï¼Œç”šè‡³æœ‰çš„æ—¶å€™æ ¹æœ¬çœ‹ä¸å‡ºæ¥ï¼ˆä¾‹å¦‚ï¼Œç®—æ³•æ”¶æ•›æ…¢æ—¶æˆ‘å¯èƒ½å€¾å‘äºè®¤ä¸ºæ˜¯è‡ªå·±æ²¡æœ‰ç”¨å¤ªå¤šçš„variance reductionæ–¹æ³•ä»¥åŠæ·±å…¥çš„é‡‡æ ·æŠ€æœ¯ï¼Œè€Œä¸ä¼šè®¤ä¸ºæˆ‘ä»£ç æœ‰é€»è¾‘é”™è¯¯ï¼‰ã€‚æ•…æœ¬æ–‡ä½œä¸º Path Tracing ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†æ–‡ç« ï¼Œå°†å°½å¯èƒ½æ·±å…¥è®¨è®ºèƒŒåçš„ç†è®ºçŸ¥è¯†ä»¥åŠå…¶ç†è§£ã€‚ç†è§£æ˜¯ä¸ºå®ç°ã€åˆ›æ–°æœåŠ¡çš„ï¼Œä»»ä½•ä¸åˆ°ä½çš„åœ°æ–¹éƒ½å°†å¯¼è‡´å®ç°è¿‡ç¨‹ä¸­çš„å¡é¡¿ï¼Œæ•…æ­¤å¤„æˆ‘å°†å°½åŠ›è¦†ç›–è¿™ä¸¤å‘¨ç”¨é›¶ç¢äº‹ä»¶å†™<a href="https://github.com/Enigmatisms/AdaPT">æ¸²æŸ“å™¨: AdaPT</a>æ—¶æ‰€é‡åˆ°çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å†™æ–‡æ¡£æ˜¯å¾ˆçƒ¦äººçš„ä¸€ä»¶äº‹ï¼Œå¦‚æœæˆ‘æœ¬èº«å¾ˆé—²ï¼Œä¸ç”¨ä¸ºäº†å„ç§å­¦ä¸šã€ç§‘ç ”ã€ä¸ªäººèµ„æœ¬ç­‰ç­‰äº‹æƒ…è€ƒè™‘çš„è¯ï¼Œæˆ‘å½“ç„¶è¿˜æ˜¯éå¸¸æ„¿æ„å†™åšå®¢ã€å†™æ–‡æ¡£çš„ã€‚å¯æƒœå†™åšå®¢å†™æ–‡æ¡£ä»ç°åœ¨æ¥çœ‹å¹¶æ²¡æœ‰å®é™…çš„ä»·å€¼ï¼Œåªæ˜¯æˆ‘ä¸ªäººçš„è‡ªå—¨ã€‚ --- 2023.2.8 ä½•åƒè¶Š</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">"The cornell spheres"</th>
<th style="text-align: center;">"The cornell boxes"</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/adapt-cornell-sphere.png"></td>
<td style="text-align: center;"><img src="/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/adapt-cornell-box.png"></td>
</tr>
</tbody>
</table>
<center>
Figure 1. Ada-Path-Tracer æ¸²æŸ“ç»“æœï¼ˆ20så†…ï¼‰
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬åº”ç”¨">II. åŸºæœ¬æ¦‚å¿µä¸åŸºæœ¬åº”ç”¨</h2>
<h3 id="monte-carloç§¯åˆ†">2.1 Monte Carloç§¯åˆ†</h3>
<p>â€‹ ä¸€èˆ¬æ¥è¯´ï¼Œç§¯åˆ†è¦æ¯”æ±‚å¯¼å›°éš¾ä¸€äº›ã€‚è¿™æ˜¯å› ä¸ºå¾ˆå¤šå‡½æ•°ï¼ˆä½œä¸ºå¯¼æ•°ï¼‰çš„åŸå‡½æ•°å¾ˆéš¾ï¼Œè€Œä¸å¯¼æ•°ä¸åŒçš„æ˜¯ï¼Œæ•°å€¼å¯¼æ•°å¯èƒ½å¾€å¾€åªéœ€è¦ä¸¤ä¸ªå€¼å°±èƒ½è¿‘ä¼¼ï¼Œç§¯åˆ†åˆ™å¯èƒ½éœ€è¦å·¨é‡å€¼ï¼Œ<strong>å°¤å…¶</strong> æ˜¯åœ¨é«˜ç»´ç©ºé—´ä¸­ï¼ˆå¤šé‡ç§¯åˆ†ï¼‰ã€‚</p>
<p>â€‹ è€ƒè™‘åˆ°éšæœºç®—æ³•æœ‰æ—¶å¯ä»¥åŠ é€ŸæŸäº›è¿­ä»£ç±»ç®—æ³•çš„æ”¶æ•›ï¼Œåœ¨ç§¯åˆ†è®¡ç®—é—®é¢˜ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨éšæœºç®—æ³•ã€‚ä¸‹é¢å¼•å‡ºé—®é¢˜ï¼šè®¾å¾…ä¼°è®¡å‡½æ•° <span class="math inline">\(f(x)\)</span> åœ¨åŒºé—´ <span class="math inline">\([a, b]\)</span>ä¸Šçš„ç§¯åˆ†ä¸ºï¼š <span class="math display">\[
I = \int_a^b f(x) dx
\]</span> â€‹ è®¾æœ‰ä¸€éšæœºä¼°è®¡å™¨<span class="math inline">\(\hat{I}\)</span>ï¼Œæ­¤ä¼°è®¡å™¨ç”¨äºä¼°è®¡<span class="math inline">\(I\)</span>ï¼Œåˆ™<span class="math inline">\(\hat {I}\)</span> åº”å½“æ˜¯æ— åä¼°è®¡ã€‚å¹¶ä¸”æˆ‘ä»¬å¸Œæœ› <span class="math inline">\(\hat{I}\)</span> æ˜¯æœ€æœ‰æ•ˆçš„ä¼°è®¡ï¼Œä¹Ÿå³å¤šæ¬¡ä¼°è®¡çš„æ–¹å·®æœ€å°ï¼ˆè¿™ä¸ªé—®é¢˜å°†åœ¨ç¬¬ä¸‰ç« è®¨è®ºï¼‰ã€‚ä¸éš¾çœ‹å‡ºï¼Œå¦‚ä¸‹ä¼°è®¡å­æ˜¯æ— åçš„ï¼š <span class="math display">\[
\hat{I}=\frac{1}{N}\sum_{i=1}^N\frac{f(X_i)}{p(X_i)}
\]</span> â€‹ æ ¹æ®å¦‚ä¸‹æ¨å¯¼å¯ä»¥éå¸¸è½»æ˜“åœ°è·çŸ¥ï¼Œæ³¨æ„<span class="math inline">\(f(X_i)\)</span> æ˜¯éšæœºå˜é‡ï¼Œ<span class="math inline">\(p(X_i)\)</span>ä¸ºéšæœºå˜é‡<span class="math inline">\(X_i\)</span>å–å€¼ä¸€å®šæ—¶çš„PDFã€‚ <span class="math display">\[
\begin{align}
E(\hat{I}) &amp;= E\left( \frac{1}{N}\sum_{i=1}^N\frac{f(X_i)}{p(X_i)} \right)=\frac{1}{N}\sum_{i=1}^N E\left(\frac{f(X_i)}{p(X_i)} \right)\\
&amp;=\frac{1}{N}\sum^N \int_\Omega \frac{f(x)}{p(x)}p(x)dx = \frac{1}{N}\sum^N \int f(x)dx = \int f(x) dx \label{der1}
\end{align}
\]</span> â€‹ è™½ç„¶ï¼Œé™¤ä»¥PDFè¿™ç§äº‹æƒ…... å¹¶ä¸æ˜¯ä¸€çœ¼å°±èƒ½çŸ¥é“å…¶èƒŒåçš„æ•°å­¦ç›´è§‰çš„ã€‚å…³äºæ•°å­¦ç›´è§‰ï¼Œå¤–ç½‘æœ‰å¾ˆå¤šè§£é‡ŠMonte Carloç§¯åˆ†çš„æ–‡ç« ï¼Œè¿™é‡Œåªè®²ä¸€ç§æœ€ç®€å•çš„å…¥é—¨çº§ç†è§£æ–¹æ³•ï¼šå‡è®¾<span class="math inline">\(f(X_i)\)</span>åœ¨<span class="math inline">\([a, b]\)</span>ä¸Šå‡åŒ€åˆ†å¸ƒï¼Œé‚£ä¹ˆPDFå°±æˆäº†<span class="math inline">\((b-a)^{-1}\)</span>ï¼Œé™¤ä»¥<span class="math inline">\(p(x)\)</span>åˆ™æˆäº†ä¹˜ä»¥<span class="math inline">\((b - a)\)</span>ã€‚åˆ™æ¯ä¸ªæ ·æœ¬ç›¸å½“äºè®¡ç®—<span class="math inline">\(f(x) \times (b - a)\)</span>ï¼ˆæŸä¸ªçŸ©å½¢çš„é¢ç§¯ï¼‰ï¼Œè¿›è¡Œå¤šæ¬¡é¢ç§¯ä¼°è®¡å¹¶å¹³å‡åˆ™å¯ä»¥å¾—åˆ°ç»“æœã€‚å¦‚æœæŠŠå‡åŒ€åˆ†å¸ƒæ¢ä¸ºå…¶ä»–ä»»æ„åˆ†å¸ƒä¹Ÿæœ‰ä¸€æ ·çš„ç»“æœã€‚Monte Carloç§¯åˆ†éå¸¸æœ‰ç”¨ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥å¤„ç†éš¾ä»¥è¿›è¡Œç§¯åˆ†çš„å‡½æ•°ã€‚</p>
<h3 id="åœ¨å…‰çº¿è¿½è¸ªä¸­çš„åº”ç”¨">2.2 åœ¨å…‰çº¿è¿½è¸ªä¸­çš„åº”ç”¨</h3>
<p>â€‹ éš¾ä»¥ç§¯åˆ†çš„å‡½æ•°ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œç©ºé—´ä¸­æŸä¸€ç‚¹çš„ Radiance è®¡ç®—å…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{radiance}
L_o(x, w_o) = L_e(x, w_o) + \int_\Omega L_i(x, w_i) f_r(w_i, w_o, x) \cos\theta dw_i
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(w_i\)</span>ä¸ºå…¥å°„å…‰æ–¹å‘ï¼Œ<span class="math inline">\(w_o\)</span>ä¸ºå‡ºå°„æ–¹å‘ï¼Œ<span class="math inline">\(x, n\)</span>åˆ†åˆ«ä¸ºå…‰çº¿å‡»ä¸­ç‚¹ä¸å‡»ä¸­ç‚¹æ³•å‘é‡ã€‚<span class="math inline">\(\cos(a, b)\)</span>ä»£è¡¨äº†ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¤¹è§’ä½™å¼¦å€¼ï¼ˆä¹Ÿå³å½’ä¸€åŒ–åçš„å†…ç§¯ï¼‰ï¼Œ<span class="math inline">\(L_{e}\)</span>åˆ™ä¸ºå‡»ä¸­ç‚¹ä¸º<span class="math inline">\(x\)</span>ï¼Œå…¥å°„æ–¹å‘ä¸º<span class="math inline">\(w_i\)</span>çš„ radianceã€‚ä¸Šå¼æ˜¯å°†å„ä¸ªå…¥å°„æ–¹å‘çš„å…‰è¿›è¡Œç§¯åˆ†ï¼šå…ˆæŒ‰cosineè§„åˆ™è¿›è¡Œè¡°å‡ï¼ŒåæŒ‰ç…§BSDFè¿›è¡Œâ€œå…¥å°„åˆ°å‡ºå°„çš„mappingâ€åŠ æƒç§¯åˆ†ã€‚å…¬å¼<span class="math inline">\(\eqref{radiance}\)</span>å³è¾¹çš„â€œå„æ–¹å‘å…¥å°„irradianceâ€éƒ¨åˆ†æ˜¯<strong>å¾ˆéš¾è¡¡é‡çš„</strong>ï¼šå¤šå…‰æºï¼Œå¤šæ¬¡åå°„ï¼Œé®æŒ¡ï¼ˆåŒ…æ‹¬shadowingä»¥åŠmaskingï¼‰ï¼Œè§£æè§£ç»å¯¹ä¸è¦æƒ³ã€‚åˆ™æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Monte Carloç§¯åˆ†ï¼ŒæŠŠç§¯åˆ†æ¢ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{discrete}
\frac{1}{N}\sum_{j=1}^N  \frac{L_{i,j}(x, w_{i,j}) f_r(w_{i,j}, w_o, x) \cos\theta}{p(?)}
\end{equation}
\]</span> â€‹ å¦‚æœï¼Œæˆ‘ä»¬å¯ä»¥è®¾æ³•è®¡ç®—<span class="math inline">\(L_{i, j}, f_{r}\)</span> ä»¥åŠ <span class="math inline">\(p(?)\)</span>ï¼Œä¸€åˆ‡å°†å˜å¾—â€œè½»æ¾â€ã€‚å¥½ï¼Œé‚£ä¹ˆ <strong>p(?)</strong> ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘åº”è¯¥æ±‚è§£ä»€ä¹ˆçš„åˆ†å¸ƒï¼Ÿæ˜¯<span class="math inline">\(w_i\)</span>ï¼Œè¿˜æ˜¯<span class="math inline">\(L_{i,j}(x, w_{i,j}) f_r(w_{i,j})\)</span> è¿˜æ˜¯æ•´ä¸ªåˆ†å­é¡¹ï¼Ÿï¼ˆæ³¨æ„<span class="math inline">\(\cos\theta\)</span>ä¹Ÿæ˜¯<span class="math inline">\(w_i\)</span>çš„å‡½æ•°ï¼Œå› ä¸º<span class="math inline">\(\theta\)</span>æ˜¯ <span class="math inline">\(w_i\)</span> ä¸æ³•å‘é‡ <span class="math inline">\(n\)</span> çš„å¤¹è§’ï¼‰ï¼Œä¸‰ç§æƒ…å†µçš„åˆ†å¸ƒæ˜¯ä¸åŒçš„ --- éšæœºå˜é‡å‡½æ•°çš„åˆ†å¸ƒä¸ä¸€å®šç­‰äºåŸåˆ†å¸ƒã€‚ä»å…¬å¼<span class="math inline">\(\eqref{der1}\)</span>å¯ä»¥çŸ¥é“ï¼š<span class="math inline">\(p(x)\)</span>åº”å½“æ˜¯<span class="math inline">\(f(x)\)</span>çš„åˆ†å¸ƒï¼Œæ‰èƒ½å¾—åˆ°æ— åçš„ä¼°è®¡ã€‚æ­¤å¤„çš„ <span class="math inline">\(f(x)\)</span> æ˜¾ç„¶æ˜¯æ•´ä¸ªåˆ†å­é¡¹ã€‚ä¸‹é¢ï¼Œæˆ‘æ¥é‡ç‚¹è®¨è®ºä¸€ä¸‹åˆ†å­çš„è”åˆåˆ†å¸ƒï¼ˆå­¦äº†ç‚¹éšæœºè¿‡ç¨‹è¿˜æ˜¯... æœ‰ç‚¹ä½œç”¨çš„ï¼Œè™½ç„¶å¿˜å¾—å·®ä¸å¤šäº†ï¼‰ã€‚</p>
<div class="note primary"><p>â€‹ åˆ†å­é¡¹å°†éœ€è¦è¢« <strong><u>åˆ†è§£</u></strong> ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>ç›´æ¥å…‰ç…§ï¼ˆdirect componentï¼‰ï¼šé‡‡æ ·å…‰æºä¸ä¸€æ¬¡åå°„</li>
<li>é—´æ¥å…‰ç…§ï¼ˆindirect componentï¼‰ï¼šé‡‡æ ·å…‰çº¿å¼¹å°„æ–¹å‘ï¼Œä½¿å¾—å…‰ç»§ç»­åœ¨ç©ºé—´ä¸­ä¼ æ’­</li>
</ul>
<p>â€‹ æ‹†åˆ†ä¹‹åï¼Œä¸¤éƒ¨åˆ†çš„PDFè®¡ç®—æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€å®šè¦æ³¨æ„ï¼Œåˆ†å­é¡¹çš„ä¸‰éƒ¨åˆ†<span class="math inline">\(L_i, f_r, \cos \theta\)</span>å¹¶éå…¨éƒ½æ˜¯éšæœºå˜é‡ï¼Œå¹¶éå…¨éƒ½ä¼šæœ‰é™„å±çš„åˆ†å¸ƒï¼ˆPDFï¼‰ã€‚ç›´æ¥å…‰ç…§ä¸­ï¼Œ$f_r, <span class="math inline">\(ä¸æ˜¯éšæœºå˜é‡ï¼Œä¸éœ€è®¡ç®—å…¶åˆ†å¸ƒï¼›é—´æ¥å…‰ç…§ä¸­ç”±äº\)</span>L_i$å¹¶éå³åˆ»è®¡ç®—ï¼ˆéœ€è¦åç»­å¼¹å°„è®¡ç®—ï¼‰ï¼Œæ•…ä¸è®¡ç®—æ­¤åˆ†å¸ƒã€‚<u><strong>åˆ†è§£æ€æƒ³æˆ‘å°†åœ¨2.3èŠ‚ä¸­è¯¦ç»†ä»‹ç»</strong></u>ã€‚</p>
</div>
<p>â€‹ æˆ‘ç°åœ¨çš„æ¸²æŸ“å™¨ï¼ˆæˆªè‡³2023.2.7ï¼‰ä¹Ÿæ‰åªå†™åˆ°é€æ˜æŠ˜å°„ç‰©ä½“ï¼ˆéæ•£å°„ï¼‰éƒ¨åˆ†ï¼Œç­‰åˆ°æ•£å°„éƒ¨åˆ†åŠ å…¥åï¼Œradiative transfer equationï¼ˆRTEï¼‰å°†ä¼šæ›´åŠ å¤æ‚ã€‚åœ¨æ›´åŠ å¤æ‚çš„å‡½æ•°ä½œä¸ºè¢«ç§¯å‡½æ•°</p>
<h3 id="åˆ†è§£æ³•ä¸åˆ†å¸ƒå˜æ¢---ä»ç†è§£åˆ°å®ç°">2.3 åˆ†è§£æ³•ä¸åˆ†å¸ƒå˜æ¢ - ä»ç†è§£åˆ°å®ç°</h3>
<h4 id="ç›´è§‰ç†è§£">2.3.1 ç›´è§‰ç†è§£</h4>
<p>â€‹ ä»å…¬å¼<span class="math inline">\(\eqref{discrete}\)</span>æ¥çœ‹ï¼Œå…‰çº¿è¿½è¸ªä¼¼ä¹æ˜¯ä¸€ä¸ªæŒ‡æ•°çˆ†ç‚¸å¼çš„é€’å½’è¿‡ç¨‹ï¼šå…‰çº¿åœ¨æ¯ä¸€ä¸ªå‡»ä¸­ç‚¹éƒ½å‘å‡ºNæ¡å…‰çº¿ï¼Œé‚£ä¹ˆå¼¹å°„<span class="math inline">\(n\)</span>æ¬¡æ„å‘³ç€<span class="math inline">\(N^n\)</span>æ¡å…‰çº¿ã€‚ä½†æˆ‘ä»¬å¯ä»¥å°†å…¶ç®€åŒ–ï¼šåªtraceä¸€æ¡å…‰çº¿ã€‚è¿™ç§æ–¹æ¡ˆè¢«ç§°ä¸ºï¼špath tracingã€‚æ³¨æ„ï¼Œæ­¤å¤„æˆ‘ä»¬è€ƒè™‘çš„æ˜¯å•å‘ï¼ˆunidirectionalï¼‰path tracingï¼Œå¹¶ä¸”æ–¹å‘æ˜¯ä» <u><strong>ç›¸æœºï¼ˆsensorï¼‰åˆ°å…‰æº</strong></u>ã€‚</p>
<p>â€‹ å›åˆ°2.2ä¸­çš„é—®é¢˜ï¼šç›´æ¥å…‰ç…§ä¸é—´æ¥å…‰ç…§çš„åˆ†è§£é—®é¢˜ã€‚ç›´æ¥å…‰ç…§ä¸ºå…‰æºå‘å‡ºçš„å…‰ä»…ç»è¿‡ä¸€æ¬¡å¼¹å°„å°±åˆ°è¾¾sensorçš„éƒ¨åˆ†ï¼Œé—´æ¥å…‰ç…§åˆ™éœ€è¦æ›´å¤šæ¬¡å¼¹å°„ã€‚ä½†ï¼Œå¯¹äºæ•´æ¡è·¯å¾„ï¼š<span class="math inline">\(v_s, v_1, v_2, ..., v_n\)</span> è€Œè¨€ï¼ˆ<span class="math inline">\(v_s\)</span>ä¸ºä¼ æ„Ÿå™¨ï¼Œ<span class="math inline">\(v_n\)</span>ä¸ºç¬¬næ¬¡å…‰çº¿ä¸åœºæ™¯ç›¸äº¤ï¼‰ï¼Œåœ¨æŸä¸€å¤„çš„<span class="math inline">\(v_j\)</span>çš„ç›´æ¥å…‰ç…§å°†å˜ä¸ºåœ¨æŸä¸€å¤„<span class="math inline">\(v_i (i&lt;j)\)</span>å¤„çš„é—´æ¥å…‰ç…§ï¼š</p>
<pre class="mermaid">
graph RL

A(...)--&gt;|indirect from v...|B(v3)--&gt;|indirect from v3|C(v2)--&gt;|indirect from v2|D(v1)--&gt;E(sensor)
F(direct v1)--&gt;D
G(direct v2)--&gt;C
H(direct v3)--&gt;B

</pre>
<center>
Figure 2. å…‰ç…§çš„é€’å½’åˆ†è§£æ¨¡å‹
</center>
<p>â€‹ æ•…äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ç›´æ¥å»è®¨è®ºé—´æ¥å…‰ç…§ï¼Œé—´æ¥å…‰ç…§ <strong><u>å°±æ˜¯æ­¤èŠ‚ç‚¹åèŠ‚ç‚¹ä¸Šçš„ç›´æ¥å…‰ç…§</u></strong>ã€‚æ•…æˆ‘ä»¬åªéœ€è¦è®¨è®ºï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">ç›´æ¥å…‰ç…§</a></li><li class="tab"><a href="#span-unique-name-2">é—´æ¥ä¼ è¾“</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ æ¯ä¸€ä¸ªèŠ‚ç‚¹å¤„çš„ç›´æ¥å…‰ç…§ã€‚å¦‚ä½•è®¡ç®—ï¼Ÿé‡‡ç”¨Monte Carloç§¯åˆ†ï¼ˆä¸‹å¼å°†ä¸è·ç¦»è¡°å‡ï¼Œå…‰æºå‡ºå°„è¡°å‡é¡¹æ•´åˆåˆ°äº†<span class="math inline">\(L\)</span>ä¸­ï¼‰ï¼š</p>
<p><span class="math display">\[
\begin{equation}
L_d(x, w_o) = \frac 1N \sum_{i=1}^N \frac{f_r(x, x_{l, i}\rightarrow x, w_o) L(x_{l, i},x_{l, i}\rightarrow x )\cos (x_{l, i}\rightarrow x, n_l)}
{p(x_{l, i})}
\end{equation}
\]</span> â€‹ æœ€ç†æƒ³çš„æƒ…å†µå½“ç„¶æ˜¯è¿›è¡Œç§¯åˆ†ï¼šå¯¹æ¯ä¸€ä¸ªå…‰æºï¼Œå…‰æºä¸Šçš„æ¯ä¸€ä¸ªç‚¹ï¼ˆå‡è®¾æ˜¯æœ‰é¢ç§¯å…‰æºï¼‰<span class="math inline">\(x_l\)</span>ï¼Œè®¡ç®—æ­¤ç‚¹ç…§å°„åœ¨<span class="math inline">\(x\)</span>ç‚¹ï¼ˆå½“å‰vertexï¼‰å¤„çš„irradianceï¼ˆä¸cosineé¡¹ç›¸ä¹˜ï¼‰ï¼Œç»“æœä¹˜ä»¥BRDFï¼ˆBxDFï¼Œå¯èƒ½æ˜¯åˆ«çš„å‡½æ•°ï¼‰è½¬ä¸ºè¾“å‡ºå…‰ã€‚å®ç°æ—¶åˆ™åœ¨æ‰€æœ‰å…‰æºä¸Šå–å…±Nä¸ªç‚¹ï¼ˆshadow raysï¼‰ï¼Œè®¡ç®—æ¯ä¸ªé‡‡æ ·ç‚¹çš„åˆ†å¸ƒ<span class="math inline">\(p(x_{l, i})\)</span>ä»¥åŠä¸Šå¼ä¸­å…¶ä»–éƒ¨åˆ†ï¼Œæœ€åå¹³å‡ã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ å…‰çº¿éœ€è¦ä¼ è¾“ï¼Œ<strong><u>é—´æ¥å…‰ç…§çš„radianceæ˜¯ä¼ è¿‡æ¥çš„</u></strong>ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€æ¡å…‰è·¯å‡»ä¸­<span class="math inline">\(v_j\)</span>ï¼Œä¹Ÿå³<span class="math inline">\(v_{j-1}\rightarrow v_j\)</span>ï¼Œåˆ™æ¥ä¸‹æ¥éœ€è¦çŸ¥é“ä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li><strong><u>æ–°çš„ä¼ è¾“æ–¹å‘è®¡ç®—ï¼š</u></strong> ä»€ä¹ˆæ ·çš„å…‰å‡»ä¸­<span class="math inline">\(v_{j}\)</span>ç‚¹åæœ‰å¾ˆå¤§æ¦‚ç‡å¯ä»¥ä¼ è¾“åˆ°<span class="math inline">\(v_{j-1}\)</span>ï¼Ÿæ³¨æ„ï¼Œåœ¨backward tracingä¸­ï¼Œæˆ‘ä»¬ä»ç›¸æœºå¼€å§‹trace raysï¼Œæ–¹å‘æ˜¯<span class="math inline">\(v_{j-1}\rightarrow v_j\)</span>ï¼Œä½†å®é™…æƒ…å†µæ˜¯ï¼šå…‰æºï¼ˆä½äº<span class="math inline">\(v_{j+1}\)</span>ï¼‰å‘å°„å…‰å‡»ä¸­<span class="math inline">\(v_j\)</span>ï¼Œ<span class="math inline">\(v_j\)</span> å¤„äº§ç”Ÿæè´¨/ä»‹è´¨ interactionåå°†å…‰æºçš„å…‰åå°„åˆ° <span class="math inline">\(v_{j-1}\)</span> å¤„ã€‚æ•…æˆ‘ä»¬éœ€è¦çŸ¥é“çš„å®é™…æ˜¯ï¼š<span class="math inline">\(v_{j + 1}\)</span>å¯èƒ½åœ¨ä»€ä¹ˆä½ç½®ï¼Ÿä¹Ÿå³ï¼Œå¦‚æœå·²çŸ¥<span class="math inline">\(v_{j-1}\rightarrow v_j\)</span>ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“<span class="math inline">\(v_{j+1}\)</span>åœ¨ä»€ä¹ˆä½ç½®æ‰èƒ½ä½¿å¾—ç”±æ­¤ç‚¹å‘å‡ºçš„é—´æ¥å…‰ç…§å¯ä»¥é€šè¿‡ <span class="math inline">\(v_{j+1}\rightarrow v_{j }\rightarrow v_{j-1}\)</span> ä¼ è¾“ï¼Ÿå‡è®¾æˆ‘ä»¬è€ƒè™‘<span class="math inline">\(v_{j}\)</span>ä½äºå®Œç¾çš„é•œé¢ä¸Šï¼Œåˆ™æ ¹æ®ä¸€èˆ¬çš„å…‰è·¯å¯é€†åŸç†ï¼Œ<span class="math inline">\(v_{j+1}\rightarrow v_j\)</span> ä¸€å®šåœ¨ <span class="math inline">\(v_{j-1}\rightarrow v_j\)</span> çš„åå°„æ–¹å‘ä¸Šã€‚æ›´åŠ ä¸€èˆ¬çš„æƒ…å†µåˆ™éœ€è¦è§†BSDFè€Œå®šã€‚</li>
<li><span class="math inline">\(v_{j+1}\rightarrow v_j\)</span> çš„â€œå¯èƒ½æ€§â€ï¼ˆPDFå€¼ï¼‰ï¼šè¿˜æ˜¯ä»¥é•œé¢ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¿…ç„¶ä¼šåœ¨åå°„æ–¹å‘é™„è¿‘ï¼ˆå‡è®¾é•œé¢ä¸æ˜¯å®Œç¾çš„ï¼‰é‡‡æ ·æ–°çš„å…‰çº¿æ–¹å‘ã€‚æ¯ä¸ªæ–¹å‘éƒ½æœ‰å…¶å¯èƒ½æ€§å€¼ï¼ˆPDFï¼‰ï¼Œä¾‹å¦‚å½“å…‰çº¿å‚ç›´é•œé¢å…¥å°„æ—¶ï¼Œåœ¨å¹³è¡Œé•œé¢æ–¹å‘çš„å¯èƒ½æ€§å‡ ä¹ä¸º0ã€‚</li>
<li><strong><u>ä¼ è¾“ç‡è®¡ç®—ï¼š</u></strong> æˆ‘ä»¬çš„å…‰çº¿è¿½è¸ªå™¨ä¸å¯èƒ½åªè€ƒè™‘å®Œç¾é•œé¢ã€‚æ•… <span class="math inline">\(v_{j+1}\rightarrow v_{j}\)</span> ä¼ è¾“çš„radianceå°†å¾ˆå¯èƒ½åœ¨ <span class="math inline">\(v_j\)</span> å¤„æ ¹æ®BSDFè¿›è¡Œè¡°å‡ï¼Œè¡°å‡åçš„å€¼æˆä¸º <span class="math inline">\(v_{j}\rightarrow v_{j-1}\)</span> ä¸Šä¼ è¾“çš„radianceã€‚ ä¼ è¾“ç‡ä¼šè¢«ç§°ä¸ºï¼šthroughputï¼Œåœ¨æˆ‘çš„ä»£ç é‡Œï¼Œåˆ™ç§°ä¸º contributionã€‚</li>
</ul></div></div></div>
<p>â€‹ æœ‰äº†ä»¥ä¸Šä¸¤ä¸ªéƒ¨åˆ†ï¼šï¼ˆ1ï¼‰ç›´æ¥å…‰ç…§ï¼ˆ2ï¼‰é—´æ¥ä¼ æ’­çš„æ–¹å‘ã€PDFä»¥åŠä¼ è¾“ç‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç±»ä¼¼å›¾2è¿™æ ·ï¼Œé€å±‚é€’å½’åˆ†è§£å…‰ã€‚æ‰€ä»¥ï¼Œæˆ‘å¯ä»¥è¯´ï¼šæœ€ååˆ°è¾¾ç›¸æœºçš„å…‰ï¼Œæ˜¯ã€å‡»ä¸­å…‰æºçš„å…‰<span class="math inline">\(L_e\)</span>ã€‘ä»¥åŠæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€å¯èƒ½ç»è¿‡å¤šæ¬¡å¼¹å°„çš„ã€ç›´æ¥å…‰ç…§ã€‘ã€‚ï¼ˆæ³¨æ„ï¼ŒBunnyKillerï¼ˆJarabo 2014ï¼‰ä¸­å¹¶æ²¡æœ‰è®¡ç®—<span class="math inline">\(L_e\)</span>ï¼Œæ‰€ä»¥å®ƒçœ‹ä¸åˆ°é¢å…‰æºçš„æ ·å­... ä»£ç ä¸­ä¹Ÿæœ‰å¾ˆå¤šé”™ï¼‰</p>
<div class="note danger"><p>â€‹ æ³¨æ„ï¼Œåœ¨é¢å…‰æºæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸trace shadow raysï¼ˆä¸è®¡ç®—ç§¯åˆ†éƒ¨åˆ†ï¼‰ï¼Œåªè®¡ç®—<span class="math inline">\(L_e\)</span>ï¼ˆå‡»ä¸­å…‰æºåéƒ¨åˆ†ï¼‰ä¹Ÿæ˜¯å¯ä»¥å®Œæˆæ­£ç¡®æ¸²æŸ“çš„ï¼Œ<u><strong>ä½†æ˜¯ï¼Œæ”¶æ•›ä¼šæ…¢å¾ˆå¤šå¾ˆå¤šã€‚</strong></u>ç¬”è€…ä¹‹å‰çš„ä»£ç ä¸­æœ‰ä¸ªbugï¼Œshadow rayså…¨æ˜¯é”™çš„ï¼Œdirect componentå…¨éƒ¨ä¸º0ï¼Œä¹Ÿå¾—åˆ°äº†å¯¹çš„ç»“æœï¼Œä½†æ”¶æ•›ä¸€ç›´å¾ˆæ…¢ï¼ŒMISåŠ ä¸Šäº†ä¹Ÿå¾ˆæ…¢ï¼›ä¹‹åæ‰å‘ç° direct component æ ¹æœ¬æ²¡æœ‰ç®—ï¼Œä¿®æ”¹åç®€ç›´å°±æ˜¯â€œå…‰é€Ÿæ”¶æ•›â€ã€‚æ•…è¿™ä¹Ÿå°è¯äº†æˆ‘åœ¨ introduction ä¸­æ‰€è®²çš„ï¼šå³ä½¿ä»£ç é”™äº†ï¼Œç»“æœä¹Ÿå¯èƒ½å¯¹ï¼ˆæˆ–è€…é”™è¯¯è‚‰çœ¼çœ‹ä¸å‡ºæ¥ï¼‰ã€‚è¿™å°±æ˜¯æ­¤ç±»æ¸²æŸ“å™¨ debug çš„å›°éš¾ä¹‹å¤„ã€‚</p>
</div>
<h4 id="è®¡ç®—è¿‡ç¨‹">2.3.2 è®¡ç®—è¿‡ç¨‹</h4>
<p>â€‹ åºŸè¯äº†å¾ˆå¤šï¼Œç°åœ¨æˆ‘æ¥è®¨è®ºä¸€ä¸‹ä¸¤éƒ¨åˆ†çš„è®¡ç®—ã€‚è¿™é‡Œæˆ‘ä»¬ä¸¾ä¸¤ä¸ªéå¸¸å¸¸è§çš„ä¾‹å­ï¼šç‚¹å…‰æºä¸é¢å…‰æºï¼Œå¹¶ä¸”æˆ‘ä»¬å‡è®¾åœºæ™¯ä¸­æœ€å¤šæœ‰ä¸¤ä¸ªå…‰æºï¼ˆä¸å¤±ä¸€èˆ¬æ€§ï¼‰ã€‚åˆ™æŸä¸€å¤„çš„å‡ºå°„å…‰çº¿å¯ä»¥è¢«åˆ†è§£ä¸ºç›´æ¥ä¸é—´æ¥å…‰ç…§ï¼ˆä¸è€ƒè™‘è‡ªå‘å…‰ï¼‰ï¼š <span class="math display">\[
\begin{equation}
L_o(x, w_o) = \int_\Omega L_{in}(x, w_i) f_r(w_i, w_o, x) \cos\theta dw_i + \sum_{i=1}^M\int_A f_r(x, x_{l, i}\rightarrow x, w_o)L(x, x_{l, i}\rightarrow x)\cos\theta dA(x_{l, i}) 
\end{equation}
\]</span> â€‹ ç¬¬ä¸€éƒ¨åˆ†ï¼šé—´æ¥å…‰ç…§ï¼Œç¬¬äºŒéƒ¨åˆ†ï¼šMä¸ªå…‰æºä¸Šæ¯ä¸€ç‚¹åœ¨<span class="math inline">\(x\)</span>å¤„çš„ç›´æ¥å…‰ç…§ï¼Œ<span class="math inline">\(L_{in}\)</span>åŒ…å«äº†<span class="math inline">\(G\)</span>ï¼š <span class="math display">\[
G(x_{l, i}\leftrightarrow x) = V(x_{l, i}\leftrightarrow x)\frac{|\cos(w_i, n)(\cos{(w_{i}, n_e)})|}{\Vert x_{l, i} -x\Vert ^2}
\]</span> â€‹ å…¶ä¸­ï¼š</p>
<ul>
<li><span class="math inline">\(V(Â·)\)</span>é¡¹å°±æ˜¯visibilityé¡¹ï¼Œéœ€è¦å…‰æºä¸å‡»ä¸­ç‚¹ä¹‹é—´æ²¡æœ‰é®æŒ¡ç‰©ï¼Œæ­¤é¡¹ä¸€èˆ¬æ— éœ€é‡‡æ ·ï¼ˆç›´æ¥åˆ¤æ–­ï¼‰ã€‚</li>
<li>cosine termçš„ç¬¬ä¸€é¡¹å¾ˆç†Ÿæ‚‰äº†ï¼Œå…‰æºå…¥å°„é¢çš„cosineè¡°å‡ã€‚</li>
<li>ç¬¬äºŒé¡¹ä¸º<span class="math inline">\(\cos(w_{i}, n_e)\)</span>ï¼Œå…¶ä¸­<span class="math inline">\(n_{e}\)</span>ä¸ºå…‰æºå‡ºå°„ä½ç½®çš„æ³•å‘é‡ï¼ˆä¾‹å¦‚é¢å…‰æºçš„é¢æ³•ç›¸ï¼‰ã€‚è¿™é¡¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œå®é™…ä¸Šä¸ä¸€ç§å«åšâ€œprojected solid angleâ€æœ‰å…³ï¼Œè§£é‡Šè§ä¸‹å¼•ç”¨å—ä»¥åŠä¸€å¼ å›¾ã€‚ç”±äºå…‰æºè¾“å‡ºå…‰æŒ‰ç…§ç«‹ä½“è§’å®šä¹‰ï¼ˆradianceä¸irradianceï¼‰ï¼Œå…‰æºradianceè‹¥æœ¬èº«å«æœ‰cosineé¡¹ï¼Œå¯ä»¥å°†æ­¤é¡¹ç§»åŠ¨åˆ°ç«‹ä½“è§’éƒ¨åˆ†ã€‚</li>
</ul>
<blockquote>
<p>Projected solid angle has meaning primarily for a small Lambertian source, which has intensity that varies as the cosine of the angle with the surface normal [1]</p>
</blockquote>
<center>
<img src="/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/Schematic-illustration-of-projected-differential-solid-angles-for-normal-red-and.png" style="zoom: 67%;">
</center>
<center>
Figure 3. æŠ•å½±ç«‹ä½“è§’ç¤ºæ„å›¾[3]
</center>
<p>â€‹ å†™æˆä»£ç å¯å®ç°çš„ç¦»æ•£æƒ…å†µï¼ˆç”¨Monte Carloç§¯åˆ†è¡¨ç¤ºï¼‰ï¼š <span class="math display">\[
\begin{align}
L_o(x, w_o) = \frac 1N \sum_{j=1}^N \frac{L_{in}(x, w_{i, j}) f_r(w_{i, j}, w_o, x) \cos\theta}{p(w_{i, j})} + \notag \\
\frac{1}{N_s}\sum_{j=1}^{N_s}\frac{L_{l, j}(x, x_{l, j}\rightarrow x) f_r{(x, x_{l, j}\rightarrow x, w_o)}\cos\theta}{p(x_{l, j}|e_j)p(e_j)}
\end{align}
\]</span></p>
<h5 id="ç›´æ¥å…‰ç…§çš„è®¡ç®—">2.3.2.1 ç›´æ¥å…‰ç…§çš„è®¡ç®—</h5>
<p>â€‹ ï¼ˆ1ï¼‰é¦–å…ˆé‡‡æ ·å…‰æºï¼Œæ¯”å¦‚ï¼šä¸¤ä¸ªç‚¹å…‰æºé€‰ä¸€ä¸ªã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ç”¨ç­‰æ¦‚ç‡é€‰æ‹©ä¸åŒå…‰æºï¼ˆé¢å…‰æºå¯èƒ½éœ€è¦æ ¹æ®é¢ç§¯è¿›è¡ŒåŠ æƒï¼‰ã€‚æ­¤å¤„ä¼šè¿”å›ä¸€ä¸ªPDFï¼šé€‰å…‰æºæ€»æœ‰æ¦‚ç‡å§ï¼Œä¾‹å¦‚ä¸¤ä¸ªå…‰æºæ—¶ä¸€èˆ¬ç”¨<span class="math inline">\(0.5\)</span>ï¼Œè®°ä¸º<span class="math inline">\(p(e_i)\)</span></p>
<p>â€‹ ï¼ˆ2ï¼‰åœ¨é‡‡æ ·åçš„å…‰æºä¸Šè¿›è¡Œç‚¹é‡‡æ ·ï¼šç‚¹å…‰æºä¸ç”¨é‡‡æ ·ï¼ˆåªæœ‰ä¸€ä¸ªç‚¹å˜›ï¼‰ï¼Œé¢å…‰æºåˆ™æ ¹æ®å®ç°ä¸åŒæœ‰æ‰€å˜åŒ–ã€‚ä¾‹å¦‚åœ¨æˆ‘çš„ä»£ç ä¸­ï¼Œæˆ‘çš„é¢å…‰æºæ˜¯å¯ä»¥attachåˆ°æŸä¸ªç‰©ä½“ä¸Šçš„ï¼ˆæ¯”å¦‚å‘å…‰çš„å¢™ã€ç›’å­ã€çƒç­‰ç­‰ï¼‰ï¼Œç‰©ä½“è¡¨å¾å¦‚æœä¸º<code>mesh</code>ï¼Œåˆ™éœ€è¦é¦–å…ˆé‡‡æ ·é¢ç‰‡ï¼Œæ­¤åå†åœ¨é¢ç‰‡ä¸Šé‡‡æ ·ç‚¹ï¼Œè€Œå¦‚æœæ˜¯æ˜¾å¼å‡ ä½•è¡¨å¾ï¼ˆæ¯”å¦‚ä¸€ä¸ªçŸ©å½¢ï¼‰ï¼Œåˆ™ä¸ºé¢ç§¯çš„å€’æ•°ï¼ˆå‡åŒ€åˆ†å¸ƒå‡è®¾ï¼‰ã€‚è®°æ­¤æ¦‚ç‡ä¸º <span class="math inline">\(p(x_l|e_i)\)</span>ï¼Œæ³¨æ„æ­¤æ¦‚ç‡ä¸ºç»™å®šå…‰æºä¹‹åçš„æ¡ä»¶æ¦‚ç‡ã€‚</p>
<p>â€‹ ï¼ˆ3ï¼‰è¦ç”¨ä»€ä¹ˆæ¦‚ç‡è®¡ç®—ï¼Ÿè§’åº¦ç§¯åˆ†ä¸é¢ç§¯ç§¯åˆ†æ˜¯å®Œå…¨ä¸åŒçš„ã€‚å¦‚æœä»…ä»…æ˜¯åœ¨é¢å…‰æºä¸Šé‡‡æ ·ï¼Œå½“ç„¶å¯ç›´æ¥ä½¿ç”¨<span class="math inline">\(p(x_l|e_i)p(e_i)\)</span>è®¡ç®—PDFï¼Œä½† <u><strong>å¦‚æœè¦è¿›è¡ŒMISï¼ˆmutiple importance samplingï¼‰</strong></u>ï¼Œå°±å¿…é¡»å°†å…‰æºé‡‡æ ·ä¸BSDFé‡‡æ ·è½¬åŒ–åˆ°åŒä¸€ä¸ªç©ºé—´ä¸‹è®¨è®ºã€‚è¿™ä¸ªéƒ¨åˆ†æˆ‘ä»¬ç•™åˆ°ç¬¬ä¸‰ç« è¯´ã€‚</p>
<p>â€‹ ï¼ˆ4ï¼‰å¤šå…‰æºæˆ–è€…æ˜¯å¤§å‹é¢å…‰æºæ—¶ï¼Œå°½é‡å¤šä½¿ç”¨ä¸€äº›shadow raysï¼Œæœ‰åŠ©äºæ”¶æ•›ã€‚</p>
<p>â€‹ ä»¥ä¸ŠæŠ€æœ¯å°±æ˜¯è‘—åçš„ï¼šâ€Next Event Estimationâ€œ</p>
<blockquote>
<p>Idea: follow each ray via multiple indirect bounces, but at each bounce, compute the direct lighting from light source surfaces!</p>
<ul>
<li>Detected light at each bounce is no longer dependent on coincidence</li>
<li>This is what we refer to as Next Event Estimation</li>
</ul>
</blockquote>
<h5 id="é—´æ¥å¼¹å°„çš„è®¡ç®—">2.3.2.2 é—´æ¥å¼¹å°„çš„è®¡ç®—</h5>
<p>â€‹ ï¼ˆ1ï¼‰æ ¹æ®æ¥è‡ªsensoræ–¹å‘çš„å…¥å°„å…‰çº¿ã€æ³•å‘é‡ä»¥åŠBSDFï¼Œé‡‡æ ·å‡ºå°„æ–¹å‘ï¼ˆbackward tracingæ„ä¹‰ä¸Šçš„å‡ºå°„ï¼Œå®é™…æˆ‘ä»¬åœ¨ç¡®å®šç‰©ç†æ„ä¹‰ä¸Šçš„å…¥å°„ï¼Œ<strong><u>è¿™ç‚¹éœ€è¦æ¸…æ¥šç†è§£ï¼</u></strong>ï¼‰ã€‚</p>
<p>â€‹ ï¼ˆ2ï¼‰æ—¢ç„¶æ˜¯é‡‡æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡‡æ ·è¿‡ç¨‹ä¸­ç®—å‡ºå¯¹åº”çš„PDFã€‚æ³¨æ„ï¼Œé‡‡æ ·çš„PDFå€¼åº”å½“æ˜¯<span class="math inline">\(f_r(x, w_i, w_o)\cos\theta\)</span> çš„PDFå€¼ï¼ˆä½†é‡‡æ ·æ‰€ç”¨çš„åˆ†å¸ƒå¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä½†è¶Šåƒ<span class="math inline">\(f_r(x, w_i, w_o)\cos\theta\)</span> è¶Šå¥½ï¼Œä½†è¿™ä¸ªå†…å®¹ä¸Importance samplingæœ‰å…³ï¼Œæœ¬ç¯‡åšå®¢å°±ä¸ç»†è®²äº†ï¼‰ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä¸<span class="math inline">\(f_r(x, w_i, w_o)\)</span>æœ‰å…³ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å®é™…æƒ³é‡‡æ ·çš„æ˜¯<span class="math inline">\(w_o\)</span> (æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡ºå°„æ–¹å‘)ï¼Œä½†æ˜¯ä¸å‡ºå°„æ–¹å‘æœ‰å…³çš„å‡½æ•°åˆ™æ˜¯<span class="math inline">\(f_r\)</span> ä»¥åŠ <span class="math inline">\(\cos\theta\)</span> ï¼ˆç”±äºåªè®¨è®ºä¼ è¾“ç‡ï¼Œæ•…æ²¡æœ‰<span class="math inline">\(L_i\)</span>è¿™ä¸€é¡¹ï¼‰ã€‚</p>
<p>â€‹ ï¼ˆ3ï¼‰è®¡ç®—ä¼ è¾“ç‡ã€‚æ­¤å¤„æ³¨æ„ï¼Œ<span class="math inline">\(\cos\theta\)</span> æ˜¯å‡ºå°„æ–¹å‘ä¸æ³•çº¿ä¹‹é—´çš„å¤¹è§’ï¼ˆå¤šæ¬¡è¯´è¿‡ï¼Œbackward tracingçš„å‡ºå°„æ˜¯ç‰©ç†æ„ä¹‰ä¸Šçš„å…‰æºå…¥å°„ï¼‰ã€‚</p>
<p>â€‹ ï¼ˆ4ï¼‰æ³¨æ„ï¼ä¸ç®¡å®ç°ä»€ä¹ˆBRDF/BSDFï¼Œä¸€å®šè¦ä½¿å¾—ç»“æœæ»¡è¶³èƒ½é‡å®ˆæ’ï¼šä¼ æ’­è¿‡ç¨‹ä¸ä¼šå¯¼è‡´èƒ½é‡è¶Šæ¥è¶Šå¤§ã€‚</p>
<h5 id="èƒ½é‡å®ˆæ’">2.3.2.3 èƒ½é‡å®ˆæ’</h5>
<p>â€‹ å¼€å§‹æ—¶æˆ‘çš„ä»£ç ä¸æ»¡è¶³èƒ½é‡å®ˆæ’ï¼Œä¼ æ’­ä¼šå¯¼è‡´ radiance è¶Šæ¥è¶Šå¤§ï¼ˆæœ€åç”»é¢å…¨ç™½ï¼Œå‡ºç°inf/NaNï¼‰ã€‚åˆšå¼€å§‹æ—¶æˆ‘è¿˜éå¸¸ç–‘æƒ‘ï¼šé™¤ä»¥PDFæ—¶ï¼Œå¦‚æœæœ‰éå¸¸å°çš„PDFï¼Œéš¾é“ä¸ä¼šå°†radianceæ”¾å¾—å¾ˆå¤§å—ï¼Ÿä½†äº‹å®ä¸Šè¿™æ ·çš„æ‹…å¿ƒå¹¶ä¸å­˜åœ¨ï¼Œç”±äº BSDF æœ‰æ”¾ç¼©ç³»æ•°ã€‚æˆ‘å¼€å§‹è®¤ä¸ºï¼šBSDFåº”å½“æ˜¯ä¸€ä¸ªç›¸å¯¹å€¼å‡½æ•°ï¼šæœ€å¤§åå°„/é€è¿‡ç‡çš„ä½ç½®çš„å€¼ä¸º1ï¼Œå…¶ä½™ä½ç½®å°äº1ã€‚ä½†å®é™…ä¸Š BSDF éœ€è¦å½’ä¸€åŒ–ï¼Œå…³äºå½’ä¸€åŒ–ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªéå¸¸å¥½çš„å›ç­”ï¼ˆä¸åšå®¢ï¼‰<a href="#ref">[4]</a> <a href="#ref">[5]</a>ã€‚</p>
<p>â€‹ æœ‰å…³Lambert's Cosine Lawçš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä¹Ÿç®€å•è¯´ä¸€ä¸‹ï¼ˆç”±äºè¿™ä¸ªé—®é¢˜å½“æ—¶ä¹Ÿå›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼‰ã€‚é¦–å…ˆï¼Œæ˜¯åŠçƒç§¯åˆ†çš„æ¦‚å¿µã€‚æˆ‘ä»¬åœ¨è®¨è®ºæ—¶å¸¸å¸¸ä½¿ç”¨<span class="math inline">\(w_i/w_o\)</span>æ¥ä»£æ›¿æ–¹å‘ã€‚è€Œå¯¹åº”çš„ <span class="math inline">\(dw\)</span> åˆ™æ˜¯ <u><strong>å¯¹åº”æŸä¸ªæ–¹å‘<span class="math inline">\(w\)</span>çš„å¾®åˆ†ç«‹ä½“è§’</strong></u>ï¼ˆdifferential solid angleï¼‰ã€‚ç«‹ä½“è§’ï¼å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½è®¨è®ºçš„ç©æ„ï¼Œä½ è¯´å¦‚ä½•ç”¨å®ƒè¿›è¡Œç§¯åˆ†ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å±•å¼€ä¸ºç†Ÿæ‚‰çš„å¤šé‡ç§¯åˆ†ï¼ˆåœ¨ç¬›å¡å°”åæ ‡ç³»ä¸‹æˆ–è€…çƒåæ ‡ç³»ä¸‹ï¼‰ã€‚æ³¨æ„å¾®åˆ†ç«‹ä½“è§’ä¸çƒåæ ‡ç³»ï¼ˆ<span class="math inline">\(\theta\)</span> ä¸ºzenith angleï¼Œæˆ–è€…è¯´æ˜¯elevation angleï¼Œ<span class="math inline">\(\phi\)</span> æ˜¯ azimuth angleï¼‰ä¹‹é—´çš„è½¬æ¢ï¼š <span class="math display">\[
\begin{equation}
dw = \sin\theta d\theta d\phi
\end{equation}
\]</span></p>
<center>
<img src="/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/shad-light-beam7.png" style="zoom:100%;">
</center>
<center>
Figure 4. scratchpixelsä¸Šçš„ç«‹ä½“è§’-çƒåæ ‡ç³»è½¬æ¢ --- å¾ˆåƒæŠ•å½±ç«‹ä½“è§’å¯¹å§[5]
</center>
<p>â€‹ æ³¨æ„èŒƒå›´ï¼Œä¿¯ä»°è§’<span class="math inline">\(\theta\in[0, \pi/2]\)</span>, æ–¹ä½è§’<span class="math inline">\(\phi \in [0, 2\pi)\)</span>ã€‚æ­¤ <span class="math inline">\(\sin\)</span> é¡¹çš„å­˜åœ¨è§£é‡Šäº†normalization factorè®¡ç®—ä¸­ï¼Œç›´æ¥ç”¨ <span class="math inline">\(d\theta d\phi\)</span> ç®—å‡ºçš„ç»“æœä¸å¯¹çš„åŸå› ã€‚</p>
<p>â€‹ è€ŒBSDFçš„èƒ½é‡å®ˆæ’åˆ™å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼š <span class="math display">\[
\begin{equation}\label{bsdf_norm}
\int_\Omega f_r(x, w_i, w_o)\cos\theta  d w_i\leq 1
\end{equation}
\]</span> â€‹ æ­¤å¤–ï¼Œä¸ªäººè®¤ä¸ºè¿˜æœ‰ä¸€ç§å®šä¹‰æ–¹æ³•ï¼š <span class="math display">\[
\begin{equation}\label{nq}
\int_\Omega L_o(x, w_o) d w_o\leq \int_\Omega L_i(x, w_i) d w_i
\end{equation}
\]</span> â€‹ è¿™ä¸ªç»™å‡ºä¸€ä¸ª Lambertian è¡¨é¢çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>A surface with a Lambertian BRDF has the characteristic that <strong>independent of the direction from which one looks at that surface</strong>, one receives the <strong>same amount of reflected energy</strong> (i.e. a diffuse surface point looks the same from all possible directions) <a href="#ref">[4]</a></p>
</blockquote>
<p>â€‹ <a href="#ref">[4]</a>å¤„çš„æ€æƒ³è§ä¸‹å›¾ã€‚ä¸‹å›¾å¯ä»¥è¡¨ç¤ºä¸¤ç§æƒ…å†µï¼š</p>
<center>
<img src="/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/cad.png" style="zoom:50%;">
</center>
<center>
Figure 5. å»ºç­‘å¸ˆè€çˆ¹ç”¨CADå¸®æˆ‘ç”»çš„ç¤ºæ„å›¾ï¼šç­‰ç›´å¾„å…‰æŸ±ä»¥ä¸åŒè§’åº¦å…¥å°„ä¸€å¹³é¢/æŸä¸€åƒç´ çš„è§†è§’èŒƒå›´
</center>
<ul>
<li>ç­‰ç›´å¾„å…‰æŸ±ä»¥ä¸åŒè§’åº¦å…¥å°„ä¸€å¹³é¢ï¼šå¯çŸ¥è§’åº¦è¶Šå¤§ï¼Œå•ä½å¾®å…ƒå†…å…¥å°„å…‰å¼ºåº¦è¶Šå°ã€‚è¿™å°±æ˜¯ Lambert's Cosine Law çš„ç”±æ¥ã€‚ä¹Ÿæ˜¯path tracingç®—æ³•ä¸­æ¯ä¸€é¡¹BSDFï¼ˆé™¤äº† delta ç±» BSDFï¼Œå¦‚é•œé¢ï¼‰éƒ½éœ€è¦ä¹˜çš„ cosine é¡¹</li>
<li>æŸä¸€åƒç´ çš„è§†è§’èŒƒå›´ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œåƒç´ çš„ FOV åŸæœ¬ä¸ºé”¥å½¢ï¼Œåœ¨è·ç¦»è¾ƒè¿œæ—¶ç›´æ¥ç®€åŒ–ä¸ºç­‰å®½çš„æŸ±ä½“ã€‚å¯çŸ¥ï¼Œå…¥å°„è§’åº¦è¶Šå¤§ï¼Œæˆªé¢ç§¯è¶Šå¤§ï¼ˆå¯¹åº”çš„ radiance è‡ªç„¶å°±æ›´å¤šï¼Ÿï¼‰ã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬æ±‚ radiance æ—¶æ˜¯åœ¨æŸ±å†…æ±‚å¹³å‡è€Œéæ±‚å’Œï¼ˆæˆ–è€…é¢ç§¯ç§¯åˆ†ï¼‰ï¼Œæ•…è¿™ç§è§£è¯»å®é™…ä¸Šå¹¶ä¸å½±å“ç»“æœï¼ˆäº‹å®ä¸Šï¼Œæˆ‘æ‰€çŸ¥é“çš„rendererä¸­è²Œä¼¼éƒ½æ²¡æœ‰é™¤ä»¥<span class="math inline">\(\cos\theta_i\)</span>çš„æ“ä½œï¼‰</li>
</ul>
<p>â€‹ æˆ‘ä»¬ç»“åˆ Lambertian è¡¨é¢çš„å®šä¹‰ï¼šå„æ–¹å‘è§‚å¯ŸåŒä¸€ç‚¹ï¼Œradiance åº”å½“ä¸€è‡´ã€‚åˆ™å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{align}\label{lambert}
&amp;\int_\Omega \cos\theta \rho_d d w_o   \\
&amp;=\rho_d\int_\Omega  \cos\theta  d w_o \\
&amp;=\rho_d\int_0^{2\pi} \int_0^{\pi/2}   \sin\theta \cos\theta d\theta d\phi  \\
&amp;=\rho_d\pi
\end{align}
\]</span> â€‹ æ•…ç”±äºä¸Šå¼éœ€è¦å°äºç­‰äº1ï¼Œåˆ™Lambertianå¯¹åº”çš„ normalization factor æ˜¯ <span class="math inline">\(\pi\)</span>ï¼ˆå¯¹åº”<span class="math inline">\(\frac{\rho_d}{\pi}\pi=\rho_d\)</span>ï¼‰ï¼Œå¯¹åº”å…¶BSDFä¸º <span class="math inline">\(\rho_d / \pi\)</span>ï¼ˆä¹Ÿå³æ˜¯å‡åŒ€çš„ï¼‰ã€‚</p>
<hr>
<h2 id="todo">Todo</h2>
<p>â€‹ æœ€æœ‰è¶£çš„ï¼ˆä¹Ÿæ˜¯æ¯”è¾ƒæ¶å¿ƒçš„éƒ¨åˆ†ï¼‰ï¼Œå½“å±é‡‡æ ·ä»¥åŠè¿›è¡ŒBSDFçš„è®¾è®¡ã€‚å¦‚ä½•è®¾è®¡æ­£ç¡®çš„BSDF --- æ­£ç¡®å½’ä¸€åŒ–çš„BSDFå‡½æ•°ï¼Œé«˜æ•ˆç‡çš„é‡‡æ ·ä»¥åŠæ­£ç¡®çš„PDFæ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„é‡ç‚¹é—®é¢˜ï¼ˆä¹Ÿæ˜¯å½“å‰æˆ‘å¯¹ç®—æ³•ç†è§£çš„æœ€å¤§éšœç¢ï¼Œä¼°è®¡ä¹Ÿæ˜¯åç»­å·¥ä½œéœ€è¦é‡ç‚¹æŒæ¡çš„åŸºç¡€çŸ¥è¯†ï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼šLambertian PDF ä¸ºä»€ä¹ˆæ˜¯ <span class="math inline">\(\cos\theta /\pi\)</span>ï¼Ÿä»¥åŠå…¶ cosine weighted é‡‡æ ·ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿå¾ˆæƒ­æ„§ï¼Œè„‘å­ä¸å¥½ä½¿ï¼Œç¡®å®ä¸€æ—¶åŠä¼šå„¿ç­”ä¸å‡ºæ¥ã€‚æ•…è¿™éƒ¨åˆ†å°†æˆä¸ºä¸‹ä¸€ç¯‡åšå®¢çš„é‡ç‚¹ã€‚</p>
<hr>
<h2 id="references">References</h2>
<p><span id="ref"></span></p>
<p>[1] <a href="https://graphics.stanford.edu/courses/cs348b-01/course29.hanrahan.pdf">AdaPT-Monte-Carlo-Path-Tracer-I</a></p>
<p>[2] <a href="https://www.cg.tuwien.ac.at/sites/default/files/course/4411/attachments/08_next%20event%20estimation.pdf">Bernhard Kerbl - Rendering: Next Event Estimation</a></p>
<p>[3] Wang, Zhen, et al. "Theoretical extension of universal forward and backward Monte Carlo radiative transfer modeling for passive and active polarization observation simulations." <em>Journal of Quantitative Spectroscopy and Radiative Transfer</em> 235 (2019): 81-94.</p>
<p>[4] <a href="https://computergraphics.stackexchange.com/questions/7578/brdf-normalization">CG stack exchange: BRDF normalization</a></p>
<p>[5] <a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-shading/diffuse-lambertian-shading.html">Scratchpixel: Introduction to shading</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>Taichi lang</tag>
        <tag>CG</tag>
        <tag>renderer</tag>
      </tags>
  </entry>
  <entry>
    <title>AdaPT - Monte Carlo Path Tracer II</title>
    <url>/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/</url>
    <content><![CDATA[<h1 id="ada-path-tracer-ii">Ada Path Tracer II</h1>
<hr>
<p>â€‹ æœ¬æ–‡ä¸º <a href="https://enigmatisms.github.io/2023/02/09/AdaPT-Monte-Carlo-Path-Tracer-I/">Ada Path Tracer I</a> çš„ç»­æ–‡ã€‚åœ¨ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘åªæ˜¯è¯´æ˜äº† Monte Carlo ç§¯åˆ†åœ¨path tracingä¸­çš„åº”ç”¨ä»¥åŠpath tracingçš„ç†è®ºã€å®ç°æµç¨‹ã€‚å¹¶æ²¡æœ‰æ·±å…¥è®¨è®º PDF å¦‚ä½•è®¡ç®—ã€é‡‡æ ·å¦‚ä½•è¿›è¡Œã€PDFçš„é€‰æ‹©å¦‚ä½•å½±å“ç»“æœä»¥åŠå¦‚ä½•ä½¿å¾— path tracer å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ç¬”è€…åœ¨æœ¬æ–‡ä¸­å¯¹ä¸Šæ–‡æœªè®¨è®ºæ¸…æ¥šçš„é—®é¢˜è¿›è¡Œåˆ†æã€‚åˆ†æè¿‡ç¨‹ä¸­æˆ‘æœçœŸä¹Ÿå‘ç°è‡ªå·±ä¹‹å‰çš„æŸäº›ç†è§£æ˜¯ä¸å¯¹çš„ï¼Œå®ç°æ—¶å‡ºäº†é—®é¢˜ï¼Œä¾‹å¦‚åœ¨ï¼šLambertian BSDFçš„å®ç°ã€MIS å¯¹æ— é¢ç§¯å…‰æºçš„å¤„ç†ã€MIS weightè®¡ç®—ç­‰ç­‰æ–¹é¢å‡æœ‰ç‘•ç–µã€‚</p>
<p>â€‹ æœ¬éƒ¨åˆ†å­¦ä¹ çš„ç»“æŸæ ‡å¿—ç€ã€åŸºæœ¬ path tracer å®ç°ã€‘çš„å®Œæˆï¼ˆV1.0ï¼‰ã€‚é™¤äº†å¯¹BSDFè¿›è¡Œå°çš„ä¿®æ”¹ä¹‹å¤–ï¼ˆè¡¨é¢åå°„å®šä¹‰è¿‡äºç®€å•ï¼‰ï¼Œä¸‹ä¸€æ­¥æˆ‘å°†ä¸»è¦å›´ç»•ä¸¤éƒ¨åˆ†è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼š</p>
<ul>
<li>Bidirectional path tracingã€‚åŒå‘ tracer å¯¹å¤„ç† directional / collimated å…‰æºååˆ†æœ‰ç”¨ï¼Œå¹¶ä¸”åœ¨causticå»ºæ¨¡ä¸Šæœ‰ç€æ›´å¥½çš„æ•ˆæœï¼ˆè™½ç„¶ä¸æ˜¯æœ€å¥½çš„ï¼‰</li>
<li>Volumetric path tracingã€‚ä¸»è¦ç ”ç©¶åŒ€è´¨ä»‹è´¨æ•£å°„å¸æ”¶ã€‚</li>
</ul>
<center>
<img src="/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/pbr-balls-multi.png" style="zoom: 80%;">
</center>
<center>
Figure 1. AdaPT 2minå¢é‡å¼æ¸²æŸ“ï¼ˆCPUï¼ŒGPUæ—¶é—´é™¤ä»¥8-10ï¼‰ï¼šç‚¹å…‰æº/é¡¶éƒ¨é¢å…‰æºä¸çƒé¢å…‰æº
</center>
<span id="more"></span>
<hr>
<h2 id="ii.-pdf-confusion">II. PDF Confusion</h2>
<h3 id="è®¨è®ºå¯¹è±¡åˆ†æ">2.1 è®¨è®ºå¯¹è±¡åˆ†æ</h3>
<p>â€‹ æœ‰å¦‚ä¸‹é—®é¢˜éœ€è¦æ˜ç¡®ï¼šPath tracerä¸­ PDF å¯¹ç»“æœçš„å½±å“æ˜¯ä»€ä¹ˆï¼Ÿé€‰å–ä¸æ­£ç¡®çš„PDFæ˜¯å¦ä¼šå¯¼è‡´ç»“æœæˆä¸ºæœ‰åä¼°è®¡ï¼ŸPDFé’ˆå¯¹åˆ†å­ä¸­å“ªä¸€é¡¹èµ·ä½œç”¨ï¼Ÿ</p>
<p>â€‹ å·²çŸ¥MCç§¯åˆ†å…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{mc_est}
\frac 1N \sum_{i=1}^N \frac{f(X_i)}{p(X_i)}
\end{equation}
\]</span> â€‹ æ±‚æœŸæœ›å¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[
\begin{equation}\label{mc}
\frac 1N \sum_{i=1}^N E\left(\frac{f(X_i)}{p(X_i)}\right)
\end{equation}
\]</span> â€‹ è€Œä¸Šå¼å†…éƒ¨çš„æœŸæœ›ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{exp}
E\left(\frac{f(X_i)}{p(X_i)}\right) = \int_\Omega \frac{f(x)}{p(x)}p(x)dx
\end{equation}
\]</span> â€‹ æ³¨æ„ï¼Œæ ¹æ®éšæœºå˜é‡å‡½æ•°çš„æœŸæœ›å…¬å¼ï¼š <span class="math display">\[
E(f(X)) = \int_\Omega f(x)p(x)dx
\]</span> â€‹ å¯çŸ¥å…¬å¼<span class="math inline">\(\eqref{exp}\)</span>æ±‚è§£çš„æœŸæœ›æ˜¯éšæœºå˜é‡<span class="math inline">\(x\)</span>çš„å‡½æ•°<span class="math inline">\(f(x)/p(x)\)</span>çš„æœŸæœ›ã€‚å…¶ä¸­çš„<span class="math inline">\(p(x)\)</span>åº”å½“ä»ç„¶æ˜¯<span class="math inline">\(x\)</span>çš„åˆ†å¸ƒã€‚é‚£ä¹ˆï¼Œåœ¨Monte Carloç§¯åˆ†ä¸­ï¼Œæˆ–è€…åœ¨æŸä¸ª vertex å¤„ï¼Œ<span class="math inline">\(x\)</span> ä»£è¡¨äº†ä»€ä¹ˆæ„ä¹‰ï¼Ÿæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼šåœ¨ direct component estimation ï¼ˆnext eventéƒ¨åˆ†ï¼‰ï¼Œæˆ‘ä»¬é‡‡æ ·Mæ¡shadow raysã€‚åˆ™PDFæ˜¯ï¼š<span class="math inline">\(p(x_l|e_i)p(e_i)\)</span>ï¼Œæ³¨æ„æ­¤å¤„çš„PDFæ˜¯å®šä¹‰åœ¨é¢ç§¯å¾®å…ƒä¸Šçš„ï¼ˆdifferential areaï¼‰ï¼Œè€Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯â€œæŸä¸ªæ–¹å‘çš„PDFâ€ï¼ˆä¹Ÿå³ç«‹ä½“è§’å®šä¹‰ï¼‰ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦è®°ä½ç«‹ä½“è§’çš„ç‰©ç†æ¦‚å¿µï¼š</p>
<blockquote>
<p>The point from which the object is viewed is called the apex of the solid angle, and the object is said to subtend its solid angle at that point.</p>
</blockquote>
<p>â€‹ æ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œæ¨å¯¼ï¼Œè§ä¸‹å›¾ï¼š</p>
<center>
<img src="/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/c403f4fb9d8aa590130033b601d2f54a.jpg" style="zoom: 45%;">
</center>
<center>
Figure 2. å¾®åˆ†ç«‹ä½“è§’å®šä¹‰ä¸‹çš„PDFä¸å¾®åˆ†é¢ç§¯å®šä¹‰ä¸‹çš„PDFï¼ˆéå…‰æºé‡‡æ ·ï¼‰
</center>
<center>
<img src="/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/a83efdf5dd11f6681480ff1779c4c29c.jpg" style="zoom:45%;">
</center>
<center>
Figure 3. å¾®åˆ†ç«‹ä½“è§’å®šä¹‰ä¸‹çš„PDFä¸å¾®åˆ†é¢ç§¯å®šä¹‰ä¸‹çš„PDFï¼ˆå…‰æºé‡‡æ · - å®é™…ä¸Šä¸ä¸Šä¸€æƒ…å†µç±»ä¼¼ï¼‰
</center>
<p>æ³¨æ„æˆ‘ä»¬åœ¨direct component estimation ä¸­ï¼Œæˆ‘ä»¬çš„å®é™…ä¼°è®¡ç›®æ ‡æ˜¯ï¼š <span class="math display">\[
\int_\Omega f_r(x, w_i, w_o)L_d(x, w_i)\cos\theta dw_i\rightarrow \frac{1}{N}\sum_{i=1}^N\frac{f_r(x, w_i, w_0)L_d(x, w_i)\cos\theta}{p}
\]</span> â€‹ ä¹Ÿå³æˆ‘ä»¬å®é™…åº”è¯¥è·çŸ¥å„ä¸ªæ–¹å‘ä¸Šï¼ˆå¾®åˆ†ç«‹ä½“è§’ï¼‰çš„å…¥å°„æƒ…å†µã€‚è€Œç›´æ¥é‡‡æ ·å…‰æºï¼ˆç‰¹åˆ«æ˜¯é¢å…‰æºï¼‰å¾—åˆ°çš„PDFå¹¶ä¸æ˜¯å®šä¹‰åœ¨â€œæ–¹å‘ä¸Šâ€çš„ï¼Œè€Œæ˜¯åœ¨é¢ç§¯ä¸Šçš„ï¼ˆé¢å…‰æºä¸ŠæŸä¸ªå¾®åˆ†é¢ç§¯ä¸å‡»ä¸­ä½ç½®å¼ æˆç«‹ä½“è§’ï¼‰ï¼Œæ•…åº”å½“è¿›è¡Œè½¬åŒ–ã€‚ä¸‹é¢ç»™å‡ºä¸Šå¼ä¸­åˆ†æ¯<span class="math inline">\(p\)</span>çš„å½¢å¼ã€‚ç”±äº<span class="math inline">\(p\)</span>å®é™…ä¸Šç”±é¢ç§¯å®šä¹‰çš„PDFè½¬åŒ–è€Œæ¥ï¼Œå¹¶ä¸”æ³¨æ„æˆ‘ä»¬ä½¿ç”¨çš„å¹¶ä¸æ˜¯æŠ•å½±ç«‹ä½“è§’ --- æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯æŸä¸€æ–¹å‘çš„PDFã€‚<span class="math inline">\(p\)</span> è‡ªç„¶åº”è¯¥æ˜¯ <span class="math inline">\(p(w_i)\)</span> çš„å½¢å¼ï¼Œä¸ªäººè®¤ä¸ºè¿™ä¸éšæœºå˜é‡å‡½æ•°çš„æœŸæœ›è®¡ç®—æœ‰ä¸€å®šå…³ç³»ï¼šéšæœºå˜é‡æ˜¯ä»€ä¹ˆå°±ç”¨ä»€ä¹ˆPDFï¼ˆæ­¤å¤„éšæœºå˜é‡æ˜¯ç«‹ä½“è§’è€Œä¸æ˜¯æŠ•å½±ç«‹ä½“è§’ï¼‰ï¼Œå¹¶ä¸”åœ¨MISä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸BSDF samplingä½¿ç”¨åŒä¸€åŸŸä¸‹çš„PDFï¼ˆBSDF samplingä½¿ç”¨ç«‹ä½“è§’è€ŒéæŠ•å½±ç«‹ä½“è§’ï¼‰ã€‚éæŠ•å½±ç«‹ä½“è§’ä¸‹ï¼Œ<span class="math inline">\(p(w_e)\)</span>åº”è¯¥æ˜¯ï¼š <span class="math display">\[
\begin{equation}\label{convert}
p(x_l|e_i)p(e_i) \frac{\Vert x_l - x\Vert^2}{\cos(w_o, n_e)}
\end{equation}
\]</span> â€‹ æ•…åœ¨ç¬”è€…çš„å®ç°å†…ä»…ä»…ä½¿ç”¨äº†å…‰æºçš„normalï¼Œè€Œæ²¡æœ‰ä½¿ç”¨å‡»ä¸­ç‚¹çš„normalã€‚</p>
<p>â€‹ æ•…ç»¼åˆä»¥ä¸Šçš„ä¾‹å­æ¥çœ‹ï¼Œå…¬å¼<span class="math inline">\(\eqref{mc}\)</span>ä¸­çš„PDFåˆ°åº•æ˜¯è°çš„PDFï¼Ÿå°±ç›®å‰ç¬”è€…çš„ç†è§£è€Œè¨€ï¼Œç¬”è€…è®¤ä¸ºæ˜¯ã€æ–¹å‘ã€‘ã€‚Path tracing ä¸­çš„ç§¯åˆ†é—®é¢˜å‡ ä¹éƒ½å¯ä»¥å½’ç»“ä¸ºåœ¨æ–¹å‘ä¸Šçš„ç§¯åˆ†ï¼ˆè€Œä¸”æœ‰æ—¶å¿…é¡»å½’ç»“ä¸ºåœ¨æ–¹å‘ä¸Šçš„é—®é¢˜ï¼Œå¦‚MISä¸­ç»Ÿä¸€åœ¨ç«‹ä½“è§’æ–¹å‘åŸŸä¸Šè®¨è®ºï¼‰ã€‚æˆ‘ä»¬ä¸å¦¨è¿›ä¸€æ­¥è®¨è®ºBSDFå¸¸ç”¨çš„ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼Œè¿”å›çš„PDFï¼š</p>
<ul>
<li><code>sample</code> æ–¹æ³•ï¼šç”±BSDFé‡‡æ ·è·å¾—åå°„ã€é€å°„æ–¹å‘ä»¥åŠå¯¹åº”çš„PDF</li>
<li><code>pdf</code> æ–¹æ³•ï¼šç›´æ¥è¡¡é‡æŸä¸ªæ–¹å‘çš„PDFï¼Œç”¨ä»¥MIS</li>
</ul>
<p>â€‹ æ—¢ç„¶ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½æ˜¯åœ¨è¡¡é‡æŸä¸ªæ–¹å‘çš„PDFï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¯¸å¦‚ Lambertian è¿™æ ·çš„BSDFï¼Œä»¥ä¸Šä¸¤ä¸ªå‡½æ•°è¿”å›çš„PDFå´ä¸å…¥å°„æ–¹å‘æœ‰å…³ï¼ˆcosine weightedï¼‰ï¼ŸæŒ‰ç†æ¥è¯´ï¼ŒLambertian BSDF å‘åŠçƒå†…çš„ä»»æ„æ–¹å‘åå°„çš„å¯èƒ½éƒ½åº”ç›¸ç­‰ã€‚</p>
<div class="note danger"><p>è‡³äºä¸ºä»€ä¹ˆLambertian PDFä¸æ˜¯ <span class="math inline">\(1/2\pi\)</span> è€Œæ˜¯ <span class="math inline">\(\cos\theta /\pi\)</span>ï¼ŒåŸå› è²Œä¼¼æ˜¯ importance sampling... æˆ‘ä»¬å¤§å¯ä»¥ä½¿ç”¨<span class="math inline">\(1/2\pi\)</span>å¯¹åº”çš„ uniform hemisphere samplingï¼Œä½†æ•ˆç‡ä¸å¦‚ cosine weighted hemisphere sampling é«˜ã€‚</p>
</div>
<p>â€‹ ä¸è¿‡ï¼Œè¿™æ ·çš„PDFæ˜¯å¦ä¼šå¯¼è‡´æœ‰åä¼°è®¡ï¼Ÿè¿™å°±è®¾è®¡åˆ° importance sampling é‡Œçš„ä¸€äº›çŸ¥è¯†äº†ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œè¯·è®°ä½ï¼š</p>
<div class="note primary"><p>Lambertian uniform PDF ä¸º<span class="math inline">\(1/2\pi\)</span>æ˜¯é’ˆå¯¹<span class="math inline">\(w\)</span>ï¼ˆç«‹ä½“è§’ï¼‰è€Œè¨€ï¼Œå¦‚æœå˜æ¢åˆ°çƒåæ ‡ç³»ä¸‹ï¼Œåº”å½“ä¸º<span class="math inline">\(p(\theta, \phi) = \sin\theta /\pi\)</span>ã€‚å…¶ä»–åŒç†ï¼Œæ•…ä¸€å®šè¦ <u><strong>æ˜ç¡®PDFåœ¨å“ªä¸ªç©ºé—´ä¸‹è®¨è®º</strong></u>ã€‚</p>
<blockquote>
<p>It is important to be clear which PDF is being evaluatedâ€”for example, for a direction on the hemisphere, we have already seen these densities expressed differently in terms of solid angle and in terms of <span class="math inline">\((\theta, \phi)\)</span>. For hemispheres (and all other directional sampling), these functions return values with respect to solid angle. For the hemisphere, the solid angle PDF is a constant <span class="math inline">\(p(w) = 1/2\pi\)</span>. <a href="#ref">[1]</a></p>
</blockquote>
<p>æ­¤å¤–ï¼Œåœ¨samplingé˜¶æ®µï¼ŒPDFçš„é€‰æ‹©æ˜¯ä»»æ„çš„ã€‚ä½†ä¸€å®šéœ€è¦ä¿è¯ï¼š<strong><u>PDF</u></strong> çš„è®¡ç®—ç»“æœä¸ <strong><u>é‡‡æ ·æ–¹æ³•</u></strong> æ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¸€ç‚¹å°†åœ¨importance samplingä¸­è¯¦è°ˆã€‚</p>
</div>
<h3 id="importance-sampling">2.2 Importance Sampling</h3>
<blockquote>
<p>As we will see in Section 13.10, it is often useful to sample from a distribution that has a shape similar to that of the integrand being estimated. For example, because the scattering equation weights the product of the BSDF and the incident radiance with a cosine term, it is useful to have a method that generates directions that are more likely to be close to the top of the hemisphere, where the cosine term has a large value, than the bottom, where the cosine term is small. <a href="#ref">[1]</a></p>
</blockquote>
<p>â€‹ Importance sampling å…¶å®æ˜¯è€æœ‹å‹äº†ï¼Œè¿˜è®°å¾—åœ¨ç‰¹é¾™çš„ã€Šæ¦‚ç‡æœºå™¨äººã€‹ä¸­ï¼Œparticle filteré‡Œå°±æœ‰â€œç›®æ ‡åˆ†å¸ƒâ€å’Œâ€œå»ºè®®éƒ¨åˆ†â€ä¹‹è¯´ï¼Œå¹¶ä¸”ä½œè€…ç§°ï¼šå»ºè®®åˆ†å¸ƒè¶Šæ¥è¿‘ç›®æ ‡åˆ†å¸ƒï¼Œé‡‡æ ·æ•ˆæœè¶Šå¥½ï¼Œæ”¶æ•›è¶Šå¿«ã€‚ç”±äºéƒ½æ˜¯ Monte Carlo æ–¹æ³•ï¼ˆPFå®šä½æ˜¯ Monte Carlo å®šä½ï¼ŒPath Tracing æ˜¯ Monte Carlo ç§¯åˆ†ï¼‰ï¼Œæ•…Path Tracingä¸­å¦‚æœå¯ä»¥è·å¾—ç±»ä¼¼å…¬å¼<span class="math inline">\(\eqref{mc_est}\)</span>ä¸­çš„åˆ†å­é¡¹çš„PDFï¼Œåˆ™å¯ä»¥æå‡é‡‡æ ·æ•ˆç‡ã€‚</p>
<p>â€‹ ä¸è¿‡éœ€è¦è®°ä½çš„æ˜¯ï¼šimportance sampling çš„æ€æƒ³å†…æ ¸æ˜¯â€œè´¡çŒ®ï¼ˆcontributionï¼‰å¤§çš„éƒ¨åˆ†å¤šé‡‡æ ·ï¼Œè´¡çŒ®å°çš„éƒ¨åˆ†å°‘é‡‡æ ·â€ã€‚è¿™å®Œå…¨ä¸åŒäºâ€œå€¼ï¼ˆvalueï¼‰å¤§çš„åœ°æ–¹å¤šé‡‡æ ·ï¼Œå€¼å°çš„åœ°æ–¹å°‘é‡‡æ ·â€ï¼Œæˆ‘ä»¬ä¸¾ä¸PBR bookåŒæ ·çš„ä¾‹å­ï¼šscattering equationï¼š <span class="math display">\[
\int_\Omega f_r(x, w_i, w_o)L_d(x, w_i)\cos\theta dw_i
\]</span> â€‹ ä¸Šå¼ä¸­çœŸæ­£äº§ç”Ÿè´¡çŒ®çš„æ˜¯<span class="math inline">\(f_r\times \cos\theta\)</span>ï¼Œåœ¨æ­¤ä¹˜ç§¯é¡¹å¤§çš„ä½ç½®åº”å½“å¤šé‡‡æ ·ï¼Œå°çš„ä½ç½®å°‘é‡‡æ ·ï¼ˆæ¯•ç«Ÿå°çš„ä½ç½®è´¡çŒ®å°ï¼Œæç«¯ä¸€ç‚¹çš„ä¾‹å­å°±æ˜¯é•œé¢åå°„ï¼‰ã€‚é‡‡æ ·æ—¶ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥é€‰æ‹©ä¸<span class="math inline">\(f_r\)</span>ç›¸ä¼¼çš„ PDFï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸<span class="math inline">\(f_r\times \cos\theta\)</span> ç›¸ä¼¼çš„PDFï¼Œè¿™æ˜¯å› ä¸ºï¼Œåœ¨å…¬å¼<span class="math inline">\(\eqref{exp}\)</span>ä¸­ï¼Œåˆ†æ¯äººä¸ºé™¤çš„PDFå°†ä¼šä¸å½“å‰sampleå‡ºç°çš„æ¦‚ç‡æŠµæ¶ˆã€‚ä¹Ÿå³ï¼š</p>
<div class="note primary"><p>ä¸è€ƒè™‘æ•ˆç‡ã€è®¤ä¸ºæ ·æœ¬æ•°é‡æ— ç©·æ—¶ï¼ŒPDFå¯ä»¥æ˜¯ä»»æ„çš„ï¼Œåªè¦é‡‡æ ·çš„æ–¹æ³•ä¸è®¡ç®—çš„PDFä¹‹é—´ä¸€è‡´å³å¯ã€‚ï¼ˆDirac-deltaåˆ†å¸ƒé™¤å¤–ï¼‰</p>
</div>
<p>â€‹ ä¹Ÿå³ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨<span class="math inline">\(1/2\pi\)</span>ä½œä¸ºPDFï¼Œå°±å¿…é¡»è¦ä½¿ç”¨ uniform hemisphere samplingï¼Œå¦åˆ™â€œæŠµæ¶ˆâ€å°†æ— æ³•è¿›è¡Œã€‚åœ¨ Monte Carlo ç§¯åˆ†ä¼°è®¡å¼<span class="math inline">\(\eqref{mc_est}\)</span> ä¸­ï¼Œè¿™ç§æŠµæ¶ˆæ˜¯éšå¼çš„ï¼ˆæ‰€ä»¥æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰æ˜ç™½ï¼‰ï¼ã€æ ·æœ¬<span class="math inline">\(X_i\)</span>ã€‘æŒ‰PDF <span class="math inline">\(p(x)\)</span>å®šä¹‰çš„æ¦‚ç‡ <span class="math inline">\(P(X)\)</span> ç”Ÿæˆäº†å‡ºæ¥ï¼Œæ ·æœ¬ <span class="math inline">\(x_i\)</span> æˆ–è€…ä¸æ­¤ç±»ä¼¼çš„æ ·æœ¬å‡ºç°çš„é¢‘ç‡ï¼ˆå¯èƒ½æ€§ï¼‰å…¶å®å·²ç»åŒ…å«äº†PDF ä¿¡æ¯<span class="math inline">\(p(x)\)</span>ï¼Œè¯•æƒ³ä¸€ä¸ª3é¢æ˜¯4ï¼Œä½™ä¸‹ä¸‰é¢ä¸º1ã€2ã€3çš„éª°å­ï¼Œæˆ‘ä»¬å¯¹å…¶é‡‡æ ·ï¼ˆæŠ•æ·ï¼‰ï¼Œå¾—åˆ°çš„ç»“æœ<span class="math inline">\(f(X_i)\)</span> ç¡®å®çœ‹ä¼¼ä¸åŒ…å«éª°å­çš„ä¿¡æ¯ï¼Œä½†1ã€2ã€3ã€4åœ¨å¤šæ¬¡é‡‡æ ·ä¸­å‡ºç°çš„æ¬¡æ•°å´åŒ…å«PDFä¿¡æ¯ã€‚</p>
<p>â€‹ æ•…ï¼Œæœ‰åä¼°è®¡ï¼Ÿæœ‰åä¼°è®¡åªä¼šå‡ºç°åœ¨é‡‡æ ·æ–¹å¼ä¸PDFä¸ç¬¦çš„æƒ…å†µä¸­ï¼Œè‡³å°‘å¯¹äº<code>sample</code>æ–¹æ³•æ¥è¯´æ˜¯è¿™æ ·çš„ã€‚<code>sample</code>æ–¹æ³•è·å¾—çš„PDFå¹¶ä¸ä¸€å®šä¸BSDFçš„å½¢çŠ¶ç›¸å…³ï¼Œè¿˜å¯èƒ½ä¸å…¶ä»–é™„åŠ é¡¹æœ‰å…³ï¼ˆcosine termï¼‰ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼š<code>pdf</code>æ–¹æ³•è¿”å›çš„PDFæ˜¯å¦å¯ä»¥ä¸å…¶ä»–é¡¹æœ‰å…³ï¼Ÿå› ä¸ºæˆ‘ä¸ªäººçš„æƒ³æ³•æ˜¯è¿™æ ·çš„ï¼š<code>pdf</code>é¡¹åªä¼šä½¿ç”¨åœ¨MISä¸­ï¼ŒMISéœ€è¦è”ç³»ä¸¤ç§ä¸åŒçš„åŸŸï¼Œå¦‚BSDF sampling (solid angle)å’Œlight sampling (differential area)ï¼Œè€Œ light sampling PDF åœ¨ç»è¿‡å…¬å¼<span class="math inline">\(\eqref{convert}\)</span>ç­‰å·å³è¾¹çš„åˆ†æ•°é¡¹å˜æ¢åå°†å¾—åˆ°ç«‹ä½“è§’å®šä¹‰ä¸‹çš„ PDFï¼Œæ­¤ PDF æ˜¯å¦åªåº”å½“ä¸ BSDF é¡¹ç›¸å…³ï¼Ÿæ¯•ç«ŸæŒ‰ç…§ç›´è§‰ç†è§£ï¼ŒMISå°±æ˜¯ä¸ºäº†é’ˆå¯¹ã€å…‰æºã€‘ä»¥åŠã€BSDFã€‘éƒ½å°è¯•è®¡ç®—æŸä¸ªæ–¹å‘å…¥å°„æ˜¯å¦å¯èƒ½ï¼ŒåŠ ä¸Š cosine term å°±ä¸å•å•æ˜¯åœ¨è¡¡é‡BSDFè€Œæ˜¯åœ¨è¡¡é‡ interactions çš„æ•´ä½“è´¡çŒ®äº†ã€‚æ­¤é—®é¢˜çš„ç­”æ¡ˆæˆ‘ä»¬å°†åœ¨MISä¸­è¿›è¡Œåˆ†æã€‚</p>
<h3 id="mis">2.3 MIS</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ">2.3.1 åŸºæœ¬æ¦‚å¿µ</h4>
<p>â€‹ Multiple importance sampling æ˜¯ä¸€ç§â€œä¿¡æ¯èåˆâ€æ–¹æ³•ã€‚å®ƒåœ¨ path tracing ä¸­çš„ä¸€ä¸ªæœ€ç®€å•ç”¨æ³•å°±æ˜¯èåˆã€BSDF samplingã€‘ä»¥åŠã€Emitter samplingã€‘ï¼Œèåˆçš„è¦æ±‚æ˜¯ï¼š</p>
<blockquote>
<p>Expressing all densities with respect to the same measure. <a href="#ref">[2]</a></p>
</blockquote>
<p>â€‹ ä¸‹é¢ç»™å‡º path tracing ä¸­çš„ä¸¤ç§æœ€å¸¸ç”¨çš„ ray direction é‡‡æ ·æ–¹æ³•ï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">BSDF Sampling</a></li><li class="tab"><a href="#span-unique-name-2">Emitter Sampling</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ BSDFé‡‡æ ·çš„æ„æ€å°±æ˜¯ï¼šæ ¹æ®BSDFè¿›è¡Œé‡‡æ ·ï¼Œé‡‡æ ·æ›´å€¾å‘äºåœ¨BSDFå€¼å¤§çš„ä½ç½®è¿›è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„éå¸¸æ˜¾ç„¶ï¼šå‡è®¾BSDFæœ¬èº«æ˜¯ä¸€ä¸ªçª„å¸¦åˆ†å¸ƒï¼Œåœ¨è¡¡é‡ç›´æ¥å…‰ç…§æ—¶å¦‚æœåªæ˜¯åœ¨å…‰æºä¸Šå–ç‚¹ï¼Œè¿™äº›ç‚¹å¾ˆæœ‰å¯èƒ½è½åœ¨BSDFå³°å€¼åŒºåŸŸå¤–ã€‚è¿™å°†ä¼šå¯¼è‡´æˆ‘ä»¬åœ¨ä½è´¡çŒ®åŒºåŸŸæµªè´¹å¤§é‡ samplesã€‚åˆ™å¯çŸ¥ï¼Œåœ¨BSDFåˆ†å¸ƒè¾ƒçª„ã€å…‰æºè¾ƒå¤§æ—¶ï¼ŒBSDFé‡‡æ ·ç»“æœè¾ƒå¥½ã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ Emitteré‡‡æ ·æ˜¯ç°é˜¶æ®µ AdaPTä¼°è®¡ç›´æ¥å…‰ç…§æ—¶çš„é‡‡æ ·æ–¹æ³•ã€‚ç”±äºå¯¹äºæ¼«åå°„è¡¨é¢è€Œè¨€ï¼Œå…¥å°„å…‰çº¿ç»è¿‡åå°„åå°†åˆ†å¸ƒåœ¨æ•´ä¸ªåŠçƒä¸Šï¼Œå½“å…‰æºè¾ƒå°æ—¶ï¼ˆç‰¹åˆ«æ˜¯ç‚¹å…‰æºæ—¶ï¼‰ï¼Œé€šè¿‡BSDFé‡‡æ ·å¯èƒ½å¾ˆéš¾å‡»ä¸­å…‰æºã€‚é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å…‰æºä¸Šé€‰ç‚¹ï¼Œä½¿ç”¨æ‰€é€‰ç‚¹ä»¥åŠå½“å‰å‡»ä¸­ç‚¹æ„å»ºshadow raysã€‚è¿™ç§æ–¹æ³•åœ¨BSDFåˆ†å¸ƒè¾ƒå®½ã€å…‰æºè¾ƒå°æ—¶çš„é‡‡æ ·ç»“æœè¾ƒå¥½ã€‚</p></div></div></div>
<p><span id="fig3"></span></p>
<center>
<img src="/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/mis1.png" style="zoom:80%;">
</center>
<center>
Figure 4. MISç»“åˆä¸¤ç§é‡‡æ ·æ–¹æ³•æœ‰åŠ©äºæå‡æ¸²æŸ“è´¨é‡
</center>
<p>â€‹ å¤æ‚åœºæ™¯è‡ªç„¶å¯èƒ½å­˜åœ¨å¤§/å°å…‰æºä»¥åŠå…‰æ»‘/ç²—ç³™/é€å°„/æ•£å°„çš„BSDFï¼Œåˆ™æˆ‘ä»¬æœ€å¥½æ˜¯æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œç»“åˆä¸¤ç§é‡‡æ ·æ–¹æ³•å¾—åˆ°ç»“æœã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>ç®€å•æ–¹æ¡ˆï¼šå¯¹äºé‡‡æ ·è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªä½¿ç”¨ emitter samplingã€‚ä½†åœ¨ç»“æœè®¡ç®—é˜¶æ®µï¼ŒåŸå§‹ Monte Carlo ç§¯åˆ†å°†ç”¨<span class="math inline">\(p(x)\)</span>é™¤<span class="math inline">\(f(x)\)</span>ï¼Œè€Œæ­¤æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å¯¹ç»“æœè¿›è¡ŒåŠ æƒï¼Œä¸è®¡ç®—<span class="math inline">\(f(x)/p(x)\)</span>ï¼Œè€Œæ˜¯è®¡ç®—<span class="math inline">\(w(x)f(x)\)</span>ã€‚<span class="math inline">\(w(x)\)</span>ç§°ä¸º MIS æƒé‡ã€‚</li>
<li>å¤æ‚æ–¹æ¡ˆï¼šé‡‡æ ·è¿‡ç¨‹åŒæ—¶å®ç° BSDF sampling ä»¥åŠ emitter samplingï¼Œå¯¹äºä¸¤ç§æ–¹æ³•é‡‡æ ·çš„ç»“æœï¼Œåˆ†åˆ«è®¡ç®—æƒé‡ï¼Œæœ€åçš„ç»“æœä¸ºï¼š<span class="math inline">\(w_1(x)f_{\text{BSDF}}(x)+w_2(x)f_{\text{emitter}}(x)\)</span>ã€‚ä»…ä»ç†è®ºä¸Šçœ‹ï¼Œè¿™æ ·çš„æ–¹æ³•åº”è¯¥å¯ä»¥æœ‰æ›´å¥½çš„æ”¶æ•›æ€§ï¼Œå› ä¸ºä¸Šä¸€æ–¹æ¡ˆä»…ä»…åœ¨BSDF/emitter PDFç»“æœå†²çªæ—¶è¿›è¡Œé‡åŠ æƒï¼Œå¹¶ä¸å¸®åŠ©è·å¾—æ›´å¥½çš„æ ·æœ¬ã€‚ä¾‹å¦‚æˆ‘ä»¬ä¸ç®¡æ€ä¹ˆåœ¨å…‰æ»‘è¡¨é¢ä¸Šé‡‡æ ·ï¼Œè½åœ¨specular lobeä¸­çš„æ ·æœ¬æ€»æ˜¯ä¸å¤Ÿå¤šçš„ï¼Œè™½ç„¶æœ€åçš„æƒé‡ä½ï¼Œä¸ä¼šæœ‰å¤ªå¤§é”™è¯¯ï¼Œä½†æ— åŠ©äºåŠ é€Ÿæ”¶æ•›ã€‚æœ¬æ–¹æ¡ˆç¡®å®ä¹Ÿç›¸å¯¹å¤æ‚ï¼Œä¸€æ¡shadow rayséœ€è¦ä¸¤æ¬¡ ray intersection æ“ä½œã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡éšæœºç­–ç•¥é€‰æ‹©çš„æ–¹å¼ï¼Œéšæœºä½¿ç”¨å…¶ä¸­ä¸€ç§ç­–ç•¥ä»¥é™ä½è®¡ç®—é‡ã€‚</li>
</ul>
<p>â€‹ å¦‚æœæ¯æ¬¡ä»å¤šç§é‡‡æ ·æ–¹æ³•çš„æ¯ç§æ–¹æ³•ä¸­é‡‡æ ·è‡³å°‘1ä¸ªæ ·æœ¬ï¼Œåˆ™å¯¹åº”æ–¹æ³•è¢«æˆä¸ºâ€œmulti-sample estimatorâ€<a href="#ref">[2]</a>ï¼Œå½¢å¼å¦‚ä¸‹ã€‚å…¶ä¸­ï¼Œ<span class="math inline">\(n_i\geq 1\)</span> ä¸ºç¬¬iç§é‡‡æ ·æ–¹æ³•çš„æ ·æœ¬æ•°ï¼Œ<span class="math inline">\(w_i(Â·)\)</span>ä¸ºå¯¹åº”æ–¹æ³•çš„æƒé‡å‡½æ•°ã€‚ <span class="math display">\[
\begin{equation}\label{multi}
F = \sum_{i=1}^n\frac {1}{n_i}\sum_{j=1}^{n_i}w_i(X_{i,j})\frac{f(X_{i,j})}{p_i(X_{i,j})}
\end{equation}
\]</span> â€‹ ä»¥ä¸Šæ–¹æ³•åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹ä¸€å®šå¯ä»¥æ ¹æ®æ¯ä¸€ç§æ— åé‡‡æ ·ä¼°è®¡æ–¹æ³•æ„å»ºæ–°çš„æ— åä¼°è®¡æ–¹æ³•ï¼ŒåŸºæœ¬æ¡ä»¶ä¸ºï¼š(1) <span class="math inline">\(\sum_i w_i(x) = 1, \text{ if } f(x)\neq 0\)</span>ï¼Œ (2) <span class="math inline">\(w_i(x) = 0, \text{ if } p_i(x) = 0\)</span>ã€‚å…·ä½“çš„è¯æ˜ä»¥åŠæ¨å¯¼è§ <a href="#ref">[2]</a></p>
<p>â€‹ å¦‚æœæ¯æ¬¡éšæœºé€‰æ‹©æŸç§é‡‡æ ·æ–¹æ³•ï¼Œé‡‡æ ·ä¸€ä¸ªæ ·æœ¬ï¼Œåˆ™å¯¹åº”æ–¹æ³•è¢«ç§°ä¸ºâ€œone-sample estimatorâ€<a href="#ref">[2]</a>ã€‚AdaPTä¸mitsuba(2/3)é‡‡ç”¨çš„åˆ™æ˜¯è¿™ç§æ–¹æ³•ï¼Œä½†åŒºåˆ«æ˜¯ mitsuba ä½¿ç”¨çš„æ˜¯ power heuristic è€Œ AdaPT é‡‡ç”¨çš„æ˜¯ balance heuristicï¼ˆä¹‹åä¼šè¯´ï¼‰ã€‚å…·ä½“å½¢å¼å¦‚ä¸‹ï¼š <span class="math display">\[
\begin{equation}\label{mono}
F = \frac{w_I(X_I) f(X_I)}{c_I p_I(X_I)}
\end{equation}
\]</span> â€‹ <span class="math inline">\(I\)</span> ä¸ºéšæœºå˜é‡ï¼Œè¡¨ç¤ºéšæœºé€‰æ‹©å¤šç§é‡‡æ ·ç­–ç•¥ä¸­çš„ä¸€ç§ï¼Œ<span class="math inline">\(c_I\)</span> ä¸ºé€‰æ‹©ç­–ç•¥<span class="math inline">\(I = i\)</span> çš„æ¦‚ç‡ã€‚ã€‚AdaPTä¸mitsuba(2/3)é‡‡ç”¨çš„æ–¹æ³•ä¸º one-sample çš„æç«¯æƒ…å†µï¼šåªç”¨ä¸€ç§æ–¹æ³•è¿›è¡Œsamplingï¼Œä½†å¯¹samplingç»“æœè¿›è¡ŒMIS åŠ æƒã€‚ç›¸å½“äºemitterã€BSDF samplingåŒæ—¶å­˜åœ¨ï¼Œè®°ä¸ºç­–ç•¥Iä¸IIï¼Œè€Œé€‰æ‹©ç­–ç•¥Içš„æ¦‚ç‡ä¸º1ï¼Œé€‰æ‹©ç­–ç•¥2çš„æ¦‚ç‡ä¸º0ã€‚</p>
<h4 id="heuristics">2.3.2 Heuristics</h4>
<p>â€‹ æƒé‡å‡½æ•°çš„é€‰æ‹©å¯¹äºç»“æœçš„æ–¹å·®æœ‰å¾ˆå¤§çš„å½±å“ã€‚æœ€æç«¯çš„ä¸¤ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>æŸä¸€ç­–ç•¥çš„æƒé‡ä¸º1ï¼Œå…¶ä»–ç­–ç•¥ä¸º0ã€‚ç›¸å½“äºå›ºå®šæŸä¸€ç§ç­–ç•¥è¿›è¡Œé‡‡æ ·ï¼Œè¿™å½“ç„¶ä¼šå¼•èµ·ä¸€äº›é—®é¢˜ï¼Œè§<a href="#fig3">å›¾4</a></li>
<li>ç­–ç•¥æƒé‡ä¸€è‡´ï¼Œå‡è®¾æœ‰Nç§ç­–ç•¥ï¼Œåˆ™æ¯ä¸ªç­–ç•¥çš„æƒé‡ä¸ºå¸¸æ•° <span class="math inline">\(1/N\)</span>ã€‚è¿™ç§... å¹¶ä¸å¥½ï¼Œç”±äºæ–¹å·®å…·æœ‰å¯åŠ æ€§<a href="#ref">[2]</a></li>
</ul>
<p>â€‹ ä¸‹é¢ï¼Œç¬”è€…ä¸åŠ è¯æ˜åœ°ç»™å‡ºä¸€ä¸ªè¾ƒå¥½çš„æƒé‡å¯å‘å‡½æ•°ï¼Œå…¶è¢«ç§°ä¸ºâ€œbalance heuristicâ€: <span class="math display">\[
\begin{equation}
w_i(x)=\frac{n_ip_i(x)}{\sum_k n_kp_k(x)}
\end{equation}
\]</span> â€‹ ä¹Ÿå³ï¼šå‡è®¾æŸä¸ªæ ·æœ¬<span class="math inline">\(x\)</span>åŸæœ¬æ¥è‡ªç­–ç•¥<span class="math inline">\(i\)</span>ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦è®¡ç®—æ ·æœ¬åœ¨æ­¤ç­–ç•¥ä¸‹è¢«é‡‡æ ·å‡ºçš„PDFï¼Œä¹Ÿéœ€è¦è®¡ç®—åœ¨å…¶ä»–ç­–ç•¥ä¸‹è¢«é‡‡æ ·çš„PDFï¼ˆæ‰€ä»¥<code>pdf</code>æ–¹æ³•å°±æœ‰ç”¨äº†ï¼‰ï¼Œæœ€åçš„æƒé‡æ˜¯æœ¬ç­–ç•¥PDFåœ¨æ‰€æœ‰ç­–ç•¥PDFä¹‹å’Œä¸­çš„æ¯”é‡ã€‚è¿™æ ·çš„å‡½æ•°åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸæ¯”è¾ƒå¸¸è§ï¼ˆå¯èƒ½ä¼šåŒ…è£…ä¸€ä¸‹ï¼Œæ¯”å¦‚softmaxï¼‰ï¼Œæ‰€ä»¥å¾ˆç›´è§‚ï¼Œå…¶èƒŒåçš„intuitionï¼ˆè¯è¯´ï¼Œè¿™ä¸ªè¯ç¿»è¯‘è¿‡æ¥å°±æ˜¯æ²¡é‚£ä¸ªå‘³é“ï¼‰ä¹Ÿå¾ˆåˆç†ï¼šå¦‚æœæŸä¸ªç­–ç•¥æ‹¥æœ‰è¾ƒå¤§çš„PDFï¼Œè€Œå…¶ä»–ç­–ç•¥ç›¸å¯¹è¾ƒå°ï¼Œåˆ™ä¼˜å…ˆé€‰ç”¨å¯¹åº”ç­–ç•¥ã€‚</p>
<p>â€‹ æ³¨æ„ï¼Œåœ¨one-sample çš„æç«¯æƒ…å†µä¸­ï¼Œæœ‰äº›ç­–ç•¥å­˜åœ¨ä½†ä»æ¥ä¸è¿›è¡Œé‡‡æ ·ï¼Œä½†è¿™æ ·çš„PDFä¹Ÿæ˜¯éœ€è¦è®¡å…¥çš„ã€‚ä¾‹å¦‚AdaPTä¸mitsubaä¸­ï¼Œåœ¨è®¡ç®—ç›´æ¥å…‰ç…§æ—¶éƒ½ä½¿ç”¨ emitter samplingï¼Œä½†é‡‡æ ·ç»“æœéƒ½ä¼šç”¨BSDF <code>pdf</code> è®¡ç®—BSDF PDFã€‚æœ€åçš„æƒé‡åˆ™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{weights}
w_{\text{AdaPT}} = \frac{P_{\text{emitter}}}{P_{\text{emitter}} + P_{\text{BSDF}}},w_{\text{mitsuba}} = \frac{P^2_{\text{emitter}}}{P^2_{\text{emitter}} + P^2_{\text{BSDF}}}
\end{equation}
\]</span> â€‹ <a href="#ref">[2]</a> åˆ†æäº† balance heuristic ä¸å…¶ä»–heuristicå‡½æ•°çš„æ–¹å·®å…³ç³»ï¼Œæœ¬æ–‡åœ¨æ­¤å¤„å¼•ç”¨å…¶å…¬å¼ï¼š <span class="math display">\[
\begin{equation}
V[F_{\text{balance}}] - V[F] \leq \left(\frac{1}{\min_i n_i} - \frac{1}{\sum_i n_i} \right)\mu^2
\end{equation}
\]</span> â€‹ å…¶ä¸­<span class="math inline">\(\mu = E[F]\)</span>ï¼Œä¹Ÿå³éœ€è¦ä¼°è®¡çš„ç§¯åˆ†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œbalance heuristic å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„heuristicå‡½æ•°äº†ï¼Œå…¶ä»–heuristicå‡½æ•°ç›¸å¯¹ balance heuristic è€Œè¨€å…·æœ‰æ–¹å·®ä¸‹ç•Œï¼ˆæ–¹å·®è‡ªç„¶æ˜¯è¶Šå°è¶Šå¥½ï¼Œä½†å°±ç®—æ˜¯ä¸‹ç•Œä¹Ÿå·®ä¸äº†å¤šå°‘ï¼‰ã€‚</p>
<p>â€‹ å…¶ä»–çš„ heuristic å‡½æ•°å°±æ·±å…¥äº†ï¼Œæˆ‘åªç®€å•è®²è®²å…¶ä¸­çš„power heuristicã€‚power heuristicå‡½æ•°æ­£å¦‚å…¬å¼<span class="math inline">\(\eqref{weights}\)</span>ä¸­ mitsuba éƒ¨åˆ†ï¼Œå®ƒåœ¨åŸæœ‰çš„PDFä¸Šè¿›è¡Œäº†å¹‚æ“ä½œã€‚èƒŒåçš„intuitionæ˜¯ï¼šå¸Œæœ›PDFå˜å°çš„é€Ÿåº¦æ›´å¿«ï¼Œä»¥ä½¿å¾—æŸä¸€å°PDFç­–ç•¥å¯¹æƒé‡äº§ç”Ÿçš„å½±å“å˜å¾—æ›´å°ã€‚å…·ä½“çš„æ¡ˆä¾‹åˆ†æè§<a href="#ref">[2]</a>çš„ã€9.2.3.1 Low-variance problems: examples and analysisã€‘ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œè‹±è¯­ç¡®å®å¾ˆé‡è¦ï¼Œå›¾å½¢å­¦æœ‰å¾ˆå¤šå¾ˆæ£’çš„èµ„æ–™éƒ½æ²¡æœ‰ä¸­æ–‡ç¿»è¯‘ã€‚é‚£äº›æ•™è‚²å±€çš„é¢†å¯¼æ‹æ‹è„‘è¢‹å°±è§‰å¾—é«˜è€ƒå–æ¶ˆè‹±è¯­æœ‰åŠ©äºæé«˜å­¦ç”Ÿå¯¹äºä¼ ç»Ÿæ–‡åŒ–çš„è®¤åŒä¸æ°‘æ—è‡ªä¿¡å¿ƒï¼Œè¿™ç§æƒ³æ³•çº¯å±å¤šä½™ï¼Œå¯¹ç†å·¥ç±»å­¦ç”Ÿæ¥è¯´å°¤å…¶å¦‚æ­¤ã€‚å¦‚æœè‡ªä¿¡ä¸æ˜¯æ¯”å‡ºæ¥çš„ï¼Œè€Œæ˜¯é—­é—¨é€ è½¦å…»å‡ºæ¥çš„ï¼Œé‚£è¿™ç§è‡ªä¿¡æ— ç–‘éå¸¸è„†å¼±ã€‚</p>
<p>â€‹ ä¸è¿‡<a href="#ref">[2]</a>ä¸­ä¹Ÿåˆ†æäº†ï¼Œåœ¨ one-sample çš„æƒ…å†µä¸‹ï¼Œbalance heuristic çš„è¡¨ç°å°†æ¯” power heuristic å¥½ï¼ˆæ‰€ä»¥ä¸ºä»€ä¹ˆmitsubaä¸ç”¨å‘¢ï¼‰ã€‚</p>
<h4 id="ä¸Šæ–‡é—®é¢˜çš„ç­”æ¡ˆ">2.3.3 ä¸Šæ–‡é—®é¢˜çš„ç­”æ¡ˆ</h4>
<blockquote>
<p><code>sample</code>æ–¹æ³•è·å¾—çš„PDFå¹¶ä¸ä¸€å®šä¸BSDFçš„å½¢çŠ¶ç›¸å…³ï¼Œè¿˜å¯èƒ½ä¸å…¶ä»–é™„åŠ é¡¹æœ‰å…³ï¼ˆcosine termï¼‰ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼š<code>pdf</code>æ–¹æ³•è¿”å›çš„PDFæ˜¯å¦å¯ä»¥ä¸å…¶ä»–é¡¹æœ‰å…³ï¼Ÿ</p>
</blockquote>
<p>â€‹ ç­”æ¡ˆæ˜¯ï¼Œä¸»ä¸åœ¨ä¹ã€‚å¯¹MISè€Œè¨€ï¼ŒPDFåªéœ€è¦æ˜¯å¯¹åŒä¸€å®šä¹‰åŸŸä¸‹çš„æŸä¸ªéšæœºå˜é‡è€Œè¨€å³å¯ã€‚MISæƒé‡åªæ˜¯ä¸€ä¸ªç³»æ•°ï¼Œåªè¦æ»¡è¶³æ¡ä»¶å°±ä¸ä¼šå½±å“æ— åä¼°è®¡æ€§ã€‚åŠ cosineé¡¹ä¸€èˆ¬æ„å‘³ç€ BSDF PDFçš„å³°å€¼æ•´ä½“å˜çª„äº†ï¼ˆ<span class="math inline">\(f_r \times \cos\theta\)</span> åªä¼šæ¯” <span class="math inline">\(\cos\theta\)</span> çª„ï¼‰ï¼Œä»ç›´è§‰ä¸Šç†è§£ä¹Ÿå³åœ¨æ­¤æƒ…å†µä¸‹ï¼Œglossy reflectionè¾¹ç¼˜ï¼ˆä¸å…¥å°„ä¸æ³•å‘è§’åº¦è¾ƒå¤§æ—¶ï¼‰æ›´å€¾å‘äºä½¿ç”¨ emitter samplingã€‚è¿™ä¹Ÿæ˜¯åˆç†çš„ï¼Œæ¯•ç«Ÿ glossy reflection çš„å æ¯”ä¸ diffusive reflection å æ¯”åœ¨è¾¹ç¼˜å¤„å¾ˆæ¥è¿‘ã€‚</p>
<hr>
<h2 id="reference">Reference</h2>
<p><span id="ref"></span></p>
<p>[1] <a href="https://pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations">PBR-Book: 13.6 2D Sampling with Multidimensional Transformations</a></p>
<p>[2] <a href="https://graphics.stanford.edu/courses/cs348b-03/papers/veach-chapter9.pdf">Stanford graphics: Chapter 9 Multiple Importance Sampling</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>Taichi lang</tag>
        <tag>CG</tag>
        <tag>renderer</tag>
      </tags>
  </entry>
  <entry>
    <title>AdaPT - Volumetric Path Tracer I</title>
    <url>/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/</url>
    <content><![CDATA[<h1 id="ada-path-tracer-iii">Ada Path Tracer III</h1>
<hr>
<p>â€‹ AdaPT è¿›å…¥äº† volumetric path tracing é˜¶æ®µã€‚ç”±äºæœ¬äººçš„ç ”ç©¶æ–¹å‘ï¼ˆæš‚å®šï¼‰ä¸ºæ•£å°„ä»‹è´¨æ¸²æŸ“çš„ç ”ç©¶ï¼Œäº†è§£åŸºäº particles çš„ï¼ˆLagrangianè¡¨å¾çš„ï¼‰æ•£å°„æ¸²æŸ“æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼ˆçƒŸé›¾æ¸²æŸ“å¤šæœ‰æ„æ€ï¼Œè™½ç„¶ç°åœ¨åªèƒ½æ¸²æŸ“ homogeneous ä»‹è´¨ï¼‰ã€‚vptç›¸å¯¹äºæ— ä»‹è´¨ptçš„ä¸»è¦éš¾ç‚¹åœ¨äºï¼š</p>
<ul>
<li>volumetric path tracing åœ¨é‡‡æ ·å±‚é¢ä¸Šå¤šäº†ä¸€ä¸ªç»´åº¦ --- å…‰çº¿ä¼ æ’­è·ç¦»å°†ä¸å†æ˜¯æ— ç©·è¿œï¼Œéœ€è¦é‡‡æ ·å…¶è‡ªç”±ç¨‹</li>
<li>free space radiance ä¸€è‡´æ€§ä¸å†æˆç«‹ï¼Œå¹¶ä¸”æ¨¡å‹ä¸è¡¨é¢æ•£å°„æ¨¡å‹æœ‰è¾ƒå¤§çš„åŒºåˆ«ã€‚æœ‰è®¸å¤šé¢å¤–è®¡ç®—éœ€è¦å®Œæˆ</li>
<li>direct component æ›´éš¾è¡¡é‡ï¼Œè¿™æ„å‘³ç€æ”¶æ•›æ›´åŠ å›°éš¾ã€‚MIS ä¹Ÿä¸é‚£ä¹ˆ intuitive äº†</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">æ¸²æŸ“4000è¿­ä»£ï¼ˆ25sï¼Œçº¦10äº¿å…‰çº¿ï¼‰</th>
<th style="text-align: center;">æ¸²æŸ“20000è¿­ä»£ï¼ˆçº¦50äº¿æ¡å…‰çº¿ï¼‰</th>
<th style="text-align: center;">æ¸²æŸ“15000è¿­ä»£</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/pbr-balls-good.jpg"></td>
<td style="text-align: center;"><img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/pbr-balls-20000.png"></td>
<td style="text-align: center;"><img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/pbr-box-cloud.png"></td>
</tr>
</tbody>
</table>
<center>
Figure 1. æ— ä»‹è´¨çš„æ”¶æ•›æ€§æ˜æ˜¾å¥½å¾ˆå¤š
</center>
<p>â€‹ è¯è¯´ï¼Œæˆ‘å†™åšå®¢ä»æ¥æ²¡æœ‰åœ¨ä¸€ä¸ªç³»åˆ—ä¸Šå†™è¶…è¿‡ä¸¤ç¯‡çš„æ–‡ç« ï¼Œæ¸²æŸ“æŠ€æœ¯ç³»åˆ—å·²ç»ä¸‰ç¯‡äº†ï¼Œè¿™è¿˜æ˜¯å¤´ä¸€å›ã€‚</p>
<span id="more"></span>
<hr>
<h2 id="åŸºæœ¬æ¦‚å¿µ">2.1 åŸºæœ¬æ¦‚å¿µ</h2>
<h3 id="abosorption">2.1.1 Abosorption</h3>
<p>â€‹ å¸æ”¶ä¸<span class="math inline">\(\sigma_a\)</span>: å¸æ”¶ç³»æ•°ï¼ˆabsorption cross sectionï¼‰ï¼Œæ˜¯ä¸€ä¸ªPDFï¼š<code>probability density that light is absorbed per unit distance traveled in the medium</code></p>
<ul>
<li>The units of are reciprocal distance (<span class="math inline">\(m^{-1}\)</span>). This means that can take on any positive value; it is not required to be between 0 and 1, for instance.</li>
</ul>
<p>â€‹ å¸æ”¶ç³»æ•°çš„å•ä½ä¹‹æ‰€ä»¥æ˜¯<span class="math inline">\(m^{-1}\)</span>ï¼Œæ˜¯å› ä¸ºå¦‚ä¸‹å…³ç³»ï¼š <span class="math display">\[
\begin{equation}\label{absorb}
L_o(x, w) -L_i(x, w)=-\sigma_a(x, w)L_i(x, w)dt 
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(dt\)</span>æ˜¯å¾®åˆ†è·ç¦»ï¼ˆå…‰çº¿é€šè¿‡ä¸€å°æ®µæ•£å°„ä»‹è´¨ï¼‰ï¼Œ<span class="math inline">\(L_i(x, w)\)</span>ä¸ºä½ç½®xï¼Œå…¥å°„æ–¹å‘ä¸º<span class="math inline">\(w\)</span>çš„å…¥å°„å…‰radianceã€‚åœ¨å„å‘åŒæ€§ä»‹è´¨å‡è®¾ä¸‹ï¼Œå¯ä»¥é€šè¿‡æ±‚è§£å¾®åˆ†æ–¹ç¨‹çš„æ–¹å¼ç®—å‡ºï¼š <span class="math display">\[
\begin{equation}\label{remain}
L_o(x+w\cdot t, w) = L_i(x, w)e^{-\int^{t}_0 \sigma_a(x + w\cdot \tau)d\tau}
\end{equation}
\]</span> â€‹ ä»¥ä¸Šå…¬å¼å°±æ˜¯è‘—åçš„ Beer-Lambert å®šç†ã€‚</p>
<h3 id="emission">2.1.2 Emission</h3>
<p>â€‹ emissionï¼šemission... æˆ‘æœ¬äººæŒºå°‘æ¥è§¦è¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥è®¤ä¸ºæ˜¯mediumæœ¬èº«çš„ä¸€ç§â€œè§å…‰ååº”â€ï¼Ÿè¿™ç§ç°è±¡å¯¹ output radiance çš„å½±å“å…¬å¼ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{emission}
dL_o(x, w) = L_e(x, w)dt
\end{equation}
\]</span> â€‹ å…³äºè¿™ä¸ªå…¬å¼ï¼Œæˆ‘åœ¨PBR bookä¸­è¯»åˆ°è¿™æ ·ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>This equation incorporates the assumption that the emitted light <span class="math inline">\(L_e\)</span> is not dependent on the incoming light <span class="math inline">\(L_i\)</span>. This is always true under the <strong><u>linear optics assumptions</u></strong> that <code>pbrt</code> is based on.</p>
</blockquote>
<p>â€‹ æˆ‘å¯¹ä»¥ä¸Šå…¬å¼å€’æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„Ÿå…´è¶£ï¼Œåªæ˜¯è§‰å¾—è¿™é‡Œçš„ linear optics æœ‰ç‚¹å¥‡æ€ªã€‚emmm ä»€ä¹ˆæ˜¯ linear optics assumption? æˆ‘åœ¨ç ”ä¸€ä¸Šå­¦æœŸçš„ã€ç”Ÿç‰©åŒ»å­¦å…‰å­¦ã€‘è¯¾ç¨‹ä¸­æ›¾ç»å­¦åˆ°ã€éçº¿æ€§å…‰å­¦ã€‘çš„æ¦‚å¿µï¼Œæˆ‘å°è±¡æœ€æ·±çš„éçº¿æ€§å…‰å­¦æ¦‚å¿µå°±æ˜¯æ‹‰æ›¼æ•£å°„ï¼ˆä½†æ˜¾ç„¶ä¸å¯èƒ½å‡ºç°åœ¨å›¾å½¢å­¦çš„æ¸²æŸ“é—®é¢˜ä¸­ï¼Œæ‹‰æ›¼æ•£å°„æ¯”æ™®é€šæ•£å°„çš„å¼ºåº¦ä½å¥½å‡ ä¸ªæ•°é‡çº§ï¼‰ã€‚å¦‚æœä¸æŸäº›éçº¿æ€§å…‰å­¦æ•ˆåº”æœ‰å…³ï¼Œæˆ‘å°±è¿˜æœ‰å¾ˆå¤šå…‰å­¦çŸ¥è¯†éœ€è¦è¡¥... ä¸ªäººè§‰å¾—å¯èƒ½å­˜åœ¨è¿™æ ·çš„ä¸€ç§æƒ…å†µï¼šæˆ‘æ›¾ç»è¯»åˆ°è¿‡å…‰è‡´é€æ˜/å…‰è‡´å˜è‰²çš„æœ‰å…³å†…å®¹ï¼Œå‡è®¾ emission ä¸å…¥å°„å…‰æœ‰å…³ï¼Œé‚£ä¹ˆ <span class="math inline">\(L_e(x, w)\)</span> å°†ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæ˜¯å…¥å°„ <span class="math inline">\(L_i(x, w)\)</span> çš„å‡½æ•°ï¼Œå»ºæ¨¡èµ·æ¥å°±éœ€è¦ä¸€äº›æ•°å­¦æ‰‹æ®µã€‚</p>
<h3 id="out-scattering">2.1.3 Out-scattering</h3>
<p>â€‹ out-scattering: å…‰çº¿åç¦»åŸæœ¬æ–¹å‘ï¼Œå‘åˆ«çš„æ–¹å‘ä¼ æ’­è€ŒæŸå¤±èƒ½é‡çš„è¿‡ç¨‹ã€‚out-scattering ä¹Ÿæ˜¯çº¿æ€§å¾®åˆ†æ–¹ç¨‹å»ºæ¨¡ï¼ˆè¿™å¯èƒ½å°±æ˜¯ç¼ºé™·æ‰€åœ¨ï¼‰ï¼š <span class="math display">\[
\begin{equation}\label{out-scat}
dL_o(x, w) = -\sigma_s L_i(x, w) dt
\end{equation}
\]</span> â€‹ æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…¬å¼<span class="math inline">\(\eqref{absorb}\)</span>ä¸å…¬å¼<span class="math inline">\(\eqref{out-scat}\)</span>ç»„åˆåœ¨ä¸€èµ·ï¼Œå¾—åˆ°ç³»æ•° <span class="math inline">\(\sigma_t = \sigma_a + \sigma_s\)</span>ï¼Œç§°ä¹‹ä¸º attenuation æˆ–è€…æ›´ä¸ºç†ŸçŸ¥çš„ã€extinctionã€‘ã€‚<span class="math inline">\(\sigma_t\)</span> æ˜¯ä¸ªé‡è¦æ¦‚å¿µï¼Œç”±å®ƒå®šä¹‰äº†ä¸¤ä¸ªæ¦‚å¿µ:</p>
<ul>
<li>Albedo: <span class="math inline">\(\rho = \sigma_s / \sigma_t\)</span>ï¼Œä»å…¬å¼çœ‹ä¹Ÿå³æ•£å°„ç›¸å¯¹äºä¸¤ç§ interaction äº‹ä»¶å‘ç”Ÿçš„æ¯”ä¾‹ã€‚ä¹Ÿå³å‘ç”Ÿæ•£å°„äº‹ä»¶æ—¶ï¼Œæ•£å°„ï¼ˆè€Œéå¸æ”¶ï¼‰çš„æ¦‚ç‡</li>
<li>å¹³å‡è‡ªç”±ç¨‹ï¼š<span class="math inline">\(1/\sigma_t\)</span>ã€‚éƒ½æ˜¯ä¼ç¬”ï¼Œè¿˜è®°å¾—<span class="math inline">\(\sigma_t\)</span>çš„å•ä½æ˜¯<span class="math inline">\(m^{-1}\)</span>å—... å€’æ•°çš„å•ä½å°±æ˜¯<span class="math inline">\(m\)</span>äº†ï¼šå…‰çº¿å‘ç”Ÿä¸€æ¬¡æ•£å°„äº‹ä»¶å‰è¡Œè¿›çš„å¹³å‡è·ç¦»ã€‚</li>
</ul>
<p>â€‹ emmmï¼Œæœ‰äº†<span class="math inline">\(\sigma_t\)</span>ä»¥åŠå…¬å¼<span class="math inline">\(\eqref{absorb}\)</span>ä¸<span class="math inline">\(\eqref{out-scat}\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„ "Beer-Lambert" å…¬å¼ï¼š <span class="math display">\[
\begin{equation}\label{remain2}
L_o(x+w\cdot t, w) = L_i(x, w)e^{-\int^{t}_0 \sigma_t(x + w\cdot \tau)d\tau}
\end{equation}
\]</span> â€‹ ä»¥ä¸Šå…¬å¼è®¡ç®—çš„ç»“æœä¸­ï¼ŒæŒ‡æ•°é¡¹è¢«ç§°ä¸º transmittanceï¼ˆä¼ è¾“ç‡ï¼‰ï¼Œç”±äºæŒ‡æ•°é¡¹çš„å­˜åœ¨ï¼ˆlinear opticsï¼‰ï¼Œä¼ è¾“ç‡æ˜¯å¯ä¹˜çš„ï¼ˆä¹˜ç­‰äºé€šè¿‡ä¸¤ç«¯è·¯å¾„ä¹‹å’Œï¼‰ã€‚expçš„æŒ‡æ•°é¡¹è¢«ç§°ä¸ºå…‰å­¦åšåº¦ï¼ˆoptical thicknessï¼‰: <span class="math display">\[
\begin{equation}\label{opt-th}
\tau(x\rightarrow x&#39;) = \int_0^t\sigma_t (x+tw, w)dt
\end{equation}
\]</span></p>
<blockquote>
<p>This property is useful for volume scattering implementations, since it makes it possible to incrementally compute transmittance at multiple points along a ray.</p>
</blockquote>
<p>â€‹ è¿™ä¹ŸåŒæ ·éœ€è¦æ³¨æ„ï¼Œæˆ‘åŒæ ·å¸Œæœ›æ‹“å±•çš„æ¨¡å‹ä¹Ÿå…·æœ‰æ­¤æ€§è´¨ï¼Œè¿™æ ·çš„ç³»ç»Ÿå°†ä¼šæ˜¯æ— è®°å¿†ç³»ç»Ÿï¼Œå®¹æ˜“å®ç°å¹¶ä¸”å¯¹å¹¶è¡Œè®¡ç®—æ˜¯å‹å¥½çš„ã€‚ã€æ— è®°å¿†æ€§ã€‘</p>
<h3 id="in-scattering">2.1.4 In-scattering</h3>
<p>â€‹ in-scattering éœ€è¦å¼•å…¥ç›¸å‡½æ•°ï¼ˆphase functionï¼‰æ¦‚å¿µï¼Œæ­¤æ¦‚å¿µä¸BSDFå¾ˆåƒï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºBSDFæ˜¯è¡¨é¢çš„ç›¸å‡½æ•°ï¼ŒBRDFåˆ™ä¸€èˆ¬å®šä¹‰èƒŒå‘æ•£å°„ï¼ŒBSDFåˆ™åŒæ—¶å®šä¹‰å‰å‘ä¸èƒŒå‘æ•£å°„ã€‚</p>
<p>â€‹ PBR-book ç»™å‡ºäº† BSDFä¸phase functionçš„ä¸€ä¸ªé‡è¦ä¸åŒï¼Œå›é¡¾BSDFçš„æ€§è´¨ï¼šBSDFå…·æœ‰â€œå½’ä¸€æ€§è´¨â€ï¼š <span class="math display">\[
\begin{align}\label{norm1}
\int_{\Omega} L_i(x, w_o)f_r(x, w_i, w_o)\cos\theta dw_o &amp;\leq L_i(x, w_i)\\
\int_{\Omega} f_r(x, w_i, w_o)\cos\theta dw_o &amp;\leq 1
\end{align}
\]</span> â€‹ ä½†ç”±äº medium interaction å¹¶æ²¡æœ‰ cosine's lawï¼Œå¹¶ä¸” phase functionå¹¶ä¸å»ºæ¨¡èƒ½é‡è¡°å‡ï¼Œæ•… phase function æ˜¯ç›´æ¥ã€å®Œå…¨å½’ä¸€åŒ–çš„ï¼š <span class="math display">\[
\begin{equation}\label{norm2}
\int_{S^2}p(w_i, w_o)dw_o = 1
\end{equation}
\]</span></p>
<blockquote>
<p>The main difference is that there is no cosine term since the phase function operates on radiance rather than differential irradiance.</p>
</blockquote>
<p>â€‹ phase function å®é™…ä¸Šå°±æ˜¯æ•£å°„æ–¹å‘çš„PDFã€‚å…³äº phase functionï¼Œè¿™é‡Œåªæä¸€ç‚¹ï¼šå¤§å¤šæ•°phase functionéƒ½å¯ä»¥ç”¨ H-G phase function çš„çº¿æ€§ç»„åˆè¿‘ä¼¼<a href="#ref">[1]</a>ã€‚</p>
<h2 id="radiative-transfer-equation">2.2 Radiative Transfer Equation</h2>
<blockquote>
<p>definitionThe light transport equation is in fact a special case of the equation of transfer, simplified by the lack of participating media and specialized for scattering from surfaces. <a href="#ref">[2]</a></p>
</blockquote>
<p>â€‹ å¾ˆé‡è¦ï¼Œå°±æ¨å¯¼ä¸¤å¯¹æ•ˆåº”ï¼š</p>
<ul>
<li>absrption / out-scattering (radiance å‡å°‘)</li>
<li>emission / in-scattering (radiance å¢å¤š)</li>
</ul>
<p>â€‹ å¸¦æ¥çš„å½±å“ï¼Œä»¥åŠä» surface å…¥å°„çš„ radiance å¦‚ä½•å¯¹å½“å‰ä¸€ç‚¹çš„å…¥å°„ radiance èµ·ä½œç”¨ã€‚é¦–å…ˆï¼Œè¿™é‡Œå±•ç¤ºæ— ä»‹è´¨æƒ…å†µä¸‹çš„ light transport equationï¼š <span class="math display">\[
\begin{equation}\label{lte}
L_o(x, w_o) = L_e(x_h, w_o) + \int_\Omega f(x_h, w_i, w_o)L_i(x_h, w_i)\cos\theta dw_i
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(x_h\)</span>ä¸º<span class="math inline">\(x\)</span> æ²¿ç€<span class="math inline">\(-w_o\)</span> æ–¹å‘äº¤åœºæ™¯çš„æœ€è¿‘äº¤ç‚¹ï¼ˆfirst intersectionï¼‰ã€‚æ­¤ LTE æˆ‘ä»¬å¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿå³emissionä¸å‡»ä¸­ç‚¹åŠçƒä¸Šå…¥å°„å…‰åå°„çš„ç§¯åˆ†å’Œä¸ºå‡ºå°„å…‰ï¼Œä¸Šä¸€ç¯‡åšå®¢æˆ‘ä»¬ä¹Ÿåˆ†æäº†æ­¤å…¬å¼çš„åˆ†è§£å®ç°ã€‚ä½†ä¸Šè¿°å…¬å¼ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šåœºæ™¯çš„å‡ ä½•é…ç½®ã€å¯è§†ä¿¡æ¯ç­‰ï¼Œè€Œè¿™äº›ä¿¡æ¯å®é™…ä¸Šåœ¨ä¸Šè¿°å…¬å¼ä¸­åˆè‡³å…³é‡è¦ã€‚ä¾‹å¦‚åœ¨åˆ†æç›´æ¥å…‰ç…§æ—¶ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯æ— ä»‹è´¨ç›´æ¥å…‰ç…§ï¼Œéœ€è¦trace shadow rayå¹¶ä¸”ç¡®è®¤ shadow ray å¹¶æ²¡æœ‰ ã€é™¤äº†è¢«é‡‡æ ·å…‰æºä¹‹å¤–çš„å…¶ä»–å‡ ä½•ä½“ã€‘é®æŒ¡ã€‚</li>
<li>å¦‚æœæ˜¯æœ‰ä»‹è´¨ç›´æ¥å…‰ç…§ï¼Œéœ€è¦è¿›è¡Œå¤šæ¬¡ tracingï¼šç”±äºå¯¹åº”çš„å‡ ä½•å¯èƒ½æ˜¯ null-surface (ç”¨äºé™åˆ¶mediumçš„å‡æƒ³surface)ï¼Œç›´åˆ° tracing åˆ°è¾¾non-null surface æˆ–è€…å…‰æºåå°±åœæ­¢ã€‚</li>
</ul>
<p>â€‹ åœ¨å¼€å§‹ä»‹ç» radiative transfer equation ä¹‹å‰ï¼Œæˆ‘æƒ³æä¸€ä¸‹ Geometry term è¿™ä¸ªä¸œè¥¿ã€‚</p>
<h3 id="geometry-term">2.2.1 Geometry Term</h3>
<p>â€‹ å»ºè®®å…ˆäº†è§£ä¸€ä¸‹è¿™ä¸ªçŸ¥è¯†ï¼š<a href="https://math.stackexchange.com/questions/1123045/integration-with-respect-to-a-measure">The Integral With Respect to a Measure</a>ï¼ˆå…¶ä¸­nelvçš„å›ç­”ã€‚å…³äºæŸç§åº¦é‡çš„ç§¯åˆ†ï¼Œè¿™é‡Œçš„measureè¯´çš„å¹¶ä¸æ˜¯æ¦‚ç‡æµ‹åº¦ï¼‰ã€‚</p>
<blockquote>
<p>Think of it physically: each measure assigns different <em>weights</em> to given sets: consider for example the particular case <span class="math inline">\(dÎ¼=df(x)=f&#39;(x)dx\)</span> for a well behaved f(x). Here you can really see the difference between the "ordinary" measure <span class="math inline">\(dx\)</span>, which does not care about the location of the set, and <span class="math inline">\(fâ€²(x)dx\)</span>, which indeed does!</p>
</blockquote>
<p>â€‹ ä¹Ÿå³ï¼šæˆ‘ä»¬å…³å¿ƒçš„å¾®å…ƒï¼Œç©¶ç«Ÿè¡¨è¾¾äº†ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Ÿnelvä¸¾çš„ä¾‹å­ï¼šå¯¹äºæ™®é€š <span class="math inline">\(dx\)</span> åº¦é‡çš„ç§¯åˆ†é—®é¢˜æ¥è¯´ï¼š <span class="math display">\[
\begin{equation}
\int_0^1dx = \int_1^2dx = 1
\end{equation}
\]</span> â€‹ è€Œå¦‚æœæˆ‘ä»¬çš„åº¦é‡ä¸æ˜¯ <span class="math inline">\(dx\)</span>ï¼Œè€Œæ˜¯ <span class="math inline">\(df(x)\)</span>ï¼Œåˆ™æ˜¾ç„¶ï¼Œä¸Šè¿°ç§¯åˆ†çš„ç»“æœä¼šå˜æˆï¼š<span class="math inline">\(f(1) - f(0)\)</span>ä»¥åŠ <span class="math inline">\(f(2) - f(1)\)</span>ï¼Œä¸¤è€…æ˜¯å¦ç›¸ç­‰å–å†³äºå‡½æ•°æ€§è´¨ã€‚å°†â€œåº¦é‡â€ä¸åŒå¯¼è‡´â€œç§¯åˆ†å½¢å¼â€ä¸åŒçš„æƒ³æ³•è¿ç§»åˆ° path tracingä¸­ï¼Œæˆ‘ä»¬ä¸éš¾æ‰¾åˆ°å¦‚ä¸‹çš„ä¾‹å­ï¼š</p>
<div class="tabs" id="span-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#span-unique-name-1">æŠ•å½±å›ºä½“è§’ï¼ˆprojected solid angleï¼‰</a></li><li class="tab"><a href="#span-unique-name-2">irradianceç§¯åˆ†</a></li></ul><div class="tab-content"><div class="tab-pane active" id="span-unique-name-1"><p>â€‹ ä¸Šç¯‡è¿˜æ˜¯ä¸Šä¸Šç¯‡å·²ç»è¯´è¿‡äº†ã€‚æŠ•å½±å›ºä½“è§’æ˜¯ä¸ºäº†å¤„ç† <span class="math inline">\(\cos\theta\)</span> é¡¹çš„ä¸€ç§è¡¨å¾ã€‚ç”±äºåœ¨ irradiance ç§¯åˆ†ä¸­ï¼Œæœ‰ï¼š <span class="math display">\[
\begin{equation}
\int_\Omega f(x_h, w_i, w_o)L_i(x_h, w_i)\cos\theta dw_i
\end{equation}
\]</span> â€‹ ä¸Šè¿° <span class="math inline">\(\cos\theta\)</span> å¯ä»¥è¢«æ¶ˆå»ï¼Œå¦‚æœå°†ç«‹ä½“è§’å˜ä¸ºæŠ•å½±ç«‹ä½“è§’ã€‚ç®€å•ç†è§£å°±æ˜¯ï¼šç”±äºç«‹ä½“è§’å®é™…ä¸Šæ˜¯æŸä¸ªç‰©ä½“ã€å¼ æˆçš„3Dè§’åº¦ã€‘åœ¨ã€å•ä½çƒä¸Šçš„æŠ•å½±é¢ç§¯ã€‘ï¼ˆå¯¹åº”2Dä¸­æŸçº¿æ®µç¡®å®šçš„å¼§é•¿ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢ç§¯å¯ä»¥æŠ•å½±åˆ°å•ä½çƒä¸­ç”±ç‰©ä½“è¡¨é¢æ³•å‘é‡ç¡®å®šçš„åœ†ç›˜ä¸Šï¼ˆç”±3Dé¢ç§¯æŠ•å½±ä¸º2Dé¢ç§¯ï¼‰ï¼Œä¹Ÿå³ï¼š <span class="math display">\[
\begin{equation}
 d w_i^{\perp} = \cos\theta dw_i
\end{equation}
\]</span> â€‹ è¿™å°±æ˜¯ä¸€ç§ä¸åŒçš„åº¦é‡ï¼Œé¢ç§¯å¾®å…ƒç”±æŠ•å½±å¾®åˆ†ç«‹ä½“è§’å†³å®šã€‚ç§¯åˆ†ç©ºé—´ä¹Ÿä¼šå¯¹åº”æ”¹å˜ä¸º2Dåœ†ç›˜è€Œé3DåŠçƒã€‚</p></div><div class="tab-pane" id="span-unique-name-2"><p>â€‹ ä¸€ç§æ›´åŠ å¤æ‚çš„æƒ…å†µï¼Œè™½ç„¶è¿™ç§æƒ…å†µä¹‹å‰å·²ç»å¤šæ¬¡è®²è¿‡ï¼ˆBSDF/emitteré‡‡æ ·ï¼‰ã€‚è§‚å¯Ÿå…¬å¼ <span class="math inline">\(\eqref{lte}\)</span> ä¸­çš„ irradiance ç§¯åˆ†ï¼Œä¸éš¾å‘ç°ç§¯åˆ†ç©ºé—´æ˜¯æ³•å‘é‡ç¡®å®šçš„åŠçƒï¼Œåº¦é‡æ˜¯å¾®åˆ†ç«‹ä½“è§’ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºå¦ä¸€ç§åº¦é‡ï¼šå¯¹æŸä¸€ä¸ªé¢å…‰æºè€Œè¨€ï¼Œé¢å…‰æºä¸Šæ¯ä¸€ç‚¹å¯¹ç©ºé—´ä¸­æŸä¸€ç‚¹çš„ irradiance è´¡çŒ®ã€‚æ­¤å¤„ï¼šå¯¹é¢å…‰æºä¸Šç‚¹è¿›è¡Œç§¯åˆ†ä½¿ç”¨çš„æ˜¯ã€é¢ç§¯å¾®å…ƒã€‘ï¼Œç§¯åˆ†ç©ºé—´ä¸ºã€å…‰æºè¡¨é¢ã€‘ï¼ˆå¯¹åº”emitter samplingï¼‰ï¼Œè€Œå…¬å¼ <span class="math inline">\(\eqref{lte}\)</span>ä¸­çš„ irradianceç§¯åˆ†ï¼Œå…¶åº¦é‡å·²ç»è®²è¿‡ï¼ˆå¯¹åº”äº†BSDF samplingï¼‰ã€‚ä¸¤ä¸ªåº¦é‡ä¹‹é—´å­˜åœ¨è½¬åŒ–å…³ç³»ï¼Œè½¬åŒ–å…³ç³»çš„ç¤ºæ„å›¾è§ <a href="https://enigmatisms.github.io/2023/02/11/AdaPT-Monte-Carlo-Path-Tracer-II/">ä¸Šä¸€ç¯‡åšå®¢çš„Figure.3</a>ã€‚</p></div></div></div>
<p>â€‹ åº¦é‡ä¹‹é—´çš„è½¬åŒ–å…³ç³»éå¸¸é‡è¦ï¼Œè´¯ç©¿äº path tracing çš„ importance samplingï¼Œä¸Šæ¬¡è¯»è®ºæ–‡æ—¶çœ‹åˆ°è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Converting from the solid angleÃ—length product measure to the volume measure requires multiplication by a corresponding geometry term G. <a href="#ref">[4]</a></p>
</blockquote>
<p>â€‹ ä¹Ÿå³ï¼ŒGeometry term å¯ä»¥ç”¨ä½œåº¦é‡è½¬æ¢ã€‚åœ¨ PBR-book <a href="#ref">[3]</a> ä¸­ï¼Œæœ‰éå¸¸è¯¦ç»†çš„ geometry term ç”¨äºåº¦é‡è½¬æ¢çš„ä¾‹å­ <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/The_Light_Transport_Equation#TheSurfaceFormoftheLTE">14.4.3 The Surface Form of the LTE</a>ï¼Œè¿™é‡Œå°±ä¸æµªè´¹ç¬”å¢¨å»æ‹¾äººç‰™æ…§äº†ã€‚è¿™ä¹Ÿè§£ç­”äº†æˆ‘ä¹‹å‰åœ¨ stackexchange.cg ä¸Š<a href="https://computergraphics.stackexchange.com/questions/13273/path-tracing-how-to-deal-with-ray-hitting-an-emitter/13304#13304">æé—®çš„ä¸€ä¸ªç–‘æƒ‘</a> ï¼ˆæˆ‘è‡ªå·±å†™äº†å›ç­”ï¼‰ï¼šä¸ºä»€ä¹ˆ <span class="math inline">\(L_e\)</span> (emissioné¡¹) å¹¶ä¸éœ€è¦ distance attenuation æˆ–è€… <span class="math inline">\(\cos\)</span> termï¼Ÿå› ä¸º emission evaluation ä½¿ç”¨çš„åº¦é‡æ˜¯ç«‹ä½“è§’è€Œéé¢ç§¯å¾®å…ƒã€‚<span class="math inline">\(L_e\)</span> æœ¬èº«è¿”å›çš„å°±æ˜¯æŸä¸ªæ–¹å‘çš„ radiance (radiance åœ¨é volume path tracing æƒ…å†µä¸‹ï¼Œåœ¨ä¸¤ä¸ªè¡¨é¢ç‚¹ä¹‹é—´æ˜¯ä¸å˜çš„)ã€‚</p>
<p>â€‹ åœ¨ geometry term è®¨è®ºçš„æœ«å°¾ï¼Œæˆ‘æƒ³é¡ºå¸¦å†™ä¸€ä¸‹æˆ‘å¯¹æœ€è¿‘è¯»çš„ä¸€ç¯‡å¥½æ–‡ç«  <a href>[4]ACM ToG 2013</a> ä¸­æŸäº›ç‚¹çš„ç†è§£ã€‚ä»¥å…¶è®ºæ–‡ä¸­çš„å…¬å¼ <span class="math inline">\((4)\)</span> ä»¥åŠå¯¹åº”çš„ equiangular-sampling æ–¹æ³•ä¸ºä¾‹å­ï¼ˆæˆ‘è¿˜æ²¡å­¦åˆ° bidirectional path tracingï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„ç†è§£å¯èƒ½ä¼šæœ‰è¯¯ï¼‰ <span class="math display">\[
\begin{equation}\label{equi}
p(t_{dc} | b, d, w_{dc})\propto G(b, c) = 1/\Vert b - c\Vert^2
\end{equation}
\]</span></p>
<center>
<img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/a14147b9be0a8f4e8e3d8d89294df988.jpg" style="zoom: 40%;">
</center>
<center>
Figure 2. Equi-angular sampling æ–¹æ³•
</center>
<p>â€‹ æ‰€ä»¥ä¸ºä»€ä¹ˆï¼Œé‡‡æ ·çš„æ¡ä»¶åˆ†å¸ƒéœ€è¦å¦‚å…¬å¼ <span class="math inline">\(\eqref{equi}\)</span> æ‰€ç¤ºçš„ bcè·ç¦»å¹³æ–¹åæ¯”æœ‰å…³ï¼Ÿå…¶ä¸­éšå«äº†åº¦é‡çš„è½¬æ¢ï¼šæˆ‘ä»¬å®é™…åœ¨ <span class="math inline">\(w_{dc}\)</span> æ–¹å‘çš„ç›´çº¿ä¸Šé‡‡æ ·ã€è·ç¦»ã€‘ï¼Œä½†æ¡ä»¶æ˜¯ --- å¯¹äº vertex b è€Œè¨€ï¼Œé‡‡æ ·ç»“æœåº”å½“åœ¨è§’åº¦ä¸Šå‘ˆå‡åŒ€åˆ†å¸ƒã€‚ã€è§’åº¦ï¼ˆ3Dï¼‰ã€‘ä¸è·ç¦»ä¹‹é—´çš„è½¬æ¢ï¼Œç”± <span class="math inline">\(G(b, c)\)</span> æ‰¿æ‹…ï¼šè·ç¦»è¶Šè¿œï¼Œå•ä½è§’åº¦å¯¹åº”çš„çº¿æ®µé•¿åº¦è¶Šå¤§ï¼Œåœ¨æŸæ®µè·ç¦»å¾®å…ƒå†…é‡‡æ ·çš„æ¦‚ç‡å°±å°äº†ã€‚ç”±äºæ˜¯3Dç©ºé—´ï¼Œæ•…éµå¾ªå¹³æ–¹åæ¯”ï¼ˆè€Œé2Dç©ºé—´ä¸‹çš„ä¸€æ¬¡åæ¯”ï¼‰ã€‚</p>
<p>â€‹ æ­¤è®ºæ–‡ä¸­è¿˜æœ‰å¾ˆå¤šé‡‡æ ·æ¡ä»¶åˆ†å¸ƒçš„è®¡ç®—éƒ½ä¸åº¦é‡è½¬æ¢æœ‰å…³ã€‚è½¬æ¢æˆæ­£ç¡®çš„åº¦é‡ï¼Œåœ¨æ­£ç¡®çš„ç©ºé—´ä¸‹ç§¯åˆ†æ‰èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<h3 id="rte">2.2.2 RTE</h3>
<p>â€‹ RTE æœ¬èº«çš„å½¢å¼ä¸ LTEå¾ˆåƒï¼Œä½†è€ƒè™‘äº†å…‰è·¯ä¸Š radianceçš„å¢åŠ ï¼ˆin-scattering &amp; emissionï¼‰ä»¥åŠè¡°å‡ï¼ˆout-scattering &amp; absorptionï¼‰ã€‚ç”±å…¬å¼ <span class="math inline">\(\eqref{remain2}\)</span> å®šä¹‰çš„ä¼ è¾“ç‡ï¼ˆtransimittanceï¼‰å°†åœ¨æ¥ä¸‹æ¥çš„å™è¿°ä¸­è¢«å†™ä¸º <span class="math inline">\(T_r\)</span>ã€‚åˆ™æˆ‘ä»¬è€ƒè™‘å…‰çº¿ç©¿è¿‡è¡¨é¢è¿›å…¥ä»‹è´¨æ—¶ï¼Œä»‹è´¨ä¸­æŸä¸€ç‚¹æœæŸä¸€æ–¹å‘çš„å…¥å°„ radiance:</p>
<center>
<img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/Screenshot from 2023-02-18 14-42-51.png" style="zoom:90%;">
</center>
<center>
Figure 3. å…‰çº¿å…¥å°„ä»‹è´¨åçš„ radiance è®¡ç®—ç¤ºæ„å›¾ï¼Œå›¾ä¸­è¿‡p0ç›´çº¿çš„å·¦ä¾§ä¸ºä»‹è´¨å†…éƒ¨[5]
</center>
<p>â€‹ åˆ™ï¼ŒæŸä¸€ç‚¹<span class="math inline">\(p\)</span>çš„å…¥å°„ radiance å¯ä»¥è¢«å†™ä¸ºï¼š <span class="math display">\[
\begin{equation}\label{rte}
L_i(p, w) = T_r(p_0\rightarrow p)L_o(p_0, -w) + \int_d T_r(p&#39;\rightarrow p)L_s(p&#39;, -w)dt
\end{equation}
\]</span> â€‹ å…¶ä¸­ï¼Œ<span class="math inline">\(p&#39; =p_0 -tw\)</span>ï¼Œ<span class="math inline">\(t\)</span> åœ¨<span class="math inline">\([0, d]\)</span>ï¼ˆ<span class="math inline">\(d\)</span> ä¸º<span class="math inline">\(p_0\rightarrow p\)</span>çš„è·ç¦»ï¼‰ä¸Šç§¯åˆ†ã€‚ä¸Šå¼çš„ç­‰å·å³è¾¹æœ‰ä¸¤é¡¹ï¼š</p>
<ul>
<li>ç¬¬ä¸€é¡¹ï¼šä»£è¡¨äº†å¤–éƒ¨å…‰çº¿åŸæœ¬ä¼ è¾“çš„éƒ¨åˆ†åœ¨ä¼ è¾“åˆ° <span class="math inline">\(p\)</span> è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè€—æ‰€å‰©çš„éƒ¨åˆ†ï¼ˆ<span class="math inline">\(T_r\)</span> å»ºæ¨¡äº†å‘å¤–çš„æ•£å°„ä¸å¸æ”¶ï¼‰</li>
<li>ç¬¬äºŒé¡¹ï¼šå…‰çº¿ä¸Šæ¯ä¸€ç‚¹ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…‰æºï¼ˆç”±æ•£å°„ä»‹è´¨ä¼šäº§ç”Ÿå†…æ•£å°„çš„åŸå› å†³å®šï¼‰ã€‚è€Œå…‰æºå‘å‡ºçš„å…‰ï¼Œè‡ªç„¶ä¹Ÿéœ€è¦ç»è¿‡ä¸ç¬¬ä¸€é¡¹ä¸€æ ·çš„è¡°å‡ã€‚æ­¤é¡¹éšè—äº†ä¸€ä¸ªç§¯åˆ† - å†…æ•£å°„ä¼°è®¡ç§¯åˆ†ï¼š</li>
</ul>
<p><span class="math display">\[
\begin{equation}\label{in-scat}
L_s(p, w) =L_e(p, w) + \sigma_s(p, w) \int_{S^2} f_p(p, w_o, w)L_i(p, -w_o)dw_o
\end{equation}
\]</span></p>
<p>â€‹ å…¶ä¸­ <span class="math inline">\(S^2\)</span> è¡¨ç¤ºå®Œæ•´çƒé¢ï¼ˆä»‹è´¨å˜›ï¼Œå°±ä¸æ˜¯åŠçƒé¢äº†ï¼‰ã€‚æ•…å¯ä»¥çœ‹å‡ºå…¬å¼ <span class="math inline">\(\eqref{rte}\)</span> åŒ…å«äº†æ‰€æœ‰çš„ ray-medium interaction æ“ä½œã€‚ä¸è¿‡ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¸è€ƒè™‘ emissionï¼ˆä¼šå‘å…‰çš„çƒŸé›¾å¾ˆç‚«å•Šï¼‰ã€‚</p>
<p>â€‹ emmmï¼Œä¹Ÿæ²¡ä»€ä¹ˆç¥ç§˜çš„å¯¹ä¸å¯¹ï¼Ÿé‡ç‚¹ä¸åœ¨äºç†è®ºï¼Œåœ¨äºå®ç°ï¼šå…¬å¼ <span class="math inline">\(\eqref{rte}\)</span> å­˜åœ¨ä¸¤ä¸ªç§¯åˆ†ï¼Œåˆ™éœ€è¦ä¸¤æ¬¡é‡‡æ ·ã€‚æˆ‘ä»¬å°†å…¬å¼ <span class="math inline">\(\eqref{rte}\)</span> é‡å†™ä¸ºæ²¡æœ‰ emission é¡¹çš„äºŒé‡ç§¯åˆ†å½¢å¼ï¼š <span class="math display">\[
\begin{equation}\label{rte2}
L_i(p, w) =  \int_d \int_{S^2} T_r(p&#39;\rightarrow p) \sigma_s(p, w) f_p(p, w_o, w)L_i(p, -w_o)dw_odt
\end{equation}
\]</span> â€‹ å†™ä¸º Monte Carlo ç§¯åˆ†çš„å½¢å¼ï¼Œå¹¶å‡è®¾ <span class="math inline">\(\sigma_s\)</span> homogeneousï¼š <span class="math display">\[
\begin{equation}\label{rte-mc}
L_i(p, w) = \frac{\sigma_s}{N}\sum_{i=1}^N \frac{T_r(p_i\rightarrow p)}{\text{pdf}(p_i)} \frac{f_p(p, w_o, w)L_i(p, -w_o)}{\text{pdf}(w_o, w|p_i)}
\end{equation}
\]</span> â€‹ ä¸Šå¼çš„é‡‡æ ·è¿‡ç¨‹æ˜¯å­˜åœ¨é¡ºåºçš„ï¼šé¦–å…ˆéœ€è¦é‡‡æ ·ç©ºé—´ä¸­çš„ç‚¹ï¼ˆç”±äº phase function å¯èƒ½ä¸ç©ºé—´ä½ç½®æœ‰å…³ï¼Œå¹¶ä¸”æ˜¯å¦å‘ç”Ÿä½“æ•£å°„è€Œéè¡¨é¢interactionä¹Ÿä¸é‡‡æ ·ç‚¹çš„ä½ç½®æœ‰å…³ï¼‰ï¼Œé‡‡æ ·å®Œç©ºé—´ä¸­çš„ç‚¹åå†é‡‡æ ·æ–¹å‘ã€‚æ•´ä¸ªevaluationç»“æœéœ€è¦æˆ‘ä»¬ä½¿ç”¨è”åˆåˆ†å¸ƒï¼Œè”åˆåˆ†å¸ƒåˆ™å¯ä»¥ç”¨æ¡ä»¶åˆ†å¸ƒä¸è¾¹ç¼˜åˆ†å¸ƒè¡¨å‡ºï¼Œå¹¶ä¸”æ³¨æ„ï¼Œåœ¨è¿™ç§ç®€å•æƒ…å†µä¸‹ï¼ˆhomogeneousï¼‰ï¼Œ<span class="math inline">\((w_o, w)\)</span> ä¸ <span class="math inline">\(p_i\)</span> æ˜¯ç‹¬ç«‹çš„ã€‚</p>
<h2 id="å®ç°æµç¨‹">2.3 å®ç°æµç¨‹</h2>
<p>â€‹ PBR bookå†™å¾—å¤ªå¥½äº†ï¼Œç¬¬15ç« éå¸¸æ¸…æ™°ã€‚ä»åŸå§‹çš„ç†è®ºåˆ°é‡‡æ ·çš„å®ç°ä»¥åŠç®—æ³•çš„å…¨æµç¨‹ï¼Œèƒ½è®©äººå®Œæ•´åœ°çœ‹æ˜ç™½ï¼Œå”¯ä¸€çš„é—æ†¾å°±æ˜¯ç¼ºå°‘ä¸€äº› volumetric path tracing çš„ variance reduction æ–¹æ³•ã€‚ç›®å‰AdaPT ä¸­çš„<code>vpt</code>åˆ†æ”¯å·²ç»è¢«åˆå¹¶åˆ° <code>master</code> åˆ†æ”¯ä¸‹ï¼Œè™½ç„¶æœ‰ç»“æœä½†å™ªå£°é—®é¢˜è¿˜æ˜¯æ¯”è¾ƒä¸¥é‡ã€‚æ ¹æ®<a href="#ref">[4]</a>ï¼Œæ–¹å·®å¤§å¯èƒ½æ˜¯ unidirectional volumetric path tracer æ— æ³•é¿å…çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>Volumetric path tracing with explicit shadow connections suffer from <strong>infinite variance</strong> when participating media surrounds light sources.</p>
</blockquote>
<p>â€‹ æ ¹æ®æˆ‘çš„å®éªŒç»“æœå‘ç°ï¼Œæƒ…å†µå¥½åƒç¡®å®æ˜¯è¿™æ ·ï¼š</p>
<table>
<colgroup>
<col style="width: 49%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Null-surface with shadow connections</th>
<th style="text-align: center;">Explicit shadow connections &amp; media surrounds emitters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/pbr-box-cloud.png"></td>
<td style="text-align: center;"><img src="/2023/02/18/AdaPT-Volumetric-Path-Tracer-I/pbr-balls-20000.png"></td>
</tr>
</tbody>
</table>
<center>
Figure 4. AdaPTçš„ä¸€äº›æ¸²æŸ“ç»“æœ
</center>
<p>â€‹ å¯ä»¥çœ‹åˆ°ï¼Œä¸Šå›¾ä¸­çš„å³å›¾æ˜æ˜¾ç¬¦åˆè®ºæ–‡<a href="#ref">[4]</a>æ‰€è¯´çš„æƒ…å†µï¼šshadow connections + å…‰æºè¢«ä»‹è´¨åŒ…è£¹ã€‚æ‰€ä»¥åœ¨20000è½®è¿­ä»£ä¹‹åï¼ˆå…± trace 50äº¿æ¡å…‰çº¿ï¼Œå…è®¸çš„æœ€å¤§depthä¸º25 bouncesï¼‰ï¼Œä»ç„¶å­˜åœ¨ shot noisesã€‚è€Œå·¦å›¾å°±æ˜¯å•çº¯åœ°æ”¶æ•›æ…¢ã€‚</p>
<p>â€‹ è™½ç„¶ä¸Šè¿°ç®—æ³•ä»ç„¶å­˜åœ¨æ”¶æ•›æ€§ä¸Šçš„é—®é¢˜ï¼Œä½†è‡³å°‘åœ¨debugåï¼ˆçœŸæœ‰äº›åªæœ‰æˆ‘èƒ½å†™å‡ºæ¥çš„è„‘ç˜«bugï¼Œè®©æˆ‘æ€€ç–‘æˆ‘æ ¹æœ¬ä¸é€‚åˆå†™ä»£ç ï¼‰èƒ½è¾¾åˆ°ä¸ mitsuba ç±»ä¼¼çš„è¾“å‡ºç»“æœã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°ä¸€äº›é—®é¢˜ï¼ˆæ„Ÿè§‰å¡ä½çš„åœ°æ–¹ï¼‰ï¼Œä¸‹é¢ç®€è¦è¯´ä¸€ä¸‹ã€‚</p>
<h3 id="vpt-ç®—æ³•æµç¨‹">2.3.1 VPT ç®—æ³•æµç¨‹</h3>
<p>â€‹ ç®—æ³•çš„ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼Œåœ¨å¾ªç¯å¼€å§‹åï¼š</p>
<ol type="1">
<li>æ ¹æ® throughput åˆ¤å®šæ˜¯å¦åœæ­¢ã€‚å¯ç”¨çš„ç­–ç•¥æœ‰ RR, max iteration é™åˆ¶ä»¥åŠ min_contribution é™åˆ¶</li>
<li>ray intersection -- è®¡ç®— first intersection point ä»¥åŠå‡»ä¸­ä½ç½®çš„æ³•å‘é‡ã€å‡»ä¸­ç‰©ä½“çš„ obj_id</li>
<li>æ ¹æ®æ³•å‘é‡ä¸å…‰çº¿çš„å…³ç³»ï¼Œåˆ¤å®šå½“å‰å…‰çº¿åœ¨ free space ä¸­è¿˜æ˜¯ç‰©ä½“ä¸­ï¼šå¦‚æœåœ¨ç‰©ä½“ä¸­ï¼Œå…‰çº¿ä¸æ³•å‘çš„å¤¹è§’åº”å½“å°äº90Â°ï¼Œå¦åˆ™å¤§äº90Â°</li>
<li>è®¡ç®—å½“å‰ä»‹è´¨ï¼Œå¦‚æœ <code>in_free_space</code> = Trueï¼Œåˆ™ç”¨ world mediumï¼Œå¦åˆ™ç”¨ obj_id å¯¹åº”çš„ BSDFå†…éƒ¨çš„medium</li>
<li>è¿›è¡Œè‡ªç”±ç¨‹é‡‡æ ·ï¼š
<ol type="1">
<li>åˆ¤å®šå½“å‰ä»‹è´¨æ˜¯å¦ä¸ºæ•£å°„ä»‹è´¨ï¼Œå¦‚æœä¸æ˜¯æ•£å°„ä»‹è´¨ï¼ˆæˆ–è€…æ˜¯éé€æ˜çš„BRDFï¼‰ï¼Œç›´æ¥è½¬åˆ°ã€æ­¥éª¤4ã€‘</li>
<li>æ ¹æ®æŒ‡æ•°åˆ†å¸ƒé‡‡æ ·å¹³å‡è‡ªç”±ç¨‹ <span class="math inline">\(t_{\text{mfp}}\)</span>:
<ol type="1">
<li><span class="math inline">\(t_{\text{mfp}}\)</span> ä¸ ray intersectionçš„ä¸‹ä¸€è¡¨é¢è·ç¦» <span class="math inline">\(t_{\max}\)</span> å¯¹æ¯”ï¼Œå¦‚æœ <span class="math inline">\(t_{\text{mfp}} &lt; t_{\max}\)</span> åˆ™è®¾ç½® <code>is_mi</code> (is medium interaction) ä¸º Trueï¼Œå¦åˆ™ä¸º False</li>
<li>æ ¹æ® <code>is_mi</code> çš„ä¸åŒï¼Œè®¡ç®—è¿™æ®µè·ç¦»çš„ transmittance: å¦‚æœæ˜¯è¡¨é¢ interactionï¼Œåªéœ€è¦ <span class="math inline">\(T_r /{\text{pdf}}\)</span>ï¼Œå¦åˆ™è¿˜éœ€è¦ä¹˜ä»¥ <span class="math inline">\(\sigma_s\)</span></li>
</ol></li>
<li>if <code>is_mi</code> == True: å¾—åˆ°ä»‹è´¨äº¤äº’ç‚¹
<ol type="1">
<li>è®¡ç®—ç›´æ¥å…‰ç…§éƒ¨åˆ†ï¼šå¦‚æœå…‰æºä¸interaction ç‚¹åœ¨åŒä¸€ä»‹è´¨å†…ï¼Œåªè¦ä¸é®æŒ¡ä¸€èˆ¬æ²¡æœ‰é—®é¢˜ï¼Œä¸åœ¨åŒä¸€ä»‹è´¨å†…åˆ™æ ¹æ®BSDF track rayï¼ˆå…‰çº¿å°è¯•ä»å½“å‰ä½ç½®å‡ºå‘å»å‡»æ‰“å…‰æºï¼Œè·¯å¾„ä¸Šå¦‚æœé‡åˆ°äº† null-surface åˆ™ç»§ç»­è®¡ç®—ï¼Œå¦åˆ™è‹¥é‡åˆ° non-null surface åˆ™ç›´æ¥ä¸¢å¼ƒæ­¤å…‰çº¿ï¼Œåœ¨ track ray çš„è¿‡ç¨‹ä¸­éœ€è¦è®°å½• accumulated transmittanceï¼‰ã€‚ç›´æ¥å…‰ç…§çš„ contribution è®¡ç®—ç»“æŸåï¼ŒåŠ åˆ°å½“å‰ radiance ä¸Šã€‚</li>
<li>è®¡ç®—ä¼ æ’­ï¼ŒNEEï¼šï¼ˆä¸»è¦è°ƒç”¨ sampleï¼‰ï¼Œæ‰¾åˆ°ä¸‹ä¸€æ¬¡åº”è¯¥ä¼ æ’­çš„æ–¹å‘ï¼ˆphase functioné‡‡æ ·ï¼‰ä»¥åŠ throughputã€‚å›åˆ°æ­¥éª¤1</li>
</ol></li>
<li>else: å¾—åˆ°è¡¨é¢ interactionç‚¹
<ol type="1">
<li>å¦‚åŒæ­£å¸¸path tracerï¼Œshadow connection / emitter evaluation ä»¥åŠ BSDF æ–¹å‘é‡‡æ ·</li>
</ol></li>
<li>åœ¨ç´¯åŠ åˆ°ç»“æœ radiance ä¹‹å‰ï¼Œthroughput é¦–å…ˆä¹˜ä»¥è‡ªç”±ç¨‹é‡‡æ ·ä¸­è®¡ç®—çš„ transmittance</li>
</ol></li>
</ol>
<p>â€‹ æ³¨æ„ï¼Œç”±äºæš‚æ—¶ç”¨ä¸åˆ°MISï¼Œä¸ Monte Carlo integration æœ‰å…³çš„é¡¹éƒ½å¯ä»¥å…ˆé™¤ä»¥å¯¹åº”çš„PDFåç›´æ¥è¾“å‡ºï¼Œä¸éœ€è¦å•ç‹¬è¾“å‡ºPDFï¼ˆå› ä¸ºç”¨ä¸ä¸Šï¼‰ã€‚æ•…ï¼Œæ‰€æœ‰çš„ transmittance éƒ½éœ€è¦é™¤ä»¥å¯¹åº”çš„PDFï¼š</p>
<ul>
<li>è‡ªç”±ç¨‹é‡‡æ ·æ—¶ï¼Œæ ¹æ®é‡‡æ ·ç»“æœè®¡ç®—è·¯å¾„çš„ transmittanceï¼Œéœ€è¦ç›´æ¥é™¤ä»¥PDFï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ¯•ç«Ÿé‡‡æ ·æ˜¯ Monte Carlo æ–¹æ³•çš„å…³é”®æ­¥éª¤ã€‚</li>
<li>track rays æ—¶ï¼ˆç”¨äº direct component evaluationï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—çš„PDFæ˜¯æ•´æ¡è·¯ä¸Š<strong>éƒ½ä¸å‘ç”Ÿä»‹è´¨æ•£å°„</strong>ï¼ˆä¹Ÿå³æ–¹å‘æ”¹å˜ï¼‰çš„PDFã€‚è¿™æ˜¯ç”±äºï¼Œdirect component evaluation çš„å…‰çº¿èµ·å§‹ç‚¹ã€ç»ˆæ­¢ç‚¹æ˜¯ç¡®å®šçš„ã€‚å¯¹äºæ— ä»‹è´¨é—®é¢˜è€Œè¨€ï¼Œç›´æ¥åˆ¤æ–­æ˜¯å¦é®æŒ¡å³å¯ã€‚æœ‰ä»‹è´¨é—®é¢˜ï¼Œé™¤äº†é®æŒ¡ï¼ˆnon-null surface intersectionï¼‰ä¹‹å¤–ï¼Œè¿˜å¿…é¡»ä½¿å¾—æ•£å°„ä¸å‘ç”Ÿï¼ˆæ–¹å‘ä¸æ”¹å˜ï¼‰ã€‚ä¸è¿‡è¿™ç§æƒ³æ³•æ˜¯å¾ˆå…¸å‹çš„ particle-based çš„æƒ³æ³•ã€‚</li>
</ul>
<h3 id="æ³¨æ„">2.3.2 æ³¨æ„</h3>
<div class="note danger"><p>Backward tracingç±»æ–¹æ³•ï¼Œè¯·æŒ‰ç…§ç‰©ç†è¿‡ç¨‹å‘ç”Ÿçš„æ–¹å‘ç†è§£ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè‡ªç”±ç¨‹é‡‡æ ·çš„æ—¶å€™ï¼Œå¦‚æœæŒ‰ç…§ <span class="math inline">\(\text{eye}\rightarrow \text{emitter}\)</span> çš„æ–¹å‘ç†è§£ï¼Œä¼šå¾ˆå¥‡æ€ªã€‚ä¸ path tracing å®ç°æ—¶ç±»ä¼¼ï¼Œæˆ‘ä»¬è¦æŒ‰ <span class="math inline">\(\text{emitter}\rightarrow \text{eye}\)</span> çš„æ–¹å‘ï¼šå…‰å…¥å°„ä»¥åï¼Œå¦‚ä½•ä¸ä»‹è´¨äº¤äº’ï¼Œè€Œéæˆ‘çš„è§†çº¿å¦‚ä½•åœ¨ä»‹è´¨ä¸­è¢«å¼¯æŠ˜ã€‚åè€…åœ¨è®¡ç®—ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆ intuitiveã€‚</p>
<p><strong>ä¸€å¼€å§‹æˆ‘æ²¡æœ‰æŒ‰ç…§ç‰©ç†è¿‡ç¨‹çš„é¡ºåºç†è§£ï¼Œå®ç°è¿‡ç¨‹ä¸­æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚å¤§æ¦‚æ˜¯å› ä¸ºæˆ‘å¤ªè ¢äº†</strong></p>
</div>
<div class="note warning"><p>Direct component shadow connection åœ¨ volumetric path tracing ä¸­æ•ˆç‡å¾ˆä½: åªè¦é‡åˆ° non-null surface å°±ä¼šä¸¢å¼ƒç›´æ¥ shadow rayã€‚å¯¹äºå†…éƒ¨ä¸ºæ•£å°„ä»‹è´¨çš„æœ‰è¡¨é¢ç‰©ä½“è€Œè¨€ï¼ˆä¹Ÿå³ï¼Œä¸æ˜¯çƒŸé›¾ï¼‰ï¼Œå…¶å†…éƒ¨ radiance ä¹Ÿå°±åªèƒ½ç­‰ ray å‡ºå°„åï¼Œåœ¨æ— ä»‹è´¨ç©ºé—´ä¸­è®¡ç®— direct component æˆ–è€…å‡»ä¸­å…‰æºæ¥è´¡çŒ®äº†ã€‚</p>
</div>
<div class="note info"><p>Taichi æœ‰ bug...ï¼Œdebugæ—¶æˆ‘æƒ³è·‘å¾—å¿«ä¸€äº›ï¼Œè¿ç§»åˆ° windowsä¸Šæ—¶ï¼Œnested struct çš„æˆå‘˜å‡½æ•°æ­»æ´»æ— æ³•è°ƒç”¨ã€‚æ·±å…¥åº•å±‚ python API åä¹Ÿæ²¡æ‰¾åˆ°é—®é¢˜ï¼Œåé¢ç»™äººæ issue å»äº†...ï¼ˆç¡®å®åº”è¯¥æ˜¯ python - Taichi ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼‰ã€‚</p>
</div>
<hr>
<h2 id="iii.-å€¼å¾—è®°å½•">III. å€¼å¾—è®°å½•</h2>
<ul>
<li>å…³äºdiffusiveä¸density estimation:</li>
</ul>
<blockquote>
<p>Section <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_III_Bidirectional_Methods/Stochastic_Progressive_Photon_Mapping.html#sec:photon-mapping-theory">16.2.2</a> will introduce the concept of density estimation, which is used to implement a rendering algorithm known as <em>stochastic progressive photon mapping</em> (SPPM). The underlying density estimation that algorithm uses works well on diffuse surfaces because scattered radiance only depends on the surface position in this case to store a 2D radiance discretization, but for glossy surfaces it becomes preferable to switch to other techniques such as path tracing.</p>
</blockquote>
<ul>
<li>å„é€šé“ä¸åŒå¦‚ä½•è¿›è¡Œé‡‡æ ·: RGB ä¸‰é€šé“æœ‰ä¸åŒçš„ <span class="math inline">\(\sigma_t\)</span> å¦‚ä½•é‡‡æ ·ï¼Ÿ</li>
</ul>
<blockquote>
<p>However, the attenuation coefficient <span class="math inline">\(\sigma_t\)</span> in general varies by wavelength. It is not desirable to sample multiple points in the medium, so a uniform sample is first used to select a spectral channel i; the corresponding scalar value <span class="math inline">\(\sigma_t^i\)</span> is then used to sample a distance along the distribution.</p>
</blockquote>
<ul>
<li>Importance sampling heterogeneous medium (<span class="math inline">\(\sigma_t\)</span> å¹¶éç©ºé—´å‡åŒ€)</li>
</ul>
<blockquote>
<p>The most commonly used method for importance sampling Equation (15.13), is known as <strong>ray marching</strong></p>
</blockquote>
<p>â€‹ ä»¥ä¸‹æ˜¯æ‹“å±•äº†è§£ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç«‹å³çŸ¥é“ï¼ˆéåŒè´¨ä»‹è´¨æœ¬èº«å°±æ¯”è¾ƒå›°éš¾ï¼‰ã€‚å¯¹äºéåŒè´¨ä»‹è´¨ï¼ˆæ³¨æ„ï¼Œisotropic / anisotropic ä¸ºå„å‘åŒ/å¼‚æ€§ï¼Œhomo/hetero ä¸ºåŒè´¨/å¼‚è´¨ï¼‰ä»‹è´¨è€Œè¨€ï¼Œæœ‰å‡ ç§å¤„ç†åŠæ³•ï¼š</p>
<ul>
<li>regular tracking: å¯¹äºæ¯ä¸€ä¸ªvoxelï¼Œéƒ½è¿›è¡ŒåŒè´¨å‡è®¾ï¼Œé‡‡ç”¨homogeneous ä»‹è´¨çš„æ–¹æ³•</li>
<li>ray marching: ç»†åˆ†åŒºé—´ <span class="math inline">\([0, t_{\max}]\)</span>ã€‚åœ¨æ¯ä¸ªç»†åˆ†çš„åŒºé—´ä¸ŠåšåŒè´¨å‡è®¾ï¼Œåˆ™å¯ä»¥ä¼°è®¡æ•´ä¸ªåŒºé—´ä¸Šçš„ <span class="math inline">\(\sigma_t\)</span> è¿‘ä¼¼åˆ†å¸ƒï¼Œç”¨é€†å˜æ¢é‡‡æ ·å¯ä»¥åšåˆ°æ¯” regular tracking æ›´å¥½çš„é‡‡æ ·ï¼ˆä½†æ˜¯ï¼Œæ˜¯æœ‰åä¼°è®¡ï¼Œå¾ˆå¤šæ—¶å€™æ•ˆæœéƒ½ä¸å¥½ï¼‰</li>
<li>delta tracking:</li>
</ul>
<blockquote>
<p>an alternative unbiased approach proposed by Woodcock et al. (<a href="https://www.pbr-book.org/3ed-2018/Light_Transport_II_Volume_Rendering/Further_Reading.html#cite:Woodcock1965">1965</a>) that was originally developed to simulate volumetric scattering of neutrons in atomic reactors. This technique is known as <em>delta tracking</em> and is easiest to realize when the attenuation coefficient <span class="math inline">\(\sigma_t\)</span> is monochromatic.</p>
</blockquote>
<hr>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://www.pbr-book.org/3ed-2018/Volume_Scattering">PBR-book: Chapter 11 Volume Scattering</a></p>
<p>[2] <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_II_Volume_Rendering/The_Equation_of_Transfer">PBR-book: 15.1 The Equation of Transfer</a></p>
<p>[3] <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/The_Light_Transport_Equation#sec:pathspace">PBR-book: The Light Transport Equation</a></p>
<p>[4] <a href="https://scholar.google.com.hk/scholar?hl=zh-CN&amp;as_sdt=0%2C5&amp;q=Joint+Importance+Sampling+of+Low-Order+Volumetric+Scattering&amp;btnG=">Georgiev I, Krivanek J, Hachisuka T, et al. Joint importance sampling of low-order volumetric scattering[J]. ACM Trans. Graph., 2013, 32(6): 164:1-164:14.</a></p>
<p>[5] <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_II_Volume_Rendering/The_Equation_of_Transfer">PBR-book: The Equation of Transfer</a></p>
]]></content>
      <categories>
        <category>learning</category>
      </categories>
      <tags>
        <tag>knowings</tag>
        <tag>Taichi lang</tag>
        <tag>CG</tag>
        <tag>renderer</tag>
      </tags>
  </entry>
</search>
